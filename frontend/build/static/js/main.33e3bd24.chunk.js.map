{"version":3,"sources":["gui/connections/MenuComponents/HeaderButton.module.scss","gui/Components/Search/ResultItem.module.scss","gui/connections/MobileComponents/Form/MobileBooleanInput.module.scss","gui/connections/MobileComponents/TopToolBar/TabSelector.module.scss","RootError.module.scss","gui/Components/ScreenHeader/ScreenHeader.module.scss","gui/Components/ScreenElements/TreeView.module.css","gui/connections/MobileComponents/Grid/FilterEditor.module.scss","gui/Components/ScreenElements/Editors/CheckList.module.scss","model/entities/ErrorDialog.module.scss","gui/connections/MobileComponents/BottomToolBar/ActionDropUp.module.scss","gui/Components/Splitter/Splitter.module.scss","gui/Components/ScreenElements/Table/FilterSettings/FilterSettingsComboBox.module.scss","gui/connections/MobileComponents/Navigation/DetailNavigator.module.scss","gui/Components/WebScreen/WebScreen.module.scss","gui/Components/ScreenElements/Editors/TagInputEditor.module.css","gui/Components/Search/SearchView.module.scss","gui/Components/Search/ResultGroup.module.scss","gui/Components/TagInput/TagInput.module.css","gui/Components/ScreenElements/Editors/ColorEditor.module.scss","gui/Components/Form/CheckBox.module.scss","gui/connections/MobileComponents/Form/ComboBox/ComboBox.module.scss","gui/Components/MainMenu/MainMenuItem.module.scss","gui/Workbench/ScreenArea/CustomSplitter.module.scss","gui/Components/ScreenElements/Editors/CommonStyle.module.css","gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/FilterSettingsLookup.module.scss","gui/connections/MobileComponents/BottomToolBar/BottomToolBar.module.scss","gui/Components/TabbedView/TabbedViewHandle.module.scss","gui/Components/DataViewHeader/DataViewHeaderButton.module.scss","gui/Components/ScreenElements/DataView.module.css","gui/connections/MobileComponents/BottomToolBar/BottomIcon.module.scss","gui/Components/Form/RadioButton.module.scss","gui/Components/ScreenToolbar/ScreenToolbarAction.module.scss","gui/Components/Dialogs/AboutView.module.scss","gui/Components/Sidebar/SidebarSectionHeader.module.scss","gui/Components/WorkQueues/WorkQueuesItem.module.scss","gui/connections/CFavorites.module.scss","gui/connections/MobileComponents/Navigation/BreadCrumbs.module.scss","gui/Workbench/ScreenArea/ScreenArea.module.scss","gui/Components/DataViewHeader/DataViewHeaderAction.module.scss","gui/Components/Dropdowner/Dropdowner.module.scss","gui/Components/DataViewHeader/DataViewHeader.module.scss","gui/Components/Dropdown/DropdownItem.module.scss","gui/connections/MobileComponents/Grid/ColumnOrderEditor.module.scss","gui/Workbench/ScreenArea/FormView/FormView.module.scss","gui/Components/ScreenElements/Editors/NumberEditor.module.scss","gui/Components/ScreenElements/Table/Scrollee.module.css","gui/Components/ScreenElements/Table/Scroller.module.css","gui/Components/WorkflowFinishedPanel/WorkflowFinishedPanel.module.scss","gui/Components/WorkbenchPage/WorkbenchPage.module.scss","gui/connections/MobileComponents/MenuButton.module.scss","gui/Components/MainBar/MainBar.module.scss","gui/Components/ScreenTabsArea/ScreenTabsArea.module.scss","gui/Components/TabbedView/TabbedViewHandleRow.module.scss","model/actions/Actions/processActionQueryResult.module.scss","gui/Components/DataViewHeader/DataViewHeaderButtonGroup.module.scss","gui/Components/Dropdown/Dropdown.module.scss","gui/Components/DataViewHeader/DataViewHeaderGroup.module.scss","gui/Components/Dropdown/DropdownDivider.module.scss","gui/Components/ScreenElements/DataViewLoading.module.css","gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/FilterSettingsBoolean.module.scss","gui/connections/MobileComponents/Grid/ClearableInput.module.scss","gui/connections/MobileComponents/Grid/InputClearButton.module.scss","modules/Editors/DropdownEditor/Cells/NumberCell.module.scss","modules/Editors/DropdownEditor/Cells/BooleanCell.module.scss","gui/connections/MobileComponents/Form/ComboBox/ComboFullScreenEditor.module.scss","gui/connections/MobileComponents/Grid/RecordInfo.module.scss","gui/Components/SidebarInfoSection/SidebarRecordInfo.module.scss","gui/Workbench/ScreenArea/FormView/FormRoot.module.scss","gui/Components/ScreenElements/Editors/ImageEditor.module.scss","gui/Components/ScreenElements/Editors/BoolEditor.module.scss","gui/Components/Form/FormSectionHeader.module.scss","gui/Components/Form/FormLabel.module.scss","modules/DataView/Perspective/FormPerspective/FormPerspectiveDirector.module.scss","gui/Components/ScreenElements/Table/Canvas.module.css","gui/Components/ScreenElements/Table/HeaderRow.module.scss","gui/Components/ScreenElements/Table/PositionedField.module.css","gui/Components/ScreenElements/Table/SelectionCheckboxHeader.module.scss","gui/Workbench/ScreenArea/TableView/TableView.module.scss","modules/DataView/Perspective/TablePerspective/TablePerspectiveDirector.module.scss","../../node_modules/style-inject/dist/style-inject.es.js","../../src/index.tsx","gui/Components/ScreenToolbar/ScreenToolbar.module.scss","gui/Components/ScreenToolbar/ScreenToolbarPusher.module.scss","gui/Components/ScreenToolbar/ScreenToolbarActionGroup.module.scss","gui/Components/Dialogs/AboutDialog.module.scss","gui/Components/Sidebar/AlertCounter.module.scss","gui/Components/Sidebar/LogoSection.module.scss","gui/Components/Sidebar/SidebarSection.module.scss","gui/Components/Sidebar/SidebarSectionDivider.module.scss","gui/Components/MainMenu/MainMenuUL.module.scss","gui/Components/MainMenu/MainMenuLI.module.scss","gui/Components/Sidebar/SidebarSectionBody.module.scss","gui/connections/MenuComponents/EditButton.module.scss","gui/connections/CSidebar.module.scss","gui/Components/ScreenHeader/ScreenHeaderAction.module.scss","gui/Components/ScreenHeader/ScreenHeaderPusher.module.scss","gui/Components/ScreenHeader/ScreenHeaderDivider.module.scss","gui/Components/Screen/ScreenContainer.module.scss","gui/Components/ScreenElements/Label.module.css","gui/Components/ScreenElements/VBox.module.scss","gui/Components/ScreenElements/HBox.module.scss","gui/Components/TabbedView/TabbedViewPanel.module.scss","gui/Components/TabbedView/TabbedView.module.scss","gui/Components/TabbedView/TabbedViewPanelsContainer.module.scss","gui/Components/ScreenElements/Box.module.css","gui/Components/Screen/Screen.module.scss","gui/Components/Fullscreen/Fullscreen.module.scss","gui/connections/MobileComponents/MobileMain.module.scss","gui/connections/MobileComponents/TopToolBar/TopToolBar.module.scss","gui/connections/MobileComponents/TopToolBar/SearchButton.module.scss","gui/connections/MobileComponents/Search.module.scss","gui/connections/MobileComponents/MobileAboutView.module.scss","gui/connections/MobileComponents/ScreenHeader.module.scss","gui/connections/MobileComponents/mobile.module.scss","gui/Components/Dialog/DialogStack.module.scss","gui/connections/MobileComponents/Grid/ColumnConfiguration.module.scss","gui/Components/ScreenElements/Editors/TextEditor.module.scss","gui/Components/Dialogs/DialogsCommon.module.css","gui/Components/Dialogs/FavoriteFolderPropertiesDialog.module.scss","gui/Components/UserMenuDropdown/UserMenuDropdown.module.scss","gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/FilterSettingsCommon.module.scss","gui/Components/ScreenElements/Editors/DateTimeEditor/CalendarWidget.module.scss","gui/Components/Dialogs/SaveFilterDialog.module.css","gui/connections/MobileComponents/Form/MobileDateTimeEditor.module.scss","model/selectors/getApplication.ts","model/selectors/getApi.ts","oauth.ts","gui/Components/MainBar/MainBar.tsx","gui/Components/ScreenTabsArea/ScreenTabsArea.tsx","gui/Components/Splitter/Splitter.tsx","gui/Components/WorkbenchPage/WorkbenchPage.tsx","model/selectors/getWorkbench.ts","gui/Components/TabbedView/TabbedViewHandle.tsx","gui/Components/TabbedView/TabbedViewHandleRow.tsx","model/selectors/getWorkbenchLifecycle.ts","model/selectors/getOpenedScreen.ts","model/entities/types/IOpenedScreen.ts","model/selectors/FormScreen/getFormScreen.ts","model/entities/types/IFormScreen.ts","model/selectors/FormScreen/getFormScreenLifecycle.ts","model/actions/FormScreen/reloadScreen.ts","model/entities/types/IDataView.ts","model/selectors/DataView/getDataView.ts","model/selectors-tree/selectionCheckboxes.ts","model/entities/types/IProperty.ts","model/selectors/DataView/getProperty.ts","model/selectors/MainMenu/getMainMenuEnvelope.ts","model/selectors/MainMenu/getMainMenu.ts","model/selectors-tree/mainMenu.ts","utils/cookies.ts","model/selectors-tree/index.ts","model/selectors-tree/column.ts","model/selectors-tree/error.ts","model/selectors/WorkQueues/getWorkQueues.ts","model/actions/WorkQueues/stopWorkQueues.ts","model/selectors/getApplicationLifecycle.ts","model/actions/User/performLogout.ts","utils/translation.tsx","model/actions/handleError.tsx","model/selectors/isMobileLayoutActive.ts","gui/Components/Dialog/ModalDialog.tsx","model/actions/SelectionDialog/types.ts","gui/Components/Dialogs/QuestionSaveData.tsx","model/selectors/TablePanelView/getTablePanelView.ts","utils/EventHandler.ts","model/entities/types/IAction.ts","model/entities/OpenedScreen.ts","model/selectors/Actions/getAction.ts","model/actions-tree/formScreen.ts","model/entities/types/IUrlOpenMethod.ts","model/actions-tree/index.ts","model/actions/Workbench/openNewUrl.ts","model/selectors/DataView/getDataViewsByEntity.ts","model/selectors/DataSources/getDataSourceByEntity.ts","model/actions/RowStates/putRowStateValue.ts","model/selectors/RowState/getRowStatesByEntity.ts","model/selectors/FormScreen/getDataViewList.ts","model/selectors/DataView/getIsBindingRoot.ts","model/selectors/DataSources/getDataSources.ts","model/selectors/FormScreen/getDataViewCache.ts","model/actions/DataLoading/processCRUDResult.ts","model/selectors/MainMenu/getMainMenuItemById.ts","model/actions/Actions/processActionResult.ts","model/selectors/DataView/getDataViewByModelInstanceId.ts","model/selectors/Actions/getActionCaption.ts","model/selectors/getSearcher.ts","model/actions/WorkQueues/refreshWorkQueues.ts","model/selectors/DataSources/getDataSource.ts","model/entities/types/IDataSource.ts","model/selectors/DataView/getColumnNamesToLoad.ts","model/selectors/DataSources/getDataSourceFields.ts","model/selectors/DataView/getDataStructureEntityId.ts","model/selectors/DataView/getGridId.ts","model/selectors/DataView/getDataViewByGridId.ts","model/selectors/FormScreen/getisFormScreenDirty.ts","model/selectors/FormScreen/getIsSuppressSave.ts","model/selectors/getMobileState.ts","model/selectors/getOpenedScreens.ts","model/selectors/getOpenedNonDialogScreenItems.ts","model/selectors/getActiveScreen.ts","model/entities/MobileState/MobileLayoutState.ts","model/entities/types/IMainMenu.ts","utils/runInFlowWithHandler.ts","model/selectors/getDialogStack.ts","model/selectors/getIsActiveScreen.ts","utils/objects.ts","model/selectors/DataView/getDataViewLifecycle.ts","model/actions/DataView/navigateAsChild.ts","model/selectors/DataView/getBindingChildren.ts","model/selectors/DataView/getEntity.ts","model/selectors/DataView/getMasterRowId.ts","model/selectors/DataView/getBindingRoot.ts","model/selectors/TablePanelView/getSelectedRowId.ts","model/selectors/DataView/getBindingParents.ts","model/selectors/DataView/getBindingParent.ts","model/selectors/DataView/getParentRowId.ts","model/selectors/isLazyLoading.ts","model/selectors/getSessionId.ts","model/selectors/getMenuItemId.ts","model/entities/types/IOrderingConfiguration.ts","model/entities/OrigamApiHelpers.ts","model/selectors/DataView/getFilterConfiguration.ts","model/selectors/DataView/getUserFilters.ts","model/selectors/DataView/getOrderingConfiguration.ts","model/selectors/DataView/getUserOrdering.ts","utils/arrays.ts","model/selectors/DataView/getDataTable.ts","model/selectors/DataView/getGrouper.ts","gui/Workbench/ScreenArea/TableView/VisibleRowsMonitor.ts","model/selectors/DataView/getUserFilterLookups.ts","gui/Workbench/ScreenArea/TableView/InfiniteScrollLoader.ts","model/entities/RowState.ts","utils/flow.ts","model/entities/DataViewLifecycle/DataViewLifecycle.ts","model/selectors/DataView/getIsBindingParent.ts","model/entities/LookupLoader.ts","utils/flashColorFormat.ts","model/selectors/RowState/getRowStates.ts","model/selectors/RowState/getRowStateById.ts","model/selectors/RowState/getRowStateIsDisabledAction.ts","model/entities/Action.ts","model/entities/ActionParameter.ts","model/entities/ComponentBinding.ts","model/entities/DataSource.ts","model/entities/DataSourceField.ts","model/entities/AdditionalRowData.ts","model/selectors/isInfiniteScrollingActive.ts","utils/dataRow.ts","model/entities/ScrollRowContainer.ts","model/selectors/DataView/getDataViewPropertyById.ts","model/entities/ListRowContainer.ts","model/entities/NumberFormating.ts","model/entities/DataTable.ts","model/entities/types/IPanelViewType.ts","model/selectors/getRowContainer.ts","model/selectors/DataSources/getDataSourceFieldByIndex.ts","model/selectors/DataView/getSelectedRow.ts","model/selectors/getIsDialog.ts","model/selectors/DataSources/getDataSourceFieldByName.ts","model/selectors/RowState/getRowStateMayCauseFlicker.ts","model/selectors/TablePanelView/getTableViewProperties.ts","model/selectors/DataView/getIsSelectionCheckboxesShown.ts","model/selectors/TablePanelView/getGroupingConfiguration.ts","gui/Components/ScreenElements/Table/TableRendering/tableRows.ts","model/selectors/TablePanelView/getLeadingColumnCount.tsx","gui/Workbench/ScreenArea/TableView/GridDimensions.ts","gui/Components/ScreenElements/Table/SimpleScrollState.ts","gui/Components/Search/ResultItem.tsx","gui/Components/Search/ResultGroup.tsx","model/selectors/MainMenu/getMainMenuState.ts","gui/Components/Search/SearchView.tsx","gui/Components/Dialogs/SearchDialog.tsx","model/actions-ui/ScreenToolbar/openSearchWindow.tsx","model/entities/TabIndexOwner.ts","model/entities/FormFocusManager.ts","model/selectors/DataView/getSelectionMember.ts","model/selectors/DataView/getPropertyOrdering.ts","model/selectors/DataSources/getDataSourceFieldIndexByName.ts","model/actions-ui/MainMenu/onMainMenuItemClick.ts","model/selectors/RecordInfo/getRecordInfo.ts","model/actions-ui/onSelectedRowChange.ts","model/selectors/TablePanelView/getConfigurationManager.ts","model/entities/GridFocusManager.ts","model/entities/DataView.ts","model/selectors/DataView/getLookupLoader.ts","model/selectors/DataView/getParentRow.ts","model/selectors/DataView/getBindingToParent.ts","model/entities/DropDownColumn.ts","utils/string.ts","model/selectors/PortalSettings/getStringFilterConfig.ts","model/entities/FilterConfiguration.ts","model/entities/FormPanelView/FormPanelView.ts","utils/sync.ts","utils/image.ts","utils/values.ts","model/entities/ScreenPictureCache.ts","model/entities/types/ILookup.ts","model/entities/DataViewCache.ts","model/entities/FormScreen.ts","model/entities/Lookup.ts","model/selectors/DataView/getProperties.ts","model/entities/OrderingConfiguration.ts","model/entities/types/IPropertyColumn.ts","model/entities/Property.ts","model/selectors/DialogStack/getDialogStack.ts","model/entities/types/GroupingUnit.ts","model/entities/types/AggregationType.ts","gui/Components/Dialogs/NewConfigurationDialog.tsx","model/selectors/DataView/getActivePanelView.ts","model/actions/DataView/TableView/saveColumnConfigurations.ts","model/entities/TablePanelView/ColumnConfigurationModel.tsx","model/actions-ui/DataView/TableView/onFieldChange.ts","model/selectors/DataView/getSelectedRowIndex.ts","model/selectors/TablePanelView/getCellValue.ts","model/selectors/TablePanelView/getSelectedColumnId.ts","model/selectors/TablePanelView/getSelectedColumnIndex.ts","model/actions/DataView/TableView/flushCurrentRowData.ts","model/selectors/RowState/getRowStateAllowUpdate.ts","model/selectors/RowState/isReadOnly.ts","gui/Components/Dialogs/ChangeMasterRecordDialog.tsx","model/selectors/DataView/getFieldErrorMessage.ts","model/selectors/DataView/getSelectedRowErrorMessages.ts","model/entities/FormScreenLifecycle/questionSaveDataAfterRecordChange.tsx","model/actions/Actions/processActionQueryInfo.tsx","model/entities/TablePanelView/TablePanelView.tsx","utils/common.ts","xmlInterpreters/xmlUtils.ts","model/entities/GroupingConfiguration.ts","gui/Components/ScreenElements/Table/TableRendering/GroupItem.ts","model/entities/Aggregatioins.ts","model/entities/GrouperCommon.ts","model/entities/DateGroupData.ts","dic/Container.ts","model/entities/ServerSideGrouper.ts","model/entities/ClientSideGrouper.ts","modules/DataView/DataViewUI.tsx","modules/DataView/DataViewTypes.ts","gui/Components/Dropdowner/Dropdowner.tsx","gui/Components/DataViewHeader/DataViewHeader.tsx","gui/Components/DataViewHeader/DataViewHeaderButton.tsx","model/selectors/Actions/getIsEnabledAction.ts","gui/Components/Dropdown/Dropdown.tsx","gui/Components/Dropdown/DropdownItem.tsx","gui/Components/DataViewHeader/DataViewHeaderDropDownItem.tsx","model/actions/actionSync.ts","model/actions-ui-tree/index.ts","model/actions-ui-tree/actions.ts","model/actions-ui-tree/workflow.ts","gui/Components/DataViewHeader/DataViewHeaderButtonGroup.tsx","gui/Components/DataViewHeader/DataViewHeaderGroup.tsx","gui/Components/Dialogs/SaveFilterDialog.tsx","gui/connections/FilterDropDown.tsx","model/selectors/DataView/getFilterGroupManager.ts","model/actions-ui/DataView/getIsRowMovingDisabled.ts","model/selectors/getColumnConfigurationModel.ts","model/actions-ui/DataView/TableView/shouldProceedToChangeRow.ts","gui/Components/ScreenElements/Table/TableRendering/common/ValueBox.ts","gui/Components/ScreenElements/Table/TableRendering/common/Memoized.ts","gui/Components/ScreenElements/Table/TableRendering/renderingValues.ts","model/selectors/RowState/getRowStateAllowRead.ts","model/selectors/RowState/getRowStateForegroundColor.ts","model/selectors/RowState/getRowStateRowBgColor.ts","utils/canvas.ts","utils/colorUtils.ts","gui/Components/ScreenElements/Table/TableRendering/onClick.ts","gui/Components/ScreenElements/Table/TableRendering/DebugTableMonitor.ts","gui/Components/ScreenElements/Table/TableRendering/cells/cellAlignment.ts","gui/Components/ScreenElements/Table/TableRendering/cells/dataCellRenderer.ts","gui/Components/ScreenElements/Table/TableRendering/cells/dataCell.ts","model/selectors/Workbench/getShowToolTipsForMemoFieldsOnly.ts","model/actions-tree/selectionCheckboxes.ts","gui/Components/ScreenElements/Table/TableRendering/cells/selectionCheckboxCell.ts","gui/Components/ScreenElements/Table/TableRendering/cells/aggregationCell.ts","gui/Components/ScreenElements/Table/TableRendering/rowCells/groupRowCells.ts","model/actions-ui/DataView/TableView/onGroupHeaderToggleClick.ts","gui/Components/ScreenElements/Table/TableRendering/cells/groupCell.ts","gui/Components/ScreenElements/Table/TableRendering/rowCells/dataRowCells.ts","gui/Components/ScreenElements/Table/TableRendering/currentCellLayerIndex.ts","gui/Components/ScreenElements/Table/TableRendering/currentRowCells.ts","gui/Components/ScreenElements/Table/TableRendering/currentCell.ts","gui/Components/ScreenElements/Table/TableRendering/cells/cellsCommon.ts","gui/Components/Dialogs/ColumnsDialog.tsx","model/actions-ui/DataView/onCopyRowClick.ts","model/actions-ui/DataView/onCreateRowClick.ts","model/actions-ui/DataView/onDeleteRowClick.ts","model/actions-ui/DataView/onExportToExcelClick.ts","model/actions-ui/DataView/onMoveRowDownClick.ts","model/actions-ui/DataView/onMoveRowUpClick.ts","model/actions/DataView/selectNextRow.ts","model/actions-ui/DataView/onNextRowClick.ts","model/actions/DataView/selectPrevRow.ts","model/actions-ui/DataView/onPrevRowClick.ts","model/actions-ui/RecordInfo/onRecordInfoClick.ts","model/selectors/DataView/getDataViewLabel.ts","modules/DataView/ViewConfiguration.ts","model/selectors/DataView/getActivePerspective.ts","model/selectors/DataView/getIsAddButtonVisible.ts","model/selectors/RowState/getRelationState.ts","model/selectors/DataView/getIsCopyButtonVisible.ts","model/selectors/DataView/getIsDelButtonVisible.ts","model/selectors/DataView/getIsMoveRowMenuVisible.ts","model/selectors/DataView/getPanelViewActions.ts","model/selectors/DataView/getTotalGroupRowCount.ts","model/selectors/TablePanelView/getIsFilterControlsDisplayed.ts","model/actions/DataView/selectFirstRow.ts","model/actions/DataView/selectLastRow.ts","model/selectors/DataView/getPanelMenuActions.ts","gui/Components/Dropdown/DropdownDivider.tsx","model/selectors/DataView/getAreCrudButtonsEnabled.ts","gui/connections/CDataViewHeader.tsx","model/actions-ui/DataView/onColumnConfigurationClick.tsx","model/actions-ui/DataView/onFilterButtonClick.ts","model/actions-ui/DataView/onFirstRowClick.ts","model/actions-ui/DataView/onLastRowClick.ts","model/selectors/DataView/getTrueSelectedRowIndex.ts","model/selectors/DataView/getExpandedGroupRowCount.ts","model/selectors/DataView/getIsDataViewWorking.ts","model/selectors/FormScreen/getIsFormScreenWorking.ts","model/selectors/DataView/getDataViewById.ts","gui/Components/ScreenElements/DataViewLoading.tsx","model/entities/TreeDataTable.ts","gui/Components/ScreenElements/TreeView.tsx","utils/events.ts","gui/Components/ScreenElements/Table/FilterSettings/FilterSettingsComboBox.tsx","gui/Components/CheckBox/Checkbox.tsx","gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/FilterSetting.tsx","gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/Operator.tsx","gui/connections/MobileComponents/Form/MobileBooleanInput.tsx","gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/FilterSettingsBoolean.tsx","gui/connections/MobileComponents/Grid/InputClearButton.tsx","gui/connections/MobileComponents/Grid/ClearableInput.tsx","gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/FilterSettingsString.tsx","gui/Components/ScreenElements/Editors/DateTimeEditor/CalendarWidget.tsx","gui/Components/ScreenElements/Editors/DateCompleter.tsx","gui/Components/ScreenElements/Editors/DateTimeEditor/DateEditorModel.ts","gui/Components/ScreenElements/Editors/DateTimeEditor/DateTimeEditor.tsx","gui/connections/MobileComponents/Form/MobileDateTimeEditor.tsx","gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/FilterSettingsDate.tsx","gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/FilterSettingsNumber.tsx","modules/Editors/DropdownEditor/DropdownEditorCommon.tsx","modules/Editors/DropdownEditor/DropdownTableModel.ts","modules/Editors/DropdownEditor/DropdownEditorLookupListCache.ts","modules/Editors/DropdownEditor/DropdownEditorBehavior.tsx","gui/connections/MobileComponents/Form/ComboBox/MobileDropdownBehavior.tsx","modules/Editors/DropdownEditor/Cells/HeaderCell.tsx","modules/Editors/DropdownEditor/Cells/CellsCommon.tsx","modules/Editors/DropdownEditor/Cells/TextCellDriver.tsx","xmlInterpreters/getMomentFormat.ts","modules/Editors/DropdownEditor/Cells/NumberCellDriver.tsx","modules/Editors/DropdownEditor/Cells/BooleanCellDriver.tsx","modules/Editors/DropdownEditor/Cells/DateCellDriver.tsx","modules/Editors/DropdownEditor/DropdownEditorSetup.tsx","modules/Editors/DropdownEditor/DropdownEditorApi.tsx","modules/Editors/DropdownEditor/DropdownEditorInput.tsx","modules/Editors/DropdownEditor/DropdownEditorControl.tsx","modules/Editors/DropdownEditor/DropdownEditorData.tsx","utils/textMeasurement.ts","modules/Editors/DropdownEditor/TagInputEditorData.tsx","modules/Editors/DropdownEditor/DropdownEditor.tsx","modules/Editors/DropdownEditor/DropdownEditorBody.tsx","gui/connections/MobileComponents/Form/ComboBox/MobileDropdownEditorInput.tsx","gui/connections/MobileComponents/Form/ComboBox/ComboFullScreenEditor.tsx","gui/Components/TagInput/TagInput.tsx","gui/Components/ScreenElements/Editors/TagInputEditor.tsx","gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/TagLookupFilterEditor.tsx","gui/connections/MobileComponents/Form/ComboBox/MobileTagInputEditor.tsx","gui/connections/MobileComponents/Grid/MobileTagLookupFilterEditor.tsx","gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/FilterSettingsLookup.tsx","model/entities/getAllLookupIds.tsx","gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/TagFilterEditor.tsx","gui/connections/MobileComponents/Grid/MobileTagFilterEditor.tsx","gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/FilterSettingsTagInput.tsx","gui/Components/ScreenElements/Table/FilterSettings/FilterSettings.tsx","model/selectors/DataView/getFilterSettingByProperty.ts","model/actions-ui/DataView/TableView/onApplyFilterSetting.ts","gui/connections/MobileComponents/Grid/FilterEditor.tsx","model/actions-ui/DataView/TableView/onColumnOrderChangeFinished.ts","gui/connections/MobileComponents/Grid/ColumnOrderEditor.tsx","gui/connections/MobileComponents/BottomToolBar/BottomIcon.tsx","gui/connections/MobileComponents/Navigation/NavigationButton.tsx","gui/connections/MobileComponents/Grid/ColumnConfiguration.tsx","gui/Components/SidebarInfoSection/SidebarRecordInfo.tsx","gui/connections/MobileComponents/Grid/RecordInfo.tsx","gui/connections/MobileComponents/Grid/DataViewHeader.tsx","gui/Components/ScreenElements/DataView.tsx","model/selectors/DataView/getIsDataViewOrFormScreenWorking.1.ts","model/selectors/DataView/getIsDataViewOrFormScreenWorking.ts","gui/Components/DataViewHeader/DataViewHeaderAction.tsx","modules/DataView/Perspective/Perspective.ts","modules/DataView/Perspective/MapPerspective/stores/MapObjectsStore.ts","modules/DataView/Perspective/MapPerspective/MapPerspective.ts","modules/DataView/Perspective/MapPerspective/MapPerspectiveUI.tsx","modules/DataView/Perspective/MapPerspective/stores/MapNavigationStore.ts","modules/DataView/Perspective/MapPerspective/stores/MapRoutefinderStore.ts","modules/DataView/Perspective/MapPerspective/stores/MapSearchStore.ts","modules/DataView/Perspective/MapPerspective/stores/MapSetupStore.ts","modules/DataView/Perspective/MapPerspective/stores/MapRootStore.ts","modules/DataView/Perspective/MapPerspective/MapPerspectiveSearch.tsx","modules/DataView/Perspective/MapPerspective/MapPerspectiveDirector.tsx","modules/DataView/Perspective/MapPerspective/MapPerspectiveModule.tsx","modules/DataView/Perspective/FormPerspective/FormPerspective.ts","gui/Workbench/ScreenArea/FormView/FormView.tsx","gui/Workbench/ScreenArea/FormView/FormRoot.tsx","model/selectors/RowState/getRowStateNameOverride.ts","gui/Components/ToolTip/FormatTooltipText.tsx","gui/Components/ScreenElements/Editors/BlobEditor.tsx","gui/Components/ScreenElements/Editors/CheckList.tsx","gui/Components/ScreenElements/Editors/ImageEditor.tsx","gui/Components/ScreenElements/Editors/NumberEditor.tsx","gui/Components/ScreenElements/Editors/TextEditor.tsx","model/actions-ui/DataView/TableView/onFieldBlur.ts","gui/Components/ScreenElements/Editors/BoolEditor.tsx","gui/Components/ScreenElements/Editors/ColorEditor.tsx","gui/Workbench/ScreenArea/FormView/FormViewEditor.tsx","gui/Components/Form/FormField.tsx","model/actions-ui/DataView/OnTextFieldAutoUpdate.tsx","model/actions/DropdownEditor/onDropdownEditorClick.ts","gui/Components/Form/FormSectionHeader.tsx","gui/Components/Form/FormSection.tsx","gui/Components/Form/FormLabel.tsx","gui/Components/Form/RadioButton.tsx","gui/Components/Form/CheckBox.tsx","gui/contexts/GUIContexts.ts","gui/Components/Form/FieldDimensions.tsx","gui/Workbench/ScreenArea/FormView/FormBuilder.tsx","gui/connections/MobileComponents/Form/ComboBox/ComboBox.tsx","model/actions/DropdownEditor/onMobileLinkClick.ts","gui/connections/MobileComponents/Form/MobileFormViewEditor.tsx","gui/connections/MobileComponents/Form/MobileFormField.tsx","gui/connections/MobileComponents/Form/MobileFormSection.tsx","gui/connections/MobileComponents/Form/CheckBox.tsx","gui/connections/MobileComponents/Form/MobileFormBuilder.tsx","modules/DataView/Perspective/FormPerspective/FormPerspectiveDirector.tsx","modules/DataView/Perspective/FormPerspective/FormPerspectiveModule.ts","modules/DataView/Perspective/TablePerspective/TablePerspective.ts","model/actions/DataView/TableView/selectPrevColumn.ts","model/actions/DataView/TableView/selectNextColumn.ts","model/actions-ui/DataView/TableView/onColumnHeaderClick.ts","gui/Components/ScreenElements/Table/Header.tsx","gui/Components/ScreenElements/Table/Canvas.tsx","gui/Components/ScreenElements/Table/HeaderRow.tsx","gui/Components/ScreenElements/Table/PositionedField.tsx","gui/Components/ScreenElements/Table/Scrollee.tsx","gui/Components/ScreenElements/Table/Scroller.tsx","gui/Components/ScreenElements/Table/TableRendering/drawableRowIndex.ts","gui/Components/ScreenElements/Table/TableRendering/drawableColumnIndex.ts","gui/Components/ScreenElements/Table/TableRendering/renderTable.ts","gui/Components/ScreenElements/Table/Table.tsx","gui/Workbench/ScreenArea/TableView/TableViewEditor.tsx","model/selectors/TablePanelView/getSelectedProperty.ts","model/actions-ui/DataView/TableView/onFieldKeyDown.ts","model/actions-ui/DataView/TableView/onNoCellClick.ts","model/actions-ui/DataView/TableView/onOutsideTableClick.ts","model/actions-tree/setAllSelectionStates.ts","gui/Components/ScreenElements/Table/SelectionCheckBoxHeader.tsx","gui/Workbench/ScreenArea/TableView/TableView.tsx","model/actions-ui/DataView/TableView/onTableKeyDown.ts","model/selectors/TablePanelView/getFixedColumnsCount.ts","model/selectors/TablePanelView/getColumnHeaders.ts","model/actions-ui/DataView/TableView/onColumnWidthChanged.ts","model/selectors/TablePanelView/getIsEditing.ts","model/actions-ui/DataView/TableView/onColumnWidthChangeFinished.ts","modules/DataView/Perspective/TablePerspective/TablePerspectiveDirector.tsx","modules/DataView/Perspective/TablePerspective/TablePerspectiveModule.ts","modules/DataView/DataViewModule.tsx","modules/DataView/Perspective/PerspectiveModule.ts","modules/Lookup/Clock.ts","modules/Lookup/LookupApi.ts","modules/Lookup/LookupCacheDependencies.ts","modules/Lookup/LookupCacheIndividual.ts","modules/Lookup/LookupCacheMulti.ts","modules/Lookup/LookupCleanerLoader.ts","modules/Lookup/common.ts","modules/Lookup/LookupLoaderIndividual.ts","modules/Lookup/LookupLoaderMulti.ts","modules/Lookup/LookupResolver.ts","modules/Lookup/LookupScopeRegistry.ts","modules/Lookup/LookupModule.ts","modules/Screen/FormScreen/ScreenEvents.ts","modules/Screen/FormScreen/FormScreenModule.ts","modules/Screen/ScreenModule.ts","rootContainer.ts","registerModules.ts","model/entities/TablePanelView/layout.ts","model/entities/OrigamAPI.ts","modules/DataView/DataViewAPI.ts","modules/DataView/TableCursor.ts","modules/DataView/DataViewData.ts","modules/Screen/ScreenAPI.ts","xmlInterpreters/filterXml.ts","model/entities/FilterGroupManager.ts","model/entities/TablePanelView/tableColumnConfiguration.ts","model/entities/TablePanelView/tableConfiguration.ts","model/entities/TablePanelView/configurationManager.ts","model/entities/TablePanelView/mainConfigurationManager.ts","xmlInterpreters/createConfigurationManager.ts","xmlInterpreters/screenXml.ts","model/actions/DataView/startEditingFirstCell.ts","model/selectors/DataView/getFormFocusManager.ts","model/selectors/DataView/getAllBindingChildren.ts","model/entities/FormScreenLifecycle/UpdateRequestAggregator.tsx","gui/Components/Dialog/DialogUtils.tsx","plugins/tools/PluginData.ts","plugins/tools/Localizer.ts","plugins/tools/PluginLibrary.tsx","plugins/tools/PluginRegistration.ts","model/entities/FormScreenLifecycle/FormScreenLifecycle.tsx","model/actions/RowStates/refreshRowStates.ts","model/selectors/FormScreen/getAutorefreshPeriod.ts","model/selectors/DataView/getBindingParametersFromParent.ts","model/factories/createFormScreenEnvelope.ts","model/factories/createOpenedScreen.ts","xmlInterpreters/menuXml.ts","model/entities/MainMenu.ts","model/entities/WorkbenchLifecycle/WorkbenchLifecycle.ts","utils/esproxy.ts","model/entities/WebScreen.ts","model/actions-ui/ScreenHeader/onWorkflowNextClick.ts","model/selectors/Chatrooms/getChatrooms.ts","model/selectors/Chatrooms/getNotifications.ts","model/selectors/MainMenu/getFavorites.ts","utils/debugHelpers.ts","model/actions-ui/ScreenToolbar/onRefreshSessionClick.ts","model/actions/closeForm.ts","model/actions-ui/ScreenTabHandleRow/onScreenTabCloseClick.ts","gui/Components/Utilities/ErrorBoundary.tsx","model/actions-ui/ScreenTabHandleRow/onScreenTabHandleClick.ts","gui/connections/CScreenTabbedViewHandleRow.tsx","gui/Components/ScreenToolbar/ScreenToolbar.tsx","gui/Components/ScreenToolbar/ScreenToolbarAction.tsx","gui/Components/ScreenToolbar/ScreenToolbarPusher.tsx","model/actions-ui/ScreenToolbar/onScreenToolbarLogoutClick.ts","gui/Components/ScreenToolbar/ScreenToolbarActionGroup.tsx","model/actions-ui/ScreenToolbar/onSaveSessionClick.ts","model/selectors/getActiveScreenActions.ts","gui/Components/UserMenuDropdown/UserMenuBlock.tsx","gui/Components/UserMenuDropdown/UserMenuDropdown.tsx","model/selectors/User/getLoggedUserName.ts","model/entities/types/IWebScreen.ts","model/selectors/WebScreen/getWebScreen.ts","model/selectors/User/getUserAvatarLink.ts","model/selectors/User/getCustomAssetsRoute.ts","model/selectors/User/getHelpUrl.ts","model/selectors/getAbout.ts","gui/Components/Dialogs/AboutView.tsx","gui/Components/Dialogs/AboutDialog.tsx","model/selectors/FormScreen/getIsSuppressRefresh.ts","model/actions-ui/ScreenToolbar/saveBottonVisible.ts","gui/connections/CScreenToolbar.tsx","model/actions-ui/ScreenToolbar/onReloadWebScreen.ts","gui/Components/Sidebar/AlertCounter.tsx","gui/Components/Sidebar/LogoSection.tsx","gui/Components/Sidebar/Sidebar.tsx","gui/Components/Sidebar/SidebarSection.tsx","gui/Components/Sidebar/SidebarSectionDivider.tsx","gui/Components/Sidebar/SidebarSectionHeader.tsx","gui/Components/MainMenu/MainMenuUL.tsx","gui/Components/MainMenu/MainMenuLI.tsx","gui/Components/MainMenu/MainMenuItem.tsx","model/selectors/MainMenu/getIsMainMenuLoading.ts","gui/Components/Dialogs/ChooseFavoriteFolderDialog.tsx","gui/Workbench/MainMenu/IMenuItemIcon.tsx","gui/getIconUrl.ts","model/actions-ui/MainMenu/onResetColumnConfigClick.ts","gui/Components/Sidebar/SidebarSectionBody.tsx","gui/connections/MenuComponents/EditButton.tsx","gui/connections/CMainMenu.tsx","model/selectors/WorkQueues/getWorkQueuesTotalItemCount.ts","gui/Components/WorkQueues/WorkQueuesItem.tsx","model/actions-ui/WorkQueues/onWorkQueuesListItemClick.ts","gui/connections/CWorkQueues.tsx","gui/connections/types.ts","model/selectors/WorkQueues/getWorkQueuesItems.ts","gui/Components/SidebarInfoSection/SidebarRecordAudit.tsx","gui/connections/CSidebarInfoSection.tsx","model/actions/Chatrooms/onChatroomsListItemClick.ts","gui/connections/CChatSection.tsx","gui/Components/Search/SearchResults.tsx","model/entities/types/ISearchResult.ts","gui/Components/Dialogs/FavoriteFolderPropertiesDialog.tsx","gui/connections/MenuComponents/PinButton.tsx","gui/connections/CFavorites.tsx","gui/connections/CSidebar.tsx","model/actions-ui/RecordInfo/addRecordInfoExpandRequestHandler.ts","model/actions-ui/RecordInfo/addRecordAuditExpandRequestHandler.ts","model/selectors/PortalSettings/getShowChat.ts","model/selectors/PortalSettings/getShowWorkQues.ts","model/selectors/getLogoUrl.ts","gui/Components/ScreenHeader/ScreenHeader.tsx","gui/Components/ScreenHeader/ScreenHeaderAction.tsx","gui/Components/ScreenHeader/ScreenHeaderPusher.tsx","model/selectors/Workbench/getIsCurrentScreenFull.ts","model/selectors/FormScreen/getIsScreenOrAnyDataViewWorking.ts","gui/Components/ScreenHeader/ScreenHeaderDivider.tsx","model/actions-ui/ScreenHeader/onWorkflowAbortClick.ts","gui/connections/CScreenHeader.tsx","model/actions-ui/ScreenHeader/onFullscreenClick.ts","gui/Components/Screen/ScreenContainer.tsx","gui/Components/WorkflowFinishedPanel/WorkflowFinishedPanel.tsx","model/actions-ui/Splitter/splitterPositionToServerValue.ts","model/actions/FormScreen/saveSplitPanelConfiguration.ts","model/actions-ui/Splitter/onSplitterPositionChangeFinished.ts","gui/Components/ScreenElements/Label.tsx","gui/Components/ScreenElements/VBox.tsx","gui/Components/ScreenElements/HBox.tsx","gui/Components/TabbedView/TabbedViewPanel.tsx","gui/Components/TabbedView/TabbedView.tsx","gui/Components/TabbedView/TabbedViewPanelsContainer.tsx","gui/connections/CScreenSectionTabbedView.tsx","gui/Components/ScreenElements/Box.tsx","gui/Workbench/ScreenArea/FormScreenBuilder/desktopRecursiveBuilder.tsx","gui/connections/MobileComponents/Navigation/BreadCrumbs.tsx","gui/connections/MobileComponents/Navigation/NavigationNode.tsx","gui/Workbench/ScreenArea/FormScreenBuilder/mobileRecursiveBuilder.ts","gui/connections/MobileComponents/Navigation/DetailNavigator.tsx","gui/connections/MobileComponents/Navigation/TabNavigator.tsx","gui/Workbench/ScreenArea/FormScreenBuilder/ComponentFactory.tsx","gui/Workbench/ScreenArea/FormScreenBuilder/FormScreenBuilder.tsx","gui/Components/Screen/Screen.tsx","gui/Components/WebScreen/WebScreen.tsx","model/selectors/getIsTopmostNonDialogScreen.ts","model/selectors/getTopmostNonDialogScreenItem.ts","model/actions/Workbench/openScreenByReference.ts","model/actions/Global/executeWeblink.ts","model/actions/Global/onRootElementClick.ts","gui/connections/CScreen.tsx","model/actions/WebScreen/onIFrameClick.ts","gui/connections/CScreenContent.tsx","model/actions-ui/SelectionDialog/onSelectionDialogActionButtonClick.ts","gui/Workbench/ScreenArea/ScreenBuilder.tsx","gui/Workbench/ScreenArea/ScreenArea.tsx","gui/connections/CDialogContent.tsx","model/selectors/getOpenedDialogScreenItems.ts","gui/Components/Fullscreen/Fullscreen.tsx","gui/connections/MobileComponents/TopToolBar/TabSelector.tsx","gui/connections/MobileComponents/TopToolBar/SearchButton.tsx","gui/connections/MobileComponents/MenuButton.tsx","gui/connections/MobileComponents/TopToolBar/TopToolBar.tsx","gui/connections/MobileComponents/Search.tsx","gui/connections/MobileComponents/BottomToolBar/ActionDropUp.tsx","gui/connections/MobileComponents/BottomToolBar/BottomToolBar.tsx","gui/connections/MobileComponents/MobileAboutView.tsx","gui/connections/MobileComponents/ScreenHeader.tsx","gui/connections/MobileComponents/MobileMain.tsx","gui/connections/MobileComponents/MobileStyleSheetLoader.tsx","gui/connections/pages/CWorkbenchPage.tsx","gui/Components/Dialog/DialogStack.tsx","gui/connections/CMain.tsx","Root.tsx","model/entities/ErrorDialog.tsx","model/entities/MobileState/BreadCrumbsState.ts","model/entities/MobileState/MobileState.ts","model/entities/Application.ts","model/entities/Workbench.ts","model/actions/Workbench/openScreenByReferenceAndLookup.ts","model/selectors/MainMenu/menuNode.ts","model/selectors/MainMenu/getMainMenuUI.ts","model/entities/Searcher.ts","model/actions/Workbench/onSearchResultClick.ts","model/entities/OpenedScreens.ts","utils/PeriodicLoader.ts","model/entities/WorkQueues.ts","model/actions-ui/WorkQueues/onRefreshWorkQueues.ts","model/entities/RecordInfo.ts","modules/Lookup/LookupListCacheMulti.ts","model/entities/Chatrooms.ts","model/actions/Chatrooms/onRefreshChatrooms.ts","model/entities/Notifications.ts","model/actions/Notifications/GetNotificationBoxContent.ts","model/entities/Favorites.ts","model/entities/SidebarState.ts","model/actions-ui/RecordInfo/onSidebarInfoSectionCollapsed.ts","model/actions-ui/RecordInfo/onSidebarInfoSectionExpanded.ts","model/actions-ui/RecordInfo/onSidebarAuditSectionExpanded.ts","model/entities/AboutInfo.ts","model/factories/createWorkbench.ts","modules/Workbench/WorkbenchModule.ts","model/actions/FormScreen/stopAutoreload.ts","model/actions/Workbench/stopAllFormsAutorefresh.ts","gui/Components/Dialogs/QuestionLogoutWithDirtyData.tsx","model/entities/ApplicationLifecycle.tsx","model/entities/DialogStack.ts","model/factories/createApplication.ts","serviceWorker.ts","utils/mouse.ts","RootError.tsx","index.tsx","gui/Components/Dialogs/ColumnsDialog.module.scss","gui/Components/Search/SearchResults.module.scss","gui/connections/MobileComponents/Navigation/NavigationButton.module.scss","gui/Components/ScreenElements/Editors/DateTimeEditor/DateTimeEditor.module.scss","gui/Components/ScreenElements/Table/Table.module.scss","gui/Components/ScreenElements/Editors/BlobEditor.module.scss","gui/Components/ScreenElements/Table/Header.module.scss","gui/connections/CMainMenu.module.scss","modules/DataView/Perspective/MapPerspective/MapPerspectiveUI.module.scss","gui/Components/Form/FormField.module.scss"],"names":["module","exports","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","registerPlugin","FilePondPluginImageExifOrientation","FilePondPluginImagePreview","FilePondPluginFileValidateType","$type_ISectionPlugin","id","initialized","initialize","xmlAttributes","this","apiurl","getXmlParameter","filterFileType","invalidFileTypeMessage","instantUpload","maxParallelUploads","Number","parseInt","parameterName","Error","getComponent","data","createLocalizer","localizer","moment","locale","React","console","info","dataView","refRowId","tableRows","entityId","url","FilePondComponent","fileType","generateData","column","map","row","getCellValue","observable","props","ftype","files","useState","setFiles","className","S","FilePond","server","allowFileTypeValidation","acceptedFileTypes","labelFileTypeNotAllowed","allowReorder","allowMultiple","onupdatefiles","onerror","error","code","alert","body","labelIdle","getApplication","ctx","cn","parent","getApi","api","window","location","href","split","windowLocation","config","authority","client_id","redirect_uri","response_type","scope","post_logout_redirect_uri","response_mode","automaticSilentRenew","silent_redirect_uri","userManager","Oidc","UserManager","ensureLogin","a","authOvr","sessionStorage","getItem","setItem","access_token","hash","startsWith","signinRedirectCallback","replace","user","urlpart","history","replaceState","getUser","signinRedirect","logoff","signoutRedirect","MainBar","cx","root","children","ScreenTabsArea","SplitterPanel","observer","refPanel","elm","elmPanel","width","size","height","splitterPanel","Component","computed","SplitterDivider","isDragging","top","relativeLoc","left","domRef","onMouseDown","splitterDivider","Splitter","action","bound","draggingDividerId","initSizes","_","debounce","initSizesImm","runInAction","i","panels","length","panel","sizeMap","set","positionRatio","dividerSizeMap","contentRect","bounds","announceContainerSize","differentSizeRequested","containerWidth","containerHeight","isInitialized","newWidth","newHeight","Math","abs","containerSize","dividerSizeSum","Array","from","values","reduce","b","undefined","sizeOverrideFirstPanel","sizeRatio","entries","key","value","firstPanelSize","max","slice","acc","get","event","handleId","isResizing","dividerRelativeLoc","mouseLocStart","screenY","screenX","addEventListener","handleWindowMouseUp","handleWindowMouseMove","preventDefault","computeNewSizes","size1","size2","findIndex","draggingIds","id1","id2","removeEventListener","newSizes","onSizeChangeFinished","dividerId","content","push","STYLE","element","onResize","handleDividerResize","measureRef","divider","handleDividerMouseDown","handleResize","Map","WorkbenchPage","SSplitter","sidebar","mainbar","getWorkbench","workbench","TabbedViewHandle","onClick","isActive","isDirty","title","label","hasCloseBtn","closeBtn","onCloseClick","onCloseMouseDown","src","tooltip","TabbedViewHandleRow","getWorkbenchLifecycle","workbenchLifecycle","getOpenedScreen","o","$type_IOpenedScreen","getFormScreen","$type_IFormScreen","getFormScreenLifecycle","formScreenLifecycle","reloadScreen","refreshSession","isIDataView","$type_IDataView","getDataView","IDockType","getIsSelectedRowId","hasSelectedRowId","getSelectedRowIds","selectedRowIds","getProperty","$type_IProperty","getMainMenuEnvelope","mainMenuEnvelope","getMainMenu","mainMenu","_locale","DateSequence","_defaultDateFormats","selectionCheckboxes","isLinkToForm","isLink","getLinkMenuId","property","linkDependsOnValue","getMenuId","LookupId","lookupId","ReferenceId","linkToMenuId","getItemById","getDialogController","errorDialogController","getWorkQueues","workQueues","stopWorkQueues","stopTimer","getApplicationLifecycle","applicationLifecycle","performLogout","getCookie","name","parts","cookie","cookieValue","pop","shift","getLocaleFromCookie","results","decodeURIComponent","match","parseDateSequence","candidate","DayMonthYear","MonthDayYear","getDefaultCsDateFormatDataFromCookie","parameters","pair","getCookieParameters","defaultDateSeparator","getParameter","defaultTimeSeparator","defaultDateTimeSeparator","defaultDateSequence","defaultLongDateFormat","defaultShortDateFormat","defaultTimeFormat","isValidLocalizationCookie","e","warn","initLocaleCookie","defaultLocalizationCookie","newCookieValue","debugShowTranslations","localStorage","translations","translationsInit","axios","result","response","status","localeParent","then","catch","error2","T","defaultContent","translKey","showingDefault","hasOwnProperty","backgroundColor","HANDLED","Symbol","handleError","selectors","dismissErrors","pushError","promise","flow","isMobileLayoutActive","breakpoint","includes","IActionResultType","ModalDialog","application","useContext","MobXProviderContext","titleButtons","titleIsWorking","buttonsLeft","buttonsRight","buttonsCenter","fullScreen","topPosiotionProc","onKeyDown","QuestionSaveData","refPrimaryBtn","elmPrimaryBtn","setTimeout","focus","autoFocus","tabIndex","onSaveClick","onDontSaveClick","onCancelClick","CS","dialogContent","screenTitle","getTablePanelView","tablePanelView","IActionType","IActionPlacement","IActionMode","EventHandler","callBacks","callBack","remove","DialogInfo","OpenedScreen","dialogInfo","parentContext","parentSessionId","isBeingClosed","activationHandler","lazyLoading","menuItemId","menuItemType","order","_title","isClosed","Object","assign","formScreen","dynamicTitle","state","dataViews","isFormViewActive","triggerOnFocusTable","call","screen","getAction","$type_IAction","IUrlUpenMethod","refresh","openNewUrl","urlOpenMethod","OrigamTab","win","open","getDataViewsByEntity","entity","getDataSourceByEntity","putRowStateValue","rowStates","dataSource","rowState","getRowStatesByEntity","putValue","getDataViewList","getIsBindingRoot","isBindingRoot","getDataSources","dataSources","getDataViewCache","dataViewCache","IResponseOperation","processCRUDResult","resortTables","sourceDataView","isArray","resultItem","f","operation","Update","Create","Delete","FormSaved","CurrentRecordNeedsUpdate","FormNeedsRefresh","DeleteAllData","dataTable","clearRecordDirtyValues","objectId","wrappedObject","substituteRecord","UpdateData","updateSortAndFilter","retainPreviousSelection","selectedRow","reselectOrSelectFirst","formFocusManager","stopAutoFocus","gridFocusManager","focusTableIfNeeded","setDirty","dataSourceRow","shouldLockNewRowAtTop","modelInstanceId","isLazyLoading","insertRecord","firstVisibleRowIndex","lifecycle","stopSelectedRowReaction","selectRow","changeMasterRow","startSelectedRowReaction","getRowById","deleteRowAndSelectNext","lookupMultiEngine","cacheDependencies","lookupCleanerReloaderById","collectedLookupIds","getDependencyLookupIdsByCacheKeys","ds","lookupCacheKey","reloadLookupLabels","lookupListCache","deleteLookup","requestDataAfterSelectionChange","navigateChildren","suppressRefresh","clear","BREAK_RECURSION","getMainMenuItemById","rawMenu","menuUI","recursive","node","attributes","elements","new_ProcessActionResult","dep","getPanelFunc","find","item","getDataViewByModelInstanceId","openNewForm","closeForm","refreshForm","actions","getActionCaption","caption","crudResult","processActionResult2","actionResultList","indexedList","index","sort","DestroyForm","actionResultItem","OpenForm","RefreshData","OpenUrl","Script","menuItem","request","refreshOnReturnType","typeString","isModalDialog","dialogWidth","dialogHeight","changes","isDialog","Function","script","actionScript","message","stackTrace","getSearcher","searcher","refreshWorkQueues","getWorkQueueList","indexWorkQueues","items","getDataSource","$type_IDataSource","getColumnNamesToLoad","fields","getDataSourceFields","field","filter","getDataStructureEntityId","dataStructureEntityId","getGridId","getDataViewByGridId","gridId","getIsFormScreenDirty","openedScreen","isSleeping","isSleepingDirty","isLoading","getIsSuppressSave","suppressSave","getMobileState","mobileState","getOpenedScreens","openedScreens","getOpenedNonDialogScreenItems","getActiveScreen","activeItem","IMainMenuItemType","MenuLayoutState","actionDropUpHidden","refreshButtonHidden","saveButtonHidden","showOpenTabCombo","showSearchButton","showHamburgerMenuButton","showOkButton","heading","someScreensAreOpen","ScreenLayoutState","AboutLayoutState","SearchLayoutState","EditLayoutState","component","layoutAfterClose","DialogLayoutState","activeScreen","onScreenTabCloseClick","wrapInFlowWithHandler","args","runWithHandler","runInFlowWithHandler","runGeneratorInFlowWithHandler","generator","getDialogStack","dialogStack","showDialog","layoutStateBefore","layoutState","dialogLayoutState","close","pushDialog","getIsActiveScreen","map2obj","k","v","cssString2Object","cssString","x","trim","splitPropertyPair","obj","getDataViewLifecycle","navigateAsChild","rows","getBindingChildren","childBindings","cb","childDataView","getEntity","getMasterRowId","bindingRoot","getBindingRoot","selectedRowId","getSelectedRowId","getBindingParents","parentBindings","pb","parentDataView","getBindingParent","bps","getParentRowId","bp","openScreen","FormRefWithSelection","getSessionId","sessionId","getMenuItemId","IOrderByDirection","joinWithAND","filterItems","join","arrayToString","array","valuesToRightHandSide","val1","val2","val1IsArray","val2IsArray","toFilterValueForm","toFilterItem","columnId","dataType","operator","endsWith","upperLimit","Date","setDate","getDate","Intl","DateTimeFormat","year","month","day","formatToParts","upperLimitString","concat","substitutedOperator","val1Formatted","isMoment","toOrigamServerString","isNaN","getFilterConfiguration","filterConfiguration","getUserFilters","activeFilters","excludePropertyId","propertyId","setting","isComplete","filterValue1","filterValue2","filterToFilterItem","getOrderingConfiguration","orderingConfiguration","parseToIOrderByDirection","DESC","ASC","NONE","parseToOrdering","candidateArray","direction","getUserOrdering","defaultOrderings","getDefaultOrderings","userOrderings","ordering","rangeQuery","elementGetterL","elementGetterR","elementCount","start","end","firstGreaterThanNumber","elementGetter","num","indexLeft","indexRight","currentIndex","floor","firstGteIndex","lastLessThanNumber","min","lastLteIndex","getDataTable","getGrouper","serverSideGrouper","clientSideGrouper","prototype","indexOf","splice","groupBy","keyGetter","forEach","collection","VisibleRowsMonitor","gridDimensions","scrollState","getRowBottom","getRowTop","rowCount","scrollTop","contentBounds","visibleRowsRange","OpenGroupVisibleRowsMonitor","visibleRowsAll","expandedGroupIndex","topLevelGroups","group","isExpanded","firstIndex","lastIndex","getUserFilterLookups","lookupMap","keys","IIdState","SCROLL_ROW_CHUNK","NullIScrollLoader","rowsContainer","groupFilter","visibleRowsMonitor","InfiniteScrollLoader","$type_InfiniteScrollLoader","debugDisposer","reactionDisposer","lastRequestedStartOffset","lastRequestedEndOffset","requestProcessor","FlowQueueProcessor","prependListeners","appendListeners","appendLines","tailLoadingNeeded","nextEndOffset","getRows","MenuId","SessionFormIdentifier","DataStructureEntityId","Filter","getFilters","FilterLookups","Ordering","RowLimit","MasterRowId","Parameters","RowOffset","ColumnNames","oldDistanceToStart","distanceToStart","appendRecords","isFull","isLastRowLoaded","newDistanceToStart","newTop","scrollTo","listener","prependLines","headLoadingNeeded","nextStartOffset","prependRecords","isFirstRowLoaded","registerResetListener","handleRowContainerReset","updateTotalRowCount","totalRowCount","rowsInLastChunk","lastStartOffset","distanceToEnd","autorun","reaction","enqueue","filters","userFilters","dispose","mainLoopDelayMilliseconds","delayBetweenCallsMilliseconds","flowQueue","stopRequested","delayBetweenCallsMillis","mainLoopDelayMills","timeoutHandle","milliseconds","Promise","resolve","clearTimeout","currentFlow","sleep","FlowBusyMonitor","flowLeft","_inFlow","isWorking","isWorkingDelayed","DataViewLifecycle","$type_IDataViewLifecycle","monitor","disposers","onSelectedRowIdChangeImm","inFlow","rowSelectedReactionsDisabled","isBindingParent","bind","_selectedRowReactionDisposer","changeMasterRowCanceller","fireImmediately","self","equals","comparer","structural","wasRunning","setRecords","selectFirstRow","loadGetData","createCanceller","setMasterRecord","Entity","RowId","clearDataCache","Axios","isCancel","binding","bindingPairs","bindingPair","parentDsField","getFieldByName","parentPropertyId","parentValue","getCellValueByDataSourceField","childDsField","childPropertyId","isRootEntity","isRootGrid","buildDetailFilter","parentRowId","masterRowId","getData","all","isPreloaded","allRows","LookupLoader","collectedQuery","willLoad","loadedItems","waitingRequesters","triggerLoad","throttle","triggerLoadImm","query","existingItem","q","existingIds","Set","LabelIds","add","ensureScheduleLoad","when","loadingDone","loadingError","getLookupLabelsEx","flashColor2htmlColor","flashColor","toString","toUpperCase","padStart","htmlColor2FlashColor","htmlColor","RowState","$type_IRowState","suppressWorkingStatus","containers","isSomethingLoading","containersToLoad","reportBusyStatus","container","rowId","isValid","processingSate","every","LOADING","getRowStates","Ids","states","firstLoadingPerformed","ERROR","temporaryContainersValues","has","RowStateContainer","atom","createAtom","requestAnimationFrame","reportObserved","rowStateItem","rowIds","RowStateItem","allowCreate","allowDelete","foregroundColor","columns","rs","RowStateColumnItem","dynamicLabel","allowRead","allowUpdate","disabledActions","relations","rowStateContainer","onBecomeUnobservedListeners","onBecomeObservedListeners","getRowStateById","getValue","getRowStateIsDisableAction","actionId","Action","groupId","placement","iconUrl","mode","isDefault","Always","ActiveRecord","selRowId","MultipleCheckboxes","selectedIds","some","Toolbar","ActionParameter","$type_IActionParameter","fieldName","ComponentBindingPair","ComponentBinding","$type_IComponentBinding","parentId","parentEntity","childId","childEntity","childPropertyType","c","parentDataTable","getPropertyById","bindingController","DataSource","identifier","DataSourceField","$type_IDataSourceField","AdditionalRowData","$type_IAdditionalRowData","isInfiniteScrollingActive","dataViewAttributes","IsRootGrid","fixRowIdentifier","identifierIndex","ScrollRowContainer","rowIdGetter","$type_ScrollRowContainer","resetListeners","addedRowPositionLocked","chunk","findChunkByRowId","rowOffset","getRowIdxById","rowChunks","flatMap","delete","indexInContainer","rowCounter","indexInChunk","rowChunk","lastChunk","identifierDataIndex","findChunkByRowIndex","insert","RowChunk","rowsIn","isFinal","notifyResetListeners","trySubstitute","resetListener","unshift","filteredChunk","replaceDuplicateRows","newChunk","replaceRows","isInitial","MAX_CHUNKS_TO_HOLD","shallow","idMap","makeIdMap","existingRow","rowIndex","sourceChunk","duplicateRowIndicesInSource","duplicateRow","getRow","indexInThisChunk","getIndex","nonDuplicateRows","shiftIdMapDown","shiftIdMapUp","entry","idx","getDataViewPropertyById","properties","childProperties","ListRowContainer","updateSortAndFilterDebounced","orderings","orderingComboProps","getOrderingProperty","prop","filterComboProps","term","allComboProps","lookupEngine","lookupResolver","resolveList","getAllValuesOfProp","modelId","preloadLookups","filteringFunction","row1","row2","internalRowOrderingFunc","sortedIds","propertyFilterIdToExclude","idToRow","forcedLastRowId","directionMultiplier","orderingFunction","r","shouldLockNewRowPosition","newRowId","getRowId","rowExistsAlready","clearCacheLater","formatCache","formatNumberWithLocale","customNumericFormat","fnGetResult","keyIndex","simpleKeys","nextItem","getOrSetCached","customFormat","CustomNumericFormat","toLocaleString","minimumFractionDigits","maximumFractionDigits","useGrouping","useThousandsSeparator","getCurrentDecimalSeparator","getSeparator","getCurrentGroupSeparator","separatorType","NumberFormat","part","formatNumber","format","fractionFormat","RegExp","test","getFractionFormat","splitByPoint","minDigits","IPanelViewType","DataTable","$type_IDataTable","rowRemovedListeners","stop","identifierProperty","dataIndex","additionalRowData","ard","dirtyFormValues","dirtyValues","getOriginalCellValue","dsField","getFilteredRows","resolveCellText","isLookup","valueItem","resolveValue","getTrueIndexById","isEmptyAndLoading","getFirstRow","getExistingRowIdxById","newRow","getAdditionalRowDataById","getAdditionalRowData","hasRowDirtyValues","isEmpty","createAdditionalData","additionalData","deleteAdditionalRowData","notifyRowRemovedListeners","rowsAddedSinceSave","rowData","oldRow","dataSourceField","getFieldByIndex","clearUnneededAdditionalRowData","substitute","unlockAddedRowPosition","getSelectedRow","getIsDialog","getDataSourceFieldByName","getRowStateMayCauseFlicker","mayCauseFlicker","getTableViewProperties","tableProperties","getIsSelectionCheckboxesShown","showSelectionCheckboxes","getGroupingConfiguration","groupingConfiguration","TableGroupRow","groupLevel","sourceGroup","groupLabel","columnDisplayValue","getLeadingColumnCount","isCheckBoxedTable","orderedGroupingColumnSettings","GridDimensions","getRowCount","getIsSelectionCheckboxes","defaultRowHeight","tableViewProperties","columnWidth","imageProperty","tableViewPropertiesOriginal","columnCount","getColumnRight","dataColumnIndex","displayedColumnIndex","dataColumnIndexToDisplayedIndex","displayedColumnDimensionsCom","right","getRowHeight","rowHeight","columnWidths","groupedColumnIds","tableColumnIds","widths","w","SimpleScrollState","scrollLeft","scrollToFunction","coords","ResultItem","divRef","createRef","registerElementRef","onResultItemClick","resultIemRow","mouseOver","resultIemRowHovered","selected","resultIemRowSelected","onMouseOver","evt","onMouseOut","itemIcon","itemContents","itemTitle","itemTextSeparator","description","ResultGroup","resultGroupRow","onGroupClick","arrow","groupName","selectedResult","getMainMenuState","sidebarState","mainMenuState","SEARCH_DIALOG_KEY","SearchView","viewState","input","inputRow","icon","refInput","placeholder","onInputKeyDown","onChange","onInputChange","resultGroups","scrollDivRef","resultsContainer","resultElementMap","SearchViewState","timeout","selectNextResult","scrollToCell","selectPreviousResult","searchOnServer","highlightItem","scrollElement","current","selectedElement","selectedElementRectangle","getBoundingClientRect","scrollRectangle","distanceOverTop","scrollBarHeight","clientHeight","distanceUnderBottom","bottom","resultIndices","getSelectedResultIndices","groupIndex","indexInGroup","target","onSearchFieldChange","SearchDialog","searchViewState","openSearchWindow","closeDialog","getTabIndexFractions","tabIndexOwner","compareTabIndexOwners","y","compareFraction","fractionIndex","fractionDifference","FormFocusManager","autoFocusDisabled","objectMap","focusAbleContainers","lastFocused","focusable","focusAbleObject","focusAbleContainer","FocusAbleObjectContainer","existingContainer","focusAndRemember","disabled","focusNext","isOpen","forceAutoFocus","activeElement","focusNextInternal","callNumber","currentContainerIndex","nextIndex","previousIndex","focusPrevious","getSelectionMember","selectionMember","getPropertyOrdering","getOrdering","getDataSourceFieldIndexByName","onMainMenuItemClick","getRecordInfo","recordInfo","onSelectedRowChange","onPossibleSelectedRowChange","menuId","onSelectedRowMaybeChanged","getConfigurationManager","configurationManager","GridFocusManager","_activeEditor","focusTableOnReload","filterInputHasFocus","isFilterControlsDisplayed","tagName","focusEditor","getGridFocusManager","SavedViewState","DataView","_isFormViewActive","_isTableViewActive","orderProperty","activateFormView","activateTableView","defaultPanelView","Table","isHeadless","isMapSupported","disableActionButtons","showAddButton","showDeleteButton","showSelectionCheckboxesSetting","isGridHeightDynamic","orderMember","isDraggingEnabled","dataMember","newRecordView","confirmSelectionChange","defaultActions","formViewUI","formPanelView","lookupLoader","isFirst","dataViewRowCursor","dataViewApi","dataViewData","viewStateStack","infiniteScrollLoader","selectAllCheckboxChecked","isEnabled","isSelected","filteredRows","filteredRowIds","updatedRow","idToSelectNext","getNextExistingRowId","getPrevExistingRowId","deleteRow","setSelectedRowId","removeSelectedRowId","isGrouping","newState","addSelectedRowId","allGroups","getRowIndex","selectedRowIndex","getRowByExistingIdx","PanelHeader","PanelMenu","SelectionDialogAction","bindingParent","isAnyBindingAncestorWorking","getBindingsByChildId","getBindingsByParentId","parentRow","getParentRow","bindingToParent","getBindingToParent","parentDataSourceField","moveSelectedRowDownIndexwise","moveSelectedRowUpIndexwise","positionIndex","selectedRowPosition","nextRow","setDirtyValue","previous","newId","getNextRowId","getPreviousRowId","fieldIndex","produce","draft","idParameter","isSingleRecordEdit","newValue","readOnly","setFormDirtyValue","loadFirstPage","loadLastPage","firstRow","lastRow","getLastRow","previouslySelectedRowExists","focusedDataViewId","scrollToCurrentCell","registerDisposer","rowsCount","reData","rootGroups","level","childGroups","g","childRows","flattenToTableRows","getScrollLoader","isGroupingOff","viewId","visibleColumnIds","activeTableConfiguration","columnConfigurations","columnConfig","isVisible","allTableProperties","Caption","FieldName","Format","formatterPattern","PolymorphRules","controlPropertyId","ControlField","Rules","getPolymorphicRules","getExcelFile","Fields","RowIds","LazyLoadedEntityInput","controlPropertyValue","DropDownColumn","$type_IDropDownColumn","Latinize","compareStrings","localeCompare","prepareForFilter","text","filterConfig","portalSettings","caseSensitive","accentSensitive","getStringFilterConfig","toLowerCase","latin_map","prepareAnyForFilter","String","val","latinize","isLatin","FilterConfiguration","implicitFilters","filteringOnOffHandlers","$type_IFilterConfigurationData","applyNewFiltering","applyNewFilteringImm","handler","clearFilters","setFilter","existingIndex","filteringOnOffHandler","ignorePropertyId","isPresentInDetail","implicitFilterPredicate","userFilterPredicate","cellValue","filterVal1","cellText","getOriginalCellText","t1","substr","t0","t2","parseFloat","filterVal2","cellValues","filterValues1","filterVal","implicitFilter","sourceField","filterValue","operatorCode","dis","comboProps","FormPanelView","$type_IFormPanelView","CriticalSection","tokensIn","tokenQueue","fnResolve","fnReject","reject","TriggerablePromise","incTokens","decTokens","dequeue","fn","enterPromise","leave","enterGenerator","IMAGE_TYPE","R","U","processedImageURL","str","search","isEmbedded","charAt","IDropDownType","ScreenPictureCache","atoms","procUrl","img","Image","reportChanged","onload","atomBecameObserved","DataViewCache","dataMap","cacheKey","makeCacheKey","parentRecordId","rootRecordId","callGetData","ChildEntity","ParentRecordId","RootRecordId","FormScreen","dataUpdateCRS","pictureCache","uiRootType","dynamicTitleSource","openingOrder","showInfoPanel","showWorkflowCancelButton","showWorkflowNextButton","autoRefreshInterval","refreshOnFocus","cacheOnClient","autoSaveOnListRecordChange","requestSaveAfterUpdate","screenUI","autoWorkflowNext","workflowTaskId","componentBindings","panelConfigurations","position","defaultOrdering","clearAll","splitSource","dataSourceName","columnName","view","dv","toolbarActions","section","dialogActions","conf","isFormField","log","cnt","strrep","roots","FormScreenEnvelope","$type_IFormScreenEnvelope","initUIResult","preloadIsDirty","loadDirtyRow","rootDataViews","rootDataView","dirtyRowResult","selectedRowExists","Lookup","$type_ILookup","dropDownShowUniqueValues","dropDownType","EagerlyLoadedGrid","cached","searchByFirstColumnOnly","dropDownColumns","dropDownParameters","param","getProperties","IPropertyColumn","OrderingConfiguration","maybeApplyOrdering","ordIndex","lookup","orderingClone","cloneDeep","curOrd","newOrdering","isEqual","cycleOrdering","mul","res","cmpSign","sign","Property","autoSort","nameOverride","captionLength","captionPosition","Text","dock","multiline","isPassword","isRichText","maxLength","allowReturnToForm","isTree","modelFormatterPattern","gridColumnWidth","isAggregatedColumn","isLookupColumn","toolTip","suppressEmptyColumns","supportsServerSideSorting","fieldType","xmlNode","dataSourceIndex","GroupingUnit","AggregationType","NewConfigurationDialog","onOkClick","isInvalid","inpuContainer","textInput","onNameChanged","onKeydown","notification","getActivePanelView","activePanelView","saveColumnConfigurations","allTableConfigurations","updateColumnWidth","sortColumnConfigurations","tablePropertyIds","saveObjectConfiguration","sessionFormIdentifier","instanceId","tableConfigurations","defaultView","saveColumnConfigurationsAsync","groupingUnitToLabel","groupingUnit","Year","Month","Day","Hour","Minute","groupingUnitToString","unit","tryParseAggregationType","parseAggregationType","SUM","AVG","MIN","MAX","COUNT","dialogKey","ColumnConfigurationModel","tableConfigBeforeChanges","groupingOnClient","configManager","optionsMap","columnConfiguration","canGroup","canAggregate","deepClone","columnsConfiguration","optionA","columnOptions","optionB","onColumnConfSubmit","reset","revertChanges","newConfiguration","cloneAndActivate","onColumnConfigurationSubmit","configuration","groupingWasOnBefore","apply","groupingIsOffNow","loadInitialData","sortedColumnConfigs","setTimeGroupingUnit","columnConfCopy","groupingIndex","reverse","columnConfItem","timeGroupingUnit","selectedAggregation","aggregationType","fixedColumnCount","AggregationOption","TimeUnitOption","aggregationOptions","timeunitOptions","onFieldChange","onFieldChangeG","flushFormToTable","onFlushData","getSelectedRowIndex","getSelectedColumnId","selectedColumnId","getSelectedColumnIndex","selectedColumnIndex","flushCurrentRowData","finishEditing","setEditing","getRowStateAllowUpdate","isReadOnly","ChangeMasterRecordDialog","getFieldErrorMessage","dsFieldErrors","errors","errMap","fieldErrors","dsIndexStr","errMsg","getSelectedRowErrorMessages","IQuestionDeleteDataAnswer","IQuestionChangeRecordAnswer","processActionQueryInfo","queryInfo","canContinue","severity","questionSaveDataAfterRecordChange","tabTitle","Yes","No","Cancel","handleUserInputOnChangingRow","saveSessionQuery","queryResult","saveSession","saveResult","throwChangesAway","errorMessages","bla","TablePanelView","$type_ITablePanelView","columnConfigurationModel","filterGroupManager","firstColumn","handleScrolling","aggregations","AggregationContainer","subId","onScrollToCurrentCellHandlers","onFocusTableHandlers","_currentTooltipText","hiddenPropertyIds","tableCanvas","lastVisibleRowIndex","rowIdx","columnIdx","getCellText","selectedProperty","deleteAdditionalCellData","isControlInteraction","onCellClickInternalMobile","saveNewState","onCellClickInternal","propertyMap","selectCell","selectCellAsync","ctrlKey","metaKey","navigateLookupLink","isEditing","runRecordChangedReaction","_this","selPropId","nextRowWhenEnd","newProp","setSelectedColumnId","selectNextRow","selectFirstColumn","prevRowWhenStart","selectPrevRow","selectLastColumn","idx1","idx2","tmp","idSource","idTarget","columnOrderChangingTargetId","columnOrderChangingSourceId","myId","triggerOnScrollToCellShortest","h","columnIndex","cellOffset","getCellOffset","rectangleMap","columnLeft","rowTop","rectangle","aggregationTypes","ColumnName","currentIdent","getIdent","ContribArray","$iid","iterator","xmlObj","pred","n","findStopping","assignIIds","xmlTree","findUIRoot","findUIChildren","findBoxes","Type","findActions","findParameters","findStrings","n2","findFormRoot","GroupingConfiguration","onOffHandlers","groupingSettings","nextEntry","wasEmpty","notifyOnOffHandlers","ClientSideGroupItem","isInfinitelyScrolled","expansionListener","columnValue","grouper","groupFilters","allParents","_isExpanded","allChildGroups","getAllParents","_childRows","ServerSideGroupItem","scrollLoader","composeGroupingFilter","registerAppendListener","registerPrependListener","momentValueStart","momentValueEnd","hour","minute","groupNode","notifyGroupClosed","parents","childGroup","parseAggregations","objectArray","object","aggregationToString","aggregation","formattedValue","round","calcAggregations","aggregationInfos","aggregationInfo","calculateAggregationValue","containingGroup","g1","g2","child","previousRow","previousGroup","currentGroup","sameLevelGroups","currentGroupIndex","getPreviousNonEmptyGroup","nextGroup","getNextNonEmptyGroup","ILifetime","GenericGroupData","_label","other","DateGroupData","ServerSideGrouper","groupDisposers","loadGroupsDebounced","loadGroupsImm","loadChildrenReactionDebounced","loadChildrenReaction","refreshTrigger","delay","loadGroups","firstGroupingColumn","expandedGroupDisplayValues","aggregationList","groupData","loadAndExpandChildren","loadChildren","groupHeader","nextColumnToGroupBy","composeFinalFilter","groupChildrenOrdering","reload","nextColumnSettings","lifeCycle","loadChildGroups","loadChildRows","rowGroup","groupingFilter","groupDataItem","getGroupData","yearValue","monthValue","dayValue","hourValue","minuteValue","M","d","m","s","create","disposer","ClientSideGrouper","groups","makeGroups","loadRecursively","loadChildrenInternal","groupingColumnSettings","orderingDirection","groupToGroupDataList","compare","findDataIndex","groupMap","calcAggregation","valuesToAggregate","nextColumnName","Registration","regCreator","regCreatorEx","regClass","typeSymbol","instancePerDependency","instancePerLifetimeScope","instancePerNamedLifetimeScope","instancePerSwitchedLifetimeScope","singleInstance","onPreparing","onActivating","onActivated","onRelease","Registrator","registration","nameOrSwitchingFunction","Container","options","registrations","instances","transientInstances","disposeEvents","WeakMap","scopeName","isDisposed","scheduledOnActivated","_onThisScopeDisposed","_onThisScopeWillDispose","sym","creator","creatorEx","creatorArgs","checkDisposed","pushCurrentContainer","findAllRegistrations","resolveByRegistration","popCurrentContainer","findRegistration","symName","providePerDependency","provideSingle","providePerLifetimeScope","providePerSwitchedLifetimeScope","providePerNamedLifetimeScope","defaultLifetime","PerDependency","PerLifetimeScope","Single","instance","registerScope","pushCreator","_creatorStack","_creatorStackTop","newFromRegistration","replaceInstance","newInstance","getBottomContainer","findRootContainer","provideFromContainer","findFirstNamedContainer","detached","triggerOnThisScopeWillDispose","disposeEvent","triggerOnThisScopeDisposed","disposeWithChildren","findFirstContainer","_currentContainerStack","_currentContainerStackTop","getTopContainer","currentContainer","resolveFlowFinished","TypeSymbol","enumerationCacheKey","_registeredScopes","scopeFor","DataViewBodyUI","contrib","asArray","render","IDataViewBodyUI","DataViewToolbarUI","IDataViewToolbarUI","SectionViewSwitchers","IDataView","DroppedBox","elmDropdown","refDropdown","dropdownRef","isStillMounted","handleMaybeClose","contains","onOutsideInteraction","onCloseRequest","viewportWidth","documentElement","clientWidth","innerWidth","viewportHeight","innerHeight","tBounds","triggerRect","dBounds","dropdownRect","openEvent","clientX","clientY","calcPosition","ReactDOM","createPortal","droppedBox","getElementById","Dropdowner","refMeasTrigger","elmMeasTrigger","refMeasDropdown","elmMeasDropdown","_isDropped","persist","isDropped","reMeasure","onDroppedDown","onDroppedUp","setDropped","measure","mRefTrigger","cRectTrigger","mRefDropdown","cRectDropdown","dropdownerContainer","onContainerMouseDown","trigger","refTrigger","DataViewHeader","inner","DataViewHeaderButton","enabled","hidden","isHidden","getIsEnabledAction","Dropdown","DropdownItem","isDisabled","DataViewHeaderDropDownItem","crs_fieldBlur_ActionClick","onActionClick","runGenerator","onExecuteAction","onWorkflowCloseClick","onRepeatClick","onWorkflowRepeatClick","DataViewHeaderButtonGroup","renderAction","actionsToRender","childActions","otherAction","uiActions","renderActions","DataViewHeaderGroup","noDivider","grovable","noShrink","SaveFilterDialog","filterName","isGlobal","checked","chcekBoxinput","onIsGlobalClicked","FilterDropDown","filterManager","filterGroup","setFilterGroup","saveActiveFiltersAsNewFilterGroup","filterGroups","DataViewHeaderAction","refDom","filtersHidden","clearFiltersAndClose","noFilterActive","setSelectedFilterGroupAsDefault","defaultFilter","resetDefaultFilterGroup","onSaveFilterClick","selectedFilterGroup","isSelectedFilterGroupDefault","deleteFilterGroup","cancelSelectedFilter","onDropItemClick","getIsRowMovingDisabled","getColumnConfigurationModel","shouldProceedToChangeRow","ValueBox","_value","_active","Memoized","valueFn","_computed","scRenderTable","scRenderRow","scRenderCell","context","context2d","currentRowRightBorderDrawn","setCurrentRowRightBorderDrawn","selectionColumnShown","drawingColumnIndex","viewportLeft","viewportTop","worldWidth","gridLeadCellDimensions","worldHeight","tableRowsCount","groupingColumnIds","groupingColumnCount","currentRow","currentDataRow","realFixedColumnCount","propertyById","clickSubscriptions","mouseMoveSubscriptions","mouseOverSubscriptions","recordId","getRowStateAllowRead","getRowStateForegroundColor","rowStateForegroundColor","getRowStateRowBgColor","getContext","CPR","devicePixelRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","shadeHexColor","color","percent","t","p","G","B","clearTableDebugValues","tableId","tableDebugMonitor","setTableDebugRendered","ensureTableDataExists","rendered","setTableDebugValue","CellAlignment","isFirstColumn","paddingRight","paddingLeft","alignment","cellPaddingRight","getPaddingLeft","numberCellPaddingRight","cellPaddingLeft","currentDataCellRenderer","ctx2d","currentProperty","cellAlignment","CheckBoxCellRenderer","DateCellRenderer","TagInputCellRenderer","CheckListCellRenderer","GenericCellRenderer","ImageCellRenderer","ColorCellRenderer","fillStyle","currentCellValue","fillRect","currentColumnLeft","currentRowTop","currentColumnWidth","currentRowHeight","currentCellText","font","checkBoxCharacterFontSize","textAlign","textBaseline","fillText","xCenter","topTextOffset","currentColumnId","momentValue","dateTimeText","save","getComputedStyle","getPropertyValue","restore","getImage","complete","iw","ih","WR","HR","ratio","finIW","finIH","drawImage","getCustomTextStyle","cellPaddingLeftFirstCell","getPaddingRight","dataColumnsWidths","dataColumnsDraws","applyScrollTranslation","isRowCursor","thisCellRectangle","setCellRectangle","isColumnOrderChangeSource","getBackGroundColor","drawSelectedRowBorder","frontStripWidth","drawDataCellBackground","currentCellErrorMessage","isCurrentCellLoading","leftOffset","topBottomOffset","selectRowBorderWidth","beginPath","moveTo","lineTo","fill","drawInvalidDataSymbol","clipCell","fontSize","drawCellText","drawCellValue","cellClickableArea","getCellClickableArea","checkboxClickableArea","getCheckboxClickableArea","isDouble","defaultAction","firstEnabledDefaultAction","actionsUi","onCellClick","registerClickHandler","cellRenderer","cellWidth","showToolTipsForMemoFieldsOnly","getShowToolTipsForMemoFieldsOnly","cellTextRendered","textWidth","measureText","hasTooltip","currentTooltipText","registerToolTipGetter","currentColumnLeftVisible","currentColumnWidthVisible","setSelectedStateRowId","toggleSelectedId","setSelectedState","selectionCheckboxCellsDraws","drawSelectionCheckboxBackground","checkBoxCellPaddingLeft","newSelectionState","selectionCheckboxEmptyCellsWidths","selectionCheckboxEmptyCellsDraws","aggregationCellDraws","isGroupRow","groupRow","drawAggregationText","isCurrentGroupRow","onGroupHeaderToggleClick","groupRowEmptyCellsWidths","groupRowEmptyCellsDraws","drawEmptyGroupCell","groupRowContentCellsWidths","grpCnt","groupRowContentCellsDraws","drawGroupCell","strokeStyle","lineWidth","stroke","drawEmptyGroupCellBackground","drawGroupCellBackground","columnLabel","shouldCloseOtherGroups","groupsToKeepOpen","unselectRowIfInClosedGroup","otherGroups","dataRowCellsWidths","dataRowCellsDraws","dataRowColumnIds","isCurrentDataRow","_currentCellLayerIndex","setLayerIndex","layerIndex","currentCellLayerIndex","computeDimensions","cellWidths","leftVisible","widthVisible","fixedColumnWidth","currentRowCellsDimensions","currentRowCellsDraws","currentColumnRight","getPolymophicProperty","stripHtml","currentCellTextMultiline","polymorphicProperty","isCellTextResolving","translate","rect","clip","frontStripeWidth","offset","dataCellOffset","ColumnsDialog","refGrid","model","onColumnConfCancel","onSaveAsClick","columnTable","fixedRowCount","renderCell","lockedColumns","lockedColumnsInput","handleFixedColumnsCountChange","selectedAggregationOption","option","selectedTimeUnitOption","setVisible","checkBox","setGrouping","selectedOption","onOptionClick","dropdown","setAggregation","cellClass","columnTableCell","checkBoxCell","Obsv","Observer","rowClassName","getCellClass","getCell","TableHeader","getHeader","columnWidthHandle","onCopyRowClick","switchToFormPerspective","onCopyRow","onCreateRowClick","onCreateRow","onDeleteRowClick","onDeleteRow","onExportToExcelClick","exportToExcel","onMoveRowDownClick","moveSelectedRowDown","onMoveRowUpClick","moveSelectedRowUp","scrollToCurrentRow","onNextRowClick","onPrevRowClick","onRecordInfoClick","onOpenRecordInfoClick","getDataViewLabel","activeConfigName","ViewConfiguration","saveConfiguration","getActivePerspectiveTag","tag","IViewConfiguration","getActivePerspective","$cont","viewConfiguration","activePerspective","getIsAddButtonVisible","relationRowState","relation","getRelationRowState","getIsCopyButtonVisible","getIsDelButtonVisible","getIsMoveRowMenuVisible","currentRowId","getPanelViewActions","panelViewActions","getTotalRowCount","count","getIsFilterControlsDisplayed","selectLastRow","getPanelMenuActions","panelMenuActions","DropdownDivider","getAreCrudButtonsEnabled","CDataViewHeaderInner","hiddenActionIds","allActions","shouldBeShown","allMenuActions","relevantMenuActions","setMenuDropped","hasSomeRelevantActions","relevantActions","isFilterSettingsVisible","onColumnConfigurationClickEvt","onColumnConfigurationClick","columnConfigModel","onExportToExcelClickEvt","onDeleteRowClickEvt","onCreateRowClickEvt","onMoveRowUpClickEvt","isRowMovingDisabled","onMoveRowDownClickEvt","onCopyRowClickEvt","onFilterButtonClickEvt","onFilterButtonClick","onFilterDisplayClick","onFirstRowClickEvt","onFirstRowClick","onPrevRowClickEvt","onNextRowClickEvt","onLastRowClickEvt","onLastRowClick","isMoveRowMenuVisible","isAddButton","isDelButton","isCopyButton","showCrudButtons","crudButtonsEnabled","uiToolbar","goToFirstRowDisabled","goToLastRowDisabled","customTableConfigsExist","customTableConfigurations","isBreak640","isBarVisible","isActionsOnly","extension","onShortcut","shortcutPredicate","isAddRecordShortcut","isDeleteRecordShortcut","isDuplicateRecordShortcut","renderRowCount","renderSection","isFilterRecordShortcut","defaultTableConfiguration","tableConfig","deleteActiveTableConfiguration","renderMenuActions","contextType","trueSelectedRowIndex","groupRowCount","getExpandedGroupRowCount","CDataViewHeader","CtxDataViewHeaderExtension","shiftKey","getIsDataViewWorking","getIsFormScreenWorkingDelayed","getDataViewById","DataViewLoading","TreeDataTable","idProperty","parentIdProperty","$type_TreeDataTable","sortTreeRows","getChildren","getParentId","compareLabels","getLabel","TreeView","nodes","Node","expansionGetter","expanded","otherNode","treeView","onRowClick","onCaretClick","_parent","isFolder","countParents","parentCount","Row","stopPropagation","nodeSelected","handleRowClick","nodeLabel","getIndent","noSelect","expander","handleCaretClick","PubSub","subscribers","subscriber","arg","FilterSettingsComboBox","measureThrottled","measureImm","refMeasure","elmMeasure","isDroppedDown","handleWindowClick","handleWindowScroll","setDroppedDown","refTriggerMeasure","triggerContentRect","handleTriggerClick","dropdownSymbol","handleDropdownClick","minWidth","FilterSettingsComboBoxItem","dropdownItem","Checkbox","onClickCapture","el","indeterminate","FilterSetting","Operator","numberValue","captionGetter","_caption","operators","operatorNumber","between","greaterThan","lessThan","greaterThanOrEquals","lessThanOrEquals","notEquals","notBetween","notStartsWith","notEndsWith","notContains","isNull","isNotNull","in","notIn","filterMapComboBox","filterMap","filterTypeToNumber","filterType","typeNumber","filterTypeFromNumber","filterOperatorNum","columnType","stringValue","MobileBooleanInput","slot","on","off","nob","OPERATORS","FilterSettingsBoolean","mobileInputContainer","handleValueClick","InputClearButton","visible","ClearableInput","forwardRef","onBlur","OpCombo","op","OpEditors","inputRef","inputTag","currentValue","onCurrentValueChanged","FilterSettingsString","handleChange","prevProps","timeOutId","handleFilterTypeChange","CalendarWidget","prevState","snapshot","initialDisplayDate","displayedMonth","startOf","days","dayHeaderCell","toISOString","weekInc","today","isNeighbourMonth","isSelectedDay","isSame","selectedDay","isToday","dayCopy","neighbourMonthCell","handleDayClick","weeks","getDates","subtract","months","years","onDayClick","dayTable","header","controlBtn","handleMonthDecClick","handleMonthIncClick","handleYearDecClick","handleYearIncClick","getDayHeaders","getDateRows","DateCompleter","dateSequence","expectedFormat","dateSeparator","timeSeparator","dateTimeSeparator","timeNowFunc","expectedDateFormat","datetimeTextIn","trimmedText","isUSCompletionTriggered","isEUCompletionTriggered","dateAndTime","dateText","completeDate","autoCompleteDate","timeText","completeTime","autoCompleteTime","completeDateTime","dateTime","second","incompleteTime","completeTimeWithSeparators","completeTimeWithoutSeparators","substring","splitTime","incompleteDate","completeDateWithSeparators","completeDateWithoutSeparators","addMonthAndYear","addYear","addSeparators","now","usDateString","date","dayAndMonth","getDoubleDayAndMonthFormat","secondIndex","lastIndexOf","dateLength","DateEditorModel","editorState","outputFormat","onEditorBlur","onChangeByCalendar","completedMoment","getDateCompleter","autoComplete","dirtyTextualValue","autoCompletedMoment","formatMomentValue","formatData","formattedMomentValue","DesktopEditorState","DateTimeEditor","refDropdowner","elmDropdowner","editorModel","_hLocationInterval","refContainer","elmContainer","elmInput","makeDroppedDown","makeDroppedUp","makeFocusedIfNeeded","subscribeToFocusManager","select","setShowFormatHint","isShowFormatHintTooltip","measureInputElement","setInterval","handleWindowMouseWheel","clearInterval","handleInputBlur","handleKeyDown","inputRect","textFieldValue","handleTextFieldChange","handleContainerMouseDown","editorContainer","zIndex","FormatHintTooltip","boundingRect","line1","autocompletedText","line2","outputFormatToShow","onFocus","handleFocus","onDoubleClick","droppedPanelContainer","customFormatContainsDate","renderWithCalendarWidget","renderInputFieldOnly","tooltipHeight","setTooltipHeight","formatHintTooltip","MobileDateTimeEditor","MobileEditorState","SD","inputClass","previousLayout","FullScreenDateTimeEditor","showClearButton","onClearClick","fullScreenEditorRoot","fullScreenEditorInputContainer","fullScreenEditorInput","autoCompleteButton","fullScreenEditorInfoRow","dateFormatCs","dateFormatMoment","csToMomentFormat","isoDay","removeTimeZone","MobileFilterEditorStateVal1","dateTimeInput","MobileFilterEditorStateVal2","FilterSettingsDate","newSetting","handleSettingChange","isoDateString","removeInvalidCharacters","onCurrentValue1Changed","separator","invalidChars","allowDecimalSeparator","clearedValue","firstSeparatorIndex","lastSeparatorIndex","currentValue1","currentValue2","onCurrentValue2Changed","FilterSettingsNumber","handleBlur","LazilyLoadedGrid","DropdownDataTable","setup","dropdownEditorData","Index","dropdownType","filterPhrase","rowsBeforeRedundancyFilter","idsInEditor","getRowIdentifier","visibleColumnNames","outer","columnNameToIndex","dataRowIndex","getRowIndexById","getRowByIndex","getRowAfterId","getRowBeforeId","phrase","DropdownColumnDrivers","driversFilter","driver","allDrivers","drivers","IndexItem","phraseLower","matches","textInLower","phraseInLower","DropdownEditorLookupListCache","cache","setLookupList","getLookupList","hasLookupList","DropdownEditorBehavior","onTextOverflowChanged","dontClearScrollToRow","willLoadPage","willLoadNextPage","handleInputChangeDeb","handleInputChangeImm","runningPromise","_refInputDisposer","refInputElement","elmInputElement","refDropdownBody","elmDropdownBody","userEnteredValue","ensureRequestCancelled","clearData","scrollToRowIndex","setFilterPhrase","hasCachedListRows","setData","getCachedListRows","ensureRequestRunning","chosenRowId","cursorRowId","scrollToChosenRowIfPossible","makeFocused","chooseNewValue","dropUp","dropDown","wasDropped","prevRowId","getRowIdBeforeId","trySelectFirstRow","selectChosenRow","scrollToCursoredRowIfNeeded","nextRowId","getRowIdAfterId","updateTextOverflowState","visibleRowIndex","getRowIdentifierByIndex","scrollHeight","runGetLookupList","cancel","textOverflow","offsetWidth","scrollWidth","inputValue","searchTerm","i1","i2","compareLookUpItems","setCachedListRows","appendData","clean","item1","item2","decorate","MobileDropdownBehavior","onValueSelected","DefaultHeaderCellDriver","bodyCellClass","withCursor","CtxCell","createContext","visibleColumnIndex","TextCellDriver","driverState","handleTableCellClicked","formattedText","replaceDefaultDateFormats","formatFromServer","getMomentFormat","propertyXmlNode","nodeAttributes","csFormat","FormatterPattern","momentFormat","Name","ModelInstanceId","NumberCellDriver","cell","BooleanCellDriver","DateCellDriver","DropdownEditorSetup","columnNames","showUniqueValues","columnDrivers","DropdownEditorSetupFromXml","dropdownEditorDataTable","dropdownEditorBehavior","rat","Id","DropDownShowUniqueValues","Identifier","DropDownType","Cached","SearchByFirstColumnOnly","SuppressEmptyColumns","columnIdsWithNoData","propertyXml","Column","bodyCellDriver","headerCellDriver","pat","ParameterName","DropdownEditorApi","rowCursor","behavior","selectedId","ShowUniqueValues","SearchText","PageSize","PageNumber","DropdownEditorInput","beh","CtxDropdownEditor","editorData","useMemo","useEffect","isResolving","handleInputChange","handleInputKeyDown","handleInputFocus","customStyle","autoCorrect","autoCapitalize","spellCheck","TriggerContextMenu","handleRefreshClick","TriggerContextMenuState","behaviour","handleScreenMouseDown","clearCache","DropdownEditorControl","CtxDropdownRefCtrl","triggerContextMenu","control","handleControlMouseDown","handleInputBtnClick","onContextMenu","handleTriggerContextMenu","dummyCanvas","DropdownEditorData","getIsCellTextLoading","setNewValue","TagInputEditorData","newArray","DropdownEditor","isBodyDisplayed","onDropupRequest","renderCtrl","editor","renderDropdown","DropdownEditorBody","minSideMargin","XmlBuildDropdownEditor","mobxContext","dropdownEditorApi","dropdownEditorSetup","tagEditor","dropdownEditorLookupListCache","editorDataTable","dropdownEditorInfrastructure","Provider","getTextWidth","getCssStyle","getCanvasFontSize","fontWeight","fontFamily","refCtxBody","CtxDropdownRefBody","handleWindowMouseDown","rectCtrl","CtxDropdownCtrlRect","handleBodyMouseDown","DropdownEditorTable","refMultiGrid","hasHeader","hoveredRowIndex","cellPadding","maxHeight","driverCount","scrollbarSize","horiz","horizontal","vert","vertical","Prov","isHoveredRow","getDriver","columnWidthSum","currentCellWidth","columnGrowFactor","scrollToRow","scrollToAlignment","onScrollbarPresenceChange","handleScrollbarPresenceChange","classNameTopRightGrid","table","classNameBottomRightGrid","renderTableCell","onScroll","handleScroll","MobileDropdownEditorInput","ComboFullScreenEditor","TagInput","tagInputContainer","TagInputAdd","tagInputAdd","TagInputItemDelete","tagInputItemDelete","TagInputItem","tagInputItem","TagInputEditor","inject","textualValues","removeItem","removedItem","setValue","inputElement","setInputElement","previousValueRef","useRef","filterInput","customInputClass","TagLookupFilterEditor","FilterDropDownApi","getOptions","FilterEditorData","tagInput","valueToRemove","MobileTagInputEditor","getTagInputValues","textValues","onPlusButtonClick","MobileTagLookupFilterEditor","layoutBeforeEditing","FullScreenFilterLookupTagEditor","selectedItems","LOOKUP_TYPE_OPERATORS","enableLookupTypeFilters","oldOperator","newOperator","lookupOperatorTypes","operatorGroupChanges","handleSelectedItemsChange","handleTermChange","FilterSettingsLookup","LookupFilterSetting","_lookupId","getAllLookupIds","getFilterListValues","listValues","listValue","TagFilterEditor","onValueChanged","MobileTagFilterEditor","FullScreenFilterTagEditor","FilterSettingsTagInput","TagInputFilterSetting","FilterSettings","getSettings","defaultValue","getSettingByPropertyId","getFilterSettingByProperty","onApplyFilterSetting","onFilterValueChange","defaultSettings","allLookupIds","toLocaleLowerCase","FilterEditor","propertiesToDisplay","rowContainer","filterRow","filterSettingContainer","onColumnOrderChangeFinished","swapColumns","onColumnOrderChanged","ColumnOrderEditor","onDragEnd","destination","source","onColumnDragEnd","droppableId","provided","droppableProps","innerRef","draggableId","draggableProps","dragHandleProps","renderRow","BottomIcon","iconPath","NavigationButton","navigationButton","SN","navigationIcon","ColumnConfiguration","configModel","columnConfigs","ColumnConfig","lockedColumnsRow","buttonRow","setIsExpanded","setWidth","SidebarRecordInfo","lines","line","dangerouslySetInnerHTML","__html","RecordInfo","DataViewHeaderInner","configurationModel","isTableViewActive","MobileDataViewHeader","DataViewHeaderExtension","iid","DataViewInner","dataViewHeaderExtension","flexGrow","minHeight","flexShrink","uiBody","overlayContainer","dataViewContentContainer","getDataViewStyle","renderUiBodyWithHeader","DataViewContext","tableKeyDownChannel","subscribe","CtxDataView","DataViewHeaderActionInner","_disposer","dataViewContext","subscribeTableKeyDownHandler","handleTriggerAreaKeyDown","kbdHandlerUp","kbdHandlerDown","handleMouseDown","handleClick","IMapObjectType","Perspective","deactivate","activateDefault","IPerspective","MapPerspective","perspective","anounceActivePerspective","IMapPerspective","MapObjectsStore","mapSetupStore","mapSearchStore","mapNavigationStore","mapLocationMember","mapTextMember","mapIconMember","mapAzimuthMember","mapColorMember","fldIdentifier","isReadOnlyView","fldLocationIndex","objectGeoJson","wktParse","fldNameIndex","fldIconIndex","fldColorIndex","azimuth","fldIconAzimuth","geoJson","wktStringify","selectSearchResultById","navigationStore","highlightSelectedSearchResult","L","Icon","Default","_getIconUrl","mergeOptions","iconRetinaUrl","require","shadowUrl","MAP_ANIMATE_SETTING","animate","duration","getOptionsEPSG","crs","CRS","EPSG4326","MapPerspectiveCom","elmMapDiv","refMapDiv","leafletMap","leafletMapObjects","FeatureGroup","leafletMapRoute","editingObjectsRepaintDisabled","_disposers","_isCancelAction","mapControl","mapControlDisposers","mapFittedToLayers","_isMounted","mapCenter","panTo","coordinates","loc","mapDrawnObjectLayers","lLayer","lastDetailedObject","panToLayer","getBounds","fitBounds","pad","getLatLng","latLng","isPropActiveDifferent","mountLeaflet","isPropMapCenterDifferent","panToCenter","setStyle","setIcon","divIcon","getIcon","highlightLayer","unHighlightLayer","mapLayers","rawLayer","tileLayer","getUrl","wms","layer","fromEntries","layerList","getTitle","getMapObjects","POINT","pq","qs","parse","iconAnchor","anchor","JSON","iconRotation","myIcon","html","marker","bindTooltip","POLYGON","polygon","LINESTRING","polyline","getRoutefinderRoute","getRoutefinderEditables","dashArray","opacity","weight","clearLayers","addLayer","geoJSON","toGeoJSON","geometry","getCounterClockWisePolygonPoints","polygonGeometry","area","layers","features","routefinderUpdate","getLayers","lng","lat","onRoutefinderGeometryChange","onRoutefinderGeometryEditStart","handleRoutefinderEditStart","onRoutefinderGeometryEditCancel","onRoutefinderGeometryEditSave","handleRoutefinderEditStop","edit","_toolbars","oldEditDisable","disable","arguments","draw","oldDrawDisable","activateNormalControls","addControl","Control","Draw","featureGroup","poly","allowIntersection","circle","circlemarker","point","setMapControlCancelHack","Event","CREATED","handleRoutefinderOjectCreated","EDITED","handleRoutefinderObjectEdited","DELETED","handleRoutefinderObjectDeleted","DRAWVERTEX","handleRoutefinderVertexDrawn","EDITVERTEX","handleRoutefinderVertexEdited","EDITSTART","EDITSTOP","DRAWSTART","handleRoutefinderDrawStart","DRAWSTOP","handleRoutefinderDrawStop","removeControl","showArea","handleOjectCreated","handleObjectEdited","handleObjectDeleted","lmap","defaultEnabled","setZoom","initialZoom","leafletlayersDescriptor","collapsed","addTo","scale","allLayerBounds","latLngBounds","extend","onLayerClick","getCenter","highlightSelectedLayer","panToFirstObject","mapRoutefinderRoute","mapRoutefinderEditables","initLeaflet","initLeafletDrawControls","mapDiv","MapNavigationStore","refMapComponent","elmMapComponent","panToSelectedObject","activateRoutingControls","setupStore","searchStore","selectedSearchResult","MapRoutefinderStore","mapObjectsStore","routeLatLngs","driveThruPoints","navigation","coord","driveThruPointsEditing","objects","handleGeometryChange","mapObjectsRoute","calculateRoute","gjsCoords","smapCoords","ll","SMap","Coords","fromWGS84","Route","route","getResults","handleResultsError","handleResultsReceived","SearchStore","refSearchField","elmSearchField","mapObjects","searchPhrase","allMapObjects","measureSearchField","fitToSelectedSearchResult","resultId","MapLayer","mapLayerParameters","rawOptions","minZoom","maxZoom","MapSetupStore","rootStore","mapResolutionRaw","textColorMember","textLocationMember","textRotationMember","mapCenterRaw","zoom","MapRootStore","mapRoutefinderStore","CtxMapRootStore","MapPerspectiveSearch","mapSearch","searchInputValue","handleSearchInputChange","handleSearchInputKeyDown","handleSearchInputFocus","handleClearClick","handleClearMouseDown","handleCaretMouseDown","MapPerspectiveSearchDropdown","dropdownTop","dropdownLeft","dropdownWidth","mapSearchDropdown","SearchResults","searchResults","searchResult","c1","c2","handleSearchResultClick","searchWords","textToHighlight","MapPerspectiveDirector","dataViewToolbarUI","dataViewBodyUI","mapPerspective","toolbarActionsExtension","ToolbarActionsExtension","put","MapContentUI","handleToolbarBtnClick","del","teardown","IMapPerspectiveDirector","MapPerspectiveComContainer","toolbarExtension","getRootStore","MapPerspectiveNavigation","mapZoom","mapObjectsEditable","handleEditingStarted","handleEditingFinished","handleEditingCancelled","handleLayerClick","handleMapMounted","mapToolbarButton","handleCenterMapClick","handleLookupObjectClick","SCOPE_MapPerspective","FormPerspective","Form","IFormPerspective","FormView","formView","formViewForm","onSubmit","FormRoot","elmFormRoot","refFormRoot","formRoot","getRowStateDynamicLabel","splitToLines","BlobEditor","changeManyFields","fieldId","imageObjectUrl","fileList","upload","getDownloadToken","FileName","isPreview","token","getBlob","downloadToken","progressValue","speedValue","isUploading","file","getUploadToken","DateCreated","DateLastModified","lastTime","lastSize","putBlob","uploadToken","fileName","loaded","total","timeStamp","changeSet","renderInput","focused","blobEditor","focusedBorder","standardBorder","download","multiple","handleFileChange","toFixed","CheckListControler","lookupList","llitem","CheckList","CheckListRaw","isReadonly","controller","loadLookupList","inputRefs","focusLeft","inputsOnTheLeft","hasYEqualTo","isOnTheLeftOf","focusRight","inputsOnTheRight","isOnTheRightOf","focusUp","inputsAbove","hasXEqualTo","isAbove","focusDown","inputsBelow","isBelow","inputSetter","CheckListItem","isFocused","setIsFocused","InputReference","focusedLabel","unFocusedLabel","ImageEditor","preparedUrl","image","alt","NumberEditor","formatForDisplay","cursorPosition","rawValue","replaceAll","customNumberFormat","setState","formatForOnChange","cleanChars","invalidCharactersBeforeCursor","char","isValidCharacter","selectionStart","cleanValue","getValidCharacters","isValidNumber","selectionEnd","getStyle","TextEditor","lastAutoUpdatedValue","updateInterval","isMultiline","startAutoUpdate","onAutoUpdate","renderValueTag","wrapText","readonlyDiv","isMultiLine","scrollY","noScrollY","richTextWrappContainer","RichTextEditor","getMultilineDivClass","multiLine","EditorState","createEmpty","internalEditorState","setInternalEditorState","internalEditorStateHtml","setInternalEditorStateHtml","onEditorStateChange","useCallback","newEditorState","draftToHtml","convertToRaw","getCurrentContent","querySelector","blocksFromHtml","htmlToDraft","contentBlocks","entityMap","contentState","ContentState","createFromBlockArray","createWithContent","wrapperClassName","richTextWrappStyle","editorClassName","richTextEditorStyle","onFieldBlur","BoolEditor","readOnlyNoGrey","ColorEditor","refDroppedPanelContainer","elmDroppedPanelContainer","machine","interpret","createMachine","UI","initial","CLOSED_INACTIVE","DROPDOWN_SYMBOL_MOUSE_DOWN","PICKER_DROPPED_DOWN","INPUT_FIELD_FOCUS","CLOSED_ACTIVE","INPUT_FIELD_BLUR","INPUT_FIELD_KEY_DOWN","cond","OPEN","PICKER_KEY_DOWN","PICKER_OUTSIDE_INTERACTION","PICKER_DROPPED_UP","after","applyPickedValue","commitAppliedValue","revertAppliedValue","pickValueFromApplied","setDroppedUp","focusPickerContainer","focusInputField","signalComponentBlur","guards","eventKeyIsEnter","payload","eventKeyIsEscape","onTransition","changed","machineState","colorResult","pickedColor","hex","appliedValue","send","colorDiv","colorRect","handleColorChange","disableAlpha","ICaptionPosition","FormViewEditor","focusManager","resolveNumericCellAlignment","makeOnKeyDownCallBack","textEditor","valueObj","updateData","Values","updateObject","onTextFieldAutoUpdate","onDropdownEditorClick","firstCheckInput","canUpload","inputEditor","DomEvent","getEditor","FormField","ovrCaption","invalidMessage","None","hideCaption","getCaptionStyle","getToolTip","getFormFieldStyle","textualValue","dimensions","fieldDimensions","isUnset","asStyle","Left","captionColor","Right","isCheckbox","Top","display","Fill","finalToolTip","equalLengthLines","formatToolTipLinesPlaintext","formatTooltipPlaintext","FormSectionHeader","foreGroundColor","FormSection","hasTitle","FormLabel","RadioButton","inputId","uuidv4","onSelected","htmlFor","labelColor","CheckBox","captionStyle","CtxPanelVisibility","FieldDimensions","dimensionsFromXmlNode","X","Y","Width","Height","dimensionsFromProperty","FormBuilder","xmlFormRootObject","notifyClick","setLastFocused","form","xfo","Title","Value","radioInput","TabIndex","updateRadioButtonValue","buildForm","ComboBox","mobileInput","link","editingTags","MobileFormViewEditor","MobileFormField","MobileFormSection","MobileCheckBox","MobileFormBuilder","indexInParent","FormItem","flat","findPropertiesInPropertyNode","FormPerspectiveDirector","formPerspective","FormPerspectiveDirectorComponent","formPerspectiveActive","IFormPerspectiveDirector","SCOPE_FormPerspective","TablePerspective","onTablePerspectiveShown","ITablePerspective","selectPrevColumn","selectNextColumn","onColumnHeaderClick","addOrdering","setOrdering","Header","width0","mouseX0","mouseY0","width1","handleWindowMouseMoveForColumnWidthChange","handleWindowMouseUpForColumnWidthChange","shVecX","onColumnWidthChange","onColumnWidthChangeFinished","headerDividerWidth","isLast","maxWidth","isFixed","renderHeader","isDragDisabled","makeHeaderStyle","inHeaderRow","orderingOrder","additionalHeaderContent","additionalContentsRow","handleHeaderWidthHandleMouseDown","rightSeparator","middleSeparator","Canvas","ctxCanvas","refCanvasElement","ceil","canvasWidthPX","canvasHeightPX","canvasWidthCSS","canvasHeightCSS","canvas","canvasProps","refCanvas","HeaderRow","headerRow","headerElements","PositionedField","worldBounds","cellRectangle","scrollOffsetSource","positionedField","onMouseEnter","fixedColumnsCount","Scrollee","scrollee","scrolleeShifted","fixedVert","offsetTop","fixedHoriz","offsetLeft","Scroller","lastScrollLeft","lastScrollTop","clickHandler","SequentialSingleDoubleClickHandler","runOnclick","lastMouseX","lastMouseY","elmScrollerDiv","forceScrollLeft","scrollingDisabled","offsetHeight","scrollerRect","onMouseMove","distanceSinceLastMove","sqrt","boundingRectangle","onMouseLeave","onOutsideClick","scroller","handleMouseMove","handleMouseLeave","refScrollerDiv","fakeContent","contentWidth","horizontalScrollbarSize","contentHeight","verticalScrollbarSize","timer","singleClickIsRunning","firstEvent","doubleClickDelayMillis","ms","singleClick","event1","event2","doubleClick","lastDrawableRowIndex","lastDrawableColumnIndex","wpRight","renderTable","aCtx","aCtx2d","aTableRows","aGroupedColumnIds","aTableColumnIds","aPropertyById","aScrollLeft","aScrollTop","aViewportWidth","aViewportHeight","aIsCheckBoxedTable","aGridLeadCellDimensions","aColumnWidths","aFixedColumnCount","aClickSubscriptions","aMouseMoveSubscriptions","aMouseOverSubscriptions","aRowHeight","i0","renderRowInternal","fixColC","firstDrCI","wpLeft","firstDrawableColumnIndex","lastDrCI","createTableRenderer","groupedColumnSettings","scrollTopObs","box","scrollLeftObs","viewportWidthObs","viewportHeightObs","drawTable","settings","setScroll","domRect","handlingResult","canvasX","canvasY","handled","handleTableClick","handleTableMouseMove","setViewportSize","getToolTipContent","toolTipGetter","getTooltip","ctxPanelVisibility","refTable","RawTable","tableRenderer","_contentBounds","domNode","findDOMNode","elmScroller","onOutsideTableClick","elmCanvasFixed","elmCanvasMoving","refCanvasMovingComponent","elmCanvasElement","scheduler","listenForScrollToCell","colIdx","scrollToCellShortest","remeasureCellArea","getColumnLeft","fixedColumnsWidth","fixedHeaderContainers","headerContainers","freeHeaderContainers","toolTipData","mouseInToolTipEnabledArea","onContentBoundsChanged","handleTableScroll","setScrollOffset","destinationHeaderIndex","editorCellRectangle","editingRowIndex","editingColumnIndex","getCellRectangle","loadingOverlay","loadingIcon","headers","hasFixedColumns","fixedHeaders","freeHeaders","cellAreaContainer","canvasRow","isEditorMounted","onMouseLeaveToolTipEnabledArea","renderEditor","refScroller","handleScrollerClick","handleScrollerMouseMove","TableViewEditor","actualProperty","onEditorKeyDown","onFieldKeyDown","tabEvent","isFirstColumnSelected","isLastColumnSelected","dontHandleNextScroll","clearCurrentCellEditData","customBackgroundColor","isFirsColumn","resolveCellAlignment","activeEditor","onNoCellClick","updateRowStates","loadValues","SelectionCheckBoxHeader","selectionState","isChecked","TableViewInner","onColumnDialogCancel","onColumnDialogOk","onTableKeyDown","refTableDisposer","elmTable","d1","subOnFocusTable","focusTable","d2","subOnScrollToCellShortest","headerRenderer","HeaderRenderer","getFixedColumnCount","getColumnHeaders","setColumnWidth","onColumnWidthChanged","onColumnOrderChange","onColumnOrderAttendantsChange","initializeNewScrollLoader","registerGroupingOnOffHandler","isMainDataView","setColumnOrderChangeAttendants","handleTableKeyDown","isSelectionCheckboxes","setTableCanvas","TableView","columnOrderChangeSourceId","columnOrderChangeTargetId","isColumnOrderChanging","targetId","columnDimensions","leadingColumnCount","selectionCheckBoxesShown","dataColumnCount","HeaderContainer","renderSelectionCheckBoxHeader","columnsToFix","renderDummyHeader","renderDataHeader","columnHeaders","makeAdditionalHeaderContent","filterControlsDisplayed","aggregationData","headerContent","agg","aggregationRow","TablePerspectiveDirector","tablePerspective","ITablePerspectiveDirector","SCOPE_TablePerspective","SCOPE_DataView","register","registerClass","scopedInstance","FormPerspectiveModule","MapPerspectiveModule","TablePerspectiveModule","Clock","getTime","handle","IClock","LookupApi","requestRaw","v1","resultRaw","lookupResolved","labelId","labelValue","LookupCacheDependencies","heldLookupIds","newDeps","newDep","inputLookupIds","cacheKeys","collectedIds","ids","LookupCacheIndividual","getLookupLabels","labels","addLookupLabels","LookupCacheMulti","clock","cleanerReloader","recordBirthdate","handleOutdatingTimerTick","getTimeMs","idsToClean","indivLabels","LookupLabelsCleanerReloader","resolver","cleanAndReload","idGen","handlers","LookupLoaderIndividual","loader","resultListeners","setInterrest","resetInterrest","labelIds","loadList","LookupLoaderMulti","interrests","loading","loadingAtom","triggerLoadDeb","l1k","l1v","l2k","lookupInterrests","LookupResolver","resolved","globalAtom","keysToDelete","isString","cachedLabels","handleAtomObserved","handleAtomUnobserved","missingKeys","cachedResultMap","loadedResultMap","entryArray","innerLoadedMap","createIndividualLookupEngine","multiLookupEngine","lookupCacheMulti","lookupLoaderMulti","lookupCacheIndividual","lookupLoaderIndividual","lookupCleanerReloader","handleResultingLabels","startup","ScreenEvents","focusField","IScreenEvents","SCOPE_FormScreen","SCOPE_Screen","FormScreenModule","$root","PerspectiveModule","DataViewModule","ScreenModule","Layout","IAuditLogColumnIndices","DataViewAPI","IRowCursor","RowCursor","DataViewData","ScreenAPI","OrigamAPI","errorHandler","onApiResponse","axiosInstance","urlPrefix","chatroomsUrlPrefix","accessToken","createAxiosInstance","baseURL","httpAuthHeader","interceptors","use","constructor","Authorization","tokenSource","CancelToken","canceller","any","credentials","post","xmlJs","params","addParent","alwaysChildren","xml2js","formDefinition","FormSessionId","method","menu","cancelToken","resultData","customConfigurationXml","customConfigurations","encodedConfig","btoa","encodeURIComponent","tableConfigurationsXml","layout","Mobile","ObjectInstanceId","SectionNameAndData","CachedFormIds","DateTime","userName","UserName","oldValue","OldValue","NewValue","actionType","ActionType","reportUrl","IsPreview","SubmitImmediately","onUploadProgress","responseType","fieNameRegex","headerFileName","exec","fileDownload","IOrigamAPI","filterJsonToFilterGroup","filterJson","details","detail","value1","value2","addFilterGroups","panelConfigurationJson","initialFilter","FilterGroupManager","_defaultFilter","registerFilteringOnOffHandler","filteringOn","cloneFilterGroup","setFilters","val1ServerForm","val2ServerForm","filterToServerVersion","saveFilter","PanelId","getFilterGroupServerVersion","IsDefault","filterGroupId","deleteFilter","filterId","resetDefaultFilter","PanelInstanceId","setDefaultFilter","TableColumnConfiguration","defaultWidth","getPrototypeOf","TableConfiguration","Desktop","clearGrouping","setPropertyHidden","setType","columnIdA","columnIdB","columnIdxA","columnIdxB","propertyIds","configA","configB","DefaultConfigId","ConfigurationManager","customConfigurationsMap","configToActivate","groupingWasActive","newName","newConfig","configName","MainConfigurationManager","desktopConfigurationManager","mobileConfigurationManager","activeManager","getCustomConfiguration","setCustomConfiguration","makeColumnConfigurations","tableConfigNode","columnConfigNode","tableConfiguration","fixColumnWidth","parseIntOrZero","parseColumnConfigurationNode","parsedColumnConfigurationIds","newColumnConfigurations","createConfigurationManager","configurationNodes","createConfigurationManagerForLayout","defaultConfiguration","createDefault","tableConfigurationNodes","configurationNode","customConfigurationNodes","customConfigNode","decodedConfig","atob","parseCustomConfigurations","tabConfig","intValue","interpretScreenXml","getPropertyParameters","instance2XmlNode","parseProperty","propertyObject","ControlPropertyId","ControlPropertyValue","ReadOnly","CaptionLength","CaptionPosition","Dock","Multiline","IsPassword","IsRichText","AutoSort","MaxLength","GridColumnWidth","IdentifierIndex","ddProperty","ddParam","AllowReturnToForm","IsTree","Aggregated","IsLookupColumn","Style","SupportsServerSideSorting","FieldType","childProperty","screenDoc","panelConfigurationsRaw","lookupMenuMappings","panelViewFromNumber","pvn","$workbench","pcr","defaultSort","dataSourcesXml","windowXml","checkInfiniteScrollWillWork","xmlComponentBindings","screenAPI","scr","xmlBinding","existingBinding","ParentId","ChildId","componentBindingPair","ParentProperty","ChildProperty","ParentEntity","ChildPropertyType","foundLookupIds","uiRoot","DynamicFormLabelSource","AutoWorkflowNext","SuppressSave","SuppressRefresh","ShowInfoPanel","ShowWorkflowNextButton","ShowWorkflowCancelButton","AutoRefreshInterval","RefreshOnFocus","CacheOnClient","AutoSaveOnListRecordChange","RequestSaveAfterUpdate","LookupCacheKey","formPropertyIds","GroupId","IconUrl","Mode","Placement","confirmationMessage","ConfirmationMessage","parameter","getImplicitFilters","dataViewInstance","ModelId","NewRecordView","DefaultPanelView","IsMapSupported","IsHeadless","DisableActionButtons","ShowAddButton","ShowDeleteButton","ShowSelectionCheckboxes","IsGridHeightDynamic","SelectionMember","OrderMember","IsDraggingEnabled","DataMember","IsRootEntity","IsPreloaded","RequestDataAfterSelectionChange","ConfirmSelectionChange","IdProperty","ParentIdProperty","propId","gridConfigurationNodes","mapping","dependsOnValue","$screen","beginLifetimeScope","$formScreen","IFormScreen","$dataView","IDataViewTS","perspectiveTag","$tablePerspective","$formPerspective","dataViewXmlNode","populateMapViewSetup","mapPerspectiveDirector","lookupEngineById","lookupIndividualEngine","dataViewXml","filterNodes","RightSideValue","panelConfig","mss","attr","MapAzimuthMember","MapCenter","MapColorMember","MapIconMember","MapLocationMember","MapTextMember","TextColorMember","TextLocationMember","TextRotationMember","MapResolution","layerXmlNodes","layerXmlNode","layerAttr","mls","MapLayerSetup","parameterXmlNodes","parameterXmlnode","startEditingFirstCell","orderingPropertyId","firstProperty","getFormFocusManager","getAllBindingChildren","resultArray","getChildrenRecursive","childDatViews","ExtPromise","resolveFn","rejectFn","UpdateRequestAggregator","registeredRequests","itemJustEnqueued","currentRequest","interpreter","IDLE","UPDATE_REQUESTED","UPDATE_DEBOUNCING","DEQUEUE","always","UPDATING","API_RUNNING","invoke","onDone","onError","API_RESOLVED","API_REJECTED","exit","services","apiUpdateObject","enqueueRequest","updateObjectItem","mergeToQueue","dequeueToCurrentRequest","resolveCurrentPromise","rejectCurrentPromise","resetCurrentRequest","hasMoreItems","devTools","isRunning","askYesNoQuestion","question","yesLabel","noLabel","onYesClick","onNoClick","GuiHelper","PluginDataView","momentFormatterPattern","pluginName","Localizer","localizations","defaultLocale","messageFormat","defaultMessageFormat","_activeLocalization","_defaultLocalization","MessageFormat","getLocalization","localeLower","localization","translation","activeLocalization","defaultLocalization","compile","pluginFactoryFunctions","factoryFunction","FilterPlugin","AuditPlugin","RadarChartPlugin","FileUploadSectionPlugin","IQuestionSaveDataAnswer","pluginLibrary","pluginInstances","plugin","pluginData","guiHelper","createPluginData","pluginId","makePluginInstance","refreshRowStates","closingScreens","WeakSet","FormScreenLifecycle02","$type_IFormScreenLifecycle","_updateRequestAggregator","initialSelectedRowId","_autoRefreshTimerHandle","_processedUpdateObjectResults","_readFirstChunkOfRowsRunning","_readFirstChunkOfRowsScheduled","readFirstChunkOfRowsWithGateDebounced","readFirstChunkOfRowsWithGate","actionRunning","flushData","createRow","copyRow","onRequestDeleteRow","executeAction","questionDeleteData","isDueToError","runAsync","questionSaveData","Save","NoSave","onReload","eagerLoading","workflowNextQuery","actionQueryInfo","workflowNext","uiResult","killForm","workflowAbort","workflowRepeat","onRequestScreenClose","autoRefreshPeriod","performAutoReload","clearAutoRefreshInterval","allDataViewsSteady","_steadyDebounceTimeout","currentRecordId","applyInitUIResult","initializePlugins","clearTotalCounts","loadData","keepCurrentData","updateTotalRowCounts","sortAndFilterReaction","startAutoRefreshIfNeeded","screenLevelPlugins","isIScreenPlugin","requestSessionRefresh","setScreenParameters","isISectionPlugin","getScreenParameters","setRowCount","lookupIdsToQuery","getUnhandledLookupIds","getLookupCacheDependencies","LookupIds","dependencies","putValues","setFormScreen","applyData","fieldToSelect","getFirstFormPropertyId","getGroups","GroupBy","GroupByLookupId","AggregatedColumns","columnSettings","groupByLookupId","orderingConfig","getAggregations","nonRootDataViews","saveViewState","readFirstChunkOfRows","restoreData","ObjectId","updateObjectResult","updateObjectDidRun","runUpdateObject","getDirtyValueRows","getDirtyValues","updateRequestAggregator","refocusLast","loadedData","restoreViewState","targetDataView","orderValues","nextOrderValue","createObject","RequestingGridId","getNewRowValues","bindingParametersFromParent","createObjectResult","childEntities","copyObject","OriginalId","Entities","ForcedValues","deleteObjectInOrderedList","deleteObjectResult","deleteObject","rowToDelete","newRowOrderMap","newOrder","OrderProperty","UpdatedOrderValues","cleaned","refreshLookups","reloadAggregations","loadAggregations","aggregationResult","executeActionQuery","ActionId","ParameterMappings","SelectedItems","InputParameters","RequestingGrid","entityKey","entityValue","reloadAggregationsDebounced","createFormScreenEnvelope","preloadedSessionId","createOpenedScreen","IRefreshOnReturnType","MainMenuContent","$type_IMainMenuContent","MainMenuEnvelope","$type_IMainMenuEnvelope","Proxy","newVal","WebScreen","screenUrl","$type_IWebScreen","reloader","hasDynamicTitle","formTitle","onWorkflowNextClick","getChatrooms","chatrooms","getNotifications","notifications","getFavorites","favorites","WorkbenchLifecycle","$type_IWorkbenchLifecycle","mainMenuItemClickHandler","alwaysOpenNew","forceOpenNew","getReportTabUrl","ReportRefWithSelection","findLastExistingTabItem","ReportReferenceMenuItem","activateItem","initUIForScreen","itemId","getReportFromMenu","WorkQueue","topic","parentScreen","screenToActivate","findTopmostItemExcept","deleteItem","destroyUI","requestParameters","formSessionId","isSessionRebirth","newFormScreen","newScreen","pushItem","rowIdToSelect","selectAndOpenRowById","isNewSession","initUI","IsNewSession","RegisterSession","DataRequested","IsSingleRecordEdit","RequestCurrentRecordId","initPortal","portalInfo","userInfo","avatarLink","logoUrl","customAssetsRoute","showChat","chatRefreshInterval","showWorkQueues","workQueueListRefreshInterval","helpUrl","filteringConfig","setXml","setMainMenu","indexMainMenu","initialScreenId","sessions","session","screenToOpen","startTimer","notificationBoxRefreshInterval","onRefreshSessionClick","onRequestScreenReload","onFormClose","parentFormScreen","ReloadActualRecord","RefreshCompleteForm","MergeModalDialogChanges","dataViewLifecycle","parentScreenSessionId","pendingChanges","change","onFormTabCloseClick","ErrorBoundary","errorInfo","onErrorCaught","ErrorBoundaryEncapsulated","handleScreenError","onScreenTabHandleClick","CScreenTabbedViewHandleRow","openedScreenItems","CScreenTabbedViewHandle","ScreenToolbar","ScreenToolbarAction","handleWindowKeyDown","rootRef","isLabelless","ScreenToolbarPusher","onScreenToolbarLogoutClick","onSignOutClick","ScreenToolbarActionGroup","onSaveSessionClick","onSaveSession","getActiveScreenActions","activeScreenActions","UserMenuBlock","avatarSection","pictureSection","avatarContainer","avatar","infoSection","actionSection","menuItemDivider","actionItems","UserMenuDropdown","clickableAvatar","hideLabel","userNameLabel","onAboutClick","handleLogoutClick","getLoggedUserName","isIWebScreen","getWebScreen","getUserAvatarLink","getCustomAssetsRoute","getHelpUrl","getAbout","about","AboutView","commitId","ORIGAM_CLIENT_REVISION_HASH","commitDate","ORIGAM_CLIENT_REVISION_DATE","version","aboutInfo","serverVersion","rel","AboutDialog","contentArea","getIsSuppressRefresh","geScreenActionButtonsState","actionButtonsVisible","isSaveButtonVisible","isRefreshButtonVisible","isSaveShortcut","isRefreshShortcut","CScreenToolbar","update","actionFilter","iconsWillBeShown","toolbar","actionGroup","getOverfullActionsDropdownContent","actionButtonsState","onReloadWebScreenClick","renderForFormScreen","renderForWebScreen","renderDefault","SidebarAlertCounter","LogoSection","Sidebar","SidebarSection","SidebarSectionDivider","SidebarSectionHeader","MainMenuUL","MainMenuLI","MainMenuItem","linkContainer","isOpenedScreen","isActiveScreen","isHighLighted","getIsMainMenuLoading","IMenuItemIcon","ChooseFavoriteFolderDialog","favorite","getIconUrl","iconName","Workflow","Chat","Folder","onResetColumnConfigClick","resetScreenColumnConfiguration","SidebarSectionBody","EditButton","headerIcon","editIcon","headerIconHidden","headerIconActive","getClass","CMainMenu","mouseInHeader","editing","isAnyCommandVisible","ensureAtLeastOneCommandVisible","childElement","setIsOpen","topMenuHeader","onEditClick","listFromNode","childNode","itemForNode","CMainMenuCommandItem","activeMenuItemId","isOpenScreen","openedScreenIdSet","favoritesMenuItem","isInAnyFavoriteFolder","onAddToFavoritesClicked","CFavoritesMenuItem","editingEnabled","onRemoveFromFavoritesClicked","openItem","onIconClick","getIconSrc","deleteIcon","itemGrip","folderId","favoriteFolders","FavoritesAddRemoveButton","addToFavoritesIconContainer","addToFavoritesIcon","activeAddToFavoritesIcon","CMainMenuFolderItem","itemRef","setReference","flipIsOpen","highLightedItemId","getWorkQueuesTotalItemsCount","totalItemCount","WorkQueuesItem","isEmphasized","onWorkQueuesListItemClick","onWorkQueueListItemClick","IInfoSubsection","CWorkQueues","workQueueItems","sortedItems","countTotal","SidebarRecordAudit","CSidebarInfoSection","activeSubsection","Info","Audit","audit","onChatroomsListItemClick","CChatSection","unreadMessageCount","SearchResultItem","textContainer","resultItemName","resultItemDescription","FavoriteFolderPropertiesDialog","isPinned","onIsPinnedClicked","PinButton","getAllElementsRecursive","CFavorites","dragStateContainer","DragStateContainer","folder","defaultFavoritesFolderId","createFolder","updateFolder","onHeaderClick","flipEditEnabled","menuNodes","getAllElements","favoritesList","itemIds","onCreateNewFolderClick","favoritesFolderHeader","forceOpen","setPinned","canBeDeleted","removeFolder","onFolderPropertiesClick","forceOpenSection","CSidebar","activeInfoSubsection","activeSection","addInfoSectionExpandHandler","handleExpandRecordInfo","addAuditSectionExpandHandler","addRecordAuditExpandRequestHandler","handleExpandRecordAuditLog","firstNonEmpty","workQueuesItemsCount","totalUnreadMessages","sourceFolderId","getIdFromDropIdentifier","destinationFolderId","destinationFolder","sourceFolder","moveItemInFolder","moveItemBetweenFolders","getShowChat","showWorkQues","getShowWorkQues","notificationBox","logoLeft","renderWorkQuesSection","renderChatSection","medium","up","resultCount","searchResultGroups","ScreenHeader","progressIndicator","indefinite","ScreenHeaderAction","ScreenHeaderPusher","getIsCurrentScreenFull","isFullScreen","getIsScreenOrAnyDataViewWorking","ScreenheaderDivider","onWorkflowAbortClick","CScreenHeader","CScreenHeaderInner","isFullscreen","isNextButton","isCancelButton","workflowActionBtn","setFullscreen","ScreenContainer","WorkflowFinishedPanel","isRepeatButton","isCloseButton","panelSizeRatioToServerValue","saveSplitPanelConfiguration","InstanceId","Position","onSplitterPositionChangeFinished","panelSizeRatioServerValue","setPanelSize","Label","VBox","vBox","getVBoxStyle","HBox","hBox","getHBoxStyle","TabbedViewPanel","TabbedView","TabbedViewPanelsContainer","CScreenSectionTabbedView","tabId","activePanelId","activeBox","boxes","firstGridId","getFirstGridId","dataViewMap","activateTab","nextNode","Box","desktopRecursiveBuilder","xso","run","showWorkflowCloseButton","showWorkflowRepeatButton","Message","panelPositionRatio","serverStoredSizeRatio","serverValueToPanelSizeRatio","getPanelPosition","panelId1","panelId2","panel1SizeRatio","panel2SizeRatio","BreadCrumbs","breadCrumbList","breadCrumbsState","activeBreadCrumbList","makeBreadcrumb","breadcrumb","navigationBar","pathSeparator","BreadCrumbNode","RootBreadCrumbNode","getCaption","NavigationNode","_children","_name","_dataView","finalName","chain","removeChild","addChild","NavigatorState","currentNode","parentChain","allChildren","navigationDisabled","onNodeClick","activeDataViewId","navNode","onBreadCrumbClick","setActiveBreadCrumbList","addDetailBreadCrumbNode","mobileRecursiveBuilder","getMasterNavigationNodeName","xmlParentNode","currentNavigationNode","isRootLevelNavigationNode","masterNavigationNode","detailNavigationNode","masterXmlNode","detailXmlNode","masterReactElement","componentFactory","getDetailNavigator","detailReactElement","navigationNode","parentXmlElement","assignMasterNavigationNodeProperties","reactElement","assignDetailNavigationNodeProperties","merge","tabNodes","childXmlNode","tabNode","masterNode","getTabNavigator","mergeNodesToParentView","StandaloneDetailNavigator","navigatorState","onScreenActivation","onLinkClick","DetailNavigator","addDetailBreadCrumbNodeToRoot","contentPlaceholder","NavigationButtonList","setOpen","navigationButtonContainer","navigatorButtonListRoot","navigationButtonList","TabNavigator","rootNode","ComponentFactory","FormScreenBuilder","xmlWindowObject","Screen","mouseDowned","setMouseDowned","handleMouseup","refIFrame","onLoad","onLoadStart","webContent","transparentOverlay","getIsTopmostNonDialogScreen","topmostNonDialogScreen","screens","stackPosition","getTopmostOpenedNonDialogScreenItem","openScreenByReference","categoryId","referenceId","getMenuIdByReference","Category","onMainMenuItemIdClick","executeWeblink","urlPath","urlQuery","onRootElementClick","nodeName","getAttribute","actionUrl","urlParts","WebScreenComposite","setLoading","setTabTitleFromIFrame","frameWindow","contentDocument","setTitle","headNode","mo","MutationObserver","observe","subtree","characterData","childList","disconnect","initIFrame","closeOrigamTab","onIFrameClick","setReloader","contentWindow","CScreen","CScreenInner","CScreenContent","DialogScreenBuilder","DialogScreen","renderActionButtons","actionButtonHeader","isPrimary","flexDirection","CDialogContent","openedDialogItems","Fullscreen","TabSelector","someScreenIsDirty","titleContainer","screenName","dirtyScreenName","dirtyIcon","dirtyDropDownItem","SearchButton","MenuButton","hamburgerClick","menuIcon","TopToolBar","getLeftElement","Search","ActionDropUp","clickArea","iconContainer","BottomToolBar","screenActions","sectionActions","getActions","buttons","showCloseButton","isRed","showNextButton","MobileAboutView","MobileMain","renderMainPageContents","MobileStyleSheetLoader","mobileLayoutActive","styleSheets","sheet","rules","selectorText","styleObject","CWorkbenchPage","handleRootElementClick","small","down","mobileContainer","BreakpointProvider","useCurrentBreakpointName","ApplicationDialogStack","stackedDialogs","DialogStack","closeOnClickOutside","cloneElement","modalWindowOverlay","onOverlayClick","getStackedDialogs","CMain","Root","NewExternalPromise","ErrorDialogController","errorStack","errItem","errorMessage","exception","exMessage","innerException","InnerException","handleMessageField","timestamp","displayDialog","isDialogDisplayed","previouslyFocusedElement","errItemIndex","dismissError","ErrorDialogComponent","dialogBigIconColumn","dialogMessageColumn","errorMessageList","errMessage","errorMessageListItem","errorMessageDatetime","BreadCrumbsState","openScreenBreadCrumbs","activeFormScreen","openNodes","updateBreadCrumbs","resetBreadCrumbs","MobileState","_workbench","lastArgs","Application","$type_IApplication","Workbench","$type_IWorkbench","openedDialogScreens","openScreenByReferenceAndLookup","dataSourceLookupId","getPath","nodeLabels","openSingleMenuFolder","folderNode","closeAll","nodesToOpen","Searcher","nodeIndex","workQueueIndex","chatsIndex","doSearchTerm","doSearchTermImm","serverResultGroups","workQueueResultGroup","menuResultGroup","chatResultGroup","newGroup","selectFirst","onItemServerClick","SearchResultGroup","onSearchResultsChange","searchInMenu","searchInWorkQueues","searchInChat","chatSearchResults","latinizedLowerLabel","onChatItemClicked","scrollToItem","latinizedTerm","workQueueSearchResults","onWorkQueueItemClicked","onSubMenuClicked","onCommandClicked","NodeContainer","OpenedScreens","$type_IOpenedScreens","maxStackPosition","setActive","itemsSortedByStackPosition","PeriodicLoader","loadFunction","getChSuccessfulApi","INITIALIZED","START","PERFORMING_LOAD","FAILED","SOME_API_SUCCESS","WAIT_PERIOD_REST","REST_DELAY","svcLoadFunction","valueOf","svcSuccessfulApiSubs","callback","onReceive","delays","refreshIntervalMs","WorkQueues","$type_IWorkQueues","onRefreshWorkQueues","hRefreshTimer","refreshInterval","$type_IRecordInfo","displayedFor","idgen","infoSectionExpandHandlers","auditSectionExpandHandlers","myid","recordInfoExpanded","recordAuditExpanded","triggerInfoSectionExpand","loadRecordInfo","willLoadNewInfo","triggerAuditSectionExpand","hasValidLoadedFor","rawInfo","infoCellStruct","LookupListCacheMulti","lists","Chatrooms","onRefreshChatrooms","chatRooms","getChatroomsList","indexChats","getChatroomList","Notifications","getNotificationBoxContent","Favorites","xmlConverter","XmlToFavoritesConverter","getFolder","xml","foldersFromXml","xmlToFolders","FavoriteFolder","saveFavorites","xmlFavorites","favoriteIdsToXml","ConfigXml","folderToRemove","fromIndex","toIndex","parsedXml","folderXml","parseToFavoriteFolder","folderToXml","SidebarState","MainMenuState","_activeSection","onSidebarInfoSectionCollapsed","onSidebarInfoSectionExpanded","onSidebarAuditSectionExpanded","refMap","folderStateMap","scrollIntoView","_highLightedItemId","About","getAboutInfo","createWorkbench","workbenchLookupListCache","origamApi","createMultiLookupEngine","stopAutoreload","stopAllFormsAutorefresh","QuestionLogoutWithDirtyData","ApplicationLifecycle","$type_IApplicationLifecycle","performLogin","requestSignout","isSomeDirtyScreen","reuseAuthToken","login","Password","password","anounceAuthToken","setLoginPageMessage","resetAccessToken","resetWorkbench","logout","setAccessToken","setWorkbench","msg","loginPageMessage","nextId","dialogDimensions","useKey","dlg","createApplication","apiErrorHandler","Boolean","hostname","preventDoubleclickSelect","MOUSE_DOWN","DEAD_PERIOD","domEvent","isNotEditable","targetTag","RootError","navigator","platform","alertDanger","renderMessage","returnLink","inPageLink","disableAutoZoomingOnIPhone","vendor","setAttribute","locationHash","TOKEN_OVR_HASH","BACKEND_OVR_HASH","backendUrl","newUrl","origin","Cookie","BACKEND_OVR_RETURN_HASH","events","addUserLoaded","lang","process","REACT_APP_SELENIUM_KICK","main","serviceWorker","ready","unregister"],"mappings":";+GACAA,EAAOC,QAAU,CAAC,WAAa,iCAAiC,iBAAmB,uCAAuC,iBAAmB,yC,oBCA7ID,EAAOC,QAAU,CAAC,aAAe,iCAAiC,oBAAsB,wCAAwC,qBAAuB,yCAAyC,SAAW,6BAA6B,aAAe,iCAAiC,UAAY,8BAA8B,kBAAoB,wC,oBCAtVD,EAAOC,QAAU,CAAC,KAAO,iCAAiC,KAAO,iCAAiC,SAAW,qCAAqC,IAAM,gCAAgC,IAAM,gCAAgC,GAAK,+BAA+B,UAAY,wC,oBCA9QD,EAAOC,QAAU,CAAC,QAAU,6BAA6B,eAAiB,oCAAoC,KAAO,0BAA0B,WAAa,gCAAgC,UAAY,+BAA+B,kBAAoB,uCAAuC,gBAAkB,uC,oBCApTD,EAAOC,QAAU,CAAC,MAAQ,yBAAyB,YAAc,+BAA+B,KAAO,wBAAwB,WAAa,8BAA8B,WAAa,gC,oBCAvLD,EAAOC,QAAU,CAAC,KAAO,2BAA2B,kBAAoB,wCAAwC,WAAa,iCAAiC,WAAa,iCAAiC,kBAAoB,0C,oBCAhOD,EAAOC,QAAU,CAAC,SAAW,2BAA2B,SAAW,2BAA2B,SAAW,2BAA2B,UAAY,4BAA4B,KAAO,uBAAuB,aAAe,iC,oBCAzND,EAAOC,QAAU,CAAC,KAAO,2BAA2B,UAAY,gCAAgC,SAAW,+BAA+B,aAAe,mCAAmC,MAAQ,4BAA4B,uBAAyB,+C,oBCAzPD,EAAOC,QAAU,CAAC,KAAO,wBAAwB,aAAe,gCAAgC,eAAiB,kCAAkC,KAAO,wBAAwB,gBAAkB,qC,oBCApMD,EAAOC,QAAU,CAAC,cAAgB,mCAAmC,iBAAmB,sCAAsC,qBAAuB,0CAA0C,qBAAuB,0CAA0C,oBAAsB,yCAAyC,oBAAsB,2C,oBCArVD,EAAOC,QAAU,CAAC,KAAO,2BAA2B,UAAY,gCAAgC,cAAgB,oCAAoC,YAAc,oC,oBCAlKD,EAAOC,QAAU,CAAC,QAAU,0BAA0B,KAAO,uBAAuB,MAAQ,0B,oBCA5FD,EAAOC,QAAU,CAAC,QAAU,wCAAwC,UAAY,0CAA0C,eAAiB,+CAA+C,SAAW,yCAAyC,aAAe,+C,oBCA7PD,EAAOC,QAAU,CAAC,KAAO,8BAA8B,qBAAuB,8CAA8C,wBAA0B,iDAAiD,mBAAqB,8C,oBCA5ND,EAAOC,QAAU,CAAC,KAAO,wBAAwB,WAAa,8BAA8B,kBAAoB,qCAAqC,WAAa,8BAA8B,WAAa,8BAA8B,mBAAqB,wC,oBCAhQD,EAAOC,QAAU,CAAC,YAAc,sC,oBCAhCD,EAAOC,QAAU,CAAC,SAAW,6BAA6B,KAAO,yBAAyB,MAAQ,0BAA0B,iBAAmB,uC,oBCA/ID,EAAOC,QAAU,CAAC,eAAiB,oCAAoC,UAAY,+BAA+B,MAAQ,6B,oBCA1HD,EAAOC,QAAU,CAAC,kBAAoB,oCAAoC,YAAc,8BAA8B,aAAe,+BAA+B,mBAAqB,uC,oBCAzLD,EAAOC,QAAU,CAAC,sBAAwB,2CAA2C,eAAiB,oCAAoC,MAAQ,2BAA2B,aAAe,kCAAkC,gBAAkB,qCAAqC,SAAW,8BAA8B,UAAY,iC,oBCA1UD,EAAOC,QAAU,CAAC,QAAU,0BAA0B,OAAS,yBAAyB,aAAe,+BAA+B,eAAiB,mC,oBCAvJD,EAAOC,QAAU,CAAC,KAAO,uBAAuB,YAAc,8BAA8B,MAAQ,wBAAwB,KAAO,uBAAuB,SAAW,6B,oBCArKD,EAAOC,QAAU,CAAC,OAAS,6BAA6B,KAAO,2BAA2B,MAAQ,4BAA4B,cAAgB,sC,oBCA9ID,EAAOC,QAAU,CAAC,QAAU,gCAAgC,KAAO,6BAA6B,MAAQ,gC,oBCAxGD,EAAOC,QAAU,CAAC,OAAS,4BAA4B,gBAAkB,qCAAqC,aAAe,oC,oBCA7HD,EAAOC,QAAU,CAAC,aAAe,2CAA2C,eAAiB,6CAA6C,aAAe,2CAA2C,SAAW,yC,oBCA/MD,EAAOC,QAAU,CAAC,KAAO,4BAA4B,MAAQ,+B,oBCA7DD,EAAOC,QAAU,CAAC,KAAO,+BAA+B,MAAQ,gCAAgC,SAAW,qC,oBCA3GD,EAAOC,QAAU,CAAC,SAAW,uCAAuC,QAAU,sCAAsC,KAAO,qC,oBCA3HD,EAAOC,QAAU,CAAC,SAAW,2BAA2B,gBAAkB,kCAAkC,qBAAuB,uCAAuC,iBAAmB,mCAAmC,yBAA2B,6C,oBCA3PD,EAAOC,QAAU,CAAC,KAAO,yBAAyB,KAAO,yBAAyB,OAAS,6B,oBCA3FD,EAAOC,QAAU,CAAC,KAAO,0BAA0B,MAAQ,2BAA2B,MAAQ,6B,oBCA9FD,EAAOC,QAAU,CAAC,KAAO,kCAAkC,KAAO,kCAAkC,MAAQ,qC,oBCA5GD,EAAOC,QAAU,CAAC,QAAU,6B,oBCA5BD,EAAOC,QAAU,CAAC,KAAO,mCAAmC,KAAO,qC,oBCAnED,EAAOC,QAAU,CAAC,KAAO,6BAA6B,KAAO,6BAA6B,MAAQ,gC,oBCAlGD,EAAOC,QAAU,CAAC,cAAgB,kCAAkC,iBAAmB,qCAAqC,sBAAwB,4C,oBCApJD,EAAOC,QAAU,CAAC,cAAgB,mCAAmC,WAAa,gCAAgC,cAAgB,qC,oBCAlID,EAAOC,QAAU,CAAC,KAAO,yBAAyB,WAAa,+BAA+B,UAAY,8BAA8B,kBAAoB,sCAAsC,OAAS,2BAA2B,qBAAuB,yCAAyC,mBAAqB,uCAAuC,kBAAoB,wC,oBCAtXD,EAAOC,QAAU,CAAC,KAAO,mCAAmC,WAAa,2C,oBCAzED,EAAOC,QAAU,CAAC,WAAa,+BAA+B,oBAAsB,0C,oBCApFD,EAAOC,QAAU,CAAC,KAAO,6BAA6B,MAAQ,gC,oBCA9DD,EAAOC,QAAU,CAAC,KAAO,2BAA2B,WAAa,mC,oBCAjED,EAAOC,QAAU,CAAC,KAAO,gCAAgC,IAAM,iC,oBCA/DD,EAAOC,QAAU,CAAC,SAAW,2BAA2B,aAAe,iC,oBCAvED,EAAOC,QAAU,CAAC,MAAQ,4BAA4B,gBAAkB,sCAAsC,aAAe,qC,oBCA7HD,EAAOC,QAAU,CAAC,SAAW,2BAA2B,gBAAkB,oC,oBCA1ED,EAAOC,QAAU,CAAC,SAAW,6B,oBCA7BD,EAAOC,QAAU,CAAC,KAAO,oCAAoC,QAAU,yC,oBCAvED,EAAOC,QAAU,CAAC,QAAU,+BAA+B,KAAO,4BAA4B,MAAQ,6BAA6B,gBAAkB,yC,oBCArJD,EAAOC,QAAU,CAAC,KAAO,yBAAyB,SAAW,+B,0CCA7DD,EAAOC,QAAU,CAAC,KAAO,wB,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,+B,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,oC,oBCAzBD,EAAOC,QAAU,CAAC,cAAgB,kD,oBCAlCD,EAAOC,QAAU,CAAC,KAAO,0C,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,yB,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,oC,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,gC,oBCAzBD,EAAOC,QAAU,CAAC,UAAY,mCAAmC,MAAQ,iC,oBCAzED,EAAOC,QAAU,CAAC,qBAAuB,sD,oBCAzCD,EAAOC,QAAU,CAAC,KAAO,+B,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,iC,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,2B,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,4B,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,sC,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,2B,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,kC,oBCAzBD,EAAOC,QAAU,CAAC,SAAW,6B,oBCA7BD,EAAOC,QAAU,CAAC,MAAQ,6B,oBCA1BD,EAAOC,QAAU,CAAC,gBAAkB,sC,oBCApCD,EAAOC,QAAU,CAAC,KAAO,kC,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,0B,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,wC,oBCAzBD,EAAOC,QAAU,CAAC,OAAS,yB,oBCA3BD,EAAOC,QAAU,CAAC,UAAY,+B,oBCA9BD,EAAOC,QAAU,CAAC,gBAAkB,2C,oBCApCD,EAAOC,QAAU,CAAC,KAAO,wC,oBCAzBD,EAAOC,QAAU,CAAC,eAAiB,oC,oBCAnCD,EAAOC,QAAU,CAAC,KAAO,yC,8pBCDzB,SAAqBC,EAAKC,QACX,IAARA,IAAiBA,EAAM,IAC5B,IAAIC,EAAWD,EAAIC,SAEnB,GAAKF,GAA2B,qBAAbG,SAAnB,CAEA,IAAIC,EAAOD,SAASC,MAAQD,SAASE,qBAAqB,QAAQ,GAC9DC,EAAQH,SAASI,cAAc,SACnCD,EAAME,KAAO,WAEI,QAAbN,GACEE,EAAKK,WACPL,EAAKM,aAAaJ,EAAOF,EAAKK,YAKhCL,EAAKO,YAAYL,GAGfA,EAAMM,WACRN,EAAMM,WAAWC,QAAUb,EAE3BM,EAAMK,YAAYR,SAASW,eAAed,K,24FCA9Ce,iBAAeC,UAAoCC,WAGnDF,iBAAeG,WAGf,I,aAMA,aAGE,KAAAC,qBAA0B,EAC1B,KAAAC,GAAa,GAQb,KAAAC,aAAc,EA8ChB,OA5CE,YAAAC,WAAA,SAAWC,GACTC,KAAKC,OAASD,KAAKE,gBAAgBH,EArBxB,UAsBXC,KAAKG,eAAiBH,KAAKE,gBAAgBH,EArBxB,kBAsBnBC,KAAKI,uBAAyBJ,KAAKE,gBAAgBH,EArBxB,0BAsB3BC,KAAKK,cAAsE,QAArDL,KAAKE,gBAAgBH,EApBzB,iBAqBlBC,KAAKM,mBAAqBC,OAAOC,SAASR,KAAKE,gBAAgBH,EAtBxC,uBAuBvBC,KAAKH,aAAc,GAErB,YAAAK,gBAAA,SAAgBH,EAA0CU,GACxD,IAAKV,EAAcU,GACjB,MAAM,IAAIC,MAAM,oBAAaD,EAAa,oBAE5C,OAAOV,EAAcU,IAGvB,YAAAE,aAAA,SAAaC,EAAmBC,GAC9B,IAAMC,EAAYD,EAAgB,IAGlC,GADAE,UAAOC,OAAOF,EAAUE,SACnBhB,KAAKH,YACR,OAAOoB,iDAETC,QAAQC,KAAKP,EAAKQ,UAClB,IAAMC,EAAWT,EAAKQ,SAASE,UAAU,GAAG,GAC5C,GAAe,MAAZD,EAED,OAAOJ,iDAET,IAAMM,EAAWX,EAAKQ,SAASE,UAAU,GAAG,GAEtCE,EAAMxB,KAAKC,OAAS,aAAeoB,EAAW,aAAaE,EAEjE,OADAL,QAAQC,KAAKK,GACLP,wBAACQ,EAAiB,CAACC,SAAU1B,KAAKG,eAAgBF,OAAQuB,EAAKpB,uBAAwBJ,KAAKI,uBACpGC,cAAeL,KAAKK,cAAeC,mBAAoBN,KAAKM,sBAK9D,YAAAqB,aAAA,SAAcf,EAAmBgB,GAC/B,OAAOhB,EAAKQ,SAASE,UACjBO,KAAI,SAAAC,GACC,OAAAlB,EAAKQ,SAASW,aAAaD,EAAKF,OA3C3C,GADCI,c,kCAuCD,GADCA,c,0CASH,E,GAEaP,EAOR,SAACQ,G,UACEC,EAA8B,QAAd,EAAAD,EAAMP,gBAAQ,QAAI,GACjCS,EAASC,WAAS,IAAb,GACLC,EAAgBD,WAAS,IAAjB,GACf,OACEnB,+BAAKqB,UAAWC,GACdtB,+BAAKqB,UAAWC,GAChBtB,+BAAKqB,UAAU,qBACVrB,wBAACuB,WAAQ,CACNC,OAAQR,EAAMhC,OACdyC,yBAAyB,EACzBC,kBAAmB,CAACT,GACpBU,wBAAyBX,EAAM7B,uBAC/BC,cAAkC,QAAnB,EAAA4B,EAAM5B,qBAAa,SAClCC,mBAA4C,QAAxB,EAAA2B,EAAM3B,0BAAkB,QAAE,EAC9C6B,MAAOA,EACPU,cAAc,EACdC,eAAe,EACfC,cAAeV,EACfW,QAAS,SAACC,GAA4B,KAAdA,EAAMC,KAAcC,MAAM,kCAAyCA,MAAMF,EAAMG,OACvGC,UAAU,qF,uECzHxB/E,EAAOC,QAAU,CAAC,KAAO,8B,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,oC,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,yC,oBCAzBD,EAAOC,QAAU,CAAC,YAAc,mC,oBCAhCD,EAAOC,QAAU,CAAC,KAAO,6B,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,4B,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,+B,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,sC,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,2B,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,2B,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,mC,oBCAzBD,EAAOC,QAAU,CAAC,SAAW,+B,0CCA7BD,EAAOC,QAAU,CAAC,SAAW,6B,oBCA7BD,EAAOC,QAAU,CAAC,KAAO,mC,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,mC,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,oC,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,gC,oBCAzBD,EAAOC,QAAU,CAAC,MAAQ,uB,oBCA1BD,EAAOC,QAAU,CAAC,KAAO,qB,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,qB,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,gC,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,2B,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,0C,oBCAzBD,EAAOC,QAAU,CAAC,IAAM,mB,oBCAxBD,EAAOC,QAAU,CAAC,KAAO,uB,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,2B,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,2B,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,2B,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,6B,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,uB,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,gC,oBCAzBD,EAAOC,QAAU,CAAC,KAAO,6B,oBCAzBD,EAAOC,QAAU,CAAC,2BAA6B,6C,oBCA/CD,EAAOC,QAAU,CAAC,mBAAqB,0C,mBCAvCD,EAAOC,QAAU,CAAC,KAAO,kCAAkC,QAAU,qCAAqC,cAAgB,2CAA2C,mBAAqB,gDAAgD,IAAM,iCAAiC,iBAAmB,8CAA8C,UAAY,uCAAuC,MAAQ,mCAAmC,MAAQ,mCAAmC,SAAW,wC,yCCAteD,EAAOC,QAAU,CAAC,MAAQ,0BAA0B,YAAc,gCAAgC,QAAU,4BAA4B,UAAY,8BAA8B,SAAW,6BAA6B,UAAY,8BAA8B,gBAAkB,oCAAoC,aAAe,iCAAiC,uBAAyB,2CAA2C,mBAAqB,uCAAuC,oBAAsB,0C,mBCAhgBD,EAAOC,QAAU,CAAC,cAAgB,uC,mBCAlCD,EAAOC,QAAU,CAAC,cAAgB,sDAAsD,QAAU,gDAAgD,IAAM,4CAA4C,MAAQ,8CAA8C,UAAY,kDAAkD,cAAgB,sDAAsD,aAAe,uD,mBCA7YD,EAAOC,QAAU,CAAC,cAAgB,wCAAwC,gBAAkB,0CAA0C,OAAS,iCAAiC,gBAAkB,0CAA0C,eAAiB,yCAAyC,YAAc,sCAAsC,cAAgB,wCAAwC,KAAO,iC,mBCAzZD,EAAOC,QAAU,CAAC,MAAQ,oCAAoC,kBAAoB,gDAAgD,sBAAwB,oDAAoD,cAAgB,8C,mBCA9ND,EAAOC,QAAU,CAAC,WAAa,mCAAmC,SAAW,iCAAiC,IAAM,4BAA4B,KAAO,6BAA6B,YAAc,oCAAoC,cAAgB,sCAAsC,mBAAqB,2CAA2C,OAAS,+BAA+B,MAAQ,gC,mBCA5YD,EAAOC,QAAU,CAAC,cAAgB,wCAAwC,IAAM,8BAA8B,MAAQ,gCAAgC,UAAY,oCAAoC,cAAgB,0C,uGCAtND,EAAOC,QAAU,CAAC,KAAO,mCAAmC,qBAAuB,mDAAmD,sBAAwB,oDAAoD,wBAA0B,sDAAsD,+BAAiC,6DAA6D,MAAQ,oCAAoC,SAAW,uCAAuC,mBAAqB,mD,wICoB5e,SAAS+E,EAAeC,GAE7B,IADA,IAAIC,EAAKD,EACFC,EAAGC,QACRD,EAAKA,EAAGC,OAEV,OAAOD,ECJF,SAASE,EAAOH,GACrB,OAAOD,EAAeC,GAAKI,I,8BCF7B,EAAyBC,OAAOC,SAASC,KAAKC,MAAM,KAA7CC,EAAP,oBAEMC,EAAS,CACbC,UAAU,GAAD,OAAKF,GACdG,UAAW,kBACXC,aAAa,GAAD,OAAKJ,EAAL,0BACZK,cAAe,OACfC,MAAO,0CACPC,yBAAyB,GAAD,OAAKP,GAC7BQ,cAAe,QACfC,sBAAsB,EACtBC,oBAAoB,GAAD,OAAKV,EAAL,gCAGRW,EAAc,IAAIC,IAAKC,YAAYZ,GAEzC,SAAea,IAAtB,+B,4CAAO,sCAAAC,EAAA,2DACCC,EAAUC,eAAeC,QAAQ,4BADlC,uBAGHD,eAAeE,QAAQ,0BAA2BH,GAH/C,kBAII,CAACI,aAAcJ,IAJnB,WAMDpB,OAAOC,SAASwB,KAAKC,WAAW,0BAN/B,iCAOgBX,EAAYY,uBAC7B3B,OAAOC,SAASwB,KAAKG,QAAQ,yBAA0B,KARtD,cAOGC,EAPH,SAUe7B,OAAOC,SAASC,KAAKC,MAAM,KAV1C,mBAUI2B,EAVJ,KAWH9B,OAAO+B,QAAQC,aAAa,KAAM,GAAIF,GAXnC,kBAYID,GAZJ,yBAcgBd,EAAYkB,UAd5B,aAcGJ,EAdH,kDAgBMA,GAhBN,yBAkBKd,EAAYmB,iBAlBjB,6C,sBAuBA,SAAeC,IAAtB,+B,4CAAO,sBAAAhB,EAAA,sEACCJ,EAAYqB,kBADb,4C,+LCrCMC,GAAwB,SAAAhE,GAAK,OACxC,sBAAKK,UAAW4D,KAAG3D,KAAE4D,MAArB,SACGlE,EAAMmE,Y,qBCHEC,GAA2B,SAAApE,GAAK,OAC3C,sBAAKK,UAAWC,KAAE4D,KAAlB,SAAyBlE,EAAMmE,Y,kHCO3BE,GADLC,oB,8MAMCC,SAAW,SAACC,GAAD,OAAe,EAAKC,SAAWD,G,EAC1CC,SAAkC,K,uDAElC,c,iBAGA,WACE,OAAQ1G,KAAKiC,MAAMjD,MACjB,IAAK,UACH,MAAO,CAAC2H,MAAO3G,KAAKiC,MAAM2E,MAC5B,IAAK,SACH,MAAO,CAACC,OAAQ7G,KAAKiC,MAAM2E,S,oBAKjC,WACE,OACE,sBACEnI,IAAKuB,KAAKwG,SACVlE,UAAW4D,KAAGlG,KAAKiC,MAAMK,WAAaC,KAAEuE,cAAe9G,KAAKiC,MAAMjD,MAClEF,MAAOkB,KAAKlB,MAHd,SAKGkB,KAAKiC,MAAMmE,e,GA5BQnF,IAAM8F,W,iCAW/BC,Y,2EAwBGC,GADLV,oB,2JASC,WACE,IAAKvG,KAAKiC,MAAMiF,WAAY,MAAO,GACnC,OAAQlH,KAAKiC,MAAMjD,MACjB,IAAK,SACH,MAAO,CAACmI,IAAKnH,KAAKiC,MAAMmF,aAC1B,IAAK,UACH,MAAO,CAACC,KAAMrH,KAAKiC,MAAMmF,gB,oBAK/B,WACE,OACE,sBACE3I,IAAKuB,KAAKiC,MAAMqF,OAChBC,YAAavH,KAAKiC,MAAMsF,YACxBjF,UAAW4D,KACTlG,KAAKiC,MAAMK,WAAaC,KAAEiF,gBAC1BxH,KAAKiC,MAAMjD,KACX,CACEkI,WAAYlH,KAAKiC,MAAMiF,aAG3BpI,MAAOkB,KAAKlB,MAVd,SAYE,sBAAKwD,UAAU,sB,GAjCOrB,IAAM8F,W,iCAQjCC,Y,2EAgCUS,IAAb,EAoCGC,SAAOC,MApCV,EA4CGD,SAAOC,MA5CV,EA2DGD,SAAOC,MA3DV,EAoGGD,SAAOC,MApGV,EA8GGD,SAAOC,MA9GV,EA+IGD,SAAOC,MA/IV,EAgKGD,SAAOC,MAjKTpB,oBACD,oDAuBE,WAAYtE,GAAa,IAAD,6BACtB,cAAMA,GADgB,kZAFxB2F,uBAEwB,IA2ExBC,UAAYC,KAAEC,SAAS,EAAKC,aAAc,IAzExCC,uBAAY,WACV,IAAK,IAAIC,EAAI,EAAGA,EAAI,EAAKjG,MAAMkG,OAAOC,OAAQF,IAAK,CACjD,IAAMG,EAAQ,EAAKpG,MAAMkG,OAAOD,GAChC,EAAKI,QAAQC,IAAIF,EAAMzI,GAAIyI,EAAMG,eAC7BN,EAAI,EAAKjG,MAAMkG,OAAOC,OAAS,GACjC,EAAKK,eAAeF,IAAIF,EAAMzI,GAAI,OAPlB,EAvB1B,gDAoCE,SACa8I,GACX,IAAOC,EAAUD,EAAVC,OACHA,GACF3I,KAAK4I,sBAAsBD,EAAOhC,MAAOgC,EAAO9B,UAxCtD,mCA4CE,SACsBF,EAAeE,GAC/BF,EAAQ,GAAKE,EAAS,GAAK7G,KAAK6I,uBAAuBlC,EAAOE,KAChE7G,KAAK8I,eAAiBnC,EACtB3G,KAAK+I,gBAAkBlC,EACvB7G,KAAK6H,YACL7H,KAAKgJ,eAAgB,KAlD3B,oCAsDE,SAAuBC,EAAkBC,GACvC,OAAOC,KAAKC,IAAIF,EAAYlJ,KAAK+I,iBAAmB,MAClDI,KAAKC,IAAIH,EAAWjJ,KAAK8I,gBAAkB,OAxDjD,0BA2DE,WAA8B,IAAD,OAIrBO,EACgB,WAApBrJ,KAAKiC,MAAMjD,KAAoBgB,KAAK+I,gBAAkB/I,KAAK8I,eACvDQ,EAAiBC,MAAMC,KAAKxJ,KAAKyI,eAAegB,UAAUC,QAC9D,SAAC3E,EAAG4E,GAAJ,OAAU5E,EAAI4E,IACd,GAEF,QAA0CC,IAAtC5J,KAAKiC,MAAM4H,uBAAsC,CAEnD,IAFmD,EAQ7CC,GANeT,EAAgBC,GAEjBC,MAAMC,KAAKxJ,KAAKsI,QAAQmB,UAAUC,QACpD,SAAC3E,EAAG4E,GAAJ,OAAU5E,EAAI4E,IACd,GANiD,eAS1B3J,KAAKsI,QAAQyB,WATa,IASnD,2BAAiD,CAAC,IAAD,yBAAvCC,EAAuC,KAAlCC,EAAkC,KAC/CjK,KAAKsI,QAAQC,IAAIyB,EAAKC,EAAQH,IAVmB,oCAa9C,GAAI9J,KAAKiC,MAAMkG,OAAOC,OAAS,EAAG,CACvC,IADuC,EACjC8B,EAAiBf,KAAKgB,IAAInK,KAAKiC,MAAM4H,uBAAwB,IAK7DC,GAJeT,EAAgBC,EAAiBY,GAClClK,KAAKiC,MAAMkG,OAC5BiC,MAAM,GACNV,QAAO,SAACW,EAAKhC,GAAN,OAAgBgC,GAAO,EAAK/B,QAAQgC,IAAIjC,EAAMzI,KAAO,KAAI,GAL5B,eAQdI,KAAKsI,QAAQyB,WARC,IAQvC,2BAAiD,CAAC,IAAD,yBAAvCC,EAAuC,KAAlCC,EAAkC,KAC3CD,IAAQhK,KAAKiC,MAAMkG,OAAO,GAAGvI,IACjCI,KAAKsI,QAAQC,IAAIyB,EAAKC,EAAQH,IAVO,8BAYvC9J,KAAKsI,QAAQC,IAAIvI,KAAKiC,MAAMkG,OAAO,GAAGvI,GAAIsK,MA9FhD,oCAoGE,SAAqCK,EAAYC,GAC/CxK,KAAK4H,kBAAoB4C,EACzBxK,KAAKyK,YAAa,EAClBzK,KAAK0K,mBAAqB,EAC1B1K,KAAK2K,cACiB,WAApB3K,KAAKiC,MAAMjD,KAAoBuL,EAAMK,QAAUL,EAAMM,QACvDjH,OAAOkH,iBAAiB,UAAW9K,KAAK+K,qBACxCnH,OAAOkH,iBAAiB,YAAa9K,KAAKgL,yBA3G9C,mCA8GE,SAAoCT,GAClCA,EAAMU,iBACN,IAAMP,GACiB,WAApB1K,KAAKiC,MAAMjD,KAAoBuL,EAAMK,QAAUL,EAAMM,SACtD7K,KAAK2K,cACP,EAAuB3K,KAAKkL,gBAAgBR,GAA5C,mBAAOS,EAAP,KAAcC,EAAd,KACID,GAAS,IAAMC,GAAS,KAC1BpL,KAAK0K,mBAAqBA,KArHhC,uBAyHE,WAAmB,IAAD,OAOhB,MAAO,CANK1K,KAAK4H,kBACL5H,KAAKiC,MAAMkG,OACvBnI,KAAKiC,MAAMkG,OAAOkD,WAChB,SAAAhD,GAAK,OAAIA,EAAMzI,KAAO,EAAKgI,qBACxB,GACDhI,MA/HR,6BAmIE,SAAgB8K,GACd,kBAAmB1K,KAAKsL,YAAxB,GAAOC,EAAP,KAAYC,EAAZ,KACA,MAAO,CACLxL,KAAKsI,QAAQgC,IAAIiB,GAAQb,EACzB1K,KAAKsI,QAAQgC,IAAIkB,GAAQd,KAvI/B,oBA2IE,WACE,OAAO1K,KAAKkL,gBAAgBlL,KAAK0K,sBA5IrC,iCA+IE,SAAkCH,GAChCvK,KAAKyK,YAAa,EAClB7G,OAAO6H,oBAAoB,UAAWzL,KAAK+K,qBAC3CnH,OAAO6H,oBAAoB,YAAazL,KAAKgL,uBAC7C,kBAAmBhL,KAAKsL,YAAxB,GAAOC,EAAP,KAAYC,EAAZ,KACA,cAAuBxL,KAAK0L,SAA5B,GAAOP,EAAP,KAAcC,EAAd,KACApL,KAAKsI,QAAQC,IAAIgD,EAAKJ,GACtBnL,KAAKsI,QAAQC,IAAIiD,EAAKJ,GAClBpL,KAAKiC,MAAM0J,uBACW,YAApB3L,KAAKiC,MAAMjD,KACbgB,KAAKiC,MAAM0J,qBAAqBJ,EAAKC,EAAKL,EAAQnL,KAAK8I,eAAgBsC,GAEvEpL,KAAKiC,MAAM0J,qBAAqBJ,EAAKC,EAAKL,EAAQnL,KAAK+I,gBAAiBqC,MA3JhF,iCAgKE,SAAkC1C,EAA0BkD,GAE1D,GAAIlD,EAAYC,OAAQ,CACtB,IAAMsB,EAA4B,WAApBjK,KAAKiC,MAAMjD,KACrB0J,EAAYC,OAAO9B,OACnB6B,EAAYC,OAAOhC,MACnB3G,KAAKyI,eAAe6B,IAAIsB,KAAe3B,IACzCjK,KAAKyI,eAAeF,IAAIqD,EAAW3B,GACnCjK,KAAK6H,gBAxKb,oBA6KE,WAEE,IAFQ,IAAD,OACDgE,EAA6B,GAD5B,WAEE3D,GACP,IAAMG,EAAQ,EAAKpG,MAAMkG,OAAOD,GAChC2D,EAAQC,KACN,eAAC,GAAD,CACExJ,WAAY,EAAKL,MAAM8J,OAASxJ,MAAG8F,MACnCrJ,KAAM,EAAKiD,MAAMjD,KACjB4H,KAAM,EAAK0B,QAAQgC,IAAIjC,EAAMzI,IAH/B,SAMGyI,EAAM2D,SANT,WAIW3D,EAAMzI,MAKfsI,EAAI,EAAKjG,MAAMkG,OAAOC,OAAS,GACjCyD,EAAQC,KACN,eAAC,WAAD,CAEEnD,QAAQ,EACRsD,SAAU,SAAAvD,GAAW,OACnB,EAAKwD,oBAAoBxD,EAAaL,EAAMzI,KAJhD,SAOG,gBAAEuM,EAAF,EAAEA,WAAF,OACC,eAAC,KAAD,UACG,kBACC,eAAC,GAAD,CACE7J,WAAY,EAAKL,MAAM8J,OAASxJ,MAAG6J,QACnC9E,OAAQ6E,EAERjF,WACE,EAAKuD,YAAc,EAAK7C,oBAAsBS,EAAMzI,GAEtDwH,YAAa,EAAKsD,mBAClB1L,KAAM,EAAKiD,MAAMjD,KACjBuI,YAAa,SAAAgD,GAAK,OAChB,EAAK8B,uBAAuB9B,EAAOlC,EAAMzI,MAV7C,WAGWyI,EAAMzI,UAZlBsI,KAfJA,EAAI,EAAGA,EAAIlI,KAAKiC,MAAMkG,OAAOC,OAAQF,IAAM,EAA3CA,GA4CT,OACE,eAAC,WAAD,CAASS,QAAQ,EAAMsD,SAAUjM,KAAKsM,aAAtC,SACG,gBAAEH,EAAF,EAAEA,WAAF,OACC,eAAC,KAAD,UACG,kBACC,sBACE1N,IAAK0N,EACL7J,UAAW4D,MAAI,EAAKjE,MAAM8J,OAASxJ,MAAG4D,KAAM,EAAKlE,MAAMjD,MAFzD,SAIG,EAAKgK,eAAiB6C,cApOvC,GAA8B5K,IAAM8F,WAApC,4CAaG/E,cAbH,yEAa+B,KAb/B,6CAcGA,cAdH,yEAcgC,KAdhC,2CAeGA,cAfH,yEAe8B,KAf9B,qCAgBGA,cAhBH,yEAgB0C,IAAIuK,OAhB9C,4CAiBGvK,cAjBH,yEAiBiD,IAAIuK,OAjBrD,wCAkBGvK,cAlBH,yEAkB2B,KAlB3B,2CAmBGA,cAnBH,yEAmB8B,KAnB9B,gDAoBGA,cApBH,yEAoBmC,KApBnC,04BClFawK,GAGR,SAAAvK,GAAK,OACN,eAAC,GAAD,CACEjD,KAAK,UACL+M,MAAOU,KACPtE,OAAQ,CACN,CACEvI,GAAI,UACJ4I,cAAe,EACfwD,QAAS/J,EAAMyK,SAEjB,CACE9M,GAAI,UACJ4I,cAAe,EACfwD,QAAS/J,EAAM0K,aCjBlB,SAASC,GAAarJ,GAC3B,IAAMsJ,EAAYvJ,EAAeC,GAAKsJ,UACtC,IAAKA,EACH,MAAM,IAAInM,MAAM,gCAElB,OAAOmM,E,kCCHIC,GAAb,4JAUE,WACE,OACE,uBACEC,QAAS/M,KAAKiC,MAAM8K,QACpBzK,UAAW4D,KAAG3D,KAAE4D,KAAM,CAAC6G,SAAUhN,KAAKiC,MAAM+K,SAAUC,QAASjN,KAAKiC,MAAMgL,UAC1EC,MAAOlN,KAAKiC,MAAMiL,MAClBtN,GAAII,KAAKiC,MAAMrC,GAJjB,UAME,sBAAK0C,UAAWC,KAAE4K,MAAlB,SAA0BnN,KAAKiC,MAAMmE,WACpCpG,KAAKiC,MAAMmL,aACV,oBACE9K,UAAWC,KAAE8K,SACbN,QAAS/M,KAAKiC,MAAMqL,aACpB/F,YAAavH,KAAKiC,MAAMsL,iBAH1B,SAKE,eAAC,QAAD,CAAMC,IAAI,oBAAoBC,QAAS,cAzBnD,GAAsCxM,IAAM8F,W,qBCF/B2G,GAAb,4JACE,WACE,OAAO,sBAAKpL,UAAWC,KAAE4D,KAAlB,SAAyBnG,KAAKiC,MAAMmE,eAF/C,GAAyCnF,IAAM8F,WCDxC,SAAS4G,GAAsBpK,GACpC,OAAOqJ,GAAarJ,GAAKqK,mBCDpB,SAASC,GAAgBtK,GAE9B,IADA,ICyC8BuK,EDzC1BtK,EAAKD,IACI,CACX,GCuC2B,QAACuK,EDvCRtK,SCuCO,IAC7BsK,OAD6B,EAC7BA,EAAGC,oBDxCwB,OAAOvK,EAChC,IAAKA,EAAI,OACTA,EAAKA,EAAGC,Q,iCELL,SAASuK,GAAczK,GAE5B,IADA,IAAIC,EAAKD,IACI,CACX,GAAkBC,ECqKuCyK,kBDpKvD,OAAOzK,EAETA,EAAKA,EAAGC,QENL,SAASyK,GAAuB3K,GACrC,OAAOyK,GAAczK,GAAK4K,oBCDrB,SAASC,GAAa7K,GAC3B,iBAAO,SAAS6K,IAAT,iEACL,uBAAMF,GAAuB3K,GAAK8K,iBAAlC,QADK,oCAASD,MCiLX,IAAME,GAAc,SAACR,GAAD,cAA4BA,QAA5B,IAA4BA,OAA5B,EAA4BA,EAAGS,iBClLnD,SAASC,GAAYjL,GAE1B,IADA,IAAIC,EAAKD,IACI,CAAC,IAAD,EACX,GAAI+K,GAAY9K,GACd,OAAOA,EAET,IAAKA,EAAI,OACTA,EAAE,UAAGA,SAAH,aAAG,EAAIC,QCPE,ICGHgL,GDHG,IACbC,mBADa,SACMnL,EAAU3D,GAC3B,OAAO4O,GAAYjL,GAAKoL,iBAAiB/O,IAE3CgP,kBAJa,SAIKrL,GAChB,OAAOiL,GAAYjL,GAAKsL,kB,SCFhBJ,K,YAAAA,E,aAAAA,Q,KCHL,SAASK,GAAYvL,GAE1B,IADA,IAAIC,EAAKD,IACI,CACX,GAAgBC,ED0EqCuL,gBCzEnD,OAAOvL,EAETA,EAAKA,EAAGC,QCNL,SAASuL,GAAoBzL,GAClC,OAAOqJ,GAAarJ,GAAK0L,iBCApB,SAASC,GAAY3L,GAC1B,OAAOyL,GAAoBzL,GAAK4L,SCFnB,ICWXC,GA0BQC,GAeRC,GCjDW,GACbC,GADa,GCFA,CACbC,aADa,SACAjM,GACX,OAAOuL,GAAYvL,GAAKkM,QAGpBC,cALO,SAKOnM,EAAU0G,GAAa,OAAD,iHAClC0F,EAAWb,GAAYvL,IAChBqM,mBAF2B,uBAGhCjM,EAAMD,EAAOH,GAHmB,SAIzBI,EAAIkM,UAAU,CACzBC,SAAUH,EAASI,SACnBC,YAAa/F,IANuB,wEASjC0F,EAASM,cATwB,+CDH7B,GFHA,CACbC,YADa,SACD3M,EAAU3D,GAEpB,OAAOsP,GAAY3L,GAAM2M,YAAYtQ,KEA1B,GEFA,CACbuQ,oBADa,SACO5M,GAClB,OAAOD,EAAeC,GAAK6M,wBCHxB,SAASC,GAAc9M,GAC5B,OAAOqJ,GAAarJ,GAAK+M,WCDpB,SAASC,GAAehN,GAC7B,iBAAO,SAASgN,IAAT,iEACL,uBAAOF,GAAc9M,GAAMiN,YAA3B,QADK,oCAASD,MCAX,SAASE,GAAwBlN,GACtC,OAAOD,EAAeC,GAAKmN,qBCFtB,SAASC,GAAcpN,GAC5B,iBAAO,SAASoN,IAAT,iEACL,uBAAMF,GAAwBlN,GAAKoN,gBAAnC,QADK,oCAASA,MPDlB,SAASC,GAAUC,GACjB,IACMC,GADQ,KAAOnS,SAASoS,QACVhN,MAAM,KAAO8M,EAAO,KAExC,GAAqB,IAAjBC,EAAM1I,OAAc,CACtB,IAAM4I,EAAcF,EAAMG,MAAOlN,MAAM,KAAKmN,QAC5C,OAAOF,GAA4B,GAErC,MAAO,GAKF,SAASG,KACd,IAAK/B,GAAS,CACZ,IAEMgC,EAFcC,mBAAmBT,GAAU,wBAErBU,MADZ,qBAEhB,IAAIF,EAGF,MAAM,IAAI1Q,MAAM,4EAFhB0O,GAAUgC,EAAQ,GAKtB,OAAOhC,GAiBF,SAASmC,GAAkBC,GAChC,OAAQA,GACN,IAAK,eACH,OAAOnC,GAAaoC,aACtB,IAAK,eACH,OAAOpC,GAAaqC,aACtB,QACE,MAAM,IAAIhR,MAAM,iBAAoB8Q,EAAY,sBAM/C,SAASG,KACd,IAAKrC,GAAqB,CACxB,IAAM0B,EAAcK,mBAAmBT,GAAU,wBACjD,IACE,IAAMgB,EAkBZ,SAA6BZ,GAC3B,OAAOA,EACJjN,MAAM,KACNlC,KAAI,SAAAgQ,GAAI,OAAIA,EAAK9N,MAAM,QACvB2F,QAAO,SAAU7H,EAAgCgQ,GAEhD,OADAhQ,EAAIgQ,EAAK,IAAMA,EAAK,GACbhQ,IACN,IAzBkBiQ,CAAoBd,GAEvC1B,GAAsB,CACpByC,qBAAsBC,GAAa,uBAAwBJ,GAC3DK,qBAAsBD,GAAa,uBAAwBJ,GAC3DM,yBAA0BF,GAAa,2BAA4BJ,GACnEO,oBAAqBZ,GAAkBS,GAAa,sBAAuBJ,IAC3EQ,sBAAuBJ,GAAa,wBAAyBJ,GAC7DS,uBAAwBL,GAAa,yBAA0BJ,GAC/DU,kBAAmBN,GAAa,oBAAqBJ,IAEvD,MAAO3O,GACP,MAAM,IAAIvC,MAAM,wCAA2CsQ,EAAc,MAAS/N,IAGtF,OAAOqM,GAaT,SAASiD,GAA0BvB,GACjC,IAAKA,EACH,OAAO,EAET,IAEE,OADAW,MACO,EACP,MAAOa,GAEP,OADAtR,QAAQuR,KAAK,0CAA4CD,IAClD,GAIX,SAASR,GAAanB,EAAce,GAClC,IAAI3H,EAAQ2H,EAAWf,GACvB,QAAcjH,IAAVK,GAAiC,OAAVA,EACzB,MAAM,IAAIvJ,MAAM,oBAAuBmQ,EAAO,mBAEhD,OAAO5G,EAGF,SAAeyI,GAAtB,mC,8CAAO,WAAgCnP,GAAhC,iBAAAwB,EAAA,0DAEDwN,GADgBlB,mBAAmBT,GAAU,yBAD5C,wDAKCjN,EAAMD,EAAOH,GALd,SAM4CI,EAAIgP,4BANhD,sBAMLhU,SAASoS,OAAS,uBANb,KASAwB,GADCK,EAAiBvB,mBAAmBT,GAAU,yBAR/C,uBAUG,IAAIlQ,MAAM,yCAA4CkS,EAAiB,KAV1E,6C,gCAtEKvD,O,+BAAAA,I,gCAAAA,Q,KQnCZ,IAAMwD,GAAiF,SAAzDjP,OAAOkP,aAAa5N,QAAQ,yBAEtD6N,GAAe,GAEZ,SAAeC,GAAtB,mC,8CAAO,WAAgCzP,GAAhC,mBAAAwB,EAAA,6DACC/D,EAASmQ,KADV,kBAGkB8B,IAAM3I,IAAN,8BAAiCtJ,EAAjC,SAAgD,IAHlE,OAGGkS,EAHH,OAIHH,GAAeG,EAAOtS,KAJnB,gDAM2B,MAA1B,KAAMuS,SAASC,SACXC,EAAerS,EAAO+C,MAAM,KAAK,GACvCkP,IAAM3I,IAAN,8BAAiC+I,EAAjC,SAAsD,IACnDC,MAAK,SAAAJ,GAAM,OAAIH,GAAeG,EAAOtS,QACrC2S,OAAM,SAAAC,GAAM,OAAItS,QAAQ+B,MAAMuQ,OAEnCtS,QAAQ+B,MAAR,MAZG,0D,sBAgBA,SAASwQ,GAAEC,EAAqBC,GACrC,IAAIT,EACAU,GAAiB,EACjBb,GAAac,eAAeF,GAC9BT,EAASH,GAAaY,IAEtBT,EAASQ,EACTE,GAAiB,GAEnB,IAAK,IAAI1L,EAAI,EAAGA,GAAC,0CAAaA,IAC5BgL,EAASA,EAAO1N,QAAP,WAAmB0C,EAAnB,KAA2BA,EAA3B,uBAA2BA,EAA3B,mBAA2BA,EAA3B,IAEX,OAAI2K,GACEe,GACF1S,QAAQ+B,MAAR,2CAAkD0Q,EAAlD,gCAAmFT,EAAnF,MAEE,uBAAMhG,MAAOyG,EAAW7U,MAAO,CAACgV,gBAAiB,OAAjD,SACGZ,KAKH,uBAAMhG,MAAOyG,EAAW7U,MAAO,CAACgV,gBAAiB,SAAjD,SACGZ,IAKAA,EC9CX,IAAMa,GAAUC,OAAO,kBAEhB,SAASC,GAAY1Q,GAC1B,iBAAO,SAAS0Q,EAAYhR,GAArB,2EACDA,EAAMkQ,UAAsC,MAA1BlQ,EAAMkQ,SAASC,OADhC,qDAMDnQ,EAAMkQ,UAAsC,MAA1BlQ,EAAMkQ,SAASC,OANhC,iBAOH,uBAAM7C,GAAehN,EAAfgN,GAAN,QAPG,OASH,OADA2D,GAAgB/D,oBAAoB5M,GAAK4Q,gBACzC,gBAAMD,GAAgB/D,oBAAoB5M,GAAK6Q,UAC7CX,GAAE,8IAGA,iCAJJ,QATG,OAgBH,uBAAM9C,GAAcpN,EAAdoN,GAAN,QAhBG,qDAmBC1N,EAAM8Q,IAnBP,iBAoBD,OApBC,UAoBK9Q,EAAM8Q,IApBX,QAyBH,OAFMM,EAAUC,gBAAK,kBAAMJ,GAAgB/D,oBAAoB5M,GAAK6Q,UAAUnR,KAA9DqR,GAChBrR,EAAM8Q,IAAWM,EAxBd,UAyBGA,EAzBH,qCAASJ,M,iCCPX,SAASM,GAAqBhR,GACnC,IAAMiR,EAAalR,EAAeC,GAAKiR,WACvC,QAAIA,GAGGA,EAAWC,SAAS,SCFtB,I,GCLKC,GDKCC,GAWR,SAAC1S,GACJ,IAAM2S,EAAcC,qBAAWC,uBAAqBF,YAEpD,OACE,eAAC,eAAD,CACE1H,MAAOjL,EAAMiL,MACb6H,aAAc9S,EAAM8S,aACpBC,eAAgB/S,EAAM+S,eACtBC,YAAahT,EAAMgT,YACnBC,aAAcjT,EAAMiT,aACpBC,cAAelT,EAAMkT,cACrBxO,MAAO1E,EAAM0E,MACbE,OAAQ5E,EAAM4E,OACduO,WAAYb,GAAqBK,GACjCS,iBAAkBpT,EAAMoT,iBACxBC,UAAWrT,EAAMqT,UAXnB,SAaGrT,EAAMmE,YE1BAmP,GADZhP,mBACD,+MAMEiP,cAAgB,SAAC/O,GAAD,OAAe,EAAKgP,cAAgBhP,GANtD,EAOEgP,mBAPF,yDASE,WAAqB,IAAD,OAClBC,YAAW,WACgB,IAAD,IAApB,EAAKD,gBACP,eAAKA,eAAcE,aAAnB,oBAED,OAdP,oBAiBE,WACE,OACE,eAAC,GAAD,CACEzI,MAAOuG,GAAE,WAAY,kBACrBsB,aAAc,KACdI,cACE,uCACE,yBACES,WAAW,EACXC,SAAU,EACVpX,IAAKuB,KAAKwV,cACVzI,QAAS/M,KAAKiC,MAAM6T,YAJtB,SAMGrC,GAAE,OAAQ,UAEb,yBACEoC,SAAU,EACV9I,QAAS/M,KAAKiC,MAAM8T,gBACpBnW,GAAI,iBAHN,SAKG6T,GAAE,aAAc,0BAEnB,yBAAQoC,SAAU,EAAG9I,QAAS/M,KAAKiC,MAAM+T,cAAzC,SACGvC,GAAE,SAAU,sBAInBwB,YAAa,KACbC,aAAc,KA1BhB,SA4BE,sBAAK5S,UAAW2T,KAAGC,cAAnB,SACGzC,GAAE,sCAAuC,sBAAuBzT,KAAKiC,MAAMkU,qBAhDtF,GAAsClV,IAAM8F,aAA5C,GCLO,SAASqP,GAAkB7S,GAAW,IAAD,EAC1C,iBAAOiL,GAAYjL,UAAnB,aAAO,EAAkB8S,gB,SFHf3B,K,wBAAAA,E,0BAAAA,E,oBAAAA,E,kBAAAA,E,oBAAAA,E,0BAAAA,E,iBAAAA,Q,KGCL,I,wBCEK4B,GAUAC,GAMAC,GDlBCC,GAAb,iDAEEC,UAA4B,GAF9B,uCAIE,SAAIC,GACE3W,KAAK0W,UAAUjC,SAASkC,IAC1B3W,KAAK0W,UAAU5K,KAAK6K,KAN1B,oBAUE,SAAOA,GACL3W,KAAK0W,UAAUE,OAAOD,KAX1B,kBAcE,WAAO,IAAD,iBACmB3W,KAAK0W,WADxB,IACJ,2BAAuC,EACrCC,EADqC,YADnC,mCAdR,KEMaE,GACX,WAAmBlQ,EAAsBE,GAAiB,yBAAvCF,QAAsC,KAAhBE,UAI9BiQ,IAAb,GAgDGpP,SAAOC,MAhDV,GA+DGD,SAAOC,MA/DV,cAQE,WAAY/G,GAA0B,yBAPtCmW,gBAOqC,OANrCC,mBAMqC,OALrCjJ,oBAAyB,EAKY,KAJrCkJ,qBAIqC,OAFrCC,eAAgB,EAEqB,KAKrCC,kBAAoB,IAAIV,GALa,sFASrCW,aAAuB,EATc,KAUrCC,WAAqB,GAVgB,KAWrCC,aAAkC,KAXG,KAYrCC,MAAgB,EAZqB,KAarCC,OAAiB,GAboB,0FAgBrCC,UAAoB,EAhBiB,0CAkBrC7F,WAAqC,GAlBA,KA6DrCnO,YA7DqC,EACnCiU,OAAOC,OAAO3X,KAAMY,GACpBZ,KAAK6L,QAAQpI,OAASzD,KAV1B,0CA4BE,WAAgB,IAAD,IACb,2BAAOA,KAAK6L,QAAQ+L,kBAApB,aAAO,EAAyBC,oBAAhC,QAAgD7X,KAAKwX,QA7BzD,IAwCE,SAAavN,GACXjK,KAAKwX,OAASvN,IAzClB,qBAgCE,WAAiB,IAAD,QACd,qCAAOjK,KAAK6L,QAAQ+L,kBAApB,aAAO,EAAyBC,oBAAhC,kBAAgD7X,KAAK6L,QAAQ+L,kBAA7D,aAAgD,EAAyB1K,aAAzE,QAAkF,KAjCtF,2BAoCE,WAAuB,IAAD,EACpB,SAAQ,UAAClN,KAAK6L,QAAQ+L,kBAAd,aAAC,EAAyBC,gBArCtC,oBA4CE,WACE,YAA2BjO,IAApB5J,KAAK+W,aA7ChB,uBAgDE,SACUe,GAER,GADA9X,KAAKgN,SAAW8K,EACZA,GAAS9X,KAAK6L,QAAQ+L,WAAY,CACpC,IAAMxW,EAAWpB,KAAK6L,QAAQ+L,WAAWG,UAAU3P,OAAS,EACxDpI,KAAK6L,QAAQ+L,WAAWG,UAAU,QAClCnO,EACJ,GAAIxI,IAAaA,EAAS4W,mBACD5B,GAAkBhV,GAC1B6W,sBAEjBjY,KAAKmX,kBAAkBe,UA3D7B,wBA+DE,SACWC,GACTnY,KAAK6L,QAAUsM,EACfA,EAAO1U,OAASzD,SAlEpB,kDAeGgC,cAfH,yEAesC,KAftC,wCAgBGA,cAhBH,yEAgByB,KAhBzB,0CAsBGA,cAtBH,yEAsBqC,KAtBrC,+CAuBGA,cAvBH,yEAuB0C,KAvB1C,uCAyBGA,cAzBH,yEAyB6C,QAzB7C,qCA4CGgF,YA5CH,kT,SDTYsP,K,gBAAAA,E,oBAAAA,E,oBAAAA,E,oBAAAA,E,0BAAAA,E,8CAAAA,E,qBAAAA,Q,cAUAC,K,0BAAAA,E,kBAAAA,E,uBAAAA,Q,cAMAC,K,wCAAAA,E,4BAAAA,E,iBAAAA,Q,KEjBL,SAAS4B,GAAU7U,GAExB,IADA,IAAIC,EAAKD,GACSC,EFwCiC6U,eExC5B7U,EAAKA,EAAGC,OAC/B,OAAOD,ECHM,ICFH8U,GCIG,GFFA,CACbC,QADa,SACLhV,GACN,iBAAO,SAASgV,IAAT,iEACL,uBAAMrK,GAAuB3K,GAAK8K,iBAAlC,QADK,oCAASkK,QGDb,SAASC,GAAWjV,GACzB,iBAAO,SAASiV,EACdhX,EACAiX,EACAvL,GAHK,4EAKGuL,EALH,cAMEH,GAAeI,UANjB,iBAOD,uBAAM/K,GAAsBpK,GAAKiV,WAAWhX,EAAK0L,GAAjD,QAPC,gDAWKyL,EAAM/U,OAAOgV,KAAP,UAAepX,GAAO,YAC3BmX,EAAIhD,QAZV,wDAAS6C,MCFX,SAASK,GAAqBtV,EAAUuV,GAC7C,OAAO9K,GAAczK,GAAKsV,qBAAqBC,GCD1C,SAASC,GAAsBxV,EAAUuV,GAC9C,OAAO9K,GAAczK,GAAKwV,sBAAsBD,GCD3C,SAASE,GAAiBzV,GAC/B,OAAO,SAA0BuV,EAAgBhB,GAC/C,IAAMmB,ECFH,SAA8B1V,EAAUuV,GAC7C,IAAMI,EAAaH,GAAsBxV,EAAKuV,GAE9C,OADkBI,EAAaA,EAAWC,cAAWvP,EDAjCwP,CAAqB7V,EAAKuV,GAC5CG,GAAaA,EAAUI,SAASvB,IEH7B,SAASwB,GAAgB/V,GAC9B,OAAOyK,GAAczK,GAAKwU,UCDrB,SAASwB,GAAiBhW,GAC/B,OAAOiL,GAAYjL,GAAKiW,cCDnB,SAASC,GAAelW,GAC7B,OAAOyK,GAAczK,GAAKmW,YCnBrB,SAASC,GAAiBpW,GAC/B,OAAOyK,GAAczK,GAAKqW,e,SVehBtB,K,uBAAAA,Q,SWYAuB,G,YAoBIC,IAAT,SAASA,GAAkBvW,EAAU2P,EACV6G,EACAC,GAF3B,mJAGDlS,KAAEmS,QAAQ/G,GAHT,gCAIoBA,GAJpB,wDAKD,OADOgH,EAJN,QAKD,gBAAMJ,GAAkBvW,EAAK2W,EAAYH,EAAcC,GAAvD,QALC,oHAAAG,IAAA,wDAUCD,EAAahH,GACJ4E,OAGbkB,GAAiBzV,EAAjByV,CAAsBkB,EAAWpB,OAAQoB,EAAWpC,OAdjD,KAgBGoC,EAAWE,UAhBd,cAiBEP,GAAmBQ,OAjBrB,UAmCER,GAAmBS,OAnCrB,UA4DET,GAAmBU,OA5DrB,UAwEEV,GAAmBW,UAxErB,UAsFEX,GAAmBY,yBAtFrB,WAoGEZ,GAAmBa,iBApGrB,WA0GEb,GAAmBc,cA1GrB,sBAkBK5C,EAAYc,GAAqBtV,EAAK2W,EAAWpB,QAlBtD,eAmBoBf,GAnBpB,+DAmBQ3W,EAnBR,SAoBUwZ,UAAUC,uBAAuBX,EAAWY,SAAUZ,EAAWa,eAC1E3Z,EAAS4Z,iBAAiBd,EAAWa,eACrCpB,GAAiBvY,GAAU6Z,WAAW7Z,IAClC2Y,EAvBL,iBAwBG,OAxBH,UAwBS3Y,EAASwZ,UAAUM,oBAAoB,CAACC,yBAAyB,IAxB1E,QA0BM/Z,EAASga,aACZha,EAASia,wBAEXja,EAASka,iBAAiBC,gBAC1Bna,EAASoa,iBAAiBC,qBA9B3B,wHAAAtB,IAAA,4BAgCDnM,GAAczK,GAAKmY,UAAS,GAhC3B,8BAoCK3D,EAAYc,GAAqBtV,EAAK2W,EAAWpB,QApCtD,eAqCoBf,GArCpB,8DAqCQ3W,EArCR,QAsCOiV,EAAiBjV,EAASiV,eAC1BsF,EAAgBzI,EAAO6H,cACvBa,GAAsC,OAAd5B,QAAc,IAAdA,OAAA,EAAAA,EAAgB6B,mBAAoBza,EAASya,iBAEvEza,EAAS0a,cA1Cd,iBA2CG,OA3CH,UA2CS1a,EAASwZ,UAAUmB,aAAa1F,EAAe2F,qBAAsBL,EAAeC,GA3C7F,QA+CK,OA/CL,UA6CKxa,EAAS6a,UAAUC,0BACnB9a,EAAS+a,UAAUR,GACnB,gBAAMva,EAAS6a,UAAUG,kBAAzB,SA/CL,yBAiDKhb,EAAS6a,UAAUI,2BAjDxB,6CAoDG,OApDH,UAoDSjb,EAASwZ,UAAUmB,aAAa3a,EAASE,UAAU8G,OAAQuT,EAAeC,GApDnF,QAqDGxa,EAAS+a,UAAUR,GArDtB,QAuDChC,GAAiBvY,GAAU6Z,WAAW7Z,GAvDvC,wHAAA+Y,IAAA,4BAyDDnM,GAAczK,GAAKmY,UAAS,GAzD3B,8BA6DK3D,EAAYc,GAAqBtV,EAAK2W,EAAWpB,QA7DtD,eA8DoBf,GA9DpB,IA8DD,2BAAS3W,EAAuB,SACxBU,EAAMV,EAASwZ,UAAU0B,WAAWpC,EAAWY,aAEnD1Z,EAASmb,uBAAuBza,GAChC6X,GAAiBvY,GAAU6Z,WAAW7Z,IAlEzC,0BAAA+Y,IAAA,OAqEDnM,GAAczK,GAAKmY,UAAS,GArE3B,8BAyED1N,GAAczK,GAAKmY,UAAS,GACtB7O,EAAYD,GAAarJ,GA1E9B,EA2EsDsJ,EAAU2P,kBAA1DC,EA3EN,EA2EMA,kBAAmBC,EA3EzB,EA2EyBA,0BACpBhD,EAAcD,GAAelW,GAC7BoZ,EAAqBF,EAAkBG,kCAC3ClD,EAAY7X,KAAI,SAACgb,GAAD,OAAQA,EAAGC,mBA9E5B,eAgFoBH,GAhFpB,IAgFD,2BAAS5M,EAAgC,QACvC,UAAA2M,EAA0BpS,IAAIyF,UAA9B,SAAyCgN,qBACzClQ,EAAUmQ,gBAAgBC,aAAalN,GAlFxC,0BAAAoK,IAAA,sCAwFKpC,EAAYuB,GAAgB/V,GAxFjC,eAyFoBwU,GAzFpB,kEA0FKwB,GADGnY,EAzFR,WA0FmCA,EAAS8b,gCA1F5C,kBA2FG,uBAAM9b,EAAS6a,UAAUG,kBAAzB,UA3FH,SA4FG,uBAAMhb,EAAS6a,UAAUkB,mBAAzB,UA5FH,SA8FM/b,EAASga,aACZha,EAASia,wBA/FZ,iIAAAlB,IAAA,gEAqGInM,GAAczK,GAAK6Z,gBArGvB,kBAsGC,uBAAMhP,GAAa7K,EAAb6K,GAAN,UAtGD,+CA2GK2J,EAAYuB,GAAgB/V,GA3GjC,eA4GoBwU,GA5GpB,IA4GD,2BAAgC,QACrBsF,QA7GV,0BAAAlD,IAAA,4CAkHK,IAAIzZ,MAAM,qBAAuBwZ,EAAWE,WAlHjD,yH,SApBKP,O,kCAAAA,I,oBAAAA,I,mBAAAA,I,mBAAAA,I,yBAAAA,I,uCAAAA,I,uDAAAA,I,kCAAAA,Q,KCVZ,IAAMyD,GAAkBtJ,OAAO,mBAExB,SAASuJ,GAAoBha,EAAU3D,GAC5C,IACIsT,EADEsK,EAAUtO,GAAY3L,GAAMka,OAalC,KAVA,SAASC,EAAUC,GACjB,GAAIA,EAAKC,WAAWhe,KAAOA,EAEzB,MADAsT,EAASyK,EACHL,GAHoB,qBAKVK,EAAKE,UALK,IAK5B,2BACEH,EAD+B,SALL,+BAW5BA,CAAUF,GACV,MAAOhL,GACP,GAAIA,IAAM8K,GACR,OAAOpK,EAET,MAAMV,GC+BH,SAASsL,GAAwBva,GACtC,IAcmCwa,EAd7BnQ,EAAqBD,GAAsBpK,GAEjD,OAYmCwa,EAZP,CAC1BC,aAFmB,SAACnC,GAAD,OCtDhB,SAAsCtY,EAAUsY,GACrD,OAAOhO,GAAgBtK,GAAKsI,QAAQ+L,WAAYG,UAAUkG,MACxD,SAAAC,GAAI,OAAIA,EAAKrC,kBAAoBA,KDoDesC,CAA6B5a,EAAKsY,IAGlFuC,YAAaxQ,EAAmBwQ,YAChC5F,WAAYA,GAAWjV,GACvB8a,UAAWA,GAAU9a,GACrB+a,YAAaC,GAAmBhG,QAAQhV,GACxCib,iBAAkB,kBE9Df,SAA0Bjb,GAC/B,OAAO6U,GAAU7U,GAAKkb,QF6DID,CAAiBjb,IACzCuW,kBAAmB,SAAClZ,GAAD,OAA+DkZ,GAAkBvW,EAAK3C,EAAK8d,WAAY9d,EAAKmZ,eAC/H/C,cAAezT,GAcjB,UAAO,SAASob,EAAqBC,GAA9B,0GACCC,EAAcD,EAAiB/c,KAAI,SAACqc,EAAMY,GAAP,MAAiB,CAACA,EAAOZ,OACtDa,MAAK,SAACha,EAAQ4E,GACxB,OAAI5E,EAAE,GAAG/F,OAAS0V,GAAkBsK,aAAqB,EACrDrV,EAAE,GAAG3K,OAAS0V,GAAkBsK,YAAoB,EACjDja,EAAE,GAAK4E,EAAE,MALb,eAOwBkV,EAAYhd,KAAI,SAAAqc,GAAI,OAAIA,EAAK,OAPrD,yDAOIe,EAPJ,aAQKA,EAAiBjgB,KARtB,cASI0V,GAAkBwK,SATtB,UAyCIxK,GAAkBsK,YAzCtB,UA6CItK,GAAkByK,YA7CtB,UAiDIzK,GAAkBuG,WAjDtB,UAuDIvG,GAAkB0K,QAvDtB,UAkEI1K,GAAkB2K,OAlEtB,oBAyBC,OAfMC,EAAW/B,GAAoBQ,EAAI/G,cAAeiI,EAAiBM,QAAQzE,UAC3E1D,IAAckI,GACsB,UAA9B,OAARA,QAAQ,IAARA,GAAA,UAAAA,EAAU1B,kBAAV,eAAsBxG,aAEnBmI,EAAgCN,EAAhCM,QAASC,EAAuBP,EAAvBO,oBAEd1E,EAOEyE,EAPFzE,SACA2E,EAMEF,EANFE,WACA7N,EAKE2N,EALF3N,WACA8N,EAIEH,EAJFG,cACAC,EAGEJ,EAHFI,YACAC,EAEEL,EAFFK,aACAnB,EACEc,EADFd,QAEI1H,EAAa2I,EAAgB,IAAI7I,GAAW8I,EAAaC,QAAgBhW,EAC/E,gBAAMmU,EAAIK,YACRtD,EACA2E,EACAhB,GAAWV,EAAIS,mBACfpH,EACAL,EACAnF,EACAmM,EAAI/G,cACJiI,EAAiBM,aACjB3V,OACAA,OACAA,EACA4V,GAZF,SAzBD,4CA0CC,uBAAMzB,EAAIM,YAAV,SA1CD,4CA8CC,uBAAMN,EAAIO,cAAV,SA9CD,4CAkDC,uBAAMP,EAAIjE,kBACR,CAAC4E,WAAYO,EAAiBY,QAAS9F,cAAc,IADvD,SAlDD,4CAwDC,uBAAMgE,EAAIvF,WACRyG,EAAiBzd,IACjByd,EAAiBxG,cACjBwG,EAAiBM,QAAQd,SAH3B,SAxDD,YA6DK5Q,GAAgBkQ,EAAI/G,eAAe8I,SA7DxC,iBA8DG,uBAAM/B,EAAIM,YAAV,SA9DH,sDAqEwB,IAAI0B,SAAS,WAAYd,EAAiBe,OAC/DC,CAAalC,EAAIC,cAtEpB,yDAwEOkC,EAAU,oDAAsDjB,EAAiBe,OAAS,OAAS,KAAEE,QACrG,KAAEC,aACJD,GAAY,OAAS,KAAEC,YACnB,IAAIzf,MAAMwf,GA3EnB,0JAAA/F,IAAA,kDAASwE,EAAT,gCG9EF,SAASyB,GAAY7c,GAC1B,OAAOqJ,GAAarJ,GAAK8c,SCApB,SAASC,GAAkB/c,GAChC,iBAAO,SAAS+c,IAAT,uEAEL,OADMhQ,EAAaD,GAAc9M,GACjC,gBAAM+M,EAAWiQ,mBAAjB,QAFK,OAGLH,GAAY7c,GAAKid,gBAAgBlQ,EAAWmQ,OAHvC,oCAASH,MCDX,SAASI,GAAcnd,GAE5B,IADA,IAAIC,EAAKD,IACI,CACX,GAAI+K,GAAY9K,GACd,OAAOA,EAAG0V,WAEZ,GAAkB1V,ECauCmd,kBDZvD,OAAOnd,EAETA,EAAKA,EAAGC,QEVL,SAASmd,GAAqBrd,GACnC,OCDK,SAA6BA,GAClC,OAAOmd,GAAcnd,GAAKsd,ODAnBC,CAAoBvd,GACxB1B,KAAI,SAAAkf,GAAK,OAAIA,EAAMlQ,QACnBmQ,QAAO,SAAAnQ,GAAI,OAAKA,EAAKvL,WAAW,SEH9B,SAAS2b,GAAyB1d,GACvC,OAAOmd,GAAcnd,GAAK2d,sBCDrB,SAASC,GAAU5d,GACxB,OAAOiL,GAAYjL,GAAKsY,gBCAnB,SAASuF,GAAoB7d,EAAU8d,GAC5C,OAAOxT,GAAgBtK,GAAKsI,QAAQ+L,WAAYG,UAAUkG,MACxD,SAAAC,GAAI,OAAIiD,GAAUjD,KAAUmD,KCHzB,SAASC,GAAqB/d,GACnC,IAAMge,EAAe1T,GAAgBtK,GACrC,SAAIge,EAAaC,aAAcD,EAAaE,qBACxCF,EAAa1V,SAAY0V,EAAa1V,QAAQ6V,YACzCH,EAAa1V,QAAQ+L,WAAY3K,QCJrC,SAAS0U,GAAkBpe,GAChC,OAAOyK,GAAczK,GAAKqe,aCnBrB,SAASC,GAAete,GAC7B,IAAMue,EAAcxe,EAAeC,GAAKue,YACxC,IAAKA,EACH,MAAM,IAAIphB,MAAM,kCAElB,OAAOohB,ECcF,SAASC,GAAiBxe,GAC/B,OAAOqJ,GAAarJ,GAAKye,cCFpB,SAASC,GAA8B1e,GAC5C,OAAOwe,GAAiBxe,GAAKkd,MAAMO,QAAO,SAAA9C,GAAI,OAAKA,EAAK4B,YCDnD,SAASoC,GAAgB3e,GAC9B,OAAOwe,GAAiBxe,GAAK4e,WCCxB,ICFKC,GDECC,GAAb,iDACEC,oBAAqB,EADvB,KAEEC,qBAAsB,EAFxB,KAGEC,kBAAmB,EAHrB,KAIEC,kBAAmB,EAJrB,KAKEC,kBAAmB,EALrB,KAMEC,yBAA0B,EAN5B,KAOEC,cAAe,EAPjB,KAQEC,QAAUpP,GAAE,OAAQ,QARtB,mDAUE,SAAgBqP,GACd,OAAOA,IAXX,0DAcE,WAAYvf,GAAZ,SAAAwB,EAAA,+EACS,IAAIge,IADb,2CAdF,mFAkBE,WACE,OAAO,IAAIA,OAnBf,KAuBaC,GAAb,iDACEV,oBAAqB,EADvB,KAEEC,qBAAsB,EAFxB,KAGEC,kBAAmB,EAHrB,KAIEC,kBAAmB,EAJrB,KAKEC,kBAAmB,EALrB,KAMEC,yBAA0B,EAN5B,KAOEC,cAAe,EAPjB,KAQEC,QAAUpP,GAAE,QAAS,qBARvB,mDAUE,SAAgBqP,GACd,OAAO,IAXX,0DAcE,WAAYvf,GAAZ,SAAAwB,EAAA,+EACS,IAAIge,IADb,2CAdF,mFAkBE,WACE,OAAO,IAAIV,OAnBf,KAuBaY,GAAb,iDACEX,oBAAqB,EADvB,KAEEC,qBAAsB,EAFxB,KAGEC,kBAAmB,EAHrB,KAIEC,kBAAmB,EAJrB,KAKEC,kBAAmB,EALrB,KAMEC,yBAA0B,EAN5B,KAOEC,cAAe,EAPjB,KAQEC,QAAUpP,GAAE,SAAU,uBARxB,mDAUE,SAAgBqP,GACd,OAAO,IAXX,0DAcE,WAAYvf,GAAZ,SAAAwB,EAAA,+EACS,IAAIge,IADb,2CAdF,mFAkBE,WACE,OAAO,IAAIV,OAnBf,KAuBaa,GAAb,WASE,WACSC,EACAN,EACAO,EACPR,GACD,yBAJQO,YAIT,KAHSN,UAGT,KAFSO,mBAET,KAbAd,oBAAqB,EAarB,KAZAC,qBAAsB,EAYtB,KAXAC,kBAAmB,EAWnB,KAVAC,kBAAmB,EAUnB,KATAC,kBAAmB,EASnB,KARAC,yBAA0B,EAQ1B,KAPAC,cAAe,EAQb5iB,KAAK4iB,aAAL,OAAoBA,QAApB,IAAoBA,KAfxB,mDAkBE,SAAgBE,GACd,OAAO,IAnBX,0DAsBE,WAAYvf,GAAZ,eAAAwB,EAAA,yFACS/E,KAAKojB,wBADd,QACkC,IAAIL,IADtC,gDAtBF,mFA0BE,WACE,OAAO,IAAIV,OA3Bf,KA+BagB,GAAb,WAUE,WACSF,EACAC,GACR,yBAFQD,YAET,KADSC,mBACT,KAZAd,oBAAqB,EAYrB,KAXAC,qBAAsB,EAWtB,KAVAC,kBAAmB,EAUnB,KATAC,kBAAmB,EASnB,KARAC,kBAAmB,EAQnB,KAPAC,yBAA0B,EAO1B,KANAC,cAAe,EAMf,KALAC,QAAU,GARZ,mDAgBE,SAAgBC,GACd,OAAO,IAjBX,0DAoBE,WAAYvf,GAAZ,eAAAwB,EAAA,yFACS/E,KAAKojB,wBADd,QACkC,IAAIL,IADtC,gDApBF,mFAwBE,WACE,OAAO,IAAIV,OAzBf,KA6BaU,GAAb,iDACET,oBAAqB,EADvB,KAEEC,qBAAsB,EAFxB,KAGEC,kBAAmB,EAHrB,KAIEC,kBAAmB,EAJrB,KAKEC,kBAAmB,EALrB,KAMEC,yBAA0B,EAN5B,KAOEC,cAAe,EAPjB,KAQEC,QAAU,GARZ,mDAUE,SAAgBC,GACd,OAAO,IAXX,0DAcE,WAAYvf,GAAZ,eAAAwB,EAAA,2DACQue,EAAepB,GAAgB3e,IADvC,gCAGUggB,GAAsBD,EAAtBC,CAAoC,MAH9C,UAKoC,IADPtB,GAA8B1e,GAClC6E,OALzB,yCAMa,IAAIia,IANjB,gCASSriB,MATT,gDAdF,mFA0BE,WACE,OAAO,IAAIqiB,OA3Bf,KElIO,SAASmB,GAAsBC,GACpC,OAAOnP,eAAI,UAAC,SAASoP,IAAT,iEAER,OAFQ,kBAEFD,EAAK/b,SAFH,6BAIR,OAJQ,yBAIR,gBAAMuM,GAAYwP,EAAKlgB,IAAjB0Q,CAAA,MAAN,QAJQ,sDAASyP,EAAT,kBAUP,SAASC,GAAqBF,GACnC,OAAOD,GAAsBC,EAAtBD,GAGF,SAASI,GAA8BH,GAC5C,OAAOnP,eAAI,UAAC,SAASoP,IAAT,iEAED,OAFC,SAED,gBAAMD,EAAKI,UAAX,QAFC,6CAIR,OAJQ,yBAIR,gBAAM5P,GAAYwP,EAAKlgB,IAAjB0Q,CAAA,MAAN,QAJQ,sDAASyP,EAAT,iBAALpP,GCZF,SAASwP,GAAevgB,GAC7B,OAAOD,EAAeC,GAAKwgB,YAGtB,SAASC,GAAWzgB,EAAUyG,EAAamZ,GAChD,GAAG5O,GAAqBhR,GAAK,CAC3B,IAAM0gB,EAAoBpC,GAAete,GAAK2gB,YACxCC,EAAoB,IAAId,GAAkBF,EAAWc,GAQ3D,OADApC,GAAete,GAAK2gB,YAAcC,EANZ,WACpBR,GAAqB,CAACpgB,IAAKA,EAAKmE,OAAO,WAAD,4BAAE,sBAAA3C,EAAA,sEACIof,EAAkBC,MAAM7gB,GAD5B,OACpCse,GAAete,GAAK2gB,YADgB,kDAAF,kDAAC,MAQ3C,OAAOJ,GAAevgB,GAAK8gB,WAAWra,EAAKmZ,GCtBtC,SAASmB,GAAkB/gB,GAChC,OAAOsK,GAAgBtK,GAAKyJ,SCHvB,SAASuX,GAAQ1iB,GACtB,IAD6C,EACvCqR,EAAiC,GADM,eAE1BrR,EAAIkI,WAFsB,IAE7C,2BAAkC,CAAC,IAAD,yBAAxBya,EAAwB,KAArBC,EAAqB,KAChCvR,EAAOsR,GAAKC,GAH+B,8BAK7C,OAAOvR,EAOF,SAASwR,GAAiBC,GAC/B,GAAKA,EAGL,OAAOA,EACJ5gB,MAAM,KACNid,QAAO,SAAAnP,GAAI,MAAa,KAATA,KACfhQ,KAAI,SAAAgQ,GAAI,OAXb,SAA2BA,GACzB,OAAOA,EAAK9N,MAAM,KAAKlC,KAAI,SAAA+iB,GAAC,OAAIA,EAAEC,UAUnBC,CAAkBjT,MAC9BnI,QAAO,SAACqb,EAAUlT,GAEf,OADAkT,EAAIlT,EAAK,IAAMA,EAAK,GACbkT,IAEP,ICtBD,SAASC,GAAqBzhB,GACnC,OAAOiL,GAAYjL,GAAK0Y,UCDnB,SAASgJ,GAAgB1hB,EAAU2hB,GACxC,iBAAO,SAASD,IAAT,iEACL,uBAAMD,GAAqBzhB,GAAK0hB,gBAAgBC,GAAhD,QADK,oCAASD,MCDX,SAASE,GAAmB5hB,GACjC,OAAOiL,GAAYjL,GAAK6hB,cAAcvjB,KAAI,SAAAwjB,GAAE,OAAIA,EAAGC,iBCD9C,SAASC,GAAUhiB,GACxB,OAAOmd,GAAcnd,GAAKuV,OCDrB,SAAS0M,GAAejiB,GAC7B,OCDK,SAAwBA,GAC7B,OAAOiL,GAAYjL,GAAKkiB,YDAjBC,CAAeniB,GAAKoiB,cEDtB,SAASC,GAAiBriB,GAC/B,OAAOiL,GAAYjL,GAAKoiB,cCDnB,SAASE,GAAkBtiB,GAChC,OAAOiL,GAAYjL,GAAKuiB,eAAejkB,KAAI,SAAAkkB,GAAE,OAAIA,EAAGC,kBCD/C,SAASC,GAAiB1iB,GAC/B,IAAM2iB,EAAML,GAAkBtiB,GAE9B,OADW2iB,EAAI9d,OAAS,EAAI8d,EAAI,QAAKtc,ECDhC,SAASuc,GAAe5iB,GAC7B,IAAM6iB,EAAKH,GAAiB1iB,GAC5B,OAAO6iB,EAAKR,GAAiBQ,QAAMxc,G,SdHzBwY,K,gCAAAA,E,2DAAAA,E,+DAAAA,E,wCAAAA,E,sBAAAA,E,mDAAAA,Q,KeCL,SAAStG,GAAcvY,GAC5B,IAAM8iB,EAAaxY,GAAgBtK,GACnC,OAAO8iB,EAAWjP,aAAeiP,EAAW/O,eAAiB8K,GAAkBkE,qBCH1E,SAASC,GAAahjB,GAC3B,OAAOyK,GAAczK,GAAKijB,UCDrB,SAASC,GAAcljB,GAC5B,OAAOsK,GAAgBtK,GAAK8T,W,ICFlBqP,G,mCCGL,SAASC,GAAYC,GAC1B,OAA2B,IAAvBA,EAAYxe,OAAqB,GACV,IAAvBwe,EAAYxe,OAAqBwe,EAAY,GAC1C,YAAcA,EAAYC,KAAK,MAAQ,IAmBhD,SAASC,GAAcC,GACrB,MAAM,IAAN,OAAWA,EAAMF,KAAK,MAAtB,KAGF,SAASG,GAAsBC,EAAYC,GACzC,IAAMC,EAAc5d,MAAM0Q,QAAQgN,GAC5BG,EAAc7d,MAAM0Q,QAAQiN,GAElC,QAAatd,IAATqd,IAAuBE,QAAwBvd,IAATsd,IAAuBE,EAC/D,OAAON,GAAc,CAACO,GAAkBJ,GAAOI,GAAkBH,KAEnE,GAAIC,QAAwBvd,IAATsd,EACjB,OAAOJ,GAAcG,EAAKplB,KAAI,SAAC+iB,GAAD,OAAYyC,GAAkBzC,OACvD,IAAKuC,QAAwBvd,IAATsd,EACzB,OAAOG,GAAkBJ,GACpB,QAAard,IAATqd,IAAuBG,EAChC,OAAOC,GAAkBH,GAE3B,MAAM,IAAIxmB,MAAJ,iCAAoCumB,EAApC,kBAAkDC,EAAlD,2BAGD,SAASI,GACdC,EACAC,EACAC,EACAR,EACAC,GAEA,GACe,SAAbM,IACc,OAAbC,GAAkC,QAAbA,SACb7d,IAATqd,GACS,KAATA,GACS,OAATA,GACAA,EAAKS,SAAS,iBACd,CACA,IAAMC,EAAa,IAAIC,KAAKX,GAC5BU,EAAWE,QAAQF,EAAWG,UAAY,GAC1C,IAKA,EALuB,IAAIC,KAAKC,eAAe,KAAM,CACnDC,KAAM,UACNC,MAAO,UACPC,IAAK,YAEkEC,cACvET,GADF,mBAAeO,EAAf,KAAQje,MAAyBke,EAAjC,KAA0Ble,MAGpBoe,EAHN,KAA0Cpe,MAGZqe,OAAO,IAAKJ,EAAO,IAAKC,EAAK,iBACrDI,EAAmC,OAAbd,EAAoB,UAAY,WAC5D,MAAM,KAAN,OAAYF,EAAZ,eAA2BgB,EAA3B,cAAoDvB,GAClDC,EACAoB,GAFF,KAKF,IAAMG,EAAgBznB,KAAO0nB,SAASxB,GAClCyB,gCAAqBzB,GACrBA,EACJ,MAAM,KAAN,OAAYM,EAAZ,eAA2BE,EAA3B,cAAyCT,GAAsBwB,EAAetB,GAA9E,KAGF,SAASG,GAAkBpd,GACzB,YAAcL,IAAVK,EACK,KAEF0e,MAAM1e,GAAS,IAAMA,EAAQ,IAAMA,ECvFrC,SAAS2e,GAAuBrlB,GACrC,OAAO6S,GAAkB7S,GAAKslB,oBCCzB,SAASC,GAAerF,GAO7B,OAAOkD,GALqBiC,GADXpa,GAAYiV,EAAKlgB,MAEKwlB,cACpC/H,QAAO,SAAAA,GAAM,OAAKyC,EAAKuF,mBAAqBvF,EAAKuF,oBAAsBhI,EAAOiI,cAC9EjI,QAAO,SAAAA,GAAM,OAAIA,EAAOkI,QAAQC,cAChCtnB,KAAI,SAAAmf,GAAM,OFMR,SAA4BA,GACjC,OAAOsG,GACLtG,EAAOiI,WACPjI,EAAOwG,SACPxG,EAAOkI,QAAQlqB,KACfgiB,EAAOkI,QAAQE,aACfpI,EAAOkI,QAAQG,cEZAC,CAAmBtI,OCR/B,SAASuI,GAAyBhmB,GACvC,OAAO6S,GAAkB7S,GAAKimB,sBJkCzB,SAASC,GAAyBjY,GACvC,OAAQA,GACN,IAAK,aACH,OAAOkV,GAAkBgD,KAC3B,IAAK,YACH,OAAOhD,GAAkBiD,IAC3B,UAAK/f,EACH,OAAO8c,GAAkBkD,KAC3B,QACE,MAAM,IAAIlpB,MAAM,2BAA6B8Q,IAI5C,SAASqY,GAAgBC,GAC9B,GAAKA,GAA4C,IAA1BA,EAAe1hB,OAEtC,OAAO0hB,EAAe9I,QAAO,SAAAxP,GAAS,OAAIA,EAAUuP,OAASvP,EAAUuY,aACpEloB,KAAI,SAAA2P,GACH,MAAO,CACL+V,SAAU/V,EAAUuP,MACpBgJ,UAAWN,GAAyBjY,EAAUuY,WAC9Cha,cAAUnG,MKrDX,SAASogB,GAAgBzmB,GAC9B,IAAMnC,EAAWoN,GAAYjL,GACvBimB,EAAwBD,GAAyBnoB,GACjD6oB,EAAmBT,EAAsBU,sBAC/C,GAAgC,IAA5BD,EAAiB7hB,OAAc,CACjC,IAAM8Y,EAAwBD,GAAyB7f,GACvD,MAAM,IAAIV,MAAJ,2DAA8DwgB,EAA9D,+DAER,OAAsD,IAA/CsI,EAAsBW,cAAc/hB,OACvC6hB,EACAT,EAAsBW,cACrBnJ,QAAO,SAAAoJ,GAAQ,OAAIA,EAASL,YAAcrD,GAAkBkD,QC8B5D,SAASS,GACdC,EACAC,EACAC,EACAC,EACAC,GAEA,IAAMC,EArDD,SACLC,EACAJ,EACAK,GAMA,IAJA,IAGI7e,EAHA8e,EAAY,EACZC,EAAaP,EAAe,EAC1B/W,EAAIoX,EAEHC,GAAaC,GAAY,CAC9B,IAAMC,EAAe7hB,KAAK8hB,OAAOH,EAAYC,GAAc,GAE3D,IADA/e,EAAU4e,EAAcI,IACVvX,EACZqX,EAAYE,EAAe,MACtB,MAAIhf,EAAUyH,GAGnB,OAAOuX,EAFPD,EAAaC,EAAe,GAKhC,OAAO7hB,KAAKgB,IAAI2gB,EAAWC,GAiCIG,CAAcZ,EAAgBE,EAAcC,GACrEU,EA/BD,SACLP,EACAJ,EACAK,GAMA,IAJA,IAGI7e,EAHA8e,EAAY,EACZC,EAAaP,EAAe,EAC1B/W,EAAIoX,EAEHC,GAAaC,GAAY,CAC9B,IAAMC,EAAe7hB,KAAK8hB,OAAOH,EAAYC,GAAc,GAE3D,IADA/e,EAAU4e,EAAcI,IACVvX,EACZqX,EAAYE,EAAe,MACtB,MAAIhf,EAAUyH,GAGnB,OAAOuX,EAFPD,EAAaC,EAAe,GAKhC,OAAO7hB,KAAKiiB,IAAIN,EAAWC,GAWAM,CAAad,EAAgBC,EAAcE,GACtE,MAAO,CAACS,qBAAoBR,0BCrDvB,SAASW,GAAa/nB,GAC3B,OAAOiL,GAAYjL,GAAKqX,UCAnB,SAAS2Q,GAAWhoB,GACzB,IAAInC,EAAWoN,GAAYjL,GAC3B,IAAKnC,EACH,MAAM,IAAIV,MAAM,uEAGlB,OAD2BU,EAAS0a,cAEhC1a,EAASoqB,kBACTpqB,EAASqqB,mB,SRVH/E,K,YAAAA,E,UAAAA,E,aAAAA,Q,KMqEZnd,MAAMmiB,UAAU9U,OAAS,SAAUsH,GACjC,IAAMY,EAAQ9e,KAAK2rB,QAAQzN,GAI3B,OAHIY,GAAS,GACX9e,KAAK4rB,OAAO9M,EAAO,GAEd9e,MAGTuJ,MAAMmiB,UAAUG,QAAU,SAAgBC,GACxC,IAAMjqB,EAAM,IAAI0K,IAUhB,OATAvM,KAAK+rB,SAAQ,SAAC7N,GACZ,IAAMlU,EAAM8hB,EAAU5N,GAChB8N,EAAanqB,EAAIyI,IAAIN,GACtBgiB,EAGHA,EAAWlgB,KAAKoS,GAFhBrc,EAAI0G,IAAIyB,EAAK,CAACkU,OAKXrc,GG1EF,I,MAAMoqB,IAAb,cAME,WAAY1oB,EAAU2oB,EAAiCC,GAAiC,yBAJxF5oB,SAIuF,OAHvF2oB,oBAGuF,OAFvFC,iBAEuF,EACrFnsB,KAAKuD,IAAMA,EACXvD,KAAKksB,eAAiBA,EACtBlsB,KAAKmsB,YAAcA,EATvB,kDAYE,WACwB,IAAD,WACf/qB,EAAWoN,GAAYxO,KAAKuD,KAClC,OAAO8mB,IACL,SAACniB,GAAD,OAAO,EAAKgkB,eAAeE,aAAalkB,MACxC,SAACA,GAAD,OAAO,EAAKgkB,eAAeG,UAAUnkB,KACrClI,KAAKksB,eAAeI,SACpBtsB,KAAKmsB,YAAYI,UACjBvsB,KAAKmsB,YAAYI,WAAjB,oBAA8BnrB,EAASorB,qBAAvC,aAA8B,EAAwB3lB,cAAtD,QAAgE,MApBtE,sBAwBE,WAEE,OAAO7G,KAAKysB,iBAAiB9B,yBA1BjC,qBA6BE,WAEE,OAAO3qB,KAAKysB,iBAAiBtB,uBA/BjC,kDAYGnkB,YAZH,sHAwBGA,YAxBH,+GA6BGA,YA7BH,4EAmCa0lB,IAAb,cAQE,WAAYnpB,EAAU2oB,EAAiCC,GAAiC,yBANxF5oB,SAMuF,OALvF2oB,oBAKuF,OAJvFC,iBAIuF,OAHvFQ,oBAGuF,OAF/E/R,eAE+E,EACrF5a,KAAKuD,IAAMA,EACXvD,KAAKksB,eAAiBA,EACtBlsB,KAAKmsB,YAAcA,EACnBnsB,KAAK2sB,eAAiB,IAAIV,GAAmB1oB,EAAK2oB,EAAgBC,GAClEnsB,KAAK4a,UAAY0Q,GAAa/nB,GAblC,4CAgBE,WAEE,IAAMqpB,EAAqBrB,GAAWvrB,KAAKuD,KAAKspB,eAC7CxhB,WAAU,SAAAyhB,GAAK,OAAIA,EAAMC,cAC5B,OAAOH,EAAqB5sB,KAAK2sB,eAAeK,WAC5C,EACAhtB,KAAK2sB,eAAeK,WAAaJ,IAtBzC,qBAyBE,WAEE,IAAMA,EAAqBrB,GAAWvrB,KAAKuD,KAAKspB,eAC7CxhB,WAAU,SAAAyhB,GAAK,OAAIA,EAAMC,cAC5B,OAAO/sB,KAAK2sB,eAAeM,UAAYL,MA7B3C,4CAgBG5lB,YAhBH,+GAyBGA,YAzBH,4EC/CO,SAASkmB,GAAqB3pB,GACnC,IAEM4pB,EADsBvE,GADXpa,GAAYjL,IAESwlB,cACnC/H,QAAO,SAACA,GAAD,OAAYA,EAAOkI,QAAQC,YAAcnI,EAAOkI,QAAQnZ,YAC/DrG,QAAO,SAAUyjB,EAAsCnM,GAEtD,OADAmM,EAAUnM,EAAOiI,YAAcjI,EAAOkI,QAAQnZ,SACvCod,IACN,IAEL,OAAyC,IAAlCzV,OAAO0V,KAAKD,GAAW/kB,OAAe+kB,OAAYvjB,ECwBpD,I,wEC3BKyjB,GD2BCC,GAAmB,IAGnBC,GAAb,iDACEhqB,IAAW,KADb,KAEE2oB,eAAkC,KAFpC,KAGEC,YAAiC,KAHnC,KAIEqB,cAAoC,KAJtC,KAcEC,iBAdF,OAeEC,mBAA0C,KAf5C,yCAME,WACE,OAAO,eAPX,qBAWE,cAXF,oCAiBE,kHAjBF,qCAoBE,oHApBF,KAwBaC,IAAb,GAoHGjmB,SAAOC,MApHV,cAME,WAAY/G,GAAkC,IAAD,gCAL7CgtB,2BAAgC,EAKa,KAJrCC,mBAIqC,OAHrCC,sBAGqC,OAF7CJ,wBAE6C,OA4E7CD,iBA5E6C,OA6E7CM,yBAAmC,EA7EU,KA8E7CC,uBAAiC,EA9EY,KA+E7C9B,eAAkC,KA/EW,KAgF7CC,YAAiC,KAhFY,KAiF7C5oB,IAAW,KAjFkC,KAkF7CiqB,cAAoC,KAlFS,KAmF7CS,iBAAuC,IAAIC,GAAmB,IAAK,KAnFtB,KA2I7CC,iBAAgD,GA3IH,KAiJ7CC,gBAA+C,GAjJF,KAwKrCC,YAAc/Z,eAAI,UAAC,iGAGpBtU,KAAKsuB,kBAHe,oDAMrBtuB,KAAKguB,yBAA2BhuB,KAAKwtB,cAAce,cAN9B,iDAeZ,OANbvuB,KAAKguB,uBAAyBhuB,KAAKwtB,cAAce,cACjDvuB,KAAK+tB,0BAA4B,EAE3BpqB,EAAMD,EAAO1D,KAAKuD,KAClB4K,EAAsBD,GAAuBlO,KAAKuD,KAb/B,UAeNI,EAAI6qB,QAAQ,CAC7BC,OAAQhI,GAAczmB,KAAKuD,KAC3BmrB,sBAAuBnI,GAAapY,GACpCwgB,sBAAuB1N,GAAyBjhB,KAAKuD,KACrDqrB,OAAQ5uB,KAAK6uB,aACbC,cAAe5B,GAAqBltB,KAAKuD,KACzCwrB,SAAU/E,GAAgBhqB,KAAKuD,KAC/ByrB,SAAU1B,GACV2B,iBAAarlB,EACbslB,WAAY,GACZC,UAAWnvB,KAAKwtB,cAAce,cAC9Ba,YAAaxO,GAAqB5gB,KAAKuD,OA1BhB,QAenB3C,EAfmB,OA4BnByuB,EAAqBrvB,KAAKsvB,gBAChCtvB,KAAKwtB,cAAc+B,cAAc3uB,GAC7BZ,KAAKwtB,cAAcgC,SAAWxvB,KAAKwtB,cAAciC,kBAC7CC,EAAqBL,EAAqB/B,GAC1CqC,EAAS3vB,KAAKksB,eAAeG,UAAUqD,GAC7C1vB,KAAKmsB,YAAYyD,SAAS,CAACrD,UAAWoD,KAExC3vB,KAAKouB,gBAAgBrC,SAAQ,SAAA8D,GAAQ,OAAIA,EAASjvB,MAnCzB,iDAxKkB,KA+MrCkvB,aAAexb,eAAI,UAAC,mGAGrBtU,KAAK+vB,kBAHgB,oDAMpBC,EAAkBhwB,KAAKwtB,cAAcwC,kBACvChwB,KAAK+tB,2BAA6BiC,GAAmBA,EAAkB,GAPjD,iDAeb,OALbhwB,KAAK+tB,yBAA2BiC,EAChChwB,KAAKguB,uBAAyB,EAExBrqB,EAAMD,EAAO1D,KAAKuD,KAClB4K,EAAsBD,GAAuBlO,KAAKuD,KAd9B,UAePI,EAAI6qB,QAAQ,CAC7BC,OAAQhI,GAAczmB,KAAKuD,KAC3BmrB,sBAAuBnI,GAAapY,GACpCwgB,sBAAuB1N,GAAyBjhB,KAAKuD,KACrDqrB,OAAQ5uB,KAAK6uB,aACbC,cAAe5B,GAAqBltB,KAAKuD,KACzCwrB,SAAU/E,GAAgBhqB,KAAKuD,KAC/ByrB,SAAU1B,GACV6B,UAAWa,EACXd,WAAY,GACZD,iBAAarlB,EACbwlB,YAAaxO,GAAqB5gB,KAAKuD,OA1Bf,QAepB3C,EAfoB,OA4BpByuB,EAAqBrvB,KAAKsvB,gBAChCtvB,KAAKwtB,cAAcyC,eAAervB,GAC7BZ,KAAKwtB,cAAc0C,mBAChBR,EAAqBL,EAAqB/B,GAC1CqC,EAAS3vB,KAAKksB,eAAeG,UAAUqD,GAC7C1vB,KAAKmsB,YAAYyD,SAAS,CAACrD,UAAWoD,KAExC3vB,KAAKmuB,iBAAiBpC,SAAQ,SAAA8D,GAAQ,OAAIA,EAASjvB,MAnCzB,iDA9M1B8W,OAAOC,OAAO3X,KAAMY,GACpBZ,KAAKwtB,cAAc2C,uBAAsB,kBAAM,EAAKC,6BACpDpwB,KAAK0tB,mBAAqB,IAAIhB,GAA4B1sB,KAAKuD,IAAKvD,KAAKksB,eAAgBlsB,KAAKmsB,aAC9FnsB,KAAKiuB,iBAAiBxD,QAV1B,0DAaE,uGAIE,OAHM9mB,EAAMD,EAAO1D,KAAKuD,KAClB4K,EAAsBD,GAAuBlO,KAAKuD,KACpDnC,EAAWoN,GAAYxO,KAAKuD,KAHlC,SAIQ4K,EAAoBkiB,oBAAoBjvB,GAJhD,eAKiCwI,IAA3BxI,EAASkvB,cALf,iDAgBe,OAPTlvB,EAASkvB,cAAgBhD,IACrBiD,EAAmBnvB,EAASkvB,cAAiBhD,GAAoBA,GACvEkD,EAAkBpvB,EAASkvB,cAAiBC,GAE5CC,EAAkB,EAbtB,UAgBqB7sB,EAAI6qB,QAAQ,CAC7BC,OAAQhI,GAAczmB,KAAKuD,KAC3BmrB,sBAAuBnI,GAAapY,GACpCwgB,sBAAuB1N,GAAyBjhB,KAAKuD,KACrDqrB,OAAQ5uB,KAAK6uB,aACbC,cAAe5B,GAAqBltB,KAAKuD,KACzCwrB,SAAU/E,GAAgBhqB,KAAKuD,KAC/ByrB,SAAU1B,IACV6B,UAAWqB,EACXtB,WAAY,GACZD,iBAAarlB,EACbwlB,YAAaxO,GAAqB5gB,KAAKuD,OA3B3C,QAgBQ3C,EAhBR,OA6BEZ,KAAKwtB,cAAcjlB,IAAI3H,EAAM4vB,GAAiB,GAE9C,UAAAxwB,KAAK8tB,wBAAL,cAAA9tB,MACA0V,YAAW,WACT,IAAMga,EAAqB,EAAKJ,gBAAkBhC,GAC5CqC,EAAS,EAAKzD,eAAeG,UAAUqD,GAC7C,EAAKvD,YAAYyD,SAAS,CAACrD,UAAWoD,IACtC,EAAKlF,WApCT,iDAbF,qCAqDE,qGACMzqB,KAAKwtB,cAAc0C,iBADzB,iDAMe,OAFPvsB,EAAMD,EAAO1D,KAAKuD,KAClB4K,EAAsBD,GAAuBlO,KAAKuD,KAL1D,SAMqBI,EAAI6qB,QAAQ,CAC7BC,OAAQhI,GAAczmB,KAAKuD,KAC3BmrB,sBAAuBnI,GAAapY,GACpCwgB,sBAAuB1N,GAAyBjhB,KAAKuD,KACrDqrB,OAAQ5uB,KAAK6uB,aACbC,cAAe5B,GAAqBltB,KAAKuD,KACzCwrB,SAAU/E,GAAgBhqB,KAAKuD,KAC/ByrB,SAAU1B,GACV6B,UAAW,EACXD,WAAY,GACZD,iBAAarlB,EACbwlB,YAAaxO,GAAqB5gB,KAAKuD,OAjB3C,OAMQ3C,EANR,OAmBEZ,KAAKwtB,cAAcjlB,IAAI3H,GAEvB,UAAAZ,KAAK8tB,wBAAL,cAAA9tB,MACA0V,YAAW,WACT,IAAMia,EAAS,EAAKzD,eAAeG,UAAU,GAC7C,EAAKF,YAAYyD,SAAS,CAACrD,UAAWoD,IACtC,EAAKlF,WAzBT,iDArDF,2BA2FE,WAEE,OAAOzqB,KAAK0tB,mBAAmBV,aA7FnC,yBAgGE,WAEE,OAAOhtB,KAAKwtB,cAActI,KAAK9c,OAASpI,KAAK0tB,mBAAmBT,YAlGpE,6BAqGE,WAEE,OAAOjtB,KAAKsvB,iBAAmBhC,MAA2BttB,KAAKwtB,cAAc0C,mBAvGjF,6BA0GE,WAEE,OAAOlwB,KAAKywB,eAAiBnD,MAA2BttB,KAAKwtB,cAAciC,kBA5G/E,kCA+GE,WAEE,OAAOzvB,KAAK+vB,mBAAqB/vB,KAAKsuB,oBAjH1C,mBAoHE,WACgB,IAAD,OAyBb,OAxBAtuB,KAAK6tB,cAAgB6C,mBAAQ,eAM7B1wB,KAAK8tB,iBAAmB6C,oBACtB,WACE,MAAO,CACL,EAAKjD,mBAAmBV,WACxB,EAAKU,mBAAmBT,UACxB,EAAK8C,kBACL,EAAKzB,sBAGT,WACM,EAAKyB,mBACP,EAAK9B,iBAAiB2C,SAAQ,kBAAM,EAAKd,kBAEvC,EAAKxB,mBACP,EAAKL,iBAAiB2C,SAAQ,kBAAM,EAAKvC,oBAIxCruB,KAAK8tB,mBA9IhB,qCAmJE,SAAwB+B,GACtB7vB,KAAKmuB,iBAAiBriB,KAAK+jB,KApJ/B,oCAyJE,SAAuBA,GACrB7vB,KAAKouB,gBAAgBtiB,KAAK+jB,KA1J9B,qCA6JE,WACE7vB,KAAK+tB,yBAA2B,EAChC/tB,KAAKguB,uBAAyB,IA/JlC,wBAkKE,WACE,IAAM6C,EAAU,GACZ7wB,KAAKytB,aACPoD,EAAQ/kB,KAAK9L,KAAKytB,aAEpB,IAAMqD,EAAchI,GAAe,CAACvlB,IAAKvD,KAAKuD,MAI9C,OAHIutB,GACFD,EAAQ/kB,KAAKglB,GAERnK,GAAYkK,KA3KvB,qBA2PE,WACM7wB,KAAK8tB,kBACP9tB,KAAK8tB,mBAEH9tB,KAAK6tB,eACP7tB,KAAK6tB,gBAEP7tB,KAAKiuB,iBAAiB8C,UACtB/wB,KAAKmuB,iBAAiB/lB,OAAS,EAC/BpI,KAAKouB,gBAAgBhmB,OAAS,MApQlC,iDA2FGpB,YA3FH,wHAgGGA,YAhGH,0HAqGGA,YArGH,8HA0GGA,YA1GH,mIA+GGA,YA/GH,mMA0QMknB,G,WAQJ,WAAY8C,EAAmCC,GAAwC,yBAN/EC,UAAgD,GAM8B,KAL9EC,eAAyB,EAKqD,KAJrEC,6BAIqE,OAHrEC,wBAGqE,OAF9EC,mBAE8E,EACpFtxB,KAAKqxB,mBAAqBL,EAC1BhxB,KAAKoxB,wBAA0BH,E,yCAGjC,SAAcM,GAAuB,IAAD,OAClC,OAAO,IAAIC,SAAQ,SAAAC,GACjB,EAAKH,cAAgB5b,WAAW+b,EAASF,Q,qBAI7C,SAAQjd,GACNtU,KAAKkxB,UAAUplB,KAAKwI,K,qBAGtB,WACEtU,KAAKmxB,eAAgB,EACrBO,aAAa1xB,KAAKsxB,iB,0DAGpB,4BAAAvsB,EAAA,oEAEW/E,KAAKkxB,UAAU9oB,OAAS,GAFnC,uBAGYupB,EAAc3xB,KAAKkxB,UAAUhgB,QAHzC,SAIYygB,IAJZ,uBAKY3xB,KAAK4xB,MAAM5xB,KAAKoxB,yBAL5B,8CAOUpxB,KAAK4xB,MAAM5xB,KAAKqxB,oBAP1B,YAQQrxB,KAAKmxB,cARb,mH,6DEjWWU,IAAb,8KAIUC,UAAW,EAJrB,wCA2BE,WACE,OAAO9xB,KAAK+xB,SA5BhB,IAME,SAAW9nB,GAAgB,IAAD,OACpBA,EAAQ,IACVA,EAAQ,GAEW,IAAjBjK,KAAK+xB,SAA2B,IAAV9nB,GACxBjK,KAAK8xB,UAAW,EAEhB9xB,KAAKgyB,WAAY,EACjBtc,YAAW,WACJ,EAAKoc,WACR,EAAKG,kBAAmB,KAnBH,MAsBC,IAAjBjyB,KAAK+xB,SAA2B,IAAV9nB,IAC/BjK,KAAKiyB,kBAAmB,EACxBjyB,KAAKgyB,WAAY,EACjBhyB,KAAK8xB,UAAW,GAElB9xB,KAAK+xB,QAAU9nB,MAxBnB,4CACGjI,cADH,yEACwB,KADxB,gDAEGA,cAFH,yEAEiC,KAFjC,yCAGGA,cAHH,yEAG0B,KAH1B,ICuBakwB,IAAb,GAUGxqB,SAAOC,MAVV,GA0CGD,SAAOC,MA1CV,GAwEGD,SAAOC,MAxEV,oDACEwqB,yBAA8B,EADhC,KAEEC,QAA2B,IAAIP,GAFjC,KAQEQ,UAAmB,GARrB,KAiBEC,yBAA2Bhe,eACzB,iGACQlT,EAAWoN,GAAYxO,MAD/B,SAGIA,KAAKoyB,QAAQG,UACThZ,GAAiBvZ,MAJzB,mBAKWkO,GAAuBlO,MAAMwyB,6BAA6BpxB,GALrE,gBAMQ,uBAAMpB,KAAKoc,kBAAX,QANR,OAQM,uBAAMpc,KAAKmd,mBAAX,QARN,kCC3CK3O,GDoD6BxO,MCpDZyyB,gBD2CtB,iBAUM,uBAAMzyB,KAAKmd,mBAAX,SAVN,gCAcI,OAdJ,0BAcI,gBAAMlJ,GAAYjU,KAAZiU,CAAA,MAAN,SAdJ,4CAiBIjU,KAAKoyB,QAAQG,SAjBjB,4EAmBEG,KAAK1yB,OArCX,KAwCE2yB,kCAxCF,OA2FEC,8BA3FF,OA2NEnvB,YA3NF,6CAIE,WACE,OAAOzD,KAAKoyB,QAAQH,mBALxB,mBAUE,WAEMnW,GAAc9b,OAChBA,KAAKqyB,UAAUvmB,KAAK9L,KAAKqc,8BAb/B,6EA0CE,WAC+BwW,GAD/B,kFAEMA,EAFN,gCAGU7yB,KAAKsyB,2BAHf,cAMQQ,EAAO9yB,KANf,kBAOUA,KAAK2yB,6BAA+BhC,oBAC1C,WACE,OAAO/K,GAAiB,MAE1B,kBAAMkN,EAAKR,6BACX,CAACS,OAAQC,WAASC,cAZtB,gDA1CF,oIA0DE,WAA+BvrB,GAA/B,eAAA3C,EAAA,yDACMmuB,GAAa,EADnB,SAGIA,EAAalzB,KAAKkc,2BACdxU,EAJR,gCAKY4M,eAAK5M,EAAL4M,GALZ,oBAQQ4e,EARR,kCASYlzB,KAAKqc,0BAAyB,GAT1C,wFA1DF,4FAwEE,WACE,QAAIrc,KAAK2yB,+BACP3yB,KAAK2yB,+BACL3yB,KAAK2yB,kCAA+B/oB,GAC7B,KA5Eb,uCAiFE,WAAiBsb,GAAjB,+EACetb,IAATsb,GAA+B,OAATA,EAD5B,gBAGI,OADM9jB,EAAWoN,GAAYxO,MAFjC,SAGUoB,EAAS+xB,WAAWjO,GAH9B,OAII9jB,EAASgyB,iBAJb,sBAMI,uBAAMpzB,KAAKqzB,cAAX,QANJ,gDAjFF,uCA6FE,sFAMuB,OANvB,SAEIrzB,KAAKoyB,QAAQG,SACP5uB,EAAMD,EAAO1D,MACnBA,KAAK4yB,0BAA4B5yB,KAAK4yB,2BACtC5yB,KAAK4yB,yBAA2BjvB,EAAI2vB,kBALxC,SAM6B3vB,EAAI4vB,gBAC3B,CACE7E,sBAAuBnI,GAAavmB,MACpCwzB,OAAQjO,GAAUvlB,MAClByzB,MAAO7N,GAAiB5lB,OAE1BA,KAAK4yB,0BAZX,OAcI,OARMlU,EANV,OAcI,gBAAM5E,GAAkB9Z,KAAM0e,GAA9B,QAdJ,OAeI1Q,GAAchO,MAAM0zB,iBAfxB,sDAiBQC,IAAMC,SAAN,MAjBR,uFAwBI5zB,KAAKoyB,QAAQG,SAxBjB,6EA7FF,+BAyHE,SAAkBnxB,GAChB,IADqC,EAC/BwlB,EAAc,GADiB,eAEjBxlB,EAAS0kB,gBAFQ,IAErC,2BAA6C,CAAC,IAArC+N,EAAoC,QACrCzY,EAAcyY,EAAQ7N,eAAe5K,YAC3C,GAAKA,EAAL,CAF2C,qBAKnByY,EAAQC,cALW,IAK3C,2BAA8C,CAAC,IAAtCC,EAAqC,QACtCC,EAAgBH,EAAQ7N,eAAe9M,WAAW+a,eACtDF,EAAYG,kBAEd,GAAKF,EAAL,CAGA,IAAMG,EAAcN,EAAQ7N,eAAepL,UAAUwZ,8BACnDhZ,EACA4Y,GAEIK,EAAeR,EAAQvO,cAAcpM,WAAW+a,eACpDF,EAAYO,iBAETD,GAGLzN,EAAY9a,KAAKwb,GAAa+M,EAAaxjB,KAAM,KAAMsjB,MAtBd,iCAFR,8BA2BrC,OAAOxN,GAAYC,KApJvB,mCAwJE,wGAEI5mB,KAAKoyB,QAAQG,SACPnxB,EAAWoN,GAAYxO,MACvB2D,EAAMD,EAAO1D,OAEfoB,EAASmzB,cAAiBnzB,EAASozB,aAAc1Y,GAAc9b,MANvE,oBAO6C,IAAnCoB,EAAS0kB,eAAe1d,OAPlC,gBAQQxH,EAAO,CAACQ,EAAS0kB,eAAe,GAAGE,eAAe5K,aAR1D,uBAUe,OAVf,UAUqBzX,EAAI6qB,QAAQ,CACvBC,OAAQhI,GAAcrlB,GACtBstB,sBAAuBnI,GAAavmB,MACpC2uB,sBAAuB1N,GAAyB7f,GAChDwtB,OAAQ5uB,KAAKy0B,kBAAkBrzB,GAC/B0tB,cAAe5B,GAAqB9rB,GACpC2tB,SAAU,GACVC,SAAU1B,GACV2B,iBAAarlB,EACbulB,UAAW,EACXD,WAAY,GACZE,YAAaxO,GAAqBxf,KArB5C,QAUQR,EAVR,0CAyBY8zB,EAAcvO,GAAenmB,MAC7B20B,EAAcnP,GAAexlB,MAC3B00B,GAAgBC,EA3B9B,sBA4BU,GA5BV,wBA6BU,OA7BV,UA6BgB3mB,GAAchO,MAAM40B,QAAQrP,GAAUvlB,MAAOoB,EAASya,gBAAiB6Y,EAAaC,GA7BpG,4BA2BM/zB,EA3BN,aA+BI,OA/BJ,UA+BUQ,EAAS+xB,WAAWvyB,GA/B9B,QAgCIQ,EAASgyB,iBAhCb,yBAkCIpzB,KAAKoyB,QAAQG,SAlCjB,2EAxJF,wCA8LE,sFAKI,OALJ,SAEIvyB,KAAKoyB,QAAQG,SACPzZ,EAASyM,GAAUvlB,MACnBoB,EAAWoN,GAAYxO,MAJjC,SAKUwxB,QAAQqD,IACZ1P,GAAmBnlB,MAAM6B,KAAI,SAAAyjB,GAAa,OACxChR,eAAI,UAAC,0FAEmBiR,GAAUD,KACVxM,IAAUwM,EAAcwP,YAH3C,gBAIC,uBAAM7P,GAAgBK,EAAelkB,EAASwZ,UAAUma,QAAlD9P,GAAN,QAJD,6BAMC,uBAAMA,GAAgBK,EAAhBL,GAAN,QAND,8BASD,OATC,yBASD,gBAAMhR,GAAYqR,EAAZrR,CAAA,MAAN,SATC,wDAALK,OAPR,uBAyBItU,KAAKoyB,QAAQG,SAzBjB,yEA9LF,iZEtBayC,IAAb,GA0FGttB,SAAOC,MA1FV,oDACEstB,eAIM,GALR,sIAUEC,UAAW,EAVb,KAWExT,WAAY,EAXd,KAaEyT,YAAyD,GAb3D,KAcEC,kBAAoB,EAdtB,yCAwFEC,YAAcvtB,KAAEwtB,SAASt1B,KAAKu1B,eAAe7C,KAAK1yB,MAAO,KAxF3D,KAgGEyD,YAhGF,6CAkBE,WACE,OAAOzD,KAAKuyB,OAAS,IAnBzB,oEAsBE,WAAsBiD,GAAtB,0BAAAzwB,EAAA,uEAMU0wB,EAAez1B,KAAKi1B,eAAehX,MACvC,SAACyX,GAAD,OAAOA,EAAE5lB,WAAa0lB,EAAM1lB,UAAY4lB,EAAEjH,SAAW+G,EAAM/G,YAGrDkH,EAAc,IAAIC,IAAIH,EAAaI,UACzCL,EAAMK,SAAS9J,SAAQ,SAACnsB,GAAD,OAAQ+1B,EAAYG,IAAIl2B,MAC/C61B,EAAaI,SAAWtsB,MAAMC,KAAKmsB,IAEnC31B,KAAKi1B,eAAenpB,KAAK0pB,GAE3Bx1B,KAAK+1B,qBACL/1B,KAAKo1B,oBAjBT,SAkBUY,gBAAK,kBAAM,EAAKC,aAAe,EAAKC,gBAlB9C,WAmBQl2B,KAAKk2B,aAnBb,sBAoBYl2B,KAAKk2B,aApBjB,cAsBUhjB,EAASlT,KAAKm1B,YAAYK,EAAM1lB,WAAa,GAtBvD,kBAuBWoD,GAvBX,yBAyBIlT,KAAKo1B,oBAC0B,IAA3Bp1B,KAAKo1B,oBACPp1B,KAAKm1B,YAAc,GACnBn1B,KAAKk2B,kBAAetsB,GA5B1B,2EAtBF,0HAuDE,4BAAA7E,EAAA,sDACQ+tB,EAAO9yB,KACbsU,eAAI,UAAC,0FACCwe,EAAKpR,UADN,iDAIHoR,EAAKpR,WAAY,EAJd,SAMDoR,EAAKP,SANJ,WAOMO,EAAKoC,SAPX,iBAcO,OANAvxB,EAAMD,EAAOovB,GACnBA,EAAKoC,UAAW,EACVM,EAAQ1C,EAAKmC,eACnBnC,EAAKmC,eAAiB,GAXvB,+BAaMnC,EAAKqC,aAbX,UAcaxxB,EAAIwyB,kBAAkBX,GAdnC,oBAYC1C,EAAKqC,aAZN,mBAgBMrC,EAAKoC,WACRpC,EAAKmD,aAAc,GAjBtB,+CAuBD,OAvBC,0BAuBD,gBAAMhiB,GAAY6e,EAAZ7e,CAAA,MAAN,SAvBC,yBAyBD6e,EAAKP,SACLO,EAAKpR,WAAY,EA1BhB,4EAALpN,GAFF,gDAvDF,sFA0FE,WACEtU,KAAKi2B,aAAc,EACnBj2B,KAAKk1B,UAAW,EAChBl1B,KAAKq1B,kBA7FT,qDAOGrzB,cAPH,yEAOiC,KAPjC,2CAQGA,cARH,yEAQ4B,KAR5B,4CASGA,cATH,oGAgBGA,cAhBH,yEAgBuB,KAhBvB,sCAkBGgF,YAlBH,gNCNO,SAASovB,GAAqBC,GACnC,GAAmB,IAAfA,GAAmC,OAAfA,QAAsCzsB,IAAfysB,EAG/C,MACE,KACCA,EAAa,EAAIA,EAAa,WAAa,EAAIA,GAC7CC,SAAS,IACTlsB,OAAO,GACPmsB,cACAC,SAAS,EAAG,KAIZ,SAASC,GAAqBC,GACnC,YAAkB9sB,IAAd8sB,GAAyC,OAAdA,EACtBA,GAELA,EAAUpxB,WAAW,OACvBoxB,EAAYA,EAAUtsB,MAAM,IAEX5J,SAASk2B,EAAW,M,SLX7BrJ,K,kBAAAA,E,eAAAA,Q,KAKL,IAAMsJ,IAAb,GA6HGjvB,SAAOC,MA7HV,GA8JGD,SAAOC,MA9JV,GA2KGD,SAAOC,MA3KV,cAIE,WAAY/G,GAAsB,yBAHlCg2B,gBAAqB,EAGY,KAFjCC,uBAAiC,EAEA,KAIjCzE,QAA2B,IAAIP,GAJE,+GAgBjCiF,WAA6C,IAAIvqB,IAhBhB,qDAqBjCgpB,eAAiBjhB,eACf,4HACMtU,KAAK+2B,mBADX,iDAIMC,EAAmD,IAAIzqB,IACvD0qB,GAAmB,EALzB,0CAS8Bj3B,KAAK82B,WAAWrtB,UAT9C,IASQ,6BAASytB,EAAuC,SACjCC,OAAUD,EAAUE,SAAYF,EAAUG,gBACrDL,EAAiBzuB,IAAI2uB,EAAUC,MAAOD,GAXlD,0BAAA/c,IAAA,GAcQ8c,EAAmB1tB,MAAMC,KAAKwtB,EAAiBvtB,UAAU6tB,OAAM,SAAAJ,GAAS,OAAKA,EAAUL,yBACpFI,GACDj3B,KAAKoyB,QAAQG,SAEe,IAA1ByE,EAAiBpwB,KAlB7B,oEAqB8BowB,EAAiBvtB,UArB/C,IAqBQ,2BAAiD,QACrC4tB,eAAiBhK,GAASkK,QAtB9C,0BAAApd,IA0BuB,OAFfna,KAAK+2B,oBAAqB,EACpBpzB,EAAMD,EAAO1D,MAzB3B,UA0B6B2D,EAAI6zB,aAAa,CACpC9I,sBAAuBnI,GAAavmB,MACpCwzB,OAAQjO,GAAUvlB,MAClBy3B,IAAKluB,MAAMC,KAAKwtB,EAAiBvtB,UAAU5H,KAAI,SAAAq1B,GAAS,OAAIA,EAAUC,WA7BhF,QA0BcO,EA1Bd,OA+BQ13B,KAAK+2B,oBAAqB,EAC1B/2B,KAAK23B,uBAAwB,EAhCrC,eAiC0BD,GAjC1B,IAiCQ,2BAAS5f,EAAiB,QACxB9X,KAAKqZ,SAASvB,GACd9X,KAAK82B,WAAWxsB,IAAIwN,EAAMlY,IAAKy3B,oBAAiBztB,EAnC1D,0BAAAuQ,IAAA,kDAsCQna,KAAK+2B,oBAAqB,EAC1B/2B,KAAK23B,uBAAwB,EAvCrC,eAwC8BX,EAAiBvtB,UAxC/C,IAwCQ,2BAAiD,QACrC4tB,eAAiBhK,GAASuK,MAzC9C,0BAAAzd,IA2CQ,uBAAOlG,GAAYjU,KAAZiU,CAAA,MAAP,SA3CR,yBA6CWgjB,GACDj3B,KAAKoyB,QAAQG,SAEfyE,EAAiBjL,SAAQ,SAAAmL,GAAS,OAAIA,EAAUL,uBAAwB,KACxEG,EAAiB3Z,QAjDzB,6DAsDIrd,KAAK63B,+BAA4BjuB,EAtDrC,uFAwDE8oB,KAAK1yB,OA9EwB,KAiFjCq1B,YAAcvtB,KAAEC,SAAS/H,KAAKu1B,eAAgB,KAjFb,KAoLjC9xB,YApLiC,EAC/BiU,OAAOC,OAAO3X,KAAMY,GALxB,2CAUE,WACE,OAAOZ,KAAKoyB,QAAQH,mBAXxB,2BAgBE,WACE,OAAQjyB,KAAK23B,wBAjBjB,sBAuFE,SAASR,GAAgB,IAAD,WACjBn3B,KAAK82B,WAAWgB,IAAIX,IACvBn3B,KAAK82B,WAAWvuB,IAAI4uB,EAAO,IAAIY,GAAkBZ,IAEnD,IAciF,EAE1E,EAhBHD,EAAYl3B,KAAK82B,WAAWxsB,IAAI6sB,GAcpC,OAbKD,EAAUc,OACbd,EAAUL,sBAAwB72B,KAAK62B,sBACvCK,EAAUc,KAAOC,qBAAW,kBAAD,OACPd,EADO,MAEzB,kBACEe,uBAAsB,WACpB,EAAK7C,oBAET,gBAIJ,aAAA6B,EAAUc,MAAKG,sBAAf,iBACIn4B,KAAK63B,2BAA6B73B,KAAK63B,0BAA0BC,IAAIX,GACvE,UAAOn3B,KAAK63B,0BAA0BvtB,IAAI6sB,UAA1C,aAAO,EAA2CiB,aAElD,UAAOp4B,KAAK82B,WAAWxsB,IAAI6sB,UAA3B,aAAO,EAA4BiB,eA5GzC,+DAgHE,WAAiBC,GAAjB,mBAAAtzB,EAAA,qEACsBszB,GADtB,IACE,2BAAWlB,EAAiB,QACrBn3B,KAAK82B,WAAWgB,IAAIX,IACvBn3B,KAAK82B,WAAWvuB,IAAI4uB,EAAO,IAAIY,GAAkBZ,IAHvD,8CAMQn3B,KAAKu1B,iBANb,gDAhHF,6EAyHE,SAAS4B,GACP,OAAOn3B,KAAK82B,WAAWgB,IAAIX,KA1H/B,sBA6HE,SACSrf,GACP,IAAIsgB,EAAe,IAAIE,GACrBxgB,EAAMlY,GACNkY,EAAMygB,YACNzgB,EAAM0gB,YACNpC,GAAqBte,EAAM2gB,iBAC3BrC,GAAqBte,EAAMhE,iBAC3B,IAAIvH,IACFuL,EAAM4gB,QAAQ72B,KAAI,SAACD,GACjB,IAAM+2B,EAAK,IAAIC,GACbh3B,EAAOiP,KACPjP,EAAOi3B,aACPzC,GAAqBx0B,EAAO62B,iBAC5BrC,GAAqBx0B,EAAOkS,iBAC5BlS,EAAOk3B,UACPl3B,EAAOm3B,aAET,MAAO,CAACn3B,EAAOiP,KAAM8nB,OAGzB,IAAI/C,IAAI9d,EAAMkhB,iBACdlhB,EAAMmhB,WAEHj5B,KAAK82B,WAAWgB,IAAIhgB,EAAMlY,KAC7BI,KAAK82B,WAAWvuB,IAAIuP,EAAMlY,GAAI,IAAIm4B,GAAkBjgB,EAAMlY,KAE5D,IAAMs3B,EAAYl3B,KAAK82B,WAAWxsB,IAAIwN,EAAMlY,IAC5Cs3B,EAAWkB,aAAeA,EAC1BlB,EAAWE,SAAU,EACrBp3B,KAAK23B,uBAAwB,IA3JjC,oBA8JE,WAEE33B,KAAK63B,0BAA4B,IAAItrB,IAAIvM,KAAK82B,WAAW/sB,WAFpC,qBAIS/J,KAAK82B,WAAWrtB,UAJzB,IAIrB,2BAAwD,CAAC,IAAD,QAA/CyvB,EAA+C,QACtD,UAAAA,EAAkBlB,YAAlB,mBAAwBmB,mCAAxB,SAAqD9b,QACrD,UAAA6b,EAAkBlB,YAAlB,mBAAwBoB,iCAAxB,SAAmD/b,QACnD6b,EAAkBlB,UAAOpuB,EACzBsvB,EAAkB9B,SAAU,EAC5B8B,EAAkB7B,oBAAiBztB,GAThB,iCA9JzB,sBA2KE,WAA0B,IAAD,iBACO5J,KAAK82B,WAAWrtB,UADvB,IACvB,2BAAwD,CAAC,IAAD,QAA/CyvB,EAA+C,QACtD,UAAAA,EAAkBlB,YAAlB,mBAAwBmB,mCAAxB,SAAqD9b,QACrD,UAAA6b,EAAkBlB,YAAlB,mBAAwBoB,iCAAxB,SAAmD/b,QACnD6b,EAAkBlB,UAAOpuB,EACzBsvB,EAAkB9B,SAAU,EAC5B8B,EAAkB7B,oBAAiBztB,GANd,8BAQvB5J,KAAK23B,uBAAwB,EAC7B33B,KAAK63B,+BAA4BjuB,MApLrC,0DAcG5H,cAdH,yEAcsC,KAdtC,yDAeGA,cAfH,0GAgBGgF,YAhBH,gIAsBGhF,cAtBH,yEAuBuB,KAvBvB,gVA2Las2B,GACX,WACS14B,EACA24B,EACAC,EACAC,EACA3kB,EACA4kB,EACAM,EACAC,GACN,yBARMr5B,KAQP,KAPO24B,cAOP,KANOC,cAMP,KALOC,kBAKP,KAJO3kB,kBAIP,KAHO4kB,UAGP,KAFOM,kBAEP,KADOC,aAKEL,GACX,WACS/nB,EACAgoB,EACAJ,EACA3kB,EACAglB,EACAC,GACN,yBANMloB,OAMP,KALOgoB,eAKP,KAJOJ,kBAIP,KAHO3kB,kBAGP,KAFOglB,YAEP,KADOC,eAKLhB,I,GAYJ,WACEZ,EACOa,GACN,yBADMA,OACP,KAdKb,WAcL,sFANKE,oBAML,OALKR,uBAAiC,EAMtC72B,KAAKm3B,MAAQA,G,4CAbdn1B,c,qGAGAA,c,yEACyB,K,IMzOrB,SAASw1B,GAAaj0B,GAC3B,OAAOmd,GAAcnd,GAAK4V,SCDrB,SAASkgB,GAAgB91B,EAAU3D,GACxC,OAAO43B,GAAaj0B,GAAK+1B,SAAS15B,GCD7B,SAAS25B,GAA2Bh2B,EAAU4zB,EAAeqC,GAClE,IAAMrgB,EAAWkgB,GAAgB91B,EAAK4zB,GACtC,OAAOhe,GAAWA,EAAS6f,gBAAgBlB,IAAI0B,GCE1C,I,0CAAMC,GAAb,WAGE,WAAY74B,GAAoB,IAAD,gCAF/ByX,cAAmB,EAEY,KAK/BrZ,KAAoB,KALW,KAM/BY,GAAa,GANkB,KAO/B85B,QAAkB,GAPa,KAQ/Bjb,QAAkB,GARa,KAS/Bkb,UAA8B,KATC,KAU/BC,QAAkB,GAVa,KAW/BC,KAAoB,KAXW,KAY/BC,WAAqB,EAZU,KAa/BloB,WAAiC,GAbF,KAqC/BnO,YArC+B,EAC7BiU,OAAOC,OAAO3X,KAAMY,GACpBZ,KAAK4R,WAAWma,SAAQ,SAACje,GAAD,OAAQA,EAAErK,OAAS,KAL/C,2CAkBE,WAAiB,IAAD,OACd,GAAIzD,KAAK65B,OAASrjB,GAAYujB,OAC5B,OAAO,EAGT,OAAQ/5B,KAAK65B,MACX,KAAKrjB,GAAYwjB,aACf,IAAMC,EAAWrU,GAAiB5lB,MAClC,QAAOi6B,IAAYV,GAA2Bv5B,KAAMi6B,EAAUj6B,KAAKJ,IAErE,KAAK4W,GAAY0jB,mBACf,IAAMC,EAAc3rB,GAAYxO,MAAM6O,eACtC,OAAOsrB,EAAYvzB,KAAO,GACrB2C,MAAMC,KAAK2wB,GACXt4B,KAAI,SAACs1B,GAAD,OAAWoC,GAA2B,EAAMpC,EAAO,EAAKv3B,OAC5Dw6B,MAAK,SAAClc,GAAD,OAAUA,KAChBle,KAAK25B,YAAcpjB,GAAiB8jB,QAG5C,OAAO,MArCX,KCJaC,GAGX,WAAY15B,GAA6B,yBAFzC25B,uBAA4B,EAEY,KAIxC1pB,KAAe,GAJyB,KAKxC2pB,UAAoB,GALoB,KAOxC/2B,YAPwC,EACtCiU,OAAOC,OAAO3X,KAAMY,ICKX65B,GACX,WAAY75B,GAAkC,yBAI9C6C,YAJ6C,OAK7CywB,iBAA2B,GALkB,KAM7CI,gBAA0B,GALxB5c,OAAOC,OAAO3X,KAAMY,IAQX85B,IAAb,cAGE,WAAY95B,GAA8B,IAAD,gCAFzC+5B,wBAA6B,EAEY,KAKzCC,SAAmB,GALsB,KAMzCC,aAAuB,GANkB,KAOzCC,QAAkB,GAPuB,KAQzCC,YAAsB,GARmB,KASzCC,kBAA4B,GATa,KAUzClH,aAAwC,GAVC,KA0CzCrwB,YA1CyC,EACvCiU,OAAOC,OAAO3X,KAAMY,GACpBZ,KAAK8zB,aAAa/H,SAAQ,SAAAje,GAAC,OAAKA,EAAErK,OAAS,KAL/C,gDAeE,WAEE,OADeuK,GAAchO,MACfme,6BAA6Bne,KAAK46B,YAjBpD,yBAoBE,WAEE,OADe5sB,GAAchO,MACfme,6BAA6Bne,KAAK86B,WAtBpD,6BAyBE,WACE,IADgC,EAC1BG,EAA0B,GAC1BC,EAAkB5P,GAAatrB,KAAKgmB,gBAFV,eAGfhmB,KAAK8zB,cAHU,IAGhC,2BAAoC,CAAC,IAA5BjiB,EAA2B,QAC5B/P,EAAM9B,KAAKgmB,eAAe5K,YAC1BzL,EAAWurB,EAAgBC,gBAAgBtpB,EAAKqiB,kBAClDpyB,GAAO6N,GACTsrB,EAAEnvB,KAAK,CACL+F,EAAKyiB,gBACL4G,EAAgBn5B,aAAaD,EAAK6N,MATR,8BAahC,OAAOsrB,IAtCX,oCAyCE,WACE,OAAOj7B,KAAKo7B,kBAAkB9D,OAAM,SAAAzlB,GAAI,OAAIA,EAAK,IAAMA,EAAK,UA1ChE,gDAeG7K,YAfH,uHAoBGA,YApBH,0HAyBGA,YAzBH,qIAyCGA,YAzCH,2FCjBaq0B,GAAb,WAGE,WAAYz6B,GAAwB,IAAD,gCAFnC+f,kBAAuB,EAEY,KAMnCld,YANmC,OAQnCqV,OAAiB,GARkB,KASnCoI,sBAAgC,GATG,KAUnCoa,WAAqB,GAVc,KAWnCxe,eAAyB,GAXU,KAYnC+D,OAA6B,GAZM,KAanC1H,SAAsB,KAZpBzB,OAAOC,OAAO3X,KAAMY,GACpBZ,KAAK6gB,OAAOkL,SAAQ,SAAAje,GAAC,OAAKA,EAAErK,OAAS,KACrCzD,KAAKmZ,SAAS1V,OAASzD,KAN3B,kDAkBE,SAAe6Q,GACb,OAAO7Q,KAAK6gB,OAAO5C,MAAK,SAAA8C,GAAK,OAAIA,EAAMlQ,OAASA,OAnBpD,6BAsBE,SAAgBiO,GACd,OAAO9e,KAAK6gB,OAAO5C,MAAK,SAAA8C,GAAK,OAAIA,EAAMjC,QAAUA,SAvBrD,KCFayc,GAGX,WAAY36B,GAA6B,yBAFzC46B,uBAA4B,EAEY,KAIxC/3B,YAJwC,OAKxCoN,KAAe,GALyB,KAMxCiO,MAAgB,EALdpH,OAAOC,OAAO3X,KAAMY,ICHX66B,IAAb,yCACEC,yBAA8B,EADhC,2KAQEj4B,YARF,2CAGGzB,cAHH,yEAGkC,KAHlC,4CAIGA,cAJH,yEAIsC,KAJtC,2CAKGA,cALH,yEAK8C,IAAIuK,OALlD,+CAMGvK,cANH,yEAMkD,IAAIuK,OANtD,ICAO,SAASovB,GAA0Bp4B,EAAUq4B,GAElD,IAAMpH,EAAaoH,EACmB,SAAlCA,EAAmBC,WACnBrtB,GAAYjL,GAAKixB,WAErB,OAAO1Y,GAAcvY,IAAQixB,ECTxB,SAASsH,GAAiBh6B,EAAYi6B,GAE3C,IAAMn8B,GADNkC,EAAG,aAAOA,IACKi6B,GAIf,OAHW,OAAPn8B,QAAsBgK,IAAPhK,IACjBkC,EAAIi6B,GAAJ,UAA0Bn8B,IAErBkC,ECKF,I,eAAMk6B,IAAb,GAiGGt0B,SAAOC,MAjGV,GAkJGD,SAAOC,MAlJV,GAuKGD,SAAOC,MAvKV,cAGE,WAAYs0B,EAAqCx4B,GAAc,yBAF/Dy4B,yBAA8B,EAEgC,KAK9Dz4B,YAL8D,8CAQ7Cw4B,iBAR6C,OAuH9DE,eAAiC,GAvH6B,KAmN9DC,wBAAkC,EAlNhCp8B,KAAKi8B,YAAcA,EACnBj8B,KAAKyD,OAASA,EALlB,oDAaE,SAAiB7D,GACf,IAAMy8B,EAAQr8B,KAAKs8B,iBAAiB18B,GACpC,GAAKy8B,EAGL,OAAOA,EAAME,UAAYF,EAAMG,cAAc58B,KAlBjD,wEAqBE,WAA0BgB,GAA1B,SAAAmE,EAAA,0FArBF,0EAwBE,cAxBF,kBA2BE,cA3BF,gBA8BE,WAEE,OAAO/E,KAAKy8B,UAAUC,SAAQ,SAACL,GAAD,OAAWA,EAAMnX,UAhCnD,mBAmCE,WACE,OAAOllB,KAAKklB,OApChB,gCAuCE,SAAmBvV,GACjB,OAAO3P,KAAKklB,OAxChB,mBA2CE,WACEllB,KAAKy8B,UAAUr0B,OAAS,IA5C5B,oBA+CE,SAAOtG,GACL,IAAMq1B,EAAQn3B,KAAKi8B,YAAYn6B,GACzBu6B,EAAQr8B,KAAKs8B,iBAAiBnF,GACpC,IAAKkF,EACH,MAAM,IAAI37B,MAAJ,uBAA0By2B,EAA1B,oBAERkF,EAAMM,OAAOxF,KArDjB,8BAwDE,SAAiBA,GACf,OAAOn3B,KAAKy8B,UAAUxe,MAAK,SAACoe,GAAD,OAAWA,EAAMvE,IAAIX,QAzDpD,iCA4DE,SAAoByF,GAClB,IAAIC,EAAa,EACjB,GAA8B,IAA1B78B,KAAKy8B,UAAUr0B,OACjB,MAAO,CACLi0B,WAAOzyB,EACPkzB,kBAAclzB,GAL0B,qBAQvB5J,KAAKy8B,WARkB,IAQ5C,2BAAqC,CAAC,IAA7BM,EAA4B,QAC7BD,EAAeF,EAAmBC,EACxC,GAAIC,EAAeC,EAAS7X,KAAK9c,OAC/B,MAAO,CACLi0B,MAAOU,EACPD,aAAcA,GAGlBD,GAAcE,EAAS7X,KAAK9c,QAhBc,8BAkB5C,IAAM40B,EAAYh9B,KAAKy8B,UAAUz8B,KAAKy8B,UAAUr0B,OAAS,GACzD,MAAO,CACLi0B,MAAOW,EACPF,aAAcE,EAAU9X,KAAK9c,UAjFnC,oBAqFE,SAAO0W,EAAehd,EAAY8Z,GAEhC9Z,EAAMg6B,GAAiBh6B,EADLwpB,GAAatrB,MACOi9B,qBACtC,MAA8Bj9B,KAAKk9B,oBAAoBpe,GAAhDud,EAAP,EAAOA,MAAOS,EAAd,EAAcA,aAMd,OALKT,EAGHA,EAAMc,OAAOL,EAAeh7B,GAF5B9B,KAAKy8B,UAAU3wB,KAAK,IAAIsxB,GAAS,EAAG,CAACt7B,GAAM9B,KAAKi8B,iBAAaryB,IAIxD4nB,QAAQC,YA9FnB,wDAiGE,WACU4L,GADV,+FAC2Bd,EAD3B,+BAC+C,EAAGe,EADlD,oCACiF1zB,EACzEgR,EAAY0Q,GAAatrB,MACzBklB,EAAgB,GAHxB,eAIkBmY,GAJlB,IAIE,2BAASv7B,EAAe,QACtBojB,EAAKpZ,KAAKgwB,GAAiBh6B,EAAK8Y,EAAUqiB,sBAL9C,8BAOEj9B,KAAKqd,QACe,IAAhB6H,EAAK9c,QACPpI,KAAKy8B,UAAU3wB,KAAK,IAAIsxB,GAASb,EAAWrX,EAAMllB,KAAKi8B,YAAaqB,IAEtEt9B,KAAKu9B,uBAXP,gDAjGF,+EA+GE,SAAWz7B,GAETA,EAAMg6B,GAAiBh6B,EADLwpB,GAAatrB,MACOi9B,qBAFX,qBAGTj9B,KAAKy8B,WAHI,IAG3B,2BAAkC,CAEhC,GAFgC,QACEe,cAAc17B,GAE9C,QANuB,iCA/G/B,mCA4HE,SAAsB+tB,GACpB7vB,KAAKm8B,eAAerwB,KAAK+jB,KA7H7B,kCAgIE,WAAwB,IAAD,iBACK7vB,KAAKm8B,gBADV,IACrB,2BAA+C,EAC7CsB,EAD6C,YAD1B,iCAhIzB,yBAsIE,WACE,OAAiC,IAA1Bz9B,KAAKy8B,UAAUr0B,OAClBklB,GACAttB,KAAKy8B,UAAUz8B,KAAKy8B,UAAUr0B,OAAS,GAAGm0B,UAAYjP,KAzI9D,2BA4IE,WACE,OAAiC,IAA1BttB,KAAKy8B,UAAUr0B,QAAgBpI,KAAKy8B,UAAU,GAAGF,UAAYjP,GAChE,EACAttB,KAAKy8B,UAAU,GAAGF,UAAYjP,KA/ItC,4BAkJE,SACe+P,GACb,IAD8B,EACxBziB,EAAY0Q,GAAatrB,MACzBklB,EAAgB,GAFQ,eAGdmY,GAHc,IAG9B,2BAAwB,CAAC,IAAhBv7B,EAAe,QACtBojB,EAAKpZ,KAAKgwB,GAAiBh6B,EAAK8Y,EAAUqiB,uBAJd,8BAM9B,GAA8B,IAA1Bj9B,KAAKy8B,UAAUr0B,OAAnB,CAIA,IAAMm0B,EAAYv8B,KAAKy8B,UAAU,GAAGF,UAAYjP,GAC5CiP,EAAY,IAGhBv8B,KAAKy8B,UAAUiB,QAAQ,IAAIN,GAASb,EAAWrX,EAAMllB,KAAKi8B,iBAAaryB,IACnE5J,KAAKy8B,UAAUr0B,OlBvIW,IkBwI5BpI,KAAKy8B,UAAUxrB,YATfjR,KAAKy8B,UAAU3wB,KAAK,IAAIsxB,GAAS,EAAGlY,EAAMllB,KAAKi8B,iBAAaryB,MA1JlE,2BAuKE,SACcyzB,GACZ,IAD6B,EACvBziB,EAAY0Q,GAAatrB,MACzBklB,EAAgB,GAFO,eAGbmY,GAHa,IAG7B,2BAAwB,CAAC,IAAhBv7B,EAAe,QACtBojB,EAAKpZ,KAAKgwB,GAAiBh6B,EAAK8Y,EAAUqiB,uBAJf,8BAM7B,GAA8B,IAA1Bj9B,KAAKy8B,UAAUr0B,OAAnB,CAIA,IAAMm0B,EAAYv8B,KAAKy8B,UAAUz8B,KAAKy8B,UAAUr0B,OAAS,GAAGm0B,UAAYjP,GAClEgQ,EAAUpY,EAAK9c,OAASklB,GACxByP,EAAW,IAAIK,GAASb,EAAWrX,EAAMllB,KAAKi8B,YAAaqB,GAC3DK,EAAgB39B,KAAK49B,qBAAqBb,GAChD/8B,KAAKy8B,UAAU3wB,KAAK6xB,GAChB39B,KAAKy8B,UAAUr0B,OlB5JW,IkB6J5BpI,KAAKy8B,UAAUvrB,aATflR,KAAKy8B,UAAU3wB,KAAK,IAAIsxB,GAAS,EAAGlY,EAAMllB,KAAKi8B,iBAAaryB,MA/KlE,kCA4LE,SAAqBi0B,GACnB,IADuC,EACnCF,EAAgBE,EADmB,eAElB79B,KAAKy8B,WAFa,IAEvC,2BAAqC,CACnCkB,EADmC,QACVG,YAAYH,IAHA,8BAKvC,OAAOA,IAjMX,2BAoME,WAEE,OAAiC,IAA1B39B,KAAKy8B,UAAUr0B,QAAuBpI,KAAKy8B,UAAUz8B,KAAKy8B,UAAUr0B,OAAS,GAAGk1B,UAtM3F,4BAyME,WAEE,OAAiC,IAA1Bt9B,KAAKy8B,UAAUr0B,QAAuBpI,KAAKy8B,UAAU,GAAGsB,YA3MnE,kBA8ME,WAEE,OAA4BC,MAArBh+B,KAAKklB,KAAK9c,SAhNrB,oCAmNE,cAnNF,yBAwNE,WACE,GAAyB,IAArBpI,KAAKklB,KAAK9c,OAGd,OAAOpI,KAAKklB,KAAK,KA5NrB,6BA+NE,SAAgBzB,GACd,MAAO,OAhOX,8CASGzhB,cATH,wEAU0B,MAV1B,iCA8BGgF,YA9BH,2cAoMGA,YApMH,2HAyMGA,YAzMH,kHA8MGA,YA9MH,yEAoOMo2B,I,GAEHp7B,aAAWi8B,Q,cAMZ,WACE1B,EACArX,EACA+W,EACAqB,GAIA,GAHC,yBAZHf,eAYE,yCATMN,iBASN,OARFqB,aAQE,OAPMY,WAON,EACAl+B,KAAKi8B,YAAcA,EACnBj8B,KAAKs9B,aAAsB1zB,IAAZ0zB,EAAwBpY,EAAK9c,OAASklB,GAAmBgQ,EACpEf,EAAY,EACd,MAAM,IAAI77B,MAAM,gCAElBV,KAAKu8B,UAAYA,EACjBv8B,KAAKklB,KAAOA,EACZllB,KAAKk+B,MAAQl+B,KAAKm+B,UAAUjZ,G,6CAG9B,SAAUA,GAER,IADA,IAAMgZ,EAAQ,IAAI3xB,IACTrE,EAAI,EAAGA,EAAIgd,EAAK9c,OAAQF,IAC/Bg2B,EAAM31B,IAAIvI,KAAKi8B,YAAY/W,EAAKhd,IAAKA,GAEvC,OAAOg2B,I,qBAGT,WACE,OAA0B,IAAnBl+B,KAAKu8B,Y,kBAGd,WACE,OAAOv8B,KAAKklB,KAAK9c,S,2BAGnB,SAActG,GAAa,IAAD,OAClBgd,EAAQ9e,KAAKklB,KAAK7Z,WACtB,SAAC+yB,GAAD,OAAiB,EAAKnC,YAAYmC,KAAiB,EAAKnC,YAAYn6B,MAEtE,OAAIgd,GAAS,IACX9e,KAAKklB,KAAK0G,OAAO9M,EAAO,EAAGhd,IACpB,K,oBAMX,SAAOlC,GACL,IAAMy+B,EAAWr+B,KAAKk+B,MAAM5zB,IAAI1K,GAChC,QAAiBgK,IAAby0B,EAGJ,OAAOr+B,KAAKklB,KAAKmZ,K,yBAGnB,SAAYC,GACV,IADiC,EAC3BC,EAAwC,GADb,eAElBv+B,KAAKk+B,MAAM9Q,QAFO,IAEjC,2BAAkC,CAAC,IAA1BxtB,EAAyB,QAC1B4+B,EAAeF,EAAYG,OAAO7+B,GACxC,GAAI4+B,EAAc,CAChB,IAAME,EAAmB1+B,KAAKk+B,MAAM5zB,IAAI1K,GACxCI,KAAKklB,KAAKwZ,GAAoBF,EAC9BD,EAA4BzyB,KAAKwyB,EAAYK,SAAS/+B,MAPzB,8BAWjC,GAA2C,IAAvC2+B,EAA4Bn2B,OAC9B,OAAOk2B,EAEP,IAAMM,EAAmBN,EAAYpZ,KAAKlE,QACxC,SAAClf,EAAKoG,GAAN,OAAaq2B,EAA4B9pB,SAASvM,MAEpD,OAAO,IAAIk1B,EACTkB,EAAY/B,UACZqC,EACA5+B,KAAKi8B,YACLqC,EAAYhB,W,sBAKlB,SAAiBnG,GACf,OAAOn3B,KAAKk+B,MAAM5zB,IAAI6sB,K,iBAGxB,SAAIA,GACF,YAAgCvtB,IAAzB5J,KAAK2+B,SAASxH,K,oBAGvB,SAAOA,GACL,IAAMrY,EAAQ9e,KAAK2+B,SAASxH,GAC5Bn3B,KAAKk+B,MAAMvB,OAAOxF,GAClBn3B,KAAKklB,KAAK0G,OAAO9M,EAAO,GACxB9e,KAAK6+B,eAAe/f,K,oBAGtB,SAAOA,EAAehd,GACpB9B,KAAKklB,KAAK0G,OAAO9M,EAAO,EAAGhd,GAC3B,IAAMq1B,EAAQn3B,KAAKi8B,YAAYn6B,GAC/B9B,KAAK8+B,aAAahgB,GAClB9e,KAAKk+B,MAAM31B,IAAI4uB,EAAOrY,K,4BAGxB,SAAuBA,GACrB,cAAkBvV,MAAMC,KAAKxJ,KAAKk+B,MAAMn0B,WAAxC,eAAoD,CAA/C,IAAIg1B,EAAK,KACRA,EAAM,GAAKjgB,GACb9e,KAAKk+B,MAAM31B,IAAIw2B,EAAM,GAAIA,EAAM,GAAK,M,0BAK1C,SAAqBjgB,GACnB,cAAkBvV,MAAMC,KAAKxJ,KAAKk+B,MAAMn0B,WAAxC,eAAoD,CAA/C,IAAIg1B,EAAK,KACRA,EAAM,GAAKjgB,EAAQ,GACrB9e,KAAKk+B,MAAM31B,IAAIw2B,EAAM,GAAIA,EAAM,GAAK,M,2BAK1C,SAAcn/B,GAAa,IAAD,OAClBo/B,EAAMh/B,KAAKklB,KAAK7Z,WAAU,SAACvJ,GAAD,OAAS,EAAKm6B,YAAYn6B,KAASlC,KACnE,OAAOo/B,GAAO,EAAIA,OAAMp1B,M,+GC3WrB,SAASq1B,GAAwB17B,EAAU3D,GAChD,OAAO4O,GAAYjL,GAAK27B,WACrBxC,SAAQ,SAAA/sB,GAAQ,OAAKA,GAAL,oBAAkBA,EAASwvB,qBAC3ClhB,MAAK,SAAAC,GAAI,OAAIA,EAAKte,KAAOA,KCQvB,IAAMw/B,IAAb,GAmBGp9B,aAAWi8B,QAnBd,cAOE,WACEzU,EACAX,EACAoT,EACAx4B,GACC,yBAXK+lB,2BAWN,OAVMX,yBAUN,OATMiF,sBASN,yFAQFmO,iBARE,8CAwEFoD,6BAA+Bv3B,KAAEC,SAAS/H,KAAKkb,oBAAqB,IAxElE,KAyEFkX,QAA4B,IAAIP,GAzE9B,KA6LFpuB,YA7LE,EACAzD,KAAKwpB,sBAAwBA,EAC7BxpB,KAAK6oB,oBAAsBA,EAC3B7oB,KAAKi8B,YAAcA,EACnBj8B,KAAKyD,OAASA,EAhBlB,yCAyBE,WAAyB,IAAD,OAChBsG,EAAU/J,KAAK+0B,QAAQlzB,KAAI,SAAAC,GAAG,MAAI,CAAC,EAAKm6B,YAAYn6B,GAAMA,MAChE,OAAO,IAAIyK,IAAgBxC,KA3B/B,0DA8BE,iCAAAhF,EAAA,6DACE/E,KAAK8tB,iBAAmB6C,oBACtB,iBAAM,CACJ,EAAK9H,oBAAoBE,cAAclnB,KAAI,SAACmf,GAAD,MAAY,CACrDA,EAAOiI,WACP1f,MAAM0Q,QAAQ+G,EAAOkI,QAAQjC,MAA7B,aAAyCjG,EAAOkI,QAAQjC,MAAQjG,EAAOkI,QAAQjC,KAC/E1d,MAAM0Q,QAAQ+G,EAAOkI,QAAQhC,MAA7B,aAAyClG,EAAOkI,QAAQhC,MAAQlG,EAAOkI,QAAQhC,KAC/ElG,EAAOkI,QAAQlqB,SAEjB,EAAKwqB,sBAAsB8V,UAAUz9B,KAAI,SAAC+iB,GAAD,MAAO,CAACA,EAAE2C,SAAU3C,EAAEmF,kBACjE,kBAAM,EAAKsV,iCACX,CACEtM,OAAQC,WAASC,aAZvB,SAeQjzB,KAAKkb,sBAfb,gDA9BF,wEAgDE,WAAQ,IAAD,EACL,UAAAlb,KAAK8tB,wBAAL,cAAA9tB,QAjDJ,sCAoDE,mGAaE,OAZMoB,EAAWoN,GAAYxO,KAAKwpB,uBAC5B5O,EAAY0Q,GAAalqB,GAEzBm+B,EAAqBv/B,KAAKwpB,sBAAsBW,cACnDtoB,KAAI,SAAAuoB,GAAQ,OAAI,EAAKoV,oBAAoBp+B,EAAUgpB,MACnDpJ,QAAO,SAACye,GAAD,MAA0B,aAAhBA,EAAK79B,UAEnB89B,EAAmB1/B,KAAK6oB,oBAAoBE,cAC/ClnB,KAAI,SAAC89B,GAAD,OAAUV,GAAwB,EAAKpW,oBAAqB8W,EAAK1W,eACrEjI,QAAO,SAACye,GAAD,MAA0B,aAAhBA,EAAK79B,UACnBg+B,EAAgBr2B,MAAMC,KAAK,IAAIosB,IAAI8J,EAAiBpX,OAAOiX,KAXnE,SAaQ/N,QAAQqD,IACZ+K,EAAc/9B,IAAd,+BAAAkD,EAAA,MAAkB,WAAO06B,GAAP,eAAA16B,EAAA,yFACT06B,EAAKI,oBADI,aACT,EAAmBC,eAAeC,YACvCnlB,EAAUolB,mBAAmBP,KAFf,2CAAlB,wDAdJ,gDApDF,iCA0EE,SAAoBr+B,EAAqBgpB,GACvC,IAAMza,EAAWsvB,GAAwB79B,EAAUgpB,EAAS7C,UAC5D,IAAK5X,EAEH,MAAM,IAAIjP,MAAM+S,GAAE,SAAD,OAAUrS,EAAS6+B,QAAnB,2CAA6D7V,EAAS7C,SAAtE,uEACf,sBAAuBnmB,EAAS6+B,QAAS7V,EAAS7C,SAAUnmB,EAASyP,OAEzE,OAAOlB,IAjFX,wEAuFE,WAC0B/O,GAD1B,8EAEQkyB,EAAO9yB,KAFf,SAGQsU,eAAI,UACR,sFACE,uBAAMwe,EAAKoN,iBAAX,QADF,OAEMhb,EAAO4N,EAAKiC,QACZjC,EAAKjK,oBAAoBsX,sBAC3Bjb,EAAOA,EAAKlE,QAAO,SAAClf,GAAD,OAASgxB,EAAKjK,oBAAoBsX,mBAAzBrN,CAA6ChxB,OAEvB,IAAhDgxB,EAAKtJ,sBAAsB8V,UAAUl3B,SACvC8c,EAAOA,EAAKnG,MAAK,SAACqhB,EAAaC,GAAd,OAA8BvN,EAAKwN,wBAAwBF,EAAMC,OAEpFvN,EAAKyN,UAAYrb,EAAKrjB,KAAI,SAAAC,GAAG,OAAIgxB,EAAKmJ,YAAYn6B,MAC5CV,EAAWoN,GAAYskB,IACzB,OAAClyB,QAAD,IAACA,OAAD,EAACA,EAAMua,0BACT/Z,EAASia,wBAZb,0CADI/G,GAHR,gDAvFF,oFA6GE,SAAgBmP,GAA8C,IAAD,OAC3D,OAAOzjB,KAAK+0B,QACT/T,QAAO,SAAClf,GAAD,OAAS,EAAK+mB,oBAAoBsX,kBAAkB1c,EAAK+c,0BAAhD,CAA2E1+B,QA/GlG,gBAkHE,WAAsB,IAAD,OACnB,OAAK9B,KAAKugC,UAGHvgC,KAAKugC,UACT1+B,KAAI,SAAAjC,GAAE,OAAI,EAAK6gC,QAAQn2B,IAAI1K,MAC3BohB,QAAO,SAAAlf,GAAG,OAAIA,KAJR9B,KAAK+0B,UApHlB,qCA2HE,SAAwBqL,EAAaC,GACnC,QAA6Bz2B,IAAzB5J,KAAK0gC,gBAA+B,CACtC,IAAMpB,EAAYt/B,KAAKwpB,sBAAsB8V,UACvCqB,EAA2C,IAArBrB,EAAUl3B,QAAgBk3B,EAAU,GAAGvV,YAAcrD,GAAkBgD,MAC9F,EACD,EACJ,GAAI1pB,KAAK0gC,kBAAoB1gC,KAAKi8B,YAAYmE,GAAO,OAAO,EAAIO,EAChE,GAAI3gC,KAAK0gC,kBAAoB1gC,KAAKi8B,YAAYoE,GAAO,OAAQ,EAAIM,EAEnE,OAAO3gC,KAAKwpB,sBAAsBoX,kBAA3B5gC,CAA8CogC,EAAMC,KApI/D,oCAuIE,WACErgC,KAAK0gC,qBAAkB92B,IAxI3B,mBA2IE,WACE5J,KAAK+0B,QAAQ3sB,OAAS,IA5I1B,oBA+IE,SAAOtG,GAAmB,IAAD,OACjBq1B,EAAQn3B,KAAKi8B,YAAYn6B,GACzBk9B,EAAMh/B,KAAK+0B,QAAQ1pB,WAAU,SAACw1B,GAAD,OAAO,EAAK5E,YAAY4E,KAAO1J,KAC9D6H,GAAO,IACTh/B,KAAK+0B,QAAQnJ,OAAOoT,EAAK,GACrB7H,IAAUn3B,KAAK0gC,kBACjB1gC,KAAK0gC,qBAAkB92B,GAEzB5J,KAAKkb,oBAAoB,CAACC,yBAAyB,OAvJzD,2DA2JE,WAAa2D,EAAehd,EAAYg/B,GAAxC,mBAAA/7B,EAAA,yDACQ6V,EAAY0Q,GAAatrB,MAC/B8B,EAAMg6B,GAAiBh6B,EAAK8Y,EAAUqiB,qBAChC8D,EAAWnmB,EAAUomB,SAASl/B,GAC9Bm/B,EAAmBjhC,KAAK+0B,QAAQqF,MAAK,SAAAt4B,GAAG,OAAI8Y,EAAUomB,SAASl/B,KAASi/B,MAC1EE,EALN,wDAQEjhC,KAAK+0B,QAAQnJ,OAAO9M,EAAO,EAAGhd,GAC1Bg/B,IACF9gC,KAAK0gC,gBAAkB1gC,KAAKi8B,YAAYn6B,IAV5C,UAYQ9B,KAAKkb,sBAZb,iDA3JF,mHA0KE,WAAUmiB,EAAiBd,GAA3B,6BAAAx3B,EAAA,sDACQ6V,EAAY0Q,GAAatrB,MACzBklB,EAAgB,GAFxB,eAGkBmY,GAHlB,IAGE,2BAASv7B,EAAe,QACtBojB,EAAKpZ,KAAKgwB,GAAiBh6B,EAAK8Y,EAAUqiB,sBAJ9C,8BAOE,IADAj9B,KAAKqd,QACL,MAAgB6H,EAAhB,eAASpjB,EAAT,KAAsB9B,KAAK+0B,QAAQjpB,KAAKhK,GAP1C,gBAQQ9B,KAAKkb,sBARb,gDA1KF,oFAqLE,SAAcmiB,GACZ,IAAIj8B,EAAWoN,GAAYxO,MAC3B,GAAsB,uBAAlBoB,EAASpC,KACX,MAAM,IAAI0B,MAAMU,EAASyP,KAAO,yIAElC,MAAM,IAAInQ,MAAM,qBA1LpB,wBA6LE,SAAWoB,GAAmB,IAAD,OACrB8Y,EAAY0Q,GAAatrB,MAC/B8B,EAAMg6B,GAAiBh6B,EAAK8Y,EAAUqiB,qBACtC,IAAM+B,EAAMh/B,KAAK+0B,QAAQ1pB,WAAU,SAACw1B,GAAD,OAAO,EAAK5E,YAAY4E,KAAO,EAAK5E,YAAYn6B,MAC/Ek9B,GAAO,GACTh/B,KAAK+0B,QAAQnJ,OAAOoT,EAAK,EAAGl9B,KAlMlC,mCAsME,SAAsB+tB,MAtMxB,8BA2ME,SAAiBjwB,GAAa,IAAD,OACrBo/B,EAAMh/B,KAAKklB,KAAK7Z,WAAU,SAACvJ,GAAD,OAAS,EAAKm6B,YAAYn6B,KAASlC,KACnE,OAAOo/B,GAAO,EAAIA,OAAMp1B,IA7M5B,kCAgNE,WACE,YAAgCA,IAAzB5J,KAAK0gC,kBAjNhB,yBAoNE,WACE,GAAyB,IAArB1gC,KAAKklB,KAAK9c,OAGd,OAAOpI,KAAKklB,KAAK,OAxNrB,oDAIGljB,cAJH,iLAmByC,MAnBzC,yCAsBGA,cAtBH,kGAyBGgF,YAzBH,sHAuFGU,UAvFH,mHAkHGV,YAlHH,uECVA,IAAMk6B,GAAkBp5B,KAAEC,UAAS,WACjCo5B,GAAY9jB,UACX,KACG8jB,GAAmB,IAAI50B,IAqBtB,SAAS60B,GACdC,EACAp3B,EACAjJ,GAEA,OAxBF,SAAwBsgC,GAA8C,IACpE,IAAIpjB,EAAOijB,GACPI,EAAW,EAFqD,mBAAnBC,EAAmB,iCAAnBA,EAAmB,kBAGpE,cAAgBA,EAAhB,eAA4B,CAAvB,IAAIx3B,EAAG,KACNy3B,EAAWvjB,EAAK5T,IAAIN,QACPJ,IAAb63B,IACEF,IAAaC,EAAWp5B,OAAS,EACnC8V,EAAK3V,IAAIyB,EAAMy3B,EAAWH,KAE1BpjB,EAAK3V,IAAIyB,EAAMy3B,EAAW,IAAIl1B,MAGlC2R,EAAOujB,EACPF,IAGF,OADAL,KACOhjB,EAQAwjB,EACL,WACE,GAAIL,EAAqB,CACvB,IAAMM,EAAe,IAAIC,GAAoBP,GAC7C,OAAOp3B,EAAM43B,eAAe7gC,EAAQ,CAClC8gC,sBAAuBH,EAAaG,sBACpCC,sBAAuBJ,EAAaI,sBACpCC,YAAaL,EAAaM,wBAG5B,OAAOh4B,EAAM43B,eAAe7gC,KAGhCA,EACAqgC,EACAp3B,GAIG,SAASi4B,KACd,OAAOC,GAAa,WAGf,SAASC,KACd,OAAOD,GAAa,SAGtB,SAASA,GAAaE,GACpB,IAAMrhC,EAASmQ,KAEf,OAAO4W,KAAKua,aAAathC,GACtBonB,cAFgC,QAGhCnK,MAAK,SAACskB,GAAD,OAAUA,EAAKvjC,OAASqjC,KAAgBp4B,MAG3C,SAASu4B,GACdnB,EACA7Z,EACAvd,GAEA,GAAG0e,MAAM1e,GACP,MAAO,GAET,IAAMjJ,EAASmQ,KACf,OACSiwB,GADLC,IAGa,aAAb7Z,GAAwC,UAAbA,EACC,uBAEA,WALqBvd,EAAOjJ,G,0DASxD4gC,G,WAIJ,WAAYa,GAEV,GAF2B,yBAHrBA,YAGoB,OAFpBC,oBAEoB,GACEC,OAAO,aAAaC,KAAKH,GAEnD,MAAM,IAAI/hC,MAAM,qDAAuD+hC,EAAS,KAElFziC,KAAKyiC,OAASA,EAAO5d,OACrB7kB,KAAK0iC,eAAiB1iC,KAAK6iC,kBAAkB7iC,KAAKyiC,Q,qDAGpD,SAAkBA,GAChB,IAAMK,EAAeL,EAAO1+B,MAAM,KAClC,OAAO++B,EAAa16B,OAAS,OAAIwB,EAAYk5B,EAAa,K,iCAG5D,WACE,OAAO9iC,KAAK0iC,eAAiB1iC,KAAK0iC,eAAet6B,YAASwB,I,iCAG5D,WACE,GAAK5J,KAAK0iC,eAAV,CAGA,IAAMK,EAAY/iC,KAAK0iC,eAAe3+B,MAAM,KAAKqE,OAAS,EAC1D,OAAqB,IAAd26B,OAAkBn5B,EAAYm5B,K,iCAGvC,WACE,OAAO/iC,KAAKyiC,OAAOhuB,SAAS,S,KCvGzB,ICdKuuB,GDcCC,IAAb,GA0PGv7B,SAAOC,MA1PV,GA+PGD,SAAOC,MA/PV,GAwQGD,SAAOC,MAxQV,GA8QGD,SAAOC,MA9QV,GAwRGD,SAAOC,MAxRV,GAiSGD,SAAOC,MAjSV,GA0SGD,SAAOC,MA1SV,GAsTGD,SAAOC,MAtTV,GAgUGD,SAAOC,MAhUV,GAqUGD,SAAOC,MArUV,GA6UGD,SAAOC,MA7UV,GAmWGD,SAAOC,MAnWV,GAwWGD,SAAOC,MAxWV,GA8WGD,SAAOC,MA9WV,cAQE,WAAY/G,GAAuB,IEhBL2C,EAAUq4B,EACVpS,EACAX,EACAoT,EACAx4B,EFYI,gCAPlCy/B,iBAAsB,EAOY,KANlC1V,cAAgC,KAME,0FAYlC2V,oBAAsC,GAZJ,oDAqXlC1/B,YArXkC,EAChCiU,OAAOC,OAAO3X,KAAMY,GACpBZ,KAAKwtB,eElBuBjqB,EFmB1B3C,EAAKuN,oBEnB+BytB,EFoBpCh7B,EAAKg7B,mBEnBqBpS,EFoB1B5oB,EAAK4oB,sBEnBqBX,EFoB1BjoB,EAAKioB,oBEnBqBoT,EFoB1B,SAACn6B,GAAD,OAAgB,EAAKk/B,SAASl/B,IEnBJ2B,EFoB1BzD,KEnBG27B,GAA0Bp4B,EAAKq4B,GAClC,IAAII,GAAmBC,EAAax4B,GACpC,IAAI27B,GAAiB5V,EAAuBX,EAAqBoT,EAAax4B,IFCpF,6DAsBE,WACEzD,KAAKmjC,oBAAoBpX,SAAQ,SAAC8D,GAAD,OAAcA,SAvBnD,0DA0BE,sBAAA9qB,EAAA,sEACQ/E,KAAKwtB,cAAc/C,QAD3B,gDA1BF,wEA8BE,WACEzqB,KAAKwtB,cAAc4V,SA/BvB,mBAkCE,WACE,OAAOpjC,KAAKwtB,cAAcuH,UAnC9B,gBAsCE,WACE,OAAO/0B,KAAKwtB,cAActI,OAvC9B,sBA4CE,WAEE,OAAO1W,GAAYxO,MAAMk/B,aA9C7B,sBAiDE,WACE,OAAOxe,GAAc1gB,QAlDzB,8BAqDE,WAAoC,IAAD,OACjC,OAAOA,KAAKk/B,WAAWjhB,MAAK,SAACwhB,GAAD,OAAUA,EAAK7/B,KAAO,EAAKsZ,WAAWoiB,gBAtDtE,+BAyDE,WACE,OAAOt7B,KAAKqjC,mBAAoBC,YA1DpC,sBA6DE,SAASxhC,GACP,OAAOA,EAAI9B,KAAKi9B,uBA9DpB,0BAiEE,SAAan7B,EAAY6N,GACvB,GAAI3P,KAAKujC,kBAAkBzL,IAAI93B,KAAKghC,SAASl/B,IAAO,CAClD,IAAM0hC,EAAMxjC,KAAKujC,kBAAkBj5B,IAAItK,KAAKghC,SAASl/B,IACrD,GAAI0hC,EAAIC,gBAAgB3L,IAAInoB,EAAS/P,IACnC,OAAO4jC,EAAIC,gBAAgBn5B,IAAIqF,EAAS/P,IAE1C,GAAI4jC,EAAIE,YAAY5L,IAAInoB,EAAS/P,IAC/B,OAAO4jC,EAAIE,YAAYp5B,IAAIqF,EAAS/P,IAGxC,OAAOI,KAAK2jC,qBAAqB7hC,EAAK6N,KA3E1C,kCA8EE,SAAqB7N,EAAY6N,GAC/B,OAAO7N,EAAI6N,EAAS2zB,aA/ExB,wEAkFE,WAA0B1iC,GAA1B,SAAAmE,EAAA,+EACS/E,KAAKwtB,cAActS,oBAAoBta,IADhD,gDAlFF,kGAsFE,SAA8BkB,EAAY8hC,GACxC,GAAI5jC,KAAKujC,kBAAkBzL,IAAI93B,KAAKghC,SAASl/B,IAAO,CAClD,IAAM0hC,EAAMxjC,KAAKujC,kBAAkBj5B,IAAItK,KAAKghC,SAASl/B,IACrD,GAAI0hC,EAAIC,gBAAgB3L,IAAI8L,EAAQ/yB,MAClC,OAAO2yB,EAAIC,gBAAgBn5B,IAAIs5B,EAAQ/yB,MAEzC,GAAI2yB,EAAIE,YAAY5L,IAAI8L,EAAQ/yB,MAC9B,OAAO2yB,EAAIE,YAAYp5B,IAAIs5B,EAAQ/yB,MAGvC,OAAO/O,EAAI8hC,EAAQ9kB,SAhGvB,gCAoGE,SAAmBnP,GAAgC,IAAD,OAC1ClG,EAASzJ,KAAKwtB,cACjBqW,gBAAgB,CAACrD,0BAA2B7wB,EAAS/P,KACrDiC,KAAI,SAACC,GAAD,OAAS,EAAKC,aAAaD,EAAK6N,MAAWqR,QAAO,SAAClf,GAAD,OAASA,KAClE,OAAI2H,EAAO2wB,MAAK,SAAAnwB,GAAK,OAAIgQ,mBAAQhQ,MACxB,IAAI2rB,IAAInsB,EAAOizB,SAAQ,SAAA3V,GAAK,OAAIA,MAElC,IAAI6O,IAAInsB,KA3GnB,yBA8GE,SAAY3H,EAAY6N,GACtB,IAAM1F,EAAQjK,KAAK+B,aAAaD,EAAK6N,GACrC,OAAO3P,KAAK8jC,gBAAgBn0B,EAAU1F,KAhH1C,iCAmHE,SAAoBnI,EAAY6N,GAC9B,IAAM1F,EAAQjK,KAAK2jC,qBAAqB7hC,EAAK6N,GAC7C,OAAO3P,KAAK8jC,gBAAgBn0B,EAAU1F,KArH1C,6BAwHE,SAAgB0F,EAAqB1F,GACnC,GAAc,OAAVA,QAA4BL,IAAVK,GAAwBV,MAAM0Q,QAAQhQ,IAA2B,IAAjBA,EAAM7B,OAC1E,MAAO,GACT,GAAIuH,EAASo0B,UAAYp0B,EAASkwB,aAAc,CAC9C,IAAOA,EAAgBlwB,EAAhBkwB,aACP,MAAwB,aAApBlwB,EAAS/N,QACN2H,MAAM0Q,QAAQhQ,KAAQA,EAAQ,CAACA,IAClBA,EAAMpI,KAAI,SAACmiC,GAAD,OAC1BnE,EAAaC,eAAemE,aAA5B,UAA4CD,QAE1B,IAEhBz6B,MAAM0Q,QAAQhQ,GACTA,EACJpI,KAAI,SAACqc,GAAD,OAAU2hB,EAAaC,eAAemE,aAA5B,UAA4C/lB,OAC1D2I,KAAK,MAEHgZ,EAAaC,eAAemE,aAA5B,UAA4Ch6B,IAGvD,MAAwB,WAApB0F,EAAS/N,OACJ4gC,GAAa7yB,EAAS0xB,oBAAqB1xB,EAASmJ,OAAQ7O,GAE9DA,IA/IX,iCAkJE,SAAoB+0B,GAClB,OAAOh/B,KAAKklB,KAAK8Z,KAnJrB,wBAsJE,SAAWp/B,GAAgC,IAAD,OACxC,OAAOI,KAAKwtB,cAActI,KAAKjH,MAAK,SAACnc,GAAD,OAAS,EAAKk/B,SAASl/B,KAASlC,OAvJxE,8BA0JE,SAAiBA,GACf,OAAOI,KAAKwtB,cAAc0W,iBAAiBtkC,KA3J/C,mCA8JE,SAAsBA,GAAa,IAAD,OAC1Bo/B,EAAMh/B,KAAKklB,KAAK7Z,WAAU,SAACvJ,GAAD,OAAS,EAAKk/B,SAASl/B,KAASlC,KAChE,OAAOo/B,GAAO,EAAIA,OAAMp1B,IAhK5B,iCAmKE,SAAoB+F,EAAqB1F,GACvC,GAAc,OAAVA,QAA4BL,IAAVK,EAAqB,OAAO,EAClD,GAAI0F,EAASo0B,UAAYp0B,EAASkwB,aAAc,CAC9C,IAAOA,EAAgBlwB,EAAhBkwB,aACP,MAAwB,aAApBlwB,EAAS/N,OACJqI,EAAMmwB,MAAK,SAAC4J,GAAD,OAChBnE,EAAaC,eAAeqE,kBAA5B,UAAiDH,OAG5CnE,EAAaC,eAAeqE,kBAA5B,UAAiDl6B,IAG1D,OAAO,IA/Kb,6BAmLE,SAAgBrK,GACd,OAAOI,KAAKk/B,WAAWjhB,MAAK,SAACwhB,GAAD,OAAUA,EAAK7/B,KAAOA,OApLtD,yBAuLE,WACE,OAAOI,KAAKwtB,cAAc4W,gBAxL9B,wBA2LE,WACE,GAAyB,IAArBpkC,KAAKklB,KAAK9c,OAGd,OAAOpI,KAAKklB,KAAKllB,KAAKklB,KAAK9c,OAAS,KA/LxC,2BAkME,SAActG,GACZ,IAAMlC,EAAKI,KAAKghC,SAASl/B,GACrBk9B,EAAMh/B,KAAKqkC,sBAAsBzkC,GACrC,GAAyB,IAArBI,KAAKklB,KAAK9c,OACd,YAAYwB,IAARo1B,EACU,IAARA,EACKh/B,KAAKklB,KAAK,GAEVllB,KAAKklB,KAAK8Z,EAAM,QAEpB,IA5MX,kCA+ME,SAAqBp/B,GAAiC,IAAD,OAC7Co/B,EAAMh/B,KAAKklB,KAAK7Z,WAAU,SAACw1B,GAAD,OAAO,EAAKG,SAASH,KAAOjhC,KAC5D,GAAIo/B,GAAO,EAAG,CACZ,IAAMsF,EAAStkC,KAAKklB,KAAK8Z,EAAM,GAC/B,OAAOsF,EAAStkC,KAAKghC,SAASsD,QAAU16B,KAnN9C,kCAuNE,SAAqBhK,GAAiC,IAAD,OAC7Co/B,EAAMh/B,KAAKklB,KAAK7Z,WAAU,SAACw1B,GAAD,OAAO,EAAKG,SAASH,KAAOjhC,KAC5D,GAAIo/B,EAAM,EAAG,CACX,IAAMsF,EAAStkC,KAAKklB,KAAK8Z,EAAM,GAC/B,OAAOsF,EAAStkC,KAAKghC,SAASsD,QAAU16B,KA3N9C,kCA+NE,SAAqB9H,GACnB,OAAO9B,KAAKukC,yBAAyBvkC,KAAKghC,SAASl/B,MAhOvD,sCAmOE,SAAyBlC,GACvB,OAAOI,KAAKujC,kBAAkBj5B,IAAI1K,KApOtC,+BAuOE,SAAkBkC,GAChB,IAAM0hC,EAAMxjC,KAAKwkC,qBAAqB1iC,GACtC,GAAK0hC,EACL,OAAOA,EAAIE,YAAY98B,KAAO,IA1OlC,4BA6OE,SAAe9E,GACb,IAAM0hC,EAAMxjC,KAAKwkC,qBAAqB1iC,GACtC,OAAI0hC,EACKA,EAAIE,YAEJ,IAAIn3B,MAlPjB,+BAsPE,WAA8B,IAAD,OAC3B,OAAOvM,KAAKklB,KAAKlE,QAAO,SAAClf,GAAD,OAAS,EAAK2iC,kBAAkB3iC,QAvP5D,2BA0PE,SACcojB,GACZllB,KAAKwtB,cAAc+B,cAAcrK,KA5PrC,+DA+PE,WACiBA,GADjB,wEAEEllB,KAAKqd,QAFP,SAGQrd,KAAKwtB,cAAcjlB,IAAI2c,EAAM,OAAGtb,GAHxC,OAIsB,IAAhBsb,EAAK9c,SACPpI,KAAK0kC,SAAU,GALnB,gDA/PF,sFAwQE,SACkB5iC,EAAYmnB,EAAoBhf,GAChDjK,KAAK2kC,qBAAqB7iC,GAC1B9B,KAAKujC,kBAAkBj5B,IAAItK,KAAKghC,SAASl/B,IAAO2hC,gBAAgBl7B,IAAI0gB,EAAYhf,KA3QpF,8BA8QE,SACiBnI,GACf,IAAM0hC,EAAMxjC,KAAKwkC,qBAAqB1iC,GACtC,GAAI0hC,EAAK,CAAC,IAAD,iBACyBA,EAAIC,gBAAgB15B,WAD7C,IACP,2BAA+D,CAAC,IAAD,yBAArDkf,EAAqD,KAAzChf,EAAyC,KAC7Du5B,EAAIE,YAAYn7B,IAAI0gB,EAAYhf,IAF3B,kCAjRb,2BAwRE,SAA4BnI,EAAYylB,EAAkBtd,GACxDjK,KAAK2kC,qBAAqB7iC,GAC1B,IAAM0hC,EAAMxjC,KAAKwkC,qBAAqB1iC,GAClC0hC,GACFA,EAAIE,YAAYn7B,IAAIgf,EAAUtd,KA5RpC,kCAiSE,SACqBnI,GACnB,IAAK9B,KAAKujC,kBAAkBzL,IAAI93B,KAAKghC,SAASl/B,IAAO,CACnD,IAAM0hC,EAAM,IAAI/H,GAChB+H,EAAI//B,OAASzD,KACbA,KAAKujC,kBAAkBh7B,IAAIvI,KAAKghC,SAASl/B,GAAM0hC,MAtSrD,4CA0SE,WAEE,cAAmBj6B,MAAMC,KAAKxJ,KAAKujC,kBAAkBx5B,WAArD,eAAiE,CAA5D,0BAAKya,EAAL,KAAQC,EAAR,KAE0B,IAA3BA,EAAEgf,gBAAgB78B,MACK,IAAvB6d,EAAEif,YAAY98B,MAEd5G,KAAKujC,kBAAkB5G,OAAOnY,MAjTtC,sCAsTE,SACyB1iB,EAAYmnB,GACnC,IAAM2b,EAAiB5kC,KAAKujC,kBAAkBj5B,IAAItK,KAAKghC,SAASl/B,IAC3D8iC,IAGLA,EAAenB,gBAAgB9G,OAAO1T,GACtC2b,EAAelB,YAAY/G,OAAO1T,MA7TtC,qCAgUE,SACwBnnB,GACtB9B,KAAKujC,kBAAkB5G,OAAO38B,KAAKghC,SAASl/B,MAlUhD,uBAqUE,SACUA,GACR9B,KAAK6kC,wBAAwB/iC,GAC7B9B,KAAKwtB,cAAcmP,OAAO76B,GAC1B9B,KAAK8kC,4BACL9kC,KAAK+kC,uBA1UT,oCA6UE,SACuBnlC,EAAY0kC,GACjC,IG3VgDxlB,EH2V1CkmB,EAAUhlC,KAAKukC,yBAAyB3kC,GAC9C,GAAIolC,EAAS,CAEX,IADA,IAAMC,EAASjlC,KAAKsc,WAAW1c,GACtBsI,EAAI,EAAGA,EAAIo8B,EAAOl8B,OAAQF,IAAK,CACtC,IAAMg9B,GG/VsCpmB,EH+VY5W,EG9VvDwY,GH8ViD1gB,MG9V9BmlC,gBAAgBrmB,IH+VhCwlB,EAAOp8B,KAAO+8B,EAAO/8B,KACvB88B,EAAQvB,gBAAgB9G,OAAOuI,EAAgBr0B,MAC/Cm0B,EAAQtB,YAAY/G,OAAOuI,EAAgBr0B,OAEzCm0B,EAAQvB,gBAAgBn5B,IAAI46B,EAAgBr0B,QAAUyzB,EAAOp8B,IAC/D88B,EAAQvB,gBAAgB9G,OAAOuI,EAAgBr0B,MAE7Cm0B,EAAQtB,YAAYp5B,IAAI46B,EAAgBr0B,QAAUyzB,EAAOp8B,IAC3D88B,EAAQtB,YAAY/G,OAAOuI,EAAgBr0B,MAG/C7Q,KAAKolC,oCA/VX,8BAmWE,SACiBtjC,GACf9B,KAAKwtB,cAAc6X,WAAWvjC,KArWlC,iEAwWE,WACmBgd,EAAehd,EAAY8Z,GAD9C,iFAEQ5b,KAAKwtB,cAAc2P,OAAOre,EAAOhd,EAAK8Z,GAF9C,OAGE5b,KAAK+kC,qBAHP,gDAxWF,8EA8WE,WAEE/kC,KAAKwtB,cAAcnQ,QACnBrd,KAAKujC,kBAAkBlmB,QACvBrd,KAAK8kC,8BAlXT,oCAqXE,WACE9kC,KAAKwtB,cAAc8X,2BAtXvB,kCAyXE,WACE,OAAOtlC,KAAKwtB,cAAc4O,2BA1X9B,4CAGGp6B,cAHH,yEAIqB,KAJrB,kDAKGA,cALH,yEAMuB,KANvB,iCAsCGgF,YAtCH,oHA0CGhF,cA1CH,yEA0CmE,IAAIuK,OA1CvE,uCA4CGvF,YA5CH,gHAiDGA,YAjDH,wHAqDGA,YArDH,i2DIZO,SAASu+B,GAAehiC,GAC7B,OAAOiL,GAAYjL,GAAK6X,YCDnB,SAASoqB,GAAYjiC,GAC1B,OAAOsK,GAAgBtK,GAAKuc,SCDvB,SAAS2lB,GAAyBliC,EAAUsN,GACjD,OAAO6P,GAAcnd,GAAK0wB,eAAepjB,GCApC,SAAS60B,GAA2BniC,GACzC,IAAMnC,EAAWoN,GAAYjL,GAC7B,OAAOi0B,GAAaj0B,GAAKoiC,kBAAoBvkC,EAASwZ,UAAU8pB,QCH3D,SAASkB,GAAuBriC,GACrC,OAAO6S,GAAkB7S,GAAKsiC,gBCDzB,SAASC,GAA8BviC,GAC5C,OAAOiL,GAAYjL,GAAKwiC,wBCDnB,SAASC,GAAyBziC,GACvC,OAAO6S,GAAkB7S,GAAK0iC,uB,STHpBjD,K,SAAAA,E,UAAAA,E,SAAAA,Q,KUEL,I,MAAMkD,GAAb,WACE,WAAmBC,EAA2BC,GAA8B,yBAAzDD,aAAwD,KAA7BC,cAA6B,KAG3E3iC,YAH2E,EAD7E,6CAME,WACE,OAAOzD,KAAKomC,YAAYC,aAP5B,uBAUE,WACE,OAAOrmC,KAAKomC,YAAYE,qBAX5B,sBAcE,WACE,OAAOtmC,KAAKomC,YAAYrZ,eAf5B,KCCO,SAASwZ,GAAsBhjC,GACpC,IAAMijC,EAAoBV,GAA8BviC,GAExD,OADyByiC,GAAyBziC,GAAKkjC,8BAC/Br+B,QAAUo+B,EAAoB,EAAI,GCUrD,I,uCAAME,IAAb,GAqFGh/B,SAAOC,MArFV,cACE,WAAY/G,GAA4B,yBAQxCglC,uBAA4C,KARL,KASvCe,YAA4B,KATW,KAUvCC,yBAA0C,KAVH,KAWvCrjC,SAXuC,OAYvCsjC,iBAA2B,KAXzBnvB,OAAOC,OAAO3X,KAAMY,GAFxB,8CAKE,WACE,OAAO,IAAI2L,IAAIvM,KAAK8mC,oBAAoBjlC,KAAI,SAAC49B,GAAD,MAAU,CAACA,EAAK7/B,GAAI6/B,EAAKsH,mBANzE,yBAeE,WAA+B,IAAD,iBACX/mC,KAAK8mC,qBADM,IAC5B,2BAA2C,CAAC,IAAnCrH,EAAkC,QACzC,GAAoB,UAAhBA,EAAK79B,OACP,OAAO69B,GAHiB,iCAfhC,qBAwBE,WACE,OAAIz/B,KAAKgnC,cAAsBhnC,KAAKgnC,cAAcngC,OAC3C7G,KAAK6mC,mBA1BhB,iCA8BE,WACE,OAAO7mC,KAAK4mC,6BA/BhB,uCAkCE,WACE,OAAO5mC,KAAK4lC,2BAnChB,+BAsCE,WACE,OAAO5lC,KAAKinC,8BAvChB,oBA0CE,WACE,OAAOjnC,KAAK2mC,gBA3ChB,uBA8CE,WACE,OAAO3mC,KAAK8mC,oBAAoB1+B,SA/CpC,wBAkDE,WACE,OAAyB,IAArBpI,KAAKknC,YAA0B,EAC5BlnC,KAAKmnC,eAAennC,KAAKknC,YAAc,KApDlD,yBAuDE,WACE,OAAOlnC,KAAKosB,aAAapsB,KAAKssB,SAAW,KAxD7C,2BA2DE,SAAc8a,GACZ,IAAMC,EAAuBrnC,KAAKsnC,gCAAgCF,GAClE,OAAOpnC,KAAKunC,6BAA6BF,GAAsBhgC,OA7DnE,4BAgEE,SAAe+/B,GACb,IAAMC,EAAuBrnC,KAAKsnC,gCAAgCF,GAClE,OAAOpnC,KAAKunC,6BAA6BF,GAAsBG,QAlEnE,6CAqEE,SAAgCJ,GAC9B,OAAOA,EAAkBb,GAAsBvmC,KAAKuD,OAtExD,uBAyEE,SAAU86B,GACR,OAAOA,EAAWr+B,KAAKynC,aAAapJ,KA1ExC,0BA6EE,SAAaA,GACX,OAAOr+B,KAAK0nC,YA9EhB,0BAiFE,SAAarJ,GACX,OAAOr+B,KAAKqsB,UAAUgS,GAAYr+B,KAAKynC,aAAapJ,KAlFxD,4BAqFE,SAA6B9W,EAAkBte,GAC7CjJ,KAAK2nC,aAAap/B,IAAIgf,EAAUpe,KAAKgB,IAAIlB,EAAU,OAtFvD,wCAyFE,WACE,IAAMu9B,EAAoBV,GAA8B9lC,KAAKuD,KACvDqkC,EAAmB5B,GAAyBhmC,KAAKuD,KAAKkjC,8BACtDoB,EAAiBjC,GAAuB5lC,KAAKuD,KAAK1B,KAAI,SAAC49B,GAAD,OAAUA,EAAK7/B,MACrE+nC,EAAe3nC,KAAK2nC,aAEpBG,EAASv+B,MAAMC,KACnB,UAAC,kFACKg9B,EADL,gBACwB,OADxB,SAC8B,GAD9B,OAEC,uBAAMoB,EAAiB/lC,KAAI,SAACjC,GAAD,OAAQ,MAAnC,QAFD,OAGC,uBAAMioC,EACHhmC,KAAI,SAACjC,GAAD,OAAQ+nC,EAAar9B,IAAI1K,MAC7BohB,QAAO,SAACra,GAAD,YAAqBiD,IAAVjD,KAFrB,QAHD,yCAAD,IAQE0D,EAAM,EACV,OAAOd,MAAMC,KACX,UAAC,uGACes+B,GADf,yDAEG,OADOC,EADV,iBAES,CACJ1gC,KAAMgD,EACN1D,MAAOohC,EACPP,MAAOn9B,EAAM09B,GALlB,OAOG19B,GAAY09B,EAPf,qHAAA5tB,IAAA,2EAAD,QA1GN,8CAKGnT,YALH,qHAeGA,YAfH,kHAwBGA,YAxBH,0HA8BGA,YA9BH,4IAkCGA,YAlCH,0IAsCGA,YAtCH,uHA0CGA,YA1CH,+GA8CGA,YA9CH,+PAyFGA,YAzFH,+FCbaghC,IAAb,GAiBGtgC,SAAOC,MAjBV,cAGE,WAAY4kB,EAAmB0b,GAAqB,yBAFpDC,sBAEmD,iFACjDloC,KAAKusB,UAAYA,EACjBvsB,KAAKioC,WAAaA,EALtB,4CAQE,SAASE,GACHnoC,KAAKkoC,kBACPloC,KAAKkoC,iBAAiBC,KAV5B,6BAiBE,SACgB59B,EAAYgiB,EAAmB0b,GAE7CjoC,KAAKusB,UAAYA,EACjBvsB,KAAKioC,WAAaA,MArBtB,8CAcGjmC,cAdH,yEAc0B,KAd1B,0CAeGA,cAfH,yEAe2B,KAf3B,kI,+DCdaomC,IAAb,GAoBG1gC,SAAOC,MArBTpB,oBACD,+PAUE8hC,OAAoCpnC,IAAMqnC,YAV5C,uDAYE,WACEtoC,KAAKiC,MAAMsmC,mBAAmBvoC,KAAKiC,MAAMiR,OAAOtT,GAAII,KAAKqoC,UAb7D,gCAgBE,WACEroC,KAAKiC,MAAMsmC,mBAAmBvoC,KAAKiC,MAAMiR,OAAOtT,GAAII,KAAKqoC,UAjB7D,qBAoBE,WAEEroC,KAAKiC,MAAMumC,oBACXxoC,KAAKiC,MAAMiR,OAAOnG,YAvBtB,oBA0BE,WAAU,IAAD,OACP,OACE,uBACEzK,UAAWC,KAAEkmC,aAAe,KAAOzoC,KAAK0oC,UAAYnmC,KAAEomC,oBAAsB,IAAM,KAC/E3oC,KAAKiC,MAAM2mC,SAAWrmC,KAAEsmC,qBAAuB,IAClDpqC,IAAKuB,KAAKqoC,OACVt7B,QAAS,kBAAM,EAAKA,WACpB+7B,YAAa,SAAAC,GAAG,OAAI,EAAKL,WAAY,GACrCM,WAAY,SAAAD,GAAG,OAAI,EAAKL,WAAY,GANtC,UAOE,sBAAKpmC,UAAWC,KAAE0mC,SAAlB,SACE,eAAC,QAAD,CAAMz7B,IAAKxN,KAAKiC,MAAMiR,OAAO0mB,YAE/B,uBAAKt3B,UAAWC,KAAE2mC,aAAlB,UACE,sBAAK5mC,UAAWC,KAAE4mC,UAAlB,SACGnpC,KAAKiC,MAAMiR,OAAO/F,QAErB,sBAAK7K,UAAWC,KAAE6mC,kBAAlB,SACG,MAEH,+BACGppC,KAAKiC,MAAMiR,OAAOm2B,wBA9C/B,GAAgCpoC,IAAM8F,WAAtC,yCAOG/E,cAPH,yEAQc,KARd,2HCAasnC,GADZ/iC,mBACD,qKAQE,WACEvG,KAAKiC,MAAM6qB,MAAMC,YAAc/sB,KAAKiC,MAAM6qB,MAAMC,aATpD,oBAYE,WAAU,IAAD,OACP,OACE,iCACE,uBAAKzqB,UAAWC,KAAEgnC,eAAgBx8B,QAAS,kBAAM,EAAKy8B,gBAAtD,UACGxpC,KAAKiC,MAAM6qB,MAAMC,WAChB,oBAAGzqB,UAAW,mBAAqBC,KAAEknC,QAErC,oBAAGnnC,UAAW,qBAAuBC,KAAEknC,QAEzC,sBAAKnnC,UAAWC,KAAEmnC,UAAlB,SACG1pC,KAAKiC,MAAM4O,UAGhB,+BACG7Q,KAAKiC,MAAM6qB,MAAMC,YAAc/sB,KAAKiC,MAAM6qB,MAAM1b,QAAQvP,KAAI,SAAAqR,GAAM,aACjE,eAAC,GAAD,CAEEA,OAAQA,EACRs1B,kBAAmB,kBAAM,EAAKvmC,MAAMumC,kBAAkBt1B,IACtD01B,UAAU,YAAK3mC,MAAM0nC,sBAAX,eAA2B/pC,MAAOsT,EAAOtT,GACnD2oC,mBAAoB,EAAKtmC,MAAMsmC,oBAJ1Br1B,EAAO/F,MAAQ+F,EAAOm2B,YAAcn2B,EAAO0mB,qBA5B9D,GAAiC34B,IAAM8F,aAAvC,GCcO,SAAS6iC,GAAiBrmC,GAC/B,OAAOqJ,GAAarJ,GAAKsmC,aAAaC,cCXxC,I,GACaC,GAAoB,gBAGpBC,GADZzjC,mBACD,gKAIE,WACE,OAAOvG,KAAKiC,MAAM6V,QALtB,+BAQE,WAAqB,IAAD,EAClB,UAAA9X,KAAKiqC,UAAUC,aAAf,SAAsBv0B,UAT1B,oBAYE,WAAU,IAAD,OACP,OACE,uBAAKrT,UAAW,aAAhB,UACE,uBAAKA,UAAWC,KAAE4nC,SAAlB,UACE,eAAC,QAAD,CAAM7nC,UAAWC,KAAE6nC,KAAM58B,IAAI,uBAC7B,wBACE/O,IAAKuB,KAAKiqC,UAAUI,SACpB/nC,UAAWC,KAAE2nC,MACbI,YAAa72B,GAAE,2BAA4B,oBAC3C6B,UAAW,SAAC/K,GAAD,OAAW,EAAK0/B,UAAUM,eAAehgC,IACpDigC,SAAU,SAACjgC,GAAD,OAAW,EAAK0/B,UAAUQ,cAAclgC,SAGpDvK,KAAKiqC,UAAU5pB,SAASqqB,aAAatiC,OAAS,GAC9C,sBAAK9F,UAAW,aAAc7D,IAAKuB,KAAKiqC,UAAUU,aAAlD,SACE,sBAAKroC,UAAWC,KAAEqoC,iBAAlB,SACG5qC,KAAKiqC,UAAU5pB,SAASqqB,aACtB7oC,KAAI,SAAAirB,GAAK,OACR,eAAC,GAAD,CAEEjc,KAAMic,EAAMjc,KACZic,MAAOA,EACP0b,kBAAmB,SAAAt1B,GAAM,OAAI,EAAK+2B,UAAUzB,kBAAkBt1B,IAC9Dy2B,eAAgB,EAAKM,UAAU5pB,SAASspB,eACxCpB,mBAAoB,SAAC3oC,EAAInB,GAAL,OAAa,EAAKwrC,UAAUY,iBAAiBtiC,IAAI3I,EAAInB,KALpEquB,EAAMjc,oBA/B/B,GAAgC5P,IAAM8F,aAAtC,GAgDa+jC,IAAb,GAsBGpjC,SAAOC,MAtBV,cAcE,WACUpE,EACA+J,GACT,IAAD,gCAFU/J,MAEV,KADU+J,eACV,KAhBA48B,WAgBA,OAfAG,SAAW,SAAC5jC,GAAD,OAA4B,EAAKyjC,MAAQzjC,GAepD,KAbAkkC,aAA0C1pC,IAAMqnC,YAahD,KAZAuC,iBAA2D,IAAIt+B,IAY/D,KAVA8T,cAUA,0CALA0qB,aAKA,EACE/qC,KAAKqgB,SAAWD,GAAYpgB,KAAKuD,KACjCvD,KAAKqgB,SAAShD,QAnBlB,6CAsBE,SACU9S,GACR,GAAkB,WAAdA,EAAMP,IAIV,MAAkB,cAAdO,EAAMP,KACRO,EAAMU,iBACNjL,KAAKqgB,SAAS2qB,wBACdhrC,KAAKirC,gBAGW,YAAd1gC,EAAMP,KACRO,EAAMU,iBACNjL,KAAKqgB,SAAS6qB,4BACdlrC,KAAKirC,qBAGW,UAAd1gC,EAAMP,MACJhK,KAAKqgB,SAASspB,gBAChB3pC,KAAKqgB,SAASspB,eAAe58B,UAC7B/M,KAAKwoC,kBAAkBxoC,KAAKqgB,SAASspB,iBAErC3pC,KAAKqgB,SAAS8qB,mBApBhBnrC,KAAKsN,iBAzBX,+BAmDE,SAAkB4F,GAChBlT,KAAKsN,eACLs8B,GAAiB5pC,KAAKuD,KAAK6nC,cAAcl4B,EAAOtT,MArDpD,0BAwDE,WAAgB,IAAD,EACb,GAAKI,KAAKqgB,SAASspB,eAAnB,CAGA,IAAM0B,EAAgBrrC,KAAK2qC,aAAaW,QAClCC,EAAe,UAAGvrC,KAAK6qC,iBAAiBvgC,IAAItK,KAAKqgB,SAASspB,eAAe/pC,WAA1D,aAAG,EAA4D0rC,QACpF,GAAKC,GAAoBF,EAAzB,CAGA,IAAMG,EAA2BD,EAAgBE,wBAC3CC,EAAkBL,EAAcI,wBAChCE,EAAkBD,EAAgBvkC,IAAMqkC,EAAyBrkC,IAEjEykC,EAAkBF,EAAgB7kC,OAASwkC,EAAcQ,aACzDC,EAAsBN,EAAyBO,OAASL,EAAgBK,OAASH,EAEvF,GAAID,EAAkB,EACpBN,EAAc9e,WAAaof,OACtB,GAAIG,EAAsB,EAC/BT,EAAc9e,WAAauf,OACtB,GAAwB,IAApBH,EAAuB,CAChC,IAAMK,EAAgBhsC,KAAKqgB,SAAS4rB,2BACiB,IAA7BD,EAAcE,YAAmD,IAA/BF,EAAcG,eAEtEd,EAAc9e,UAAY,QAhFlC,mEAqFE,WAAqBhiB,GAArB,oBAAAxF,EAAA,sDACM/E,KAAK+qC,SACPrZ,aAAa1xB,KAAK+qC,SAEpB/qC,KAAK+qC,QAAUr1B,YAAW,WACxB,EAAKq1B,aAAUnhC,EACf,EAAKyW,SAAS8qB,mBA/IkB,KAyIpC,gDArFF,kFA+FE,SAAc5gC,GACZvK,KAAKiK,MAAQM,EAAM6hC,OAAOniC,MAC1BjK,KAAKqgB,SAASgsB,oBAAoBrsC,KAAKiK,SAjG3C,mBAoGE,WACEjK,KAAKqgB,SAAShD,YArGlB,0CASGrb,cATH,wEAUU,MAVV,sHCvCasqC,GADZ/lC,mBACD,+MAKEgmC,gBAAmB,IAAIzB,GAAgB,EAAK7oC,MAAMsB,IAAK,EAAKtB,MAAMqL,cALpE,4CAOE,WAAU,IAAD,OACP,OACE,eAAC,GAAD,CACEJ,MAAO,KACP6H,aAAc,KACdI,cAAe,KACfG,UAAW,SAAC/K,GAAD,OAAgB,EAAKgiC,gBAAgBj3B,UAAU/K,IAC1D0K,YAAa,KACbC,aAAc,KACdG,iBAAkB,GAPpB,SASE,eAAC,GAAD,CAAYyC,MAAO9X,KAAKusC,wBAlBhC,GAAkCtrC,IAAM8F,aAAxC,GCAO,SAASylC,GAAiBjpC,GAC/B6c,GAAY7c,GAAK8Z,QAEjB,IAAMovB,EAAc3oB,GAAevgB,GAAK8gB,WACtC0lB,GACA,eAAC,GAAD,CACExmC,IAAKA,EACL+J,aAAc,kBAAMm/B,YAEtB7iC,GACA,GCZJ,SAAS8iC,GAAqBC,GAC5B,OAAIA,EAAc92B,SACT82B,EAAc92B,SAClB9R,MAAM,KACNid,QAAO,SAAC4D,GAAD,MAAa,KAANA,KACd/iB,KAAI,SAAC+iB,GAAD,OAAOpkB,SAASokB,MAElB,CAAC,KAMH,SAASgoB,GAAsBhoB,EAAmBioB,GACvD,OAAOC,GAAgBloB,EAAGioB,EAAG,GAG/B,SAASC,GACPloB,EACAioB,EACAE,GAEA,GAAIjV,GAAIlT,EAAGmoB,KAAmBjV,GAAI+U,EAAGE,GACnC,OAAO,EAET,IAAKjV,GAAIlT,EAAGmoB,IAAkBjV,GAAI+U,EAAGE,GACnC,OAAQ,EAEV,IAAKjV,GAAIlT,EAAGmoB,KAAmBjV,GAAI+U,EAAGE,GACpC,OAAO,EAGT,IAAMC,EAAqBN,GAAqB9nB,GAAGmoB,GAAiBL,GAAqBG,GAAGE,GAC5F,OAA2B,IAAvBC,EACKA,EAGFF,GAAgBloB,EAAGioB,EAAGE,EAAgB,GAG/C,SAASjV,GAAI6U,EAA+BI,GAC1C,OAAOL,GAAqBC,GAAevkC,OAAS,GAAK2kC,EC1CpD,IAAME,GAAb,WAeE,WAAmBxpC,GAAc,yBAAdA,SAAa,KAdhCypC,mBAAoB,EAcY,KARhCC,UAAqC,IAAI5gC,IAQT,KAPhC6gC,oBAAmD,GAOnB,KANxBC,iBAMwB,EAflC,iDAGE,WACErtC,KAAKktC,mBAAoB,IAJ7B,4BAWE,SAAeI,GACbttC,KAAKqtC,YAAcC,IAZvB,uBAkBE,SAAUC,EAA6B18B,EAA0BgF,GAC/D,GAAK03B,EAAL,CAGA,IAAMC,EAAqB,IAAIC,GAAyBF,EAAiB18B,EAAMgF,GACzE63B,EAAoB1tC,KAAKotC,oBAC5BnvB,MAAK,SAAAiZ,GAAS,OAAIA,EAAUrmB,MAAQqmB,EAAUrmB,OAASA,GACtDqmB,EAAUoW,YAAcC,KACxBG,GACF1tC,KAAKotC,oBAAoBx2B,OAAO82B,GAElC1tC,KAAKotC,oBAAoBthC,KAAK0hC,GAC9BxtC,KAAKotC,oBAAsBptC,KAAKotC,oBAAoBruB,KAAK6tB,OA9B7D,mBAiCE,SAAM/7B,GAAe,IAAD,EACdy8B,EAAS,UAAGttC,KAAKotC,oBAAoBnvB,MAAK,SAACiZ,GAAD,OAAeA,EAAUrmB,OAASA,YAAnE,aAAG,EAAuEy8B,UACvFttC,KAAK2tC,iBAAiBL,KAnC1B,8BAsCE,SAAyBA,GAClBA,IAGLttC,KAAKqtC,YAAcC,EACnBA,EAAU33B,WA3Cd,yBA8CE,WAAe,IAAD,EACZ,UAAA3V,KAAKqtC,mBAAL,SAAkB13B,UA/CtB,4BAkDE,WAAkB,IAAD,OACT23B,EAAYttC,KAAKotC,oBAAoB,GAAGE,UAC1CA,EAAUM,SAEZ5tC,KAAK6tC,UAAUP,GAGjB53B,YAAW,WACT,EAAKi4B,iBAAiBL,KACrB,KA3DP,uBA8DE,WAC0C,IAApCttC,KAAKotC,oBAAoBhlC,QAAgBpI,KAAKktC,mBF7C7CppB,GE6C4F9jB,KAAKyD,QF7C7EqqC,OAAO/D,KEgDhC/pC,KAAK+tC,mBAlET,uBAqEE,SAAUC,GACRhuC,KAAKiuC,kBAAkBD,EAAe,KAtE1C,+BAyEE,SAAkBA,EAAoBE,GAAqB,IAAD,OACxD,KAAIA,EAAa,IAAjB,CAGA,IAAMC,EAAwBnuC,KAAKotC,oBAAoB/hC,WACrD,SAAC6rB,GAAD,OAAeA,EAAUoW,YAAcU,KAEnCI,EACJpuC,KAAKotC,oBAAoBhlC,OAAS,EAAI+lC,EAAwBA,EAAwB,EAAI,EACtFb,EAAYttC,KAAKotC,oBAAoBgB,GAAWd,UAClDA,IAAcU,GAAiBV,EAAUM,SAC3C5tC,KAAKiuC,kBAAkBX,EAAWY,EAAa,GAE/Cx4B,YAAW,WACT,EAAKi4B,iBAAiBL,SAvF9B,2BA4FE,SAAcU,GAAqB,IAAD,OAC1BG,EAAwBnuC,KAAKotC,oBAAoB/hC,WACrD,SAAC6rB,GAAD,OAAeA,EAAUoW,YAAcU,KAEnCK,EACsB,IAA1BF,EAA8BnuC,KAAKotC,oBAAoBhlC,OAAS,EAAI+lC,EAAwB,EACxFb,EAAYttC,KAAKotC,oBAAoBiB,GAAef,UACtDA,EAAUM,SACZ5tC,KAAKsuC,cAAchB,GAEnB53B,YAAW,WACT,EAAKi4B,iBAAiBL,UAvG9B,KAmHaG,GACX,WACSH,EACAz8B,EACAgF,GACN,yBAHMy3B,YAGP,KAFOz8B,OAEP,KADOgF,YCxHJ,SAAS04B,GAAmBhrC,GACjC,OAAOiL,GAAYjL,GAAKirC,gBCDnB,SAASC,GAAoBlrC,EAAU3B,GAC5C,OAAO2nB,GAAyBhmB,GAAKmrC,YAAY9sC,G,cCD5C,SAAS+sC,GAA8BprC,EAAUsN,GAAe,IAAD,EACpE,iBAAO40B,GAAyBliC,EAAKsN,UAArC,aAAO,EAAqCiO,MCCvC,SAAS8vB,GAAoBrrC,GAClC,OAAO+Q,eAAI,UAAC,SAASs6B,EAAoBnrB,GAA7B,iEAQR,OARQ,SAQR,gBAAM9V,GAAsBpK,GAAKqrC,oBAAoBnrB,GAArD,QARQ,6BAUR,OAVQ,yBAUR,gBAAMxP,GAAY1Q,EAAZ0Q,CAAA,MAAN,QAVQ,sDAAS26B,EAAT,kBCHP,SAASC,GAActrC,GAC5B,OAAOqJ,GAAarJ,GAAKurC,WCApB,SAASC,GAAoBxrC,GAClC,OAAO+Q,eAAI,UAAC,SAAS06B,EACnBC,EACA/tB,EACAiW,GAHU,iEAKV,uBAAM0X,GAActrC,GAAK2rC,0BACvBD,EACA/tB,EACAiW,GAHF,QALU,oCAAS6X,OCFhB,SAASG,GAAwB5rC,GACtC,OAAOiL,GAAYjL,GAAK8S,eAAe+4B,qBCjBlC,I,mGAAMC,GAAb,WAIE,WAAmB5rC,GAAc,yBAAdA,SAAa,KAHxB6rC,mBAGwB,OAFzBC,oBAA8B,EAFvC,sDAOE,WAAsB,IAAD,EAGkC,EAD/CC,EADiB5mB,GAAuB5oB,KAAKyD,QAAQgsC,2BACuB,WAApC,UAAA9wC,SAASqvC,qBAAT,eAAwB0B,SAClE1vC,KAAKuvC,qBAAuBC,EAC9B,UAAAp5B,GAAkBpW,aAAlB,SAAyBiY,sBAEzBjY,KAAKuvC,oBAAqB,IAbhC,wBAiBE,WACE,OAAOvvC,KAAKsvC,eAlBhB,IAqBE,SAAiBrlC,GACfjK,KAAKsvC,cAAgBrlC,EACrBjK,KAAK2vC,gBAvBT,yBA0BE,WAAe,IAAD,EACZ,UAAA3vC,KAAKsvC,qBAAL,SAAoB35B,YA3BxB,KA+BO,SAASi6B,GAAoBrsC,GAClC,OAAOiL,GAAYjL,GAAKiY,iB,qCCsDpBq0B,GACJ,WAAmBlqB,GAAoC,yBAApCA,iBAIRmqB,IAAb,GAyDGpoC,SAAOC,MAzDV,GA8LGD,SAAOC,MA9LV,GAkMGD,SAAOC,MAlMV,GAuMGD,SAAOC,MAvMV,GA6MGD,SAAOC,MA7MV,GA2NGD,SAAOC,MA3NV,GAuOGD,SAAOC,MAvOV,GAkZGD,SAAOC,MAlZV,GA8ZGD,SAAOC,MA9ZV,GA0aGD,SAAOC,MA1aV,GA4cGD,SAAOC,MA5cV,GA8eGD,SAAOC,MA9eV,GA4fGD,SAAOC,MA5fV,GAmiBGD,SAAOC,MAniBV,GAkjBGD,SAAOC,MAljBV,GAujBGD,SAAOC,MAvjBV,GA4jBGD,SAAOC,MA5jBV,GAykBGD,SAAOC,MAzkBV,GA8lBGD,SAAOC,MA9lBV,GAkmBGD,SAAOC,MAlmBV,GAkoBGD,SAAOC,MAloBV,GAuoBGD,SAAOC,MAvoBV,GAupBGD,SAAOC,MAvpBV,GAwrBGD,SAAOC,MAxrBV,cAOE,WAAY/G,GAAsB,IAAD,gCANjC2N,gBAAqB,EAMY,KALjC+M,iBAAqC,IAAI2xB,GAAiBjtC,MAKzB,KAJjCwb,iBAAqC,IAAI6zB,GAAiBrvC,MAIzB,kDA8BzB+vC,kBAAoB,kBAAM,GA9BD,KAwCzBC,mBAAqB,kBAAM,GAxCF,2CAmEjCC,mBAnEiC,OAoEjCC,sBApEiC,OAuEjCC,uBAvEiC,OAyEjCjkB,oBAzEiC,OA2EjCtsB,GAAK,GA3E4B,KA4EjCic,gBAAkB,GA5Ee,KA6EjChL,KAAO,GA7E0B,KA8EjCovB,QAAU,GA9EuB,KA+EjCmQ,iBAAmBpN,GAAeqN,MA/ED,KAgFjCC,YAAa,EAhFoB,KAiFjCC,gBAAiB,EAjFgB,KAkFjCC,sBAAuB,EAlFU,KAmFjCC,eAAgB,EAnFiB,KAoFjCC,kBAAmB,EApFc,KAqFjCC,gCAAiC,EArFA,KAsFjCC,qBAAsB,EAtFW,KAuFjCpC,gBAAkB,GAvFe,KAwFjCqC,YAAc,GAxFmB,KAyFjCC,mBAAoB,EAzFa,KA0FjCh4B,OAAS,GA1FwB,KA2FjCi4B,WAAa,GA3FoB,KA4FjCvc,YAAa,EA5FoB,KA6FjCD,cAAe,EA7FkB,KA8FjCO,aAAc,EA9FmB,KA+FjCkc,mBA/FiC,OAgGjC9zB,iCAAkC,EAhGD,KAiGjC+zB,wBAAyB,EAjGQ,KAkGjC/R,WAA0B,GAlGO,KAmGjC3gB,QAAqB,GAnGY,KAoGjC2yB,eAA4B,GApGK,KAqGjClyC,KAAe,GArGkB,sDAwGjC4b,UAAwB,KAxGS,KAyGjCu2B,gBAzGiC,OA0GjCl1B,UAAgC,KA1GC,KA2GjC5F,eAAkC,KA3GD,KA4GjC+6B,cAAgC,KA5GC,KA6GjCC,aAA8B,KA7GG,KA8GjC7lB,kBAAuC,KA9GN,KA+GjCC,kBAAuC,KA/GN,KAgHjC6lB,QAAmB,KAhHc,KAkHjCC,kBAA+B,KAlHE,KAmHjCC,YAA2B,KAnHM,KAoHjCC,aAA6B,KApHI,+LAynBjCC,eAAmC,GAznBF,KA8rBjCvlB,YAAc,IAAI6b,GAAkB,EAAG,GA9rBN,gDAisBjC2J,qBACE,IAAIpkB,GAlsB2B,KAosBjC9pB,YApsBiC,OAyvBjCma,gBAzvBiC,EAC/BlG,OAAOC,OAAO3X,KAAMY,GACpBZ,KAAKk/B,WAAWnT,SAAQ,SAACje,GAAD,OAAQA,EAAErK,OAAS,KAC3CzD,KAAKue,QAAQwN,SAAQ,SAACje,GAAD,OAAQA,EAAErK,OAAS,KACxCzD,KAAKkxC,eAAiBlxC,KAAKue,QAAQyC,QAAO,SAACtZ,GAAD,OAAYA,EAAOoyB,aAC7D95B,KAAK4a,UAAUnX,OAASzD,KACxBA,KAAKic,UAAUxY,OAASzD,KACxBA,KAAKqW,eAAe5S,OAASzD,KAC7BA,KAAKoxC,cAAc3tC,OAASzD,KAC5BA,KAAKqxC,aAAa5tC,OAASzD,KAC3BA,KAAKyrB,kBAAkBhoB,OAASzD,KAChCA,KAAKwrB,kBAAkB/nB,OAASzD,KAEhCA,KAAKksB,eAAiB,IAAIwa,GAAe,CACvCd,uBAAwB,kBAAMA,GAAuB,IACrDe,YAAa,kBAAM,EAAKrlC,UAAU8G,QAClCw+B,yBAA0B,kBACxBd,GAA8B,EAAKzvB,iBACrC9S,IAAKvD,KACL6mC,iBAAkB7mC,KAAKqW,eAAeqxB,YAGxC1nC,KAAKiwC,cAAgBjwC,KAAKk/B,WAAWjhB,MACnC,SAACwhB,GAAD,OAAUA,EAAK7/B,KAAO,EAAKixC,eAE7B7wC,KAAK4a,UAAUuoB,oBAAoBr3B,MACjC,kBAAO,EAAK8lC,0BAA2B,KAjC7C,kDA2CE,WACE,OAAO5xC,KAAK+vC,mBA5ChB,IAuCE,SAAqB9lC,GACnBjK,KAAK+vC,kBAAoB9lC,IAxC7B,6BAqDE,WACE,OAAOjK,KAAKgwC,oBAtDhB,IAiDE,SAAsB/lC,GACpBjK,KAAKgwC,mBAAqB/lC,IAlD9B,yBAyDE,SACYqiB,GACVtsB,KAAKssB,SAAWA,EAChBtsB,KAAK4a,UAAUmqB,mBAAqB,IA5DxC,yBAkEE,WAEE,OAAK/kC,KAAKssB,SAGHtsB,KAAKssB,SAAWtsB,KAAK4a,UAAUmqB,mBAF7B/kC,KAAKssB,WArElB,mCAoIE,WACE,OAAOtsB,KAAK2wC,kCAAoC3wC,KAAKwuC,kBArIzD,qCAwIE,WACE,OAAOxuC,KAAKkxC,eAAejzB,MAAK,SAACvW,GAAD,OAAYA,EAAOmqC,eAzIvD,8BA4IE,SAAuBjyC,GACrB,OAAOI,KAAK6O,eAAeipB,IAAIl4B,KA7InC,2BAgJE,SAAcslB,GAAsB,IAAD,OACjCllB,KAAK4a,UAAU2U,cAAcrK,GAC7BllB,KAAK6O,eAAewO,QACpBrd,KAAK4xC,yBAC4B,IAA/B5xC,KAAK4a,UAAUsK,KAAK9c,QACpBpI,KAAK4a,UAAUsK,KAAKoS,OAAM,SAACx1B,GAAD,OACxB,EAAKgwC,WAAW,EAAKl3B,UAAUomB,SAASl/B,SAtJhD,+DA0JE,WAAiBojB,GAAjB,wBAAAngB,EAAA,sEACQ/E,KAAK4a,UAAUuY,WAAWjO,GADlC,OAEQ6sB,EAAe/xC,KAAK4a,UAAUsK,KAC9B8sB,EAAiBD,EAAalwC,KAAI,SAACC,GAAD,OACtC,EAAK8Y,UAAUomB,SAASl/B,MAE1B9B,KAAK6O,eAAiB,IAAI+mB,IACxBrsB,MAAMC,KAAKxJ,KAAK6O,gBAAgBmS,QAAO,SAACphB,GAAD,OACrCoyC,EAAev9B,SAAS7U,OAG5BI,KAAK4xC,yBAC4B,IAA/B5xC,KAAK4a,UAAUsK,KAAK9c,QACpBpI,KAAK4a,UAAUsK,KAAKoS,OAAM,SAACx1B,GAAD,OACxB,EAAKgwC,WAAW,EAAKl3B,UAAUomB,SAASl/B,OAd9C,gDA1JF,+EA4KE,SAAWq1B,GACT,IAAMqX,EAAkBD,GAAmBvuC,MAC3C,GAAMwuC,EAAiB,CACrB,IAAMtJ,EAAkBO,GAAyBzlC,KAAMwuC,GACvD,IAAKtJ,EACH,MAAM,IAAIxkC,MAAJ,2BACgB8tC,EADhB,kFACyGxuC,KAAK6b,gBAD9G,gBAIR,IAAMo2B,EAAajyC,KAAK4a,UAAU0B,WAAW6a,GAC7C,OAAOn3B,KAAK4a,UAAUwZ,8BACpB6d,EACA/M,GAGJ,OAAOllC,KAAK6O,eAAeipB,IAAIX,KA3LnC,8BA8LE,SAA+Bv3B,GAC7BI,KAAK6O,eAAeinB,IAAIl2B,KA/L5B,iCAkME,SAAkCA,GAChCI,KAAK6O,eAAe8tB,OAAO/8B,GAC3BI,KAAK4xC,0BAA2B,IApMpC,mBAuME,WAEE5xC,KAAK6O,eAAewO,QACpBrd,KAAK4a,UAAUyC,UA1MnB,oCA6ME,SACuBvb,GACrB,IAAMlC,EAAKI,KAAK4a,UAAUomB,SAASl/B,GAC/BowC,EAAiBlyC,KAAK4a,UAAUu3B,qBAAqBvyC,GACpDsyC,IACHA,EAAiBlyC,KAAK4a,UAAUw3B,qBAAqBxyC,IAGvDI,KAAK6O,eAAe8tB,OAAO/8B,GAC3BI,KAAK4a,UAAUy3B,UAAUvwC,GAEzB9B,KAAKsyC,iBAAiBJ,KAxN1B,8BA2NE,SACiBpwC,GACf,IAAIysC,GAAmBvuC,MAAM,CAC3B,IAAMm3B,EAAQn3B,KAAK4a,UAAUomB,SAASl/B,GACtC9B,KAAKuyC,oBAAoBpb,GAE3Bn3B,KAAK4a,UAAUI,iBAAiBlZ,GAC5BkkC,GAAyBhmC,MAAMwyC,YACjCjnB,GAAWvrB,MAAMgb,iBAAiBlZ,KAnOxC,8BAuOE,SAA+Bq1B,EAAesb,GACxCA,EACFzyC,KAAK0yC,iBAAiBvb,GAEtBn3B,KAAKuyC,oBAAoBpb,KA3O/B,4BA+OE,WACE,OAAI6O,GAAyBhmC,MAAMwyC,WAC1BjnB,GAAWvrB,MAAM2yC,UAAUvY,MAAK,SAACtN,GAAD,OAAWA,EAAMC,cACpDxB,GAAWvrB,MAAM4yC,YAAY5yC,KAAK2lB,oBAClC/b,EAEG5J,KAAK2lB,cACR3lB,KAAK4a,UAAUypB,sBAAsBrkC,KAAK2lB,oBAC1C/b,IAvPV,gCA2PE,WACE,OAAIo8B,GAAyBhmC,MAAMwyC,WAC1BjnB,GAAWvrB,MAAM2yC,UAAUvY,MAAK,SAACtN,GAAD,OAAWA,EAAMC,cACpDxB,GAAWvrB,MAAM4yC,YAAY5yC,KAAK2lB,oBAClC/b,EAEG5J,KAAK2lB,cACR3lB,KAAK4a,UAAUspB,iBAAiBlkC,KAAK2lB,oBACrC/b,IAnQV,uBAuQE,WACE,GAAK5J,KAAK2lB,cAGV,OAAIqgB,GAAyBhmC,MAAMwyC,WAC1BjnB,GAAWvrB,MAAMsc,WAAWtc,KAAK2lB,oBAEP/b,IAA1B5J,KAAK6yC,iBACR7yC,KAAK4a,UAAUk4B,oBAAoB9yC,KAAK6yC,uBACxCjpC,IAhRV,+BAoRE,WACE,YAAiCA,IAA1B5J,KAAK6yC,mBArRhB,4BAwRE,WAEE,OADgCnN,GAA2B1lC,QAC3BA,KAAK4a,UAAU8pB,QACtC,GAEF1kC,KAAKue,QAAQyC,QAClB,SAACtZ,GAAD,OAAYA,EAAOiyB,YAAcpjB,GAAiBw8B,iBA9RxD,4BAkSE,WAEE,OADgCrN,GAA2B1lC,QAC3BA,KAAK4a,UAAU8pB,QACtC,GAEF1kC,KAAKue,QAAQyC,QAClB,SAACtZ,GAAD,OAAYA,EAAOiyB,YAAcpjB,GAAiBy8B,eAxSxD,0BA4SE,WAAgC,IAAD,OAE7B,OADgCtN,GAA2B1lC,QAC3BA,KAAK4a,UAAU8pB,QACtC,GAEF1kC,KAAKue,QAAQyC,QAClB,SAACtZ,GAAD,OACEA,EAAOiyB,YAAcpjB,GAAiB8jB,SACtC3yB,EAAO1I,OAASsX,GAAY28B,wBAC3BzN,GAAY,QArTrB,yBAyTE,WAA+B,IAAD,OAC5B,OAAOxlC,KAAKue,QAAQyC,QAClB,SAACtZ,GAAD,OACEA,EAAO1I,OAASsX,GAAY28B,uBAAyBzN,GAAY,QA5TzE,qBAgUE,WACE,OACExlC,KAAKic,UAAU+V,WACfwF,GAAax3B,MAAMgyB,YC9YOzuB,ED+YVvD,KC9YbwO,GAAYjL,GAAK8tC,cD8YErf,UC/YrB,IAAyBzuB,ID2EhC,uCAwUE,WACE,OAAIvD,KAAKwZ,gBAILxZ,KAAKkzC,cAAclhB,WACnBhyB,KAAKkzC,cAAcC,+BA9U3B,yBAmVE,WAEE,OAAsC,IAA/BnzC,KAAK8lB,eAAe1d,SArV/B,2BAwVE,WACE,OAAOpI,KAAKolB,cAAchd,OAAS,IAzVvC,yBA4VE,WAA+B,IAAD,IAC5B,iBAAOpI,KAAK8lB,sBAAZ,iBAAO,EAAsB,UAA7B,aAAO,EAA0BE,iBA7VrC,uBAgWE,WAGE,IADA,IAAI7f,EAAkBnG,MACdmG,EAAKqT,eACXrT,EAAOA,EAAK+sC,cAEd,OAAO/sC,IAtWX,0BAyWE,WAGE,OADe6H,GAAchO,MACfozC,qBAAqBpzC,KAAK6b,mBA5W5C,yBA+WE,WAGE,OADe7N,GAAchO,MACfqzC,sBAAsBrzC,KAAK6b,mBAlX7C,sBAqXE,WACE,OAAO9C,GAAsB/Y,KAAMA,KAAK8Y,UAtX5C,uCAyXE,WACE,IAAMw6B,EEpcH,SAAsB/vC,GAC3B,IAAM2iB,EAAML,GAAkBtiB,GACxB6iB,EAAKF,EAAI9d,OAAS,EAAI8d,EAAI,QAAKtc,EACrC,OAAOwc,EAAKmf,GAAenf,QAAMxc,EFicb2pC,CAAavzC,MAC/B,GAAIszC,EAAW,CACb,IADa,EACP7vC,EAASwiB,GAAiBjmB,MAC1Bk7B,EAAkB5P,GAAa7nB,GAE/B+vC,EG1cL,SAA4BjwC,GACjC,IAAMwiB,EAAKvX,GAAYjL,GAAKuiB,eAC5B,OAAOC,EAAG3d,OAAS,EAAI2d,EAAG,QAAKnc,EHwcH6pC,CAAmBzzC,MACrCkT,EAAoC,GAL7B,eAMEsgC,EAAgB1f,cANlB,IAMb,2BAA6C,CAAC,IAArC1N,EAAoC,QACrCstB,EAAwBjO,GAC5BhiC,EACA2iB,EAAG8N,kBAELhhB,EAAOkT,EAAGkO,iBACR4G,EAAgB9G,8BACdkf,EACAI,IAdO,8BAiBb,OAAOxgC,EAEP,MAAO,KA9Yb,+BAkZE,WACOlT,KAAK2lB,gBAGO8oB,GAAoBzuC,KAAMA,KAAK6wC,aACnCzmB,WAAa1D,GAAkBiD,IAC1C3pB,KAAK2zC,+BAEL3zC,KAAK4zC,gCA1ZX,iCA8ZE,WACO5zC,KAAK2lB,gBAGO8oB,GAAoBzuC,KAAMA,KAAK6wC,aACnCzmB,WAAa1D,GAAkBiD,IAC1C3pB,KAAK4zC,6BAEL5zC,KAAK2zC,kCAtaX,wCA0aE,WACE,GAAK3zC,KAAK2lB,cAAV,CAGA,IAAM/K,EAAY0Q,GAAatrB,MACzBob,EAAcR,EAAU0B,WAAWtc,KAAK2lB,eACxCkuB,EAAgBpO,GACpBzlC,KACAA,KAAK6wC,aACJ/xB,MACGg1B,EAAsB14B,EAAYy4B,GAClCE,EAAUn5B,EAAUsK,KAAKjH,MAC7B,SAACnc,GAAD,OAASA,EAAI+xC,KAAmBC,EAAsB,KAEnDC,IAGL34B,EAAYy4B,IAAkB,EAC9BE,EAAQF,IAAkB,EAC1B7zC,KAAK4a,UAAUI,iBAAiBI,GAChCpb,KAAK4a,UAAUI,iBAAiB+4B,GAChC/zC,KAAK4a,UAAUM,oBAAoB,CAACC,yBAAyB,IAC7Dnb,KAAK4a,UAAUo5B,cACb54B,EACApb,KAAK6wC,YACLz1B,EAAYy4B,IAEd7zC,KAAK4a,UAAUo5B,cACbD,EACA/zC,KAAK6wC,YACLkD,EAAQF,QAxcd,0CA4cE,WACE,GAAK7zC,KAAK2lB,cAAV,CAGA,IAAM/K,EAAY0Q,GAAatrB,MACzBob,EAAcR,EAAU0B,WAAWtc,KAAK2lB,eACxCkuB,EAAgBpO,GACpBzlC,KACAA,KAAK6wC,aACJ/xB,MACGg1B,EAAsB14B,EAAYy4B,GAClCI,EAAWr5B,EAAUsK,KAAKjH,MAC9B,SAACnc,GAAD,OAASA,EAAI+xC,KAAmBC,EAAsB,KAEnDG,IAGL74B,EAAYy4B,IAAkB,EAC9BI,EAASJ,IAAkB,EAC3B7zC,KAAK4a,UAAUI,iBAAiBI,GAChCpb,KAAK4a,UAAUI,iBAAiBi5B,GAChCj0C,KAAK4a,UAAUM,oBAAoB,CAACC,yBAAyB,IAC7Dnb,KAAK4a,UAAUo5B,cACb54B,EACApb,KAAK6wC,YACLz1B,EAAYy4B,IAEd7zC,KAAK4a,UAAUo5B,cACbC,EACAj0C,KAAK6wC,YACLoD,EAASJ,QA1ef,2BA8eE,WACE,IAAMluB,EAAgBC,GAAiB5lB,MAEnCk0C,OAAQtqC,EACR+b,IACFuuB,EAAQlO,GAAyBhmC,MAAMwyC,WACnCjnB,GAAWvrB,MAAMm0C,aAAaxuB,GAC9B2F,GAAatrB,MAAMmyC,qBAAqBxsB,IAE1CuuB,GACFl0C,KAAKsyC,iBAAiB4B,KAxf5B,2BA4fE,WACE,IAAMvuB,EAAgBC,GAAiB5lB,MAEnCk0C,OAAQtqC,EACR+b,IACFuuB,EAAQlO,GAAyBhmC,MAAMwyC,WACnCjnB,GAAWvrB,MAAMo0C,iBAAiBzuB,GAClC2F,GAAatrB,MAAMoyC,qBAAqBzsB,IAE1CuuB,GACFl0C,KAAKsyC,iBAAiB4B,KAtgB5B,0CA0gBE,WAAoBvkC,EAAqB7N,GAAzC,kFACQylB,EAAW5X,EAAS/P,QAEPgK,KADbyqC,EAAa1F,GAA8B3uC,KAAMunB,IAFzD,iDAKiB,OADTtd,EAAQnI,EAAIuyC,GAJpB,SAKuBngC,GAAiBxE,cAAcC,EAAU1F,GALhE,UAKQglC,EALR,SAMM3vB,EAAW2vB,GAAU/6B,GAAmBhE,YAAYlQ,KAAMivC,IANhE,iBAgBI,OARA3vB,EAAQ,6BAAOA,GAAP,IAAiB7b,YAAQmG,EAAWiU,SAAU,KACtDyB,EAAWg1B,aAAQh1B,GAAU,SAACi1B,GACxBj1B,EAAS1B,WAAW5e,KAAKsG,WAAW,2BACtCivC,EAAM32B,WAAW5e,KAAO,yBAE1Bu1C,EAAM32B,WAAWxG,YAAc,WAbrC,UAgBUw3B,GAAoB5uC,KAApB4uC,CAA0B,CAC9BrkC,WAAOX,EACPsU,KAAMoB,EACNk1B,YAAavqC,EACbwqC,oBAAoB,IApB1B,iDA1gBF,2BAmiBE,SACElqC,EACAzI,EACA6N,EACA+kC,GAEA,IAAK/kC,EAASglC,SAAU,CAEtB,GAAID,IADiBppB,GAAatrB,MAAM+B,aAAaD,EAAK6N,GAExD,OAEF2b,GAAatrB,MAAM40C,kBAAkB9yC,EAAK6N,EAAS/P,GAAI80C,MA9iB7D,qCAkjBE,kFAEM10C,KAAK2xC,qBAFX,gBAEiC,uBAAM3xC,KAAK2xC,qBAAsBkD,gBAAjC,QAFjC,gDAljBF,oCAujBE,kFAEM70C,KAAK2xC,qBAFX,gBAEiC,uBAAM3xC,KAAK2xC,qBAAsBmD,eAAjC,QAFjC,gDAvjBF,4BA4jBE,WACE,IAAI9O,GAAyBhmC,MAAMwyC,WAAnC,CAGA,IAAM53B,EAAY0Q,GAAatrB,MACzB+0C,EAAWn6B,EAAUwpB,cACvB2Q,EACF/0C,KAAKsyC,iBAAiB13B,EAAUomB,SAAS+T,IAEzC/0C,KAAKsyC,sBAAiB1oC,MArkB5B,2BAykBE,WACE,IAAIo8B,GAAyBhmC,MAAMwyC,WAAnC,CAGA,IAAM53B,EAAY0Q,GAAatrB,MACzBg1C,EAAUp6B,EAAUq6B,aACtBD,EACFh1C,KAAKsyC,iBAAiB13B,EAAUomB,SAASgU,IAEzCh1C,KAAKsyC,sBAAiB1oC,MAllB5B,mCAslBE,WACE,IAAMsrC,EACJl1C,KAAK2lB,eAAiB3lB,KAAK4a,UAAU0B,WAAWtc,KAAK2lB,eAClD3lB,KAAKw0B,YAAe0gB,GAAgCl1C,KAAKob,aAC5Dpb,KAAKozB,mBA1lBX,uBA8lBE,SAAwBtxB,GACtB9B,KAAKsyC,iBAAiBtyC,KAAK4a,UAAUomB,SAASl/B,MA/lBlD,8BAkmBE,SACiBlC,GACf,GAAII,KAAK2lB,gBAAkB/lB,EAA3B,CAGAI,KAAK2lB,cAAgB/lB,EACjBI,KAAKyyB,iBACPzyB,KAAKolB,cAAc2G,SAAQ,SAAC8H,GAAD,OACzBA,EAAQvO,cAAc1K,UAAUM,yBAGpC,IAAM4X,EAAO9yB,KACRA,KAAK2lB,eAINzX,GAAuBlO,MAAMm1C,oBAAsBn1C,KAAKJ,IAC1D+jB,GAAqB,CACnBpgB,IAAKuvB,EACLprB,OAAO,WAAD,4BAAE,sBAAA3C,EAAA,sEACAgqC,GAAoBjc,EAApBic,CACJtoB,GAAcqM,GACd7R,GAAyB6R,GACzBA,EAAKnN,eAJD,2CAAF,kDAAC,QArnBf,2BAkoBE,WAEE3lB,KAAK0xC,eAAe5lC,KAAK,IAAI+jC,GAAe7vC,KAAK2lB,kBApoBrD,8BAuoBE,WAEE,IAAM7N,EAAQ9X,KAAK0xC,eAAezgC,MAC9B6G,GAASA,EAAM6N,gBACjB3lB,KAAKsyC,iBAAiBx6B,EAAM6N,eACvB4f,GAAevlC,OAClBA,KAAKozB,iBAEPhd,GAAkBpW,MAAMo1C,yBA/oB9B,yBAmpBE,WACE,OAAOt5B,GAAc9b,OAASA,KAAKw0B,aAppBvC,0DAupBE,gGAEEx0B,KAAKic,UAAUwO,QACYzqB,KAAK8b,eAE9B9b,KAAKwrB,kBAAkBf,QAEzBvc,GAAuBlO,MAAMq1C,kBAAiB,kBAC5C,EAAK7pB,kBAAkBuF,aAR3B,SAUQ/wB,KAAK4a,UAAU6P,QAVvB,cAWEvc,GAAuBlO,MAAMq1C,iBAC3B1kB,oBACE,iBAAO,CACLhL,cAAe,EAAKA,cACpB2vB,UAAWhqB,GAAa,GAAMyJ,QAAQ3sB,WAExC,SAACmtC,GACKrnC,GAAuB,GAAMskB,6BAA6B,SAGjC5oB,IAAzB2rC,EAAO5vB,eAA+B4vB,EAAOD,UAAY,GAC3D,EAAKj6B,0BAGT,CACEwX,iBAAiB,KA1BzB,SA8BQ7yB,KAAK4a,UAAU6P,QA9BvB,gDAvpBF,wEAwrBE,WACEzqB,KAAKk/B,WAAWnT,SAAQ,SAAC0T,GAAD,OAAUA,EAAK2D,UACvCpjC,KAAK4a,UAAUwoB,SA1rBnB,qBA6rBE,WAGE,OAAmC,IADjC4C,GAAyBhmC,MAAMymC,8BACTr+B,OACpBkjB,GAAatrB,MAAMklB,KpBxvBpB,SAA4BswB,GACjC,IAAMtiC,EAAsB,GACxBuiC,EAAQ,EAEZ,SAAS/3B,EAAUoP,GAEjB,GADA5Z,EAAOpH,KAAK,IAAIo6B,GAAcuP,EAAO3oB,IAChCA,EAAMC,WAAX,CAFwC,qBAG1BD,EAAM4oB,aAHoB,IAGxC,2BAAiC,CAAC,IAAzBC,EAAwB,QAC/BF,IACA/3B,EAAUi4B,GACVF,KANsC,8BAQP,IAA7B3oB,EAAM4oB,YAAYttC,QACpB8K,EAAOpH,KAAP,MAAAoH,EAAM,aAAS4Z,EAAM8oB,aAbsC,qBAiB7CJ,GAjB6C,IAiB/D,2BACE93B,EAD4B,SAjBiC,8BAoB/D,OAAOxK,EoBquBD2iC,CAAmBtqB,GAAWvrB,MAAM6sB,kBAlsB5C,uCA6sBE,WACM7sB,KAAK2xC,sBACP3xC,KAAK2xC,qBAAqB5gB,UAE5B/wB,KAAK2xC,qBAAuB3xC,KAAK81C,kBACjC5nC,GAAuBlO,MAAMq1C,iBAC3Br1C,KAAK2xC,qBAAqBlnB,WAntBhC,6BAutBE,WACE,IAAMsrB,EACoE,IAAxE/P,GAAyBhmC,MAAMymC,8BAA8Br+B,OACzDolB,EAAgBlC,GAAatrB,MAAMwtB,cACzC,OAAIA,aAAyBwO,IAAsB+Z,EAC1C,IAAIpoB,GAAqB,CAC9BpqB,IAAKvD,KACLksB,eAAgBlsB,KAAKksB,eACrBC,YAAansB,KAAKmsB,YAClBqB,cAAeA,EACfC,iBAAa7jB,EACb8jB,mBAAoB,IAAIzB,GACtBjsB,KACAA,KAAKksB,eACLlsB,KAAKmsB,eAIF,IAAIoB,KAzuBjB,kCA8uBE,SAAqB1c,GACnB7Q,KAAKsb,iBAAiB3F,MAAM9E,KA/uBhC,sBAmvBE,SAASmlC,EAAgBrgC,GACvB,MAAM,IAAIjV,MAAM,6CApvBpB,2BAwvBE,SAAcmb,GACZ,MAAM,IAAInb,MAAM,kDAzvBpB,sBA4vBE,WACEV,KAAK4a,UAAU0qB,2BA7vBnB,kEAkwBE,uCAAAvgC,EAAA,yDACQkxC,EAAmB9G,GAAwBnvC,MAC9Ck2C,yBAAyBC,qBAAqBn1B,QAC7C,SAACo1B,GAAD,OAAkBA,EAAaC,aAEhCx0C,KAAI,SAACu0C,GAAD,OAAkBA,EAAantB,cAChCpI,EAASzK,GAAkBpW,MAC9Bs2C,mBAAmBt1B,QAAO,SAACrR,GAAD,OACzBsmC,EAAiBxhC,SAAS9E,EAAS/P,OAEpCiC,KAAI,SAAC8N,GACJ,MAAO,CACL4mC,QAAS5mC,EAASkB,KAClB2lC,UAAW7mC,EAAS/P,GACpBkQ,SAAUH,EAASI,SACnB0mC,OAAQ9mC,EAAS+mC,iBACjBC,eAAgBhnC,EAASinC,kBACrB,CACAC,aAAclnC,EAASinC,kBACvBE,MAAO,EAAKC,oBAAoBpnC,SAEhC/F,MAGe,QACnBjG,EAAMD,EAAO1D,OACf27B,GAA0B37B,MA1BhC,gCA2BU2D,EAAIqzC,aAAa,CACrBxjB,OAAQxzB,KAAK8Y,OACbm+B,OAAQp2B,EACR6N,sBAAuBnI,GAAavmB,MACpCk3C,OAAQ,GACRC,sBAAuB,CACrBzoB,sBAAuBnI,GAAavmB,MACpC4uB,OAAQ9F,GAAe,CAACvlB,IAAKvD,OAC7ByuB,OAAQhI,GAAczmB,MACtB2uB,sBAAuB1N,GAAyBjhB,MAChD+uB,SAAU/E,GAAgBhqB,MAC1BgvB,SAdmB,QAenBG,UAAW,EACXC,YAAaxO,GAAqB5gB,MAClC8uB,cAAe5B,GAAqBltB,SAzC5C,+CA6CU2D,EAAIqzC,aAAa,CACrBxjB,OAAQxzB,KAAK8Y,OACbm+B,OAAQp2B,EACR6N,sBAAuBnI,GAAavmB,MACpCk3C,OAAQl3C,KAAK4a,UAAUsK,KAAKrjB,KAAI,SAACC,GAAD,OAAS,EAAK8Y,UAAUomB,SAASl/B,MACjEq1C,2BAAuBvtC,IAlD7B,iDAlwBF,uFAyzBE,SAA4B+F,GAC1B,OAAOA,EAASwvB,gBACbne,QAAO,SAACye,GAAD,OAAUA,EAAK2X,wBACtB1tC,QAAO,SAAC7H,EAAgC49B,GAEvC,OADA59B,EAAI49B,EAAK2X,sBAAyB3X,EAAK7/B,GAChCiC,IACN,QA/zBT,oDAKGG,cALH,wEAKgD,MALhD,8JA+DGA,cA/DH,wGAkEGgF,YAlEH,+HA8GGhF,cA9GH,wEA8GiD,MA9GjD,wDA6HGA,cA7HH,yEA6HyC,KA7HzC,8CA8HGA,cA9HH,yEA8H4C,IAAI4zB,OA9HhD,+CAgIG5zB,cAhIH,yEAgIgDghC,GAAeqN,SAhI/D,6CAkIGruC,cAlIH,kHAoIGgF,YApIH,4IAwIGA,YAxIH,qIA4IG0rB,MA5IH,w3BA+OG1rB,YA/OH,gIA2PGA,YA3PH,2HAuQGA,YAvQH,0HAoRGA,YApRH,+HAwRGA,YAxRH,4HAkSGA,YAlSH,0HA4SGA,YA5SH,uHAyTGA,YAzTH,kHAgUGA,YAhUH,gIAwUGA,YAxUH,oIAmVGA,YAnVH,wHAwVGA,YAxVH,wHA4VGA,YA5VH,oHAgWGA,YAhWH,qHAyWGA,YAzWH,uHA+WGA,YA/WH,mHAqXGA,YArXH,iIAyXGA,YAzXH,wsEA6rBGA,YA7rBH,qHAusBGhF,cAvsBH,kEI3Eaq1C,GAGX,WAAYz2C,GAA4B,yBAFxC02C,sBAA2B,EAEY,KAIvC7zC,YAJuC,OAMvC7D,GAAa,GAN0B,KAOvCiR,KAAe,GAPwB,KAQvCiI,OAAiB,GARsB,KASvClX,OAAiB,GATsB,KAUvCkd,MAAgB,EATdpH,OAAOC,OAAO3X,KAAMY,ICMlB22C,GAAW,GA40BV,SAASC,GAAezyC,EAA8B4E,GAC3D,QAAUC,IAAN7E,GAAyB,OAANA,EACrB,OAAO,EACF,QAAU6E,IAAND,GAAyB,OAANA,EAC5B,OAAQ,EAEV,IAAM3I,EAASmQ,KACf,OAAOpM,EAAEuxB,WAAWmhB,cAAc9tC,EAAE2sB,WAAYt1B,GCp1B3C,SAAS02C,GAAiBn0C,EAAUo0C,GACzC,QAAa/tC,IAAT+tC,GAA+B,OAATA,EACxB,OAAOA,EAET,IAAMC,EAXR,SAA+Br0C,GAA0B,IAAD,IACtD,2BAAOoK,GAAsBpK,GAAKs0C,sBAAlC,aAAO,EAA2CD,oBAAlD,QAAkE,CAChEE,eAAe,EACfC,iBAAiB,GAQEC,CAAsBz0C,GAO3C,OANKq0C,EAAaE,gBAChBH,EAAOA,EAAKM,eAETL,EAAaG,kBAChBJ,EAAgBA,ED6zBPnyC,QAAQ,sBAAsB,SAAUT,GACjD,OAAOwyC,GAASW,UAAUnzC,IAAMA,MC5zB3B4yC,EAGF,SAASQ,GAAoB50C,EAAU0G,GAE5C,MAAqB,kBAAVA,GAAsBA,aAAiBmuC,OACzCV,GAAiBn0C,EAAK0G,GAE3BV,MAAM0Q,QAAQhQ,GACTA,EAAMpI,KAAI,SAAAw2C,GAAG,OAAIF,GAAoB50C,EAAK80C,MAE5CpuC,EDpBTstC,GAASW,UAAY,CACnB,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,KACL,OAAK,KACL,SAAK,KACL,SAAK,KACL,SAAK,KACL,SAAK,KACL,SAAK,KACL,SAAK,KACL,SAAK,KACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,KACL,SAAK,KACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,KACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,KACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,KACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,KACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,KACL,SAAK,KACL,SAAK,IACL,SAAK,IACL,SAAK,KACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,KACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,KACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,KACL,SAAK,KACL,SAAK,IACL,SAAK,KACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,KACL,SAAK,IACL,SAAK,KACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,KACL,OAAK,KACL,SAAK,KACL,SAAK,KACL,SAAK,KACL,SAAK,KACL,SAAK,KACL,SAAK,KACL,SAAK,KACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,KACL,SAAK,KACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,KACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,KACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,KACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,KACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,KACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,OAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,KACL,SAAK,KACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,KACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,KACL,SAAK,IACL,SAAK,KACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,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","file":"static/js/main.33e3bd24.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"headerIcon\":\"HeaderButton_headerIcon__3uXMm\",\"headerIconActive\":\"HeaderButton_headerIconActive__2zXHa\",\"headerIconHidden\":\"HeaderButton_headerIconHidden__LFvPG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"resultIemRow\":\"ResultItem_resultIemRow__1Y9Gv\",\"resultIemRowHovered\":\"ResultItem_resultIemRowHovered__2FkO5\",\"resultIemRowSelected\":\"ResultItem_resultIemRowSelected__1oO6r\",\"itemIcon\":\"ResultItem_itemIcon__3NtUv\",\"itemContents\":\"ResultItem_itemContents__3gu1H\",\"itemTitle\":\"ResultItem_itemTitle__1oftb\",\"itemTextSeparator\":\"ResultItem_itemTextSeparator__1hbkp\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"MobileBooleanInput_root__3LaJ4\",\"slot\":\"MobileBooleanInput_slot__IjEiU\",\"readOnly\":\"MobileBooleanInput_readOnly__Gsjdv\",\"off\":\"MobileBooleanInput_off__153AN\",\"nob\":\"MobileBooleanInput_nob__3F0nS\",\"on\":\"MobileBooleanInput_on__jGlqI\",\"undefined\":\"MobileBooleanInput_undefined__2TCcz\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"heading\":\"TabSelector_heading__3pc01\",\"titleContainer\":\"TabSelector_titleContainer__1uSYf\",\"icon\":\"TabSelector_icon__1FKyA\",\"screenName\":\"TabSelector_screenName__yjGrf\",\"dirtyIcon\":\"TabSelector_dirtyIcon__pHimP\",\"dirtyDropDownItem\":\"TabSelector_dirtyDropDownItem__3MYPb\",\"dirtyScreenName\":\"TabSelector_dirtyScreenName__1X49Y\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"alert\":\"RootError_alert__1bPMk\",\"alertDanger\":\"RootError_alertDanger__15wwz\",\"root\":\"RootError_root__2ZGWy\",\"inPageLink\":\"RootError_inPageLink__3FuS4\",\"returnLink\":\"RootError_returnLink__2M3t_\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ScreenHeader_root__XtVru\",\"progressIndicator\":\"ScreenHeader_progressIndicator__1aeCl\",\"indefinite\":\"ScreenHeader_indefinite__3cpO9\",\"slideright\":\"ScreenHeader_slideright__2zQfL\",\"workflowActionBtn\":\"ScreenHeader_workflowActionBtn__KnoD-\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"noSelect\":\"TreeView_noSelect__17rHq\",\"expander\":\"TreeView_expander__3L8So\",\"treeView\":\"TreeView_treeView__1F3Me\",\"nodeLabel\":\"TreeView_nodeLabel__16Tbo\",\"node\":\"TreeView_node__3bs1W\",\"nodeSelected\":\"TreeView_nodeSelected__1Wy67\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"FilterEditor_root__P-5hN\",\"filterRow\":\"FilterEditor_filterRow__2atR4\",\"rowCount\":\"FilterEditor_rowCount__2b_Vy\",\"rowContainer\":\"FilterEditor_rowContainer__3eAAD\",\"label\":\"FilterEditor_label__1ILLV\",\"filterSettingContainer\":\"FilterEditor_filterSettingContainer__2TnFz\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"CheckList_root__1b_eb\",\"focusedLabel\":\"CheckList_focusedLabel__1BAwE\",\"unFocusedLabel\":\"CheckList_unFocusedLabel__17NcI\",\"item\":\"CheckList_item__3SnE1\",\"editorContainer\":\"CheckList_editorContainer__LZM9U\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialogContent\":\"ErrorDialog_dialogContent__28cVW\",\"errorMessageList\":\"ErrorDialog_errorMessageList__w2M8V\",\"errorMessageListItem\":\"ErrorDialog_errorMessageListItem__19Wve\",\"errorMessageDatetime\":\"ErrorDialog_errorMessageDatetime__1FRWj\",\"dialogBigIconColumn\":\"ErrorDialog_dialogBigIconColumn__1AdKK\",\"dialogMessageColumn\":\"ErrorDialog_dialogMessageColumn__2cJk4\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ActionDropUp_root__h6hqB\",\"clickArea\":\"ActionDropUp_clickArea__3HclI\",\"iconContainer\":\"ActionDropUp_iconContainer__2xnzZ\",\"placeholder\":\"ActionDropUp_placeholder__2boj6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"divider\":\"Splitter_divider__1eCA-\",\"root\":\"Splitter_root__3DyVI\",\"panel\":\"Splitter_panel__1-mk_\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"trigger\":\"FilterSettingsComboBox_trigger__3Tn6f\",\"container\":\"FilterSettingsComboBox_container__3oZRL\",\"dropdownSymbol\":\"FilterSettingsComboBox_dropdownSymbol__2JaTE\",\"dropdown\":\"FilterSettingsComboBox_dropdown__1AM02\",\"dropdownItem\":\"FilterSettingsComboBox_dropdownItem__3hdPN\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"DetailNavigator_root__VxtzL\",\"navigationButtonList\":\"DetailNavigator_navigationButtonList__22lJP\",\"navigatorButtonListRoot\":\"DetailNavigator_navigatorButtonListRoot__5AzIp\",\"contentPlaceholder\":\"DetailNavigator_contentPlaceholder__19MeG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"WebScreen_root__3AKKk\",\"webContent\":\"WebScreen_webContent__aTCat\",\"progressIndicator\":\"WebScreen_progressIndicator__27DmF\",\"indefinite\":\"WebScreen_indefinite__2o895\",\"slideright\":\"WebScreen_slideright__26Adi\",\"transparentOverlay\":\"WebScreen_transparentOverlay__3c-O8\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"filterInput\":\"TagInputEditor_filterInput__1JBvo\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"inputRow\":\"SearchView_inputRow__ZLz2u\",\"icon\":\"SearchView_icon__3R6Vb\",\"input\":\"SearchView_input__3etZ_\",\"resultsContainer\":\"SearchView_resultsContainer__bIIwO\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"resultGroupRow\":\"ResultGroup_resultGroupRow__2Fmwf\",\"groupName\":\"ResultGroup_groupName__1c_Oh\",\"arrow\":\"ResultGroup_arrow__3JDvC\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"tagInputContainer\":\"TagInput_tagInputContainer__tKnU9\",\"tagInputAdd\":\"TagInput_tagInputAdd__YXLft\",\"tagInputItem\":\"TagInput_tagInputItem__1JJOE\",\"tagInputItemDelete\":\"TagInput_tagInputItemDelete__RkBId\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"droppedPanelContainer\":\"ColorEditor_droppedPanelContainer__3ZqTv\",\"dropdownSymbol\":\"ColorEditor_dropdownSymbol__2kPcG\",\"input\":\"ColorEditor_input__1isDF\",\"notification\":\"ColorEditor_notification__39mpy\",\"editorContainer\":\"ColorEditor_editorContainer__1B5PF\",\"colorDiv\":\"ColorEditor_colorDiv__2IAit\",\"colorRect\":\"ColorEditor_colorRect__XRfcE\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"caption\":\"CheckBox_caption__1O04L\",\"editor\":\"CheckBox_editor__2J2PU\",\"focusedLabel\":\"CheckBox_focusedLabel__eM8ql\",\"unFocusedLabel\":\"CheckBox_unFocusedLabel__sN3ng\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ComboBox_root__CKwq9\",\"mobileInput\":\"ComboBox_mobileInput__55u54\",\"input\":\"ComboBox_input__3PzQv\",\"link\":\"ComboBox_link__2gnHO\",\"readOnly\":\"ComboBox_readOnly__24LF0\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"anchor\":\"MainMenuItem_anchor__3Tvko\",\"icon\":\"MainMenuItem_icon__3ITAx\",\"label\":\"MainMenuItem_label__2cE_P\",\"linkContainer\":\"MainMenuItem_linkContainer__Id-l8\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"divider\":\"CustomSplitter_divider__-qkL1\",\"root\":\"CustomSplitter_root__1yjRe\",\"panel\":\"CustomSplitter_panel__1ugRS\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"editor\":\"CommonStyle_editor__fG3fi\",\"editorContainer\":\"CommonStyle_editorContainer__2GsW2\",\"notification\":\"CommonStyle_notification__1invu\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"droppedPanel\":\"FilterSettingsLookup_droppedPanel__QJJs8\",\"optionGridCell\":\"FilterSettingsLookup_optionGridCell__3g_aD\",\"noItemsFound\":\"FilterSettingsLookup_noItemsFound__3g9gh\",\"tagInput\":\"FilterSettingsLookup_tagInput__38Hhm\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"BottomToolBar_root__34o_c\",\"isRed\":\"BottomToolBar_isRed__3K4PY\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"TabbedViewHandle_root__FtmjE\",\"label\":\"TabbedViewHandle_label__3WKQA\",\"closeBtn\":\"TabbedViewHandle_closeBtn__2Qz-R\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"disabled\":\"DataViewHeaderButton_disabled__30tMu\",\"enabled\":\"DataViewHeaderButton_enabled__2_PK_\",\"root\":\"DataViewHeaderButton_root__3wMyU\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dataView\":\"DataView_dataView__3BBVa\",\"dataViewOverlay\":\"DataView_dataViewOverlay__369Wv\",\"dataViewLoadingLabel\":\"DataView_dataViewLoadingLabel__3vmXn\",\"overlayContainer\":\"DataView_overlayContainer__1dL0r\",\"dataViewContentContainer\":\"DataView_dataViewContentContainer__3RCrJ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"BottomIcon_root__1-p0m\",\"icon\":\"BottomIcon_icon__10Xuh\",\"hidden\":\"BottomIcon_hidden__3_ffy\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"RadioButton_root__34icq\",\"input\":\"RadioButton_input__jeBj6\",\"label\":\"RadioButton_label__2jyKx\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ScreenToolbarAction_root__1Qbw8\",\"icon\":\"ScreenToolbarAction_icon__3UHK7\",\"label\":\"ScreenToolbarAction_label__TtlI4\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"version\":\"AboutView_version__2bj_w\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"SidebarSectionHeader_root__3FxtF\",\"icon\":\"SidebarSectionHeader_icon__1WRni\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"WorkQueuesItem_root__2-1M-\",\"icon\":\"WorkQueuesItem_icon__2G6oy\",\"label\":\"WorkQueuesItem_label__2TgXV\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"favoritesList\":\"CFavorites_favoritesList__3N9pZ\",\"forceOpenSection\":\"CFavorites_forceOpenSection__3sRav\",\"favoritesFolderHeader\":\"CFavorites_favoritesFolderHeader__kPTR0\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"navigationBar\":\"BreadCrumbs_navigationBar__201rC\",\"breadcrumb\":\"BreadCrumbs_breadcrumb__zrbA7\",\"pathSeparator\":\"BreadCrumbs_pathSeparator__7l9jv\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Root\":\"ScreenArea_Root__3zQy3\",\"TabHandles\":\"ScreenArea_TabHandles__2ZPP4\",\"TabHandle\":\"ScreenArea_TabHandle__33XJ2\",\"TabHandleCloseBtn\":\"ScreenArea_TabHandleCloseBtn__1moBk\",\"active\":\"ScreenArea_active__1FruL\",\"dialogLoadingContent\":\"ScreenArea_dialogLoadingContent__2igd-\",\"actionButtonHeader\":\"ScreenArea_actionButtonHeader__Q-iIA\",\"workflowActionBtn\":\"ScreenArea_workflowActionBtn__UHW-X\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"DataViewHeaderAction_root__3GKkP\",\"isDisabled\":\"DataViewHeaderAction_isDisabled__3eW8i\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"droppedBox\":\"Dropdowner_droppedBox__2nMdX\",\"dropdownerContainer\":\"Dropdowner_dropdownerContainer__2986s\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"DataViewHeader_root__3U46w\",\"inner\":\"DataViewHeader_inner__23mfh\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"DropdownItem_root__lFOYV\",\"isSelected\":\"DropdownItem_isSelected__2sEuT\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ColumnOrderEditor_root__2Eq9H\",\"row\":\"ColumnOrderEditor_row__c_UjO\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"formView\":\"FormView_formView__ppscI\",\"formViewForm\":\"FormView_formViewForm__3NXWj\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"input\":\"NumberEditor_input__3mA4i\",\"editorContainer\":\"NumberEditor_editorContainer__xgmo9\",\"notification\":\"NumberEditor_notification__2pf_S\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"scrollee\":\"Scrollee_scrollee__2vPBU\",\"scrolleeShifted\":\"Scrollee_scrolleeShifted__1WyCM\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"scroller\":\"Scroller_scroller__1l0_M\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"WorkflowFinishedPanel_root__V4n-y\",\"message\":\"WorkflowFinishedPanel_message__yQcJb\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"divider\":\"WorkbenchPage_divider__16KmV\",\"root\":\"WorkbenchPage_root__2EiJb\",\"panel\":\"WorkbenchPage_panel__1qRys\",\"mobileContainer\":\"WorkbenchPage_mobileContainer__3nYJL\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"MenuButton_root__1yfy_\",\"menuIcon\":\"MenuButton_menuIcon__pnx86\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"MainBar_root__msk09\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ScreenTabsArea_root__3Z2Au\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"TabbedViewHandleRow_root__3njsv\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialogContent\":\"processActionQueryResult_dialogContent__1O36_\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"DataViewHeaderButtonGroup_root__23g4O\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Dropdown_root__I7Lwm\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"DataViewHeaderGroup_root__2r663\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"DropdownDivider_root__2Yfx6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"DataViewLoading_container__8OvTG\",\"label\":\"DataViewLoading_label__xpVba\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"mobileInputContainer\":\"FilterSettingsBoolean_mobileInputContainer__3GymC\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ClearableInput_root__2NI6P\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"InputClearButton_root__5ZlcJ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"cell\":\"NumberCell_cell__1pxvS\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"cell\":\"BooleanCell_cell__1j1fo\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ComboFullScreenEditor_root__3ufog\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"RecordInfo_root__23Waa\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"SidebarRecordInfo_root__2dTV2\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"formRoot\":\"FormRoot_formRoot__33ALv\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"image\":\"ImageEditor_image__3LIR0\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"editorContainer\":\"BoolEditor_editorContainer__ijNPb\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"FormSectionHeader_root__3PwDE\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"FormLabel_root__2n5qS\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"FormPerspectiveDirector_root__3LMZh\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"canvas\":\"Canvas_canvas__Hmfib\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"headerRow\":\"HeaderRow_headerRow__3pdNJ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"positionedField\":\"PositionedField_positionedField__3JNW7\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"SelectionCheckboxHeader_root__2RpRQ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"aggregationRow\":\"TableView_aggregationRow__3epa6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"TablePerspectiveDirector_root__LrLkU\"};","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import S from './styles.module.scss';\r\nimport { observable } from \"mobx\";\r\nimport React, { useState } from \"react\";\r\nimport moment from \"moment\";\r\nimport {\r\n  ILocalization,\r\n  ILocalizer,\r\n  IPluginData,\r\n  ISectionPlugin\r\n} from \"@origam/plugin-interfaces\";\r\nimport { FilePond,registerPlugin } from \"react-filepond\";\r\nimport FilePondPluginFileValidateType from 'filepond-plugin-file-validate-type';\r\n\r\nimport 'filepond/dist/filepond.min.css'\r\n\r\n\r\n// Import the Image EXIF Orientation and Image Preview plugins\r\n// Note: These need to be installed separately\r\nimport FilePondPluginImageExifOrientation from \"filepond-plugin-image-exif-orientation\";\r\nimport FilePondPluginImagePreview from \"filepond-plugin-image-preview\";\r\nimport \"filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css\";\r\n\r\n// Register the plugins\r\nregisterPlugin(FilePondPluginImageExifOrientation, FilePondPluginImagePreview);\r\n\r\n// Register the plugin\r\nregisterPlugin(FilePondPluginFileValidateType);\r\n\r\n\r\nconst apiurl = \"ApiUrl\";\r\nconst filterFileType = \"FilterFileType\";\r\nconst invalidFileTypeMessage = \"InvalidFileTypeMessage\"\r\nconst maxParallelUploads = \"MaxParallelUploads\"\r\nconst instantUpload = \"InstantUpload\"\r\n\r\nexport class FileUploadSectionPlugin implements ISectionPlugin {\r\n  requestSessionRefresh: (() => Promise<any>) | undefined;\r\n  setScreenParameters: ((parameters: { [key: string]: string; }) => void) | undefined;\r\n  $type_ISectionPlugin: 1 = 1;\r\n  id: string = \"\"\r\n  apiurl: string ;\r\n  filterFileType: string | undefined;\r\n  invalidFileTypeMessage: string | undefined;\r\n  instantUpload:boolean | undefined;\r\n  maxParallelUploads:number | undefined;\r\n\r\n  @observable\r\n  initialized = false;\r\n\r\n  initialize(xmlAttributes: { [key: string]: string }): void {\r\n    this.apiurl = this.getXmlParameter(xmlAttributes, apiurl);\r\n    this.filterFileType = this.getXmlParameter(xmlAttributes, filterFileType);\r\n    this.invalidFileTypeMessage = this.getXmlParameter(xmlAttributes, invalidFileTypeMessage);\r\n    this.instantUpload = (this.getXmlParameter(xmlAttributes, instantUpload) ==\"true\");\r\n    this.maxParallelUploads = Number.parseInt(this.getXmlParameter(xmlAttributes, maxParallelUploads));\r\n    this.initialized = true;\r\n  }\r\n  getXmlParameter(xmlAttributes: { [key: string]: string }, parameterName: string) {\r\n    if (!xmlAttributes[parameterName]) {\r\n      throw new Error(`Parameter ${parameterName} was not found.`)\r\n    }\r\n    return xmlAttributes[parameterName];\r\n  }\r\n\r\n  getComponent(data: IPluginData, createLocalizer: (localizations: ILocalization[]) => ILocalizer): JSX.Element {\r\n    const localizer = createLocalizer([]);\r\n    \r\n    moment.locale(localizer.locale)\r\n    if (!this.initialized) {\r\n      return <></>;\r\n    }\r\n    console.info(data.dataView);\r\n    const refRowId = data.dataView.tableRows[0][1];\r\n    if(refRowId == null)\r\n    {\r\n      return <></>;\r\n    }\r\n    const entityId = data.dataView.tableRows[0][2];\r\n\r\n    const url = this.apiurl + \"?refrowid=\" + refRowId + \"&entityid=\"+entityId;\r\n    console.info(url);\r\n    return (<FilePondComponent fileType={this.filterFileType} apiurl={url} invalidFileTypeMessage={this.invalidFileTypeMessage} \r\n    instantUpload={this.instantUpload} maxParallelUploads={this.maxParallelUploads} />    );\r\n  }\r\n  @observable\r\n  getScreenParameters: (() => { [parameter: string]: string }) | undefined;\r\n\r\n  generateData( data: IPluginData, column: string) {\r\n    return data.dataView.tableRows\r\n       .map(row => \r\n             data.dataView.getCellValue(row, column)\r\n         );\r\n   }\r\n}\r\n\r\nexport const FilePondComponent: React.FC<{\r\n  fileType:string | undefined;\r\n  apiurl:string;\r\n  invalidFileTypeMessage:string | undefined\r\n  instantUpload:boolean | undefined\r\n  maxParallelUploads:number | undefined\r\n\r\n}> = (props) => {\r\n  const ftype: string = props.fileType ?? \"\";\r\n  const [files] = useState([])\r\n  const [setFiles]:any = useState([])\r\n  return (\r\n    <div className={S.mainContainer}>\r\n      <div className={S.subContainer}>\r\n      <div className=\"FilePondComponent\" >\r\n           <FilePond\r\n              server={props.apiurl}\r\n              allowFileTypeValidation={true}\r\n              acceptedFileTypes={[ftype]}\r\n              labelFileTypeNotAllowed={props.invalidFileTypeMessage}\r\n              instantUpload={props.instantUpload??false}\r\n              maxParallelUploads={props.maxParallelUploads??1}\r\n              files={files}\r\n              allowReorder={true}\r\n              allowMultiple={true}\r\n              onupdatefiles={setFiles}\r\n              onerror={(error) => {if(error.code == 401) {alert(\"Please logout and login again.\")} else {alert(error.body)}}}\r\n              labelIdle='Drag & Drop your files or <span class=\"filepond--label-action\">Browse</span>'\r\n      />\r\n      </div>\r\n      </div>\r\n      </div>\r\n  )\r\n}","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ScreenToolbar_root__3cMcS\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ScreenToolbarPusher_root__1SqU0\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ScreenToolbarActionGroup_root__2_N5R\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"contentArea\":\"AboutDialog_contentArea__3ygJE\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"AlertCounter_root__uU1nW\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"LogoSection_root__Ak-q5\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"SidebarSection_root__3dIPV\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"SidebarSectionDivider_root__2Ai2p\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"MainMenuUL_root__1dCJf\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"MainMenuLI_root__2Ak2N\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"SidebarSectionBody_root__224Kf\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"editIcon\":\"EditButton_editIcon__2qZmz\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"logoLeft\":\"CSidebar_logoLeft__1FGy4\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ScreenHeaderAction_root__FbCq5\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ScreenHeaderPusher_root__LuqeN\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ScreenHeaderDivider_root__1Oh2l\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ScreenContainer_root__1I29E\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"label\":\"Label_label__15kpc\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"vBox\":\"VBox_vBox__Pzefn\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"hBox\":\"HBox_hBox__1ogW_\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"TabbedViewPanel_root__17_ol\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"TabbedView_root__2rKJQ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"TabbedViewPanelsContainer_root__1O4oQ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"box\":\"Box_box__3NhCV\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Screen_root__2hF7C\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Fullscreen_root__3g5_O\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"MobileMain_root__3-8C4\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"TopToolBar_root__UMuE3\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"SearchButton_root__2oi9z\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Search_root__3HM7W\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"MobileAboutView_root__28GUQ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ScreenHeader_root__1K8ua\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"mobileStyleSheetIdentifier\":\"mobile_mobileStyleSheetIdentifier__3apVP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"modalWindowOverlay\":\"DialogStack_modalWindowOverlay__1BRvX\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ColumnConfiguration_root__1DAjL\",\"content\":\"ColumnConfiguration_content__2hzn4\",\"columnConfigs\":\"ColumnConfiguration_columnConfigs__2PDSQ\",\"columnConfigHeader\":\"ColumnConfiguration_columnConfigHeader__DqSDI\",\"row\":\"ColumnConfiguration_row__W9OQh\",\"lockedColumnsRow\":\"ColumnConfiguration_lockedColumnsRow__1Q1O9\",\"buttonRow\":\"ColumnConfiguration_buttonRow__2HAlJ\",\"arrow\":\"ColumnConfiguration_arrow__1Z4ws\",\"input\":\"ColumnConfiguration_input__3zJsR\",\"dropdown\":\"ColumnConfiguration_dropdown__2Uo7i\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"input\":\"TextEditor_input__Ks5Rm\",\"readonlyDiv\":\"TextEditor_readonlyDiv__2a_fK\",\"scrollY\":\"TextEditor_scrollY__3ZRPK\",\"noScrollY\":\"TextEditor_noScrollY__2r71i\",\"wrapText\":\"TextEditor_wrapText__2UFLv\",\"multiLine\":\"TextEditor_multiLine__1F53U\",\"editorContainer\":\"TextEditor_editorContainer__2Z2US\",\"notification\":\"TextEditor_notification__3V8TR\",\"richTextWrappContainer\":\"TextEditor_richTextWrappContainer__34zCg\",\"richTextWrappStyle\":\"TextEditor_richTextWrappStyle__2zxU-\",\"richTextEditorStyle\":\"TextEditor_richTextEditorStyle__1LSH4\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialogContent\":\"DialogsCommon_dialogContent__110mb\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"inpuContainer\":\"FavoriteFolderPropertiesDialog_inpuContainer__RgF07\",\"lastRow\":\"FavoriteFolderPropertiesDialog_lastRow__kP5E4\",\"row\":\"FavoriteFolderPropertiesDialog_row__a3kco\",\"label\":\"FavoriteFolderPropertiesDialog_label__2SLxp\",\"textInput\":\"FavoriteFolderPropertiesDialog_textInput__2hl3d\",\"chcekBoxinput\":\"FavoriteFolderPropertiesDialog_chcekBoxinput__3BQJh\",\"notification\":\"FavoriteFolderPropertiesDialog_notification__2cwb-\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"avatarSection\":\"UserMenuDropdown_avatarSection__1NGCm\",\"avatarContainer\":\"UserMenuDropdown_avatarContainer__tn0qe\",\"avatar\":\"UserMenuDropdown_avatar__1JkhD\",\"clickableAvatar\":\"UserMenuDropdown_clickableAvatar__3sW0W\",\"pictureSection\":\"UserMenuDropdown_pictureSection__3VAy1\",\"infoSection\":\"UserMenuDropdown_infoSection__9qTcR\",\"userNameLabel\":\"UserMenuDropdown_userNameLabel__1CQHk\",\"root\":\"UserMenuDropdown_root__r5tcv\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"input\":\"FilterSettingsCommon_input__2ldkO\",\"tagEditorDropdown\":\"FilterSettingsCommon_tagEditorDropdown__yM5yF\",\"tagEditorDropdownItem\":\"FilterSettingsCommon_tagEditorDropdownItem__dGQQZ\",\"dateTimeInput\":\"FilterSettingsCommon_dateTimeInput__3_1jf\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"controlBtn\":\"CalendarWidget_controlBtn__Cu7GE\",\"dayTable\":\"CalendarWidget_dayTable__U8abk\",\"row\":\"CalendarWidget_row__1UDlS\",\"cell\":\"CalendarWidget_cell__1XyYE\",\"selectedDay\":\"CalendarWidget_selectedDay__3DZ39\",\"dayHeaderCell\":\"CalendarWidget_dayHeaderCell__1PCpY\",\"neighbourMonthCell\":\"CalendarWidget_neighbourMonthCell__xMeW8\",\"header\":\"CalendarWidget_header__cLQvZ\",\"title\":\"CalendarWidget_title__1esmL\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"inpuContainer\":\"SaveFilterDialog_inpuContainer__qLdzP\",\"row\":\"SaveFilterDialog_row__DZjpC\",\"label\":\"SaveFilterDialog_label__1ThB6\",\"textInput\":\"SaveFilterDialog_textInput__17mfL\",\"chcekBoxinput\":\"SaveFilterDialog_chcekBoxinput__EPpbx\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"MobileDateTimeEditor_root__3wsmI\",\"fullScreenEditorRoot\":\"MobileDateTimeEditor_fullScreenEditorRoot__3OAqz\",\"fullScreenEditorInput\":\"MobileDateTimeEditor_fullScreenEditorInput__1wnsk\",\"fullScreenEditorInfoRow\":\"MobileDateTimeEditor_fullScreenEditorInfoRow__1GRZ-\",\"fullScreenEditorInputContainer\":\"MobileDateTimeEditor_fullScreenEditorInputContainer__19qVY\",\"input\":\"MobileDateTimeEditor_input__-l2J6\",\"inputRow\":\"MobileDateTimeEditor_inputRow__285B1\",\"autoCompleteButton\":\"MobileDateTimeEditor_autoCompleteButton__3ZuoC\"};","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IApplication } from '../entities/types/IApplication';\r\n\r\nexport function getApplication(ctx?: any): IApplication {\r\n  let cn = ctx;\r\n  while (cn.parent) {\r\n    cn = cn.parent;\r\n  }\r\n  return cn;\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getApplication } from \"./getApplication\";\r\nimport { IApi } from \"../entities/types/IApi\";\r\n\r\nexport function getApi(ctx: any): IApi {\r\n  return getApplication(ctx).api;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport Oidc from \"oidc-client\";\r\n\r\nconst [windowLocation] = window.location.href.split(\"#\");\r\n\r\nconst config = {\r\n  authority: `${windowLocation}`,\r\n  client_id: \"origamWebClient\",\r\n  redirect_uri: `${windowLocation}#origamClientCallback/`,\r\n  response_type: \"code\",\r\n  scope: \"openid IdentityServerApi offline_access\",\r\n  post_logout_redirect_uri: `${windowLocation}`,\r\n  response_mode: \"query\",\r\n  automaticSilentRenew: true,\r\n  silent_redirect_uri: `${windowLocation}#origamClientCallbackRenew/`,\r\n};\r\n\r\nexport const userManager = new Oidc.UserManager(config);\r\n\r\nexport async function ensureLogin() {\r\n  const authOvr = sessionStorage.getItem(\"origamAuthTokenOverride\");\r\n  if (authOvr) {\r\n    sessionStorage.setItem(\"origamAuthTokenOverride\", authOvr);\r\n    return {access_token: authOvr};\r\n  }\r\n  if (window.location.hash.startsWith(\"#origamClientCallback/\")) {\r\n    const user = await userManager.signinRedirectCallback(\r\n      window.location.hash.replace(\"#origamClientCallback/\", \"\")\r\n    );\r\n    const [urlpart] = window.location.href.split(\"#\");\r\n    window.history.replaceState(null, \"\", urlpart);\r\n    return user;\r\n  } else {\r\n    const user = await userManager.getUser();\r\n    if (user) {\r\n      return user;\r\n    } else {\r\n      await userManager.signinRedirect();\r\n    }\r\n  }\r\n}\r\n\r\nexport async function logoff() {\r\n  await userManager.signoutRedirect();\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/MainBar/MainBar.module.scss\";\r\nimport cx from \"classnames\";\r\n\r\nexport const MainBar: React.FC<{}> = props => (\r\n  <div className={cx(S.root)}>\r\n    {props.children}\r\n  </div>\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/ScreenTabsArea/ScreenTabsArea.module.scss\";\r\n\r\nexport const ScreenTabsArea: React.FC = props => (\r\n  <div className={S.root}>{props.children}</div>\r\n);","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/Splitter/Splitter.module.scss\";\r\nimport { action, computed, observable, runInAction } from \"mobx\";\r\nimport { observer, Observer } from \"mobx-react\";\r\n\r\nimport Measure, { ContentRect } from \"react-measure\";\r\nimport _ from \"lodash\";\r\nimport cx from \"classnames\";\r\nimport { IPanelData } from \"gui/Components/Splitter/IPanelData\";\r\n\r\n@observer\r\nclass SplitterPanel extends React.Component<{\r\n  type: \"isHoriz\" | \"isVert\";\r\n  size: number;\r\n  className?: string;\r\n}> {\r\n  refPanel = (elm: any) => (this.elmPanel = elm);\r\n  elmPanel: HTMLDivElement | null = null;\r\n\r\n  componentDidMount() {\r\n  }\r\n\r\n  @computed get style() {\r\n    switch (this.props.type) {\r\n      case \"isHoriz\":\r\n        return {width: this.props.size};\r\n      case \"isVert\":\r\n        return {height: this.props.size};\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div\r\n        ref={this.refPanel}\r\n        className={cx(this.props.className || S.splitterPanel, this.props.type)}\r\n        style={this.style}\r\n      >\r\n        {this.props.children}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n@observer\r\nclass SplitterDivider extends React.Component<{\r\n  type: \"isHoriz\" | \"isVert\";\r\n  className?: string;\r\n  domRef: any;\r\n  isDragging: boolean;\r\n  relativeLoc: number;\r\n  onMouseDown?(event: any): void;\r\n}> {\r\n  @computed get style() {\r\n    if (!this.props.isDragging) return {};\r\n    switch (this.props.type) {\r\n      case \"isVert\":\r\n        return {top: this.props.relativeLoc};\r\n      case \"isHoriz\":\r\n        return {left: this.props.relativeLoc};\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div\r\n        ref={this.props.domRef}\r\n        onMouseDown={this.props.onMouseDown}\r\n        className={cx(\r\n          this.props.className || S.splitterDivider,\r\n          this.props.type,\r\n          {\r\n            isDragging: this.props.isDragging\r\n          }\r\n        )}\r\n        style={this.style}\r\n      >\r\n        <div className=\"dividerLine\"/>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n@observer\r\nexport class Splitter extends React.Component<{\r\n  type: \"isHoriz\" | \"isVert\";\r\n  sizeOverrideFirstPanel?: number;\r\n  id?: string;\r\n  panels: Array<IPanelData>;\r\n  onSizeChangeFinished?(\r\n    panelId1: any,\r\n    panelId2: any,\r\n    panel1Ratio: number,\r\n    panel2Ratio: number\r\n  ): void;\r\n  STYLE?: any;\r\n}> {\r\n  @observable containerWidth = 0;\r\n  @observable containerHeight = 0;\r\n  @observable isInitialized = false;\r\n  @observable sizeMap: Map<any, number> = new Map();\r\n  @observable dividerSizeMap: Map<any, number> = new Map();\r\n  @observable isResizing = false;\r\n  @observable mouseLocStart = 0;\r\n  @observable dividerRelativeLoc = 0;\r\n  draggingDividerId: any;\r\n\r\n  constructor(props: any) {\r\n    super(props);\r\n    runInAction(() => {\r\n      for (let i = 0; i < this.props.panels.length; i++) {\r\n        const panel = this.props.panels[i];\r\n        this.sizeMap.set(panel.id, panel.positionRatio);\r\n        if (i < this.props.panels.length - 1) {\r\n          this.dividerSizeMap.set(panel.id, 0);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  @action.bound\r\n  handleResize(contentRect: ContentRect) {\r\n    const {bounds} = contentRect;\r\n    if (bounds) {\r\n      this.announceContainerSize(bounds.width, bounds.height);\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  announceContainerSize(width: number, height: number) {\r\n    if (width > 0 && height > 0 && this.differentSizeRequested(width, height)) {\r\n      this.containerWidth = width;\r\n      this.containerHeight = height;\r\n      this.initSizes();\r\n      this.isInitialized = true;\r\n    }\r\n  }\r\n\r\n  differentSizeRequested(newWidth: number, newHeight: number) {\r\n    return Math.abs(newHeight - this.containerHeight) > 0.001 ||\r\n      Math.abs(newWidth - this.containerWidth) > 0.001\r\n  }\r\n\r\n  @action.bound initSizesImm() {\r\n    // TODO: Fix nested splitter initSize (first panel overridden by initial size by resizing its container)\r\n\r\n    //console.log(Array.from(this.dividerSizeMap.entries()));\r\n    const containerSize =\r\n      this.props.type === \"isVert\" ? this.containerHeight : this.containerWidth;\r\n    const dividerSizeSum = Array.from(this.dividerSizeMap.values()).reduce(\r\n      (a, b) => a + b,\r\n      0\r\n    );\r\n    if (this.props.sizeOverrideFirstPanel === undefined) {\r\n      //console.log(\"Divider size sum\", dividerSizeSum);\r\n      const sizeToDivide = containerSize - dividerSizeSum; // TODO: Include handle sizes?\r\n\r\n      const initSizeSum = Array.from(this.sizeMap.values()).reduce(\r\n        (a, b) => a + b,\r\n        0\r\n      );\r\n      const sizeRatio = sizeToDivide / initSizeSum;\r\n      for (let [key, value] of this.sizeMap.entries()) {\r\n        this.sizeMap.set(key, value * sizeRatio);\r\n        //console.log(\"Set\", key, value * sizeRatio);\r\n      }\r\n    } else if (this.props.panels.length > 0) {\r\n      const firstPanelSize = Math.max(this.props.sizeOverrideFirstPanel, 20);\r\n      const sizeToDivide = containerSize - dividerSizeSum - firstPanelSize;\r\n      const initSizeSum = this.props.panels\r\n        .slice(1)\r\n        .reduce((acc, panel) => acc + (this.sizeMap.get(panel.id) || 0), 0);\r\n      const sizeRatio = sizeToDivide / initSizeSum;\r\n\r\n      for (let [key, value] of this.sizeMap.entries()) {\r\n        if (key === this.props.panels[0].id) continue;\r\n        this.sizeMap.set(key, value * sizeRatio);\r\n      }\r\n      this.sizeMap.set(this.props.panels[0].id, firstPanelSize);\r\n    }\r\n  }\r\n\r\n  initSizes = _.debounce(this.initSizesImm, 10);\r\n\r\n  @action.bound handleDividerMouseDown(event: any, handleId: any) {\r\n    this.draggingDividerId = handleId;\r\n    this.isResizing = true;\r\n    this.dividerRelativeLoc = 0;\r\n    this.mouseLocStart =\r\n      this.props.type === \"isVert\" ? event.screenY : event.screenX;\r\n    window.addEventListener(\"mouseup\", this.handleWindowMouseUp);\r\n    window.addEventListener(\"mousemove\", this.handleWindowMouseMove);\r\n  }\r\n\r\n  @action.bound handleWindowMouseMove(event: any) {\r\n    event.preventDefault();\r\n    const dividerRelativeLoc =\r\n      (this.props.type === \"isVert\" ? event.screenY : event.screenX) -\r\n      this.mouseLocStart;\r\n    const [size1, size2] = this.computeNewSizes(dividerRelativeLoc);\r\n    if (size1 >= 20 && size2 >= 20) {\r\n      this.dividerRelativeLoc = dividerRelativeLoc;\r\n    }\r\n  }\r\n\r\n  get draggingIds() {\r\n    const id1 = this.draggingDividerId;\r\n    const id2 = this.props.panels[\r\n    this.props.panels.findIndex(\r\n      panel => panel.id === this.draggingDividerId\r\n    )! + 1\r\n      ].id;\r\n    return [id1, id2];\r\n  }\r\n\r\n  computeNewSizes(dividerRelativeLoc: number) {\r\n    const [id1, id2] = this.draggingIds;\r\n    return [\r\n      this.sizeMap.get(id1)! + dividerRelativeLoc,\r\n      this.sizeMap.get(id2)! - dividerRelativeLoc\r\n    ];\r\n  }\r\n\r\n  get newSizes() {\r\n    return this.computeNewSizes(this.dividerRelativeLoc);\r\n  }\r\n\r\n  @action.bound handleWindowMouseUp(event: any) {\r\n    this.isResizing = false;\r\n    window.removeEventListener(\"mouseup\", this.handleWindowMouseUp);\r\n    window.removeEventListener(\"mousemove\", this.handleWindowMouseMove);\r\n    const [id1, id2] = this.draggingIds;\r\n    const [size1, size2] = this.newSizes;\r\n    this.sizeMap.set(id1, size1);\r\n    this.sizeMap.set(id2, size2);\r\n    if (this.props.onSizeChangeFinished) {\r\n      if (this.props.type === \"isHoriz\") {\r\n        this.props.onSizeChangeFinished(id1, id2, size1 / this.containerWidth, size2);\r\n      } else {\r\n        this.props.onSizeChangeFinished(id1, id2, size1 / this.containerHeight, size2);\r\n      }\r\n    }\r\n  }\r\n\r\n  @action.bound handleDividerResize(contentRect: ContentRect, dividerId: any) {\r\n    //console.log(\"Divider resize\", contentRect.bounds, dividerId);\r\n    if (contentRect.bounds) {\r\n      const value = this.props.type === \"isVert\"\r\n        ? contentRect.bounds.height\r\n        : contentRect.bounds.width\r\n      if (this.dividerSizeMap.get(dividerId) !== value) {\r\n        this.dividerSizeMap.set(dividerId, value);\r\n        this.initSizes();\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const content: React.ReactNode[] = [];\r\n    for (let i = 0; i < this.props.panels.length; i++) {\r\n      const panel = this.props.panels[i];\r\n      content.push(\r\n        <SplitterPanel\r\n          className={(this.props.STYLE || S).panel}\r\n          type={this.props.type}\r\n          size={this.sizeMap.get(panel.id)!}\r\n          key={`S${panel.id}`}\r\n        >\r\n          {panel.element}\r\n        </SplitterPanel>\r\n      );\r\n      if (i < this.props.panels.length - 1) {\r\n        content.push(\r\n          <Measure\r\n            key={i} // Assuming panel structure will not change.\r\n            bounds={true}\r\n            onResize={contentRect =>\r\n              this.handleDividerResize(contentRect, panel.id)\r\n            }\r\n          >\r\n            {({measureRef}) => (\r\n              <Observer>\r\n                {() => (\r\n                  <SplitterDivider\r\n                    className={(this.props.STYLE || S).divider}\r\n                    domRef={measureRef}\r\n                    key={`D${panel.id}`}\r\n                    isDragging={\r\n                      this.isResizing && this.draggingDividerId === panel.id\r\n                    }\r\n                    relativeLoc={this.dividerRelativeLoc}\r\n                    type={this.props.type}\r\n                    onMouseDown={event =>\r\n                      this.handleDividerMouseDown(event, panel.id)\r\n                    }\r\n                  />\r\n                )}\r\n              </Observer>\r\n            )}\r\n          </Measure>\r\n        );\r\n      }\r\n    }\r\n    return (\r\n      <Measure bounds={true} onResize={this.handleResize}>\r\n        {({measureRef}) => (\r\n          <Observer>\r\n            {() => (\r\n              <div\r\n                ref={measureRef}\r\n                className={cx((this.props.STYLE || S).root, this.props.type)}\r\n              >\r\n                {this.isInitialized && content}\r\n              </div>\r\n            )}\r\n          </Observer>\r\n        )}\r\n      </Measure>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport SSplitter from \"gui/Workbench/ScreenArea/CustomSplitter.module.scss\";\r\nimport { Splitter } from \"gui/Components/Splitter/Splitter\";\r\n\r\nexport const WorkbenchPage: React.FC<{\r\n  sidebar: React.ReactNode;\r\n  mainbar: React.ReactNode;\r\n}> = props => (\r\n    <Splitter\r\n      type=\"isHoriz\"\r\n      STYLE={SSplitter}\r\n      panels={[\r\n        {\r\n          id: \"sidebar\",\r\n          positionRatio: 1,\r\n          element: props.sidebar,\r\n        },\r\n        {\r\n          id: \"mainbar\",\r\n          positionRatio: 5,\r\n          element: props.mainbar,\r\n        }\r\n      ]}\r\n    />\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IWorkbench } from \"../entities/types/IWorkbench\";\r\nimport { getApplication } from \"./getApplication\";\r\n\r\nexport function getWorkbench(ctx: any): IWorkbench {\r\n  const workbench = getApplication(ctx).workbench;\r\n  if (!workbench) {\r\n    throw new Error(\"No workbench in Application.\");\r\n  }\r\n  return workbench;\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/TabbedView/TabbedViewHandle.module.scss\";\r\nimport cx from \"classnames\";\r\nimport { Icon } from \"@origam/components\";\r\n\r\nexport class TabbedViewHandle extends React.Component<{\r\n  title?: string;\r\n  id?: string;\r\n  isActive?: boolean;\r\n  hasCloseBtn?: boolean;\r\n  isDirty?: boolean;\r\n  onClick?(event: any): void;\r\n  onCloseClick?(event: any): void;\r\n  onCloseMouseDown?(event: any): void;\r\n}> {\r\n  render() {\r\n    return (\r\n      <div\r\n        onClick={this.props.onClick}\r\n        className={cx(S.root, {isActive: this.props.isActive, isDirty: this.props.isDirty})}\r\n        title={this.props.title}\r\n        id={this.props.id}\r\n      >\r\n        <div className={S.label}>{this.props.children}</div>\r\n        {this.props.hasCloseBtn && (\r\n          <a\r\n            className={S.closeBtn}\r\n            onClick={this.props.onCloseClick}\r\n            onMouseDown={this.props.onCloseMouseDown}\r\n          >\r\n            <Icon src=\"./icons/close.svg\" tooltip={\"\"}/>\r\n          </a>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/TabbedView/TabbedViewHandleRow.module.scss\";\r\n\r\nexport class TabbedViewHandleRow extends React.Component {\r\n  render() {\r\n    return <div className={S.root}>{this.props.children}</div>;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbench } from \"./getWorkbench\";\r\n\r\nexport function getWorkbenchLifecycle(ctx: any) {\r\n  return getWorkbench(ctx).workbenchLifecycle;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IOpenedScreen, isIOpenedScreen } from \"../entities/types/IOpenedScreen\";\r\n\r\nexport function getOpenedScreen(ctx: any): IOpenedScreen {\r\n  let cn = ctx;\r\n  while (true) {\r\n    if (isIOpenedScreen(cn)) return cn;\r\n    if (!cn) return undefined as any;\r\n    cn = cn.parent;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IFormScreenEnvelope } from \"./IFormScreen\";\r\nimport { IMainMenuItemType } from \"./IMainMenu\";\r\nimport { EventHandler } from \"utils/EventHandler\";\r\n\r\nexport interface IDialogInfo {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\n\r\nexport interface IOpenedScreenData {\r\n  menuItemId: string;\r\n  menuItemType: IMainMenuItemType;\r\n  lazyLoading: boolean;\r\n  dialogInfo?: IDialogInfo;\r\n  order: number;\r\n  tabTitle: string;\r\n  content: IFormScreenEnvelope;\r\n  parameters: { [key: string]: any };\r\n  isSleeping?: boolean;\r\n  isSleepingDirty?: boolean;\r\n}\r\n\r\nexport interface IOpenedScreen extends IOpenedScreenData {\r\n  parentContext: IOpenedScreen | undefined;\r\n  $type_IOpenedScreen: 1;\r\n\r\n  isActive: boolean;\r\n  isDialog: boolean;\r\n  isClosed: boolean;\r\n  stackPosition: number;\r\n  isBeingClosed: boolean;\r\n  formTitle: string;\r\n\r\n  setActive(state: boolean): void;\r\n  activationHandler: EventHandler;\r\n\r\n  setContent(screen: IFormScreenEnvelope): void;\r\n\r\n  screenUrl?: string;\r\n  parent?: any;\r\n  hasDynamicTitle: boolean;\r\n}\r\n\r\nexport const isIOpenedScreen = (o: any): o is IOpenedScreen =>\r\n  o?.$type_IOpenedScreen;\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IFormScreen, isIFormScreen } from \"model/entities/types/IFormScreen\";\r\n\r\nexport function getFormScreen(ctx: any): IFormScreen {\r\n  let cn = ctx;\r\n  while (true) {\r\n    if (isIFormScreen(cn)) {\r\n      return cn;\r\n    }\r\n    cn = cn.parent;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDataView } from \"./IDataView\";\r\nimport { IDataSource } from \"./IDataSource\";\r\nimport { IComponentBinding } from \"./IComponentBinding\";\r\nimport { IFormScreenLifecycle02 } from \"./IFormScreenLifecycle\";\r\nimport { IAction } from \"./IAction\";\r\nimport { IRefreshOnReturnType } from \"../WorkbenchLifecycle/WorkbenchLifecycle\";\r\nimport { IPanelConfiguration } from \"./IPanelConfiguration\";\r\nimport { CriticalSection } from \"utils/sync\";\r\nimport { ScreenPictureCache } from \"../ScreenPictureCache\";\r\nimport { DataViewCache } from \"../DataViewCache\";\r\n\r\n/*\r\nexport interface ILoadedFormScreenData {\r\n  title: string;\r\n  menuId: string;\r\n  openingOrder: number;\r\n  showInfoPanel: boolean;\r\n  autoRefreshInterval: number;\r\n  cacheOnClient: boolean;\r\n  autoSaveOnListRecordChange: boolean;\r\n  requestSaveAfterUpdate: boolean;\r\n  dataViews: IDataView[];\r\n  dataSources: IDataSource[];\r\n  componentBindings: IComponentBinding[];\r\n  screenUI: any;\r\n  formScreenLifecycle: IFormScreenLifecycle;\r\n  sessionId: string;\r\n}\r\n\r\nexport interface ILoadedFormScreen extends ILoadedFormScreenData {\r\n  $type_ILoadedFormScreen: 1;\r\n\r\n  isDirty: boolean;\r\n\r\n  isLoading: false;\r\n  rootDataViews: IDataView[];\r\n  dontRequestData: boolean;\r\n\r\n  getBindingsByChildId(childId: string): IComponentBinding[];\r\n  getBindingsByParentId(parentId: string): IComponentBinding[];\r\n  getDataViewByModelInstanceId(modelInstanceId: string): IDataView | undefined;\r\n  getDataViewsByEntity(entity: string): IDataView[];\r\n  getDataSourceByEntity(entity: string): IDataSource | undefined;\r\n\r\n  toolbarActions: Array<{ section: string; actions: IAction[] }>;\r\n  dialogActions: IAction[];\r\n\r\n  setDirty(state: boolean): void;\r\n\r\n  printMasterDetailTree(): void;\r\n\r\n  parent?: any;\r\n}\r\n\r\nexport interface ILoadingFormScreenData {\r\n  formScreenLifecycle: IFormScreenLifecycle;\r\n}\r\n\r\nexport interface ILoadingFormScreen extends ILoadingFormScreenData {\r\n  $type_ILoadingFormScreen: 1;\r\n\r\n  isLoading: true;\r\n  parent?: any;\r\n\r\n  start(): void;\r\n}\r\n\r\nexport type IFormScreen = ILoadingFormScreen | ILoadedFormScreen;\r\n\r\nexport const isILoadingFormScreen = (o: any): o is ILoadingFormScreen =>\r\n  o.$type_ILoadingFormScreen;\r\nexport const isILoadedFormScreen = (o: any): o is ILoadedFormScreen =>\r\n  o.$type_ILoadedFormScreen; */\r\n\r\nexport interface IFormScreenEnvelopeData {\r\n  formScreenLifecycle: IFormScreenLifecycle02;\r\n  preloadedSessionId?: string;\r\n  refreshOnReturnType?: IRefreshOnReturnType;\r\n}\r\n\r\nexport interface IFormScreenEnvelope extends IFormScreenEnvelopeData {\r\n  $type_IFormScreenEnvelope: 1;\r\n\r\n  isLoading: boolean;\r\n  formScreen?: IFormScreen;\r\n\r\n  setFormScreen(formScreen?: IFormScreen): void;\r\n\r\n  start(initUIResult: any, preloadIsDirty?: boolean): Generator;\r\n\r\n  parent?: any;\r\n}\r\n\r\nexport interface IFormScreenData {\r\n  title: string;\r\n  menuId: string;\r\n  dynamicTitleSource: string | undefined;\r\n  openingOrder: number;\r\n  autoWorkflowNext: boolean;\r\n  showInfoPanel: boolean;\r\n  showWorkflowCancelButton: boolean;\r\n  showWorkflowNextButton: boolean;\r\n  autoRefreshInterval: number;\r\n  refreshOnFocus: boolean;\r\n  cacheOnClient: boolean;\r\n  suppressSave: boolean;\r\n  suppressRefresh: boolean;\r\n  autoSaveOnListRecordChange: boolean;\r\n  requestSaveAfterUpdate: boolean;\r\n  dataViews: IDataView[];\r\n  dataSources: IDataSource[];\r\n  componentBindings: IComponentBinding[];\r\n  screenUI: any;\r\n  panelConfigurations: Map<string, IPanelConfiguration>;\r\n  formScreenLifecycle: IFormScreenLifecycle02;\r\n  sessionId: string;\r\n  workflowTaskId: string | null;\r\n  uiRootType: string;\r\n}\r\n\r\nexport interface IFormScreen extends IFormScreenData {\r\n  $type_IFormScreen: 1;\r\n\r\n  isDirty: boolean;\r\n\r\n  isLoading: false;\r\n  rootDataViews: IDataView[];\r\n  nonRootDataViews: IDataView[];\r\n  isLazyLoading: boolean;\r\n  toolbarActions: Array<{ section: string; actions: IAction[] }>;\r\n  dialogActions: IAction[];\r\n  dynamicTitle: string | undefined;\r\n\r\n  dataUpdateCRS: CriticalSection;\r\n\r\n  pictureCache: ScreenPictureCache;\r\n  dataViewCache: DataViewCache;\r\n\r\n  clearDataCache(): void;\r\n\r\n  getPanelPosition(id: string): number | undefined;\r\n\r\n  getData(childEntity: string, modelInstanceId: string, parentRecordId: string, rootRecordId: string): Promise<any>;\r\n\r\n  getBindingsByChildId(childId: string): IComponentBinding[];\r\n\r\n  getBindingsByParentId(parentId: string): IComponentBinding[];\r\n\r\n  getDataViewByModelInstanceId(modelInstanceId: string): IDataView | undefined;\r\n\r\n  getDataViewsByEntity(entity: string): IDataView[];\r\n\r\n  getDataSourceByEntity(entity: string): IDataSource | undefined;\r\n\r\n  getFirstFormPropertyId(): string | undefined;\r\n\r\n  setPanelSize(id: string, size: number): void;\r\n\r\n  setDirty(state: boolean): void;\r\n\r\n  setTitle(title: string): void;\r\n\r\n  printMasterDetailTree(): void;\r\n\r\n  parent?: any;\r\n}\r\n\r\nexport const isIFormScreenEnvelope = (o: any): o is IFormScreenEnvelope =>\r\n  o.$type_IFormScreenEnvelope;\r\n\r\nexport const isIFormScreen = (o: any): o is IFormScreen => o.$type_IFormScreen;\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFormScreen } from './getFormScreen';\r\n\r\nexport function getFormScreenLifecycle(ctx: any) {\r\n  return getFormScreen(ctx).formScreenLifecycle;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\n\r\nexport function reloadScreen(ctx: any) {\r\n  return function*reloadScreen() {\r\n    yield*getFormScreenLifecycle(ctx).refreshSession();\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IPanelViewType } from \"./IPanelViewType\";\r\nimport { IProperty } from \"./IProperty\";\r\nimport { IDataSource } from \"./IDataSource\";\r\nimport { IDataTable } from \"./IDataTable\";\r\nimport { IComponentBinding } from \"./IComponentBinding\";\r\nimport { IDataViewLifecycle } from \"../DataViewLifecycle/types/IDataViewLifecycle\";\r\nimport { ITablePanelView } from \"../TablePanelView/types/ITablePanelView\";\r\nimport { IFormPanelView } from \"../FormPanelView/types/IFormPanelView\";\r\nimport { IAction } from \"./IAction\";\r\nimport { ILookupLoader } from \"./ILookupLoader\";\r\nimport { ServerSideGrouper } from \"../ServerSideGrouper\";\r\nimport { ClientSideGrouper } from \"../ClientSideGrouper\";\r\nimport { IGridDimensions, IScrollState } from \"../../../gui/Components/ScreenElements/Table/types\";\r\nimport { ITableRow } from \"../../../gui/Components/ScreenElements/Table/TableRendering/types\";\r\nimport { BoundingRect } from \"react-measure\";\r\nimport { FormFocusManager } from \"../FormFocusManager\";\r\nimport { DataViewData } from \"../../../modules/DataView/DataViewData\";\r\nimport { DataViewAPI } from \"../../../modules/DataView/DataViewAPI\";\r\nimport { RowCursor } from \"../../../modules/DataView/TableCursor\";\r\nimport { IInfiniteScrollLoader } from \"gui/Workbench/ScreenArea/TableView/InfiniteScrollLoader\";\r\nimport { IAggregation } from \"./IAggregation\";\r\nimport { GridFocusManager } from \"../GridFocusManager\";\r\n\r\nexport interface IDataViewData {\r\n  id: string;\r\n  modelInstanceId: string;\r\n  name: string;\r\n  modelId: string;\r\n  defaultPanelView: IPanelViewType;\r\n  isHeadless: boolean;\r\n  isMapSupported: boolean;\r\n  disableActionButtons: boolean;\r\n  showAddButton: boolean;\r\n  showDeleteButton: boolean;\r\n  showSelectionCheckboxesSetting: boolean;\r\n  type: string;\r\n  attributes: any;\r\n\r\n  isGridHeightDynamic: boolean;\r\n  selectionMember: string;\r\n  orderMember: string;\r\n  isDraggingEnabled: boolean;\r\n  entity: string;\r\n  dataMember: string;\r\n  isRootGrid: boolean;\r\n  isRootEntity: boolean;\r\n  isPreloaded: boolean;\r\n  requestDataAfterSelectionChange: boolean;\r\n  confirmSelectionChange: boolean;\r\n  properties: IProperty[];\r\n  actions: IAction[];\r\n  dataTable: IDataTable;\r\n  formViewUI: any;\r\n  activePanelView: IPanelViewType;\r\n  tablePanelView: ITablePanelView;\r\n  formPanelView: IFormPanelView;\r\n  lifecycle: IDataViewLifecycle;\r\n  lookupLoader: ILookupLoader;\r\n  serverSideGrouper: ServerSideGrouper;\r\n  clientSideGrouper: ClientSideGrouper;\r\n  isFirst: boolean;\r\n  newRecordView: string | undefined;\r\n\r\n  dataViewRowCursor: RowCursor;\r\n  dataViewApi: DataViewAPI;\r\n  dataViewData: DataViewData;\r\n}\r\n\r\nexport interface IDataView extends IDataViewData {\r\n  $type_IDataView: 1;\r\n\r\n  orderProperty: IProperty | undefined;\r\n  isBindingRoot: boolean;\r\n  isBindingParent: boolean;\r\n  isAnyBindingAncestorWorking: boolean;\r\n  isWorking: boolean;\r\n  parentBindings: IComponentBinding[];\r\n  childBindings: IComponentBinding[];\r\n  bindingRoot: IDataView;\r\n  bindingParent: IDataView | undefined;\r\n  isValidRowSelection: boolean;\r\n  selectedRowId: string | undefined;\r\n  selectedRowIndex: number | undefined;\r\n  trueSelectedRowIndex: number | undefined;\r\n  totalRowCount: number | undefined;\r\n  selectedRow: any[] | undefined;\r\n  dataSource: IDataSource;\r\n  bindingParametersFromParent: { [key: string]: string };\r\n  showSelectionCheckboxes: boolean;\r\n  panelViewActions: IAction[];\r\n  panelMenuActions: IAction[];\r\n  toolbarActions: IAction[];\r\n  dialogActions: IAction[];\r\n  formFocusManager: FormFocusManager;\r\n  gridFocusManager: GridFocusManager;\r\n  firstEnabledDefaultAction: IAction | undefined;\r\n  defaultActions: IAction[];\r\n  aggregationData: IAggregation[];\r\n\r\n  isSelected(id: string): boolean;\r\n\r\n  hasSelectedRowId(id: string): boolean;\r\n\r\n  selectedRowIds: Set<string>;\r\n\r\n  addSelectedRowId(id: string): void;\r\n\r\n  removeSelectedRowId(id: string): void;\r\n\r\n  setSelectedState(rowId: string, newState: boolean): void;\r\n\r\n  selectNextRow(): void;\r\n\r\n  selectPrevRow(): void;\r\n\r\n  onFieldChange(event: any, row: any[], property: IProperty, value: any): void;\r\n\r\n  loadFirstPage(): Generator;\r\n\r\n  loadLastPage(): Generator;\r\n\r\n  selectFirstRow(): void;\r\n\r\n  selectLastRow(): void;\r\n\r\n  reselectOrSelectFirst(): void;\r\n\r\n  selectRow(row: any[]): void;\r\n\r\n  setSelectedRowId(id: string | undefined): void;\r\n\r\n  setRecords(rows: any[][]): Promise<any>;\r\n\r\n  appendRecords(rows: any[][]): void;\r\n\r\n  substituteRecord(row: any[]): void;\r\n\r\n  deleteRowAndSelectNext(row: any[]): void;\r\n\r\n  clear(): void;\r\n\r\n  navigateLookupLink(property: IProperty, row: any[]): Generator<any>;\r\n\r\n  saveViewState(): void;\r\n\r\n  restoreViewState(): void;\r\n\r\n  start(): void;\r\n\r\n  stop(): void;\r\n\r\n  scrollState: IScrollState;\r\n  tableRows: ITableRow[];\r\n\r\n  onReload(): void;\r\n\r\n  gridDimensions: IGridDimensions;\r\n  contentBounds: BoundingRect | undefined;\r\n  infiniteScrollLoader: IInfiniteScrollLoader | undefined;\r\n\r\n  parent?: any;\r\n\r\n  moveSelectedRowUp(): void;\r\n\r\n  moveSelectedRowDown(): void;\r\n\r\n  setRowCount(rowCount: number | undefined): void;\r\n\r\n  isTableViewActive: () => boolean;\r\n  isFormViewActive: () => boolean;\r\n  activateFormView: ((args?: { saveNewState: boolean }) => Promise<any>) | undefined;\r\n  activateTableView: (() => Promise<any>) | undefined;\r\n\r\n  initializeNewScrollLoader(): void;\r\n\r\n  exportToExcel(): void;\r\n\r\n  isLazyLoading: Boolean;\r\n}\r\n\r\nexport const isIDataView = (o: any): o is IDataView => o?.$type_IDataView;\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDataView, isIDataView } from \"../../entities/types/IDataView\";\r\n\r\nexport function getDataView(ctx: any): IDataView {\r\n  let cn = ctx;\r\n  while (true) {\r\n    if (isIDataView(cn)) {\r\n      return cn;\r\n    }\r\n    if (!cn) return undefined as any;\r\n    cn = cn?.parent;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\n\r\nexport default {\r\n  getIsSelectedRowId(ctx: any, id: string) {\r\n    return getDataView(ctx).hasSelectedRowId(id);\r\n  },\r\n  getSelectedRowIds(ctx: any) {\r\n    return getDataView(ctx).selectedRowIds;\r\n  },\r\n};\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { ICaptionPosition } from \"./ICaptionPosition\";\r\nimport { IPropertyColumn } from \"./IPropertyColumn\";\r\nimport { ILookup } from \"./ILookup\";\r\nimport { ILookupIndividualEngine } from \"../Property\";\r\n\r\nexport enum IDockType {\r\n  Dock = \"Dock\",\r\n  Fill = \"Fill\",\r\n}\r\n\r\nexport interface IPropertyData {\r\n  id: string;\r\n  tabIndex: string | undefined;\r\n  modelInstanceId: string;\r\n  name: string;\r\n  readOnly: boolean;\r\n  x: number;\r\n  y: number;\r\n  width: number;\r\n  height: number;\r\n  captionLength: number;\r\n  captionPosition?: ICaptionPosition;\r\n  entity: string;\r\n  column: IPropertyColumn;\r\n  dock?: IDockType;\r\n  multiline: boolean;\r\n  isPassword: boolean;\r\n  isRichText: boolean;\r\n  maxLength: number;\r\n  gridColumnWidth: number;\r\n  columnWidth: number;\r\n  formatterPattern: string;\r\n  modelFormatterPattern: string;\r\n  customNumericFormat?: string;\r\n  isAggregatedColumn: boolean;\r\n  isLookupColumn: boolean;\r\n  autoSort: boolean;\r\n  toolTip: string;\r\n  suppressEmptyColumns: boolean;\r\n  supportsServerSideSorting: boolean;\r\n\r\n  controlPropertyValue?: string;\r\n  controlPropertyId?: string;\r\n  parameters?: any;\r\n  allowReturnToForm?: boolean;\r\n  isTree?: boolean;\r\n  style: any;\r\n  identifier?: string;\r\n  lookup?: ILookup;\r\n  lookupId?: string;\r\n  xmlNode: any;\r\n  fieldType: string;\r\n}\r\n\r\nexport interface IProperty extends IPropertyData {\r\n  $type_IProperty: 1;\r\n\r\n  dataSourceIndex: number;\r\n  dataIndex: number;\r\n  isLookup: boolean;\r\n  lookupEngine?: ILookupIndividualEngine;\r\n\r\n  childProperties: IProperty[];\r\n  linkToMenuId?: string;\r\n  linkDependsOnValue: boolean;\r\n  isLink: boolean;\r\n  nameOverride: string | null | undefined;\r\n  isFormField: boolean;\r\n\r\n\r\n  getPolymophicProperty(row: any[]): IProperty;\r\n\r\n  setColumnWidth(width: number): void;\r\n\r\n  stop(): void;\r\n\r\n  parent?: any;\r\n}\r\n\r\nexport const isIProperty = (o: any): o is IProperty => o.$type_IProperty;\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IProperty, isIProperty } from \"../../entities/types/IProperty\";\r\n\r\nexport function getProperty(ctx: any): IProperty {\r\n  let cn = ctx;\r\n  while (true) {\r\n    if (isIProperty(cn)) {\r\n      return cn;\r\n    }\r\n    cn = cn.parent;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbench } from \"../getWorkbench\";\r\n\r\nexport function getMainMenuEnvelope(ctx: any) {\r\n  return getWorkbench(ctx).mainMenuEnvelope;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IMainMenu } from \"../../entities/types/IMainMenu\";\r\nimport { getMainMenuEnvelope } from \"./getMainMenuEnvelope\";\r\n\r\nexport function getMainMenu(ctx: any): IMainMenu | undefined {\r\n  return getMainMenuEnvelope(ctx).mainMenu;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getMainMenu } from \"model/selectors/MainMenu/getMainMenu\"\r\n\r\nexport default {\r\n  getItemById(ctx: any, id: string) {\r\n    // TODO: What if MainMenu is not yet loaded?\r\n    return getMainMenu(ctx)!.getItemById(id);\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getApi } from \"model/selectors/getApi\";\r\n\r\nfunction getCookie(name: string): string {\r\n  const value = \"; \" + document.cookie;\r\n  const parts = value.split(\"; \" + name + \"=\");\r\n\r\n  if (parts.length === 2) {\r\n    const cookieValue = parts.pop()!.split(\";\").shift();\r\n    return cookieValue ? cookieValue : \"\";\r\n  }\r\n  return \"\";\r\n}\r\n\r\nlet _locale: any;\r\n\r\nexport function getLocaleFromCookie(): string {\r\n  if (!_locale) {\r\n    const cookieValue = decodeURIComponent(getCookie(\"origamCurrentLocale\"));\r\n    const pattern = /c=([a-zA-Z-]+)\\|/i;\r\n    const results = cookieValue.match(pattern);\r\n    if (results) {\r\n      _locale = results[1];\r\n    } else {\r\n      throw new Error(\"Locale cookie was not found. Was the function \\\"initLocaleCookie\\\" called?\");\r\n    }\r\n  }\r\n  return _locale;\r\n}\r\n\r\nexport interface IDefaultDateFormats {\r\n  defaultDateSeparator: string;\r\n  defaultTimeSeparator: string;\r\n  defaultDateTimeSeparator: string;\r\n  defaultDateSequence: DateSequence;\r\n  defaultLongDateFormat: string;\r\n  defaultShortDateFormat: string;\r\n  defaultTimeFormat: string;\r\n}\r\n\r\nexport enum DateSequence {\r\n  DayMonthYear = 0, MonthDayYear = 1\r\n}\r\n\r\nexport function parseDateSequence(candidate: string) {\r\n  switch (candidate) {\r\n    case \"DayMonthYear\":\r\n      return DateSequence.DayMonthYear;\r\n    case \"MonthDayYear\":\r\n      return DateSequence.MonthDayYear;\r\n    default:\r\n      throw new Error(\"Cannot parse \\\"\" + candidate + \"\\\" to DateSequence\")\r\n  }\r\n}\r\n\r\nlet _defaultDateFormats: IDefaultDateFormats | undefined;\r\n\r\nexport function getDefaultCsDateFormatDataFromCookie(): IDefaultDateFormats {\r\n  if (!_defaultDateFormats) {\r\n    const cookieValue = decodeURIComponent(getCookie(\"origamCurrentLocale\"));\r\n    try {\r\n      const parameters = getCookieParameters(cookieValue);\r\n\r\n      _defaultDateFormats = {\r\n        defaultDateSeparator: getParameter(\"defaultDateSeparator\", parameters),\r\n        defaultTimeSeparator: getParameter(\"defaultTimeSeparator\", parameters),\r\n        defaultDateTimeSeparator: getParameter(\"defaultDateTimeSeparator\", parameters),\r\n        defaultDateSequence: parseDateSequence(getParameter(\"defaultDateSequence\", parameters)),\r\n        defaultLongDateFormat: getParameter(\"defaultLongDateFormat\", parameters),\r\n        defaultShortDateFormat: getParameter(\"defaultShortDateFormat\", parameters),\r\n        defaultTimeFormat: getParameter(\"defaultTimeFormat\", parameters),\r\n      }\r\n    } catch (error) {\r\n      throw new Error(\"Could not parse locale cookie value \\\"\" + cookieValue + \"\\\". \" + error);\r\n    }\r\n  }\r\n  return _defaultDateFormats;\r\n}\r\n\r\nfunction getCookieParameters(cookieValue: string) {\r\n  return cookieValue\r\n    .split(\"|\")\r\n    .map(pair => pair.split(\"=\"))\r\n    .reduce(function (map: { [key: string]: string }, pair) {\r\n      map[pair[0]] = pair[1];\r\n      return map;\r\n    }, {});\r\n}\r\n\r\nfunction isValidLocalizationCookie(cookieValue: string) {\r\n  if (!cookieValue) {\r\n    return false;\r\n  }\r\n  try {\r\n    getDefaultCsDateFormatDataFromCookie();\r\n    return true;\r\n  } catch (e) {\r\n    console.warn(\"Error when parsing localization cookie:\" + e); // eslint-disable-line no-console\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction getParameter(name: string, parameters: { [key: string]: string }) {\r\n  let value = parameters[name];\r\n  if (value === undefined || value === null) {\r\n    throw new Error(\"Parameter named \\\"\" + name + \"\\\" was not found\");\r\n  }\r\n  return value;\r\n}\r\n\r\nexport async function initLocaleCookie(ctx: any) {\r\n  const cookieValue = decodeURIComponent(getCookie(\"origamCurrentLocale\"));\r\n  if (isValidLocalizationCookie(cookieValue)) {\r\n    return;\r\n  }\r\n  const api = getApi(ctx);\r\n  document.cookie = \"origamCurrentLocale=\" + await api.defaultLocalizationCookie();\r\n\r\n  const newCookieValue = decodeURIComponent(getCookie(\"origamCurrentLocale\"));\r\n  if (!isValidLocalizationCookie(newCookieValue)) {\r\n    throw new Error(\"Could not parse localization cookie: \\\"\" + newCookieValue + \"\\\"\");\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport selectionCheckboxes from \"./selectionCheckboxes\";\r\nimport column from \"./column\";\r\nimport mainMenu from \"./mainMenu\";\r\nimport error from \"./error\";\r\n\r\nexport default {\r\n  selectionCheckboxes,\r\n  column,\r\n  mainMenu,\r\n  error\r\n};\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getProperty } from \"model/selectors/DataView/getProperty\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\n\r\nexport default {\r\n  isLinkToForm(ctx: any) {\r\n    return getProperty(ctx).isLink;\r\n  },\r\n\r\n  async getLinkMenuId(ctx: any, value: any) {\r\n    const property = getProperty(ctx);\r\n    if (property.linkDependsOnValue) {\r\n      const api = getApi(ctx);\r\n      return await api.getMenuId({\r\n        LookupId: property.lookupId!,\r\n        ReferenceId: value\r\n      });\r\n    }\r\n    return property.linkToMenuId;\r\n  }\r\n};\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IErrorDialogController } from \"model/entities/types/IErrorDialog\";\r\nimport { getApplication } from \"model/selectors/getApplication\";\r\n\r\nexport default {\r\n  getDialogController(ctx: any): IErrorDialogController {\r\n    return getApplication(ctx).errorDialogController;\r\n  }\r\n};\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbench } from \"../getWorkbench\";\r\n\r\nexport function getWorkQueues(ctx: any) {\r\n  return getWorkbench(ctx).workQueues;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkQueues } from \"model/selectors/WorkQueues/getWorkQueues\"\r\n\r\nexport function stopWorkQueues(ctx: any) {\r\n  return function*stopWorkQueues() {\r\n    yield*(getWorkQueues(ctx)!.stopTimer());\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IApplicationLifecycle } from \"../entities/types/IApplicationLifecycle\";\r\nimport { getApplication } from \"./getApplication\";\r\n\r\nexport function getApplicationLifecycle(ctx: any): IApplicationLifecycle {\r\n  return getApplication(ctx).applicationLifecycle;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getApplicationLifecycle } from \"model/selectors/getApplicationLifecycle\"\r\n\r\nexport function performLogout(ctx: any) {\r\n  return function*performLogout() {\r\n    yield*getApplicationLifecycle(ctx).performLogout();\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport axios from \"axios\";\r\nimport { getLocaleFromCookie } from \"./cookies\";\r\n\r\nconst debugShowTranslations = window.localStorage.getItem(\"debugShowTranslations\") === \"true\";\r\n\r\nlet translations = {} as { [k: string]: string };\r\n\r\nexport async function translationsInit(ctx: any) {\r\n  const locale = getLocaleFromCookie();\r\n  try {\r\n    const result = await axios.get(`locale/localization_${locale}.json`, {});\r\n    translations = result.data\r\n  } catch (error) {\r\n    if (error.response.status === 404) {\r\n      const localeParent = locale.split(\"-\")[0]\r\n      axios.get(`locale/localization_${localeParent}.json`, {})\r\n        .then(result => translations = result.data)\r\n        .catch(error2 => console.error(error2)) /* eslint-disable-line no-console */\r\n    }\r\n    console.error(error) /* eslint-disable-line no-console */\r\n  }\r\n}\r\n\r\nexport function T(defaultContent: any, translKey: string, ...p: any[]) {\r\n  let result;\r\n  let showingDefault = false;\r\n  if (translations.hasOwnProperty(translKey)) {\r\n    result = translations[translKey];\r\n  } else {\r\n    result = defaultContent;\r\n    showingDefault = true;\r\n  }\r\n  for (let i = 0; i < p.length; i++) {\r\n    result = result.replace(`{${i}}`, p[i]);\r\n  }\r\n  if (debugShowTranslations) {\r\n    if (showingDefault) {\r\n      console.error(`Could not find translation for: \"${translKey}\", showing default: \"${result}\"`); // eslint-disable-line no-console\r\n      return (\r\n        <span title={translKey} style={{backgroundColor: \"red\"}}>\r\n          {result}\r\n        </span>\r\n      );\r\n    } else {\r\n      return (\r\n        <span title={translKey} style={{backgroundColor: \"green\"}}>\r\n          {result}\r\n        </span>\r\n      );\r\n    }\r\n  } else {\r\n    return result;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport selectors from \"model/selectors-tree\";\r\nimport { stopWorkQueues } from \"./WorkQueues/stopWorkQueues\";\r\nimport { performLogout } from \"./User/performLogout\";\r\nimport { T } from \"utils/translation\";\r\nimport { flow } from \"mobx\";\r\n\r\nconst HANDLED = Symbol(\"_$ErrorHandled\");\r\n\r\nexport function handleError(ctx: any) {\r\n  return function*handleError(error: any) {\r\n    if (error.response && error.response.status === 474) {\r\n      // 747 ~ ServerObjectDisposed happens when the user closes a form before all pending requests have\r\n      // finished (RowStates for example)\r\n      return;\r\n    }\r\n    if (error.response && error.response.status === 401) {\r\n      yield*stopWorkQueues(ctx)();\r\n      selectors.error.getDialogController(ctx).dismissErrors();\r\n      yield*selectors.error.getDialogController(ctx).pushError(\r\n        T(\r\n          `Your request is no longer authorized, which means that \r\n          you were either logged out or your session expired. Please log in again.`,\r\n          \"request_no_longer_authorized\"\r\n        )\r\n      );\r\n      yield*performLogout(ctx)();\r\n      return;\r\n    } else {\r\n      if (error[HANDLED]) {\r\n        yield error[HANDLED];\r\n        return;\r\n      }\r\n      const promise = flow(() => selectors.error.getDialogController(ctx).pushError(error))()\r\n      error[HANDLED] = promise;\r\n      yield promise;\r\n    }\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getApplication } from \"model/selectors/getApplication\";\r\n\r\nexport function isMobileLayoutActive(ctx: any) {\r\n  const breakpoint = getApplication(ctx).breakpoint;\r\n  if(!breakpoint){\r\n    return false;\r\n  }\r\n  return breakpoint.includes(\"small\");\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useContext } from \"react\";\r\nimport { ModalWindow } from \"@origam/components\";\r\nimport { MobXProviderContext } from \"mobx-react\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\n\r\nexport const ModalDialog: React.FC<{\r\n  title: React.ReactNode;\r\n  titleButtons: React.ReactNode;\r\n  titleIsWorking?: boolean;\r\n  buttonsLeft: React.ReactNode;\r\n  buttonsRight: React.ReactNode;\r\n  buttonsCenter: React.ReactNode;\r\n  width?: number;\r\n  height?: number;\r\n  topPosiotionProc?: number;\r\n  onKeyDown?: (event: any) => void;\r\n}> = (props) => {\r\n  const application = useContext(MobXProviderContext).application\r\n\r\n  return (\r\n    <ModalWindow\r\n      title={props.title}\r\n      titleButtons={props.titleButtons}\r\n      titleIsWorking={props.titleIsWorking}\r\n      buttonsLeft={props.buttonsLeft}\r\n      buttonsRight={props.buttonsRight}\r\n      buttonsCenter={props.buttonsCenter}\r\n      width={props.width}\r\n      height={props.height}\r\n      fullScreen={isMobileLayoutActive(application)}\r\n      topPosiotionProc={props.topPosiotionProc}\r\n      onKeyDown={props.onKeyDown}\r\n    >\r\n      {props.children}\r\n    </ModalWindow>\r\n  );\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport enum IActionResultType {\r\n  UpdateData = \"UpdateData\",\r\n  RefreshData = \"RefreshData\",\r\n  OpenForm = \"OpenForm\",\r\n  OpenUrl = \"OpenUrl\",\r\n  ChangeUI = \"ChangeUI\",\r\n  DestroyForm = \"DestroyForm\",\r\n  Script = \"Script\"\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { observer } from \"mobx-react\";\r\nimport CS from \"./DialogsCommon.module.css\";\r\nimport { T } from \"../../../utils/translation\";\r\nimport { ModalDialog } from \"gui/Components/Dialog/ModalDialog\";\r\n\r\n@observer\r\nexport class QuestionSaveData extends React.Component<{\r\n  screenTitle: string;\r\n  onSaveClick?: (event: any) => void;\r\n  onDontSaveClick?: (event: any) => void;\r\n  onCancelClick?: (event: any) => void;\r\n}> {\r\n  refPrimaryBtn = (elm: any) => (this.elmPrimaryBtn = elm);\r\n  elmPrimaryBtn: any;\r\n\r\n  componentDidMount() {\r\n    setTimeout(() => {\r\n      if (this.elmPrimaryBtn) {\r\n        this.elmPrimaryBtn.focus?.();\r\n      }\r\n    }, 150);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <ModalDialog\r\n        title={T(\"Question\", \"question_title\")}\r\n        titleButtons={null}\r\n        buttonsCenter={\r\n          <>\r\n            <button\r\n              autoFocus={true}\r\n              tabIndex={0}\r\n              ref={this.refPrimaryBtn}\r\n              onClick={this.props.onSaveClick}\r\n            >\r\n              {T(\"Save\", \"save\")}\r\n            </button>\r\n            <button\r\n              tabIndex={0}\r\n              onClick={this.props.onDontSaveClick}\r\n              id={\"dontSaveButton\"}\r\n            >\r\n              {T(\"Don't Save\", \"close_without_saving\")}\r\n            </button>\r\n            <button tabIndex={0} onClick={this.props.onCancelClick}>\r\n              {T(\"Cancel\", \"button_cancel\")}\r\n            </button>\r\n          </>\r\n        }\r\n        buttonsLeft={null}\r\n        buttonsRight={null}\r\n      >\r\n        <div className={CS.dialogContent}>\r\n          {T(\"Do you wish to save changes in {0}?\", \"do_you_wish_to_save\", this.props.screenTitle)}\r\n        </div>\r\n      </ModalDialog>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"../DataView/getDataView\";\r\n\r\nexport function getTablePanelView(ctx: any) {\r\n  return getDataView(ctx)?.tablePanelView;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n\r\nexport class EventHandler {\r\n\r\n  callBacks: (() => void)[] = [];\r\n\r\n  add(callBack: () => void){\r\n    if(!this.callBacks.includes(callBack)){\r\n      this.callBacks.push(callBack);\r\n    }\r\n  }\r\n\r\n  remove(callBack: () => void){\r\n    this.callBacks.remove(callBack);\r\n  }\r\n\r\n  call(){\r\n    for (const callBack of this.callBacks) {\r\n      callBack();\r\n    }\r\n  }\r\n}\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IActionParameter } from \"./IActionParameter\";\r\n\r\n\r\nexport enum IActionType {\r\n  Report = \"Report\",\r\n  ChangeUI = \"ChangeUI\",\r\n  OpenForm = \"OpenForm\",\r\n  Workflow = \"Workflow\",\r\n  QueueAction = \"QueueAction\",\r\n  SelectionDialogAction = \"SelectionDialogAction\",\r\n  Dropdown = \"Dropdown\"\r\n}\r\n\r\nexport enum IActionPlacement {\r\n  PanelHeader = \"PanelHeader\",\r\n  Toolbar = \"Toolbar\",\r\n  PanelMenu = \"PanelMenu\"\r\n}\r\n\r\nexport enum IActionMode {\r\n  MultipleCheckboxes = \"MultipleCheckboxes\",\r\n  ActiveRecord = \"ActiveRecord\",\r\n  Always = \"Always\"\r\n}\r\n\r\nexport interface IActionData {\r\n  type: IActionType;\r\n  id: string;\r\n  groupId: string;\r\n  caption: string;\r\n  placement: IActionPlacement;\r\n  iconUrl: string;\r\n  mode: IActionMode;\r\n  isDefault: boolean;\r\n  parameters: IActionParameter[];\r\n  confirmationMessage?: string;\r\n}\r\n\r\nexport interface IAction extends IActionData {\r\n  $type_IAction: 1;\r\n  isEnabled: boolean;\r\n  parent?: any;\r\n}\r\n\r\nexport const isIAction = (o: any): o is IAction => o.$type_IAction;","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDialogInfo, IOpenedScreen, IOpenedScreenData } from \"./types/IOpenedScreen\";\r\nimport { action, computed, observable } from \"mobx\";\r\nimport { IFormScreenEnvelope } from \"./types/IFormScreen\";\r\nimport { IMainMenuItemType } from \"./types/IMainMenu\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { EventHandler } from \"utils/EventHandler\";\r\n\r\nexport class DialogInfo implements IDialogInfo {\r\n  constructor(public width: number, public height: number) {\r\n  }\r\n}\r\n\r\nexport class OpenedScreen implements IOpenedScreen {\r\n  dialogInfo?: IDialogInfo | undefined;\r\n  parentContext: IOpenedScreen | undefined;\r\n  $type_IOpenedScreen: 1 = 1;\r\n  parentSessionId: string | undefined;\r\n\r\n  isBeingClosed = false;\r\n\r\n  constructor(data: IOpenedScreenData) {\r\n    Object.assign(this, data);\r\n    this.content.parent = this;\r\n  }\r\n\r\n  activationHandler = new EventHandler();\r\n\r\n  @observable stackPosition: number = 0;\r\n  @observable isActive = false;\r\n  lazyLoading: boolean = false;\r\n  menuItemId: string = \"\";\r\n  menuItemType: IMainMenuItemType = null as any;\r\n  order: number = 0;\r\n  _title: string = \"\";\r\n  @observable isSleeping?: boolean = false;\r\n  @observable isSleepingDirty?: boolean = false;\r\n  isClosed: boolean = false;\r\n  @observable content: IFormScreenEnvelope = null as any;\r\n  parameters: { [key: string]: any } = {};\r\n\r\n  get tabTitle() {\r\n    return this.content.formScreen?.dynamicTitle ?? this._title;\r\n  }\r\n\r\n  get formTitle() {\r\n    return this.content.formScreen?.dynamicTitle ?? this.content.formScreen?.title ?? \"\";\r\n  }\r\n\r\n  get hasDynamicTitle() {\r\n    return !!this.content.formScreen?.dynamicTitle\r\n  }\r\n\r\n  set tabTitle(value: string) {\r\n    this._title = value;\r\n  }\r\n\r\n  @computed get isDialog() {\r\n    return this.dialogInfo !== undefined;\r\n  }\r\n\r\n  @action.bound\r\n  setActive(state: boolean): void {\r\n    this.isActive = state;\r\n    if (state && this.content.formScreen) {\r\n      const dataView = this.content.formScreen.dataViews.length > 0\r\n        ? this.content.formScreen.dataViews[0]\r\n        : undefined;\r\n      if (dataView && !dataView.isFormViewActive()) {\r\n        const tablePanelView = getTablePanelView(dataView);\r\n        tablePanelView.triggerOnFocusTable();\r\n      }\r\n      this.activationHandler.call();\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  setContent(screen: IFormScreenEnvelope): void {\r\n    this.content = screen;\r\n    screen.parent = this;\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { isIAction } from \"model/entities/types/IAction\";\r\n\r\nexport function getAction(ctx: any) {\r\n  let cn = ctx;\r\n  while (!isIAction(cn)) cn = cn.parent;\r\n  return cn;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\"\r\n\r\nexport default {\r\n  refresh(ctx: any) {\r\n    return function*refresh() {\r\n      yield*getFormScreenLifecycle(ctx).refreshSession();\r\n    }\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport enum IUrlUpenMethod {\r\n  OrigamTab = \"OrigamTab\"\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport formScreen from \"./formScreen\";\r\nimport error from \"./error\";\r\nimport selectionCheckboxes from \"model/selectors-tree/selectionCheckboxes\";\r\n\r\nexport default {\r\n  selectionCheckboxes,\r\n  formScreen,\r\n  error\r\n};\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IUrlUpenMethod } from \"model/entities/types/IUrlOpenMethod\";\r\nimport { getWorkbenchLifecycle } from \"model/selectors/getWorkbenchLifecycle\";\r\n\r\nexport function openNewUrl(ctx: any) {\r\n  return function*openNewUrl(\r\n    url: string,\r\n    urlOpenMethod: IUrlUpenMethod,\r\n    title: string\r\n  ) {\r\n    switch (urlOpenMethod) {\r\n      case IUrlUpenMethod.OrigamTab:\r\n        yield*getWorkbenchLifecycle(ctx).openNewUrl(url, title);\r\n        break;\r\n      default:\r\n        // TODO: Transform url to be absolute to urlroot?\r\n        const win = window.open(`${url}`, \"_blank\");\r\n        win && win.focus();\r\n        break;\r\n    }\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFormScreen } from '../FormScreen/getFormScreen';\r\n\r\nexport function getDataViewsByEntity(ctx: any, entity: string) {\r\n  return getFormScreen(ctx).getDataViewsByEntity(entity);\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFormScreen } from '../FormScreen/getFormScreen';\r\n\r\nexport function getDataSourceByEntity(ctx: any, entity: string) {\r\n  return getFormScreen(ctx).getDataSourceByEntity(entity);\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getRowStatesByEntity } from \"model/selectors/RowState/getRowStatesByEntity\";\r\n\r\nexport function putRowStateValue(ctx: any) {\r\n  return function putRowStateValue(entity: string, state: any) {\r\n    const rowStates = getRowStatesByEntity(ctx, entity);\r\n    rowStates && rowStates.putValue(state);\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataSourceByEntity } from \"../DataSources/getDataSourceByEntity\";\r\n\r\nexport function getRowStatesByEntity(ctx: any, entity: string) {\r\n  const dataSource = getDataSourceByEntity(ctx, entity);\r\n  const rowStates = dataSource ? dataSource.rowState : undefined;\r\n  return rowStates;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFormScreen } from \"./getFormScreen\";\r\n\r\nexport function getDataViewList(ctx: any) {\r\n  return getFormScreen(ctx).dataViews;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getIsBindingRoot(ctx: any) {\r\n  return getDataView(ctx).isBindingRoot;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFormScreen } from \"../FormScreen/getFormScreen\";\r\n\r\nexport function getDataSources(ctx: any) {\r\n  return getFormScreen(ctx).dataSources\r\n}","import { DataViewCache } from \"../../entities/DataViewCache\";\r\nimport { getFormScreen } from \"./getFormScreen\";\r\n\r\nexport function getDataViewCache(ctx: any): DataViewCache {\r\n  return getFormScreen(ctx).dataViewCache;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataViewsByEntity } from \"../../selectors/DataView/getDataViewsByEntity\";\r\nimport _ from \"lodash\";\r\nimport { getFormScreen } from \"model/selectors/FormScreen/getFormScreen\";\r\nimport { putRowStateValue } from \"../RowStates/putRowStateValue\";\r\nimport { reloadScreen } from \"../FormScreen/reloadScreen\";\r\nimport { getDataViewList } from \"model/selectors/FormScreen/getDataViewList\";\r\nimport { getIsBindingRoot } from \"model/selectors/DataView/getIsBindingRoot\";\r\nimport { getWorkbench } from \"model/selectors/getWorkbench\";\r\nimport { getDataSources } from \"model/selectors/DataSources/getDataSources\";\r\nimport { IDataView } from \"model/entities/types/IDataView\";\r\nimport { getDataViewCache } from \"../../selectors/FormScreen/getDataViewCache\";\r\n\r\nexport enum IResponseOperation {\r\n  DeleteAllData = -2,\r\n  Delete = -1, // OK\r\n  Update = 0, // OK\r\n  Create = 1, // OK\r\n  FormSaved = 2, // OK ? - TODO: Check\r\n  FormNeedsRefresh = 3,\r\n  CurrentRecordNeedsUpdate = 4,\r\n  RefreshPortal = 5,\r\n}\r\n\r\nexport interface ICRUDResult {\r\n  entity: string;\r\n  objectId: string;\r\n  operation: IResponseOperation;\r\n  requestingGrid: string | null;\r\n  state: string | null;\r\n  wrappedObject: any[];\r\n}\r\n\r\nexport function*processCRUDResult(ctx: any, result: ICRUDResult,\r\n                                  resortTables?: boolean | undefined,\r\n                                  sourceDataView?: IDataView): Generator {\r\n  if (_.isArray(result)) {\r\n    for (let resultItem of result) {\r\n      yield*processCRUDResult(ctx, resultItem, resortTables, sourceDataView);\r\n    }\r\n    return;\r\n  }\r\n  // console.log(result)\r\n  const resultItem = result;\r\n  if (resultItem.state) {\r\n    // TODO: Context for all CRUD ops?\r\n    // TODO: Actions are pre data view vs state is related to entity?\r\n    putRowStateValue(ctx)(resultItem.entity, resultItem.state);\r\n  }\r\n  switch (resultItem.operation) {\r\n    case IResponseOperation.Update: {\r\n      const dataViews = getDataViewsByEntity(ctx, resultItem.entity);\r\n      for (let dataView of dataViews) {\r\n        dataView.dataTable.clearRecordDirtyValues(resultItem.objectId, resultItem.wrappedObject);\r\n        dataView.substituteRecord(resultItem.wrappedObject);\r\n        getDataViewCache(dataView).UpdateData(dataView);\r\n        if (resortTables) {\r\n          yield dataView.dataTable.updateSortAndFilter({retainPreviousSelection: true});\r\n        }\r\n        if (!dataView.selectedRow) {\r\n          dataView.reselectOrSelectFirst();\r\n        }\r\n        dataView.formFocusManager.stopAutoFocus();\r\n        dataView.gridFocusManager.focusTableIfNeeded();\r\n      }\r\n      getFormScreen(ctx).setDirty(true);\r\n      break;\r\n    }\r\n    case IResponseOperation.Create: {\r\n      const dataViews = getDataViewsByEntity(ctx, resultItem.entity);\r\n      for (let dataView of dataViews) {\r\n        const tablePanelView = dataView.tablePanelView;\r\n        const dataSourceRow = result.wrappedObject;\r\n        const shouldLockNewRowAtTop = sourceDataView?.modelInstanceId === dataView.modelInstanceId;\r\n\r\n        if (dataView.isLazyLoading) {\r\n          yield dataView.dataTable.insertRecord(tablePanelView.firstVisibleRowIndex, dataSourceRow, shouldLockNewRowAtTop);\r\n          try {\r\n            dataView.lifecycle.stopSelectedRowReaction();\r\n            dataView.selectRow(dataSourceRow);\r\n            yield*dataView.lifecycle.changeMasterRow();\r\n          } finally {\r\n            dataView.lifecycle.startSelectedRowReaction();\r\n          }\r\n        } else {\r\n          yield dataView.dataTable.insertRecord(dataView.tableRows.length, dataSourceRow, shouldLockNewRowAtTop);\r\n          dataView.selectRow(dataSourceRow);\r\n        }\r\n        getDataViewCache(dataView).UpdateData(dataView);\r\n      }\r\n      getFormScreen(ctx).setDirty(true);\r\n      break;\r\n    }\r\n    case IResponseOperation.Delete: {\r\n      const dataViews = getDataViewsByEntity(ctx, resultItem.entity);\r\n      for (let dataView of dataViews) {\r\n        const row = dataView.dataTable.getRowById(resultItem.objectId);\r\n        if (row) {\r\n          dataView.deleteRowAndSelectNext(row);\r\n          getDataViewCache(dataView).UpdateData(dataView);\r\n        }\r\n      }\r\n      getFormScreen(ctx).setDirty(true);\r\n      break;\r\n    }\r\n    case IResponseOperation.FormSaved: {\r\n      getFormScreen(ctx).setDirty(false);\r\n      const workbench = getWorkbench(ctx);\r\n      const {cacheDependencies, lookupCleanerReloaderById} = workbench.lookupMultiEngine;\r\n      const dataSources = getDataSources(ctx);\r\n      const collectedLookupIds = cacheDependencies.getDependencyLookupIdsByCacheKeys(\r\n        dataSources.map((ds) => ds.lookupCacheKey)\r\n      );\r\n      for (let lookupId of collectedLookupIds) {\r\n        lookupCleanerReloaderById.get(lookupId)?.reloadLookupLabels();\r\n        workbench.lookupListCache.deleteLookup(lookupId);\r\n      }\r\n      break;\r\n    }\r\n    case IResponseOperation.CurrentRecordNeedsUpdate: {\r\n      // TODO: Throw away all data and force further navigation / throw away all rowstates\r\n      const dataViews = getDataViewList(ctx);\r\n      for (let dataView of dataViews) {\r\n        if (getIsBindingRoot(dataView) && dataView.requestDataAfterSelectionChange) {\r\n          yield*dataView.lifecycle.changeMasterRow();\r\n          yield*dataView.lifecycle.navigateChildren();\r\n        }\r\n        if (!dataView.selectedRow) {\r\n          dataView.reselectOrSelectFirst();\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case IResponseOperation.FormNeedsRefresh: {\r\n      if (!getFormScreen(ctx).suppressRefresh) {\r\n        yield*reloadScreen(ctx)(); // TODO: It is not possible to reload data... Has to be done by different API endpoint\r\n      }\r\n      break;\r\n    }\r\n    case IResponseOperation.DeleteAllData: {\r\n      const dataViews = getDataViewList(ctx);\r\n      for (let dataView of dataViews) {\r\n        dataView.clear();\r\n      }\r\n      break;\r\n    }\r\n    default:\r\n      throw new Error(\"Unknown operation \" + resultItem.operation);\r\n  }\r\n  //}\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getMainMenu } from \"./getMainMenu\";\r\n\r\nconst BREAK_RECURSION = Symbol(\"BREAK_RECURSION\");\r\n\r\nexport function getMainMenuItemById(ctx: any, id: string) {\r\n  const rawMenu = getMainMenu(ctx)!.menuUI;\r\n  let result: any;\r\n\r\n  function recursive(node: any) {\r\n    if (node.attributes.id === id) {\r\n      result = node;\r\n      throw BREAK_RECURSION;\r\n    }\r\n    for (let child of node.elements) {\r\n      recursive(child);\r\n    }\r\n  }\r\n\r\n  try {\r\n    recursive(rawMenu);\r\n  } catch (e) {\r\n    if (e === BREAK_RECURSION) {\r\n      return result;\r\n    }\r\n    throw e;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IActionResultType } from \"../SelectionDialog/types\";\r\nimport { getWorkbenchLifecycle } from \"../../selectors/getWorkbenchLifecycle\";\r\nimport { DialogInfo } from \"model/entities/OpenedScreen\";\r\nimport { closeForm } from \"../closeForm\";\r\nimport { getActionCaption } from \"model/selectors/Actions/getActionCaption\";\r\nimport { IMainMenuItemType } from \"model/entities/types/IMainMenu\";\r\nimport { IDialogInfo } from \"model/entities/types/IOpenedScreen\";\r\n\r\nimport actions from \"model/actions-tree\";\r\nimport { IUrlUpenMethod } from \"model/entities/types/IUrlOpenMethod\";\r\nimport { openNewUrl } from \"../Workbench/openNewUrl\";\r\nimport { ICRUDResult, processCRUDResult } from \"../DataLoading/processCRUDResult\";\r\nimport { IRefreshOnReturnType } from \"model/entities/WorkbenchLifecycle/WorkbenchLifecycle\";\r\nimport { IDataView } from \"../../entities/types/IDataView\";\r\nimport { getDataViewByModelInstanceId } from \"../../selectors/DataView/getDataViewByModelInstanceId\";\r\nimport { getOpenedScreen } from \"../../selectors/getOpenedScreen\";\r\nimport { getMainMenuItemById } from \"model/selectors/MainMenu/getMainMenuItemById\";\r\n\r\nexport interface IOpenNewForm {\r\n  (\r\n    id: string,\r\n    type: IMainMenuItemType,\r\n    label: string,\r\n    isLazyLoading: boolean,\r\n    dialogInfo: IDialogInfo | undefined,\r\n    parameters: { [key: string]: any },\r\n    parentContext: any,\r\n    requestParameters: object,\r\n    formSessionId?: string,\r\n    isSessionRebirth?: boolean,\r\n    registerSession?: true,\r\n    refreshOnReturnType?: IRefreshOnReturnType\r\n  ): Generator; //boolean\r\n}\r\n\r\nexport interface IOpenNewUrl {\r\n  (url: string, urlOpenMethod: IUrlUpenMethod, title: string): Generator;\r\n}\r\n\r\nexport interface IGetActionCaption {\r\n  (): string;\r\n}\r\n\r\nexport interface ICloseForm {\r\n  (): Generator;\r\n}\r\n\r\nexport interface IRefreshForm {\r\n  (): Generator;\r\n}\r\n\r\nexport interface IProcessCRUDResult {\r\n  (data: { crudResult: ICRUDResult, resortTables?: boolean }): Generator;\r\n}\r\n\r\nexport function new_ProcessActionResult(ctx: any) {\r\n  const workbenchLifecycle = getWorkbenchLifecycle(ctx);\r\n  const getPanelFunc = (modelInstanceId: string) => getDataViewByModelInstanceId(ctx, modelInstanceId)!;\r\n  return processActionResult2({\r\n    getPanelFunc: getPanelFunc,\r\n    openNewForm: workbenchLifecycle.openNewForm,\r\n    openNewUrl: openNewUrl(ctx),\r\n    closeForm: closeForm(ctx),\r\n    refreshForm: actions.formScreen.refresh(ctx),\r\n    getActionCaption: () => getActionCaption(ctx),\r\n    processCRUDResult: (data: { crudResult: ICRUDResult, resortTables?: boolean }) => processCRUDResult(ctx, data.crudResult, data.resortTables),\r\n    parentContext: ctx\r\n  });\r\n}\r\n\r\nexport function processActionResult2(dep: {\r\n  getPanelFunc: (modelInstanceId: string) => IDataView;\r\n  openNewForm: IOpenNewForm;\r\n  openNewUrl: IOpenNewUrl;\r\n  closeForm: ICloseForm;\r\n  refreshForm: IRefreshForm;\r\n  getActionCaption: IGetActionCaption;\r\n  processCRUDResult: IProcessCRUDResult;\r\n  parentContext: any\r\n}) {\r\n  return function*processActionResult2(actionResultList: any[]) {\r\n    const indexedList = actionResultList.map((item, index) => [index, item]);\r\n    indexedList.sort((a: any, b: any) => {\r\n      if (a[1].type === IActionResultType.DestroyForm) return -1;\r\n      if (b[1].type === IActionResultType.DestroyForm) return 1;\r\n      return a[0] - b[0]\r\n    })\r\n    for (let actionResultItem of indexedList.map(item => item[1])) {\r\n      switch (actionResultItem.type) {\r\n        case IActionResultType.OpenForm: {\r\n          const menuItem = getMainMenuItemById(dep.parentContext, actionResultItem.request.objectId);\r\n          const lazyLoading = menuItem\r\n            ? menuItem?.attributes?.lazyLoading === \"true\"\r\n            : false;\r\n          const {request, refreshOnReturnType} = actionResultItem;\r\n          const {\r\n            objectId,\r\n            typeString,\r\n            parameters,\r\n            isModalDialog,\r\n            dialogWidth,\r\n            dialogHeight,\r\n            caption\r\n          } = request;\r\n          const dialogInfo = isModalDialog ? new DialogInfo(dialogWidth, dialogHeight) : undefined;\r\n          yield*dep.openNewForm(\r\n            objectId,\r\n            typeString,\r\n            caption || dep.getActionCaption(),\r\n            lazyLoading,\r\n            dialogInfo,\r\n            parameters,\r\n            dep.parentContext,\r\n            actionResultItem.request,\r\n            undefined,\r\n            undefined,\r\n            undefined,\r\n            refreshOnReturnType,\r\n          );\r\n          break;\r\n        }\r\n        case IActionResultType.DestroyForm: {\r\n          yield*dep.closeForm();\r\n          break;\r\n        }\r\n        case IActionResultType.RefreshData: {\r\n          yield*dep.refreshForm();\r\n          break;\r\n        }\r\n        case IActionResultType.UpdateData: {\r\n          yield*dep.processCRUDResult(\r\n            {crudResult: actionResultItem.changes, resortTables: true}\r\n          );\r\n          break;\r\n        }\r\n        case IActionResultType.OpenUrl: {\r\n          yield*dep.openNewUrl(\r\n            actionResultItem.url,\r\n            actionResultItem.urlOpenMethod,\r\n            actionResultItem.request.caption\r\n          );\r\n          if (getOpenedScreen(dep.parentContext).isDialog) {\r\n            yield*dep.closeForm();\r\n          }\r\n          break;\r\n        }\r\n        case IActionResultType.Script: {\r\n          try {\r\n            // eslint-disable-next-line no-new-func\r\n            const actionScript = new Function(\"getPanel\", actionResultItem.script);\r\n            actionScript(dep.getPanelFunc);\r\n          } catch (e) {\r\n            let message = \"An error occurred while executing custom script: \" + actionResultItem.script + \", \\n\" + e.message;\r\n            if (e.stackTrace)\r\n              message += (\", \\n\" + e.stackTrace);\r\n            throw new Error(message)\r\n          }\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDataView } from \"../../entities/types/IDataView\";\r\nimport { getOpenedScreen } from \"../getOpenedScreen\";\r\n\r\nexport function getDataViewByModelInstanceId(ctx: any, modelInstanceId: string): IDataView | undefined {\r\n  return getOpenedScreen(ctx).content.formScreen!.dataViews.find(\r\n    item => item.modelInstanceId === modelInstanceId\r\n  );\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getAction } from \"./getAction\";\r\n\r\nexport function getActionCaption(ctx: any) {\r\n  return getAction(ctx).caption;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbench } from \"./getWorkbench\";\r\n\r\nexport function getSearcher(ctx: any) {\r\n  return getWorkbench(ctx).searcher;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getSearcher } from \"model/selectors/getSearcher\";\r\nimport { getWorkQueues } from \"model/selectors/WorkQueues/getWorkQueues\";\r\n\r\nexport function refreshWorkQueues(ctx: any) {\r\n  return function*refreshWorkQueues() {\r\n    const workQueues = getWorkQueues(ctx);\r\n    yield*workQueues.getWorkQueueList();\r\n    getSearcher(ctx).indexWorkQueues(workQueues.items);\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { isIDataView } from \"model/entities/types/IDataView\";\r\nimport { isIDataSource } from \"model/entities/types/IDataSource\";\r\n\r\nexport function getDataSource(ctx: any) {\r\n  let cn = ctx;\r\n  while (true) {\r\n    if (isIDataView(cn)) {\r\n      return cn.dataSource;\r\n    }\r\n    if (isIDataSource(cn)) {\r\n      return cn\r\n    }\r\n    cn = cn.parent;\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDataSourceField } from \"./IDataSourceField\";\r\nimport { IRowState } from \"./IRowState\";\r\n\r\nexport interface IDataSourceData {\r\n  entity: string;\r\n  identifier: string;\r\n  lookupCacheKey: string;\r\n  fields: IDataSourceField[];\r\n  dataStructureEntityId: string;\r\n  rowState: IRowState;\r\n}\r\n\r\nexport interface IDataSource extends IDataSourceData {\r\n  $type_IDataSource: 1;\r\n\r\n  getFieldByName(name: string): IDataSourceField | undefined;\r\n\r\n  getFieldByIndex(idex: number): IDataSourceField | undefined;\r\n\r\n  parent?: any;\r\n}\r\n\r\nexport const isIDataSource = (o: any): o is IDataSource => o.$type_IDataSource;\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataSourceFields } from \"../DataSources/getDataSourceFields\";\r\n\r\nexport function getColumnNamesToLoad(ctx: any): string[] {\r\n  return getDataSourceFields(ctx)\r\n    .map(field => field.name)\r\n    .filter(name => !name.startsWith(\"__\"));\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataSource } from \"./getDataSource\";\r\n\r\nexport function getDataSourceFields(ctx: any) {\r\n  return getDataSource(ctx).fields\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataSource } from \"../DataSources/getDataSource\";\r\n\r\nexport function getDataStructureEntityId(ctx: any): string {\r\n  return getDataSource(ctx).dataStructureEntityId;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getGridId(ctx: any): string {\r\n  return getDataView(ctx).modelInstanceId;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getOpenedScreen } from \"../getOpenedScreen\";\r\nimport { getGridId } from \"./getGridId\";\r\n\r\nexport function getDataViewByGridId(ctx: any, gridId: string) {\r\n  return getOpenedScreen(ctx).content.formScreen!.dataViews.find(\r\n    item => getGridId(item) === gridId\r\n  );\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getOpenedScreen } from \"../getOpenedScreen\";\r\n\r\nexport function getIsFormScreenDirty(ctx: any) {\r\n  const openedScreen = getOpenedScreen(ctx);\r\n  if (openedScreen.isSleeping && openedScreen.isSleepingDirty) return true;\r\n  if (openedScreen.content && !openedScreen.content.isLoading) {\r\n    return openedScreen.content.formScreen!.isDirty;\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFormScreen } from \"./getFormScreen\";\r\n\r\nexport function getIsSuppressSave(ctx: any) {\r\n  return getFormScreen(ctx).suppressSave;\r\n}","import { getApplication } from \"model/selectors/getApplication\";\r\nimport { MobileState } from \"model/entities/MobileState/MobileState\";\r\n\r\nexport function getMobileState(ctx: any): MobileState {\r\n  const mobileState = getApplication(ctx).mobileState;\r\n  if (!mobileState) {\r\n    throw new Error(\"No mobileState in Application.\");\r\n  }\r\n  return mobileState;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IOpenedScreens } from '../entities/types/IOpenedScreens';\r\nimport { getWorkbench } from './getWorkbench';\r\n\r\nexport function getOpenedScreens(ctx: any): IOpenedScreens {\r\n  return getWorkbench(ctx).openedScreens;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getOpenedScreens } from \"./getOpenedScreens\";\r\n\r\nexport function getOpenedNonDialogScreenItems(ctx: any) {\r\n  return getOpenedScreens(ctx).items.filter(item => !item.isDialog);\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getOpenedScreens } from \"./getOpenedScreens\";\r\n\r\nexport function getActiveScreen(ctx: any) {\r\n  return getOpenedScreens(ctx).activeItem\r\n}","import { T } from \"utils/translation\";\r\nimport { getOpenedNonDialogScreenItems } from \"model/selectors/getOpenedNonDialogScreenItems\";\r\nimport { onScreenTabCloseClick } from \"model/actions-ui/ScreenTabHandleRow/onScreenTabCloseClick\";\r\nimport { getActiveScreen } from \"model/selectors/getActiveScreen\";\r\nimport React from \"react\";\r\n\r\nexport interface IMobileLayoutState {\r\n  actionDropUpHidden: boolean;\r\n  refreshButtonHidden: boolean;\r\n  saveButtonHidden: boolean;\r\n  showOpenTabCombo: boolean;\r\n  showSearchButton: boolean;\r\n  showHamburgerMenuButton: boolean;\r\n  heading: string;\r\n  showOkButton: boolean;\r\n\r\n  showCloseButton(someScreensAreOpen: boolean): boolean;\r\n\r\n  hamburgerClick(): IMobileLayoutState;\r\n\r\n  close(ctx: any): Promise<IMobileLayoutState>;\r\n}\r\n\r\nexport class MenuLayoutState implements IMobileLayoutState {\r\n  actionDropUpHidden = true;\r\n  refreshButtonHidden = true;\r\n  saveButtonHidden = true;\r\n  showOpenTabCombo = false;\r\n  showSearchButton = true;\r\n  showHamburgerMenuButton = false;\r\n  showOkButton = false;\r\n  heading = T(\"Menu\", \"menu\");\r\n\r\n  showCloseButton(someScreensAreOpen: boolean) {\r\n    return someScreensAreOpen;\r\n  }\r\n\r\n  async close(ctx: any): Promise<IMobileLayoutState> {\r\n    return new ScreenLayoutState();\r\n  }\r\n\r\n  hamburgerClick(): IMobileLayoutState {\r\n    return new ScreenLayoutState();\r\n  }\r\n}\r\n\r\nexport class AboutLayoutState implements IMobileLayoutState {\r\n  actionDropUpHidden = true;\r\n  refreshButtonHidden = true;\r\n  saveButtonHidden = true;\r\n  showOpenTabCombo = false;\r\n  showSearchButton = true;\r\n  showHamburgerMenuButton = true;\r\n  showOkButton = false;\r\n  heading = T(\"About\", \"about_application\");\r\n\r\n  showCloseButton(someScreensAreOpen: boolean) {\r\n    return true;\r\n  }\r\n\r\n  async close(ctx: any): Promise<IMobileLayoutState> {\r\n    return new ScreenLayoutState();\r\n  }\r\n\r\n  hamburgerClick(): IMobileLayoutState {\r\n    return new MenuLayoutState();\r\n  }\r\n}\r\n\r\nexport class SearchLayoutState implements IMobileLayoutState {\r\n  actionDropUpHidden = true;\r\n  refreshButtonHidden = true;\r\n  saveButtonHidden = true;\r\n  showOpenTabCombo = false;\r\n  showSearchButton = false;\r\n  showHamburgerMenuButton = true;\r\n  showOkButton = false;\r\n  heading = T(\"Search\", \"mobile_search_title\");\r\n\r\n  showCloseButton(someScreensAreOpen: boolean) {\r\n    return true;\r\n  }\r\n\r\n  async close(ctx: any): Promise<IMobileLayoutState> {\r\n    return new ScreenLayoutState();\r\n  }\r\n\r\n  hamburgerClick(): IMobileLayoutState {\r\n    return new MenuLayoutState();\r\n  }\r\n}\r\n\r\nexport class EditLayoutState implements IMobileLayoutState {\r\n  actionDropUpHidden = true;\r\n  refreshButtonHidden = true;\r\n  saveButtonHidden = true;\r\n  showOpenTabCombo = false;\r\n  showSearchButton = false;\r\n  showHamburgerMenuButton = false;\r\n  showOkButton = true;\r\n\r\n  constructor(\r\n    public component: React.ReactNode,\r\n    public heading: string,\r\n    public layoutAfterClose?: IMobileLayoutState,\r\n    showOkButton?: boolean)\r\n  {\r\n    this.showOkButton = showOkButton ?? true;\r\n  }\r\n\r\n  showCloseButton(someScreensAreOpen: boolean) {\r\n    return false;\r\n  }\r\n\r\n  async close(ctx: any): Promise<IMobileLayoutState> {\r\n    return this.layoutAfterClose ?? new ScreenLayoutState();\r\n  }\r\n\r\n  hamburgerClick(): IMobileLayoutState {\r\n    return new MenuLayoutState();\r\n  }\r\n}\r\n\r\nexport class DialogLayoutState implements IMobileLayoutState {\r\n  actionDropUpHidden = true;\r\n  refreshButtonHidden = true;\r\n  saveButtonHidden = true;\r\n  showOpenTabCombo = false;\r\n  showSearchButton = false;\r\n  showHamburgerMenuButton = false;\r\n  showOkButton = false;\r\n  heading = \"\";\r\n\r\n  constructor(\r\n    public component: React.ReactElement,\r\n    public layoutAfterClose?: IMobileLayoutState,)\r\n  {\r\n  }\r\n\r\n  showCloseButton(someScreensAreOpen: boolean) {\r\n    return false;\r\n  }\r\n\r\n  async close(ctx: any): Promise<IMobileLayoutState> {\r\n    return this.layoutAfterClose ?? new ScreenLayoutState();\r\n  }\r\n\r\n  hamburgerClick(): IMobileLayoutState {\r\n    return new MenuLayoutState();\r\n  }\r\n}\r\n\r\nexport class ScreenLayoutState implements IMobileLayoutState {\r\n  actionDropUpHidden = false;\r\n  refreshButtonHidden = false;\r\n  saveButtonHidden = false;\r\n  showOpenTabCombo = true;\r\n  showSearchButton = true;\r\n  showHamburgerMenuButton = true;\r\n  showOkButton = false;\r\n  heading = \"\";\r\n\r\n  showCloseButton(someScreensAreOpen: boolean) {\r\n    return true;\r\n  }\r\n\r\n  async close(ctx: any): Promise<IMobileLayoutState> {\r\n    const activeScreen = getActiveScreen(ctx);\r\n    if (activeScreen) {\r\n      await onScreenTabCloseClick(activeScreen)(null);\r\n      const stillOpenScreens = getOpenedNonDialogScreenItems(ctx);\r\n      if (stillOpenScreens.length === 0) {\r\n        return new MenuLayoutState();\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  hamburgerClick(): IMobileLayoutState {\r\n    return new MenuLayoutState();\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { RefObject } from \"react\";\r\n\r\nexport enum IMainMenuItemType {\r\n  FormRef = \"FormReferenceMenuItem\",\r\n  FormRefWithSelection = \"FormReferenceMenuItem_WithSelection\",\r\n  ReportRefWithSelection = \"ReportReferenceMenuItem_WithSelection\",\r\n  WorkflowRef = \"WorkflowReferenceMenuItem\",\r\n  WorkQueue = \"WorkQueue\",\r\n  ReportReferenceMenuItem = \"ReportReferenceMenuItem\"\r\n}\r\n\r\nexport interface IMainMenuData {\r\n  menuUI: any;\r\n}\r\n\r\nexport interface IMainMenuContent extends IMainMenuData {\r\n  $type_IMainMenuContent: 1;\r\n\r\n  getItemById(id: string): any;\r\n\r\n  parent?: any;\r\n}\r\n\r\nexport interface IMainMenuEnvelope {\r\n  $type_IMainMenuEnvelope: 1;\r\n\r\n  mainMenu?: IMainMenu;\r\n  isLoading: boolean;\r\n\r\n  setMainMenu(mainMenu: IMainMenuContent | undefined): void;\r\n\r\n  setLoading(state: boolean): void;\r\n\r\n  parent?: any;\r\n}\r\n\r\n\r\nexport interface IMainMenuState {\r\n  editing: boolean;\r\n  highLightedItemId: string | undefined;\r\n\r\n  highlightItem(itemId: string): void;\r\n\r\n  closeAll(): void;\r\n\r\n  isOpen(menuId: string): boolean;\r\n\r\n  setIsOpen(menuId: string, state: boolean): void;\r\n\r\n  flipIsOpen(menuId: string): void;\r\n\r\n  setReference(id: string, ref: RefObject<HTMLElement>): void;\r\n\r\n  scrollToItem(id: string): void\r\n}\r\n\r\nexport type IMainMenu = IMainMenuEnvelope & IMainMenuContent;\r\n\r\nexport const isIMainMenuContent = (o: any): o is IMainMenuContent => o.$type_IMainMenuContent;\r\nexport const isIMainMenuEnvelope = (o: any): o is IMainMenuEnvelope =>\r\n  o.$type_IMainMenuEnvelope;\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\n\r\nexport function wrapInFlowWithHandler(args: { ctx: any; action: (() => Promise<any>) | (() => void) }) {\r\n  return flow(function*runWithHandler() {\r\n    try {\r\n      yield args.action();\r\n    } catch (e) {\r\n      yield*handleError(args.ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n\r\nexport function runInFlowWithHandler(args: { ctx: any, action: (() => Promise<any>) | (() => void) }) {\r\n  return wrapInFlowWithHandler(args)();\r\n}\r\n\r\nexport function runGeneratorInFlowWithHandler(args: { ctx: any, generator: Generator }) {\r\n  return flow(function*runWithHandler() {\r\n    try {\r\n      return yield*args.generator;\r\n    } catch (e) {\r\n      yield*handleError(args.ctx)(e);\r\n      throw e;\r\n    }\r\n  })();\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getApplication } from './getApplication';\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\nimport React from \"react\";\r\nimport { getMobileState } from \"model/selectors/getMobileState\";\r\nimport { DialogLayoutState } from \"model/entities/MobileState/MobileLayoutState\";\r\nimport { runInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\n\r\nexport function getDialogStack(ctx: any) {\r\n  return getApplication(ctx).dialogStack;\r\n}\r\n\r\nexport function showDialog(ctx: any, key: string, component: React.ReactElement) {\r\n  if(isMobileLayoutActive(ctx)){\r\n    const layoutStateBefore = getMobileState(ctx).layoutState;\r\n    const dialogLayoutState = new DialogLayoutState(component, layoutStateBefore);\r\n    const closeFunction = () => {\r\n      runInFlowWithHandler({ctx: ctx, action: async ()=> {\r\n          getMobileState(ctx).layoutState = await dialogLayoutState.close(ctx)\r\n        }\r\n      })\r\n    };\r\n    getMobileState(ctx).layoutState = dialogLayoutState;\r\n    return closeFunction;\r\n  }\r\n  return getDialogStack(ctx).pushDialog(key, component);\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getOpenedScreen } from \"./getOpenedScreen\";\r\n\r\nexport function getIsActiveScreen(ctx: any) {\r\n  return getOpenedScreen(ctx).isActive;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport function map2obj(map: Map<string, any>) {\r\n  const result: { [key: string]: any } = {};\r\n  for (let [k, v] of map.entries()) {\r\n    result[k] = v;\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction splitPropertyPair(pair: string) {\r\n  return pair.split(\":\").map(x => x.trim())\r\n}\r\n\r\nexport function cssString2Object(cssString: string | undefined) {\r\n  if (!cssString) {\r\n    return undefined;\r\n  }\r\n  return cssString\r\n    .split(\";\")\r\n    .filter(pair => pair !== \"\")\r\n    .map(pair => splitPropertyPair(pair))\r\n    .reduce((obj: any, pair) => {\r\n        obj[pair[0]] = pair[1];\r\n        return obj;\r\n      }\r\n      , {})\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getDataViewLifecycle(ctx: any) {\r\n  return getDataView(ctx).lifecycle;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataViewLifecycle } from \"model/selectors/DataView/getDataViewLifecycle\"\r\n\r\nexport function navigateAsChild(ctx: any, rows?: any[]) {\r\n  return function*navigateAsChild() {\r\n    yield*getDataViewLifecycle(ctx).navigateAsChild(rows);\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getBindingChildren(ctx: any) {\r\n  return getDataView(ctx).childBindings.map(cb => cb.childDataView)\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataSource } from \"../DataSources/getDataSource\";\r\n\r\nexport function getEntity(ctx: any) {\r\n  return getDataSource(ctx).entity;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getBindingRoot } from './getBindingRoot';\r\n\r\nexport function getMasterRowId(ctx: any) {\r\n  return getBindingRoot(ctx).selectedRowId;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getBindingRoot(ctx: any) {\r\n  return getDataView(ctx).bindingRoot;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"../DataView/getDataView\";\r\n\r\nexport function getSelectedRowId(ctx: any) {\r\n  return getDataView(ctx).selectedRowId;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getBindingParents(ctx: any) {\r\n  return getDataView(ctx).parentBindings.map(pb => pb.parentDataView)\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getBindingParents } from \"./getBindingParents\";\r\n\r\nexport function getBindingParent(ctx: any) {\r\n  const bps = getBindingParents(ctx);\r\n  const bp = bps.length > 0 ? bps[0] : undefined;\r\n  return bp;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getSelectedRowId } from \"../TablePanelView/getSelectedRowId\";\r\nimport { getBindingParent } from \"./getBindingParent\";\r\n\r\nexport function getParentRowId(ctx: any) {\r\n  const bp = getBindingParent(ctx);\r\n  return bp ? getSelectedRowId(bp) : undefined;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IMainMenuItemType } from \"model/entities/types/IMainMenu\";\r\nimport { getOpenedScreen } from \"./getOpenedScreen\";\r\n\r\nexport function isLazyLoading(ctx: any) {\r\n  const openScreen = getOpenedScreen(ctx);\r\n  return openScreen.lazyLoading && openScreen.menuItemType !== IMainMenuItemType.FormRefWithSelection;\r\n  // openScreen.menuItemType !== IMainMenuItemType.FormRefWithSelection means menu item opens a selection dialog\r\n  // (which is never lazy loaded) and value of the \"openScreen.lazyLoading\" field is actually relevant to the form\r\n  // which will be open after the selection dialog is closed.\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFormScreen } from \"./FormScreen/getFormScreen\";\r\n\r\nexport function getSessionId(ctx: any) {\r\n  return getFormScreen(ctx).sessionId;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getOpenedScreen } from \"./getOpenedScreen\";\r\n\r\nexport function getMenuItemId(ctx: any) {\r\n  return getOpenedScreen(ctx).menuItemId;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n\r\nexport enum IOrderByDirection {\r\n  NONE = \"NONE\",\r\n  ASC = \"ASC\",\r\n  DESC = \"DESC\"\r\n}\r\n\r\n\r\nexport interface IOrderByColumnSetting {\r\n  ordering: IOrderByDirection;\r\n  order: number;\r\n}\r\n\r\nexport interface IOrderingConfiguration {\r\n  userOrderings: IOrdering[];\r\n  orderings: IOrdering[];\r\n\r\n  getOrdering(column: string): IOrderByColumnSetting;\r\n\r\n  setOrdering(column: string): void;\r\n\r\n  addOrdering(column: string): void;\r\n\r\n  groupChildrenOrdering: IOrdering | undefined;\r\n\r\n  getDefaultOrderings(): IOrdering[];\r\n\r\n  parent?: any;\r\n  orderingFunction: () => (row1: any[], row2: any[]) => number;\r\n}\r\n\r\nexport interface IOrdering {\r\n  columnId: string;\r\n  direction: IOrderByDirection;\r\n  lookupId: string | undefined;\r\n}\r\n\r\nexport function parseToIOrderByDirection(candidate: string | undefined): IOrderByDirection {\r\n  switch (candidate) {\r\n    case \"Descending\":\r\n      return IOrderByDirection.DESC;\r\n    case \"Ascending\":\r\n      return IOrderByDirection.ASC;\r\n    case undefined:\r\n      return IOrderByDirection.NONE;\r\n    default:\r\n      throw new Error(\"Option not implemented: \" + candidate)\r\n  }\r\n}\r\n\r\nexport function parseToOrdering(candidateArray: any[]): IOrdering[] | undefined {\r\n  if (!candidateArray || candidateArray.length === 0) return undefined;\r\n\r\n  return candidateArray.filter(candidate => candidate.field || candidate.direction)\r\n    .map(candidate => {\r\n      return {\r\n        columnId: candidate.field,\r\n        direction: parseToIOrderByDirection(candidate.direction),\r\n        lookupId: undefined\r\n      };\r\n    })\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport moment, { Moment } from \"moment\";\r\nimport { toOrigamServerString } from \"@origam/utils\";\r\nimport { IFilter } from \"./types/IFilter\";\r\n\r\nexport function joinWithAND(filterItems: string[]) {\r\n  if (filterItems.length === 0) return \"\";\r\n  if (filterItems.length === 1) return filterItems[0];\r\n  return '[\"$AND\", ' + filterItems.join(\", \") + \"]\";\r\n}\r\n\r\nexport function joinWithOR(filterItems: string[]) {\r\n  if (filterItems.length === 0) return \"\";\r\n  if (filterItems.length === 1) return filterItems[0];\r\n  return '[\"$OR\", ' + filterItems.join(\", \") + \"]\";\r\n}\r\n\r\nexport function filterToFilterItem(filter: IFilter) {\r\n  return toFilterItem(\r\n    filter.propertyId,\r\n    filter.dataType,\r\n    filter.setting.type,\r\n    filter.setting.filterValue1,\r\n    filter.setting.filterValue2\r\n  );\r\n}\r\n\r\nfunction arrayToString(array: any[]) {\r\n  return `[${array.join(\", \")}]`;\r\n}\r\n\r\nfunction valuesToRightHandSide(val1?: any, val2?: any) {\r\n  const val1IsArray = Array.isArray(val1);\r\n  const val2IsArray = Array.isArray(val2);\r\n\r\n  if (val1 !== undefined && !val1IsArray && val2 !== undefined && !val2IsArray) {\r\n    return arrayToString([toFilterValueForm(val1), toFilterValueForm(val2)]);\r\n  }\r\n  if (val1IsArray && val2 === undefined) {\r\n    return arrayToString(val1.map((x: any) => toFilterValueForm(x)));\r\n  } else if (!val1IsArray && val2 === undefined) {\r\n    return toFilterValueForm(val1);\r\n  } else if (val1 === undefined && !val2IsArray) {\r\n    return toFilterValueForm(val2);\r\n  }\r\n  throw new Error(`Cannot convert values \"${val1}\" and \"${val2}\" to a right hand side`);\r\n}\r\n\r\nexport function toFilterItem(\r\n  columnId: string,\r\n  dataType: string | null,\r\n  operator: string,\r\n  val1?: any,\r\n  val2?: any\r\n) {\r\n  if (\r\n    dataType === \"Date\" &&\r\n    (operator === \"eq\" || operator === \"neq\") &&\r\n    val1 !== undefined &&\r\n    val1 !== \"\" &&\r\n    val1 !== null &&\r\n    val1.endsWith(\"T00:00:00.000\")\r\n  ) {\r\n    const upperLimit = new Date(val1);\r\n    upperLimit.setDate(upperLimit.getDate() + 1);\r\n    const dateTimeFormat = new Intl.DateTimeFormat(\"en\", {\r\n      year: \"numeric\",\r\n      month: \"2-digit\",\r\n      day: \"2-digit\",\r\n    });\r\n    const [{value: month}, , {value: day}, , {value: year}] = dateTimeFormat.formatToParts(\r\n      upperLimit\r\n    );\r\n    const upperLimitString = year.concat(\"-\", month, \"-\", day, \"T00:00:00.000\");\r\n    const substitutedOperator = operator === \"eq\" ? \"between\" : \"nbetween\";\r\n    return `[\"${columnId}\", \"${substitutedOperator}\", ${valuesToRightHandSide(\r\n      val1,\r\n      upperLimitString\r\n    )}]`;\r\n  }\r\n  const val1Formatted = moment.isMoment(val1)\r\n    ? toOrigamServerString(val1 as Moment)\r\n    : val1;\r\n  return `[\"${columnId}\", \"${operator}\", ${valuesToRightHandSide(val1Formatted, val2)}]`;\r\n}\r\n\r\nfunction toFilterValueForm(value: any) {\r\n  if (value === undefined) {\r\n    return null;\r\n  }\r\n  return isNaN(value) ? '\"' + value + '\"' : value;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getTablePanelView } from \"../TablePanelView/getTablePanelView\";\r\n\r\nexport function getFilterConfiguration(ctx: any) {\r\n  return getTablePanelView(ctx).filterConfiguration;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFilterConfiguration } from \"./getFilterConfiguration\";\r\nimport { filterToFilterItem, joinWithAND } from \"../../entities/OrigamApiHelpers\";\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getUserFilters(args: { ctx: any, excludePropertyId?: string }) {\r\n  const dataView = getDataView(args.ctx);\r\n  const filterConfiguration = getFilterConfiguration(dataView);\r\n  const filterList = filterConfiguration.activeFilters\r\n    .filter(filter => !args.excludePropertyId || args.excludePropertyId !== filter.propertyId)\r\n    .filter(filter => filter.setting.isComplete)\r\n    .map(filter => filterToFilterItem(filter));\r\n  return joinWithAND(filterList);\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getTablePanelView } from \"../TablePanelView/getTablePanelView\";\r\n\r\nexport function getOrderingConfiguration(ctx: any) {\r\n  return getTablePanelView(ctx).orderingConfiguration;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getOrderingConfiguration } from \"./getOrderingConfiguration\";\r\nimport { getDataStructureEntityId } from \"./getDataStructureEntityId\";\r\nimport { getDataView } from \"./getDataView\";\r\nimport { IOrderByDirection } from \"model/entities/types/IOrderingConfiguration\";\r\n\r\nexport function getUserOrdering(ctx: any) {\r\n  const dataView = getDataView(ctx);\r\n  const orderingConfiguration = getOrderingConfiguration(dataView);\r\n  const defaultOrderings = orderingConfiguration.getDefaultOrderings();\r\n  if (defaultOrderings.length === 0) {\r\n    const dataStructureEntityId = getDataStructureEntityId(dataView);\r\n    throw new Error(`Cannot infinitely scroll on dataStructureEntity: ${dataStructureEntityId} because it has no default ordering on the displayed form.`)\r\n  }\r\n  return orderingConfiguration.userOrderings.length === 0\r\n    ? defaultOrderings\r\n    : orderingConfiguration.userOrderings\r\n      .filter(ordering => ordering.direction !== IOrderByDirection.NONE);\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport function firstGteIndex(\r\n  elementGetter: (index: number) => number,\r\n  elementCount: number,\r\n  num: number\r\n) {\r\n  let indexLeft = 0;\r\n  let indexRight = elementCount - 1;\r\n  const T = num;\r\n  let element;\r\n  while (indexLeft <= indexRight) {\r\n    const currentIndex = Math.floor((indexLeft + indexRight) / 2);\r\n    element = elementGetter(currentIndex);\r\n    if (element < T) {\r\n      indexLeft = currentIndex + 1;\r\n    } else if (element > T) {\r\n      indexRight = currentIndex - 1;\r\n    } else {\r\n      return currentIndex;\r\n    }\r\n  }\r\n  return Math.max(indexLeft, indexRight);\r\n}\r\n\r\nexport function lastLteIndex(\r\n  elementGetter: (index: number) => number,\r\n  elementCount: number,\r\n  num: number\r\n) {\r\n  let indexLeft = 0;\r\n  let indexRight = elementCount - 1;\r\n  const T = num;\r\n  let element;\r\n  while (indexLeft <= indexRight) {\r\n    const currentIndex = Math.floor((indexLeft + indexRight) / 2);\r\n    element = elementGetter(currentIndex);\r\n    if (element < T) {\r\n      indexLeft = currentIndex + 1;\r\n    } else if (element > T) {\r\n      indexRight = currentIndex - 1;\r\n    } else {\r\n      return currentIndex;\r\n    }\r\n  }\r\n  return Math.min(indexLeft, indexRight);\r\n}\r\n\r\nexport function rangeQuery(\r\n  elementGetterL: (index: number) => number,\r\n  elementGetterR: (index: number) => number,\r\n  elementCount: number,\r\n  start: number,\r\n  end: number\r\n) {\r\n  const firstGreaterThanNumber = firstGteIndex(elementGetterL, elementCount, start);\r\n  const lastLessThanNumber = lastLteIndex(elementGetterR, elementCount, end);\r\n  return {lastLessThanNumber, firstGreaterThanNumber};\r\n}\r\n\r\ndeclare global {\r\n  interface Array<T> {\r\n    remove(o: T): Array<T>;\r\n  }\r\n}\r\n\r\ndeclare global {\r\n  interface Array<T> {\r\n    groupBy<K>(keyGetter: (key: T) => K): Map<K, T[]>;\r\n  }\r\n}\r\n\r\nArray.prototype.remove = function (item) {\r\n  const index = this.indexOf(item);\r\n  if (index > -1) {\r\n    this.splice(index, 1);\r\n  }\r\n  return this;\r\n}\r\n\r\nArray.prototype.groupBy = function <T, K>(keyGetter: (key: T) => K) {\r\n  const map = new Map<K, T[]>();\r\n  this.forEach((item) => {\r\n    const key = keyGetter(item);\r\n    const collection = map.get(key);\r\n    if (!collection) {\r\n      map.set(key, [item]);\r\n    } else {\r\n      collection.push(item);\r\n    }\r\n  });\r\n  return map;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getDataTable(ctx: any) {\r\n  return getDataView(ctx).dataTable;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\nimport { IGrouper } from \"model/entities/types/IGrouper\";\r\n\r\nexport function getGrouper(ctx: any): IGrouper {\r\n  let dataView = getDataView(ctx);\r\n  if (!dataView) {\r\n    throw new Error(\"DataView is needed to determine what kind of grouper should be used\");\r\n  }\r\n  const serverSideGrouping = dataView.isLazyLoading\r\n  return serverSideGrouping\r\n    ? dataView.serverSideGrouper\r\n    : dataView.clientSideGrouper;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IGridDimensions } from \"../../../Components/ScreenElements/Table/types\";\r\nimport { SimpleScrollState } from \"../../../Components/ScreenElements/Table/SimpleScrollState\";\r\nimport { computed } from \"mobx\";\r\nimport { getDataView } from \"../../../../model/selectors/DataView/getDataView\";\r\nimport { rangeQuery } from \"../../../../utils/arrays\";\r\nimport { IDataTable } from \"../../../../model/entities/types/IDataTable\";\r\nimport { getDataTable } from \"../../../../model/selectors/DataView/getDataTable\";\r\nimport { getGrouper } from \"model/selectors/DataView/getGrouper\";\r\n\r\n\r\nexport interface IVisibleRowsMonitor {\r\n  firstIndex: number;\r\n  lastIndex: number;\r\n}\r\n\r\nexport class VisibleRowsMonitor implements IVisibleRowsMonitor {\r\n\r\n  ctx: any;\r\n  gridDimensions: IGridDimensions;\r\n  scrollState: SimpleScrollState;\r\n\r\n  constructor(ctx: any, gridDimensions: IGridDimensions, scrollState: SimpleScrollState) {\r\n    this.ctx = ctx;\r\n    this.gridDimensions = gridDimensions;\r\n    this.scrollState = scrollState;\r\n  }\r\n\r\n  @computed\r\n  get visibleRowsRange() {\r\n    const dataView = getDataView(this.ctx);\r\n    return rangeQuery(\r\n      (i) => this.gridDimensions.getRowBottom(i),\r\n      (i) => this.gridDimensions.getRowTop(i),\r\n      this.gridDimensions.rowCount,\r\n      this.scrollState.scrollTop,\r\n      this.scrollState.scrollTop + (dataView.contentBounds?.height ?? 0)\r\n    );\r\n  }\r\n\r\n  @computed\r\n  get firstIndex() {\r\n    return this.visibleRowsRange.firstGreaterThanNumber;\r\n  }\r\n\r\n  @computed\r\n  get lastIndex() {\r\n    return this.visibleRowsRange.lastLessThanNumber;\r\n  }\r\n}\r\n\r\nexport class OpenGroupVisibleRowsMonitor implements IVisibleRowsMonitor {\r\n\r\n  ctx: any;\r\n  gridDimensions: IGridDimensions;\r\n  scrollState: SimpleScrollState;\r\n  visibleRowsAll: VisibleRowsMonitor;\r\n  private dataTable: IDataTable;\r\n\r\n  constructor(ctx: any, gridDimensions: IGridDimensions, scrollState: SimpleScrollState) {\r\n    this.ctx = ctx;\r\n    this.gridDimensions = gridDimensions;\r\n    this.scrollState = scrollState;\r\n    this.visibleRowsAll = new VisibleRowsMonitor(ctx, gridDimensions, scrollState);\r\n    this.dataTable = getDataTable(ctx);\r\n  }\r\n\r\n  @computed\r\n  get firstIndex() {\r\n    const expandedGroupIndex = getGrouper(this.ctx).topLevelGroups\r\n      .findIndex(group => group.isExpanded);\r\n    return expandedGroupIndex > this.visibleRowsAll.firstIndex\r\n      ? 0\r\n      : this.visibleRowsAll.firstIndex - expandedGroupIndex;\r\n  }\r\n\r\n  @computed\r\n  get lastIndex() {\r\n    const expandedGroupIndex = getGrouper(this.ctx).topLevelGroups\r\n      .findIndex(group => group.isExpanded);\r\n    return this.visibleRowsAll.lastIndex - expandedGroupIndex;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\nimport { getFilterConfiguration } from \"./getFilterConfiguration\";\r\n\r\nexport function getUserFilterLookups(ctx: any): { [key: string]: string } | undefined {\r\n  const dataView = getDataView(ctx);\r\n  const filterConfiguration = getFilterConfiguration(dataView);\r\n  const lookupMap = filterConfiguration.activeFilters\r\n    .filter((filter) => filter.setting.isComplete && filter.setting.lookupId)\r\n    .reduce(function (lookupMap: { [key: string]: string }, filter) {\r\n      lookupMap[filter.propertyId] = filter.setting.lookupId!;\r\n      return lookupMap;\r\n    }, {});\r\n\r\n  return Object.keys(lookupMap).length !== 0 ? lookupMap : undefined;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IGridDimensions } from \"gui/Components/ScreenElements/Table/types\";\r\nimport { SimpleScrollState } from \"gui/Components/ScreenElements/Table/SimpleScrollState\";\r\nimport { action, autorun, computed, flow, IReactionDisposer, reaction } from \"mobx\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { getMenuItemId } from \"model/selectors/getMenuItemId\";\r\nimport { getSessionId } from \"model/selectors/getSessionId\";\r\nimport { getDataStructureEntityId } from \"model/selectors/DataView/getDataStructureEntityId\";\r\nimport { getColumnNamesToLoad } from \"model/selectors/DataView/getColumnNamesToLoad\";\r\nimport { joinWithAND } from \"model/entities/OrigamApiHelpers\";\r\nimport { getUserFilters } from \"model/selectors/DataView/getUserFilters\";\r\nimport { getUserOrdering } from \"model/selectors/DataView/getUserOrdering\";\r\nimport { IVisibleRowsMonitor, OpenGroupVisibleRowsMonitor } from \"./VisibleRowsMonitor\";\r\nimport { ScrollRowContainer } from \"model/entities/ScrollRowContainer\";\r\nimport { CancellablePromise } from \"mobx/lib/api/flow\";\r\nimport { getUserFilterLookups } from \"model/selectors/DataView/getUserFilterLookups\";\r\nimport { getDataView } from \"../../../../model/selectors/DataView/getDataView\";\r\n\r\nexport interface IInfiniteScrollLoaderData {\r\n  gridDimensions: IGridDimensions;\r\n  scrollState: SimpleScrollState;\r\n  ctx: any;\r\n  rowsContainer: ScrollRowContainer;\r\n  groupFilter: string | undefined;\r\n  visibleRowsMonitor: IVisibleRowsMonitor;\r\n}\r\n\r\nexport interface IInfiniteScrollLoader extends IInfiniteScrollLoaderData {\r\n  start(): () => void;\r\n\r\n  dispose(): void;\r\n\r\n  loadLastPage(): Generator;\r\n\r\n  loadFirstPage(): Generator;\r\n}\r\n\r\nexport const SCROLL_ROW_CHUNK = 1000;\r\nexport const MAX_CHUNKS_TO_HOLD = 10;\r\n\r\nexport class NullIScrollLoader implements IInfiniteScrollLoader {\r\n  ctx: any = null as any;\r\n  gridDimensions: IGridDimensions = null as any;\r\n  scrollState: SimpleScrollState = null as any;\r\n  rowsContainer: ScrollRowContainer = null as any;\r\n\r\n  start(): () => void {\r\n    return () => {\r\n    };\r\n  }\r\n\r\n  dispose(): void {\r\n  }\r\n\r\n  groupFilter: string | undefined;\r\n  visibleRowsMonitor: IVisibleRowsMonitor = null as any;\r\n\r\n  *loadLastPage(): Generator {\r\n  }\r\n\r\n  *loadFirstPage(): Generator {\r\n  }\r\n}\r\n\r\nexport class InfiniteScrollLoader implements IInfiniteScrollLoader {\r\n  $type_InfiniteScrollLoader: 1 = 1;\r\n  private debugDisposer: IReactionDisposer | undefined;\r\n  private reactionDisposer: IReactionDisposer | undefined;\r\n  visibleRowsMonitor: IVisibleRowsMonitor;\r\n\r\n  constructor(data: IInfiniteScrollLoaderData) {\r\n    Object.assign(this, data);\r\n    this.rowsContainer.registerResetListener(() => this.handleRowContainerReset());\r\n    this.visibleRowsMonitor = new OpenGroupVisibleRowsMonitor(this.ctx, this.gridDimensions, this.scrollState);\r\n    this.requestProcessor.start();\r\n  }\r\n\r\n  *loadLastPage(): any {\r\n    const api = getApi(this.ctx);\r\n    const formScreenLifecycle = getFormScreenLifecycle(this.ctx);\r\n    let dataView = getDataView(this.ctx);\r\n    yield formScreenLifecycle.updateTotalRowCount(dataView);\r\n    if (dataView.totalRowCount === undefined) {\r\n      return;\r\n    }\r\n    let lastStartOffset\r\n    if (dataView.totalRowCount > SCROLL_ROW_CHUNK) {\r\n      const rowsInLastChunk = (dataView.totalRowCount! % SCROLL_ROW_CHUNK) + SCROLL_ROW_CHUNK;\r\n      lastStartOffset = dataView.totalRowCount! - rowsInLastChunk;\r\n    } else {\r\n      lastStartOffset = 0;\r\n    }\r\n\r\n    const data = yield api.getRows({\r\n      MenuId: getMenuItemId(this.ctx),\r\n      SessionFormIdentifier: getSessionId(formScreenLifecycle),\r\n      DataStructureEntityId: getDataStructureEntityId(this.ctx),\r\n      Filter: this.getFilters(),\r\n      FilterLookups: getUserFilterLookups(this.ctx),\r\n      Ordering: getUserOrdering(this.ctx),\r\n      RowLimit: SCROLL_ROW_CHUNK * 2,\r\n      RowOffset: lastStartOffset,\r\n      Parameters: {},\r\n      MasterRowId: undefined,\r\n      ColumnNames: getColumnNamesToLoad(this.ctx),\r\n    })\r\n    this.rowsContainer.set(data, lastStartOffset, true)\r\n\r\n    this.reactionDisposer?.();\r\n    setTimeout(() => {\r\n      const newDistanceToStart = this.distanceToStart + SCROLL_ROW_CHUNK\r\n      const newTop = this.gridDimensions.getRowTop(newDistanceToStart);\r\n      this.scrollState.scrollTo({scrollTop: newTop});\r\n      this.start();\r\n    });\r\n  }\r\n\r\n  *loadFirstPage(): any {\r\n    if (this.rowsContainer.isFirstRowLoaded) {\r\n      return\r\n    }\r\n    const api = getApi(this.ctx);\r\n    const formScreenLifecycle = getFormScreenLifecycle(this.ctx);\r\n    const data = yield api.getRows({\r\n      MenuId: getMenuItemId(this.ctx),\r\n      SessionFormIdentifier: getSessionId(formScreenLifecycle),\r\n      DataStructureEntityId: getDataStructureEntityId(this.ctx),\r\n      Filter: this.getFilters(),\r\n      FilterLookups: getUserFilterLookups(this.ctx),\r\n      Ordering: getUserOrdering(this.ctx),\r\n      RowLimit: SCROLL_ROW_CHUNK,\r\n      RowOffset: 0,\r\n      Parameters: {},\r\n      MasterRowId: undefined,\r\n      ColumnNames: getColumnNamesToLoad(this.ctx),\r\n    })\r\n    this.rowsContainer.set(data)\r\n\r\n    this.reactionDisposer?.();\r\n    setTimeout(() => {\r\n      const newTop = this.gridDimensions.getRowTop(0);\r\n      this.scrollState.scrollTo({scrollTop: newTop});\r\n      this.start();\r\n    });\r\n  }\r\n\r\n  groupFilter: string | undefined;\r\n  lastRequestedStartOffset: number = 0;\r\n  lastRequestedEndOffset: number = 0;\r\n  gridDimensions: IGridDimensions = null as any;\r\n  scrollState: SimpleScrollState = null as any;\r\n  ctx: any = null as any;\r\n  rowsContainer: ScrollRowContainer = null as any;\r\n  requestProcessor: FlowQueueProcessor = new FlowQueueProcessor(100, 100);\r\n\r\n  @computed\r\n  get distanceToStart() {\r\n    return this.visibleRowsMonitor.firstIndex;\r\n  }\r\n\r\n  @computed\r\n  get distanceToEnd() {\r\n    return this.rowsContainer.rows.length - this.visibleRowsMonitor.lastIndex;\r\n  }\r\n\r\n  @computed\r\n  get headLoadingNeeded() {\r\n    return this.distanceToStart <= SCROLL_ROW_CHUNK * 0.9 && !this.rowsContainer.isFirstRowLoaded;\r\n  }\r\n\r\n  @computed\r\n  get tailLoadingNeeded() {\r\n    return this.distanceToEnd <= SCROLL_ROW_CHUNK * 0.9 && !this.rowsContainer.isLastRowLoaded;\r\n  }\r\n\r\n  @computed\r\n  get incrementLoadingNeeded() {\r\n    return this.headLoadingNeeded || this.tailLoadingNeeded;\r\n  }\r\n\r\n  @action.bound\r\n  public start() {\r\n    this.debugDisposer = autorun(() => {\r\n      //console.log(\"distanceToStart: \" + this.distanceToStart);\r\n      //console.log(\"distanceToEnd: \" + this.distanceToEnd);\r\n      //console.log(\"headLoadingNeeded(): \" + this.headLoadingNeeded);\r\n      //console.log(\"tailLoadingNeeded(): \" + this.tailLoadingNeeded);\r\n    });\r\n    this.reactionDisposer = reaction(\r\n      () => {\r\n        return [\r\n          this.visibleRowsMonitor.firstIndex,\r\n          this.visibleRowsMonitor.lastIndex,\r\n          this.headLoadingNeeded,\r\n          this.tailLoadingNeeded\r\n        ];\r\n      },\r\n      () => {\r\n        if (this.headLoadingNeeded) {\r\n          this.requestProcessor.enqueue(() => this.prependLines());\r\n        }\r\n        if (this.tailLoadingNeeded) {\r\n          this.requestProcessor.enqueue(() => this.appendLines());\r\n        }\r\n      }\r\n    );\r\n    return this.reactionDisposer;\r\n  }\r\n\r\n  prependListeners: ((data: any[][]) => void)[] = [];\r\n\r\n  registerPrependListener(listener: (data: any[][]) => void): void {\r\n    this.prependListeners.push(listener);\r\n  }\r\n\r\n  appendListeners: ((data: any[][]) => void)[] = [];\r\n\r\n  registerAppendListener(listener: (data: any[][]) => void): void {\r\n    this.appendListeners.push(listener);\r\n  }\r\n\r\n  handleRowContainerReset() {\r\n    this.lastRequestedStartOffset = 0;\r\n    this.lastRequestedEndOffset = 0;\r\n  }\r\n\r\n  getFilters() {\r\n    const filters = [];\r\n    if (this.groupFilter) {\r\n      filters.push(this.groupFilter);\r\n    }\r\n    const userFilters = getUserFilters({ctx: this.ctx});\r\n    if (userFilters) {\r\n      filters.push(userFilters);\r\n    }\r\n    return joinWithAND(filters);\r\n  }\r\n\r\n  private appendLines = flow(function*(\r\n    this: InfiniteScrollLoader\r\n  ) {\r\n    if (!this.tailLoadingNeeded) {\r\n      return;\r\n    }\r\n    if (this.lastRequestedEndOffset === this.rowsContainer.nextEndOffset) {\r\n      return;\r\n    }\r\n    this.lastRequestedEndOffset = this.rowsContainer.nextEndOffset;\r\n    this.lastRequestedStartOffset = -1;\r\n\r\n    const api = getApi(this.ctx);\r\n    const formScreenLifecycle = getFormScreenLifecycle(this.ctx);\r\n\r\n    const data = yield api.getRows({\r\n      MenuId: getMenuItemId(this.ctx),\r\n      SessionFormIdentifier: getSessionId(formScreenLifecycle),\r\n      DataStructureEntityId: getDataStructureEntityId(this.ctx),\r\n      Filter: this.getFilters(),\r\n      FilterLookups: getUserFilterLookups(this.ctx),\r\n      Ordering: getUserOrdering(this.ctx),\r\n      RowLimit: SCROLL_ROW_CHUNK,\r\n      MasterRowId: undefined,\r\n      Parameters: {},\r\n      RowOffset: this.rowsContainer.nextEndOffset,\r\n      ColumnNames: getColumnNamesToLoad(this.ctx),\r\n    })\r\n    const oldDistanceToStart = this.distanceToStart;\r\n    this.rowsContainer.appendRecords(data)\r\n    if (this.rowsContainer.isFull && !this.rowsContainer.isLastRowLoaded) {\r\n      const newDistanceToStart = oldDistanceToStart - SCROLL_ROW_CHUNK\r\n      const newTop = this.gridDimensions.getRowTop(newDistanceToStart);\r\n      this.scrollState.scrollTo({scrollTop: newTop});\r\n    }\r\n    this.appendListeners.forEach(listener => listener(data));\r\n  });\r\n\r\n\r\n  private prependLines = flow(function*(\r\n    this: InfiniteScrollLoader\r\n  ) {\r\n    if (!this.headLoadingNeeded) {\r\n      return;\r\n    }\r\n    const nextStartOffset = this.rowsContainer.nextStartOffset;\r\n    if (this.lastRequestedStartOffset === nextStartOffset || nextStartOffset < 0) {\r\n      return;\r\n    }\r\n    this.lastRequestedStartOffset = nextStartOffset;\r\n    this.lastRequestedEndOffset = 0;\r\n\r\n    const api = getApi(this.ctx);\r\n    const formScreenLifecycle = getFormScreenLifecycle(this.ctx);\r\n    const data = yield api.getRows({\r\n      MenuId: getMenuItemId(this.ctx),\r\n      SessionFormIdentifier: getSessionId(formScreenLifecycle),\r\n      DataStructureEntityId: getDataStructureEntityId(this.ctx),\r\n      Filter: this.getFilters(),\r\n      FilterLookups: getUserFilterLookups(this.ctx),\r\n      Ordering: getUserOrdering(this.ctx),\r\n      RowLimit: SCROLL_ROW_CHUNK,\r\n      RowOffset: nextStartOffset,\r\n      Parameters: {},\r\n      MasterRowId: undefined,\r\n      ColumnNames: getColumnNamesToLoad(this.ctx),\r\n    })\r\n    const oldDistanceToStart = this.distanceToStart;\r\n    this.rowsContainer.prependRecords(data);\r\n    if (!this.rowsContainer.isFirstRowLoaded) {\r\n      const newDistanceToStart = oldDistanceToStart + SCROLL_ROW_CHUNK\r\n      const newTop = this.gridDimensions.getRowTop(newDistanceToStart);\r\n      this.scrollState.scrollTo({scrollTop: newTop});\r\n    }\r\n    this.prependListeners.forEach(listener => listener(data));\r\n  });\r\n\r\n  dispose(): void {\r\n    if (this.reactionDisposer) {\r\n      this.reactionDisposer();\r\n    }\r\n    if (this.debugDisposer) {\r\n      this.debugDisposer();\r\n    }\r\n    this.requestProcessor.dispose();\r\n    this.prependListeners.length = 0;\r\n    this.appendListeners.length = 0;\r\n  }\r\n}\r\n\r\n// A better implementation:\r\n// https://medium.com/@karenmarkosyan/how-to-manage-promises-into-dynamic-queue-with-vanilla-javascript-9d0d1f8d4df5\r\nclass FlowQueueProcessor {\r\n\r\n  private flowQueue: (() => CancellablePromise<void>)[] = [];\r\n  private stopRequested: boolean = false;\r\n  private readonly delayBetweenCallsMillis: number;\r\n  private readonly mainLoopDelayMills: number;\r\n  private timeoutHandle: any;\r\n\r\n  constructor(mainLoopDelayMilliseconds: number, delayBetweenCallsMilliseconds: number) {\r\n    this.mainLoopDelayMills = mainLoopDelayMilliseconds;\r\n    this.delayBetweenCallsMillis = delayBetweenCallsMilliseconds;\r\n  }\r\n\r\n  private sleep(milliseconds: number) {\r\n    return new Promise(resolve => {\r\n      this.timeoutHandle = setTimeout(resolve, milliseconds);\r\n    });\r\n  }\r\n\r\n  enqueue(flow: () => CancellablePromise<void>) {\r\n    this.flowQueue.push(flow);\r\n  }\r\n\r\n  dispose() {\r\n    this.stopRequested = true;\r\n    clearTimeout(this.timeoutHandle);\r\n  }\r\n\r\n  async start() {\r\n    while (true) {\r\n      while (this.flowQueue.length > 0) {\r\n        const currentFlow = this.flowQueue.shift()!;\r\n        await currentFlow();\r\n        await this.sleep(this.delayBetweenCallsMillis);\r\n      }\r\n      await this.sleep(this.mainLoopDelayMills);\r\n      if (this.stopRequested) {\r\n        return;\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\nexport const isInfiniteScrollLoader = (o: any): o is InfiniteScrollLoader =>\r\n  o?.$type_InfiniteScrollLoader;\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport _ from \"lodash\";\r\nimport { action, computed, createAtom, flow, IAtom, observable } from \"mobx\";\r\nimport { getEntity } from \"model/selectors/DataView/getEntity\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { getSessionId } from \"model/selectors/getSessionId\";\r\nimport { flashColor2htmlColor } from \"utils/flashColorFormat\";\r\nimport { IRowState, IRowStateColumnItem, IRowStateData, IRowStateItem } from \"./types/IRowState\";\r\nimport { FlowBusyMonitor } from \"../../utils/flow\";\r\nimport { handleError } from \"model/actions/handleError\";\r\n\r\nexport enum IIdState {\r\n  LOADING = \"LOADING\",\r\n  ERROR = \"ERROR\"\r\n}\r\n\r\nexport class RowState implements IRowState {\r\n  $type_IRowState: 1 = 1;\r\n  suppressWorkingStatus: boolean = false;\r\n\r\n  constructor(data: IRowStateData) {\r\n    Object.assign(this, data);\r\n  }\r\n\r\n  monitor: FlowBusyMonitor = new FlowBusyMonitor();\r\n\r\n  get isWorking() {\r\n    return this.monitor.isWorkingDelayed;\r\n  }\r\n\r\n  @observable firstLoadingPerformed = false;\r\n  @observable temporaryContainersValues?: Map<string, RowStateContainer>;\r\n  @computed get mayCauseFlicker() {\r\n    return !this.firstLoadingPerformed;\r\n  }\r\n\r\n  containers: Map<string, RowStateContainer> = new Map<string, RowStateContainer>();\r\n\r\n  @observable\r\n  isSomethingLoading = false;\r\n\r\n  triggerLoadImm = flow(\r\n    function*(this: RowState): any {\r\n      if (this.isSomethingLoading) {\r\n        return;\r\n      }\r\n      let containersToLoad: Map<string, RowStateContainer> = new Map();\r\n      let reportBusyStatus = true;\r\n      try {\r\n        while (true) {\r\n          try {\r\n            for (let container of this.containers.values()) {\r\n              if(container.rowId && !container.isValid && !container.processingSate){\r\n                containersToLoad.set(container.rowId, container);\r\n              }\r\n            }\r\n            reportBusyStatus = Array.from(containersToLoad.values()).every(container => !container.suppressWorkingStatus);\r\n            if(reportBusyStatus){\r\n              this.monitor.inFlow++;\r\n            }\r\n            if (containersToLoad.size === 0) {\r\n              break;\r\n            }\r\n            for (let container of containersToLoad.values()) {\r\n              container.processingSate = IIdState.LOADING;\r\n            }\r\n            this.isSomethingLoading = true;\r\n            const api = getApi(this);\r\n            const states = yield api.getRowStates({\r\n              SessionFormIdentifier: getSessionId(this),\r\n              Entity: getEntity(this),\r\n              Ids: Array.from(containersToLoad.values()).map(container => container.rowId)\r\n            });\r\n            this.isSomethingLoading = false;\r\n            this.firstLoadingPerformed = true;\r\n            for (let state of states) {\r\n              this.putValue(state);\r\n              this.containers.get(state.id)!.processingSate = undefined;\r\n            }\r\n          } catch (error) {\r\n            this.isSomethingLoading = false;\r\n            this.firstLoadingPerformed = true;\r\n            for (let container of containersToLoad.values()) {\r\n              container.processingSate = IIdState.ERROR;\r\n            }\r\n            yield* handleError(this)(error);\r\n          } finally {\r\n            if(reportBusyStatus){\r\n              this.monitor.inFlow--;\r\n            }\r\n            containersToLoad.forEach(container => container.suppressWorkingStatus = false);\r\n            containersToLoad.clear();\r\n          }\r\n        }\r\n      } finally {\r\n        // After everything got loaded, here we switch back to provide the values just loaded.\r\n        this.temporaryContainersValues = undefined;\r\n      }\r\n    }.bind(this)\r\n  );\r\n\r\n  triggerLoad = _.debounce(this.triggerLoadImm, 666);\r\n\r\n  getValue(rowId: string) {\r\n    if (!this.containers.has(rowId)) {\r\n      this.containers.set(rowId, new RowStateContainer(rowId));\r\n    }\r\n    let container = this.containers.get(rowId)!;\r\n    if (!container.atom) {\r\n      container.suppressWorkingStatus = this.suppressWorkingStatus;\r\n      container.atom = createAtom(\r\n        `RowState atom [${rowId}]`,\r\n        () =>\r\n          requestAnimationFrame(() => {\r\n            this.triggerLoad();\r\n          }),\r\n        () => {\r\n        }\r\n      )\r\n    }\r\n    container.atom.reportObserved?.();\r\n    if (this.temporaryContainersValues && this.temporaryContainersValues.has(rowId)) {\r\n      return this.temporaryContainersValues.get(rowId)?.rowStateItem;\r\n    } else {\r\n      return this.containers.get(rowId)?.rowStateItem;\r\n    }\r\n  }\r\n\r\n  async loadValues(rowIds: string[]) {\r\n    for (const rowId of rowIds) {\r\n      if (!this.containers.has(rowId)) {\r\n        this.containers.set(rowId, new RowStateContainer(rowId));\r\n      }\r\n    }\r\n    await this.triggerLoadImm();\r\n  }\r\n\r\n  hasValue(rowId: string): boolean {\r\n    return this.containers.has(rowId);\r\n  }\r\n\r\n  @action.bound\r\n  putValue(state: any) {\r\n    let rowStateItem = new RowStateItem(\r\n      state.id,\r\n      state.allowCreate,\r\n      state.allowDelete,\r\n      flashColor2htmlColor(state.foregroundColor),\r\n      flashColor2htmlColor(state.backgroundColor),\r\n      new Map(\r\n        state.columns.map((column: any) => {\r\n          const rs = new RowStateColumnItem(\r\n            column.name,\r\n            column.dynamicLabel,\r\n            flashColor2htmlColor(column.foregroundColor),\r\n            flashColor2htmlColor(column.backgroundColor),\r\n            column.allowRead,\r\n            column.allowUpdate\r\n          );\r\n          return [column.name, rs];\r\n        })\r\n      ),\r\n      new Set(state.disabledActions),\r\n      state.relations\r\n    );\r\n    if (!this.containers.has(state.id)) {\r\n      this.containers.set(state.id, new RowStateContainer(state.id));\r\n    }\r\n    const container = this.containers.get(state.id);\r\n    container!.rowStateItem = rowStateItem;\r\n    container!.isValid = true;\r\n    this.firstLoadingPerformed = true;\r\n  }\r\n\r\n  @action.bound reload() {\r\n   // Store the rest of values to suppress flickering while reloading.\r\n    this.temporaryContainersValues = new Map(this.containers.entries());\r\n    // This actually causes reloading of the values (by views calling getValue(...) )\r\n    for (let rowStateContainer of this.containers.values()) {\r\n      rowStateContainer.atom?.onBecomeUnobservedListeners?.clear();\r\n      rowStateContainer.atom?.onBecomeObservedListeners?.clear();\r\n      rowStateContainer.atom = undefined;\r\n      rowStateContainer.isValid = false;\r\n      rowStateContainer.processingSate = undefined;\r\n    }\r\n  }\r\n\r\n  @action.bound clearAll() {\r\n    for (let rowStateContainer of this.containers.values()) {\r\n      rowStateContainer.atom?.onBecomeUnobservedListeners?.clear();\r\n      rowStateContainer.atom?.onBecomeObservedListeners?.clear();\r\n      rowStateContainer.atom = undefined;\r\n      rowStateContainer.isValid = false;\r\n      rowStateContainer.processingSate = undefined;\r\n    }\r\n    this.firstLoadingPerformed = false;\r\n    this.temporaryContainersValues = undefined;\r\n    // TODO: Wait when something is currently loading.\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n\r\nexport class RowStateItem implements IRowStateItem {\r\n  constructor(\r\n    public id: string,\r\n    public allowCreate: boolean,\r\n    public allowDelete: boolean,\r\n    public foregroundColor: string | undefined,\r\n    public backgroundColor: string | undefined,\r\n    public columns: Map<string, IRowStateColumnItem>,\r\n    public disabledActions: Set<string>,\r\n    public relations: any[]\r\n  ) {\r\n  }\r\n}\r\n\r\nexport class RowStateColumnItem implements IRowStateColumnItem {\r\n  constructor(\r\n    public name: string,\r\n    public dynamicLabel: string | undefined | null,\r\n    public foregroundColor: string | undefined,\r\n    public backgroundColor: string | undefined,\r\n    public allowRead: boolean,\r\n    public allowUpdate: boolean\r\n  ) {\r\n  }\r\n}\r\n\r\nclass RowStateContainer {\r\n  public rowId: string;\r\n\r\n  @observable\r\n  public rowStateItem: IRowStateItem | undefined;\r\n\r\n  @observable\r\n  public isValid: boolean = false;\r\n\r\n  public processingSate: IIdState | undefined;\r\n  public suppressWorkingStatus: boolean = false;\r\n\r\n  constructor(\r\n    rowId: string,\r\n    public atom?: IAtom\r\n  ) {\r\n    this.rowId = rowId;\r\n  }\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { observable } from \"mobx\";\r\n\r\nexport const busyDelayMillis = 500;\r\n\r\n// Delays setting \"isWorkingDelayed\" property by \"busyDelayMillis\" after \"inFlow\" counter is incremented from 0 to 1\r\nexport class FlowBusyMonitor {\r\n  @observable _inFlow = 0;\r\n  @observable isWorkingDelayed = false;\r\n  @observable isWorking = false;\r\n  private flowLeft = false;\r\n\r\n  set inFlow(value: number) {\r\n    if (value < 0) {\r\n      value = 0;\r\n    }\r\n    if (this._inFlow === 0 && value === 1) {\r\n      this.flowLeft = false;\r\n\r\n      this.isWorking = true\r\n      setTimeout(() => {\r\n        if (!this.flowLeft) {\r\n          this.isWorkingDelayed = true\r\n        }\r\n      }, busyDelayMillis);\r\n    } else if (this._inFlow === 1 && value === 0) {\r\n      this.isWorkingDelayed = false;\r\n      this.isWorking = false;\r\n      this.flowLeft = true;\r\n    }\r\n    this._inFlow = value;\r\n  }\r\n\r\n  get inFlow() {\r\n    return this._inFlow;\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport Axios from \"axios\";\r\nimport { action, comparer, flow, reaction } from \"mobx\";\r\nimport { navigateAsChild } from \"model/actions/DataView/navigateAsChild\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getBindingChildren } from \"model/selectors/DataView/getBindingChildren\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { getEntity } from \"model/selectors/DataView/getEntity\";\r\nimport { getIsBindingParent } from \"model/selectors/DataView/getIsBindingParent\";\r\nimport { getIsBindingRoot } from \"model/selectors/DataView/getIsBindingRoot\";\r\nimport { getMasterRowId } from \"model/selectors/DataView/getMasterRowId\";\r\nimport { getParentRowId } from \"model/selectors/DataView/getParentRowId\";\r\nimport { isLazyLoading } from \"model/selectors/isLazyLoading\";\r\nimport { getSessionId } from \"model/selectors/getSessionId\";\r\nimport { getApi } from \"../../selectors/getApi\";\r\nimport { getSelectedRowId } from \"../../selectors/TablePanelView/getSelectedRowId\";\r\nimport { IDataViewLifecycle } from \"./types/IDataViewLifecycle\";\r\nimport { processCRUDResult } from \"model/actions/DataLoading/processCRUDResult\";\r\nimport { IDataView } from \"../types/IDataView\";\r\nimport { getMenuItemId } from \"../../selectors/getMenuItemId\";\r\nimport { getDataStructureEntityId } from \"../../selectors/DataView/getDataStructureEntityId\";\r\nimport { SCROLL_ROW_CHUNK } from \"../../../gui/Workbench/ScreenArea/TableView/InfiniteScrollLoader\";\r\nimport { getColumnNamesToLoad } from \"../../selectors/DataView/getColumnNamesToLoad\";\r\nimport { joinWithAND, toFilterItem } from \"../OrigamApiHelpers\";\r\nimport { FlowBusyMonitor } from \"../../../utils/flow\";\r\nimport { getFormScreen } from \"model/selectors/FormScreen/getFormScreen\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { getUserFilterLookups } from \"model/selectors/DataView/getUserFilterLookups\";\r\n\r\nexport class DataViewLifecycle implements IDataViewLifecycle {\r\n  $type_IDataViewLifecycle: 1 = 1;\r\n  monitor: FlowBusyMonitor = new FlowBusyMonitor();\r\n\r\n  get isWorking() {\r\n    return this.monitor.isWorkingDelayed;\r\n  }\r\n\r\n  disposers: any[] = [];\r\n\r\n  @action.bound\r\n  start(): void {\r\n    if (isLazyLoading(this)) {\r\n      this.disposers.push(this.startSelectedRowReaction());\r\n    }\r\n  }\r\n\r\n  onSelectedRowIdChangeImm = flow(\r\n    function*(this: DataViewLifecycle) {\r\n      const dataView = getDataView(this);\r\n      try {\r\n        this.monitor.inFlow++;\r\n        if (getIsBindingRoot(this)) {\r\n          if (!getFormScreenLifecycle(this).rowSelectedReactionsDisabled(dataView)) {\r\n            yield*this.changeMasterRow();\r\n          }\r\n          yield*this.navigateChildren();\r\n        } else if (getIsBindingParent(this)) {\r\n          yield*this.navigateChildren();\r\n        }\r\n      } catch (e) {\r\n        // TODO: Move this method to action handler file?\r\n        yield*handleError(this)(e);\r\n        throw e;\r\n      } finally {\r\n        this.monitor.inFlow--;\r\n      }\r\n    }.bind(this)\r\n  );\r\n\r\n  _selectedRowReactionDisposer: any;\r\n\r\n  @action.bound\r\n  async startSelectedRowReaction(fireImmediately?: boolean) {\r\n    if (fireImmediately) {\r\n      await this.onSelectedRowIdChangeImm();\r\n    }\r\n\r\n    const self = this;\r\n    return (this._selectedRowReactionDisposer = reaction(\r\n      () => {\r\n        return getSelectedRowId(this);\r\n      },\r\n      () => self.onSelectedRowIdChangeImm(),\r\n      {equals: comparer.structural}\r\n    ));\r\n  }\r\n\r\n  async runRecordChangedReaction(action?: () => Generator) {\r\n    let wasRunning = false;\r\n    try {\r\n      wasRunning = this.stopSelectedRowReaction();\r\n      if (action) {\r\n        await flow(action)();\r\n      }\r\n    } finally {\r\n      if (wasRunning) {\r\n        await this.startSelectedRowReaction(true);\r\n      }\r\n    }\r\n  }\r\n\r\n  @action.bound stopSelectedRowReaction() {\r\n    if (this._selectedRowReactionDisposer) {\r\n      this._selectedRowReactionDisposer();\r\n      this._selectedRowReactionDisposer = undefined;\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  *navigateAsChild(rows?: any[]) {\r\n    if (rows !== undefined && rows !== null) {\r\n      const dataView = getDataView(this);\r\n      yield dataView.setRecords(rows);\r\n      dataView.selectFirstRow();\r\n    } else {\r\n      yield*this.loadGetData();\r\n    }\r\n  }\r\n\r\n  changeMasterRowCanceller: any;\r\n\r\n  *changeMasterRow(): any {\r\n    try {\r\n      this.monitor.inFlow++;\r\n      const api = getApi(this);\r\n      this.changeMasterRowCanceller && this.changeMasterRowCanceller();\r\n      this.changeMasterRowCanceller = api.createCanceller();\r\n      const crudResult = yield api.setMasterRecord(\r\n        {\r\n          SessionFormIdentifier: getSessionId(this),\r\n          Entity: getEntity(this),\r\n          RowId: getSelectedRowId(this)!\r\n        },\r\n        this.changeMasterRowCanceller\r\n      );\r\n      yield*processCRUDResult(this, crudResult);\r\n      getFormScreen(this).clearDataCache();\r\n    } catch (error) {\r\n      if (Axios.isCancel(error)) {\r\n        return;\r\n      }\r\n      /*console.error(error);\r\n      yield errDialogPromise(this)(error);*/\r\n      throw error;\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  buildDetailFilter(dataView: IDataView) {\r\n    const filterItems = [];\r\n    for (let binding of dataView.parentBindings) {\r\n      const selectedRow = binding.parentDataView.selectedRow;\r\n      if (!selectedRow) {\r\n        continue;\r\n      }\r\n      for (let bindingPair of binding.bindingPairs) {\r\n        const parentDsField = binding.parentDataView.dataSource.getFieldByName(\r\n          bindingPair.parentPropertyId\r\n        );\r\n        if (!parentDsField) {\r\n          continue;\r\n        }\r\n        const parentValue = binding.parentDataView.dataTable.getCellValueByDataSourceField(\r\n          selectedRow,\r\n          parentDsField\r\n        );\r\n        const childDsField = binding.childDataView.dataSource.getFieldByName(\r\n          bindingPair.childPropertyId\r\n        );\r\n        if (!childDsField) {\r\n          continue;\r\n        }\r\n        filterItems.push(toFilterItem(childDsField.name, \"eq\", parentValue));\r\n      }\r\n    }\r\n    return joinWithAND(filterItems);\r\n  }\r\n\r\n\r\n  *loadGetData(): any {\r\n    try {\r\n      this.monitor.inFlow++;\r\n      const dataView = getDataView(this);\r\n      const api = getApi(this);\r\n      let data;\r\n      if (dataView.isRootEntity && !dataView.isRootGrid && isLazyLoading(this)) {\r\n        if (dataView.parentBindings.length === 1) {\r\n          data = [dataView.parentBindings[0].parentDataView.selectedRow];\r\n        } else {\r\n          data = yield api.getRows({\r\n            MenuId: getMenuItemId(dataView),\r\n            SessionFormIdentifier: getSessionId(this),\r\n            DataStructureEntityId: getDataStructureEntityId(dataView),\r\n            Filter: this.buildDetailFilter(dataView),\r\n            FilterLookups: getUserFilterLookups(dataView),\r\n            Ordering: [],\r\n            RowLimit: SCROLL_ROW_CHUNK,\r\n            MasterRowId: undefined,\r\n            RowOffset: 0,\r\n            Parameters: {},\r\n            ColumnNames: getColumnNamesToLoad(dataView),\r\n          });\r\n        }\r\n      } else {\r\n        const parentRowId = getParentRowId(this);\r\n        const masterRowId = getMasterRowId(this);\r\n        data = !parentRowId || !masterRowId\r\n          ? []\r\n          : yield getFormScreen(this).getData(getEntity(this), dataView.modelInstanceId, parentRowId, masterRowId);\r\n      }\r\n      yield dataView.setRecords(data);\r\n      dataView.selectFirstRow();\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  *navigateChildren(): Generator<any, any> {\r\n    try {\r\n      this.monitor.inFlow++;\r\n      const entity = getEntity(this);\r\n      const dataView = getDataView(this);\r\n      yield Promise.all(\r\n        getBindingChildren(this).map(childDataView =>\r\n          flow(function*() {\r\n            try {\r\n              const childEntity = getEntity(childDataView);\r\n              if (childEntity === entity && childDataView.isPreloaded) {\r\n                yield*navigateAsChild(childDataView, dataView.dataTable.allRows)();\r\n              } else {\r\n                yield*navigateAsChild(childDataView)();\r\n              }\r\n            } catch (e) {\r\n              yield*handleError(childDataView)(e);\r\n            }\r\n          })()\r\n        )\r\n      );\r\n      /*for (let bch of getBindingChildren(this)) {\r\n        yield navigateAsChild(bch)();\r\n      }*/\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getIsBindingParent(ctx: any) {\r\n  return getDataView(ctx).isBindingParent;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport _ from \"lodash\";\r\nimport { action, computed, flow, observable, when } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { ILookupLoader } from \"./types/ILookupLoader\";\r\n\r\nexport class LookupLoader implements ILookupLoader {\r\n  collectedQuery: {\r\n    LookupId: string;\r\n    MenuId: string | undefined;\r\n    LabelIds: string[];\r\n  }[] = [];\r\n\r\n  @observable loadingScheduled = true;\r\n  @observable loadingDone = false;\r\n  @observable loadingError: undefined | any;\r\n  willLoad = false;\r\n  isLoading = false;\r\n\r\n  loadedItems: { [key: string]: { [key: string]: any } } = {};\r\n  waitingRequesters = 0;\r\n\r\n  @observable inFlow = 0;\r\n\r\n  @computed get isWorking() {\r\n    return this.inFlow > 0;\r\n  }\r\n\r\n  async getLookupLabels(query: {\r\n    LookupId: string;\r\n    MenuId: string | undefined;\r\n    LabelIds: string[];\r\n  }) {\r\n    try {\r\n      const existingItem = this.collectedQuery.find(\r\n        (q) => q.LookupId === query.LookupId && q.MenuId === query.MenuId\r\n      );\r\n      if (existingItem) {\r\n        const existingIds = new Set(existingItem.LabelIds);\r\n        query.LabelIds.forEach((id) => existingIds.add(id));\r\n        existingItem.LabelIds = Array.from(existingIds);\r\n      } else {\r\n        this.collectedQuery.push(query);\r\n      }\r\n      this.ensureScheduleLoad();\r\n      this.waitingRequesters++;\r\n      await when(() => this.loadingDone || this.loadingError);\r\n      if (this.loadingError) {\r\n        throw this.loadingError;\r\n      }\r\n      const result = this.loadedItems[query.LookupId] || {};\r\n      return result;\r\n    } finally {\r\n      this.waitingRequesters--;\r\n      if (this.waitingRequesters === 0) {\r\n        this.loadedItems = {};\r\n        this.loadingError = undefined;\r\n      }\r\n    }\r\n  }\r\n\r\n  async triggerLoadImm() {\r\n    const self = this;\r\n    flow(function*() {\r\n      if (self.isLoading) {\r\n        return;\r\n      }\r\n      self.isLoading = true;\r\n      try {\r\n        self.inFlow++;\r\n        while (self.willLoad) {\r\n          const api = getApi(self);\r\n          self.willLoad = false;\r\n          const query = self.collectedQuery;\r\n          self.collectedQuery = [];\r\n          self.loadedItems = {\r\n            ...self.loadedItems,\r\n            ...(yield api.getLookupLabelsEx(query)),\r\n          };\r\n          if (!self.willLoad) {\r\n            self.loadingDone = true;\r\n          }\r\n        }\r\n      } catch (error) {\r\n        // TODO: Better error handling.\r\n        // TODO: Refactor to use generators\r\n        yield*handleError(self)(error);\r\n      } finally {\r\n        self.inFlow--;\r\n        self.isLoading = false;\r\n      }\r\n    })();\r\n  }\r\n\r\n  triggerLoad = _.throttle(this.triggerLoadImm.bind(this), 100);\r\n\r\n  @action.bound ensureScheduleLoad() {\r\n    this.loadingDone = false;\r\n    this.willLoad = true;\r\n    this.triggerLoad();\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport function flashColor2htmlColor(flashColor: number) {\r\n  if (flashColor === 0 || flashColor === null || flashColor === undefined) {\r\n    return undefined;\r\n  }\r\n  return (\r\n    \"#\" +\r\n    (flashColor < 0 ? flashColor + 0xffffffff + 1 : flashColor)\r\n      .toString(16)\r\n      .slice(-6)\r\n      .toUpperCase()\r\n      .padStart(6, \"0\")\r\n  );\r\n}\r\n\r\nexport function htmlColor2FlashColor(htmlColor: string | undefined | null) {\r\n  if (htmlColor === undefined || htmlColor === null) {\r\n    return htmlColor;\r\n  }\r\n  if (htmlColor.startsWith(\"#\")) {\r\n    htmlColor = htmlColor.slice(1);\r\n  }\r\n  const flashColor = parseInt(htmlColor, 16);\r\n  return flashColor;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataSource } from \"../DataSources/getDataSource\";\r\n\r\nexport function getRowStates(ctx: any) {\r\n  return getDataSource(ctx).rowState;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getRowStates } from \"./getRowStates\";\r\n\r\nexport function getRowStateById(ctx: any, id: string) {\r\n  return getRowStates(ctx).getValue(id);\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getRowStateById } from \"./getRowStateById\";\r\n\r\nexport function getRowStateIsDisableAction(ctx: any, rowId: string, actionId: string) {\r\n  const rowState = getRowStateById(ctx, rowId);\r\n  return rowState ? rowState.disabledActions.has(actionId) : true;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getRowStateIsDisableAction } from \"model/selectors/RowState/getRowStateIsDisabledAction\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\nimport { IAction, IActionData, IActionMode, IActionPlacement, IActionType } from \"./types/IAction\";\r\nimport { IActionParameter } from \"./types/IActionParameter\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\n\r\nexport class Action implements IAction {\r\n  $type_IAction: 1 = 1;\r\n\r\n  constructor(data: IActionData) {\r\n    Object.assign(this, data);\r\n    this.parameters.forEach((o) => (o.parent = this));\r\n  }\r\n\r\n  type: IActionType = null as any;\r\n  id: string = \"\";\r\n  groupId: string = \"\";\r\n  caption: string = \"\";\r\n  placement: IActionPlacement = null as any;\r\n  iconUrl: string = \"\";\r\n  mode: IActionMode = null as any;\r\n  isDefault: boolean = false;\r\n  parameters: IActionParameter[] = [];\r\n\r\n  get isEnabled() {\r\n    if (this.mode === IActionMode.Always) {\r\n      return true;\r\n    }\r\n\r\n    switch (this.mode) {\r\n      case IActionMode.ActiveRecord: {\r\n        const selRowId = getSelectedRowId(this);\r\n        return selRowId ? !getRowStateIsDisableAction(this, selRowId, this.id) : false;\r\n      }\r\n      case IActionMode.MultipleCheckboxes: {\r\n        const selectedIds = getDataView(this).selectedRowIds;\r\n        return selectedIds.size > 0\r\n          ? !Array.from(selectedIds)\r\n            .map((rowId) => getRowStateIsDisableAction(this, rowId, this.id))\r\n            .some((item) => item)\r\n          : this.placement === IActionPlacement.Toolbar;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IActionParameter, IActionParameterData } from \"./types/IActionParameter\";\r\n\r\nexport class ActionParameter implements IActionParameter {\r\n  $type_IActionParameter: 1 = 1;\r\n\r\n  constructor(data: IActionParameterData) {\r\n    Object.assign(this, data);\r\n  }\r\n\r\n  name: string = \"\";\r\n  fieldName: string = \"\";\r\n\r\n  parent?: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport {\r\n  IComponentBinding,\r\n  IComponentBindingData,\r\n  IComponentBindingPair,\r\n  IComponentBindingPairData\r\n} from \"./types/IComponentBinding\";\r\nimport { computed } from \"mobx\";\r\nimport { IDataView } from \"./types/IDataView\";\r\nimport { getFormScreen } from \"../selectors/FormScreen/getFormScreen\";\r\nimport { getDataTable } from \"../selectors/DataView/getDataTable\";\r\n\r\nexport class ComponentBindingPair implements IComponentBindingPair {\r\n  constructor(data: IComponentBindingPairData) {\r\n    Object.assign(this, data);\r\n  }\r\n\r\n  parent?: any;\r\n  parentPropertyId: string = \"\";\r\n  childPropertyId: string = \"\";\r\n}\r\n\r\nexport class ComponentBinding implements IComponentBinding {\r\n  $type_IComponentBinding: 1 = 1;\r\n\r\n  constructor(data: IComponentBindingData) {\r\n    Object.assign(this, data);\r\n    this.bindingPairs.forEach(o => (o.parent = this));\r\n  }\r\n\r\n  parentId: string = \"\";\r\n  parentEntity: string = \"\";\r\n  childId: string = \"\";\r\n  childEntity: string = \"\";\r\n  childPropertyType: string = \"\";\r\n  bindingPairs: IComponentBindingPair[] = [];\r\n\r\n  @computed get parentDataView(): IDataView {\r\n    const screen = getFormScreen(this);\r\n    return screen.getDataViewByModelInstanceId(this.parentId)!;\r\n  }\r\n\r\n  @computed get childDataView(): IDataView {\r\n    const screen = getFormScreen(this);\r\n    return screen.getDataViewByModelInstanceId(this.childId)!;\r\n  }\r\n\r\n  @computed get bindingController() {\r\n    const c: Array<[string, any]> = [];\r\n    const parentDataTable = getDataTable(this.parentDataView);\r\n    for (let pair of this.bindingPairs) {\r\n      const row = this.parentDataView.selectedRow;\r\n      const property = parentDataTable.getPropertyById(pair.parentPropertyId);\r\n      if (row && property) {\r\n        c.push([\r\n          pair.childPropertyId,\r\n          parentDataTable.getCellValue(row, property)\r\n        ]);\r\n      }\r\n    }\r\n    return c;\r\n  }\r\n\r\n  @computed get isBindingControllerValid() {\r\n    return this.bindingController.every(pair => pair[0] && pair[1])\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDataSource, IDataSourceData } from \"./types/IDataSource\";\r\nimport { IDataSourceField } from \"./types/IDataSourceField\";\r\nimport { IRowState } from \"./types/IRowState\";\r\n\r\nexport class DataSource implements IDataSource {\r\n  $type_IDataSource: 1 = 1;\r\n\r\n  constructor(data: IDataSourceData) {\r\n    Object.assign(this, data);\r\n    this.fields.forEach(o => (o.parent = this));\r\n    this.rowState.parent = this;\r\n  }\r\n\r\n  parent?: any;\r\n\r\n  entity: string = \"\";\r\n  dataStructureEntityId: string = \"\";\r\n  identifier: string = \"\";\r\n  lookupCacheKey: string = \"\";\r\n  fields: IDataSourceField[] = [];\r\n  rowState: IRowState = null as any;\r\n\r\n  getFieldByName(name: string): IDataSourceField | undefined {\r\n    return this.fields.find(field => field.name === name);\r\n  }\r\n\r\n  getFieldByIndex(index: number): IDataSourceField | undefined {\r\n    return this.fields.find(field => field.index === index);\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDataSourceField, IDataSourceFieldData } from \"./types/IDataSourceField\";\r\n\r\nexport class DataSourceField implements IDataSourceField {\r\n  $type_IDataSourceField: 1 = 1;\r\n\r\n  constructor(data: IDataSourceFieldData) {\r\n    Object.assign(this, data);\r\n  }\r\n\r\n  parent?: any;\r\n  name: string = \"\";\r\n  index: number = 0;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IAdditionalRowData, } from \"./types/IAdditionalRecordData\";\r\nimport { observable } from \"mobx\";\r\n\r\nexport class AdditionalRowData implements IAdditionalRowData {\r\n  $type_IAdditionalRowData: 1 = 1;\r\n\r\n  @observable dirtyNew: boolean = false;\r\n  @observable dirtyDeleted: boolean = false;\r\n  @observable dirtyValues: Map<string, any> = new Map();\r\n  @observable dirtyFormValues: Map<string, any> = new Map();\r\n\r\n  parent?: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { isLazyLoading } from \"./isLazyLoading\";\r\nimport { getDataView } from \"./DataView/getDataView\";\r\n\r\nexport function isInfiniteScrollingActive(ctx: any, dataViewAttributes?: any) {\r\n\r\n  const isRootGrid = dataViewAttributes\r\n    ? dataViewAttributes.IsRootGrid === \"true\"\r\n    : getDataView(ctx).isRootGrid\r\n\r\n  return isLazyLoading(ctx) && isRootGrid;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport function fixRowIdentifier(row: any[], identifierIndex: number) {\r\n  row = [...row];\r\n  const id = row[identifierIndex];\r\n  if (id !== null && id !== undefined) {\r\n    row[identifierIndex] = `${id}`;\r\n  }\r\n  return row;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action, computed, observable } from \"mobx\";\r\nimport { MAX_CHUNKS_TO_HOLD, SCROLL_ROW_CHUNK, } from \"../../gui/Workbench/ScreenArea/TableView/InfiniteScrollLoader\";\r\nimport { IRowsContainer } from \"./types/IRowsContainer\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { fixRowIdentifier } from \"utils/dataRow\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\n\r\n// The constants have to be defined here for the unit tests to work.\r\n// const MAX_CHUNKS_TO_HOLD = 20;\r\n// const SCROLL_ROW_CHUNK = 1000;\r\n\r\nexport class ScrollRowContainer implements IRowsContainer {\r\n  $type_ScrollRowContainer: 1 = 1;\r\n\r\n  constructor(rowIdGetter: (row: any[]) => string, parent: any) {\r\n    this.rowIdGetter = rowIdGetter;\r\n    this.parent = parent;\r\n  }\r\n\r\n  parent: any;\r\n  @observable\r\n  rowChunks: RowChunk[] = [];\r\n  private readonly rowIdGetter: (row: any[]) => string;\r\n\r\n  getTrueIndexById(id: string) {\r\n    const chunk = this.findChunkByRowId(id);\r\n    if (!chunk) {\r\n      return undefined;\r\n    }\r\n    return chunk.rowOffset + chunk.getRowIdxById(id)!;\r\n  }\r\n\r\n  async updateSortAndFilter(data?: { retainPreviousSelection?: true }) {\r\n  }\r\n\r\n  start() {\r\n  }\r\n\r\n  stop() {\r\n  }\r\n\r\n  @computed\r\n  get rows() {\r\n    return this.rowChunks.flatMap((chunk) => chunk.rows);\r\n  }\r\n\r\n  get allRows() {\r\n    return this.rows;\r\n  }\r\n\r\n  getAllValuesOfProp(property: IProperty) {\r\n    return this.rows;\r\n  }\r\n\r\n  clear(): void {\r\n    this.rowChunks.length = 0;\r\n  }\r\n\r\n  delete(row: any[]): void {\r\n    const rowId = this.rowIdGetter(row);\r\n    const chunk = this.findChunkByRowId(rowId);\r\n    if (!chunk) {\r\n      throw new Error(`Row with id \"${rowId}\" was not found`);\r\n    }\r\n    chunk.delete(rowId);\r\n  }\r\n\r\n  findChunkByRowId(rowId: string) {\r\n    return this.rowChunks.find((chunk) => chunk.has(rowId));\r\n  }\r\n\r\n  findChunkByRowIndex(indexInContainer: number) {\r\n    let rowCounter = 0;\r\n    if (this.rowChunks.length === 0) {\r\n      return {\r\n        chunk: undefined,\r\n        indexInChunk: undefined,\r\n      };\r\n    }\r\n    for (let rowChunk of this.rowChunks) {\r\n      const indexInChunk = indexInContainer - rowCounter;\r\n      if (indexInChunk < rowChunk.rows.length) {\r\n        return {\r\n          chunk: rowChunk,\r\n          indexInChunk: indexInChunk,\r\n        };\r\n      }\r\n      rowCounter += rowChunk.rows.length;\r\n    }\r\n    const lastChunk = this.rowChunks[this.rowChunks.length - 1];\r\n    return {\r\n      chunk: lastChunk,\r\n      indexInChunk: lastChunk.rows.length,\r\n    };\r\n  }\r\n\r\n  insert(index: number, row: any[], shouldLockNewRowAtTop?: boolean): Promise<any> {\r\n    const dataTable = getDataTable(this);\r\n    row = fixRowIdentifier(row, dataTable.identifierDataIndex);\r\n    const {chunk, indexInChunk} = this.findChunkByRowIndex(index);\r\n    if (!chunk) {\r\n      this.rowChunks.push(new RowChunk(0, [row], this.rowIdGetter, undefined));\r\n    } else {\r\n      chunk.insert(indexInChunk!, row);\r\n    }\r\n    return Promise.resolve();\r\n  }\r\n\r\n  @action.bound\r\n  async set(rowsIn: any[][], rowOffset: number = 0, isFinal: boolean | undefined = undefined): Promise<any> {\r\n    const dataTable = getDataTable(this);\r\n    const rows: any[][] = [];\r\n    for (let row of rowsIn) {\r\n      rows.push(fixRowIdentifier(row, dataTable.identifierDataIndex));\r\n    }\r\n    this.clear();\r\n    if (rows.length !== 0) {\r\n      this.rowChunks.push(new RowChunk(rowOffset, rows, this.rowIdGetter, isFinal));\r\n    }\r\n    this.notifyResetListeners();\r\n  }\r\n\r\n  substitute(row: any[]): void {\r\n    const dataTable = getDataTable(this);\r\n    row = fixRowIdentifier(row, dataTable.identifierDataIndex);\r\n    for (let chunk of this.rowChunks) {\r\n      const foundAndSubstituted = chunk.trySubstitute(row);\r\n      if (foundAndSubstituted) {\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  resetListeners: (() => void)[] = [];\r\n\r\n  registerResetListener(listener: () => void) {\r\n    this.resetListeners.push(listener);\r\n  }\r\n\r\n  notifyResetListeners() {\r\n    for (let resetListener of this.resetListeners) {\r\n      resetListener();\r\n    }\r\n  }\r\n\r\n  get nextEndOffset() {\r\n    return this.rowChunks.length === 0\r\n      ? SCROLL_ROW_CHUNK\r\n      : this.rowChunks[this.rowChunks.length - 1].rowOffset + SCROLL_ROW_CHUNK;\r\n  }\r\n\r\n  get nextStartOffset() {\r\n    return this.rowChunks.length === 0 || this.rowChunks[0].rowOffset < SCROLL_ROW_CHUNK\r\n      ? 0\r\n      : this.rowChunks[0].rowOffset - SCROLL_ROW_CHUNK;\r\n  }\r\n\r\n  @action.bound\r\n  prependRecords(rowsIn: any[][]) {\r\n    const dataTable = getDataTable(this);\r\n    const rows: any[][] = [];\r\n    for (let row of rowsIn) {\r\n      rows.push(fixRowIdentifier(row, dataTable.identifierDataIndex));\r\n    }\r\n    if (this.rowChunks.length === 0) {\r\n      this.rowChunks.push(new RowChunk(0, rows, this.rowIdGetter, undefined));\r\n      return;\r\n    }\r\n    const rowOffset = this.rowChunks[0].rowOffset - SCROLL_ROW_CHUNK;\r\n    if (rowOffset < 0) {\r\n      return;\r\n    }\r\n    this.rowChunks.unshift(new RowChunk(rowOffset, rows, this.rowIdGetter, undefined));\r\n    if (this.rowChunks.length > MAX_CHUNKS_TO_HOLD) {\r\n      this.rowChunks.pop();\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  appendRecords(rowsIn: any[][]) {\r\n    const dataTable = getDataTable(this);\r\n    const rows: any[][] = [];\r\n    for (let row of rowsIn) {\r\n      rows.push(fixRowIdentifier(row, dataTable.identifierDataIndex));\r\n    }\r\n    if (this.rowChunks.length === 0) {\r\n      this.rowChunks.push(new RowChunk(0, rows, this.rowIdGetter, undefined));\r\n      return;\r\n    }\r\n    const rowOffset = this.rowChunks[this.rowChunks.length - 1].rowOffset + SCROLL_ROW_CHUNK;\r\n    const isFinal = rows.length < SCROLL_ROW_CHUNK;\r\n    const rowChunk = new RowChunk(rowOffset, rows, this.rowIdGetter, isFinal);\r\n    const filteredChunk = this.replaceDuplicateRows(rowChunk);\r\n    this.rowChunks.push(filteredChunk);\r\n    if (this.rowChunks.length > MAX_CHUNKS_TO_HOLD) {\r\n      this.rowChunks.shift();\r\n    }\r\n  }\r\n\r\n  replaceDuplicateRows(newChunk: RowChunk) {\r\n    let filteredChunk = newChunk;\r\n    for (let rowChunk of this.rowChunks) {\r\n      filteredChunk = rowChunk.replaceRows(filteredChunk);\r\n    }\r\n    return filteredChunk;\r\n  }\r\n\r\n  @computed\r\n  get isLastRowLoaded() {\r\n    return this.rowChunks.length === 0 ? false : this.rowChunks[this.rowChunks.length - 1].isFinal;\r\n  }\r\n\r\n  @computed\r\n  get isFirstRowLoaded() {\r\n    return this.rowChunks.length === 0 ? false : this.rowChunks[0].isInitial;\r\n  }\r\n\r\n  @computed\r\n  get isFull() {\r\n    return this.rows.length === MAX_CHUNKS_TO_HOLD * SCROLL_ROW_CHUNK;\r\n  }\r\n\r\n  unlockAddedRowPosition(): void {\r\n  }\r\n\r\n  addedRowPositionLocked: boolean = false;\r\n\r\n  getFirstRow(): any[] | undefined {\r\n    if (this.rows.length === 0) {\r\n      return undefined;\r\n    }\r\n    return this.rows[0];\r\n  }\r\n\r\n  getFilteredRows(args: { propertyFilterIdToExclude: string }): any[] {\r\n    return [];\r\n  }\r\n}\r\n\r\nclass RowChunk {\r\n  rowOffset: number;\r\n  @observable.shallow\r\n  rows: any[];\r\n  private rowIdGetter: (row: any[]) => string;\r\n  isFinal: boolean;\r\n  private idMap: Map<string, number>;\r\n\r\n  constructor(\r\n    rowOffset: number,\r\n    rows: any[],\r\n    rowIdGetter: (row: any[]) => string,\r\n    isFinal: boolean | undefined\r\n  ) {\r\n    this.rowIdGetter = rowIdGetter;\r\n    this.isFinal = isFinal === undefined ? rows.length < SCROLL_ROW_CHUNK : isFinal;\r\n    if (rowOffset < 0) {\r\n      throw new Error(\"Offset cannot be less than 0\");\r\n    }\r\n    this.rowOffset = rowOffset;\r\n    this.rows = rows;\r\n    this.idMap = this.makeIdMap(rows);\r\n  }\r\n\r\n  makeIdMap(rows: any[][]) {\r\n    const idMap = new Map<string, number>();\r\n    for (let i = 0; i < rows.length; i++) {\r\n      idMap.set(this.rowIdGetter(rows[i]), i);\r\n    }\r\n    return idMap;\r\n  }\r\n\r\n  get isInitial() {\r\n    return this.rowOffset === 0;\r\n  }\r\n\r\n  get length() {\r\n    return this.rows.length;\r\n  }\r\n\r\n  trySubstitute(row: any[]) {\r\n    const index = this.rows.findIndex(\r\n      (existingRow) => this.rowIdGetter(existingRow) === this.rowIdGetter(row)\r\n    );\r\n    if (index > -1) {\r\n      this.rows.splice(index, 1, row);\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  getRow(id: string) {\r\n    const rowIndex = this.idMap.get(id);\r\n    if (rowIndex === undefined) {\r\n      return undefined;\r\n    }\r\n    return this.rows[rowIndex];\r\n  }\r\n\r\n  replaceRows(sourceChunk: RowChunk) {\r\n    const duplicateRowIndicesInSource: number[] = [];\r\n    for (let id of this.idMap.keys()) {\r\n      const duplicateRow = sourceChunk.getRow(id);\r\n      if (duplicateRow) {\r\n        const indexInThisChunk = this.idMap.get(id)!;\r\n        this.rows[indexInThisChunk] = duplicateRow;\r\n        duplicateRowIndicesInSource.push(sourceChunk.getIndex(id)!);\r\n      }\r\n    }\r\n\r\n    if (duplicateRowIndicesInSource.length === 0) {\r\n      return sourceChunk;\r\n    } else {\r\n      const nonDuplicateRows = sourceChunk.rows.filter(\r\n        (row, i) => !duplicateRowIndicesInSource.includes(i)\r\n      );\r\n      return new RowChunk(\r\n        sourceChunk.rowOffset,\r\n        nonDuplicateRows,\r\n        this.rowIdGetter,\r\n        sourceChunk.isFinal\r\n      );\r\n    }\r\n  }\r\n\r\n  private getIndex(rowId: string) {\r\n    return this.idMap.get(rowId);\r\n  }\r\n\r\n  has(rowId: string) {\r\n    return this.getIndex(rowId) !== undefined;\r\n  }\r\n\r\n  delete(rowId: string) {\r\n    const index = this.getIndex(rowId)!;\r\n    this.idMap.delete(rowId);\r\n    this.rows.splice(index, 1);\r\n    this.shiftIdMapDown(index);\r\n  }\r\n\r\n  insert(index: number, row: any[]) {\r\n    this.rows.splice(index, 0, row);\r\n    const rowId = this.rowIdGetter(row);\r\n    this.shiftIdMapUp(index);\r\n    this.idMap.set(rowId, index);\r\n  }\r\n\r\n  private shiftIdMapDown(index: number) {\r\n    for (let entry of Array.from(this.idMap.entries())) {\r\n      if (entry[1] > index) {\r\n        this.idMap.set(entry[0], entry[1] - 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  private shiftIdMapUp(index: number) {\r\n    for (let entry of Array.from(this.idMap.entries())) {\r\n      if (entry[1] > index - 1) {\r\n        this.idMap.set(entry[0], entry[1] + 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  getRowIdxById(id: string) {\r\n    const idx = this.rows.findIndex((row) => this.rowIdGetter(row) === id);\r\n    return idx > -1 ? idx : undefined;\r\n  }\r\n}\r\n\r\nexport const isScrollRowContainer = (o: any): o is ScrollRowContainer => o.$type_ScrollRowContainer;\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getDataViewPropertyById(ctx: any, id: string) {\r\n  return getDataView(ctx).properties\r\n    .flatMap(property => [property, ...property.childProperties])\r\n    .find(item => item.id === id);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action, comparer, computed, flow, IReactionDisposer, observable, reaction } from \"mobx\";\r\nimport { IFilterConfiguration } from \"./types/IFilterConfiguration\";\r\nimport { IOrderByDirection, IOrdering, IOrderingConfiguration } from \"./types/IOrderingConfiguration\";\r\nimport { IRowsContainer } from \"./types/IRowsContainer\";\r\nimport { getDataViewPropertyById } from \"model/selectors/DataView/getDataViewPropertyById\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport _ from \"lodash\";\r\nimport { fixRowIdentifier } from \"utils/dataRow\";\r\nimport { IDataView } from \"./types/IDataView\";\r\nimport { FlowBusyMonitor } from \"utils/flow\";\r\nimport { T } from \"utils/translation\";\r\n\r\nexport class ListRowContainer implements IRowsContainer {\r\n  private orderingConfiguration: IOrderingConfiguration;\r\n  private filterConfiguration: IFilterConfiguration;\r\n  private reactionDisposer: IReactionDisposer | undefined;\r\n  @observable\r\n  private forcedLastRowId: string | undefined;\r\n\r\n  constructor(\r\n    orderingConfiguration: IOrderingConfiguration,\r\n    filterConfiguration: IFilterConfiguration,\r\n    rowIdGetter: (row: any[]) => string,\r\n    parent: any\r\n  ) {\r\n    this.orderingConfiguration = orderingConfiguration;\r\n    this.filterConfiguration = filterConfiguration;\r\n    this.rowIdGetter = rowIdGetter;\r\n    this.parent = parent;\r\n  }\r\n\r\n  @observable.shallow allRows: any[][] = [];\r\n  rowIdGetter: (row: any[]) => any;\r\n\r\n  @observable\r\n  sortedIds: any[] | undefined;\r\n\r\n  @computed get idToRow() {\r\n    const entries = this.allRows.map(row => [this.rowIdGetter(row), row] as [any, any[]]);\r\n    return new Map<any, any[]>(entries);\r\n  }\r\n\r\n  async start() {\r\n    this.reactionDisposer = reaction(\r\n      () => [\r\n        this.filterConfiguration.activeFilters.map((filter) => [\r\n          filter.propertyId,\r\n          Array.isArray(filter.setting.val1) ? [...filter.setting.val1] : filter.setting.val1,\r\n          Array.isArray(filter.setting.val2) ? [...filter.setting.val2] : filter.setting.val2,\r\n          filter.setting.type,\r\n        ]),\r\n        this.orderingConfiguration.orderings.map((x) => [x.columnId, x.direction])],\r\n      () => this.updateSortAndFilterDebounced(),\r\n      {\r\n        equals: comparer.structural,\r\n      }\r\n    );\r\n    await this.updateSortAndFilter();\r\n  }\r\n\r\n  stop() {\r\n    this.reactionDisposer?.();\r\n  }\r\n\r\n  *preloadLookups() {\r\n    const dataView = getDataView(this.orderingConfiguration);\r\n    const dataTable = getDataTable(dataView);\r\n\r\n    const orderingComboProps = this.orderingConfiguration.userOrderings\r\n      .map(ordering => this.getOrderingProperty(dataView, ordering))\r\n      .filter((prop) => prop.column === \"ComboBox\");\r\n\r\n    const filterComboProps = this.filterConfiguration.activeFilters\r\n      .map((term) => getDataViewPropertyById(this.filterConfiguration, term.propertyId)!)\r\n      .filter((prop) => prop.column === \"ComboBox\");\r\n    const allComboProps = Array.from(new Set(filterComboProps.concat(orderingComboProps)));\r\n\r\n    yield Promise.all(\r\n      allComboProps.map(async (prop) => {\r\n        return prop.lookupEngine?.lookupResolver.resolveList(\r\n          dataTable.getAllValuesOfProp(prop)\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  getOrderingProperty(dataView: IDataView, ordering: IOrdering) {\r\n    const property = getDataViewPropertyById(dataView, ordering.columnId)\r\n    if (!property) {\r\n      // throw new Error(`Panel ${dataView.modelId} has default sort set to column ${ordering.columnId}. This column does not exist in the panel. Cannot set default sort.`);\r\n      throw new Error(T(`Panel ${dataView.modelId} has default sort set to column ${ordering.columnId}. This column does not exist in the panel. Cannot set default sort.`,\r\n        \"invalid_sort_column\", dataView.modelId, ordering.columnId, dataView.name));\r\n    }\r\n    return property;\r\n  }\r\n\r\n  updateSortAndFilterDebounced = _.debounce(this.updateSortAndFilter, 10);\r\n  monitor: FlowBusyMonitor =  new FlowBusyMonitor();\r\n\r\n  @action\r\n  async updateSortAndFilter(data?: { retainPreviousSelection?: boolean }) {\r\n    const self = this;\r\n    await flow(\r\n      function*() {\r\n        yield*self.preloadLookups();\r\n        let rows = self.allRows;\r\n        if (self.filterConfiguration.filteringFunction()) {\r\n          rows = rows.filter((row) => self.filterConfiguration.filteringFunction()(row));\r\n        }\r\n        if (self.orderingConfiguration.orderings.length !== 0) {\r\n          rows = rows.sort((row1: any[], row2: any[]) => self.internalRowOrderingFunc(row1, row2));\r\n        }\r\n        self.sortedIds = rows.map(row => self.rowIdGetter(row));\r\n        const dataView = getDataView(self);\r\n        if (!data?.retainPreviousSelection) {\r\n          dataView.reselectOrSelectFirst();\r\n        }\r\n      }\r\n    )();\r\n  }\r\n\r\n  getFilteredRows(args: { propertyFilterIdToExclude: string }) {\r\n    return this.allRows\r\n      .filter((row) => this.filterConfiguration.filteringFunction(args.propertyFilterIdToExclude)(row));\r\n  }\r\n\r\n  @computed get rows() {\r\n    if (!this.sortedIds) {\r\n      return this.allRows;\r\n    }\r\n    return this.sortedIds\r\n      .map(id => this.idToRow.get(id))\r\n      .filter(row => row) as any[][];\r\n  }\r\n\r\n  internalRowOrderingFunc(row1: any[], row2: any[]) {\r\n    if (this.forcedLastRowId !== undefined) {\r\n      const orderings = this.orderingConfiguration.orderings;\r\n      const directionMultiplier = orderings.length === 1 && orderings[0].direction === IOrderByDirection.DESC\r\n        ? -1\r\n        : 1;\r\n      if (this.forcedLastRowId === this.rowIdGetter(row1)) return 1 * directionMultiplier;\r\n      if (this.forcedLastRowId === this.rowIdGetter(row2)) return -1 * directionMultiplier;\r\n    }\r\n    return this.orderingConfiguration.orderingFunction()(row1, row2);\r\n  }\r\n\r\n  unlockAddedRowPosition(): void {\r\n    this.forcedLastRowId = undefined;\r\n  }\r\n\r\n  clear(): void {\r\n    this.allRows.length = 0;\r\n  }\r\n\r\n  delete(row: any[]): void {\r\n    const rowId = this.rowIdGetter(row);\r\n    const idx = this.allRows.findIndex((r) => this.rowIdGetter(r) === rowId);\r\n    if (idx > -1) {\r\n      this.allRows.splice(idx, 1);\r\n      if (rowId === this.forcedLastRowId) {\r\n        this.forcedLastRowId = undefined;\r\n      }\r\n      this.updateSortAndFilter({retainPreviousSelection: true});\r\n    }\r\n  }\r\n\r\n  async insert(index: number, row: any[], shouldLockNewRowPosition?: boolean): Promise<any> {\r\n    const dataTable = getDataTable(this);\r\n    row = fixRowIdentifier(row, dataTable.identifierDataIndex);\r\n    const newRowId = dataTable.getRowId(row);\r\n    const rowExistsAlready = this.allRows.some(row => dataTable.getRowId(row) === newRowId)\r\n    if (rowExistsAlready) {\r\n      return;\r\n    }\r\n    this.allRows.splice(index, 0, row);\r\n    if (shouldLockNewRowPosition) {\r\n      this.forcedLastRowId = this.rowIdGetter(row);\r\n    }\r\n    await this.updateSortAndFilter();\r\n  }\r\n\r\n  async set(rowsIn: any[][], rowOffset: number): Promise<any> {\r\n    const dataTable = getDataTable(this);\r\n    const rows: any[][] = [];\r\n    for (let row of rowsIn) {\r\n      rows.push(fixRowIdentifier(row, dataTable.identifierDataIndex));\r\n    }\r\n    this.clear();\r\n    for (let row of rows) this.allRows.push(row);\r\n    await this.updateSortAndFilter();\r\n  }\r\n\r\n  appendRecords(rowsIn: any[][]) {\r\n    let dataView = getDataView(this);\r\n    if (dataView.type === \"SectionLevelPlugin\") {\r\n      throw new Error(dataView.name + \" is a SectionLevelPlugin which does not allow navigation. This is not implemented. Please set the \\\"AllowNavigation\\\" property to true.\");\r\n    }\r\n    throw new Error(\"Not implemented\");\r\n  }\r\n\r\n  substitute(row: any[]): void {\r\n    const dataTable = getDataTable(this);\r\n    row = fixRowIdentifier(row, dataTable.identifierDataIndex);\r\n    const idx = this.allRows.findIndex((r) => this.rowIdGetter(r) === this.rowIdGetter(row));\r\n    if (idx > -1) {\r\n      this.allRows.splice(idx, 1, row);\r\n    }\r\n  }\r\n\r\n  registerResetListener(listener: () => void): void {\r\n  }\r\n\r\n  parent: any;\r\n\r\n  getTrueIndexById(id: string) {\r\n    const idx = this.rows.findIndex((row) => this.rowIdGetter(row) === id);\r\n    return idx > -1 ? idx : undefined;\r\n  }\r\n\r\n  get addedRowPositionLocked(): boolean {\r\n    return this.forcedLastRowId !== undefined;\r\n  }\r\n\r\n  getFirstRow(): any[] | undefined {\r\n    if (this.rows.length === 0) {\r\n      return undefined;\r\n    }\r\n    return this.rows[0];\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getLocaleFromCookie } from \"../../utils/cookies\";\r\nimport _ from \"lodash\";\r\n\r\nconst clearCacheLater = _.debounce(() => {\r\n  formatCache.clear();\r\n}, 10000);\r\nconst formatCache: any = new Map<any, any>();\r\n\r\nfunction getOrSetCached(fnGetResult: () => any, ...simpleKeys: any[]) {\r\n  let item = formatCache;\r\n  let keyIndex = 0;\r\n  for (let key of simpleKeys) {\r\n    let nextItem = item.get(key);\r\n    if (nextItem === undefined) {\r\n      if (keyIndex === simpleKeys.length - 1) {\r\n        item.set(key, (nextItem = fnGetResult()));\r\n      } else {\r\n        item.set(key, (nextItem = new Map()));\r\n      }\r\n    }\r\n    item = nextItem;\r\n    keyIndex++;\r\n  }\r\n  clearCacheLater();\r\n  return item;\r\n}\r\n\r\nexport function formatNumberWithLocale(\r\n  customNumericFormat: string | undefined,\r\n  value: number,\r\n  locale: string\r\n) {\r\n  return getOrSetCached(\r\n    () => {\r\n      if (customNumericFormat) {\r\n        const customFormat = new CustomNumericFormat(customNumericFormat);\r\n        return value.toLocaleString(locale, {\r\n          minimumFractionDigits: customFormat.minimumFractionDigits,\r\n          maximumFractionDigits: customFormat.maximumFractionDigits,\r\n          useGrouping: customFormat.useThousandsSeparator,\r\n        });\r\n      } else {\r\n        return value.toLocaleString(locale);\r\n      }\r\n    },\r\n    locale,\r\n    customNumericFormat,\r\n    value\r\n  );\r\n}\r\n\r\nexport function getCurrentDecimalSeparator() {\r\n  return getSeparator(\"decimal\");\r\n}\r\n\r\nexport function getCurrentGroupSeparator() {\r\n  return getSeparator(\"group\");\r\n}\r\n\r\nfunction getSeparator(separatorType: string) {\r\n  const locale = getLocaleFromCookie();\r\n  const numberWithDecimalSeparator = 1000.1;\r\n  return Intl.NumberFormat(locale)\r\n    .formatToParts(numberWithDecimalSeparator)\r\n    .find((part) => part.type === separatorType)!.value;\r\n}\r\n\r\nexport function formatNumber(\r\n  customNumericFormat: string | undefined,\r\n  dataType: string,\r\n  value: number\r\n) {\r\n  if(isNaN(value)){\r\n    return \"\";\r\n  }\r\n  const locale = getLocaleFromCookie();\r\n  if (customNumericFormat) {\r\n    return formatNumberWithLocale(customNumericFormat, value, locale);\r\n  }\r\n  if (dataType === \"Currency\" || dataType === \"Float\") {\r\n    return formatNumberWithLocale(\"### ###.00##########\", value, locale);\r\n  } else {\r\n    return formatNumberWithLocale(\"### ###\", value, locale);\r\n  }\r\n}\r\n\r\nclass CustomNumericFormat {\r\n  private format: string;\r\n  private fractionFormat: string | undefined;\r\n\r\n  constructor(format: string) {\r\n    const containsAllowedChar = RegExp(\"^[# 0.]+$\").test(format);\r\n    if (!containsAllowedChar) {\r\n      throw new Error('Custom format contains unimplemented characters: \"' + format + '\"');\r\n    }\r\n    this.format = format.trim();\r\n    this.fractionFormat = this.getFractionFormat(this.format);\r\n  }\r\n\r\n  getFractionFormat(format: string) {\r\n    const splitByPoint = format.split(\".\");\r\n    return splitByPoint.length < 2 ? undefined : splitByPoint[1];\r\n  }\r\n\r\n  get maximumFractionDigits() {\r\n    return this.fractionFormat ? this.fractionFormat.length : undefined;\r\n  }\r\n\r\n  get minimumFractionDigits() {\r\n    if (!this.fractionFormat) {\r\n      return undefined;\r\n    }\r\n    const minDigits = this.fractionFormat.split(\"0\").length - 1;\r\n    return minDigits === 0 ? undefined : minDigits;\r\n  }\r\n\r\n  get useThousandsSeparator() {\r\n    return this.format.includes(\" \");\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDataTable, IDataTableData } from \"./types/IDataTable\";\r\nimport { action, computed, observable } from \"mobx\";\r\nimport { IProperty } from \"./types/IProperty\";\r\nimport { getDataView } from \"../selectors/DataView/getDataView\";\r\nimport { IAdditionalRowData } from \"./types/IAdditionalRecordData\";\r\nimport { AdditionalRowData } from \"./AdditionalRowData\";\r\nimport { IDataSourceField } from \"./types/IDataSourceField\";\r\nimport { getRowContainer } from \"../selectors/getRowContainer\";\r\nimport { IRowsContainer } from \"./types/IRowsContainer\";\r\nimport { formatNumber } from \"./NumberFormating\";\r\nimport { getDataSource } from \"model/selectors/DataSources/getDataSource\";\r\nimport { getDataSourceFieldByIndex } from \"model/selectors/DataSources/getDataSourceFieldByIndex\";\r\nimport { isArray } from \"lodash\";\r\n\r\nexport class DataTable implements IDataTable {\r\n  $type_IDataTable: 1 = 1;\r\n  rowsContainer: IRowsContainer = null as any;\r\n  @observable\r\n  isEmpty: boolean = false;\r\n  @observable\r\n  rowsAddedSinceSave = 0;\r\n\r\n  constructor(data: IDataTableData) {\r\n    Object.assign(this, data);\r\n    this.rowsContainer = getRowContainer(\r\n      data.formScreenLifecycle,\r\n      data.dataViewAttributes,\r\n      data.orderingConfiguration,\r\n      data.filterConfiguration,\r\n      (row: any[]) => this.getRowId(row),\r\n      this\r\n    );\r\n  }\r\n\r\n  rowRemovedListeners: (() => void)[] = [];\r\n\r\n  notifyRowRemovedListeners() {\r\n    this.rowRemovedListeners.forEach((listener) => listener());\r\n  }\r\n\r\n  async start() {\r\n    await this.rowsContainer.start();\r\n  }\r\n\r\n  stop() {\r\n    this.rowsContainer.stop();\r\n  }\r\n\r\n  get allRows() {\r\n    return this.rowsContainer.allRows;\r\n  }\r\n\r\n  @computed get rows(): any[][] {\r\n    return this.rowsContainer.rows;\r\n  }\r\n\r\n  @observable additionalRowData: Map<string, IAdditionalRowData> = new Map();\r\n\r\n  @computed\r\n  get properties(): IProperty[] {\r\n    return getDataView(this).properties;\r\n  }\r\n\r\n  @computed get dataSource() {\r\n    return getDataSource(this);\r\n  }\r\n\r\n  @computed get identifierProperty() {\r\n    return this.properties.find((prop) => prop.id === this.dataSource.identifier);\r\n  }\r\n\r\n  get identifierDataIndex() {\r\n    return this.identifierProperty!.dataIndex;\r\n  }\r\n\r\n  getRowId(row: any[]): string {\r\n    return row[this.identifierDataIndex];\r\n  }\r\n\r\n  getCellValue(row: any[], property: IProperty) {\r\n    if (this.additionalRowData.has(this.getRowId(row))) {\r\n      const ard = this.additionalRowData.get(this.getRowId(row))!;\r\n      if (ard.dirtyFormValues.has(property.id)) {\r\n        return ard.dirtyFormValues.get(property.id);\r\n      }\r\n      if (ard.dirtyValues.has(property.id)) {\r\n        return ard.dirtyValues.get(property.id);\r\n      }\r\n    }\r\n    return this.getOriginalCellValue(row, property);\r\n  }\r\n\r\n  getOriginalCellValue(row: any[], property: IProperty) {\r\n    return row[property.dataIndex];\r\n  }\r\n\r\n  async updateSortAndFilter(data?: { retainPreviousSelection?: true }) {\r\n    return this.rowsContainer.updateSortAndFilter(data);\r\n  }\r\n\r\n  getCellValueByDataSourceField(row: any[], dsField: IDataSourceField) {\r\n    if (this.additionalRowData.has(this.getRowId(row))) {\r\n      const ard = this.additionalRowData.get(this.getRowId(row))!;\r\n      if (ard.dirtyFormValues.has(dsField.name)) {\r\n        return ard.dirtyFormValues.get(dsField.name);\r\n      }\r\n      if (ard.dirtyValues.has(dsField.name)) {\r\n        return ard.dirtyValues.get(dsField.name);\r\n      }\r\n    }\r\n    return row[dsField.index];\r\n  }\r\n\r\n  // Returns all values from currently loaded rows (in case the table is infinitely scrolled)\r\n  getAllValuesOfProp(property: IProperty): Set<any> {\r\n    const values = this.rowsContainer\r\n      .getFilteredRows({propertyFilterIdToExclude: property.id})\r\n      .map((row) => this.getCellValue(row, property)).filter((row) => row)\r\n    if (values.some(value => isArray(value))) {\r\n      return new Set(values.flatMap(array => array));\r\n    }\r\n    return new Set(values);\r\n  }\r\n\r\n  getCellText(row: any[], property: IProperty) {\r\n    const value = this.getCellValue(row, property);\r\n    return this.resolveCellText(property, value);\r\n  }\r\n\r\n  getOriginalCellText(row: any[], property: IProperty) {\r\n    const value = this.getOriginalCellValue(row, property);\r\n    return this.resolveCellText(property, value);\r\n  }\r\n\r\n  resolveCellText(property: IProperty, value: any): any {\r\n    if (value === null || value === undefined || (Array.isArray(value) && value.length === 0))\r\n      return \"\";\r\n    if (property.isLookup && property.lookupEngine) {\r\n      const {lookupEngine} = property;\r\n      if (property.column === \"TagInput\") {\r\n        if (!Array.isArray(value)) value = [value];\r\n        const textArray = value.map((valueItem: any) =>\r\n          lookupEngine.lookupResolver.resolveValue(`${valueItem}`)\r\n        );\r\n        return textArray || [];\r\n      } else {\r\n        if (Array.isArray(value)) {\r\n          return value\r\n            .map((item) => lookupEngine.lookupResolver.resolveValue(`${item}`))\r\n            .join(\", \");\r\n        }\r\n        return lookupEngine.lookupResolver.resolveValue(`${value}`);\r\n      }\r\n    }\r\n    if (property.column === \"Number\") {\r\n      return formatNumber(property.customNumericFormat, property.entity, value);\r\n    }\r\n    return value;\r\n  }\r\n\r\n  getRowByExistingIdx(idx: number): any[] {\r\n    return this.rows[idx];\r\n  }\r\n\r\n  getRowById(id: string): any[] | undefined {\r\n    return this.rowsContainer.rows.find((row) => this.getRowId(row) === id);\r\n  }\r\n\r\n  getTrueIndexById(id: string) {\r\n    return this.rowsContainer.getTrueIndexById(id);\r\n  }\r\n\r\n  getExistingRowIdxById(id: string) {\r\n    const idx = this.rows.findIndex((row) => this.getRowId(row) === id);\r\n    return idx > -1 ? idx : undefined;\r\n  }\r\n\r\n  isCellTextResolving(property: IProperty, value: any): boolean {\r\n    if (value === null || value === undefined) return false;\r\n    if (property.isLookup && property.lookupEngine) {\r\n      const {lookupEngine} = property;\r\n      if (property.column === \"TagInput\") {\r\n        return value.some((valueItem: any) =>\r\n          lookupEngine.lookupResolver.isEmptyAndLoading(`${valueItem}`)\r\n        );\r\n      } else {\r\n        return lookupEngine.lookupResolver.isEmptyAndLoading(`${value}`);\r\n      }\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  getPropertyById(id: string) {\r\n    return this.properties.find((prop) => prop.id === id);\r\n  }\r\n\r\n  getFirstRow(): any[] | undefined {\r\n    return this.rowsContainer.getFirstRow();\r\n  }\r\n\r\n  getLastRow(): any[] | undefined {\r\n    if (this.rows.length === 0) {\r\n      return undefined;\r\n    }\r\n    return this.rows[this.rows.length - 1];\r\n  }\r\n\r\n  getNearestRow(row: any[]): any[] | undefined {\r\n    const id = this.getRowId(row);\r\n    let idx = this.getExistingRowIdxById(id);\r\n    if (this.rows.length === 1) return;\r\n    if (idx !== undefined) {\r\n      if (idx === 0) {\r\n        return this.rows[1];\r\n      } else {\r\n        return this.rows[idx - 1];\r\n      }\r\n    } else return;\r\n  }\r\n\r\n  getNextExistingRowId(id: string): string | undefined {\r\n    const idx = this.rows.findIndex((r) => this.getRowId(r) === id);\r\n    if (idx > -1) {\r\n      const newRow = this.rows[idx + 1];\r\n      return newRow ? this.getRowId(newRow) : undefined;\r\n    }\r\n  }\r\n\r\n  getPrevExistingRowId(id: string): string | undefined {\r\n    const idx = this.rows.findIndex((r) => this.getRowId(r) === id);\r\n    if (idx > 0) {\r\n      const newRow = this.rows[idx - 1];\r\n      return newRow ? this.getRowId(newRow) : undefined;\r\n    }\r\n  }\r\n\r\n  getAdditionalRowData(row: any[]) {\r\n    return this.getAdditionalRowDataById(this.getRowId(row));\r\n  }\r\n\r\n  getAdditionalRowDataById(id: string) {\r\n    return this.additionalRowData.get(id);\r\n  }\r\n\r\n  hasRowDirtyValues(row: any[]) {\r\n    const ard = this.getAdditionalRowData(row);\r\n    if (!ard) return;\r\n    return ard.dirtyValues.size > 0;\r\n  }\r\n\r\n  getDirtyValues(row: any[]): Map<string, any> {\r\n    const ard = this.getAdditionalRowData(row);\r\n    if (ard) {\r\n      return ard.dirtyValues;\r\n    } else {\r\n      return new Map();\r\n    }\r\n  }\r\n\r\n  getDirtyValueRows(): any[][] {\r\n    return this.rows.filter((row) => this.hasRowDirtyValues(row));\r\n  }\r\n\r\n  @action.bound\r\n  appendRecords(rows: any[][]): void {\r\n    this.rowsContainer.appendRecords(rows);\r\n  }\r\n\r\n  @action.bound\r\n  async setRecords(rows: any[][]) {\r\n    this.clear();\r\n    await this.rowsContainer.set(rows, 0, undefined);\r\n    if (rows.length === 0) {\r\n      this.isEmpty = true;\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  setFormDirtyValue(row: any[], propertyId: string, value: any) {\r\n    this.createAdditionalData(row);\r\n    this.additionalRowData.get(this.getRowId(row))!.dirtyFormValues.set(propertyId, value);\r\n  }\r\n\r\n  @action.bound\r\n  flushFormToTable(row: any[]): void {\r\n    const ard = this.getAdditionalRowData(row);\r\n    if (ard) {\r\n      for (let [propertyId, value] of ard.dirtyFormValues.entries()) {\r\n        ard.dirtyValues.set(propertyId, value);\r\n      }\r\n    }\r\n  }\r\n\r\n  @action.bound setDirtyValue(row: any[], columnId: string, value: any) {\r\n    this.createAdditionalData(row);\r\n    const ard = this.getAdditionalRowData(row);\r\n    if (ard) {\r\n      ard.dirtyValues.set(columnId, value);\r\n    }\r\n  }\r\n\r\n\r\n  @action.bound\r\n  createAdditionalData(row: any[]) {\r\n    if (!this.additionalRowData.has(this.getRowId(row))) {\r\n      const ard = new AdditionalRowData();\r\n      ard.parent = this;\r\n      this.additionalRowData.set(this.getRowId(row), ard);\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  clearUnneededAdditionalRowData() {\r\n    for (let [k, v] of Array.from(this.additionalRowData.entries())) {\r\n      if (\r\n        v.dirtyFormValues.size === 0 &&\r\n        v.dirtyValues.size === 0\r\n      ) {\r\n        this.additionalRowData.delete(k);\r\n      }\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  deleteAdditionalCellData(row: any[], propertyId: string) {\r\n    const additionalData = this.additionalRowData.get(this.getRowId(row));\r\n    if (!additionalData) {\r\n      return;\r\n    }\r\n    additionalData.dirtyFormValues.delete(propertyId);\r\n    additionalData.dirtyValues.delete(propertyId);\r\n  }\r\n\r\n  @action.bound\r\n  deleteAdditionalRowData(row: any[]) {\r\n    this.additionalRowData.delete(this.getRowId(row));\r\n  }\r\n\r\n  @action.bound\r\n  deleteRow(row: any[]): void {\r\n    this.deleteAdditionalRowData(row);\r\n    this.rowsContainer.delete(row);\r\n    this.notifyRowRemovedListeners();\r\n    this.rowsAddedSinceSave--;\r\n  }\r\n\r\n  @action.bound\r\n  clearRecordDirtyValues(id: string, newRow: any[]): void {\r\n    const rowData = this.getAdditionalRowDataById(id);\r\n    if (rowData) {\r\n      const oldRow = this.getRowById(id)!;\r\n      for (let i = 0; i < newRow.length; i++) {\r\n        const dataSourceField = getDataSourceFieldByIndex(this, i)!;\r\n        if (newRow[i] !== oldRow[i]) {\r\n          rowData.dirtyFormValues.delete(dataSourceField.name);\r\n          rowData.dirtyValues.delete(dataSourceField.name);\r\n        }\r\n        if (rowData.dirtyFormValues.get(dataSourceField.name) === newRow[i]) {\r\n          rowData.dirtyFormValues.delete(dataSourceField.name);\r\n        }\r\n        if (rowData.dirtyValues.get(dataSourceField.name) === newRow[i]) {\r\n          rowData.dirtyValues.delete(dataSourceField.name);\r\n        }\r\n      }\r\n      this.clearUnneededAdditionalRowData();\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  substituteRecord(row: any[]): void {\r\n    this.rowsContainer.substitute(row);\r\n  }\r\n\r\n  @action.bound\r\n  async insertRecord(index: number, row: any[], shouldLockNewRowAtTop?: boolean): Promise<any> {\r\n    await this.rowsContainer.insert(index, row, shouldLockNewRowAtTop);\r\n    this.rowsAddedSinceSave++;\r\n  }\r\n\r\n  @action.bound\r\n  clear(): void {\r\n    this.rowsContainer.clear();\r\n    this.additionalRowData.clear();\r\n    this.notifyRowRemovedListeners();\r\n  }\r\n\r\n  unlockAddedRowPosition(): void {\r\n    this.rowsContainer.unlockAddedRowPosition();\r\n  }\r\n\r\n  get addedRowPositionLocked(): boolean {\r\n    return this.rowsContainer.addedRowPositionLocked;\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport enum IPanelViewType {\r\n  Form = \"0\",\r\n  Table = \"1\",\r\n  Map = \"5\",\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { isInfiniteScrollingActive } from \"./isInfiniteScrollingActive\";\r\nimport { IOrderingConfiguration } from \"../entities/types/IOrderingConfiguration\";\r\nimport { IFilterConfiguration } from \"../entities/types/IFilterConfiguration\";\r\nimport { ScrollRowContainer } from \"../entities/ScrollRowContainer\";\r\nimport { ListRowContainer } from \"../entities/ListRowContainer\";\r\n\r\nexport function getRowContainer(ctx: any, dataViewAttributes: any,\r\n                                orderingConfiguration: IOrderingConfiguration,\r\n                                filterConfiguration: IFilterConfiguration,\r\n                                rowIdGetter: (row: any[]) => string,\r\n                                parent: any) {\r\n  return isInfiniteScrollingActive(ctx, dataViewAttributes)\r\n    ? new ScrollRowContainer(rowIdGetter, parent)\r\n    : new ListRowContainer(orderingConfiguration, filterConfiguration, rowIdGetter, parent);\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataSource } from \"./getDataSource\";\r\n\r\nexport function getDataSourceFieldByIndex(ctx: any, index: number) {\r\n  return getDataSource(ctx).getFieldByIndex(index);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getSelectedRow(ctx: any) {\r\n  return getDataView(ctx).selectedRow;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getOpenedScreen } from \"./getOpenedScreen\";\r\n\r\nexport function getIsDialog(ctx: any) {\r\n  return getOpenedScreen(ctx).isDialog;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataSource } from \"./getDataSource\";\r\n\r\nexport function getDataSourceFieldByName(ctx: any, name: string) {\r\n  return getDataSource(ctx).getFieldByName(name);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getRowStates } from \"./getRowStates\";\r\nimport { getDataView } from \"../DataView/getDataView\";\r\n\r\nexport function getRowStateMayCauseFlicker(ctx: any) {\r\n  const dataView = getDataView(ctx);\r\n  return getRowStates(ctx).mayCauseFlicker && !dataView.dataTable.isEmpty;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getTablePanelView } from './getTablePanelView';\r\n\r\nexport function getTableViewProperties(ctx: any) {\r\n  return getTablePanelView(ctx).tableProperties;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getIsSelectionCheckboxesShown(ctx: any) {\r\n  return getDataView(ctx).showSelectionCheckboxes;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getTablePanelView } from \"./getTablePanelView\";\r\n\r\nexport function getGroupingConfiguration(ctx: any) {\r\n  return getTablePanelView(ctx).groupingConfiguration;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IGroupRow, IGroupTreeNode, ITableRow } from \"./types\";\r\n\r\nexport class TableGroupRow implements IGroupRow {\r\n  constructor(public groupLevel: number, public sourceGroup: IGroupTreeNode) {\r\n  }\r\n\r\n  parent: IGroupRow | undefined;\r\n\r\n  get columnLabel(): string {\r\n    return this.sourceGroup.groupLabel;\r\n  }\r\n\r\n  get columnValue(): string {\r\n    return this.sourceGroup.columnDisplayValue;\r\n  }\r\n\r\n  get isExpanded(): boolean {\r\n    return this.sourceGroup.isExpanded;\r\n  }\r\n}\r\n\r\n\r\nexport function flattenToTableRows(rootGroups: IGroupTreeNode[]) {\r\n  const result: ITableRow[] = [];\r\n  let level = 0;\r\n\r\n  function recursive(group: IGroupTreeNode) {\r\n    result.push(new TableGroupRow(level, group));\r\n    if (!group.isExpanded) return;\r\n    for (let g of group.childGroups) {\r\n      level++;\r\n      recursive(g);\r\n      level--;\r\n    }\r\n    if (group.childGroups.length === 0) {\r\n      result.push(...group.childRows);\r\n    }\r\n  }\r\n\r\n  for (let group of rootGroups) {\r\n    recursive(group);\r\n  }\r\n  return result;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getGroupingConfiguration } from \"./getGroupingConfiguration\";\r\nimport { getIsSelectionCheckboxesShown } from \"../DataView/getIsSelectionCheckboxesShown\";\r\n\r\nexport function getLeadingColumnCount(ctx: any) {\r\n  const isCheckBoxedTable = getIsSelectionCheckboxesShown(ctx);\r\n  const groupedColumnIds = getGroupingConfiguration(ctx).orderedGroupingColumnSettings;\r\n  return groupedColumnIds.length + (isCheckBoxedTable ? 1 : 0);\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IGridDimensions } from \"../../../Components/ScreenElements/Table/types\";\r\nimport { action, computed } from \"mobx\";\r\nimport { IProperty } from \"../../../../model/entities/types/IProperty\";\r\nimport { getLeadingColumnCount } from \"../../../../model/selectors/TablePanelView/getLeadingColumnCount\";\r\nimport { getIsSelectionCheckboxesShown } from \"../../../../model/selectors/DataView/getIsSelectionCheckboxesShown\";\r\nimport { getGroupingConfiguration } from \"../../../../model/selectors/TablePanelView/getGroupingConfiguration\";\r\nimport { getTableViewProperties } from \"model/selectors/TablePanelView/getTableViewProperties\";\r\n\r\nexport interface IGridDimensionsData {\r\n  getTableViewProperties: () => IProperty[];\r\n  getRowCount: () => number;\r\n  getIsSelectionCheckboxes: () => boolean;\r\n  ctx: any;\r\n  defaultRowHeight: number;\r\n}\r\n\r\nexport class GridDimensions implements IGridDimensions {\r\n  constructor(data: IGridDimensionsData) {\r\n    Object.assign(this, data);\r\n  }\r\n\r\n  @computed get columnWidths(): Map<string, number> {\r\n    return new Map(this.tableViewProperties.map((prop) => [prop.id, prop.columnWidth]));\r\n  }\r\n\r\n  getTableViewProperties: () => IProperty[] = null as any;\r\n  getRowCount: () => number = null as any;\r\n  getIsSelectionCheckboxes: () => boolean = null as any;\r\n  ctx: any;\r\n  defaultRowHeight: number = null as any;\r\n\r\n  @computed get imageProperty() {\r\n    for (let prop of this.tableViewProperties) {\r\n      if (prop.column === \"Image\") {\r\n        return prop;\r\n      }\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  @computed get rowHeight(): number {\r\n    if (this.imageProperty) return this.imageProperty.height;\r\n    return this.defaultRowHeight;\r\n  }\r\n\r\n\r\n  @computed get isSelectionCheckboxes() {\r\n    return this.getIsSelectionCheckboxes();\r\n  }\r\n\r\n  @computed get tableViewPropertiesOriginal() {\r\n    return this.getTableViewProperties();\r\n  }\r\n\r\n  @computed get tableViewProperties() {\r\n    return this.tableViewPropertiesOriginal;\r\n  }\r\n\r\n  @computed get rowCount() {\r\n    return this.getRowCount();\r\n  }\r\n\r\n  @computed get columnCount() {\r\n    return this.tableViewProperties.length;\r\n  }\r\n\r\n  get contentWidth() {\r\n    if (this.columnCount === 0) return 0;\r\n    return this.getColumnRight(this.columnCount - 1);\r\n  }\r\n\r\n  get contentHeight() {\r\n    return this.getRowBottom(this.rowCount - 1);\r\n  }\r\n\r\n  getColumnLeft(dataColumnIndex: number): number {\r\n    const displayedColumnIndex = this.dataColumnIndexToDisplayedIndex(dataColumnIndex);\r\n    return this.displayedColumnDimensionsCom[displayedColumnIndex].left;\r\n  }\r\n\r\n  getColumnRight(dataColumnIndex: number): number {\r\n    const displayedColumnIndex = this.dataColumnIndexToDisplayedIndex(dataColumnIndex);\r\n    return this.displayedColumnDimensionsCom[displayedColumnIndex].right;\r\n  }\r\n\r\n  dataColumnIndexToDisplayedIndex(dataColumnIndex: number) {\r\n    return dataColumnIndex + getLeadingColumnCount(this.ctx);\r\n  }\r\n\r\n  getRowTop(rowIndex: number): number {\r\n    return rowIndex * this.getRowHeight(rowIndex);\r\n  }\r\n\r\n  getRowHeight(rowIndex: number): number {\r\n    return this.rowHeight;\r\n  }\r\n\r\n  getRowBottom(rowIndex: number): number {\r\n    return this.getRowTop(rowIndex) + this.getRowHeight(rowIndex);\r\n  }\r\n\r\n  @action.bound setColumnWidth(columnId: string, newWidth: number) {\r\n    this.columnWidths.set(columnId, Math.max(newWidth, 20));\r\n  }\r\n\r\n  @computed get displayedColumnDimensionsCom(): { left: number; width: number; right: number }[] {\r\n    const isCheckBoxedTable = getIsSelectionCheckboxesShown(this.ctx);\r\n    const groupedColumnIds = getGroupingConfiguration(this.ctx).orderedGroupingColumnSettings;\r\n    const tableColumnIds = getTableViewProperties(this.ctx).map((prop) => prop.id);\r\n    const columnWidths = this.columnWidths;\r\n\r\n    const widths = Array.from(\r\n      (function*() {\r\n        if (isCheckBoxedTable) yield 20;\r\n        yield*groupedColumnIds.map((id) => 20);\r\n        yield*tableColumnIds\r\n          .map((id) => columnWidths.get(id))\r\n          .filter((width) => width !== undefined) as number[];\r\n      })()\r\n    );\r\n    let acc = 0;\r\n    return Array.from(\r\n      (function*() {\r\n        for (let w of widths) {\r\n          yield {\r\n            left: acc,\r\n            width: w,\r\n            right: acc + w,\r\n          };\r\n          acc = acc + w;\r\n        }\r\n      })()\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IScrollState } from \"./types\";\r\nimport { action, observable } from \"mobx\";\r\n\r\nexport class SimpleScrollState implements IScrollState {\r\n  scrollToFunction: ((coords: { scrollLeft?: number; scrollTop?: number }) => void) | undefined;\r\n\r\n  constructor(scrollTop: number, scrollLeft: number) {\r\n    this.scrollTop = scrollTop;\r\n    this.scrollLeft = scrollLeft;\r\n  }\r\n\r\n  scrollTo(coords: { scrollLeft?: number; scrollTop?: number }) {\r\n    if (this.scrollToFunction) {\r\n      this.scrollToFunction(coords);\r\n    }\r\n  }\r\n\r\n  @observable scrollTop = 0;\r\n  @observable scrollLeft = 0;\r\n\r\n  @action.bound\r\n  setScrollOffset(event: any, scrollTop: number, scrollLeft: number): void {\r\n    // console.log(\"scroll event: \", scrollTop, scrollLeft);\r\n    this.scrollTop = scrollTop;\r\n    this.scrollLeft = scrollLeft;\r\n  }\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React, { RefObject } from \"react\";\r\nimport { ISearchResult } from \"model/entities/types/ISearchResult\";\r\nimport { action, observable } from \"mobx\";\r\nimport S from \"gui/Components/Search/ResultItem.module.scss\";\r\nimport { Icon } from \"@origam/components\";\r\n\r\n@observer\r\nexport class ResultItem extends React.Component<{\r\n  result: ISearchResult;\r\n  onResultItemClick: () => void;\r\n  selected: boolean;\r\n  registerElementRef: (id: string, ref: RefObject<HTMLDivElement>) => void;\r\n}> {\r\n\r\n  @observable\r\n  mouseOver = false;\r\n\r\n  divRef: RefObject<HTMLDivElement> = React.createRef();\r\n\r\n  componentDidMount() {\r\n    this.props.registerElementRef(this.props.result.id, this.divRef);\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.props.registerElementRef(this.props.result.id, this.divRef);\r\n  }\r\n\r\n  @action.bound\r\n  onClick() {\r\n    this.props.onResultItemClick();\r\n    this.props.result.onClick();\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div\r\n        className={S.resultIemRow + \" \" + (this.mouseOver ? S.resultIemRowHovered : \"\") + \" \" +\r\n          (this.props.selected ? S.resultIemRowSelected : \"\")}\r\n        ref={this.divRef}\r\n        onClick={() => this.onClick()}\r\n        onMouseOver={evt => this.mouseOver = true}\r\n        onMouseOut={evt => this.mouseOver = false}>\r\n        <div className={S.itemIcon}>\r\n          <Icon src={this.props.result.iconUrl}/>\r\n        </div>\r\n        <div className={S.itemContents}>\r\n          <div className={S.itemTitle}>\r\n            {this.props.result.label}\r\n          </div>\r\n          <div className={S.itemTextSeparator}>\r\n            {\" \"}\r\n          </div>\r\n          <div>\r\n            {this.props.result.description}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}","import { observer } from \"mobx-react\";\r\nimport React, { RefObject } from \"react\";\r\nimport { ISearchResultGroup } from \"model/entities/types/ISearchResultGroup\";\r\nimport { ISearchResult } from \"model/entities/types/ISearchResult\";\r\nimport S from \"gui/Components/Search/ResultGroup.module.scss\";\r\nimport { ResultItem } from \"gui/Components/Search/ResultItem\";\r\n\r\n@observer\r\nexport class ResultGroup extends React.Component<{\r\n  name: string;\r\n  group: ISearchResultGroup;\r\n  onResultItemClick: (result: ISearchResult) => void;\r\n  selectedResult: ISearchResult | undefined;\r\n  registerElementRef: (id: string, ref: RefObject<HTMLDivElement>) => void;\r\n}> {\r\n\r\n  onGroupClick() {\r\n    this.props.group.isExpanded = !this.props.group.isExpanded;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div>\r\n        <div className={S.resultGroupRow} onClick={() => this.onGroupClick()}>\r\n          {this.props.group.isExpanded ? (\r\n            <i className={\"fas fa-angle-up \" + S.arrow}/>\r\n          ) : (\r\n            <i className={\"fas fa-angle-down \" + S.arrow}/>\r\n          )}\r\n          <div className={S.groupName}>\r\n            {this.props.name}\r\n          </div>\r\n        </div>\r\n        <div>\r\n          {this.props.group.isExpanded && this.props.group.results.map(result =>\r\n            <ResultItem\r\n              key={result.label + result.description + result.iconUrl}\r\n              result={result}\r\n              onResultItemClick={() => this.props.onResultItemClick(result)}\r\n              selected={this.props.selectedResult?.id === result.id}\r\n              registerElementRef={this.props.registerElementRef}\r\n            />)\r\n          }\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbench } from \"../getWorkbench\";\r\n\r\n\r\nexport function getMainMenuState(ctx: any) {\r\n  return getWorkbench(ctx).sidebarState.mainMenuState;\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React, { RefObject } from \"react\";\r\nimport S from \"gui/Components/Search/SearchView.module.scss\";\r\nimport { Icon } from \"@origam/components\";\r\nimport { T } from \"utils/translation\";\r\nimport { ResultGroup } from \"gui/Components/Search/ResultGroup\";\r\nimport { getSearcher } from \"model/selectors/getSearcher\";\r\nimport { action, observable } from \"mobx\";\r\nimport { ISearchResult } from \"model/entities/types/ISearchResult\";\r\nimport { getMainMenuState } from \"model/selectors/MainMenu/getMainMenuState\";\r\nimport { ISearcher } from \"model/entities/types/ISearcher\";\r\n\r\nconst DELAY_BEFORE_SERVER_SEARCH_MS = 1000;\r\nexport const SEARCH_DIALOG_KEY = \"Search Dialog\";\r\n\r\n@observer\r\nexport class SearchView extends React.Component<{\r\n  state: SearchViewState\r\n}> {\r\n\r\n  get viewState() {\r\n    return this.props.state;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.viewState.input?.focus();\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className={\"searchView\"}>\r\n        <div className={S.inputRow}>\r\n          <Icon className={S.icon} src=\"./icons/search.svg\"/>\r\n          <input\r\n            ref={this.viewState.refInput}\r\n            className={S.input}\r\n            placeholder={T(\"Search for anything here\", \"type_search_here\")}\r\n            onKeyDown={(event) => this.viewState.onInputKeyDown(event)}\r\n            onChange={(event) => this.viewState.onInputChange(event)}\r\n          />\r\n        </div>\r\n        {(this.viewState.searcher.resultGroups.length > 0) &&\r\n          <div className={\"resultArea\"} ref={this.viewState.scrollDivRef}>\r\n            <div className={S.resultsContainer}>\r\n              {this.viewState.searcher.resultGroups\r\n                .map(group =>\r\n                  <ResultGroup\r\n                    key={group.name}\r\n                    name={group.name}\r\n                    group={group}\r\n                    onResultItemClick={result => this.viewState.onResultItemClick(result)}\r\n                    selectedResult={this.viewState.searcher.selectedResult}\r\n                    registerElementRef={(id, ref) => this.viewState.resultElementMap.set(id, ref)}\r\n                  />)\r\n              }\r\n            </div>\r\n          </div>\r\n        }\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n\r\nexport class SearchViewState {\r\n  input: HTMLInputElement | undefined;\r\n  refInput = (elm: HTMLInputElement) => (this.input = elm);\r\n\r\n  scrollDivRef: RefObject<HTMLDivElement> = React.createRef();\r\n  resultElementMap: Map<string, RefObject<HTMLDivElement>> = new Map();\r\n\r\n  searcher: ISearcher;\r\n\r\n  @observable\r\n  value = \"\";\r\n\r\n  timeout: NodeJS.Timeout | undefined;\r\n\r\n  constructor(\r\n    private ctx: any,\r\n    private onCloseClick: ()=>void)\r\n  {\r\n    this.searcher = getSearcher(this.ctx);\r\n    this.searcher.clear();\r\n  }\r\n\r\n  @action.bound\r\n  onKeyDown(event: any) {\r\n    if (event.key === \"Escape\") {\r\n      this.onCloseClick();\r\n      return;\r\n    }\r\n    if (event.key === \"ArrowDown\") {\r\n      event.preventDefault();\r\n      this.searcher.selectNextResult();\r\n      this.scrollToCell();\r\n      return;\r\n    }\r\n    if (event.key === \"ArrowUp\") {\r\n      event.preventDefault();\r\n      this.searcher.selectPreviousResult();\r\n      this.scrollToCell();\r\n      return;\r\n    }\r\n    if (event.key === \"Enter\") {\r\n      if (this.searcher.selectedResult) {\r\n        this.searcher.selectedResult.onClick();\r\n        this.onResultItemClick(this.searcher.selectedResult);\r\n      } else {\r\n        this.searcher.searchOnServer();\r\n      }\r\n      return;\r\n    }\r\n  }\r\n\r\n  onResultItemClick(result: ISearchResult) {\r\n    this.onCloseClick();\r\n    getMainMenuState(this.ctx).highlightItem(result.id);\r\n  }\r\n\r\n  scrollToCell() {\r\n    if (!this.searcher.selectedResult) {\r\n      return;\r\n    }\r\n    const scrollElement = this.scrollDivRef.current;\r\n    const selectedElement = this.resultElementMap.get(this.searcher.selectedResult.id)?.current;\r\n    if (!selectedElement || !scrollElement) {\r\n      return;\r\n    }\r\n    const selectedElementRectangle = selectedElement.getBoundingClientRect();\r\n    const scrollRectangle = scrollElement.getBoundingClientRect();\r\n    const distanceOverTop = scrollRectangle.top - selectedElementRectangle.top;\r\n\r\n    const scrollBarHeight = scrollRectangle.height - scrollElement.clientHeight;\r\n    const distanceUnderBottom = selectedElementRectangle.bottom - scrollRectangle.bottom + scrollBarHeight;\r\n\r\n    if (distanceOverTop > 0) {\r\n      scrollElement.scrollTop -= distanceOverTop;\r\n    } else if (distanceUnderBottom > 0) {\r\n      scrollElement.scrollTop += distanceUnderBottom;\r\n    } else if (distanceOverTop === 0) {\r\n      const resultIndices = this.searcher.getSelectedResultIndices();\r\n      const topItemSelected = resultIndices.groupIndex === 0 && resultIndices.indexInGroup === 0;\r\n      if (topItemSelected) {\r\n        scrollElement.scrollTop = 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  async onInputKeyDown(event: React.KeyboardEvent<HTMLInputElement>) {\r\n    if (this.timeout) {\r\n      clearTimeout(this.timeout);\r\n    }\r\n    this.timeout = setTimeout(() => {\r\n      this.timeout = undefined;\r\n      this.searcher.searchOnServer();\r\n    }, DELAY_BEFORE_SERVER_SEARCH_MS)\r\n  }\r\n\r\n  onInputChange(event: React.ChangeEvent<HTMLInputElement>): void {\r\n    this.value = event.target.value;\r\n    this.searcher.onSearchFieldChange(this.value);\r\n  }\r\n\r\n  clear() {\r\n    this.searcher.clear();\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { SearchView, SearchViewState } from \"gui/Components/Search/SearchView\";\r\nimport { ModalDialog } from \"gui/Components/Dialog/ModalDialog\";\r\n\r\n@observer\r\nexport class SearchDialog extends React.Component<{\r\n  ctx: any;\r\n  onCloseClick: () => void;\r\n}> {\r\n\r\n  searchViewState =  new SearchViewState(this.props.ctx, this.props.onCloseClick);\r\n\r\n  render() {\r\n    return (\r\n      <ModalDialog\r\n        title={null}\r\n        titleButtons={null}\r\n        buttonsCenter={null}\r\n        onKeyDown={(event: any) => this.searchViewState.onKeyDown(event)}\r\n        buttonsLeft={null}\r\n        buttonsRight={null}\r\n        topPosiotionProc={30}\r\n      >\r\n        <SearchView state={this.searchViewState}/>\r\n      </ModalDialog>\r\n    );\r\n  }\r\n}\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { SearchDialog } from \"gui/Components/Dialogs/SearchDialog\";\r\nimport { getDialogStack } from \"model/selectors/getDialogStack\";\r\nimport { getSearcher } from \"model/selectors/getSearcher\";\r\nimport React from \"react\";\r\nimport { SEARCH_DIALOG_KEY } from \"gui/Components/Search/SearchView\";\r\n\r\nexport function openSearchWindow(ctx: any) {\r\n  getSearcher(ctx).clear();\r\n\r\n  const closeDialog = getDialogStack(ctx).pushDialog(\r\n    SEARCH_DIALOG_KEY,\r\n    <SearchDialog\r\n      ctx={ctx}\r\n      onCloseClick={() => closeDialog()}\r\n    />,\r\n    undefined,\r\n    true\r\n  );\r\n}\r\n\r\nexport function isGlobalAutoFocusDisabled(ctx: any) {\r\n  return getDialogStack(ctx).isOpen(SEARCH_DIALOG_KEY);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport interface ITabIndexOwner {\r\n  tabIndex: string | undefined;\r\n}\r\n\r\nfunction getTabIndexFractions(tabIndexOwner: ITabIndexOwner): number[] {\r\n  if (tabIndexOwner.tabIndex) {\r\n    return tabIndexOwner.tabIndex\r\n      .split(\".\")\r\n      .filter((x) => x !== \"\")\r\n      .map((x) => parseInt(x));\r\n  }\r\n  return [1e6];\r\n}\r\n\r\n// TabIndex is a string separated by decimal points for example: 13, 14.0, 14.2, 14.15\r\n// The \"fractions\" have to be compared separately because 14.15 is greater than 14.2\r\n// Comparison as numbers would give different results\r\nexport function compareTabIndexOwners(x: ITabIndexOwner, y: ITabIndexOwner) {\r\n  return compareFraction(x, y, 0);\r\n}\r\n\r\nfunction compareFraction(\r\n  x: ITabIndexOwner,\r\n  y: ITabIndexOwner,\r\n  fractionIndex: number\r\n): number {\r\n  if (has(x, fractionIndex) && !has(y, fractionIndex)) {\r\n    return 1;\r\n  }\r\n  if (!has(x, fractionIndex) && has(y, fractionIndex)) {\r\n    return -1;\r\n  }\r\n  if (!has(x, fractionIndex) && !has(y, fractionIndex)) {\r\n    return 0;\r\n  }\r\n\r\n  const fractionDifference = getTabIndexFractions(x)[fractionIndex] - getTabIndexFractions(y)[fractionIndex];\r\n  if (fractionDifference !== 0) {\r\n    return fractionDifference;\r\n  }\r\n\r\n  return compareFraction(x, y, fractionIndex + 1);\r\n}\r\n\r\nfunction has(tabIndexOwner: ITabIndexOwner, fractionIndex: number) {\r\n  return getTabIndexFractions(tabIndexOwner).length - 1 >= fractionIndex;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { isGlobalAutoFocusDisabled } from \"model/actions-ui/ScreenToolbar/openSearchWindow\";\r\nimport { compareTabIndexOwners, ITabIndexOwner } from \"model/entities/TabIndexOwner\";\r\n\r\nexport class FormFocusManager {\r\n  autoFocusDisabled = false;\r\n\r\n  stopAutoFocus() {\r\n    this.autoFocusDisabled = true;\r\n  }\r\n\r\n  objectMap: Map<string, IFocusable> = new Map<string, IFocusable>();\r\n  focusAbleContainers: IFocusAbleObjectContainer[] = [];\r\n  private lastFocused: IFocusable | undefined;\r\n\r\n  setLastFocused(focusable: IFocusable) {\r\n    this.lastFocused = focusable;\r\n  }\r\n\r\n  constructor(public parent: any) {\r\n  }\r\n\r\n  subscribe(focusAbleObject: IFocusable, name: string | undefined, tabIndex: string | undefined) {\r\n    if (!focusAbleObject) {\r\n      return;\r\n    }\r\n    const focusAbleContainer = new FocusAbleObjectContainer(focusAbleObject, name, tabIndex);\r\n    const existingContainer = this.focusAbleContainers\r\n      .find(container => container.name && container.name === name ||\r\n        container.focusable === focusAbleObject);\r\n    if (existingContainer) {\r\n      this.focusAbleContainers.remove(existingContainer);\r\n    }\r\n    this.focusAbleContainers.push(focusAbleContainer);\r\n    this.focusAbleContainers = this.focusAbleContainers.sort(compareTabIndexOwners);\r\n  }\r\n\r\n  focus(name: string) {\r\n    let focusable = this.focusAbleContainers.find((container) => container.name === name)?.focusable;\r\n    this.focusAndRemember(focusable);\r\n  }\r\n\r\n  private focusAndRemember(focusable: IFocusable | undefined) {\r\n    if (!focusable) {\r\n      return;\r\n    }\r\n    this.lastFocused = focusable;\r\n    focusable.focus();\r\n  }\r\n\r\n  refocusLast() {\r\n    this.lastFocused?.focus();\r\n  }\r\n\r\n  forceAutoFocus() {\r\n    const focusable = this.focusAbleContainers[0].focusable;\r\n    if (focusable.disabled) {\r\n      //  (focusable as any).readOnly returns always false => readonly fields cannot be skipped\r\n      this.focusNext(focusable);\r\n      return;\r\n    }\r\n    setTimeout(() => {\r\n      this.focusAndRemember(focusable);\r\n    }, 0);\r\n  }\r\n\r\n  autoFocus() {\r\n    if (this.focusAbleContainers.length === 0 || this.autoFocusDisabled || isGlobalAutoFocusDisabled(this.parent)) {\r\n      return;\r\n    }\r\n    this.forceAutoFocus();\r\n  }\r\n\r\n  focusNext(activeElement: any) {\r\n    this.focusNextInternal(activeElement, 0);\r\n  }\r\n\r\n  focusNextInternal(activeElement: any, callNumber: number) {\r\n    if (callNumber > 20) {\r\n      return;\r\n    }\r\n    const currentContainerIndex = this.focusAbleContainers.findIndex(\r\n      (container) => container.focusable === activeElement\r\n    );\r\n    const nextIndex =\r\n      this.focusAbleContainers.length - 1 > currentContainerIndex ? currentContainerIndex + 1 : 0;\r\n    const focusable = this.focusAbleContainers[nextIndex].focusable;\r\n    if (focusable !== activeElement && focusable.disabled) {\r\n      this.focusNextInternal(focusable, callNumber + 1);\r\n    } else {\r\n      setTimeout(() => {\r\n        this.focusAndRemember(focusable);\r\n      });\r\n    }\r\n  }\r\n\r\n  focusPrevious(activeElement: any) {\r\n    const currentContainerIndex = this.focusAbleContainers.findIndex(\r\n      (container) => container.focusable === activeElement\r\n    );\r\n    const previousIndex =\r\n      currentContainerIndex === 0 ? this.focusAbleContainers.length - 1 : currentContainerIndex - 1;\r\n    const focusable = this.focusAbleContainers[previousIndex].focusable;\r\n    if (focusable.disabled) {\r\n      this.focusPrevious(focusable);\r\n    } else {\r\n      setTimeout(() => {\r\n        this.focusAndRemember(focusable);\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport interface IFocusAbleObjectContainer extends ITabIndexOwner{\r\n  name: string | undefined;\r\n  focusable: IFocusable;\r\n  tabIndex: string | undefined;\r\n}\r\n\r\nexport class FocusAbleObjectContainer implements IFocusAbleObjectContainer {\r\n  constructor(\r\n    public focusable: IFocusable,\r\n    public name: string | undefined,\r\n    public tabIndex: string | undefined\r\n  ) {\r\n  }\r\n}\r\n\r\nexport interface IFocusable {\r\n  focus(): void;\r\n\r\n  disabled: boolean;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getSelectionMember(ctx: any) {\r\n  return getDataView(ctx).selectionMember;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getOrderingConfiguration } from \"./getOrderingConfiguration\";\r\n\r\nexport function getPropertyOrdering(ctx: any, column: string) {\r\n  return getOrderingConfiguration(ctx).getOrdering(column);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataSourceFieldByName } from \"./getDataSourceFieldByName\";\r\n\r\nexport function getDataSourceFieldIndexByName(ctx: any, name: string) {\r\n  return getDataSourceFieldByName(ctx, name)?.index;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { getWorkbenchLifecycle } from \"model/selectors/getWorkbenchLifecycle\";\r\nimport { handleError } from \"model/actions/handleError\";\r\n\r\nexport function onMainMenuItemClick(ctx: any) {\r\n  return flow(function*onMainMenuItemClick(args: {\r\n    event: any;\r\n    item: any;\r\n    idParameter: string | undefined;\r\n    isSingleRecordEdit?: boolean;\r\n    forceOpenNew?: boolean;\r\n  }) {\r\n    try {\r\n      yield*getWorkbenchLifecycle(ctx).onMainMenuItemClick(args);\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbench } from \"../getWorkbench\";\r\n\r\nexport function getRecordInfo(ctx: any) {\r\n  return getWorkbench(ctx).recordInfo;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { getRecordInfo } from \"model/selectors/RecordInfo/getRecordInfo\";\r\n\r\nexport function onSelectedRowChange(ctx: any) {\r\n  return flow(function*onPossibleSelectedRowChange(\r\n    menuId: string,\r\n    dataStructureEntityId: string,\r\n    rowId: string | undefined\r\n  ) {\r\n    yield*getRecordInfo(ctx).onSelectedRowMaybeChanged(\r\n      menuId,\r\n      dataStructureEntityId,\r\n      rowId\r\n    );\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\n\r\nexport function getConfigurationManager(ctx: any) {\r\n  return getDataView(ctx).tablePanelView.configurationManager;\r\n}","import { getTablePanelView } from \"../selectors/TablePanelView/getTablePanelView\";\r\nimport { getDataView } from \"../selectors/DataView/getDataView\";\r\nimport { IFocusable } from \"./FormFocusManager\";\r\nimport { getFilterConfiguration } from \"model/selectors/DataView/getFilterConfiguration\";\r\n\r\nexport class GridFocusManager {\r\n  private _activeEditor: IFocusable | undefined;\r\n  public focusTableOnReload: boolean = true;\r\n\r\n  constructor(public parent: any) {\r\n  }\r\n\r\n  focusTableIfNeeded() {\r\n    const filtersVisible = getFilterConfiguration(this.parent).isFilterControlsDisplayed;\r\n    const filterInputHasFocus = filtersVisible && document.activeElement?.tagName === 'INPUT';\r\n    if (this.focusTableOnReload && !filterInputHasFocus) {\r\n      getTablePanelView(this)?.triggerOnFocusTable();\r\n    } else {\r\n      this.focusTableOnReload = true;\r\n    }\r\n  }\r\n\r\n  get activeEditor(): IFocusable | undefined {\r\n    return this._activeEditor;\r\n  }\r\n\r\n  set activeEditor(value: IFocusable | undefined) {\r\n    this._activeEditor = value;\r\n    this.focusEditor();\r\n  }\r\n\r\n  focusEditor() {\r\n    this._activeEditor?.focus();\r\n  }\r\n}\r\n\r\nexport function getGridFocusManager(ctx: any) {\r\n  return getDataView(ctx).gridFocusManager;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action, computed, observable, reaction } from \"mobx\";\r\nimport { getParentRow } from \"model/selectors/DataView/getParentRow\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\nimport { getDataSourceByEntity } from \"model/selectors/DataSources/getDataSourceByEntity\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { getFormScreen } from \"model/selectors/FormScreen/getFormScreen\";\r\nimport { getIsDialog } from \"model/selectors/getIsDialog\";\r\nimport { IDataViewLifecycle } from \"model/entities/DataViewLifecycle/types/IDataViewLifecycle\";\r\nimport { IFormPanelView } from \"model/entities/FormPanelView/types/IFormPanelView\";\r\nimport { ITablePanelView } from \"model/entities/TablePanelView/types/ITablePanelView\";\r\nimport { IAction, IActionPlacement, IActionType } from \"model/entities/types/IAction\";\r\nimport { IDataTable } from \"model/entities/types/IDataTable\";\r\nimport { IDataView, IDataViewData } from \"model/entities/types/IDataView\";\r\nimport { IPanelViewType } from \"model/entities/types/IPanelViewType\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { getBindingToParent } from \"model/selectors/DataView/getBindingToParent\";\r\nimport { getDataSourceFieldByName } from \"model/selectors/DataSources/getDataSourceFieldByName\";\r\nimport { getBindingParent } from \"model/selectors/DataView/getBindingParent\";\r\nimport { ILookupLoader } from \"model/entities/types/ILookupLoader\";\r\nimport bind from \"bind-decorator\";\r\nimport { getRowStateMayCauseFlicker } from \"model/selectors/RowState/getRowStateMayCauseFlicker\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\nimport { ServerSideGrouper } from \"model/entities/ServerSideGrouper\";\r\nimport { ClientSideGrouper } from \"model/entities/ClientSideGrouper\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { getTableViewProperties } from \"model/selectors/TablePanelView/getTableViewProperties\";\r\nimport { getIsSelectionCheckboxesShown } from \"model/selectors/DataView/getIsSelectionCheckboxesShown\";\r\nimport { getGroupingConfiguration } from \"model/selectors/TablePanelView/getGroupingConfiguration\";\r\nimport { flattenToTableRows } from \"gui/Components/ScreenElements/Table/TableRendering/tableRows\";\r\nimport { GridDimensions } from \"gui/Workbench/ScreenArea/TableView/GridDimensions\";\r\nimport { SimpleScrollState } from \"gui/Components/ScreenElements/Table/SimpleScrollState\";\r\nimport { BoundingRect } from \"react-measure\";\r\nimport { IGridDimensions } from \"gui/Components/ScreenElements/Table/types\";\r\nimport { FormFocusManager } from \"model/entities/FormFocusManager\";\r\nimport { getRowStates } from \"model/selectors/RowState/getRowStates\";\r\nimport { getLookupLoader } from \"model/selectors/DataView/getLookupLoader\";\r\nimport { DataViewData } from \"modules/DataView/DataViewData\";\r\nimport { DataViewAPI } from \"modules/DataView/DataViewAPI\";\r\nimport { RowCursor } from \"modules/DataView/TableCursor\";\r\nimport { isLazyLoading } from \"model/selectors/isLazyLoading\";\r\nimport {\r\n  IInfiniteScrollLoader,\r\n  InfiniteScrollLoader,\r\n  NullIScrollLoader,\r\n} from \"gui/Workbench/ScreenArea/TableView/InfiniteScrollLoader\";\r\nimport { ScrollRowContainer } from \"model/entities/ScrollRowContainer\";\r\nimport { VisibleRowsMonitor } from \"gui/Workbench/ScreenArea/TableView/VisibleRowsMonitor\";\r\nimport { getSelectionMember } from \"model/selectors/DataView/getSelectionMember\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { getSessionId } from \"model/selectors/getSessionId\";\r\nimport { getGrouper } from \"model/selectors/DataView/getGrouper\";\r\nimport { getUserFilters } from \"model/selectors/DataView/getUserFilters\";\r\nimport { getMenuItemId } from \"model/selectors/getMenuItemId\";\r\nimport { getDataStructureEntityId } from \"model/selectors/DataView/getDataStructureEntityId\";\r\nimport { getUserOrdering } from \"model/selectors/DataView/getUserOrdering\";\r\nimport { getColumnNamesToLoad } from \"model/selectors/DataView/getColumnNamesToLoad\";\r\nimport { getUserFilterLookups } from \"model/selectors/DataView/getUserFilterLookups\";\r\nimport { isInfiniteScrollingActive } from \"model/selectors/isInfiniteScrollingActive\";\r\nimport { getPropertyOrdering } from \"model/selectors/DataView/getPropertyOrdering\";\r\nimport { IOrderByDirection } from \"model/entities/types/IOrderingConfiguration\";\r\n\r\nimport selectors from \"model/selectors-tree\";\r\nimport produce from \"immer\";\r\nimport { getDataSourceFieldIndexByName } from \"model/selectors/DataSources/getDataSourceFieldIndexByName\";\r\nimport { onMainMenuItemClick } from \"model/actions-ui/MainMenu/onMainMenuItemClick\";\r\nimport { onSelectedRowChange } from \"model/actions-ui/onSelectedRowChange\";\r\nimport { runInFlowWithHandler, } from \"utils/runInFlowWithHandler\";\r\nimport { IAggregation } from 'model/entities/types/IAggregation';\r\nimport { getConfigurationManager } from \"model/selectors/TablePanelView/getConfigurationManager\";\r\nimport { GridFocusManager } from \"model/entities/GridFocusManager\";\r\n\r\nclass SavedViewState {\r\n  constructor(public selectedRowId: string | undefined) {\r\n  }\r\n}\r\n\r\nexport class DataView implements IDataView {\r\n  $type_IDataView: 1 = 1;\r\n  formFocusManager: FormFocusManager = new FormFocusManager(this);\r\n  gridFocusManager: GridFocusManager = new GridFocusManager(this);\r\n\r\n  @observable aggregationData: IAggregation[] = [];\r\n\r\n  constructor(data: IDataViewData) {\r\n    Object.assign(this, data);\r\n    this.properties.forEach((o) => (o.parent = this));\r\n    this.actions.forEach((o) => (o.parent = this));\r\n    this.defaultActions = this.actions.filter((action) => action.isDefault);\r\n    this.dataTable.parent = this;\r\n    this.lifecycle.parent = this;\r\n    this.tablePanelView.parent = this;\r\n    this.formPanelView.parent = this;\r\n    this.lookupLoader.parent = this;\r\n    this.clientSideGrouper.parent = this;\r\n    this.serverSideGrouper.parent = this;\r\n\r\n    this.gridDimensions = new GridDimensions({\r\n      getTableViewProperties: () => getTableViewProperties(this),\r\n      getRowCount: () => this.tableRows.length,\r\n      getIsSelectionCheckboxes: () =>\r\n        getIsSelectionCheckboxesShown(this.tablePanelView),\r\n      ctx: this,\r\n      defaultRowHeight: this.tablePanelView.rowHeight,\r\n    });\r\n\r\n    this.orderProperty = this.properties.find(\r\n      (prop) => prop.id === this.orderMember\r\n    )!;\r\n    this.dataTable.rowRemovedListeners.push(\r\n      () => (this.selectAllCheckboxChecked = false)\r\n    );\r\n  }\r\n\r\n  private _isFormViewActive = () => false;\r\n\r\n  set isFormViewActive(value: () => boolean) {\r\n    this._isFormViewActive = value;\r\n  }\r\n\r\n  get isFormViewActive() {\r\n    return this._isFormViewActive;\r\n  }\r\n\r\n  private _isTableViewActive = () => false;\r\n\r\n  set isTableViewActive(value: () => boolean) {\r\n    this._isTableViewActive = value;\r\n  }\r\n\r\n  get isTableViewActive() {\r\n    return this._isTableViewActive;\r\n  }\r\n\r\n  @action.bound\r\n  setRowCount(rowCount: number) {\r\n    this.rowCount = rowCount;\r\n    this.dataTable.rowsAddedSinceSave = 0;\r\n  }\r\n\r\n  @observable\r\n  rowCount: number | undefined;\r\n\r\n  @computed\r\n  get totalRowCount() {\r\n    if (!this.rowCount) {\r\n      return this.rowCount;\r\n    }\r\n    return this.rowCount + this.dataTable.rowsAddedSinceSave;\r\n  }\r\n\r\n  orderProperty: IProperty;\r\n  activateFormView:\r\n    | ((args?: { saveNewState: boolean }) => Promise<any>)\r\n    | undefined;\r\n  activateTableView: (() => Promise<any>) | undefined;\r\n\r\n  gridDimensions: IGridDimensions;\r\n\r\n  id = \"\";\r\n  modelInstanceId = \"\";\r\n  name = \"\";\r\n  modelId = \"\";\r\n  defaultPanelView = IPanelViewType.Table;\r\n  isHeadless = false;\r\n  isMapSupported = false;\r\n  disableActionButtons = false;\r\n  showAddButton = false;\r\n  showDeleteButton = false;\r\n  showSelectionCheckboxesSetting = false;\r\n  isGridHeightDynamic = false;\r\n  selectionMember = \"\";\r\n  orderMember = \"\";\r\n  isDraggingEnabled = false;\r\n  entity = \"\";\r\n  dataMember = \"\";\r\n  isRootGrid = false;\r\n  isRootEntity = false;\r\n  isPreloaded = false;\r\n  newRecordView: string | undefined;\r\n  requestDataAfterSelectionChange = false;\r\n  confirmSelectionChange = false;\r\n  properties: IProperty[] = [];\r\n  actions: IAction[] = [];\r\n  defaultActions: IAction[] = [];\r\n  type: string = \"\";\r\n\r\n  @observable tableViewProperties: IProperty[] = [];\r\n  dataTable: IDataTable = null as any;\r\n  formViewUI: any;\r\n  lifecycle: IDataViewLifecycle = null as any;\r\n  tablePanelView: ITablePanelView = null as any;\r\n  formPanelView: IFormPanelView = null as any;\r\n  lookupLoader: ILookupLoader = null as any;\r\n  serverSideGrouper: ServerSideGrouper = null as any;\r\n  clientSideGrouper: ClientSideGrouper = null as any;\r\n  isFirst: boolean = null as any;\r\n\r\n  dataViewRowCursor: RowCursor = null as any;\r\n  dataViewApi: DataViewAPI = null as any;\r\n  dataViewData: DataViewData = null as any;\r\n\r\n  @observable selectAllCheckboxChecked = false;\r\n  @observable selectedRowIds: Set<string> = new Set();\r\n\r\n  @observable activePanelView: IPanelViewType = IPanelViewType.Table;\r\n\r\n  @observable selectedRowId: string | undefined;\r\n\r\n  @computed get showSelectionCheckboxes() {\r\n    return this.showSelectionCheckboxesSetting || !!this.selectionMember;\r\n  }\r\n\r\n  @computed get firstEnabledDefaultAction() {\r\n    return this.defaultActions.find((action) => action.isEnabled);\r\n  }\r\n\r\n  @bind hasSelectedRowId(id: string) {\r\n    return this.selectedRowIds.has(id);\r\n  }\r\n\r\n  appendRecords(rows: any[][]): void {\r\n    this.dataTable.appendRecords(rows);\r\n    this.selectedRowIds.clear();\r\n    this.selectAllCheckboxChecked =\r\n      this.dataTable.rows.length !== 0 &&\r\n      this.dataTable.rows.every((row) =>\r\n        this.isSelected(this.dataTable.getRowId(row))\r\n      );\r\n  }\r\n\r\n  async setRecords(rows: any[][]): Promise<any> {\r\n    await this.dataTable.setRecords(rows);\r\n    const filteredRows = this.dataTable.rows;\r\n    const filteredRowIds = filteredRows.map((row) =>\r\n      this.dataTable.getRowId(row)\r\n    );\r\n    this.selectedRowIds = new Set(\r\n      Array.from(this.selectedRowIds).filter((id) =>\r\n        filteredRowIds.includes(id)\r\n      )\r\n    );\r\n    this.selectAllCheckboxChecked =\r\n      this.dataTable.rows.length !== 0 &&\r\n      this.dataTable.rows.every((row) =>\r\n        this.isSelected(this.dataTable.getRowId(row))\r\n      );\r\n  }\r\n\r\n  isSelected(rowId: string): boolean {\r\n    const selectionMember = getSelectionMember(this);\r\n    if (!!selectionMember) {\r\n      const dataSourceField = getDataSourceFieldByName(this, selectionMember)!;\r\n      if (!dataSourceField) {\r\n        throw new Error(\r\n          `SelectionMember \"${selectionMember}\" was not found in data source. Make sure the SelectionMember value in ${this.modelInstanceId} is correct`\r\n        );\r\n      }\r\n      const updatedRow = this.dataTable.getRowById(rowId)!;\r\n      return this.dataTable.getCellValueByDataSourceField(\r\n        updatedRow,\r\n        dataSourceField\r\n      );\r\n    }\r\n    return this.selectedRowIds.has(rowId);\r\n  }\r\n\r\n  @action.bound addSelectedRowId(id: string) {\r\n    this.selectedRowIds.add(id);\r\n  }\r\n\r\n  @action.bound removeSelectedRowId(id: string) {\r\n    this.selectedRowIds.delete(id);\r\n    this.selectAllCheckboxChecked = false;\r\n  }\r\n\r\n  @action.bound\r\n  clear() {\r\n    this.selectedRowIds.clear();\r\n    this.dataTable.clear();\r\n  }\r\n\r\n  @action.bound\r\n  deleteRowAndSelectNext(row: any[]) {\r\n    const id = this.dataTable.getRowId(row);\r\n    let idToSelectNext = this.dataTable.getNextExistingRowId(id);\r\n    if (!idToSelectNext) {\r\n      idToSelectNext = this.dataTable.getPrevExistingRowId(id);\r\n    }\r\n\r\n    this.selectedRowIds.delete(id);\r\n    this.dataTable.deleteRow(row);\r\n\r\n    this.setSelectedRowId(idToSelectNext);\r\n  }\r\n\r\n  @action.bound\r\n  substituteRecord(row: any[]) {\r\n    if(!getSelectionMember(this)){\r\n      const rowId = this.dataTable.getRowId(row);\r\n      this.removeSelectedRowId(rowId);\r\n    }\r\n    this.dataTable.substituteRecord(row);\r\n    if (getGroupingConfiguration(this).isGrouping) {\r\n      getGrouper(this).substituteRecord(row);\r\n    }\r\n  }\r\n\r\n  @action.bound setSelectedState(rowId: string, newState: boolean) {\r\n    if (newState) {\r\n      this.addSelectedRowId(rowId);\r\n    } else {\r\n      this.removeSelectedRowId(rowId);\r\n    }\r\n  }\r\n\r\n  @computed get selectedRowIndex(): number | undefined {\r\n    if (getGroupingConfiguration(this).isGrouping) {\r\n      return getGrouper(this).allGroups.some((group) => group.isExpanded)\r\n        ? getGrouper(this).getRowIndex(this.selectedRowId!)\r\n        : undefined;\r\n    } else {\r\n      return this.selectedRowId\r\n        ? this.dataTable.getExistingRowIdxById(this.selectedRowId)\r\n        : undefined;\r\n    }\r\n  }\r\n\r\n  @computed get trueSelectedRowIndex(): number | undefined {\r\n    if (getGroupingConfiguration(this).isGrouping) {\r\n      return getGrouper(this).allGroups.some((group) => group.isExpanded)\r\n        ? getGrouper(this).getRowIndex(this.selectedRowId!)\r\n        : undefined;\r\n    } else {\r\n      return this.selectedRowId\r\n        ? this.dataTable.getTrueIndexById(this.selectedRowId)\r\n        : undefined;\r\n    }\r\n  }\r\n\r\n  @computed get selectedRow(): any[] | undefined {\r\n    if (!this.selectedRowId) {\r\n      return undefined;\r\n    }\r\n    if (getGroupingConfiguration(this).isGrouping) {\r\n      return getGrouper(this).getRowById(this.selectedRowId!);\r\n    } else {\r\n      return this.selectedRowIndex !== undefined\r\n        ? this.dataTable.getRowByExistingIdx(this.selectedRowIndex)\r\n        : undefined;\r\n    }\r\n  }\r\n\r\n  @computed get isValidRowSelection(): boolean {\r\n    return this.selectedRowIndex !== undefined;\r\n  }\r\n\r\n  @computed get panelViewActions() {\r\n    const rowStateMayCauseFlicker = getRowStateMayCauseFlicker(this);\r\n    if (rowStateMayCauseFlicker && !this.dataTable.isEmpty) {\r\n      return [];\r\n    }\r\n    return this.actions.filter(\r\n      (action) => action.placement === IActionPlacement.PanelHeader\r\n    );\r\n  }\r\n\r\n  @computed get panelMenuActions() {\r\n    const rowStateMayCauseFlicker = getRowStateMayCauseFlicker(this);\r\n    if (rowStateMayCauseFlicker && !this.dataTable.isEmpty) {\r\n      return [];\r\n    }\r\n    return this.actions.filter(\r\n      (action) => action.placement === IActionPlacement.PanelMenu\r\n    );\r\n  }\r\n\r\n  @computed get toolbarActions() {\r\n    const rowStateMayCauseFlicker = getRowStateMayCauseFlicker(this);\r\n    if (rowStateMayCauseFlicker && !this.dataTable.isEmpty) {\r\n      return [];\r\n    }\r\n    return this.actions.filter(\r\n      (action) =>\r\n        action.placement === IActionPlacement.Toolbar &&\r\n        action.type !== IActionType.SelectionDialogAction &&\r\n        !getIsDialog(this)\r\n    );\r\n  }\r\n\r\n  @computed get dialogActions() {\r\n    return this.actions.filter(\r\n      (action) =>\r\n        action.type === IActionType.SelectionDialogAction || getIsDialog(this)\r\n    );\r\n  }\r\n\r\n  @computed get isWorking() {\r\n    return (\r\n      this.lifecycle.isWorking ||\r\n      getRowStates(this).isWorking ||\r\n      getLookupLoader(this).isWorking\r\n    );\r\n  }\r\n\r\n  @computed get isAnyBindingAncestorWorking() {\r\n    if (this.isBindingRoot) {\r\n      return false;\r\n    } else {\r\n      return (\r\n        this.bindingParent.isWorking ||\r\n        this.bindingParent.isAnyBindingAncestorWorking\r\n      );\r\n    }\r\n  }\r\n\r\n  @computed\r\n  get isBindingRoot() {\r\n    return this.parentBindings.length === 0;\r\n  }\r\n\r\n  @computed get isBindingParent() {\r\n    return this.childBindings.length > 0;\r\n  }\r\n\r\n  @computed get bindingParent() {\r\n    return this.parentBindings?.[0]?.parentDataView;\r\n  }\r\n\r\n  @computed get bindingRoot(): IDataView {\r\n    // TODO: If there ever is multi parent case, remove duplicates in the result\r\n    let root: IDataView = this;\r\n    while (!root.isBindingRoot) {\r\n      root = root.bindingParent!;\r\n    }\r\n    return root;\r\n  }\r\n\r\n  @computed\r\n  get parentBindings() {\r\n    const screen = getFormScreen(this);\r\n    return screen.getBindingsByChildId(this.modelInstanceId);\r\n  }\r\n\r\n  @computed\r\n  get childBindings() {\r\n    const screen = getFormScreen(this);\r\n    return screen.getBindingsByParentId(this.modelInstanceId);\r\n  }\r\n\r\n  @computed get dataSource() {\r\n    return getDataSourceByEntity(this, this.entity)!;\r\n  }\r\n\r\n  @computed get bindingParametersFromParent() {\r\n    const parentRow = getParentRow(this);\r\n    if (parentRow) {\r\n      const parent = getBindingParent(this);\r\n      const parentDataTable = getDataTable(parent);\r\n\r\n      const bindingToParent = getBindingToParent(this)!;\r\n      const result: { [key: string]: string } = {};\r\n      for (let bp of bindingToParent.bindingPairs) {\r\n        const parentDataSourceField = getDataSourceFieldByName(\r\n          parent,\r\n          bp.parentPropertyId\r\n        )!;\r\n        result[bp.childPropertyId] =\r\n          parentDataTable.getCellValueByDataSourceField(\r\n            parentRow,\r\n            parentDataSourceField\r\n          );\r\n      }\r\n      return result;\r\n    } else {\r\n      return {};\r\n    }\r\n  }\r\n\r\n  @action.bound moveSelectedRowUp() {\r\n    if (!this.selectedRowId) {\r\n      return;\r\n    }\r\n    const ordering = getPropertyOrdering(this, this.orderMember);\r\n    if (ordering.ordering === IOrderByDirection.ASC) {\r\n      this.moveSelectedRowDownIndexwise();\r\n    } else {\r\n      this.moveSelectedRowUpIndexwise();\r\n    }\r\n  }\r\n\r\n  @action.bound moveSelectedRowDown() {\r\n    if (!this.selectedRowId) {\r\n      return;\r\n    }\r\n    const ordering = getPropertyOrdering(this, this.orderMember);\r\n    if (ordering.ordering === IOrderByDirection.ASC) {\r\n      this.moveSelectedRowUpIndexwise();\r\n    } else {\r\n      this.moveSelectedRowDownIndexwise();\r\n    }\r\n  }\r\n\r\n  @action.bound moveSelectedRowUpIndexwise() {\r\n    if (!this.selectedRowId) {\r\n      return;\r\n    }\r\n    const dataTable = getDataTable(this);\r\n    const selectedRow = dataTable.getRowById(this.selectedRowId)!;\r\n    const positionIndex = getDataSourceFieldByName(\r\n      this,\r\n      this.orderMember\r\n    )!.index;\r\n    const selectedRowPosition = selectedRow[positionIndex];\r\n    const nextRow = dataTable.rows.find(\r\n      (row) => row[positionIndex] === selectedRowPosition + 1\r\n    );\r\n    if (!nextRow) {\r\n      return;\r\n    }\r\n    selectedRow[positionIndex] += 1;\r\n    nextRow[positionIndex] -= 1;\r\n    this.dataTable.substituteRecord(selectedRow);\r\n    this.dataTable.substituteRecord(nextRow);\r\n    this.dataTable.updateSortAndFilter({retainPreviousSelection: true});\r\n    this.dataTable.setDirtyValue(\r\n      selectedRow,\r\n      this.orderMember,\r\n      selectedRow[positionIndex]\r\n    );\r\n    this.dataTable.setDirtyValue(\r\n      nextRow,\r\n      this.orderMember,\r\n      nextRow[positionIndex]\r\n    );\r\n  }\r\n\r\n  @action.bound moveSelectedRowDownIndexwise() {\r\n    if (!this.selectedRowId) {\r\n      return;\r\n    }\r\n    const dataTable = getDataTable(this);\r\n    const selectedRow = dataTable.getRowById(this.selectedRowId)!;\r\n    const positionIndex = getDataSourceFieldByName(\r\n      this,\r\n      this.orderMember\r\n    )!.index;\r\n    const selectedRowPosition = selectedRow[positionIndex];\r\n    const previous = dataTable.rows.find(\r\n      (row) => row[positionIndex] === selectedRowPosition - 1\r\n    );\r\n    if (!previous) {\r\n      return;\r\n    }\r\n    selectedRow[positionIndex] -= 1;\r\n    previous[positionIndex] += 1;\r\n    this.dataTable.substituteRecord(selectedRow);\r\n    this.dataTable.substituteRecord(previous);\r\n    this.dataTable.updateSortAndFilter({retainPreviousSelection: true});\r\n    this.dataTable.setDirtyValue(\r\n      selectedRow,\r\n      this.orderMember,\r\n      selectedRow[positionIndex]\r\n    );\r\n    this.dataTable.setDirtyValue(\r\n      previous,\r\n      this.orderMember,\r\n      previous[positionIndex]\r\n    );\r\n  }\r\n\r\n  @action.bound selectNextRow() {\r\n    const selectedRowId = getSelectedRowId(this);\r\n\r\n    let newId = undefined;\r\n    if (selectedRowId) {\r\n      newId = getGroupingConfiguration(this).isGrouping\r\n        ? getGrouper(this).getNextRowId(selectedRowId)\r\n        : getDataTable(this).getNextExistingRowId(selectedRowId);\r\n    }\r\n    if (newId) {\r\n      this.setSelectedRowId(newId);\r\n    }\r\n  }\r\n\r\n  @action.bound selectPrevRow() {\r\n    const selectedRowId = getSelectedRowId(this);\r\n\r\n    let newId = undefined;\r\n    if (selectedRowId) {\r\n      newId = getGroupingConfiguration(this).isGrouping\r\n        ? getGrouper(this).getPreviousRowId(selectedRowId)\r\n        : getDataTable(this).getPrevExistingRowId(selectedRowId);\r\n    }\r\n    if (newId) {\r\n      this.setSelectedRowId(newId);\r\n    }\r\n  }\r\n\r\n  *navigateLookupLink(property: IProperty, row: any[]): any {\r\n    const columnId = property.id;\r\n    const fieldIndex = getDataSourceFieldIndexByName(this, columnId);\r\n    if (fieldIndex === undefined) return;\r\n    const value = row[fieldIndex];\r\n    const menuId = yield selectors.column.getLinkMenuId(property, value);\r\n    let menuItem = menuId && selectors.mainMenu.getItemById(this, menuId);\r\n    if (menuItem) {\r\n      menuItem = {...menuItem, parent: undefined, elements: []};\r\n      menuItem = produce(menuItem, (draft: any) => {\r\n        if (menuItem.attributes.type.startsWith(\"FormReferenceMenuItem\")) {\r\n          draft.attributes.type = \"FormReferenceMenuItem\";\r\n        }\r\n        draft.attributes.lazyLoading = \"false\";\r\n      });\r\n\r\n      yield onMainMenuItemClick(this)({\r\n        event: undefined,\r\n        item: menuItem,\r\n        idParameter: value,\r\n        isSingleRecordEdit: true,\r\n      });\r\n    }\r\n  }\r\n\r\n  @action.bound onFieldChange(\r\n    event: any,\r\n    row: any[],\r\n    property: IProperty,\r\n    newValue: any\r\n  ) {\r\n    if (!property.readOnly) {\r\n      const currentValue = getDataTable(this).getCellValue(row, property);\r\n      if (newValue === currentValue) {\r\n        return;\r\n      }\r\n      getDataTable(this).setFormDirtyValue(row, property.id, newValue);\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  *loadFirstPage(): any {\r\n    if (this.infiniteScrollLoader) yield*this.infiniteScrollLoader!.loadFirstPage();\r\n  }\r\n\r\n  @action.bound\r\n  *loadLastPage(): any {\r\n    if (this.infiniteScrollLoader) yield*this.infiniteScrollLoader!.loadLastPage();\r\n  }\r\n\r\n  @action.bound selectFirstRow() {\r\n    if (getGroupingConfiguration(this).isGrouping) {\r\n      return;\r\n    }\r\n    const dataTable = getDataTable(this);\r\n    const firstRow = dataTable.getFirstRow();\r\n    if (firstRow) {\r\n      this.setSelectedRowId(dataTable.getRowId(firstRow));\r\n    } else {\r\n      this.setSelectedRowId(undefined);\r\n    }\r\n  }\r\n\r\n  @action.bound selectLastRow() {\r\n    if (getGroupingConfiguration(this).isGrouping) {\r\n      return;\r\n    }\r\n    const dataTable = getDataTable(this);\r\n    const lastRow = dataTable.getLastRow();\r\n    if (lastRow) {\r\n      this.setSelectedRowId(dataTable.getRowId(lastRow));\r\n    } else {\r\n      this.setSelectedRowId(undefined);\r\n    }\r\n  }\r\n\r\n  reselectOrSelectFirst() {\r\n    const previouslySelectedRowExists =\r\n      this.selectedRowId && this.dataTable.getRowById(this.selectedRowId);\r\n    if (!this.isRootGrid || !previouslySelectedRowExists || !this.selectedRow) {\r\n      this.selectFirstRow();\r\n    }\r\n  }\r\n\r\n  @action.bound selectRow(row: any[]) {\r\n    this.setSelectedRowId(this.dataTable.getRowId(row));\r\n  }\r\n\r\n  @action.bound\r\n  setSelectedRowId(id: string | undefined): void {\r\n    if (this.selectedRowId === id) {\r\n      return;\r\n    }\r\n    this.selectedRowId = id;\r\n    if (this.isBindingParent) {\r\n      this.childBindings.forEach((binding) =>\r\n        binding.childDataView.dataTable.updateSortAndFilter()\r\n      );\r\n    }\r\n    const self = this;\r\n    if (!this.selectedRowId) {\r\n      return;\r\n    }\r\n\r\n    if (getFormScreenLifecycle(this).focusedDataViewId === this.id) {\r\n      runInFlowWithHandler({\r\n        ctx: self,\r\n        action: async () => {\r\n          await onSelectedRowChange(self)(\r\n            getMenuItemId(self),\r\n            getDataStructureEntityId(self),\r\n            self.selectedRowId\r\n          );\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  viewStateStack: SavedViewState[] = [];\r\n\r\n  @action.bound\r\n  saveViewState(): void {\r\n    this.viewStateStack.push(new SavedViewState(this.selectedRowId));\r\n  }\r\n\r\n  @action.bound\r\n  restoreViewState(): void {\r\n    const state = this.viewStateStack.pop();\r\n    if (state && state.selectedRowId) {\r\n      this.setSelectedRowId(state.selectedRowId);\r\n      if (!getSelectedRow(this)) {\r\n        this.selectFirstRow();\r\n      }\r\n      getTablePanelView(this).scrollToCurrentCell();\r\n    }\r\n  }\r\n\r\n  get isLazyLoading() {\r\n    return isLazyLoading(this) && this.isRootGrid;\r\n  }\r\n\r\n  @action.bound\r\n  async start() {\r\n    this.lifecycle.start();\r\n    const serverSideGrouping = this.isLazyLoading;\r\n    if (serverSideGrouping) {\r\n      this.serverSideGrouper.start();\r\n    }\r\n    getFormScreenLifecycle(this).registerDisposer(() =>\r\n      this.serverSideGrouper.dispose()\r\n    );\r\n    await this.dataTable.start();\r\n    getFormScreenLifecycle(this).registerDisposer(\r\n      reaction(\r\n        () => ({\r\n          selectedRowId: this.selectedRowId,\r\n          rowsCount: getDataTable(this).allRows.length,\r\n        }),\r\n        (reData: { selectedRowId: string | undefined; rowsCount: number }) => {\r\n          if (getFormScreenLifecycle(this).rowSelectedReactionsDisabled(this)) {\r\n            return;\r\n          }\r\n          if (reData.selectedRowId === undefined && reData.rowsCount > 0) {\r\n            this.reselectOrSelectFirst();\r\n          }\r\n        },\r\n        {\r\n          fireImmediately: true,\r\n        }\r\n      )\r\n    );\r\n    await this.dataTable.start();\r\n  }\r\n\r\n  @action.bound stop() {\r\n    this.properties.forEach((prop) => prop.stop());\r\n    this.dataTable.stop();\r\n  }\r\n\r\n  @computed get tableRows() {\r\n    const groupedColumnIds =\r\n      getGroupingConfiguration(this).orderedGroupingColumnSettings;\r\n    return groupedColumnIds.length === 0\r\n      ? getDataTable(this).rows\r\n      : flattenToTableRows(getGrouper(this).topLevelGroups);\r\n  }\r\n\r\n  scrollState = new SimpleScrollState(0, 0);\r\n\r\n  @observable contentBounds: BoundingRect | undefined;\r\n  infiniteScrollLoader: IInfiniteScrollLoader | undefined =\r\n    new NullIScrollLoader();\r\n\r\n  parent?: any;\r\n\r\n  initializeNewScrollLoader() {\r\n    if (this.infiniteScrollLoader) {\r\n      this.infiniteScrollLoader.dispose();\r\n    }\r\n    this.infiniteScrollLoader = this.getScrollLoader();\r\n    getFormScreenLifecycle(this).registerDisposer(\r\n      this.infiniteScrollLoader.start()\r\n    );\r\n  }\r\n\r\n  getScrollLoader() {\r\n    const isGroupingOff =\r\n      getGroupingConfiguration(this).orderedGroupingColumnSettings.length === 0;\r\n    const rowsContainer = getDataTable(this).rowsContainer;\r\n    if (rowsContainer instanceof ScrollRowContainer && isGroupingOff) {\r\n      return new InfiniteScrollLoader({\r\n        ctx: this,\r\n        gridDimensions: this.gridDimensions,\r\n        scrollState: this.scrollState,\r\n        rowsContainer: rowsContainer as ScrollRowContainer,\r\n        groupFilter: undefined,\r\n        visibleRowsMonitor: new VisibleRowsMonitor(\r\n          this,\r\n          this.gridDimensions,\r\n          this.scrollState\r\n        ),\r\n      });\r\n    } else {\r\n      return new NullIScrollLoader();\r\n    }\r\n  }\r\n\r\n  // Called by client scripts\r\n  focusFormViewControl(name: string) {\r\n    this.formFocusManager.focus(name);\r\n  }\r\n\r\n  // Called by client scripts\r\n  showView(viewId: string, focus: boolean) {\r\n    throw new Error(\"showView method is not yet implemented.\");\r\n  }\r\n\r\n  // Called by client scripts\r\n  switchToPanel(modelInstanceId: string) {\r\n    throw new Error(\"switchToPanel method is not yet implemented.\");\r\n  }\r\n\r\n  onReload() {\r\n    this.dataTable.unlockAddedRowPosition();\r\n  }\r\n\r\n  attributes: any;\r\n\r\n  async exportToExcel() {\r\n    const visibleColumnIds = getConfigurationManager(this)\r\n      .activeTableConfiguration.columnConfigurations.filter(\r\n        (columnConfig) => columnConfig.isVisible\r\n      )\r\n      .map((columnConfig) => columnConfig.propertyId);\r\n    const fields = getTablePanelView(this)\r\n      .allTableProperties.filter((property) =>\r\n        visibleColumnIds.includes(property.id)\r\n      )\r\n      .map((property) => {\r\n        return {\r\n          Caption: property.name,\r\n          FieldName: property.id,\r\n          LookupId: property.lookupId,\r\n          Format: property.formatterPattern,\r\n          PolymorphRules: property.controlPropertyId\r\n            ? {\r\n              ControlField: property.controlPropertyId,\r\n              Rules: this.getPolymorphicRules(property),\r\n            }\r\n            : undefined,\r\n        };\r\n      });\r\n    const excelMaxRowCount = 1048576;\r\n    const api = getApi(this);\r\n    if (isInfiniteScrollingActive(this)) {\r\n      await api.getExcelFile({\r\n        Entity: this.entity,\r\n        Fields: fields,\r\n        SessionFormIdentifier: getSessionId(this),\r\n        RowIds: [],\r\n        LazyLoadedEntityInput: {\r\n          SessionFormIdentifier: getSessionId(this),\r\n          Filter: getUserFilters({ctx: this}),\r\n          MenuId: getMenuItemId(this),\r\n          DataStructureEntityId: getDataStructureEntityId(this),\r\n          Ordering: getUserOrdering(this),\r\n          RowLimit: excelMaxRowCount,\r\n          RowOffset: 0,\r\n          ColumnNames: getColumnNamesToLoad(this),\r\n          FilterLookups: getUserFilterLookups(this),\r\n        },\r\n      });\r\n    } else {\r\n      await api.getExcelFile({\r\n        Entity: this.entity,\r\n        Fields: fields,\r\n        SessionFormIdentifier: getSessionId(this),\r\n        RowIds: this.dataTable.rows.map((row) => this.dataTable.getRowId(row)),\r\n        LazyLoadedEntityInput: undefined,\r\n      });\r\n    }\r\n  }\r\n\r\n  private getPolymorphicRules(property: IProperty) {\r\n    return property.childProperties\r\n      .filter((prop) => prop.controlPropertyValue)\r\n      .reduce((map: { [key: string]: string }, prop: IProperty) => {\r\n        map[prop.controlPropertyValue!] = prop.id;\r\n        return map;\r\n      }, {});\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getLookupLoader(ctx: any) {\r\n  return getDataView(ctx).lookupLoader;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getBindingParents } from \"./getBindingParents\";\r\nimport { getSelectedRow } from \"./getSelectedRow\";\r\n\r\nexport function getParentRow(ctx: any) {\r\n  const bps = getBindingParents(ctx);\r\n  const bp = bps.length > 0 ? bps[0] : undefined;\r\n  return bp ? getSelectedRow(bp) : undefined;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getBindingToParent(ctx: any) {\r\n  const pb = getDataView(ctx).parentBindings;\r\n  return pb.length > 0 ? pb[0] : undefined;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDropDownColumn, IDropDownColumnData } from \"./types/IDropDownColumn\";\r\n\r\nexport class DropDownColumn implements IDropDownColumn {\r\n  $type_IDropDownColumn: 1 = 1;\r\n\r\n  constructor(data: IDropDownColumnData) {\r\n    Object.assign(this, data);\r\n  }\r\n\r\n  parent: any;\r\n\r\n  id: string = \"\";\r\n  name: string = \"\";\r\n  entity: string = \"\";\r\n  column: string = \"\";\r\n  index: number = 0;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n/* eslint-disable */\r\nimport { getLocaleFromCookie } from \"./cookies\";\r\n\r\ndeclare global {\r\n  interface String {\r\n    latinize(): String;\r\n\r\n    isLatin(): boolean;\r\n  }\r\n}\r\n\r\n// https://stackoverflow.com/questions/990904/remove-accents-diacritics-in-a-string-in-javascript\r\nconst Latinize = {} as any;\r\nLatinize.latin_map = {\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"A\",\r\n  \"\": \"AA\",\r\n  \"\": \"AE\",\r\n  \"\": \"AE\",\r\n  \"\": \"AE\",\r\n  \"\": \"AO\",\r\n  \"\": \"AU\",\r\n  \"\": \"AV\",\r\n  \"\": \"AV\",\r\n  \"\": \"AY\",\r\n  \"\": \"B\",\r\n  \"\": \"B\",\r\n  \"\": \"B\",\r\n  \"\": \"B\",\r\n  \"\": \"B\",\r\n  \"\": \"B\",\r\n  \"\": \"C\",\r\n  \"\": \"C\",\r\n  \"\": \"C\",\r\n  \"\": \"C\",\r\n  \"\": \"C\",\r\n  \"\": \"C\",\r\n  \"\": \"C\",\r\n  \"\": \"C\",\r\n  \"\": \"D\",\r\n  \"\": \"D\",\r\n  \"\": \"D\",\r\n  \"\": \"D\",\r\n  \"\": \"D\",\r\n  \"\": \"D\",\r\n  \"\": \"D\",\r\n  \"\": \"D\",\r\n  \"\": \"D\",\r\n  \"\": \"D\",\r\n  \"\": \"D\",\r\n  \"\": \"DZ\",\r\n  \"\": \"DZ\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"E\",\r\n  \"\": \"ET\",\r\n  \"\": \"F\",\r\n  \"\": \"F\",\r\n  \"\": \"G\",\r\n  \"\": \"G\",\r\n  \"\": \"G\",\r\n  \"\": \"G\",\r\n  \"\": \"G\",\r\n  \"\": \"G\",\r\n  \"\": \"G\",\r\n  \"\": \"G\",\r\n  \"\": \"G\",\r\n  \"\": \"H\",\r\n  \"\": \"H\",\r\n  \"\": \"H\",\r\n  \"\": \"H\",\r\n  \"\": \"H\",\r\n  \"\": \"H\",\r\n  \"\": \"H\",\r\n  \"\": \"H\",\r\n  \"\": \"H\",\r\n  \"\": \"I\",\r\n  \"\": \"I\",\r\n  \"\": \"I\",\r\n  \"\": \"I\",\r\n  \"\": \"I\",\r\n  \"\": \"I\",\r\n  \"\": \"I\",\r\n  \"\": \"I\",\r\n  \"\": \"I\",\r\n  \"\": \"I\",\r\n  \"\": \"I\",\r\n  \"\": \"I\",\r\n  \"\": \"I\",\r\n  \"\": \"I\",\r\n  \"\": \"I\",\r\n  \"\": \"I\",\r\n  \"\": \"I\",\r\n  \"\": \"D\",\r\n  \"\": \"F\",\r\n  \"\": \"G\",\r\n  \"\": \"R\",\r\n  \"\": \"S\",\r\n  \"\": \"T\",\r\n  \"\": \"IS\",\r\n  \"\": \"J\",\r\n  \"\": \"J\",\r\n  \"\": \"K\",\r\n  \"\": \"K\",\r\n  \"\": \"K\",\r\n  \"\": \"K\",\r\n  \"\": \"K\",\r\n  \"\": \"K\",\r\n  \"\": \"K\",\r\n  \"\": \"K\",\r\n  \"\": \"K\",\r\n  \"\": \"K\",\r\n  \"\": \"L\",\r\n  \"\": \"L\",\r\n  \"\": \"L\",\r\n  \"\": \"L\",\r\n  \"\": \"L\",\r\n  \"\": \"L\",\r\n  \"\": \"L\",\r\n  \"\": \"L\",\r\n  \"\": \"L\",\r\n  \"\": \"L\",\r\n  \"\": \"L\",\r\n  \"\": \"L\",\r\n  \"\": \"L\",\r\n  \"\": \"L\",\r\n  \"\": \"LJ\",\r\n  \"\": \"M\",\r\n  \"\": \"M\",\r\n  \"\": \"M\",\r\n  \"\": \"M\",\r\n  \"\": \"N\",\r\n  \"\": \"N\",\r\n  \"\": \"N\",\r\n  \"\": \"N\",\r\n  \"\": \"N\",\r\n  \"\": \"N\",\r\n  \"\": \"N\",\r\n  \"\": \"N\",\r\n  \"\": \"N\",\r\n  \"\": \"N\",\r\n  \"\": \"N\",\r\n  \"\": \"N\",\r\n  \"\": \"NJ\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"O\",\r\n  \"\": \"OI\",\r\n  \"\": \"OO\",\r\n  \"\": \"E\",\r\n  \"\": \"O\",\r\n  \"\": \"OU\",\r\n  \"\": \"P\",\r\n  \"\": \"P\",\r\n  \"\": \"P\",\r\n  \"\": \"P\",\r\n  \"\": \"P\",\r\n  \"\": \"P\",\r\n  \"\": \"P\",\r\n  \"\": \"Q\",\r\n  \"\": \"Q\",\r\n  \"\": \"R\",\r\n  \"\": \"R\",\r\n  \"\": \"R\",\r\n  \"\": \"R\",\r\n  \"\": \"R\",\r\n  \"\": \"R\",\r\n  \"\": \"R\",\r\n  \"\": \"R\",\r\n  \"\": \"R\",\r\n  \"\": \"R\",\r\n  \"\": \"R\",\r\n  \"\": \"C\",\r\n  \"\": \"E\",\r\n  \"\": \"S\",\r\n  \"\": \"S\",\r\n  \"\": \"S\",\r\n  \"\": \"S\",\r\n  \"\": \"S\",\r\n  \"\": \"S\",\r\n  \"\": \"S\",\r\n  \"\": \"S\",\r\n  \"\": \"S\",\r\n  \"\": \"S\",\r\n  \"\": \"T\",\r\n  \"\": \"T\",\r\n  \"\": \"T\",\r\n  \"\": \"T\",\r\n  \"\": \"T\",\r\n  \"\": \"T\",\r\n  \"\": \"T\",\r\n  \"\": \"T\",\r\n  \"\": \"T\",\r\n  \"\": \"T\",\r\n  \"\": \"T\",\r\n  \"\": \"A\",\r\n  \"\": \"L\",\r\n  \"\": \"M\",\r\n  \"\": \"V\",\r\n  \"\": \"TZ\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"U\",\r\n  \"\": \"V\",\r\n  \"\": \"V\",\r\n  \"\": \"V\",\r\n  \"\": \"V\",\r\n  \"\": \"VY\",\r\n  \"\": \"W\",\r\n  \"\": \"W\",\r\n  \"\": \"W\",\r\n  \"\": \"W\",\r\n  \"\": \"W\",\r\n  \"\": \"W\",\r\n  \"\": \"W\",\r\n  \"\": \"X\",\r\n  \"\": \"X\",\r\n  \"\": \"Y\",\r\n  \"\": \"Y\",\r\n  \"\": \"Y\",\r\n  \"\": \"Y\",\r\n  \"\": \"Y\",\r\n  \"\": \"Y\",\r\n  \"\": \"Y\",\r\n  \"\": \"Y\",\r\n  \"\": \"Y\",\r\n  \"\": \"Y\",\r\n  \"\": \"Y\",\r\n  \"\": \"Y\",\r\n  \"\": \"Z\",\r\n  \"\": \"Z\",\r\n  \"\": \"Z\",\r\n  \"\": \"Z\",\r\n  \"\": \"Z\",\r\n  \"\": \"Z\",\r\n  \"\": \"Z\",\r\n  \"\": \"Z\",\r\n  \"\": \"Z\",\r\n  \"\": \"IJ\",\r\n  \"\": \"OE\",\r\n  \"\": \"A\",\r\n  \"\": \"AE\",\r\n  \"\": \"B\",\r\n  \"\": \"B\",\r\n  \"\": \"C\",\r\n  \"\": \"D\",\r\n  \"\": \"E\",\r\n  \"\": \"F\",\r\n  \"\": \"G\",\r\n  \"\": \"G\",\r\n  \"\": \"H\",\r\n  \"\": \"I\",\r\n  \"\": \"R\",\r\n  \"\": \"J\",\r\n  \"\": \"K\",\r\n  \"\": \"L\",\r\n  \"\": \"L\",\r\n  \"\": \"M\",\r\n  \"\": \"N\",\r\n  \"\": \"O\",\r\n  \"\": \"OE\",\r\n  \"\": \"O\",\r\n  \"\": \"OU\",\r\n  \"\": \"P\",\r\n  \"\": \"R\",\r\n  \"\": \"N\",\r\n  \"\": \"R\",\r\n  \"\": \"S\",\r\n  \"\": \"T\",\r\n  \"\": \"E\",\r\n  \"\": \"R\",\r\n  \"\": \"U\",\r\n  \"\": \"V\",\r\n  \"\": \"W\",\r\n  \"\": \"Y\",\r\n  \"\": \"Z\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"a\",\r\n  \"\": \"aa\",\r\n  \"\": \"ae\",\r\n  \"\": \"ae\",\r\n  \"\": \"ae\",\r\n  \"\": \"ao\",\r\n  \"\": \"au\",\r\n  \"\": \"av\",\r\n  \"\": \"av\",\r\n  \"\": \"ay\",\r\n  \"\": \"b\",\r\n  \"\": \"b\",\r\n  \"\": \"b\",\r\n  \"\": \"b\",\r\n  \"\": \"b\",\r\n  \"\": \"b\",\r\n  \"\": \"b\",\r\n  \"\": \"b\",\r\n  \"\": \"o\",\r\n  \"\": \"c\",\r\n  \"\": \"c\",\r\n  \"\": \"c\",\r\n  \"\": \"c\",\r\n  \"\": \"c\",\r\n  \"\": \"c\",\r\n  \"\": \"c\",\r\n  \"\": \"c\",\r\n  \"\": \"c\",\r\n  \"\": \"d\",\r\n  \"\": \"d\",\r\n  \"\": \"d\",\r\n  \"\": \"d\",\r\n  \"\": \"d\",\r\n  \"\": \"d\",\r\n  \"\": \"d\",\r\n  \"\": \"d\",\r\n  \"\": \"d\",\r\n  \"\": \"d\",\r\n  \"\": \"d\",\r\n  \"\": \"d\",\r\n  \"\": \"d\",\r\n  \"\": \"d\",\r\n  \"\": \"i\",\r\n  \"\": \"j\",\r\n  \"\": \"j\",\r\n  \"\": \"j\",\r\n  \"\": \"dz\",\r\n  \"\": \"dz\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"et\",\r\n  \"\": \"f\",\r\n  \"\": \"f\",\r\n  \"\": \"f\",\r\n  \"\": \"f\",\r\n  \"\": \"g\",\r\n  \"\": \"g\",\r\n  \"\": \"g\",\r\n  \"\": \"g\",\r\n  \"\": \"g\",\r\n  \"\": \"g\",\r\n  \"\": \"g\",\r\n  \"\": \"g\",\r\n  \"\": \"g\",\r\n  \"\": \"g\",\r\n  \"\": \"h\",\r\n  \"\": \"h\",\r\n  \"\": \"h\",\r\n  \"\": \"h\",\r\n  \"\": \"h\",\r\n  \"\": \"h\",\r\n  \"\": \"h\",\r\n  \"\": \"h\",\r\n  \"\": \"h\",\r\n  \"\": \"h\",\r\n  \"\": \"h\",\r\n  \"\": \"hv\",\r\n  \"\": \"i\",\r\n  \"\": \"i\",\r\n  \"\": \"i\",\r\n  \"\": \"i\",\r\n  \"\": \"i\",\r\n  \"\": \"i\",\r\n  \"\": \"i\",\r\n  \"\": \"i\",\r\n  \"\": \"i\",\r\n  \"\": \"i\",\r\n  \"\": \"i\",\r\n  \"\": \"i\",\r\n  \"\": \"i\",\r\n  \"\": \"i\",\r\n  \"\": \"i\",\r\n  \"\": \"i\",\r\n  \"\": \"i\",\r\n  \"\": \"d\",\r\n  \"\": \"f\",\r\n  \"\": \"g\",\r\n  \"\": \"r\",\r\n  \"\": \"s\",\r\n  \"\": \"t\",\r\n  \"\": \"is\",\r\n  \"\": \"j\",\r\n  \"\": \"j\",\r\n  \"\": \"j\",\r\n  \"\": \"j\",\r\n  \"\": \"k\",\r\n  \"\": \"k\",\r\n  \"\": \"k\",\r\n  \"\": \"k\",\r\n  \"\": \"k\",\r\n  \"\": \"k\",\r\n  \"\": \"k\",\r\n  \"\": \"k\",\r\n  \"\": \"k\",\r\n  \"\": \"k\",\r\n  \"\": \"k\",\r\n  \"\": \"l\",\r\n  \"\": \"l\",\r\n  \"\": \"l\",\r\n  \"\": \"l\",\r\n  \"\": \"l\",\r\n  \"\": \"l\",\r\n  \"\": \"l\",\r\n  \"\": \"l\",\r\n  \"\": \"l\",\r\n  \"\": \"l\",\r\n  \"\": \"l\",\r\n  \"\": \"l\",\r\n  \"\": \"l\",\r\n  \"\": \"l\",\r\n  \"\": \"l\",\r\n  \"\": \"l\",\r\n  \"\": \"l\",\r\n  \"\": \"lj\",\r\n  \"\": \"s\",\r\n  \"\": \"s\",\r\n  \"\": \"s\",\r\n  \"\": \"s\",\r\n  \"\": \"m\",\r\n  \"\": \"m\",\r\n  \"\": \"m\",\r\n  \"\": \"m\",\r\n  \"\": \"m\",\r\n  \"\": \"m\",\r\n  \"\": \"n\",\r\n  \"\": \"n\",\r\n  \"\": \"n\",\r\n  \"\": \"n\",\r\n  \"\": \"n\",\r\n  \"\": \"n\",\r\n  \"\": \"n\",\r\n  \"\": \"n\",\r\n  \"\": \"n\",\r\n  \"\": \"n\",\r\n  \"\": \"n\",\r\n  \"\": \"n\",\r\n  \"\": \"n\",\r\n  \"\": \"n\",\r\n  \"\": \"n\",\r\n  \"\": \"nj\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"oi\",\r\n  \"\": \"oo\",\r\n  \"\": \"e\",\r\n  \"\": \"e\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"ou\",\r\n  \"\": \"p\",\r\n  \"\": \"p\",\r\n  \"\": \"p\",\r\n  \"\": \"p\",\r\n  \"\": \"p\",\r\n  \"\": \"p\",\r\n  \"\": \"p\",\r\n  \"\": \"p\",\r\n  \"\": \"p\",\r\n  \"\": \"q\",\r\n  \"\": \"q\",\r\n  \"\": \"q\",\r\n  \"\": \"q\",\r\n  \"\": \"r\",\r\n  \"\": \"r\",\r\n  \"\": \"r\",\r\n  \"\": \"r\",\r\n  \"\": \"r\",\r\n  \"\": \"r\",\r\n  \"\": \"r\",\r\n  \"\": \"r\",\r\n  \"\": \"r\",\r\n  \"\": \"r\",\r\n  \"\": \"r\",\r\n  \"\": \"r\",\r\n  \"\": \"r\",\r\n  \"\": \"r\",\r\n  \"\": \"r\",\r\n  \"\": \"r\",\r\n  \"\": \"c\",\r\n  \"\": \"c\",\r\n  \"\": \"e\",\r\n  \"\": \"r\",\r\n  \"\": \"s\",\r\n  \"\": \"s\",\r\n  \"\": \"s\",\r\n  \"\": \"s\",\r\n  \"\": \"s\",\r\n  \"\": \"s\",\r\n  \"\": \"s\",\r\n  \"\": \"s\",\r\n  \"\": \"s\",\r\n  \"\": \"s\",\r\n  \"\": \"s\",\r\n  \"\": \"s\",\r\n  \"\": \"s\",\r\n  \"\": \"s\",\r\n  \"\": \"g\",\r\n  \"\": \"o\",\r\n  \"\": \"o\",\r\n  \"\": \"u\",\r\n  \"\": \"t\",\r\n  \"\": \"t\",\r\n  \"\": \"t\",\r\n  \"\": \"t\",\r\n  \"\": \"t\",\r\n  \"\": \"t\",\r\n  \"\": \"t\",\r\n  \"\": \"t\",\r\n  \"\": \"t\",\r\n  \"\": \"t\",\r\n  \"\": \"t\",\r\n  \"\": \"t\",\r\n  \"\": \"t\",\r\n  \"\": \"t\",\r\n  \"\": \"t\",\r\n  \"\": \"th\",\r\n  \"\": \"a\",\r\n  \"\": \"ae\",\r\n  \"\": \"e\",\r\n  \"\": \"g\",\r\n  \"\": \"h\",\r\n  \"\": \"h\",\r\n  \"\": \"h\",\r\n  \"\": \"i\",\r\n  \"\": \"k\",\r\n  \"\": \"l\",\r\n  \"\": \"m\",\r\n  \"\": \"m\",\r\n  \"\": \"oe\",\r\n  \"\": \"r\",\r\n  \"\": \"r\",\r\n  \"\": \"r\",\r\n  \"\": \"r\",\r\n  \"\": \"t\",\r\n  \"\": \"v\",\r\n  \"\": \"w\",\r\n  \"\": \"y\",\r\n  \"\": \"tz\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"u\",\r\n  \"\": \"ue\",\r\n  \"\": \"um\",\r\n  \"\": \"v\",\r\n  \"\": \"v\",\r\n  \"\": \"v\",\r\n  \"\": \"v\",\r\n  \"\": \"v\",\r\n  \"\": \"v\",\r\n  \"\": \"v\",\r\n  \"\": \"vy\",\r\n  \"\": \"w\",\r\n  \"\": \"w\",\r\n  \"\": \"w\",\r\n  \"\": \"w\",\r\n  \"\": \"w\",\r\n  \"\": \"w\",\r\n  \"\": \"w\",\r\n  \"\": \"w\",\r\n  \"\": \"x\",\r\n  \"\": \"x\",\r\n  \"\": \"x\",\r\n  \"\": \"y\",\r\n  \"\": \"y\",\r\n  \"\": \"y\",\r\n  \"\": \"y\",\r\n  \"\": \"y\",\r\n  \"\": \"y\",\r\n  \"\": \"y\",\r\n  \"\": \"y\",\r\n  \"\": \"y\",\r\n  \"\": \"y\",\r\n  \"\": \"y\",\r\n  \"\": \"y\",\r\n  \"\": \"y\",\r\n  \"\": \"z\",\r\n  \"\": \"z\",\r\n  \"\": \"z\",\r\n  \"\": \"z\",\r\n  \"\": \"z\",\r\n  \"\": \"z\",\r\n  \"\": \"z\",\r\n  \"\": \"z\",\r\n  \"\": \"z\",\r\n  \"\": \"z\",\r\n  \"\": \"z\",\r\n  \"\": \"z\",\r\n  \"\": \"z\",\r\n  \"\": \"z\",\r\n  \"\": \"ff\",\r\n  \"\": \"ffi\",\r\n  \"\": \"ffl\",\r\n  \"\": \"fi\",\r\n  \"\": \"fl\",\r\n  \"\": \"ij\",\r\n  \"\": \"oe\",\r\n  \"\": \"st\",\r\n  \"\": \"a\",\r\n  \"\": \"e\",\r\n  \"\": \"i\",\r\n  \"\": \"j\",\r\n  \"\": \"o\",\r\n  \"\": \"r\",\r\n  \"\": \"u\",\r\n  \"\": \"v\",\r\n  \"\": \"x\"\r\n};\r\nString.prototype.latinize = function () {\r\n  return this.replace(/[^A-Za-z0-9\\[\\] ]/g, function (a) {\r\n    return Latinize.latin_map[a] || a\r\n  })\r\n};\r\nString.prototype.isLatin = function () {\r\n  return this == this.latinize()\r\n}\r\n\r\nexport function latinize(str: string) {\r\n  return str.replace(/[^A-Za-z0-9\\[\\] ]/g, function (a) {\r\n    return Latinize.latin_map[a] || a\r\n  })\r\n};\r\n\r\n/* eslint-enable */\r\n\r\nexport function compareStrings(a: string | undefined | null, b: string | undefined | null) {\r\n  if (a === undefined || a === null) {\r\n    return 1;\r\n  } else if (b === undefined || b === null) {\r\n    return -1;\r\n  }\r\n  const locale = getLocaleFromCookie();\r\n  return a.toString().localeCompare(b.toString(), locale);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IFilterConfig } from \"../../entities/types/IFilterConfig\";\r\nimport { getWorkbenchLifecycle } from \"../getWorkbenchLifecycle\";\r\nimport { latinize } from \"utils/string\";\r\n\r\nfunction getStringFilterConfig(ctx: any): IFilterConfig {\r\n  return getWorkbenchLifecycle(ctx).portalSettings?.filterConfig ?? {\r\n    caseSensitive: false,\r\n    accentSensitive: true\r\n  };\r\n}\r\n\r\nexport function prepareForFilter(ctx: any, text: string | undefined | null) {\r\n  if (text === undefined || text === null) {\r\n    return text;\r\n  }\r\n  const filterConfig = getStringFilterConfig(ctx);\r\n  if (!filterConfig.caseSensitive) {\r\n    text = text.toLowerCase();\r\n  }\r\n  if (!filterConfig.accentSensitive) {\r\n    text = latinize(text);\r\n  }\r\n  return text;\r\n}\r\n\r\nexport function prepareAnyForFilter(ctx: any, value: any): any {\r\n\r\n  if (typeof value === 'string' || value instanceof String) {\r\n    return prepareForFilter(ctx, value as string);\r\n  }\r\n  if (Array.isArray(value)) {\r\n    return value.map(val => prepareAnyForFilter(ctx, val))\r\n  }\r\n  return value;\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport _ from \"lodash\";\r\nimport { action, comparer, computed, flow, observable, reaction } from \"mobx\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { getDataViewPropertyById } from \"model/selectors/DataView/getDataViewPropertyById\";\r\nimport { getDataTable } from \"../selectors/DataView/getDataTable\";\r\nimport { IFilterConfiguration } from \"./types/IFilterConfiguration\";\r\nimport { getDataSource } from \"../selectors/DataSources/getDataSource\";\r\nimport { IFilter } from \"./types/IFilter\";\r\nimport { prepareAnyForFilter, prepareForFilter } from \"../selectors/PortalSettings/getStringFilterConfig\";\r\n\r\nexport class FilterConfiguration implements IFilterConfiguration {\r\n  constructor(implicitFilters: IImplicitFilter[]) {\r\n    this.implicitFilters = implicitFilters;\r\n    this.start();\r\n  }\r\n\r\n  filteringOnOffHandlers: ((filteringOn: boolean) => void)[] = [];\r\n  $type_IFilterConfigurationData: 1 = 1;\r\n\r\n  implicitFilters: IImplicitFilter[];\r\n  @observable activeFilters: IFilter[] = [];\r\n\r\n  registerFilteringOnOffHandler(handler: (filteringOn: boolean) => void) {\r\n    this.filteringOnOffHandlers.push(handler);\r\n  }\r\n\r\n  getSettingByPropertyId(propertyId: string): IFilter | undefined {\r\n    return this.activeFilters.find((item) => item.propertyId === propertyId);\r\n  }\r\n\r\n  @action.bound\r\n  setFilters(filters: IFilter[]) {\r\n    this.clearFilters();\r\n    filters.forEach((filter) => this.setFilter(filter));\r\n    this.isFilterControlsDisplayed = true;\r\n  }\r\n\r\n  @action.bound\r\n  setFilter(term: IFilter): void {\r\n    const existingIndex = this.activeFilters.findIndex(\r\n      (filter) => filter.propertyId === term.propertyId\r\n    );\r\n    if (existingIndex > -1) {\r\n      this.activeFilters.splice(existingIndex, 1);\r\n    }\r\n    this.activeFilters.push(term);\r\n    this.activeFilters = [...this.activeFilters];\r\n  }\r\n\r\n  @action.bound\r\n  clearFilters(): void {\r\n    if (this.activeFilters.length !== 0) {\r\n      this.activeFilters = [];\r\n    }\r\n  }\r\n\r\n  @observable isFilterControlsDisplayed: boolean = false;\r\n\r\n  @action.bound\r\n  onFilterDisplayClick(event: any): void {\r\n    this.isFilterControlsDisplayed = !this.isFilterControlsDisplayed;\r\n    if (this.isFilterControlsDisplayed) {\r\n      // TODO: Wait for data loaded?\r\n    } else {\r\n      this.clearFilters();\r\n    }\r\n    for (let filteringOnOffHandler of this.filteringOnOffHandlers) {\r\n      filteringOnOffHandler(this.isFilterControlsDisplayed);\r\n    }\r\n  }\r\n\r\n  filteringFunction(ignorePropertyId?: string): (row: any[]) => boolean {\r\n    return (row: any[]) => {\r\n      if (!this.isPresentInDetail(row)) {\r\n        return false;\r\n      }\r\n      for (let term of this.implicitFilters) {\r\n        if ((!ignorePropertyId || ignorePropertyId !== term.propertyId) &&\r\n          !this.implicitFilterPredicate(row, term)) {\r\n          return false;\r\n        }\r\n      }\r\n      for (let term of this.activeFilters) {\r\n        if ((!ignorePropertyId || ignorePropertyId !== term.propertyId) &&\r\n          !this.userFilterPredicate(row, term)) {\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    };\r\n  }\r\n\r\n  userFilterPredicate(row: any[], term: IFilter) {\r\n    const dataTable = getDataTable(this);\r\n    const prop = dataTable.getPropertyById(term.propertyId)!;\r\n    const cellValue = prepareAnyForFilter(this, dataTable.getOriginalCellValue(row, prop));\r\n    switch (prop.column) {\r\n      case \"Text\": {\r\n        const filterVal1 = prepareAnyForFilter(this, term.setting.val1);\r\n        const cellText = prepareAnyForFilter(this, dataTable.getOriginalCellText(row, prop))!;\r\n        if (cellValue === undefined) return true;\r\n\r\n        switch (term.setting.type) {\r\n          case \"contains\": {\r\n            if (filterVal1 === \"\" || filterVal1 === undefined) return true;\r\n            if (cellValue === null) return false;\r\n            return cellText.includes(filterVal1);\r\n          }\r\n          case \"ends\": {\r\n            if (filterVal1 === \"\" || filterVal1 === undefined) return true;\r\n            if (cellValue === null) return false;\r\n            return cellText.endsWith(filterVal1);\r\n          }\r\n          case \"eq\": {\r\n            if (filterVal1 === \"\" || filterVal1 === undefined) return true;\r\n            if (cellValue === null) return false;\r\n            return cellText === filterVal1;\r\n          }\r\n          case \"ncontains\": {\r\n            if (filterVal1 === \"\" || filterVal1 === undefined) return true;\r\n            if (cellValue === null) return false;\r\n            return !cellText.includes(filterVal1);\r\n          }\r\n          case \"nends\": {\r\n            if (filterVal1 === \"\" || filterVal1 === undefined) return true;\r\n            if (cellValue === null) return false;\r\n            return !cellText.endsWith(filterVal1);\r\n          }\r\n          case \"neq\": {\r\n            if (filterVal1 === \"\" || filterVal1 === undefined) return true;\r\n            if (cellValue === null) return false;\r\n            return cellText !== filterVal1;\r\n          }\r\n          case \"nnull\": {\r\n            return cellValue !== null;\r\n          }\r\n          case \"nstarts\": {\r\n            if (filterVal1 === \"\" || filterVal1 === undefined) return true;\r\n            if (cellValue === null) return false;\r\n            return !cellText.startsWith(filterVal1);\r\n          }\r\n          case \"null\": {\r\n            return cellValue === null;\r\n          }\r\n          case \"starts\": {\r\n            if (filterVal1 === \"\" || filterVal1 === undefined) return true;\r\n            if (cellValue === null) return false;\r\n            return cellText.startsWith(filterVal1);\r\n          }\r\n        }\r\n        break;\r\n      }\r\n      case \"Date\": {\r\n        if (cellValue === undefined) return false;\r\n        if (term.setting.type === \"nnull\") return cellValue !== null;\r\n        if (term.setting.type === \"null\") return cellValue === null;\r\n        if (\r\n          term.setting.val1 === \"\" ||\r\n          term.setting.val1 === undefined ||\r\n          term.setting.val1 === null\r\n        )\r\n          return true;\r\n\r\n        const t1 = term.setting.val1.split(\".\")[0].endsWith(\"T00:00:00\") && cellValue !== null\r\n          ? cellValue.substr(0, 10).concat(\"T00:00:00\")\r\n          : cellValue;\r\n\r\n        switch (term.setting.type) {\r\n          case \"between\": {\r\n            if (\r\n              term.setting.val2 === \"\" ||\r\n              term.setting.val2 === undefined ||\r\n              term.setting.val2 === null\r\n            )\r\n              return true;\r\n            if (cellValue === null) return false;\r\n            const t0 = term.setting.val1;\r\n            let t2 = term.setting.val2;\r\n            if (t2.endsWith(\"T00:00:00\")) {\r\n              t2 = t2.substr(0, 10).concat(\"T23:59:59\")\r\n            }\r\n            return t0 <= t1 && t1 <= t2;\r\n          }\r\n          case \"eq\":\r\n            if (cellValue === null) return false;\r\n            return t1 === term.setting.val1;\r\n          case \"gt\":\r\n            if (cellValue === null) return false;\r\n            return t1 > term.setting.val1;\r\n          case \"gte\":\r\n            if (cellValue === null) return false;\r\n            return t1 >= term.setting.val1;\r\n          case \"lt\":\r\n            if (cellValue === null) return false;\r\n            return t1 < term.setting.val1;\r\n          case \"lte\":\r\n            if (cellValue === null) return false;\r\n            return t1 <= term.setting.val1;\r\n          case \"nbetween\": {\r\n            if (\r\n              term.setting.val2 === \"\" ||\r\n              term.setting.val2 === undefined ||\r\n              term.setting.val2 === null\r\n            )\r\n              return true;\r\n            if (cellValue === null) return false;\r\n            const t0 = term.setting.val1;\r\n            const t2 = term.setting.val2;\r\n            return t1 < t0 || t1 > t2;\r\n          }\r\n          case \"neq\":\r\n            if (cellValue === null) return false;\r\n            return t1 !== term.setting.val1;\r\n        }\r\n        break;\r\n      }\r\n      case \"Number\": {\r\n        if (cellValue === undefined) return true;\r\n        const t1 = prop.column === \"Number\" ? parseFloat(cellValue) : cellValue;\r\n\r\n        switch (term.setting.type) {\r\n          case \"between\": {\r\n            if (\r\n              term.setting.val1 === \"\" ||\r\n              term.setting.val2 === \"\" ||\r\n              term.setting.val1 === undefined ||\r\n              term.setting.val2 === undefined\r\n            )\r\n              return true;\r\n            if (cellValue === null) return false;\r\n            const t0 = parseFloat(term.setting.val1);\r\n            const t2 = parseFloat(term.setting.val2);\r\n            return t0 <= t1 && t1 <= t2;\r\n          }\r\n          case \"eq\":\r\n            if (term.setting.val1 === \"\" || term.setting.val1 === undefined) return true;\r\n            if (cellValue === null) return false;\r\n            return t1 === parseFloat(term.setting.val1);\r\n          case \"gt\":\r\n            if (term.setting.val1 === \"\" || term.setting.val1 === undefined) return true;\r\n            if (cellValue === null) return false;\r\n            return t1 > parseFloat(term.setting.val1);\r\n          case \"gte\":\r\n            if (term.setting.val1 === \"\" || term.setting.val1 === undefined) return true;\r\n            if (cellValue === null) return false;\r\n            return t1 >= parseFloat(term.setting.val1);\r\n          case \"lt\":\r\n            if (term.setting.val1 === \"\" || term.setting.val1 === undefined) return true;\r\n            if (cellValue === null) return false;\r\n            return t1 < parseFloat(term.setting.val1);\r\n          case \"lte\":\r\n            if (term.setting.val1 === \"\" || term.setting.val1 === undefined) return true;\r\n            if (cellValue === null) return false;\r\n\r\n            return t1 <= parseFloat(term.setting.val1);\r\n          case \"nbetween\": {\r\n            if (\r\n              term.setting.val1 === \"\" ||\r\n              term.setting.val2 === \"\" ||\r\n              term.setting.val1 === undefined ||\r\n              term.setting.val2 === undefined\r\n            )\r\n              return true;\r\n            if (cellValue === null) return false;\r\n            const t0 = parseFloat(term.setting.val1);\r\n            const t2 = parseFloat(term.setting.val2);\r\n            return t1 < t0 || t1 > t2;\r\n          }\r\n          case \"neq\":\r\n            if (cellValue === null) return false;\r\n            if (term.setting.val1 === \"\" || term.setting.val1 === undefined) return true;\r\n            return t1 !== parseFloat(term.setting.val1);\r\n          case \"nnull\":\r\n            return t1 !== null;\r\n          case \"null\":\r\n            return t1 === null;\r\n        }\r\n        break;\r\n      }\r\n      case \"ComboBox\": {\r\n        const filterVal1 = prepareAnyForFilter(this, term.setting.val1) || [];\r\n        const filterVal2 = prepareAnyForFilter(this, term.setting.val2) || \"\";\r\n        const cellText = prepareForFilter(this, dataTable.getOriginalCellText(row, prop))!;\r\n        switch (term.setting.type) {\r\n          case \"starts\": {\r\n            if (filterVal2 === \"\") return true;\r\n            if (cellText === null) return false;\r\n            return cellText.startsWith(filterVal2);\r\n          }\r\n          case \"nstarts\": {\r\n            if (filterVal2 === \"\") return true;\r\n            if (cellText === null) return false;\r\n            return !cellText.startsWith(filterVal2);\r\n          }\r\n          case \"in\":\r\n          case \"eq\": {\r\n            if (filterVal1.length === 0) return true;\r\n            if (cellValue === null) return false;\r\n            if (filterVal1.findIndex((item: any) => item === cellValue) > -1) {\r\n              return true;\r\n            }\r\n            return false;\r\n          }\r\n          case \"nin\":\r\n          case \"neq\": {\r\n            if (filterVal1.length === 0) return true;\r\n            if (cellValue === null) return false;\r\n            if (filterVal1.findIndex((item: any) => item === cellValue) > -1) {\r\n              return false;\r\n            }\r\n            return true;\r\n          }\r\n          case \"null\": {\r\n            return cellValue === null;\r\n          }\r\n          case \"nnull\": {\r\n            return cellValue !== null;\r\n          }\r\n          case \"contains\": {\r\n            if (filterVal2 === \"\") return true;\r\n            if (cellText === null) return false;\r\n            return cellText.includes(filterVal2);\r\n          }\r\n          case \"ncontains\": {\r\n            if (filterVal2 === \"\") return true;\r\n            if (cellText === null) return false;\r\n            return !cellText.includes(filterVal2);\r\n          }\r\n        }\r\n        break;\r\n      }\r\n      case \"TagInput\": {\r\n        const cellValues = prepareAnyForFilter(this, dataTable.getOriginalCellValue(row, prop));\r\n        const filterValues1 = prepareAnyForFilter(this, term.setting.val1);\r\n        switch (term.setting.type) {\r\n          case \"in\":\r\n          case \"eq\": {\r\n            if (filterValues1 === undefined || filterValues1.length === 0) return true;\r\n            if (!cellValues || cellValues.length === 0) return false;\r\n            return cellValues.some((val: any) =>\r\n              filterValues1.some(\r\n                (filterVal: any) => filterVal === val)\r\n            );\r\n          }\r\n          case \"nin\":\r\n          case \"neq\": {\r\n            if (filterValues1 === undefined || filterValues1.length === 0) return true;\r\n            if (!cellValues || cellValues.length === 0) return true;\r\n            return cellValues.every((val: any) =>\r\n              filterValues1.every(\r\n                (filterVal: any) => filterVal !== val)\r\n            );\r\n          }\r\n          case \"null\": {\r\n            return !cellValues || cellValues.length === 0;\r\n          }\r\n          case \"nnull\": {\r\n            return cellValues && cellValues.length > 0;\r\n          }\r\n\r\n        }\r\n        return true;\r\n      }\r\n      case \"CheckBox\": {\r\n        switch (term.setting.type) {\r\n          case \"eq\": {\r\n            if (term.setting.val1 === undefined) return true;\r\n            const bool1 = dataTable.getOriginalCellValue(row, prop);\r\n            return bool1 === !!term.setting.val1;\r\n          }\r\n        }\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  implicitFilterPredicate(row: any[], implicitFilter: IImplicitFilter) {\r\n    const dataTable = getDataTable(this);\r\n    const dataSource = getDataSource(dataTable);\r\n    const sourceField = dataSource.getFieldByName(implicitFilter.propertyId)!;\r\n    const cellValue = prepareAnyForFilter(this, dataTable.getCellValueByDataSourceField(row, sourceField));\r\n    const filterValue = prepareAnyForFilter(this, implicitFilter.value);\r\n\r\n    switch (parseInt(implicitFilter.operatorCode)) {\r\n      case 1:\r\n        return filterValue === String(cellValue);\r\n      case 10:\r\n        return filterValue !== String(cellValue);\r\n      case 15:\r\n        return cellValue === null;\r\n      case 16:\r\n        return cellValue !== null;\r\n      default:\r\n        throw new Error(`Operator code ${implicitFilter.operatorCode} not implemented.`);\r\n    }\r\n  }\r\n\r\n  isPresentInDetail(row: any[]): boolean {\r\n    if (this.dataView.isBindingRoot) return true;\r\n    for (let binding of this.dataView.parentBindings) {\r\n      const selectedRow = binding.parentDataView.selectedRow;\r\n      if (!selectedRow) {\r\n        return false;\r\n      }\r\n      for (let bindingPair of binding.bindingPairs) {\r\n        const parentDsField = binding.parentDataView.dataSource.getFieldByName(\r\n          bindingPair.parentPropertyId\r\n        );\r\n        if (!parentDsField) {\r\n          return false;\r\n        }\r\n        const parentValue = binding.parentDataView.dataTable.getCellValueByDataSourceField(\r\n          selectedRow,\r\n          parentDsField\r\n        );\r\n        const childDsField = binding.childDataView.dataSource.getFieldByName(\r\n          bindingPair.childPropertyId\r\n        );\r\n        if (!childDsField) {\r\n          return false;\r\n        }\r\n        const childValue = binding.childDataView.dataTable.getCellValueByDataSourceField(\r\n          row,\r\n          childDsField\r\n        );\r\n        if (parentValue !== childValue) {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  @computed get dataView() {\r\n    return getDataView(this);\r\n  }\r\n\r\n  disposers: any[] = [];\r\n\r\n  @action.bound start() {\r\n    this.disposers.push(\r\n      reaction(\r\n        () => {\r\n          return this.activeFilters.map((filter) => [\r\n            filter.propertyId,\r\n            filter.setting.val1,\r\n            filter.setting.val2,\r\n            filter.setting.type,\r\n          ]);\r\n        },\r\n        () => {\r\n          this.applyNewFiltering();\r\n        },\r\n\r\n        {equals: comparer.structural}\r\n      )\r\n    );\r\n  }\r\n\r\n  @action.bound applyNewFilteringImm = flow(function*(this: FilterConfiguration) {\r\n    const dataView = getDataView(this);\r\n    const dataTable = getDataTable(dataView);\r\n    if (!dataView.isLazyLoading) {\r\n      if (this.activeFilters.length > 0) {\r\n        const comboProps = this.activeFilters\r\n          .filter((filter) => filter.setting.isComplete)\r\n          .map((term) => getDataViewPropertyById(this, term.propertyId)!)\r\n          .filter((prop) => prop.column === \"ComboBox\");\r\n\r\n        yield Promise.all(\r\n          comboProps.map(async (prop) => {\r\n            return prop.lookupEngine?.lookupResolver.resolveList(\r\n              dataTable.getAllValuesOfProp(prop)\r\n            );\r\n          })\r\n        );\r\n      }\r\n    }\r\n  });\r\n\r\n  applyNewFiltering = _.throttle(this.applyNewFilteringImm, 200);\r\n\r\n  @action.bound stop() {\r\n    this.disposers.forEach((dis) => dis());\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n\r\ninterface IImplicitFilter {\r\n  propertyId: string;\r\n  operatorCode: string;\r\n  value: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IFormPanelView } from \"./types/IFormPanelView\";\r\n\r\nexport class FormPanelView implements IFormPanelView {\r\n  $type_IFormPanelView: 1 = 1;\r\n\r\n  parent?: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n\r\ninterface ITriggerablePromise<T> extends Promise<T> {\r\n  resolve(arg?: T): void;\r\n\r\n  reject(arg?: any): void;\r\n}\r\n\r\nexport function TriggerablePromise<T>() {\r\n  let fnResolve;\r\n  let fnReject;\r\n  const promise = new Promise<T>((resolve, reject) => {\r\n    fnResolve = resolve;\r\n    fnReject = reject;\r\n  });\r\n  (promise as any).resolve = fnResolve;\r\n  (promise as any).reject = fnReject;\r\n  return promise as ITriggerablePromise<T>;\r\n}\r\n\r\nexport class CriticalSection {\r\n\r\n  tokensIn = 0;\r\n\r\n  tokenQueue: ITriggerablePromise<any>[] = [];\r\n\r\n  enqueue() {\r\n    const promise = TriggerablePromise();\r\n    this.tokenQueue.push(promise);\r\n    return promise;\r\n  }\r\n\r\n  dequeue() {\r\n    const promise = this.tokenQueue.shift();\r\n    promise?.resolve();\r\n  }\r\n\r\n  incTokens() {\r\n    this.tokensIn++;\r\n  }\r\n\r\n  decTokens() {\r\n    this.tokensIn--;\r\n  }\r\n\r\n  enterPromise() {\r\n    this.incTokens();\r\n    if (this.tokensIn > 1) {\r\n      return this.enqueue();\r\n    }\r\n  }\r\n\r\n  *enterGenerator() {\r\n    this.incTokens();\r\n    if (this.tokensIn > 1) {\r\n      yield this.enqueue();\r\n    }\r\n  }\r\n\r\n  leave() {\r\n    this.decTokens();\r\n    if (this.tokensIn > 0) {\r\n      this.dequeue();\r\n    }\r\n  }\r\n\r\n  async runAsync<R>(fn: () => Promise<R>) {\r\n    try {\r\n      await this.enterPromise();\r\n      return fn();\r\n    } finally {\r\n      this.leave();\r\n    }\r\n  }\r\n\r\n  *runGenerator<R>(fn: () => Generator<any, R>) {\r\n    try {\r\n      yield*this.enterGenerator();\r\n      return yield*fn();\r\n    } finally {\r\n      this.leave();\r\n    }\r\n  }\r\n}\r\n\r\nexport function sleep(ms: number) {\r\n  return new Promise((resolve) => setTimeout(resolve, ms));\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { isBase64 } from \"./values\";\r\n\r\nconst IMAGE_TYPE: { [key: string]: string } = {\r\n  \"/\": \"jpg\",\r\n  i: \"png\",\r\n  R: \"gif\",\r\n  U: \"webp\",\r\n};\r\n\r\nexport function processedImageURL(value?: string) {\r\n  if (!value) {\r\n    return {\r\n      isEmbedded: false,\r\n      value: null,\r\n    };\r\n  }\r\n\r\n  if (value.length > 512 || isBase64(value)) {\r\n    return {isEmbedded: true, value: `data:image/${IMAGE_TYPE[value.charAt(0)]};base64,${value}`};\r\n  } else {\r\n    return {isEmbedded: false, value};\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport function isBase64(str?: string) {\r\n  if (!str) return false;\r\n  return str.search(/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/) > -1;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action, createAtom, observable } from \"mobx\";\r\nimport { processedImageURL } from \"utils/image\";\r\n\r\nexport class ScreenPictureCache {\r\n  @observable items = new Map<string, any>();\r\n  atoms = new Map<string, any>();\r\n\r\n  @action.bound\r\n  atomBecameObserved(url: string, atom: any) {\r\n    if (!this.items.has(url)) {\r\n      const procUrl = processedImageURL(url);\r\n      const img = new Image();\r\n      this.items.set(url, img);\r\n      atom.reportChanged();\r\n      img.onload = () => {\r\n        atom.reportChanged();\r\n      };\r\n      img.onerror = () => {\r\n        this.items.set(url, null);\r\n      };\r\n      img.src = procUrl.value!;\r\n    }\r\n  }\r\n\r\n  getImage(url: string) {\r\n    if (!this.atoms.has(url)) {\r\n      const atom = createAtom(\r\n        \"ImageCacheAtom\",\r\n        () => {\r\n          this.atomBecameObserved(url, atom);\r\n        },\r\n        () => {\r\n          this.atoms.delete(url);\r\n        }\r\n      );\r\n      this.atoms.set(url, atom);\r\n    }\r\n    const atom = this.atoms.get(url);\r\n    atom.reportObserved();\r\n    return this.items.get(url)!;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDropDownColumn } from \"./IDropDownColumn\";\r\n\r\nexport enum IDropDownType {\r\n  EagerlyLoadedGrid = \"EagerlyLoadedGrid\",\r\n  LazilyLoadedGrid = \"LazilyLoadedGrid\",\r\n  EagerlyLoadedTree = \"EagerlyLoadedTree\",\r\n}\r\n\r\nexport interface IDropDownParameter {\r\n  parameterName: string;\r\n  fieldName: string;\r\n}\r\n\r\nexport interface ILookupData {\r\n  lookupId: string;\r\n  dropDownShowUniqueValues: boolean;\r\n  identifier: string;\r\n  identifierIndex: number;\r\n  dropDownType: IDropDownType;\r\n  cached: boolean;\r\n  searchByFirstColumnOnly: boolean;\r\n  dropDownColumns: IDropDownColumn[];\r\n  dropDownParameters: IDropDownParameter[];\r\n}\r\n\r\nexport interface ILookup extends ILookupData {\r\n  $type_ILookup: 1;\r\n\r\n  parameters: { [key: string]: any };\r\n  parent?: any;\r\n}\r\n\r\nexport const isILookup = (o: any): o is ILookup => o.$type_ILookup;\r\n","import { IDataView } from \"./types/IDataView\";\r\nimport { getApi } from \"../selectors/getApi\";\r\nimport { getSessionId } from \"../selectors/getSessionId\";\r\nimport { getParentRowId } from \"../selectors/DataView/getParentRowId\";\r\nimport { getMasterRowId } from \"../selectors/DataView/getMasterRowId\";\r\n\r\nexport class DataViewCache {\r\n  constructor(private ctx: any) {\r\n  }\r\n\r\n  dataMap = new Map<string, any[][]>();\r\n\r\n  public UpdateData(dataView: IDataView) {\r\n    const parentRowId = getParentRowId(dataView);\r\n    const masterRowId = getMasterRowId(dataView);\r\n    if (!parentRowId || !masterRowId) {\r\n      return;\r\n    }\r\n    const cacheKey = this.makeCacheKey(dataView.modelInstanceId, parentRowId, masterRowId);\r\n    this.dataMap.set(cacheKey, [...dataView.dataTable.allRows])\r\n  }\r\n\r\n  public async getData(args: { childEntity: string, modelInstanceId: string, parentRecordId: string, rootRecordId: string }) {\r\n    const cacheKey = this.makeCacheKey(args.modelInstanceId, args.parentRecordId, args.rootRecordId);\r\n    if (!this.dataMap.has(cacheKey)) {\r\n      const rows = await this.callGetData(args.childEntity, args.parentRecordId, args.rootRecordId);\r\n      this.dataMap.set(cacheKey, rows);\r\n    }\r\n    return this.dataMap.get(cacheKey);\r\n  }\r\n\r\n  public clear() {\r\n    this.dataMap.clear();\r\n  }\r\n\r\n  private callGetData(childEntity: string, parentRecordId: string, rootRecordId: string) {\r\n    const api = getApi(this.ctx);\r\n    const dataPromise = api.getData({\r\n      SessionFormIdentifier: getSessionId(this.ctx),\r\n      ChildEntity: childEntity,\r\n      ParentRecordId: parentRecordId,\r\n      RootRecordId: rootRecordId,\r\n    });\r\n    return dataPromise;\r\n  }\r\n\r\n  private makeCacheKey(childEntity: string, parentRecordId: string, rootRecordId: string) {\r\n    return childEntity + \"_\" + parentRecordId + \"_\" + rootRecordId;\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDataView } from \"./types/IDataView\";\r\nimport { IDataSource } from \"./types/IDataSource\";\r\nimport { IComponentBinding } from \"./types/IComponentBinding\";\r\nimport { IFormScreenLifecycle02 } from \"./types/IFormScreenLifecycle\";\r\nimport { action, computed, observable } from \"mobx\";\r\nimport { IAction } from \"./types/IAction\";\r\nimport { isLazyLoading } from \"model/selectors/isLazyLoading\";\r\nimport { IFormScreen, IFormScreenData, IFormScreenEnvelope, IFormScreenEnvelopeData, } from \"./types/IFormScreen\";\r\nimport { IPanelConfiguration } from \"./types/IPanelConfiguration\";\r\nimport { CriticalSection } from \"utils/sync\";\r\nimport { getRowStates } from \"model/selectors/RowState/getRowStates\";\r\nimport { ScreenPictureCache } from \"./ScreenPictureCache\";\r\nimport { DataViewCache } from \"./DataViewCache\";\r\nimport { getFormScreen } from \"model/selectors/FormScreen/getFormScreen\";\r\nimport { getSessionId } from \"model/selectors/getSessionId\";\r\nimport { getEntity } from \"model/selectors/DataView/getEntity\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\nimport { ICRUDResult, IResponseOperation, processCRUDResult } from \"model/actions/DataLoading/processCRUDResult\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\n\r\nexport class FormScreen implements IFormScreen {\r\n\r\n  $type_IFormScreen: 1 = 1;\r\n\r\n  constructor(data: IFormScreenData) {\r\n    Object.assign(this, data);\r\n    this.formScreenLifecycle.parent = this;\r\n    this.dataViews.forEach((o) => (o.parent = this));\r\n    this.dataSources.forEach((o) => (o.parent = this));\r\n    this.componentBindings.forEach((o) => (o.parent = this));\r\n  }\r\n\r\n  parent?: any;\r\n\r\n  dataUpdateCRS = new CriticalSection();\r\n  pictureCache = new ScreenPictureCache();\r\n  dataViewCache = new DataViewCache(this);\r\n\r\n  @observable isDirty: boolean = false;\r\n  uiRootType = \"\";\r\n  dynamicTitleSource: string | undefined;\r\n  sessionId: string = \"\";\r\n  @observable title: string = \"\";\r\n  suppressSave: boolean = false;\r\n  suppressRefresh: boolean = false;\r\n  menuId: string = \"\";\r\n  openingOrder: number = 0;\r\n  showInfoPanel: boolean = false;\r\n  showWorkflowCancelButton: boolean = false;\r\n  showWorkflowNextButton: boolean = false;\r\n  autoRefreshInterval: number = 0;\r\n  refreshOnFocus: boolean = false;\r\n  cacheOnClient: boolean = false;\r\n  autoSaveOnListRecordChange: boolean = false;\r\n  requestSaveAfterUpdate: boolean = false;\r\n  screenUI: any;\r\n  @observable\r\n  panelConfigurations: Map<string, IPanelConfiguration> = new Map();\r\n  isLoading: false = false;\r\n  formScreenLifecycle: IFormScreenLifecycle02 = null as any;\r\n  autoWorkflowNext: boolean = null as any;\r\n  workflowTaskId: string | null = null;\r\n\r\n  dataViews: IDataView[] = [];\r\n  dataSources: IDataSource[] = [];\r\n  componentBindings: IComponentBinding[] = [];\r\n\r\n  setPanelSize(id: string, size: number) {\r\n    if (!this.panelConfigurations.has(id)) {\r\n      this.panelConfigurations.set(\r\n        id,\r\n        {\r\n          position: undefined,\r\n          defaultOrdering: undefined\r\n        }\r\n      )\r\n    }\r\n    this.panelConfigurations.get(id)!.position = size;\r\n  }\r\n\r\n  getData(childEntity: string, modelInstanceId: string, parentRecordId: string, rootRecordId: string) {\r\n    this.dataSources.filter(dataSource => dataSource.entity === childEntity)\r\n      .forEach(dataSource => getRowStates(dataSource).clearAll());\r\n    return this.dataViewCache.getData({\r\n      childEntity: childEntity,\r\n      modelInstanceId: modelInstanceId,\r\n      parentRecordId: parentRecordId,\r\n      rootRecordId: rootRecordId\r\n    });\r\n  }\r\n\r\n  clearDataCache() {\r\n    this.dataViewCache.clear();\r\n  }\r\n\r\n\r\n  get dynamicTitle() {\r\n    if (!this.dynamicTitleSource) {\r\n      return undefined;\r\n    }\r\n    const splitSource = this.dynamicTitleSource.split(\".\");\r\n    const dataSourceName = splitSource[0];\r\n    const columnName = splitSource[1];\r\n\r\n    const dataView = this.dataViews.find((view) => view.entity === dataSourceName);\r\n    if (!dataView) return undefined;\r\n    const dataSource = this.dataSources.find((view) => view.entity === dataSourceName);\r\n    if (!dataSource) return undefined;\r\n    const dataSourceField = dataSource!.getFieldByName(columnName);\r\n    const dataTable = dataView!.dataTable;\r\n    const firstRow = dataTable.rows[0];\r\n    return firstRow\r\n      ? dataTable.getCellValueByDataSourceField(firstRow, dataSourceField!)\r\n      : undefined;\r\n  }\r\n\r\n  @computed get isLazyLoading() {\r\n    return isLazyLoading(this);\r\n  }\r\n\r\n  @computed get rootDataViews(): IDataView[] {\r\n    return this.dataViews.filter((dv) => dv.isBindingRoot);\r\n  }\r\n\r\n  @computed get nonRootDataViews(): IDataView[] {\r\n    return this.dataViews.filter((dv) => !dv.isBindingRoot);\r\n  }\r\n\r\n  @action.bound setTitle(title: string) {\r\n    this.title = title;\r\n  }\r\n\r\n  getBindingsByChildId(childId: string) {\r\n    return this.componentBindings.filter((b) => b.childId === childId);\r\n  }\r\n\r\n  getBindingsByParentId(parentId: string) {\r\n    return this.componentBindings.filter((b) => b.parentId === parentId);\r\n  }\r\n\r\n  getDataViewByModelInstanceId(modelInstanceId: string): IDataView | undefined {\r\n    return this.dataViews.find((dv) => dv.modelInstanceId === modelInstanceId);\r\n  }\r\n\r\n  getDataViewsByEntity(entity: string): IDataView[] {\r\n    return this.dataViews.filter((dv) => dv.entity === entity);\r\n  }\r\n\r\n  getDataSourceByEntity(entity: string): IDataSource | undefined {\r\n    return this.dataSources.find((ds) => ds.entity === entity);\r\n  }\r\n\r\n  @computed get toolbarActions() {\r\n    const result: Array<{ section: string; actions: IAction[] }> = [];\r\n    for (let dv of this.dataViews) {\r\n      if (dv.toolbarActions.length > 0) {\r\n        result.push({\r\n          section: dv.name,\r\n          actions: dv.toolbarActions,\r\n        });\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  @computed get dialogActions() {\r\n    const result: IAction[] = [];\r\n    for (let dv of this.dataViews) {\r\n      result.push(...dv.dialogActions);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  getPanelPosition(id: string): number | undefined {\r\n    const conf = this.panelConfigurations.get(id.toLowerCase());\r\n    return conf ? conf.position : undefined;\r\n  }\r\n\r\n  @action.bound\r\n  setDirty(state: boolean): void {\r\n    if (this.suppressSave && state === true) {\r\n      return;\r\n    }\r\n    this.isDirty = state;\r\n  }\r\n\r\n  getFirstFormPropertyId() {\r\n    for (let dv of this.dataViews) {\r\n      for (let prop of dv.properties) {\r\n        if (prop.isFormField) return prop.id;\r\n      }\r\n    }\r\n  }\r\n\r\n  /* eslint-disable no-console */\r\n  printMasterDetailTree() {\r\n    const strrep = (cnt: number, str: string) => {\r\n      let result = \"\";\r\n      for (let i = 0; i < cnt; i++) result = result + str;\r\n      return result;\r\n    };\r\n\r\n    const recursive = (dataView: IDataView, level: number) => {\r\n      console.log(\r\n        `${strrep(level, \"  \")}${dataView?.name} (${dataView?.entity} - ${dataView?.modelId})`\r\n      );\r\n      if (!dataView) {\r\n        return;\r\n      }\r\n      for (let chb of dataView.childBindings) {\r\n        recursive(chb.childDataView, level + 1);\r\n      }\r\n    };\r\n    console.log(\"View bindings\");\r\n    console.log(\"=============\");\r\n    const roots = Array.from(this.dataViews.values()).filter((dv) => dv.isBindingRoot);\r\n    for (let dv of roots) {\r\n      recursive(dv, 0);\r\n    }\r\n    console.log(\"=============\");\r\n    console.log(\"End of View bindings\");\r\n    console.log(\"\");\r\n  }\r\n\r\n  /* eslint-enable no-console */\r\n}\r\n\r\nexport class FormScreenEnvelope implements IFormScreenEnvelope {\r\n  $type_IFormScreenEnvelope: 1 = 1;\r\n\r\n  constructor(data: IFormScreenEnvelopeData) {\r\n    Object.assign(this, data);\r\n    this.formScreenLifecycle.parent = this;\r\n  }\r\n\r\n  @observable formScreen?: IFormScreen | undefined;\r\n  formScreenLifecycle: IFormScreenLifecycle02 = null as any;\r\n\r\n  @computed get isLoading() {\r\n    return !this.formScreen;\r\n  }\r\n\r\n  @action.bound\r\n  setFormScreen(formScreen?: IFormScreen | undefined): void {\r\n    if (formScreen) {\r\n      formScreen.parent = this;\r\n    }\r\n    this.formScreen = formScreen;\r\n  }\r\n\r\n  *start(initUIResult: any, preloadIsDirty?: boolean): Generator {\r\n    yield*this.formScreenLifecycle.start(initUIResult);\r\n    if (this.formScreen) {\r\n      this.formScreen.setDirty(!!preloadIsDirty);\r\n      if(preloadIsDirty){\r\n       yield*this.loadDirtyRow(this.formScreen);\r\n      }\r\n    }\r\n  }\r\n\r\n  *loadDirtyRow(formScreen: IFormScreen){\r\n    for (let rootDataView of formScreen.rootDataViews) {\r\n      const api  = getApi(rootDataView)\r\n      const isDirty = getFormScreen(rootDataView).isDirty\r\n      if(isDirty){\r\n        const dirtyRowResult = (yield api.getRow({\r\n          SessionFormIdentifier: getSessionId(rootDataView),\r\n          Entity: getEntity(rootDataView),\r\n          RowId: getSelectedRowId(rootDataView)!\r\n        })) as ICRUDResult;\r\n\r\n        const selectedRowExists = rootDataView.selectedRowId &&\r\n          rootDataView.dataTable.getRowById(rootDataView.selectedRowId);\r\n        dirtyRowResult.operation = selectedRowExists\r\n          ? IResponseOperation.Update\r\n          : IResponseOperation.Create;\r\n\r\n        yield*processCRUDResult(rootDataView, dirtyRowResult) as any;\r\n      }\r\n    }\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDropDownColumn } from \"./types/IDropDownColumn\";\r\nimport { IDropDownParameter, IDropDownType, ILookup, ILookupData } from \"./types/ILookup\";\r\n\r\nexport enum IIdState {\r\n  LOADING = \"LOADING\",\r\n  ERROR = \"ERROR\",\r\n}\r\n\r\nexport class Lookup implements ILookup {\r\n  constructor(data: ILookupData) {\r\n    Object.assign(this, data);\r\n    this.dropDownColumns.forEach((o) => (o.parent = this));\r\n  }\r\n\r\n  $type_ILookup: 1 = 1;\r\n\r\n  lookupId: string = \"\";\r\n  dropDownShowUniqueValues: boolean = false;\r\n  identifier: string = \"\";\r\n  identifierIndex: number = 0;\r\n  dropDownType: IDropDownType = IDropDownType.EagerlyLoadedGrid;\r\n  cached: boolean = false;\r\n  searchByFirstColumnOnly: boolean = false;\r\n  dropDownColumns: IDropDownColumn[] = [];\r\n  dropDownParameters: IDropDownParameter[] = [];\r\n\r\n  parent?: any;\r\n\r\n  get parameters() {\r\n    const parameters: { [key: string]: any } = {};\r\n    for (let param of this.dropDownParameters) {\r\n      parameters[param.parameterName] = param.fieldName;\r\n    }\r\n    return parameters;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IProperty } from \"../../entities/types/IProperty\";\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getProperties(ctx: any): IProperty[] {\r\n  return getDataView(ctx).properties;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action, computed, flow, observable } from \"mobx\";\r\nimport {\r\n  IOrderByColumnSetting,\r\n  IOrderByDirection,\r\n  IOrdering,\r\n  IOrderingConfiguration,\r\n} from \"./types/IOrderingConfiguration\";\r\nimport _ from \"lodash\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { getDataViewPropertyById } from \"model/selectors/DataView/getDataViewPropertyById\";\r\nimport { getProperties } from \"../selectors/DataView/getProperties\";\r\nimport { compareStrings } from \"../../utils/string\";\r\n\r\nfunction cycleOrdering(direction: IOrderByDirection) {\r\n  switch (direction) {\r\n    case IOrderByDirection.ASC:\r\n      return IOrderByDirection.DESC;\r\n    case IOrderByDirection.DESC:\r\n      return IOrderByDirection.NONE;\r\n    case IOrderByDirection.NONE:\r\n    default:\r\n      return IOrderByDirection.ASC;\r\n  }\r\n}\r\n\r\nfunction flipOrdering(direction: IOrderByDirection) {\r\n  return direction === IOrderByDirection.DESC\r\n    ? IOrderByDirection.ASC\r\n    : IOrderByDirection.DESC;\r\n}\r\n\r\nexport class OrderingConfiguration implements IOrderingConfiguration {\r\n  @observable userOrderings: IOrdering[] = [];\r\n  private defaultOrderings: IOrdering[];\r\n\r\n  constructor(defaultOrderings: IOrdering[] | undefined) {\r\n    this.defaultOrderings = defaultOrderings ?? [];\r\n    this.userOrderings = this.defaultOrderings;\r\n  }\r\n\r\n  getDefaultOrderings() {\r\n    return this.defaultOrderings;\r\n  }\r\n\r\n  @computed get orderings() {\r\n    return this.userOrderings.length !== 0 ? this.userOrderings : this.defaultOrderings;\r\n  }\r\n\r\n  @computed get groupChildrenOrdering(): IOrdering | undefined {\r\n    return this.userOrderings.length === 0 || !this.userOrderings[0] ? undefined : this.userOrderings[0];\r\n  }\r\n\r\n  getOrdering(column: string): IOrderByColumnSetting {\r\n    const ordIndex = this.orderings.findIndex((item) => item.columnId === column);\r\n    if (ordIndex === -1) {\r\n      return {\r\n        order: 0,\r\n        ordering: IOrderByDirection.NONE,\r\n      };\r\n    } else {\r\n      return {\r\n        order: ordIndex,\r\n        ordering: this.orderings[ordIndex].direction,\r\n      };\r\n    }\r\n  }\r\n\r\n  private newOrdering(columnId: string, direction: IOrderByDirection): IOrdering {\r\n    const property = getProperties(this).find((prop) => prop.id === columnId);\r\n    const lookupId = property && property.lookup && property.lookup.lookupId;\r\n    return {\r\n      columnId: columnId,\r\n      direction: direction,\r\n      lookupId: lookupId,\r\n    };\r\n  }\r\n\r\n  @action.bound\r\n  setOrdering(columnId: string): void {\r\n    const orderingClone = _.cloneDeep(this.userOrderings);\r\n    const curOrd = this.userOrderings.find((item) => item.columnId === columnId);\r\n    this.userOrderings.length = 0;\r\n    if (!curOrd) {\r\n      this.userOrderings.push(this.newOrdering(columnId, IOrderByDirection.ASC));\r\n    } else {\r\n      this.userOrderings.push(this.newOrdering(columnId, flipOrdering(curOrd.direction)));\r\n    }\r\n\r\n    if (!_.isEqual(orderingClone, this.userOrderings)) {\r\n      this.maybeApplyOrdering();\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  addOrdering(columnId: string): void {\r\n    const orderingClone = _.cloneDeep(this.userOrderings);\r\n    const curOrd = this.userOrderings.find((item) => item.columnId === columnId);\r\n    if (!curOrd) {\r\n      this.userOrderings.push(this.newOrdering(columnId, IOrderByDirection.ASC));\r\n    } else {\r\n      curOrd.direction = cycleOrdering(curOrd.direction);\r\n    }\r\n\r\n    if (!_.isEqual(orderingClone, this.userOrderings)) {\r\n      this.maybeApplyOrdering();\r\n    }\r\n  }\r\n\r\n  maybeApplyOrdering = flow(\r\n    function*(this: OrderingConfiguration) {\r\n      const dataView = getDataView(this);\r\n      const dataTable = getDataTable(dataView);\r\n      if (!dataView.isLazyLoading) {\r\n        const comboProps = this.userOrderings\r\n          .map((term) => getDataViewPropertyById(this, term.columnId)!)\r\n          .filter((prop) => prop.column === \"ComboBox\");\r\n\r\n        yield Promise.all(\r\n          comboProps.map(async (prop) => {\r\n            return prop.lookupEngine?.lookupResolver.resolveList(\r\n              dataTable.getAllValuesOfProp(prop)\r\n            );\r\n          })\r\n        );\r\n      }\r\n    }.bind(this)\r\n  );\r\n\r\n  @computed get orderingFunction(): () => (row1: any[], row2: any[]) => number {\r\n    return () => (row1: any[], row2: any) => {\r\n      const dataTable = getDataTable(this);\r\n      let mul = 10 * this.orderings.length;\r\n      let res = 0;\r\n      for (let term of this.orderings) {\r\n        const prop = dataTable.getPropertyById(term.columnId)!;\r\n        let cmpSign = 0;\r\n        switch (prop.column) {\r\n          case \"Text\":\r\n          case \"Date\":\r\n          case \"ComboBox\":\r\n            const txt1 = dataTable.getOriginalCellText(row1, prop);\r\n            const txt2 = dataTable.getOriginalCellText(row2, prop);\r\n            cmpSign = compareStrings(txt1, txt2);\r\n            break;\r\n          case \"CheckBox\": {\r\n            const val1 = dataTable.getOriginalCellValue(row1, prop);\r\n            const val2 = dataTable.getOriginalCellValue(row2, prop);\r\n            cmpSign = compareStrings(`${val1}`, `${val2}`);\r\n            break;\r\n          }\r\n          case \"Number\": {\r\n            const val1 = dataTable.getOriginalCellValue(row1, prop);\r\n            const val2 = dataTable.getOriginalCellValue(row2, prop);\r\n            if (val1 === null) {\r\n              cmpSign = 1;\r\n            } else if (val2 === null) {\r\n              cmpSign = -1;\r\n            } else {\r\n              cmpSign = Math.sign(val1 - val2);\r\n            }\r\n            break;\r\n          }\r\n        }\r\n        res = res + mul * (term.direction === IOrderByDirection.DESC ? -1 : 1) * cmpSign;\r\n        mul = mul / 10;\r\n      }\r\n      return res;\r\n    };\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport enum IPropertyColumn {\r\n  Text = \"Text\",\r\n  ComboBox = \"ComboBox\",\r\n  TagInput = \"TagInput\",\r\n  Date = \"Date\",\r\n  Number = \"Number\",\r\n  CheckBox = \"CheckBox\",\r\n  CheckList = \"Checklist\",\r\n  Image = \"Image\",\r\n  Blob = \"Blob\",\r\n  Polymorph = \"Polymorph\",\r\n  Color = \"Color\"\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDockType, IProperty, IPropertyData } from \"./types/IProperty\";\r\nimport { ICaptionPosition } from \"./types/ICaptionPosition\";\r\nimport { IPropertyColumn } from \"./types/IPropertyColumn\";\r\nimport { action, computed, observable } from \"mobx\";\r\n\r\nimport { ILookup } from \"./types/ILookup\";\r\nimport { getDataSourceFieldByName } from \"model/selectors/DataSources/getDataSourceFieldByName\";\r\nimport { IDataSourceField } from \"./types/IDataSourceField\";\r\nimport { LookupResolver } from \"modules/Lookup/LookupResolver\";\r\nimport { LookupLabelsCleanerReloader } from \"modules/Lookup/LookupCleanerLoader\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\n\r\nexport class Property implements IProperty {\r\n  $type_IProperty: 1 = 1;\r\n\r\n  constructor(data: IPropertyData) {\r\n    Object.assign(this, data);\r\n    if (this.lookup) {\r\n      this.lookup.parent = this;\r\n    }\r\n  }\r\n\r\n  autoSort: boolean = false;\r\n  id: string = \"\";\r\n  tabIndex: string | undefined;\r\n  modelInstanceId: string = \"\";\r\n  name: string = \"\";\r\n  nameOverride: string | null | undefined = null;\r\n  readOnly: boolean = false;\r\n  x: number = 0;\r\n  y: number = 0;\r\n  width: number = 0;\r\n  height: number = 0;\r\n  captionLength: number = 0;\r\n  captionPosition?: ICaptionPosition;\r\n  entity: string = \"\";\r\n  column: IPropertyColumn = IPropertyColumn.Text;\r\n  dock?: IDockType | undefined;\r\n  multiline: boolean = false;\r\n  isPassword: boolean = false;\r\n  isRichText: boolean = false;\r\n  maxLength: number = 0;\r\n  allowReturnToForm?: boolean | undefined;\r\n  isTree?: boolean | undefined;\r\n  formatterPattern: string = \"\";\r\n  modelFormatterPattern: string = \"\";\r\n  customNumericFormat: string = \"\";\r\n  gridColumnWidth: number = 100;\r\n  @observable columnWidth: number = 100;\r\n  identifier?: string;\r\n  lookup?: ILookup;\r\n  lookupId?: string;\r\n  lookupEngine?: ILookupIndividualEngine = null as any;\r\n  childProperties: IProperty[] = [];\r\n  isAggregatedColumn: boolean = false;\r\n  isLookupColumn: boolean = false;\r\n  style: any;\r\n  controlPropertyId?: string;\r\n  toolTip: string = null as any;\r\n  suppressEmptyColumns: boolean = false;\r\n  supportsServerSideSorting: boolean = false;\r\n\r\n  linkToMenuId?: string = undefined;\r\n  linkDependsOnValue: boolean = false;\r\n  fieldType: string = null as any;\r\n  isFormField: boolean = false;\r\n\r\n  get isLookup() {\r\n    return !!this.lookup;\r\n  }\r\n\r\n  get isLink() {\r\n    return !!this.linkToMenuId || this.linkDependsOnValue;\r\n  }\r\n\r\n  @action.bound setColumnWidth(width: number) {\r\n    this.columnWidth = width;\r\n  }\r\n\r\n  @computed get dataSourceIndex(): number {\r\n    return this.dataSourceField.index;\r\n  }\r\n\r\n  @computed get dataIndex() {\r\n    return this.dataSourceIndex;\r\n  }\r\n\r\n  @computed get dataSourceField(): IDataSourceField {\r\n    return getDataSourceFieldByName(this, this.id)!;\r\n  }\r\n\r\n  @action.bound\r\n  stop() {\r\n\r\n  }\r\n\r\n  parent: any;\r\n  xmlNode = undefined;\r\n\r\n  getPolymophicProperty(row: any[]): IProperty {\r\n    const dataSourceField = getDataSourceFieldByName(this, this.controlPropertyId!)!;\r\n    const controlPropertyValue = getDataTable(this)\r\n      .getCellValueByDataSourceField(row, dataSourceField);\r\n    return this.childProperties\r\n        .find(prop => prop.controlPropertyValue === controlPropertyValue)\r\n      ?? this;\r\n  }\r\n}\r\n\r\n\r\nexport interface ILookupIndividualEngine {\r\n  lookupResolver: LookupResolver;\r\n  lookupCleanerReloader: LookupLabelsCleanerReloader;\r\n\r\n  startup(): void;\r\n\r\n  teardown(): void;\r\n\r\n  cleanAndReload(): void;\r\n};","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getApplication } from \"../getApplication\";\r\n\r\nexport function getDialogStack(ctx?: any) {\r\n  return getApplication(ctx).dialogStack;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { T } from \"utils/translation\";\r\n\r\nexport enum GroupingUnit {\r\n  Year, Month, Day, Hour, Minute\r\n}\r\n\r\nexport function groupingUnitToLabel(groupingUnit: GroupingUnit | undefined){\r\n  switch(groupingUnit){\r\n    case GroupingUnit.Year:\r\n      return T(\"Year\", \"group_by_year\");\r\n    case GroupingUnit.Month:\r\n      return T(\"Month\", \"group_by_month\");\r\n    case GroupingUnit.Day:\r\n      return T(\"Day\", \"group_by_day\");\r\n    case GroupingUnit.Hour:\r\n      return T(\"Hour\", \"group_by_hour\");\r\n    case GroupingUnit.Minute:\r\n      return T(\"Minute\", \"group_by_minute\");\r\n    default:\r\n      return \"\";\r\n  }\r\n}\r\n\r\nexport function groupingUnitToString(unit: GroupingUnit | undefined) {\r\n  switch (unit) {\r\n    case GroupingUnit.Year:\r\n      return \"year\";\r\n    case GroupingUnit.Month:\r\n      return \"month\";\r\n    case GroupingUnit.Day:\r\n      return \"day\";\r\n    case GroupingUnit.Hour:\r\n      return \"hour\";\r\n    case GroupingUnit.Minute:\r\n      return \"minute\";\r\n    case undefined:\r\n      return undefined;\r\n    default:\r\n      throw new Error(\"GroupingUnitToString not implemented for value:\" + unit)\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport enum AggregationType { SUM = \"SUM\", AVG = \"AVG\", MIN = \"MIN\", MAX = \"MAX\", COUNT = \"COUNT\"}\r\n\r\nexport function tryParseAggregationType(candidate: any | undefined) {\r\n  if (!candidate || candidate === \"0\") return undefined;\r\n  return parseAggregationType(candidate);\r\n}\r\n\r\n\r\nexport function aggregationTypeToNumber(aggregationType: AggregationType | undefined) {\r\n  switch (aggregationType) {\r\n    case undefined:\r\n      return 0;\r\n    case AggregationType.SUM:\r\n      return 1;\r\n    case AggregationType.AVG:\r\n      return 2;\r\n    case AggregationType.MIN:\r\n      return 3;\r\n    case AggregationType.MAX:\r\n      return 4;\r\n    case AggregationType.COUNT:\r\n      return 5;\r\n    default:\r\n      throw new Error(\"Cannot map \\\"\" + aggregationType + \"\\\" to number\")\r\n  }\r\n}\r\n\r\nexport function parseAggregationType(candidate: any | undefined) {\r\n  if (typeof candidate !== 'string') {\r\n    throw new Error(\"Cannot map \\\"\" + candidate + \"\\\" to AggregationType\")\r\n  }\r\n\r\n  switch ((candidate as string).toUpperCase()) {\r\n    case \"1\":\r\n    case \"SUM\":\r\n      return AggregationType.SUM;\r\n    case \"2\":\r\n    case \"AVG\":\r\n      return AggregationType.AVG;\r\n    case \"3\":\r\n    case \"MIN\":\r\n      return AggregationType.MIN;\r\n    case \"4\":\r\n    case \"MAX\":\r\n      return AggregationType.MAX;\r\n    case \"5\":\r\n    case \"COUNT\":\r\n      return AggregationType.COUNT;\r\n    default:\r\n      throw new Error(\"Cannot map \\\"\" + candidate + \"\\\" to AggregationType\")\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport CS from \"gui/Components/Dialogs/DialogsCommon.module.css\";\r\nimport S from \"gui/Components/Dialogs/FavoriteFolderPropertiesDialog.module.scss\";\r\nimport { observable } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { T } from \"utils/translation\";\r\nimport { ModalDialog } from \"gui/Components/Dialog/ModalDialog\";\r\n\r\n@observer\r\nexport class NewConfigurationDialog extends React.Component<{\r\n  onCancelClick: (event: any) => void;\r\n  onOkClick: (name: string) => void;\r\n}> {\r\n  @observable\r\n  groupName: string = \"\";\r\n\r\n  get isInvalid() {\r\n    return this.groupName === \"\";\r\n  }\r\n\r\n  refInput = React.createRef<HTMLInputElement>();\r\n\r\n  onNameChanged(event: any) {\r\n    this.groupName = event.target.value;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.refInput.current?.focus();\r\n  }\r\n\r\n  onKeydown(event: React.KeyboardEvent<HTMLInputElement>) {\r\n    if (event.key === \"Enter\") {\r\n      this.onOkClick();\r\n    }\r\n  }\r\n\r\n  onOkClick() {\r\n    if (this.isInvalid) {\r\n      return;\r\n    }\r\n    this.props.onOkClick(this.groupName);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <ModalDialog\r\n        title={T(\"New Column Configuration\", \"column_config_new_config_name\")}\r\n        titleButtons={null}\r\n        buttonsCenter={\r\n          <>\r\n            <button tabIndex={0} onClick={() => this.onOkClick()}>\r\n              {T(\"Ok\", \"button_ok\")}\r\n            </button>\r\n            <button tabIndex={0} onClick={this.props.onCancelClick}>\r\n              {T(\"Cancel\", \"button_cancel\")}\r\n            </button>\r\n          </>\r\n        }\r\n        buttonsLeft={null}\r\n        buttonsRight={null}\r\n      >\r\n        <div className={CS.dialogContent}>\r\n          <div className={S.inpuContainer}>\r\n            <div className={S.row}>\r\n              <div className={S.label}>{T(\"Name:\", \"column_config_config_name\")}</div>\r\n              <input\r\n                ref={this.refInput}\r\n                className={S.textInput}\r\n                value={this.groupName}\r\n                onChange={(event) => this.onNameChanged(event)}\r\n                onKeyDown={(event: React.KeyboardEvent<HTMLInputElement>) => this.onKeydown(event)}\r\n              />\r\n              {this.isInvalid && (\r\n                <div>\r\n                  <div\r\n                    className={S.notification}\r\n                    title={T(\"Name cannot be empty\", \"column_config_name_empty\")}\r\n                  >\r\n                    <i className=\"fas fa-exclamation-circle red\"/>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </ModalDialog>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IPanelViewType } from \"../../entities/types/IPanelViewType\";\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getActivePanelView(ctx: any): IPanelViewType {\r\n  return getDataView(ctx).activePanelView;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { getActivePanelView } from \"model/selectors/DataView/getActivePanelView\";\r\nimport { getSessionId } from \"model/selectors/getSessionId\";\r\nimport { getProperties } from \"model/selectors/DataView/getProperties\";\r\nimport { getConfigurationManager } from \"model/selectors/TablePanelView/getConfigurationManager\";\r\nimport { runGeneratorInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\n\r\nexport function saveColumnConfigurations(ctx: any) {\r\n  return function*saveColumnConfigurations() {\r\n    const dataView = getDataView(ctx);\r\n    const configurationManager = getConfigurationManager(ctx);\r\n    const tablePanelView = getTablePanelView(ctx);\r\n\r\n    if (configurationManager.allTableConfigurations.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const activeTableConfiguration = configurationManager.activeTableConfiguration;\r\n    for (const property of getProperties(ctx)) {\r\n      activeTableConfiguration.updateColumnWidth(property.id, property.columnWidth);\r\n    }\r\n    activeTableConfiguration.sortColumnConfigurations(tablePanelView.tablePropertyIds);\r\n\r\n    yield getApi(ctx).saveObjectConfiguration({\r\n      sessionFormIdentifier: getSessionId(ctx),\r\n      instanceId: dataView.modelInstanceId,\r\n      tableConfigurations: configurationManager.allTableConfigurations,\r\n      defaultView: getActivePanelView(ctx),\r\n    });\r\n  };\r\n}\r\n\r\nexport async function saveColumnConfigurationsAsync(ctx: any) {\r\n  await runGeneratorInFlowWithHandler({\r\n    ctx: ctx,\r\n    generator: function*() {\r\n      yield*saveColumnConfigurations(ctx)();\r\n    }()\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { action, computed } from \"mobx\";\r\nimport { getDialogStack } from \"../../selectors/DialogStack/getDialogStack\";\r\nimport { isLazyLoading } from \"model/selectors/isLazyLoading\";\r\nimport { ITableConfiguration } from \"./types/IConfigurationManager\";\r\nimport { runGeneratorInFlowWithHandler, runInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\nimport { getConfigurationManager } from \"model/selectors/TablePanelView/getConfigurationManager\";\r\nimport { NewConfigurationDialog } from \"gui/Components/Dialogs/NewConfigurationDialog\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { saveColumnConfigurations } from \"model/actions/DataView/TableView/saveColumnConfigurations\";\r\nimport { compareStrings } from \"utils/string\";\r\nimport { GroupingUnit, groupingUnitToLabel } from \"model/entities/types/GroupingUnit\";\r\nimport { AggregationType, tryParseAggregationType } from \"model/entities/types/AggregationType\";\r\nimport { T } from \"utils/translation\";\r\nimport { IOption } from \"@origam/components\";\r\n\r\nexport interface IColumnOptions {\r\n  canGroup: boolean;\r\n  canAggregate: boolean;\r\n  entity: string;\r\n  name: string;\r\n  modelInstanceId: string;\r\n}\r\n\r\nexport const dialogKey = \"ColumnConfigurationDialog\";\r\n\r\nexport class ColumnConfigurationModel{\r\n\r\n  tableConfigBeforeChanges: ITableConfiguration | undefined;\r\n\r\n  @computed\r\n  get columnOptions() {\r\n    const groupingOnClient = !isLazyLoading(this);\r\n    const activeTableConfiguration = this.configManager.activeTableConfiguration;\r\n    const optionsMap = new Map<string, IColumnOptions>()\r\n\r\n    for (let columnConfiguration of activeTableConfiguration.columnConfigurations) {\r\n      const property = this.tablePanelView.allTableProperties\r\n        .find(prop => prop.id === columnConfiguration.propertyId)!;\r\n      optionsMap.set(\r\n        property.id,\r\n        {\r\n          canGroup: groupingOnClient ||\r\n            (!property.isAggregatedColumn && property.fieldType !== \"DetachedField\"),\r\n          canAggregate: groupingOnClient ||\r\n            (!property.isAggregatedColumn && !property.isLookupColumn && property.column !== \"TagInput\"),\r\n          entity: property.entity,\r\n          name: property.name,\r\n          modelInstanceId: property.modelInstanceId\r\n        })\r\n    }\r\n    return optionsMap;\r\n  }\r\n\r\n  get columnsConfiguration() {\r\n    return this.configManager.activeTableConfiguration;\r\n  }\r\n\r\n  reset() {\r\n    this.tableConfigBeforeChanges = this.configManager.activeTableConfiguration.deepClone();\r\n  }\r\n\r\n  get sortedColumnConfigs(){\r\n    return [...this.columnsConfiguration.columnConfigurations].sort(\r\n      (a, b) => {\r\n        const optionA = this.columnOptions.get(a.propertyId)!;\r\n        const optionB = this.columnOptions.get(b.propertyId)!;\r\n        return compareStrings(optionA.name, optionB.name)\r\n      }\r\n    );\r\n  }\r\n\r\n  @action.bound\r\n  onColumnConfigurationSubmit() {\r\n    const self = this;\r\n    runGeneratorInFlowWithHandler({\r\n      ctx: this,\r\n      generator: function*() {\r\n        self.onColumnConfSubmit(self.columnsConfiguration);\r\n        self.reset();\r\n        yield*saveColumnConfigurations(self)();\r\n      }()\r\n    })\r\n  }\r\n\r\n  @action.bound\r\n  onColumnConfCancel(): void {\r\n    this.revertChanges();\r\n    getDialogStack(this).closeDialog(dialogKey);\r\n  }\r\n\r\n  private revertChanges() {\r\n    if (!this.tableConfigBeforeChanges) {\r\n      throw new Error(\"TableConfiguration was not backed up\")\r\n    }\r\n    this.configManager.activeTableConfiguration = this.tableConfigBeforeChanges;\r\n  }\r\n\r\n  @action.bound\r\n  onSaveAsClick(): void {\r\n    const closeDialog = getDialogStack(this).pushDialog(\r\n      \"\",\r\n      <NewConfigurationDialog\r\n        onOkClick={(name) => {\r\n          runInFlowWithHandler({\r\n            ctx: this,\r\n            action: () => {\r\n              const newConfiguration = this.columnsConfiguration.deepClone();\r\n              this.revertChanges();\r\n              this.configManager.cloneAndActivate(newConfiguration, name);\r\n              this.onColumnConfigurationSubmit();\r\n            }\r\n          });\r\n          closeDialog();\r\n        }}\r\n        onCancelClick={() => {\r\n          this.revertChanges();\r\n          closeDialog();\r\n        }}\r\n      />\r\n    );\r\n  }\r\n\r\n  @action.bound\r\n  onColumnConfSubmit(configuration: ITableConfiguration): void {\r\n    const groupingWasOnBefore = this.tablePanelView?.groupingConfiguration.isGrouping;\r\n    configuration.apply(this.tablePanelView);\r\n    const groupingIsOffNow = !this.tablePanelView?.groupingConfiguration.isGrouping;\r\n\r\n    if (groupingWasOnBefore && groupingIsOffNow) {\r\n      getFormScreenLifecycle(this).loadInitialData();\r\n    }\r\n    getDialogStack(this).closeDialog(dialogKey);\r\n  }\r\n\r\n  @action.bound\r\n  setVisible(rowIndex: number, state: boolean) {\r\n    this.sortedColumnConfigs[rowIndex].isVisible = state;\r\n  }\r\n\r\n  @action.bound\r\n  setGrouping(rowIndex: number, state: boolean, entity: string) {\r\n    if (entity === \"Date\") {\r\n      if (state) {\r\n        this.setTimeGroupingUnit(rowIndex, GroupingUnit.Day);\r\n      } else {\r\n        this.setTimeGroupingUnit(rowIndex, undefined);\r\n      }\r\n    }\r\n\r\n    const columnConfCopy = [...this.sortedColumnConfigs];\r\n    columnConfCopy.sort((a, b) => b.groupingIndex - a.groupingIndex);\r\n    if (this.sortedColumnConfigs[rowIndex].groupingIndex === 0) {\r\n      this.sortedColumnConfigs[rowIndex].groupingIndex =\r\n        columnConfCopy[0].groupingIndex + 1;\r\n    } else {\r\n      this.sortedColumnConfigs[rowIndex].groupingIndex = 0;\r\n      let groupingIndex = 1;\r\n      columnConfCopy.reverse();\r\n      for (let columnConfItem of columnConfCopy) {\r\n        if (columnConfItem.groupingIndex > 0) {\r\n          columnConfItem.groupingIndex = groupingIndex++;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  setTimeGroupingUnit(rowIndex: number, groupingUnit: GroupingUnit | undefined) {\r\n    this.sortedColumnConfigs[rowIndex].timeGroupingUnit = groupingUnit;\r\n  }\r\n\r\n  @action.bound\r\n  setAggregation(rowIndex: number, selectedAggregation: any) {\r\n    this.sortedColumnConfigs[rowIndex].aggregationType = tryParseAggregationType(\r\n      selectedAggregation\r\n    );\r\n  }\r\n\r\n  @action.bound\r\n  setWidth(rowIndex: number, width: number) {\r\n    this.sortedColumnConfigs[rowIndex].width = width;\r\n  }\r\n\r\n  @action.bound\r\n  handleFixedColumnsCountChange(event: any) {\r\n    this.columnsConfiguration.fixedColumnCount = parseInt(event.target.value, 10);\r\n  }\r\n\r\n  @computed get tablePanelView() {\r\n    return getTablePanelView(this);\r\n  }\r\n\r\n  get configManager() {\r\n    return getConfigurationManager(this);\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n\r\nexport class AggregationOption implements IOption<AggregationType | undefined>{\r\n  constructor (\r\n    public label: string,\r\n    public value: AggregationType | undefined,\r\n  ){\r\n  }\r\n}\r\n\r\nexport class TimeUnitOption implements IOption<GroupingUnit>{\r\n  constructor (\r\n    public label: string,\r\n    public value: GroupingUnit,\r\n  ){\r\n  }\r\n}\r\n\r\n\r\nexport const aggregationOptions =  [\r\n  new AggregationOption(\"\", undefined),\r\n  new AggregationOption(T(\"SUM\", \"aggregation_sum\"), AggregationType.SUM),\r\n  new AggregationOption(T(\"AVG\", \"aggregation_avg\"), AggregationType.AVG),\r\n  new AggregationOption(T(\"MIN\", \"aggregation_min\"), AggregationType.MIN),\r\n  new AggregationOption(T(\"MAX\", \"aggregation_max\"), AggregationType.MAX),\r\n];\r\n\r\nexport const timeunitOptions =  [\r\n  new TimeUnitOption(groupingUnitToLabel(GroupingUnit.Year), GroupingUnit.Year),\r\n  new TimeUnitOption(groupingUnitToLabel(GroupingUnit.Month), GroupingUnit.Month),\r\n  new TimeUnitOption(groupingUnitToLabel(GroupingUnit.Day), GroupingUnit.Day),\r\n  new TimeUnitOption(groupingUnitToLabel(GroupingUnit.Hour), GroupingUnit.Hour),\r\n  new TimeUnitOption(groupingUnitToLabel(GroupingUnit.Minute), GroupingUnit.Minute),\r\n];\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFormScreenLifecycle } from \"../../../selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\n\r\nexport function onFieldChange(ctx: any) {\r\n  return flow(onFieldChangeG(ctx));\r\n}\r\n\r\nexport function onFieldChangeG(ctx: any) {\r\n  return function*onFieldChange(args: { event: any, row: any[], property: IProperty, value: any }) {\r\n    const {property, row, event} = args;\r\n    let value = args.value;\r\n    try {\r\n      if (property.column === \"ComboBox\" && value !== null) {\r\n        value = `${value}`;\r\n      }\r\n      getDataView(ctx).onFieldChange(event, row, property, value);\r\n      if (\r\n        property.column === \"TagInput\" ||\r\n        property.column === \"ComboBox\" ||\r\n        property.column === \"CheckBox\" ||\r\n        property.column === \"Checklist\" ||\r\n        (property.column === \"Date\" && event.type === \"click\")\r\n      ) {\r\n        // Flush data to session when combo value changed.\r\n        getDataTable(ctx).flushFormToTable(row);\r\n        yield*getFormScreenLifecycle(ctx).onFlushData();\r\n      }\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  };\r\n}\r\n\r\nexport function changeManyFields(ctx: any) {\r\n  return function*changeManyFields(values: Array<{ fieldId: string; value: any }>) {\r\n    const dataTable = getDataTable(ctx);\r\n    const row = getSelectedRow(ctx);\r\n    if (row) {\r\n      for (let {fieldId, value} of values) {\r\n        dataTable.setDirtyValue(row, fieldId, value);\r\n      }\r\n    }\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getSelectedRowIndex(ctx: any) {\r\n  return getDataView(ctx).selectedRowIndex;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataTable } from \"../DataView/getDataTable\";\r\nimport { getTablePanelView } from \"./getTablePanelView\";\r\nimport { IProperty } from \"../../entities/types/IProperty\";\r\n\r\nexport function getCellValueByIdx(ctx: any) {\r\n  const tablePanelView = getTablePanelView(ctx);\r\n  return function getCellValueByIdx(rowIndex: number, columnIndex: number) {\r\n    return tablePanelView.getCellValueByIdx(rowIndex, columnIndex);\r\n  };\r\n}\r\n\r\nexport function getCellValue(ctx: any, row: any[], property: IProperty) {\r\n  return getDataTable(ctx).getCellValue(row, property);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getTablePanelView } from \"./getTablePanelView\";\r\n\r\nexport function getSelectedColumnId(ctx: any) {\r\n  return getTablePanelView(ctx).selectedColumnId;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getTablePanelView } from './getTablePanelView';\r\n\r\nexport function getSelectedColumnIndex(ctx: any) {\r\n  return getTablePanelView(ctx).selectedColumnIndex;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\n\r\nexport function flushCurrentRowData(ctx: any) {\r\n  return function*flushCurrentRowData(finishEditing?: boolean) {\r\n    const row = getSelectedRow(ctx);\r\n    if (row) {\r\n      getDataTable(ctx).flushFormToTable(row);\r\n      if (finishEditing) getTablePanelView(ctx).setEditing(false);\r\n      yield*getFormScreenLifecycle(ctx).onFlushData();\r\n    }\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getRowStateById } from \"./getRowStateById\";\r\n\r\nexport function getRowStateAllowUpdate(ctx: any, rowId: string, columnId: string) {\r\n  const rowState = getRowStateById(ctx, rowId);\r\n  const column = rowState ? rowState.columns.get(columnId) : undefined;\r\n  const allowUpdate = column ? column.allowUpdate : undefined;\r\n  return allowUpdate !== undefined ? allowUpdate : true;\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IProperty } from \"../../entities/types/IProperty\";\r\nimport { getRowStateAllowUpdate } from \"./getRowStateAllowUpdate\";\r\n\r\nexport function isReadOnly(property: IProperty, rowId: string | undefined) {\r\n  return property!.readOnly || !getRowStateAllowUpdate(property, rowId || \"\", property!.id);\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport CS from \"./DialogsCommon.module.css\";\r\nimport { T } from \"../../../utils/translation\";\r\nimport { ModalDialog } from \"gui/Components/Dialog/ModalDialog\";\r\n\r\n@observer\r\nexport class ChangeMasterRecordDialog extends React.Component<{\r\n  screenTitle: string;\r\n  onSaveClick?: (event: any) => void;\r\n  onDontSaveClick?: (event: any) => void;\r\n  onCancelClick?: (event: any) => void;\r\n}> {\r\n  refPrimaryBtn = (elm: any) => (this.elmPrimaryBtn = elm);\r\n  elmPrimaryBtn: any;\r\n\r\n  componentDidMount() {\r\n    setTimeout(() => {\r\n      if (this.elmPrimaryBtn) {\r\n        this.elmPrimaryBtn.focus?.();\r\n      }\r\n    }, 159);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <ModalDialog\r\n        title={T(\"Question\", \"question_title\")}\r\n        titleButtons={null}\r\n        buttonsCenter={\r\n          <>\r\n            <button\r\n              tabIndex={0}\r\n              autoFocus={true}\r\n              ref={this.refPrimaryBtn}\r\n              onClick={this.props.onSaveClick}\r\n            >\r\n              {T(\"Yes\", \"button_yes\")}\r\n            </button>\r\n            <button tabIndex={0} onClick={this.props.onDontSaveClick}>\r\n              {T(\"No\", \"button_no\")}\r\n            </button>\r\n            <button tabIndex={0} onClick={this.props.onCancelClick}>\r\n              {T(\"Cancel\", \"button_cancel\")}\r\n            </button>\r\n          </>\r\n        }\r\n        buttonsLeft={null}\r\n        buttonsRight={null}\r\n      >\r\n        <div className={CS.dialogContent}>\r\n          {\" \"}\r\n          {T(\"Record has been changed. Do you want to save the changes?\", \"record_changed_info\")\r\n            .split(\"\\\\n\")\r\n            .join(\"\\n\")}\r\n        </div>\r\n      </ModalDialog>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { getDataSourceFieldByName } from \"../DataSources/getDataSourceFieldByName\";\r\nimport { getDataTable } from \"./getDataTable\";\r\n\r\nexport function getFieldErrorMessage(ctx: any) {\r\n  return function getFieldErrorMessage(row: any[], property: IProperty) {\r\n    if (row) {\r\n      const dataTable = getDataTable(ctx);\r\n      const dsFieldErrors = getDataSourceFieldByName(ctx, \"__Errors\");\r\n      const errors = dsFieldErrors\r\n        ? dataTable.getCellValueByDataSourceField(row, dsFieldErrors)\r\n        : null;\r\n\r\n      const errMap: Map<number, string> | undefined = errors\r\n        ? new Map(\r\n          Object.entries<string>(\r\n            errors.fieldErrors\r\n          ).map(([dsIndexStr, errMsg]: [string, string]) => [parseInt(dsIndexStr, 10), errMsg])\r\n        )\r\n        : undefined;\r\n\r\n      const errMsg = dsFieldErrors && errMap ? errMap.get(property.dataSourceIndex) : undefined;\r\n      return errMsg;\r\n    }\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getTableViewProperties } from \"../TablePanelView/getTableViewProperties\";\r\nimport { getDataView } from \"./getDataView\";\r\nimport { getFieldErrorMessage } from \"./getFieldErrorMessage\";\r\n\r\nexport function getSelectedRowErrorMessages(ctx: any) {\r\n  const dataView = getDataView(ctx);\r\n  if (!dataView.selectedRow) {\r\n    return [];\r\n  }\r\n  return getTableViewProperties(ctx)\r\n    .map(property => getFieldErrorMessage(property)(dataView.selectedRow!, property))\r\n    .filter(message => message);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action, flow } from \"mobx\";\r\nimport { showDialog } from \"model/selectors/getDialogStack\";\r\nimport React from \"react\";\r\nimport { getOpenedScreen } from \"../../selectors/getOpenedScreen\";\r\nimport { ChangeMasterRecordDialog } from \"../../../gui/Components/Dialogs/ChangeMasterRecordDialog\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { IDataView } from \"../types/IDataView\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { getSessionId } from \"model/selectors/getSessionId\";\r\nimport { isInfiniteScrollingActive } from \"model/selectors/isInfiniteScrollingActive\";\r\nimport { getSelectedRowErrorMessages } from \"model/selectors/DataView/getSelectedRowErrorMessages\";\r\nimport selectors from \"model/selectors-tree\";\r\nimport { processCRUDResult } from \"../../actions/DataLoading/processCRUDResult\";\r\nimport { processActionQueryInfo } from \"model/actions/Actions/processActionQueryInfo\";\r\nimport { runGeneratorInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\nimport { getFormScreen } from \"model/selectors/FormScreen/getFormScreen\";\r\n\r\nexport function questionSaveDataAfterRecordChange(ctx: any) {\r\n  return new Promise(\r\n    action((resolve: (value: IQuestionChangeRecordAnswer) => void) => {\r\n      const closeDialog = showDialog(ctx,\r\n        \"\",\r\n        <ChangeMasterRecordDialog\r\n          screenTitle={getOpenedScreen(ctx).tabTitle}\r\n          onSaveClick={() => {\r\n            closeDialog();\r\n            resolve(IQuestionChangeRecordAnswer.Yes); // eslint-disable-line @typescript-eslint/no-use-before-define\r\n          }}\r\n          onDontSaveClick={() => {\r\n            closeDialog();\r\n            resolve(IQuestionChangeRecordAnswer.No); // eslint-disable-line @typescript-eslint/no-use-before-define\r\n          }}\r\n          onCancelClick={() => {\r\n            closeDialog();\r\n            resolve(IQuestionChangeRecordAnswer.Cancel); // eslint-disable-line @typescript-eslint/no-use-before-define\r\n          }}\r\n        />\r\n      );\r\n    })\r\n  );\r\n}\r\n\r\nexport enum IQuestionDeleteDataAnswer {\r\n  No = 0,\r\n  Yes = 1,\r\n}\r\n\r\nexport async function handleUserInputOnChangingRow(dataView: IDataView) {\r\n  const api = getApi(dataView);\r\n  const openedScreen = getOpenedScreen(dataView);\r\n  const sessionId = getSessionId(openedScreen.content.formScreen);\r\n  const formScreen = getFormScreen(dataView);\r\n\r\n  if (isInfiniteScrollingActive(dataView)) {\r\n    switch (await questionSaveDataAfterRecordChange(dataView)) {\r\n      case IQuestionChangeRecordAnswer.Cancel: // eslint-disable-line @typescript-eslint/no-use-before-define\r\n        return false;\r\n      case IQuestionChangeRecordAnswer.Yes: // eslint-disable-line @typescript-eslint/no-use-before-define\r\n        return runGeneratorInFlowWithHandler({\r\n          ctx: dataView,\r\n          generator: function*(): Generator<any> {\r\n            const queryResult = yield api.saveSessionQuery(sessionId);\r\n            const processQueryInfoResult = yield*processActionQueryInfo(dataView)(\r\n              queryResult as any[],\r\n              formScreen.title\r\n            );\r\n            if (!processQueryInfoResult.canContinue) {\r\n              return false;\r\n            }\r\n            const saveResult = yield api.saveSession(sessionId);\r\n            yield*processCRUDResult(dataView, saveResult as any);\r\n            return true;\r\n          }()\r\n        });\r\n      case IQuestionChangeRecordAnswer.No: // eslint-disable-line @typescript-eslint/no-use-before-define\r\n        await flow(() =>\r\n          getFormScreenLifecycle(dataView).throwChangesAway(dataView)\r\n        )();\r\n        return true;\r\n      default:\r\n        throw new Error(\"Option not implemented\");\r\n    }\r\n  } else {\r\n    const errorMessages = dataView.childBindings\r\n      .map((binding) => binding.childDataView)\r\n      .concat(dataView)\r\n      .flatMap((dataView) => getSelectedRowErrorMessages(dataView));\r\n    if (errorMessages.length > 0) {\r\n      await flow(function*bla() {\r\n        yield*selectors.error\r\n          .getDialogController(dataView)\r\n          .pushError(errorMessages.join(\"\\n\"));\r\n      })();\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nenum IQuestionChangeRecordAnswer {\r\n  Yes = 0,\r\n  No = 1,\r\n  Cancel = 2,\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { action } from \"mobx\";\r\nimport { getDialogStack } from \"model/selectors/DialogStack/getDialogStack\";\r\nimport { T } from \"utils/translation\";\r\nimport S from \"./processActionQueryResult.module.scss\";\r\nimport { Icon } from \"@origam/components\";\r\nimport { ModalDialog } from \"gui/Components/Dialog/ModalDialog\";\r\n\r\nexport interface IQueryInfo {\r\n  entityName: string;\r\n  fieldName: string;\r\n  message: string;\r\n  severity: number;\r\n}\r\n\r\nexport interface IProcessActionQueryInfoResult {\r\n  canContinue: boolean;\r\n}\r\n\r\nexport function processActionQueryInfo(ctx: any) {\r\n  return function*processActionQueryInfo(\r\n    queryInfo: any[],\r\n    title: string\r\n  ): Generator<any, IProcessActionQueryInfoResult> {\r\n    let canContinue = true;\r\n    if (queryInfo.length > 0) {\r\n      for (let queryInfoItem of queryInfo) {\r\n        if (queryInfoItem.severity === 0) canContinue = false;\r\n      }\r\n\r\n      yield new Promise(\r\n        action((resolve: (p?: any) => void) => {\r\n          const closeDialog = getDialogStack(ctx).pushDialog(\r\n            \"\",\r\n            <ModalDialog\r\n              title={title}\r\n              titleButtons={null}\r\n              buttonsCenter={\r\n                <>\r\n                  {!canContinue && (\r\n                    <button\r\n                      tabIndex={0}\r\n                      onClick={() => {\r\n                        canContinue = false;\r\n                        closeDialog();\r\n                        resolve();\r\n                      }}\r\n                    >\r\n                      {T(\"Ok\", \"button_ok\")}\r\n                    </button>\r\n                  )}\r\n                  {canContinue && (\r\n                    <>\r\n                      <button\r\n                        tabIndex={0}\r\n                        autoFocus={true}\r\n                        onClick={() => {\r\n                          canContinue = true;\r\n                          closeDialog();\r\n                          resolve();\r\n                        }}\r\n                      >\r\n                        {T(\"Yes\", \"button_yes\")}\r\n                      </button>\r\n                      <button\r\n                        tabIndex={0}\r\n                        onClick={() => {\r\n                          canContinue = false;\r\n                          closeDialog();\r\n                          resolve();\r\n                        }}\r\n                      >\r\n                        {T(\"No\", \"button_no\")}\r\n                      </button>\r\n                    </>\r\n                  )}\r\n                </>\r\n              }\r\n              buttonsLeft={null}\r\n              buttonsRight={null}\r\n            >\r\n              <div className={S.dialogContent}>\r\n                <div className=\"list\">\r\n                  {queryInfo.map((item, idx) => (\r\n                    <div className=\"listItem\" key={idx}>\r\n                      {item.severity === 1 && (\r\n                        <div className=\"itemIcon warning\">\r\n                          <Icon\r\n                            src=\"./icons/warning-fill.svg\"\r\n                            tooltip={T(\"Refresh\", \"refresh_tool_tip\")}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                      {item.severity === 0 && (\r\n                        <div className=\"itemIcon error\">\r\n                          <Icon\r\n                            src=\"./icons/error-fill.svg\"\r\n                            tooltip={T(\"Refresh\", \"refresh_tool_tip\")}\r\n                          />\r\n                        </div>\r\n                      )}\r\n\r\n                      <div className=\"itemMessage\">{item.message}</div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n                {canContinue && (\r\n                  <>{T(\"Do you wish to continue anyway?\", \"do_you_wish_to_continue\")}</>\r\n                )}\r\n              </div>\r\n            </ModalDialog>\r\n          );\r\n        })\r\n      );\r\n    }\r\n    return {canContinue};\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action, computed, flow, observable } from \"mobx\";\r\nimport { onFieldChangeG } from \"model/actions-ui/DataView/TableView/onFieldChange\";\r\nimport { getSelectedRowIndex } from \"model/selectors/DataView/getSelectedRowIndex\";\r\nimport { getCellValue } from \"model/selectors/TablePanelView/getCellValue\";\r\nimport { getSelectedColumnId } from \"model/selectors/TablePanelView/getSelectedColumnId\";\r\nimport { getSelectedColumnIndex } from \"model/selectors/TablePanelView/getSelectedColumnIndex\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\nimport { getTableViewProperties } from \"model/selectors/TablePanelView/getTableViewProperties\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { getDataViewPropertyById } from \"model/selectors/DataView/getDataViewPropertyById\";\r\nimport { IFilterConfiguration } from \"model/entities/types/IFilterConfiguration\";\r\nimport { IOrderingConfiguration } from \"model/entities/types/IOrderingConfiguration\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport {\r\n  ITableCanvas,\r\n  ITablePanelView,\r\n  ITablePanelViewData\r\n} from \"model/entities/TablePanelView/types/ITablePanelView\";\r\nimport { IGroupingConfiguration } from \"model/entities/types/IGroupingConfiguration\";\r\nimport { IAggregationInfo } from \"model/entities/types/IAggregationInfo\";\r\nimport { AggregationType } from \"model/entities/types/AggregationType\";\r\nimport { ICellRectangle } from \"model/entities/TablePanelView/types/ICellRectangle\";\r\nimport { getFormScreen } from \"model/selectors/FormScreen/getFormScreen\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { flushCurrentRowData } from \"model/actions/DataView/TableView/flushCurrentRowData\";\r\nimport { isReadOnly } from \"model/selectors/RowState/isReadOnly\";\r\nimport { FilterGroupManager } from \"model/entities/FilterGroupManager\";\r\nimport { handleUserInputOnChangingRow } from \"../FormScreenLifecycle/questionSaveDataAfterRecordChange\";\r\nimport { getGroupingConfiguration } from \"model/selectors/TablePanelView/getGroupingConfiguration\";\r\nimport { getGrouper } from \"model/selectors/DataView/getGrouper\";\r\nimport { IConfigurationManager } from \"model/entities/TablePanelView/types/IConfigurationManager\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\nimport { ColumnConfigurationModel } from \"model/entities/TablePanelView/ColumnConfigurationModel\";\r\n\r\nexport class TablePanelView implements ITablePanelView {\r\n  $type_ITablePanelView: 1 = 1;\r\n\r\n  constructor(data: ITablePanelViewData) {\r\n    Object.assign(this, data);\r\n    this.columnConfigurationModel.parent = this;\r\n    this.filterConfiguration.parent = this;\r\n    this.filterGroupManager.parent = this;\r\n    this.orderingConfiguration.parent = this;\r\n    this.groupingConfiguration.parent = this;\r\n  }\r\n\r\n  columnConfigurationModel: ColumnConfigurationModel = null as any;\r\n  configurationManager: IConfigurationManager = null as any;\r\n  filterConfiguration: IFilterConfiguration = null as any;\r\n  filterGroupManager: FilterGroupManager = null as any;\r\n  orderingConfiguration: IOrderingConfiguration = null as any;\r\n  groupingConfiguration: IGroupingConfiguration = null as any;\r\n  rowHeight: number = null as any;\r\n  firstColumn: IProperty | undefined;\r\n  handleScrolling = true;\r\n\r\n  @observable rectangleMap: Map<number, Map<number, ICellRectangle>> = new Map<number,\r\n    Map<number, ICellRectangle>>();\r\n\r\n  @observable isEditing: boolean = false;\r\n  @observable fixedColumnCount: number = 0;\r\n  @observable tablePropertyIds: string[] = [];\r\n  @observable hiddenPropertyIds: Map<string, boolean> = new Map();\r\n  @observable columnOrderChangingTargetId: string | undefined;\r\n  @observable columnOrderChangingSourceId: string | undefined;\r\n\r\n  @observable _currentTooltipText?: string = undefined;\r\n  @computed get currentTooltipText() {\r\n    return this._currentTooltipText;\r\n  }\r\n\r\n  set currentTooltipText(value: string | undefined) {\r\n    this._currentTooltipText = value;\r\n  }\r\n\r\n  parent?: any;\r\n  aggregations: AggregationContainer = new AggregationContainer();\r\n\r\n  @computed get propertyMap() {\r\n    return new Map(this.allTableProperties.map((x) => [x.id, x] as [string, IProperty]));\r\n  }\r\n\r\n  @computed get allTableProperties() {\r\n    return this.tablePropertyIds\r\n      .map((id) => getDataTable(this).getPropertyById(id))\r\n      .filter((prop) => prop) as IProperty[];\r\n  }\r\n\r\n  @computed get tableProperties() {\r\n    return this.allTableProperties.filter((prop) => !this.hiddenPropertyIds.get(prop.id));\r\n  }\r\n\r\n  @observable selectedColumnId: string | undefined;\r\n\r\n  @computed get selectedRowId(): string | undefined {\r\n    return getDataView(this).selectedRowId;\r\n  }\r\n\r\n  @computed get selectedColumnIndex(): number | undefined {\r\n    const idx = this.tableProperties.findIndex((prop) => prop.id === this.selectedColumnId);\r\n    return idx > -1 ? idx : undefined;\r\n  }\r\n\r\n  @computed get selectedRowIndex(): number | undefined {\r\n    return getDataView(this).selectedRowIndex;\r\n  }\r\n\r\n  @computed get selectedProperty(): IProperty | undefined {\r\n    return this.selectedColumnId ? getDataViewPropertyById(this, this.selectedColumnId) : undefined;\r\n  }\r\n\r\n  @observable.ref tableCanvas: ITableCanvas | null = null;\r\n\r\n  @action.bound\r\n  setTableCanvas(tableCanvas: ITableCanvas | null): void {\r\n    this.tableCanvas = tableCanvas;\r\n  }\r\n\r\n  get firstVisibleRowIndex(): number {\r\n    return this.tableCanvas ? this.tableCanvas.firstVisibleRowIndex : 0;\r\n  }\r\n\r\n  get lastVisibleRowIndex(): number {\r\n    return this.tableCanvas ? this.tableCanvas.lastVisibleRowIndex : 0;\r\n  }\r\n\r\n  getCellValueByIdx(rowIdx: number, columnIdx: number) {\r\n    const property = this.tableProperties[columnIdx]!;\r\n    const row = this.dataTable.getRowByExistingIdx(rowIdx);\r\n    return this.dataTable.getCellValue(row, property);\r\n  }\r\n\r\n  getCellTextByIdx(rowIdx: number, columnIdx: number) {\r\n    const property = this.tableProperties[columnIdx]!;\r\n    const row = this.dataTable.getRowByExistingIdx(rowIdx);\r\n    return this.dataTable.getCellText(row, property);\r\n  }\r\n\r\n  clearCurrentCellEditData() {\r\n    const row = getDataView(this).selectedRow;\r\n    const propertyId = this.selectedProperty?.id;\r\n    if (row && propertyId) {\r\n      getDataView(this).dataTable.deleteAdditionalCellData(row, propertyId);\r\n    }\r\n  }\r\n\r\n  *onCellClick(event: any, row: any[], columnId: string, isControlInteraction: boolean): any {\r\n    const dataView = getDataView(this);\r\n    const rowId = this.dataTable.getRowId(row);\r\n\r\n    getTablePanelView(this).setEditing(false);\r\n    yield*flushCurrentRowData(this)();\r\n    const isDirty = getFormScreen(dataView).isDirty;\r\n\r\n    if (isDirty && dataView.selectedRowId !== rowId) {\r\n      const shouldProceedToSelectRow = yield handleUserInputOnChangingRow(dataView);\r\n      if (!shouldProceedToSelectRow) {\r\n        return;\r\n      }\r\n    }\r\n    if(isMobileLayoutActive(dataView)){\r\n      yield*this.onCellClickInternalMobile(event, row, columnId, isControlInteraction);\r\n      yield dataView.activateFormView!({saveNewState: false});\r\n    }else{\r\n      yield*this.onCellClickInternal(event, row, columnId, isControlInteraction);\r\n    }\r\n  }\r\n\r\n  *onCellClickInternalMobile(event: any, row: any[], columnId: string, isControlInteraction: boolean) {\r\n    const property = this.propertyMap.get(columnId)!;\r\n    if (property.column !== \"CheckBox\" || !isControlInteraction) {\r\n      this.setEditing(false);\r\n      this.selectCell(this.dataTable.getRowId(row) as string, property.id);\r\n    } else {\r\n      const rowId = this.dataTable.getRowId(row);\r\n      yield*this.selectCellAsync(columnId, rowId);\r\n\r\n      if (!isReadOnly(property!, rowId)) {\r\n        yield*onFieldChangeG(this)({\r\n          event: undefined,\r\n          row: row,\r\n          property: property,\r\n          value: !getCellValue(this, row, property),\r\n        });\r\n      }\r\n    }\r\n    if (!getGroupingConfiguration(this).isGrouping) {\r\n      this.scrollToCurrentCell();\r\n    }\r\n  }\r\n\r\n  *onCellClickInternal(event: any, row: any[], columnId: string, isControlInteraction: boolean) {\r\n    const property = this.propertyMap.get(columnId)!;\r\n    if (property.column !== \"CheckBox\" || !isControlInteraction) {\r\n      if (property.isLink && property.column !== \"TagInput\" && (event.ctrlKey || event.metaKey)) {\r\n        yield*getDataView(this).navigateLookupLink(property, row);\r\n      } else {\r\n        if (this.dataTable.getRowId(row) === this.selectedRowId) {\r\n          this.selectCell(this.dataTable.getRowId(row) as string, property.id);\r\n          this.setEditing(true);\r\n        } else {\r\n          const {isEditing} = this;\r\n          if (isEditing) {\r\n            this.setEditing(false);\r\n          }\r\n          this.selectCell(this.dataTable.getRowId(row) as string, property.id);\r\n          if (isEditing) {\r\n            this.setEditing(true);\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      const rowId = this.dataTable.getRowId(row);\r\n      yield*this.selectCellAsync(columnId, rowId);\r\n\r\n      if (!isReadOnly(property!, rowId)) {\r\n        yield*onFieldChangeG(this)({\r\n          event: undefined,\r\n          row: row,\r\n          property: property,\r\n          value: !getCellValue(this, row, property),\r\n        });\r\n      }\r\n    }\r\n    if (!getGroupingConfiguration(this).isGrouping) {\r\n      this.scrollToCurrentCell();\r\n    }\r\n  }\r\n\r\n  private*selectCellAsync(columnId: string, rowId: string) {\r\n    this.selectedColumnId = columnId;\r\n    const dataView = getDataView(this);\r\n    if (dataView.selectedRowId === rowId) {\r\n      return;\r\n    }\r\n    yield dataView.lifecycle.runRecordChangedReaction(function*() {\r\n      yield dataView.setSelectedRowId(rowId);\r\n    });\r\n  }\r\n\r\n  *onNoCellClick() {\r\n    if (this.isEditing) {\r\n      this.setEditing(false);\r\n      yield*flushCurrentRowData(this)();\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  handleTableScroll(event: any, scrollTop: number, scrollLeft: number) {\r\n    if (!this.handleScrolling) {\r\n      this.handleScrolling = true;\r\n      return;\r\n    }\r\n\r\n    const _this = this;\r\n    flow(function*() {\r\n      if (_this.isEditing) {\r\n        _this.setEditing(false);\r\n        yield*flushCurrentRowData(_this)();\r\n      }\r\n    })();\r\n  }\r\n\r\n  dontHandleNextScroll() {\r\n    this.handleScrolling = false;\r\n  }\r\n\r\n  *onOutsideTableClick() {\r\n    if (this.isEditing) {\r\n      this.setEditing(false);\r\n      yield*flushCurrentRowData(this)();\r\n    }\r\n  }\r\n\r\n  @action.bound selectCell(rowId: string | undefined, columnId: string | undefined) {\r\n    this.selectedColumnId = columnId;\r\n    getDataView(this).setSelectedRowId(rowId);\r\n  }\r\n\r\n  isFirstColumnSelected(): boolean {\r\n    const properties = getTableViewProperties(this);\r\n    const selPropId = getSelectedColumnId(this);\r\n    if (!selPropId) {\r\n      return false;\r\n    }\r\n    const idx = properties.findIndex((prop) => prop.id === selPropId);\r\n    return idx === 0;\r\n  }\r\n\r\n  isLastColumnSelected(): boolean {\r\n    const properties = getTableViewProperties(this);\r\n    const selPropId = getSelectedColumnId(this);\r\n    if (!selPropId) {\r\n      return false;\r\n    }\r\n    const idx = properties.findIndex((prop) => prop.id === selPropId);\r\n    return idx === properties.length - 1;\r\n  }\r\n\r\n  @action.bound\r\n  selectNextColumn(nextRowWhenEnd?: boolean): void {\r\n    const properties = getTableViewProperties(this);\r\n    const selPropId = getSelectedColumnId(this);\r\n    if (selPropId) {\r\n      const idx = properties.findIndex((prop) => prop.id === selPropId);\r\n      if (idx < properties.length - 1) {\r\n        const newProp = properties[idx + 1];\r\n        this.setSelectedColumnId(newProp.id);\r\n      } else if (nextRowWhenEnd && properties.length > 1) {\r\n        const rowId = getSelectedRowId(this);\r\n        getDataView(this).selectNextRow();\r\n        if (rowId !== getSelectedRowId(this)) {\r\n          this.selectFirstColumn();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  selectPrevColumn(prevRowWhenStart?: boolean): void {\r\n    const properties = getTableViewProperties(this);\r\n    const selPropId = getSelectedColumnId(this);\r\n    if (selPropId) {\r\n      const idx = properties.findIndex((prop) => prop.id === selPropId);\r\n      if (idx > 0) {\r\n        const newProp = properties[idx - 1];\r\n        this.setSelectedColumnId(newProp.id);\r\n      } else if (prevRowWhenStart && properties.length > 1) {\r\n        const rowId = getSelectedRowId(this);\r\n        getDataView(this).selectPrevRow();\r\n        if (rowId !== getSelectedRowId(this)) {\r\n          this.selectLastColumn();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  @action.bound selectFirstColumn(): void {\r\n    const properties = getTableViewProperties(this);\r\n    const newProp = properties[0];\r\n    this.setSelectedColumnId(newProp.id);\r\n  }\r\n\r\n  @action.bound selectLastColumn(): void {\r\n    const properties = getTableViewProperties(this);\r\n    const newProp = properties[properties.length - 1];\r\n    this.setSelectedColumnId(newProp.id);\r\n  }\r\n\r\n  @action.bound\r\n  setSelectedColumnId(id: string | undefined): void {\r\n    this.selectedColumnId = id;\r\n  }\r\n\r\n  @action.bound\r\n  setEditing(state: boolean): void {\r\n    this.isEditing = state;\r\n  }\r\n\r\n  @action.bound\r\n  swapColumns(id1: string, id2: string): void {\r\n    const idx1 = this.tablePropertyIds.findIndex((id) => id === id1);\r\n    const idx2 = this.tablePropertyIds.findIndex((id) => id === id2);\r\n    const tmp = this.tablePropertyIds[idx1];\r\n    this.tablePropertyIds[idx1] = this.tablePropertyIds[idx2];\r\n    this.tablePropertyIds[idx2] = tmp;\r\n  }\r\n\r\n  @action.bound\r\n  setColumnOrderChangeAttendants(idSource: string | undefined, idTarget: string | undefined): void {\r\n    this.columnOrderChangingTargetId = idTarget;\r\n    this.columnOrderChangingSourceId = idSource;\r\n  }\r\n\r\n  subId = 0;\r\n  onScrollToCurrentCellHandlers: Map<number,\r\n    (rowIdx: number, columnIdx: number) => void> = new Map();\r\n\r\n  subOnScrollToCellShortest(fn: (rowIdx: number, columnIdx: number) => void): () => void {\r\n    const myId = this.subId++;\r\n    this.onScrollToCurrentCellHandlers.set(myId, fn);\r\n    return () => this.onScrollToCurrentCellHandlers.delete(myId);\r\n  }\r\n\r\n  @action.bound scrollToCurrentRow() {\r\n    const rowIdx = getSelectedRowIndex(this);\r\n    if (rowIdx !== undefined) {\r\n      this.triggerOnScrollToCellShortest(rowIdx, 0);\r\n    }\r\n  }\r\n\r\n  @action.bound scrollToCurrentCell() {\r\n    const rowIdx = getSelectedRowIndex(this);\r\n    const columnIdx = getSelectedColumnIndex(this);\r\n    if (rowIdx !== undefined && columnIdx !== undefined) {\r\n      this.triggerOnScrollToCellShortest(rowIdx, columnIdx);\r\n    }\r\n  }\r\n\r\n  @action.bound triggerOnScrollToCellShortest(rowIdx: number, columnIdx: number) {\r\n    for (let h of this.onScrollToCurrentCellHandlers.values()) h(rowIdx, columnIdx);\r\n  }\r\n\r\n  onFocusTableHandlers: Map<number, () => void> = new Map();\r\n\r\n  subOnFocusTable(fn: () => void): () => void {\r\n    const myId = this.subId++;\r\n    this.onFocusTableHandlers.set(myId, fn);\r\n    return () => this.onFocusTableHandlers.delete(myId);\r\n  }\r\n\r\n  @action.bound\r\n  setPropertyHidden(propertyId: string, state: boolean): void {\r\n    if (state) {\r\n      this.hiddenPropertyIds.set(propertyId, true);\r\n    } else {\r\n      this.hiddenPropertyIds.delete(propertyId);\r\n    }\r\n  }\r\n\r\n  @action.bound triggerOnFocusTable() {\r\n    for (let h of this.onFocusTableHandlers.values()) h();\r\n  }\r\n\r\n  @computed get dataTable() {\r\n    return getDataTable(this);\r\n  }\r\n\r\n  getCellRectangle(rowIndex: number, columnIndex: number) {\r\n    const groupingConfig = getGroupingConfiguration(this);\r\n    let cellOffset = {row: 0, column: 0};\r\n    if (groupingConfig.isGrouping) {\r\n      const rowId = getDataView(this).selectedRowId;\r\n      cellOffset = getGrouper(this).getCellOffset(rowId!);\r\n    }\r\n    if (!this.rectangleMap.has(rowIndex + cellOffset.row)) {\r\n      return {\r\n        columnLeft: 0,\r\n        columnWidth: 0,\r\n        rowTop: 0,\r\n        rowHeight: 0,\r\n      };\r\n    }\r\n    return this.rectangleMap.get(rowIndex + cellOffset.row)!.get(columnIndex + cellOffset.column)!;\r\n  }\r\n\r\n  setCellRectangle(rowId: number, columnId: number, rectangle: ICellRectangle) {\r\n    if (!this.rectangleMap.has(rowId)) {\r\n      this.rectangleMap.set(rowId, new Map<number, ICellRectangle>());\r\n    }\r\n    this.rectangleMap.get(rowId)!.set(columnId, rectangle);\r\n  }\r\n}\r\n\r\nexport class AggregationContainer {\r\n  @observable aggregationTypes: Map<string, AggregationType | undefined> = new Map<string,\r\n    AggregationType | undefined>();\r\n\r\n  getType(columnId: string) {\r\n    return this.aggregationTypes.get(columnId);\r\n  }\r\n\r\n  setType(columnId: string, aggregationType: AggregationType | undefined) {\r\n    if (!aggregationType && this.aggregationTypes.has(columnId)) {\r\n      this.aggregationTypes.delete(columnId);\r\n      return;\r\n    }\r\n    if (!aggregationType && !this.aggregationTypes.has(columnId)) return;\r\n\r\n    this.aggregationTypes.set(columnId, aggregationType);\r\n  }\r\n\r\n  @computed get aggregationList(): IAggregationInfo[] {\r\n    // @ts-ignore\r\n    return Array.from(this.aggregationTypes.entries())\r\n      .filter((entry) => entry[1])\r\n      .map((entry) => {\r\n        return {\r\n          ColumnName: entry[0],\r\n          AggregationType: entry[1],\r\n        };\r\n      });\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { observable } from \"mobx\";\r\n\r\nlet currentIdent = 1;\r\n\r\nexport function getIdent() {\r\n  return currentIdent++;\r\n}\r\n\r\nexport interface IIId {\r\n  $iid: number;\r\n}\r\n\r\nexport class ContribArray<T> {\r\n  @observable items = new Map<number, T>();\r\n\r\n  put(item: T & IIId) {\r\n    this.items.set(item.$iid, item);\r\n    return () => this.items.delete(item.$iid);\r\n  }\r\n\r\n  del(item: IIId) {\r\n    this.items.delete(item.$iid);\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this.items.values()[Symbol.iterator]();\r\n  }\r\n\r\n  asArray() {\r\n    return Array.from(this);\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getIdent } from \"utils/common\";\r\n\r\nexport function find(xmlObj: any, pred: (node: any) => boolean) {\r\n  function recursive(n: any) {\r\n    if (xmlObj !== n && pred(n)) {\r\n      result.push(n);\r\n    }\r\n    if (n.elements) {\r\n      for (let chn of n.elements) {\r\n        recursive(chn);\r\n      }\r\n    }\r\n  }\r\n\r\n  const result: any[] = [];\r\n  recursive(xmlObj);\r\n  return result;\r\n}\r\n\r\nexport function findStopping(xmlObj: any, pred: (node: any) => boolean) {\r\n  function recursive(n: any) {\r\n    if (xmlObj !== n && pred(n)) {\r\n      result.push(n);\r\n    } else if (n.elements) {\r\n      for (let chn of n.elements) {\r\n        recursive(chn);\r\n      }\r\n    }\r\n  }\r\n\r\n  const result: any[] = [];\r\n  recursive(xmlObj);\r\n  return result;\r\n}\r\n\r\nexport function assignIIds(xmlTree: any) {\r\n  function recursive(node: any) {\r\n    node.$iid = getIdent();\r\n    if (node.elements) {\r\n      for (let e of node.elements) recursive(e);\r\n    }\r\n  }\r\n\r\n  recursive(xmlTree);\r\n}\r\n\r\nexport const findUIRoot = (node: any) => findStopping(node, (n) => n.name === \"UIRoot\")[0];\r\n\r\nexport const findUIChildren = (node: any) =>\r\n  findStopping(node, (n) => n.parent.name === \"UIChildren\");\r\n\r\nexport const findBoxes = (node: any) =>\r\n  findStopping(node, (n) => n.attributes && n.attributes.Type === \"Box\");\r\n\r\nexport const findChildren = (node: any) => findStopping(node, (n) => n.name === \"Children\")[0];\r\n\r\nexport const findActions = (node: any) =>\r\n  findStopping(node, (n) => n.parent.name === \"Actions\" && n.name === \"Action\");\r\n\r\nexport const findParameters = (node: any) => findStopping(node, (n) => n.name === \"Parameter\");\r\n\r\nexport const findStrings = (node: any) =>\r\n  findStopping(node, (n) => n.name === \"string\").map(\r\n    (n) => findStopping(n, (n2) => n2.type === \"text\")[0].text\r\n  );\r\n\r\nexport const findFormPropertyIds = (node: any) =>\r\n  findStopping(node, (n) => n.name === \"string\" && n.parent.name === \"PropertyNames\").map(\r\n    (n) => findStopping(n, (n2) => n2.type === \"text\")[0].text\r\n  );\r\n\r\nexport const findFormRoot = (node: any) => findStopping(node, (n) => n.name === \"FormRoot\")[0];\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action, computed, observable } from \"mobx\";\r\nimport { IGroupingConfiguration, IGroupingSettings } from \"./types/IGroupingConfiguration\";\r\nimport { GroupingUnit } from \"./types/GroupingUnit\";\r\n\r\nexport class GroupingConfiguration implements IGroupingConfiguration {\r\n  @observable groupingSettings: Map<string, IGroupingSettings> = new Map();\r\n  onOffHandlers: (() => void)[] = [];\r\n\r\n  @computed get isGrouping() {\r\n    return this.groupingSettings.size > 0;\r\n  }\r\n\r\n  @computed get groupingColumnCount() {\r\n    return this.groupingSettings.size;\r\n  }\r\n\r\n  @computed get orderedGroupingColumnSettings() {\r\n    const entries = Array.from(this.groupingSettings.entries());\r\n    entries.sort((a, b) => a[1].groupIndex - b[1].groupIndex);\r\n    return entries.map((item) => item[1]);\r\n  }\r\n\r\n  @computed get firstGroupingColumn() {\r\n    return this.orderedGroupingColumnSettings[0];\r\n  }\r\n\r\n  nextColumnToGroupBy(columnId: string) {\r\n    const currentIndex = this.groupingSettings.get(columnId)?.groupIndex;\r\n    if (!currentIndex) {\r\n      return undefined\r\n    }\r\n    const nextIndex = currentIndex + 1;\r\n    const nextEntry = Array.from(this.groupingSettings.entries())\r\n      .find(entry => entry[1].groupIndex === nextIndex);\r\n    return nextEntry ? nextEntry[1] : undefined\r\n  }\r\n\r\n  @action.bound\r\n  setGrouping(columnId: string, groupingUnit: GroupingUnit | undefined, groupingIndex: number): void {\r\n    const wasEmpty = this.groupingSettings.size === 0\r\n    this.groupingSettings.set(\r\n      columnId,\r\n      {\r\n        columnId: columnId,\r\n        groupingUnit: groupingUnit,\r\n        groupIndex: groupingIndex\r\n      }\r\n    );\r\n    if (wasEmpty) {\r\n      this.notifyOnOffHandlers();\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  clearGrouping(): void {\r\n    this.groupingSettings.clear();\r\n    this.notifyOnOffHandlers();\r\n  }\r\n\r\n  parent?: any;\r\n\r\n  notifyOnOffHandlers() {\r\n    for (let handler of this.onOffHandlers) {\r\n      handler();\r\n    }\r\n  }\r\n\r\n  registerGroupingOnOffHandler(handler: () => void): void {\r\n    this.onOffHandlers.push(handler);\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { computed, observable } from \"mobx\";\r\nimport { IGroupTreeNode } from \"./types\";\r\nimport { IGrouper } from \"../../../../../model/entities/types/IGrouper\";\r\nimport { IAggregation } from \"../../../../../model/entities/types/IAggregation\";\r\nimport { getOrderingConfiguration } from \"../../../../../model/selectors/DataView/getOrderingConfiguration\";\r\nimport {\r\n  InfiniteScrollLoader,\r\n  SCROLL_ROW_CHUNK\r\n} from \"../../../../Workbench/ScreenArea/TableView/InfiniteScrollLoader\";\r\nimport { getDataView } from \"../../../../../model/selectors/DataView/getDataView\";\r\nimport { joinWithAND, toFilterItem } from \"../../../../../model/entities/OrigamApiHelpers\";\r\nimport { OpenGroupVisibleRowsMonitor } from \"../../../../Workbench/ScreenArea/TableView/VisibleRowsMonitor\";\r\nimport { getDataTable } from \"../../../../../model/selectors/DataView/getDataTable\";\r\nimport { ScrollRowContainer } from \"../../../../../model/entities/ScrollRowContainer\";\r\nimport { GroupingUnit } from \"model/entities/types/GroupingUnit\";\r\nimport moment from \"moment\";\r\n\r\nexport interface IGroupItemData {\r\n  childGroups: IGroupTreeNode[];\r\n  childRows: any[][];\r\n  columnId: string;\r\n  columnValue: string;\r\n  columnDisplayValue: string;\r\n  groupLabel: string;\r\n  parent: IGroupTreeNode | undefined;\r\n  rowCount: number;\r\n  aggregations: IAggregation[] | undefined;\r\n  grouper: IGrouper;\r\n}\r\n\r\nexport interface IServerSideGroupItemData extends IGroupItemData {\r\n  groupingUnit: GroupingUnit | undefined;\r\n}\r\n\r\nexport interface IClientSideGroupItemData extends IGroupItemData {\r\n  expansionListener: (item: ClientSideGroupItem) => void;\r\n}\r\n\r\nexport class ClientSideGroupItem implements IClientSideGroupItemData, IGroupTreeNode {\r\n  constructor(data: IClientSideGroupItemData) {\r\n    Object.assign(this, data);\r\n  }\r\n\r\n  isInfinitelyScrolled = false;\r\n  expansionListener: (item: ClientSideGroupItem) => void = null as any;\r\n  @observable childGroups: IGroupTreeNode[] = null as any;\r\n  @observable _childRows: any[][] = null as any;\r\n  columnId: string = null as any;\r\n  columnValue: string = null as any;\r\n  groupLabel: string = null as any;\r\n  parent: IGroupTreeNode | undefined = null as any;\r\n  rowCount: number = null as any;\r\n  columnDisplayValue: string = null as any;\r\n  aggregations: IAggregation[] | undefined = undefined;\r\n  grouper: IGrouper = null as any;\r\n  groupFilters: string[] = [];\r\n\r\n  get level() {\r\n    return this.allParents.length;\r\n  }\r\n\r\n  @observable\r\n  private _isExpanded = false;\r\n\r\n  public get isExpanded() {\r\n    return this._isExpanded;\r\n  }\r\n\r\n  public set isExpanded(value) {\r\n    this._isExpanded = value;\r\n    this.expansionListener(this);\r\n  }\r\n\r\n  get allChildGroups(): IGroupTreeNode[] {\r\n    return allChildGroups(this);\r\n  }\r\n\r\n  get allParents(): IGroupTreeNode[] {\r\n    return getAllParents(this);\r\n  }\r\n\r\n  substituteRecord(row: any[]): void {\r\n  }\r\n\r\n  getRowIndex(rowId: string): number | undefined {\r\n    return this._childRows.findIndex(row => getDataTable(this.grouper).getRowId(row) === rowId);\r\n  }\r\n\r\n  getRowById(id: string): any[] | undefined {\r\n    return this._childRows.find(row => getDataTable(this.grouper).getRowId(row) === id);\r\n  }\r\n\r\n  @computed get childRows() {\r\n    const orderingConfiguration = getOrderingConfiguration(this.grouper);\r\n\r\n    if (orderingConfiguration.userOrderings.length === 0) {\r\n      return this._childRows;\r\n    } else {\r\n      return this._childRows.slice().sort(orderingConfiguration.orderingFunction());\r\n    }\r\n  }\r\n\r\n  set childRows(rows: any[][]) {\r\n    this._childRows = rows;\r\n  }\r\n\r\n  composeGroupingFilter(): string {\r\n    throw new Error(\"Method not implemented.\");\r\n  }\r\n\r\n  dispose(): void {\r\n  }\r\n}\r\n\r\nexport class ServerSideGroupItem implements IGroupTreeNode {\r\n  constructor(data: IServerSideGroupItemData) {\r\n    const dataTable = getDataTable(data.grouper);\r\n    this._childRows = new ScrollRowContainer(\r\n      (row: any[]) => dataTable.getRowId(row),\r\n      dataTable);\r\n    Object.assign(this, data);\r\n\r\n    const dataView = getDataView(this.grouper);\r\n    this.scrollLoader = new InfiniteScrollLoader({\r\n      ctx: this.grouper,\r\n      gridDimensions: dataView.gridDimensions,\r\n      scrollState: dataView.scrollState,\r\n      rowsContainer: this._childRows,\r\n      groupFilter: this.composeGroupingFilter(),\r\n      visibleRowsMonitor: new OpenGroupVisibleRowsMonitor(this.grouper, dataView.gridDimensions, dataView.scrollState)\r\n    })\r\n    this.scrollLoader.registerAppendListener(data => dataTable.appendRecords(data))\r\n    this.scrollLoader.registerPrependListener(data => dataTable.appendRecords(data))\r\n  }\r\n\r\n  @observable childGroups: IGroupTreeNode[] = null as any;\r\n  columnId: string = null as any;\r\n  columnValue: string = null as any;\r\n  groupLabel: string = null as any;\r\n  parent: IGroupTreeNode | undefined = null as any;\r\n  rowCount: number = null as any;\r\n  columnDisplayValue: string = null as any;\r\n  aggregations: IAggregation[] | undefined = undefined;\r\n  grouper: IGrouper = null as any;\r\n  scrollLoader: InfiniteScrollLoader;\r\n  _childRows: ScrollRowContainer;\r\n  groupingUnit: GroupingUnit = null as any;\r\n\r\n\r\n  get level() {\r\n    return this.allParents.length;\r\n  }\r\n\r\n  get isInfinitelyScrolled() {\r\n    return this.rowCount >= SCROLL_ROW_CHUNK && this.isExpanded && this.childRows.length > 0\r\n  }\r\n\r\n  get allChildGroups(): IGroupTreeNode[] {\r\n    return allChildGroups(this);\r\n  }\r\n\r\n  get allParents(): IGroupTreeNode[] {\r\n    return getAllParents(this);\r\n  }\r\n\r\n  substituteRecord(row: any[]): any {\r\n    this._childRows.substitute(row);\r\n  }\r\n\r\n  getRowIndex(rowId: string): number | undefined {\r\n    return this.childRows.findIndex(row => getDataTable(this.grouper).getRowId(row) === rowId);\r\n  }\r\n\r\n  getRowById(id: string): any[] | undefined {\r\n    return this.childRows.find(row => getDataTable(this.grouper).getRowId(row) === id);\r\n  }\r\n\r\n  @computed get childRows() {\r\n    return this._childRows.rows;\r\n  }\r\n\r\n  set childRows(rows: any[][]) {\r\n    if (rows.length > 0) {\r\n      this.scrollLoader.start();\r\n      getDataTable(this.grouper).appendRecords(rows);\r\n    }\r\n    this._childRows.set(rows);\r\n  }\r\n\r\n  get groupFilters() {\r\n    if (this.groupingUnit !== undefined) {\r\n      const momentValueStart = moment(this.columnValue);\r\n      const momentValueEnd = moment(this.columnValue);\r\n      switch (this.groupingUnit) {\r\n        case GroupingUnit.Year:\r\n          momentValueEnd.set({'year': momentValueStart.year() + 1});\r\n          break;\r\n        case GroupingUnit.Month:\r\n          momentValueEnd.set({'month': momentValueStart.month() + 1});\r\n          break;\r\n        case GroupingUnit.Day:\r\n          momentValueEnd.set({'day': momentValueStart.day() + 1});\r\n          break;\r\n        case GroupingUnit.Hour:\r\n          momentValueEnd.set({'hour': momentValueStart.hour() + 1});\r\n          break;\r\n        case GroupingUnit.Minute:\r\n          momentValueEnd.set({'minute': momentValueStart.minute() + 1});\r\n          break;\r\n        default:\r\n          throw new Error(\"Filter generation for groupingUnit:\" + this.groupingUnit + \" not implemented\");\r\n      }\r\n      return [\r\n        toFilterItem(this.columnId, null, \"gte\", momentValueStart),\r\n        toFilterItem(this.columnId, null, \"lt\", momentValueEnd)\r\n      ];\r\n    } else {\r\n      return [toFilterItem(this.columnId, null, \"eq\", this.columnValue)]\r\n    }\r\n  }\r\n\r\n  composeGroupingFilter(): string {\r\n    const filters = getAllParents(this)\r\n      .concat([this])\r\n      .flatMap(groupNode => groupNode.groupFilters)\r\n    return joinWithAND(filters);\r\n  }\r\n\r\n  @observable private _isExpanded = false;\r\n\r\n  get isExpanded(): boolean {\r\n    return this._isExpanded;\r\n  }\r\n\r\n  set isExpanded(value: boolean) {\r\n    if (!value) {\r\n      this.grouper.notifyGroupClosed(this);\r\n    }\r\n    this._isExpanded = value;\r\n  }\r\n\r\n  dispose(): void {\r\n    this.scrollLoader.dispose();\r\n  }\r\n}\r\n\r\nfunction getAllParents(group: IGroupTreeNode) {\r\n  const parents: IGroupTreeNode[] = [];\r\n  let parent = group.parent;\r\n  while (parent) {\r\n    parents.push(parent);\r\n    parent = parent.parent;\r\n  }\r\n  return parents;\r\n}\r\n\r\nfunction allChildGroups(group: IGroupTreeNode): IGroupTreeNode[] {\r\n  const allChildGroups = group.childGroups.flatMap(childGroup => childGroup.allChildGroups)\r\n  return [...group.childGroups, ...allChildGroups];\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { AggregationType, parseAggregationType } from \"model/entities/types/AggregationType\";\r\nimport { IDataView } from \"model/entities/types/IDataView\";\r\nimport { IAggregationInfo } from \"model/entities/types/IAggregationInfo\";\r\nimport { getProperties } from \"model/selectors/DataView/getProperties\";\r\nimport { IAggregation } from \"model/entities/types/IAggregation\";\r\nimport { IProperty } from \"./types/IProperty\";\r\nimport { formatNumber } from \"./NumberFormating\";\r\n\r\nexport function parseAggregations(objectArray: any[] | undefined): IAggregation[] | undefined {\r\n  if (!objectArray) return undefined;\r\n  return objectArray.map(object => {\r\n    return {\r\n      columnId: object[\"column\"],\r\n      type: parseAggregationType(object[\"type\"]),\r\n      value: object[\"value\"]\r\n    }\r\n  });\r\n}\r\n\r\nexport function aggregationToString(aggregation: IAggregation, property: IProperty) {\r\n  function round(value: number) {\r\n    return Math.round(value * 100) / 100\r\n  }\r\n\r\n  const formattedValue = formatNumber(\r\n    property.customNumericFormat,\r\n    property.entity ?? '',\r\n    round(aggregation.value));\r\n\r\n  if (aggregation.type === AggregationType.SUM) {\r\n    return \" \" + formattedValue\r\n  }\r\n  return aggregation.type + \": \" + formattedValue\r\n}\r\n\r\nexport function calcAggregations(dataView: IDataView, aggregationInfos: IAggregationInfo[]): IAggregation[] {\r\n  return aggregationInfos.map(aggregationInfo => {\r\n    return {\r\n      columnId: aggregationInfo.ColumnName,\r\n      type: aggregationInfo.AggregationType,\r\n      value: calculateAggregationValue(dataView, aggregationInfo),\r\n    }\r\n  })\r\n}\r\n\r\nfunction calculateAggregationValue(dataView: IDataView, aggregationInfo: IAggregationInfo) {\r\n  const properties = getProperties(dataView);\r\n  const property = properties.find(prop => prop.id === aggregationInfo.ColumnName)!\r\n  const values = dataView.dataTable.rows\r\n    .map(row => dataView.dataTable.getCellValue(row, property) as number);\r\n\r\n  if (values.length === 0) {\r\n    return 0;\r\n  }\r\n  switch (aggregationInfo.AggregationType) {\r\n    case AggregationType.SUM:\r\n      return values.reduce((a, b) => a + b, 0);\r\n    case AggregationType.AVG:\r\n      return values.reduce((a, b) => a + b, 0) / values.length;\r\n    case AggregationType.MAX:\r\n      return Math.max(...values);\r\n    case AggregationType.MIN:\r\n      return Math.min(...values);\r\n    case AggregationType.COUNT:\r\n      return values.length;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IGrouper } from \"./types/IGrouper\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { IProperty } from \"./types/IProperty\";\r\nimport { ICellOffset, IGroupTreeNode } from \"gui/Components/ScreenElements/Table/TableRendering/types\";\r\n\r\n\r\nexport function getAllLoadedValuesOfProp(property: IProperty, grouper: IGrouper): Set<any> {\r\n  const dataTable = getDataTable(grouper);\r\n  return new Set(\r\n    grouper.allGroups\r\n      .filter(group => group.isExpanded)\r\n      .flatMap(group => group.childRows)\r\n      .map((row) => dataTable.getCellValue(row, property))\r\n      .filter((row) => row)\r\n  );\r\n}\r\n\r\n\r\nexport function getRowById(grouper: IGrouper, id: string): any[] | undefined {\r\n  return grouper.allGroups\r\n    .map(group => group.getRowById(id))\r\n    .find(row => row)\r\n}\r\n\r\nexport function getRowIndex(grouper: IGrouper, rowId: string): number | undefined {\r\n  return grouper.allGroups\r\n    .filter(group => group.childGroups.length === 0)\r\n    .map(group => group.getRowIndex(rowId))\r\n    .find(index => index !== -1);\r\n}\r\n\r\nexport function getRowCount(grouper: IGrouper, rowId: string) {\r\n  return grouper.allGroups\r\n    .find(group => group.childGroups.length === 0 && group.getRowById(rowId))\r\n    ?.rowCount\r\n}\r\n\r\nexport function getCellOffset(grouper: IGrouper, rowId: string): ICellOffset {\r\n  const containingGroup = grouper.allGroups\r\n    .filter(group => group.getRowById(rowId) && group.isExpanded)\r\n    .sort((g1, g2) => g2.level - g1.level)[0]\r\n\r\n  let rowOffset = 0;\r\n  for (const group of grouper.allGroups) {\r\n    rowOffset++;\r\n    if (group === containingGroup) {\r\n      return {\r\n        row: rowOffset,\r\n        column: group.level + 1\r\n      }\r\n    }\r\n    if (group.isExpanded && !group.childGroups.some(child => child.isExpanded)) {\r\n      rowOffset += group.childRows.length;\r\n    }\r\n  }\r\n  return {\r\n    row: 0,\r\n    column: 0\r\n  }\r\n}\r\n\r\nexport function getPreviousRowId(grouper: IGrouper, rowId: string): string {\r\n  const group = grouper.allGroups\r\n    .find(group => group.getRowById(rowId))!;\r\n  const indexInGroup = group.getRowIndex(rowId);\r\n  if (indexInGroup !== undefined && indexInGroup !== 0) {\r\n    const previousRow = group.childRows[indexInGroup - 1]\r\n    return getDataTable(grouper).getRowId(previousRow);\r\n  } else {\r\n    const previousGroup = getPreviousNonEmptyGroup(grouper, group);\r\n    if (previousGroup === undefined) {\r\n      return rowId;\r\n    }\r\n    const previousRow = previousGroup.childRows[previousGroup.childRows.length - 1];\r\n    return getDataTable(grouper).getRowId(previousRow);\r\n  }\r\n}\r\n\r\nexport function getNextRowId(grouper: IGrouper, rowId: string): string {\r\n  const group = grouper.allGroups\r\n    .find(group => group.getRowById(rowId))!;\r\n  const indexInGroup = group.getRowIndex(rowId);\r\n  if (indexInGroup !== undefined && indexInGroup !== (group.rowCount - 1)) {\r\n    const nextRow = group.childRows[indexInGroup + 1]\r\n    return getDataTable(grouper).getRowId(nextRow);\r\n  } else {\r\n    const nextGroup = getNextNonEmptyGroup(grouper, group);\r\n    if (nextGroup === undefined) {\r\n      return rowId;\r\n    }\r\n    const nextRow = nextGroup.childRows[0];\r\n    return getDataTable(grouper).getRowId(nextRow);\r\n  }\r\n}\r\n\r\nfunction getPreviousNonEmptyGroup(grouper: IGrouper, currentGroup: IGroupTreeNode) {\r\n  const sameLevelGroups = grouper.allGroups\r\n    .filter(group => currentGroup.level === group.level && group.rowCount > 0 && group.isExpanded)\r\n  const currentGroupIndex = sameLevelGroups.indexOf(currentGroup);\r\n  return currentGroupIndex === 0\r\n    ? undefined\r\n    : sameLevelGroups[currentGroupIndex - 1];\r\n}\r\n\r\nfunction getNextNonEmptyGroup(grouper: IGrouper, currentGroup: IGroupTreeNode) {\r\n  const sameLevelGroups = grouper.allGroups\r\n    .filter(group => currentGroup.level === group.level && group.rowCount > 0 && group.isExpanded)\r\n  const currentGroupIndex = sameLevelGroups.indexOf(currentGroup);\r\n  return currentGroupIndex === sameLevelGroups.length - 1\r\n    ? undefined\r\n    : sameLevelGroups[currentGroupIndex + 1];\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Moment } from \"moment\";\r\nimport { GroupingUnit } from \"./types/GroupingUnit\";\r\nimport { getLocaleFromCookie } from \"utils/cookies\";\r\n\r\n\r\nexport interface IGroupData {\r\n  value: any;\r\n  label: string;\r\n  rows: any[][];\r\n\r\n  compare(other: IGroupData): number;\r\n}\r\n\r\nexport class GenericGroupData implements IGroupData {\r\n  private readonly _label: any;\r\n\r\n  constructor(public value: string, label: any) {\r\n    this._label = Array.isArray(label) ? label.join(\", \") : label;\r\n  }\r\n\r\n  public get label() {\r\n    return this._label;\r\n  }\r\n\r\n  public rows: any[][] = [];\r\n\r\n  compare(other: IGroupData): number {\r\n    if (this.label && other.label) {\r\n      if (typeof this.label === \"string\") {\r\n        return this.label.localeCompare(other.label, getLocaleFromCookie());\r\n      } else {\r\n        return this.label > other.label ? 1 : -1;\r\n      }\r\n    } else if (!this.label) {\r\n      return -1;\r\n    } else {\r\n      return 1;\r\n    }\r\n  }\r\n}\r\n\r\nexport class DateGroupData implements IGroupData {\r\n  constructor(\r\n    public value: Moment | undefined,\r\n    public label: string\r\n  ) {\r\n  }\r\n\r\n  public rows: any[][] = [];\r\n\r\n  public static create(value: Moment, groupingUnit: GroupingUnit): IGroupData {\r\n    if (!value.isValid()) {\r\n      new DateGroupData(undefined, \"\");\r\n    }\r\n\r\n    let groupLabel = \"\";\r\n    switch (groupingUnit) {\r\n      case GroupingUnit.Year:\r\n        value.set({'month': 0, 'date': 1, 'hour': 0, 'minute': 0, 'second': 0});\r\n        groupLabel = value.format(\"YYYY\");\r\n        break;\r\n      case GroupingUnit.Month:\r\n        value.set({'date': 1, 'hour': 0, 'minute': 0, 'second': 0});\r\n        groupLabel = value.format(\"YYYY-MM\");\r\n        break;\r\n      case GroupingUnit.Day:\r\n        value.set({'hour': 0, 'minute': 0, 'second': 0});\r\n        groupLabel = value.format(\"YYYY-MM-DD\");\r\n        break;\r\n      case GroupingUnit.Hour:\r\n        value.set({'minute': 0, 'second': 0});\r\n        groupLabel = value.format(\"YYYY-MM-DD h:00\");\r\n        break;\r\n      case GroupingUnit.Minute:\r\n        value.set({'second': 0});\r\n        groupLabel = value.format(\"YYYY-MM-DD h:mm\");\r\n        break;\r\n    }\r\n    return new DateGroupData(value, groupLabel);\r\n  }\r\n\r\n  compare(other: IGroupData): number {\r\n    if (this.value && !other.value) return -1;\r\n    if (!this.value && other.value) return 1;\r\n    if (!this.value && !other.value) return 0;\r\n    if (this.value!.isValid() && other.value.isValid()) {\r\n      if (this.value! > other.value) {\r\n        return 1;\r\n      } else if (this.value! < other.value) {\r\n        return -1;\r\n      } else {\r\n        return 0;\r\n      }\r\n    } else if (!this.value) {\r\n      return -1;\r\n    } else {\r\n      return 1;\r\n    }\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport enum ILifetime {\r\n  PerDependency,\r\n  PerLifetimeScope,\r\n  Single,\r\n}\r\n\r\nclass Registration<TInstance> {\r\n  regCreator?: (...args: any[]) => TInstance;\r\n  regCreatorEx?: (container: Container, ...args: any[]) => TInstance;\r\n  regClass?: new (...args: any[]) => TInstance;\r\n\r\n  typeSymbol?: ITypeSymbol<TInstance>;\r\n  instancePerDependency?: boolean;\r\n  instancePerLifetimeScope?: boolean;\r\n  instancePerNamedLifetimeScope?: string;\r\n  instancePerSwitchedLifetimeScope?: ($cont: Container) => Container | undefined;\r\n  singleInstance?: boolean;\r\n\r\n  onPreparing: Array<(args: IOnPreparingArgs) => void> = [];\r\n  onActivating: Array<(args: IOnActivatingArgs<TInstance>) => void> = [];\r\n  onActivated: Array<(args: IOnActivatedArgs<TInstance>) => void> = [];\r\n  onRelease: Array<(args: IOnReleaseArgs<TInstance>) => void> = [];\r\n}\r\n\r\nclass Registrator<TInstance> implements IRegistrator<TInstance> {\r\n  constructor(private registration: Registration<TInstance>) {\r\n  }\r\n\r\n  transientInstance(): IRegistrator<TInstance> {\r\n    this.registration.instancePerDependency = true;\r\n    return this;\r\n  }\r\n\r\n  singleInstance(): IRegistrator<TInstance> {\r\n    this.registration.singleInstance = true;\r\n    return this;\r\n  }\r\n\r\n  scopedInstance(\r\n    nameOrSwitchingFunction?: string | (($cont: Container) => Container | undefined)\r\n  ): IRegistrator<TInstance> {\r\n    if (nameOrSwitchingFunction) {\r\n      if (typeof nameOrSwitchingFunction === \"function\") {\r\n        this.registration.instancePerSwitchedLifetimeScope = nameOrSwitchingFunction;\r\n      } else {\r\n        this.registration.instancePerNamedLifetimeScope = nameOrSwitchingFunction;\r\n      }\r\n    } else {\r\n      this.registration.instancePerLifetimeScope = true;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  onActivated(handler: (args: IOnActivatedArgs<TInstance>) => void): IRegistrator<TInstance> {\r\n    this.registration.onActivated.push(handler);\r\n    return this;\r\n  }\r\n\r\n  onActivating(handler: (args: IOnActivatingArgs<TInstance>) => void): IRegistrator<TInstance> {\r\n    this.registration.onActivating.push(handler);\r\n    return this;\r\n  }\r\n\r\n  onPreparing(handler: (args: IOnPreparingArgs) => void): IRegistrator<TInstance> {\r\n    this.registration.onPreparing.push(handler);\r\n    return this;\r\n  }\r\n\r\n  onRelease(handler: (args: IOnReleaseArgs<TInstance>) => void): IRegistrator<TInstance> {\r\n    this.registration.onRelease.push(handler);\r\n    return this;\r\n  }\r\n\r\n  forward(\r\n    fn: (registrator: Registrator<TInstance>) => Registrator<TInstance>\r\n  ): Registrator<TInstance> {\r\n    return fn(this);\r\n  }\r\n}\r\n\r\nexport class Container implements IContainer {\r\n  constructor(private options: { defaultLifetime: ILifetime }) {\r\n  }\r\n\r\n  private registrations: Map<ITypeSymbol<any>, Array<Registration<any>>> = new Map();\r\n  public instances: Map<ITypeSymbol<any>, any> = new Map();\r\n  private transientInstances: any[] = [];\r\n  private disposeEvents = new WeakMap<any, Array<(args: IOnReleaseArgs<any>) => void>>();\r\n\r\n  private parent?: Container;\r\n  private children: Container[] = [];\r\n  public scopeName?: string;\r\n\r\n  private isDisposed = false;\r\n\r\n  scheduledOnActivated: Array<() => void> = [];\r\n\r\n  register<TInstance>(\r\n    sym: ITypeSymbol<TInstance>,\r\n    creator?: (...creatorArgs: any[]) => TInstance,\r\n    creatorEx?: (container: Container, ...creatorArgs: any[]) => TInstance\r\n  ): IRegistrator<TInstance> {\r\n    const registration = new Registration<TInstance>();\r\n    registration.typeSymbol = sym;\r\n    registration.regCreator = creator;\r\n    registration.regCreatorEx = creatorEx;\r\n    if (!this.registrations.has(sym)) {\r\n      this.registrations.set(sym, []);\r\n    }\r\n    const registrations = this.registrations.get(sym);\r\n    if (registrations) registrations.push(registration);\r\n    const registrator = new Registrator(registration);\r\n    return registrator;\r\n  }\r\n\r\n  registerClass<TInstance>(\r\n    sym: ITypeSymbol<TInstance>,\r\n    regClass: new (...args: any[]) => TInstance\r\n  ): IRegistrator<TInstance> {\r\n    const registration = new Registration<TInstance>();\r\n    registration.typeSymbol = sym;\r\n    registration.regClass = regClass;\r\n    if (!this.registrations.has(sym)) {\r\n      this.registrations.set(sym, []);\r\n    }\r\n    const registrations = this.registrations.get(sym);\r\n    if (registrations) registrations.push(registration);\r\n    const registrator = new Registrator(registration);\r\n    return registrator;\r\n  }\r\n\r\n  checkDisposed() {\r\n    if (this.isDisposed) {\r\n      debugger;\r\n      throw new Error(\"Trying to resolve from a disposed container.\");\r\n    }\r\n  }\r\n\r\n  resolveAll<TInstance>(sym: ITypeSymbol<TInstance>, creatorArgs?: any[]): TInstance[] {\r\n    this.checkDisposed();\r\n    pushCurrentContainer(this);\r\n    try {\r\n      const registrations = this.findAllRegistrations(sym);\r\n      return registrations.map((registration) =>\r\n        this.resolveByRegistration(registration, creatorArgs || [])\r\n      );\r\n    } finally {\r\n      popCurrentContainer();\r\n    }\r\n  }\r\n\r\n  resolve<TInstance>(sym: ITypeSymbol<TInstance>, ...creatorArgs: any[]): TInstance {\r\n    this.checkDisposed();\r\n    pushCurrentContainer(this);\r\n    try {\r\n      const registration = this.findRegistration(sym);\r\n      if (registration) {\r\n        return this.resolveByRegistration(registration, creatorArgs || []);\r\n      } else {\r\n        debugger;\r\n        throw new Error(\"No registration for symbol \" + sym.symName);\r\n      }\r\n    } finally {\r\n      popCurrentContainer();\r\n    }\r\n  }\r\n\r\n  resolveOptional<TInstance>(\r\n    sym: ITypeSymbol<TInstance>,\r\n    ...creatorArgs: any[]\r\n  ): TInstance | undefined {\r\n    this.checkDisposed();\r\n    pushCurrentContainer(this);\r\n    try {\r\n      const registration = this.findRegistration(sym);\r\n      if (registration) {\r\n        return this.resolveByRegistration(registration, creatorArgs || []);\r\n      } else {\r\n        return;\r\n      }\r\n    } finally {\r\n      popCurrentContainer();\r\n    }\r\n  }\r\n\r\n  resolveByRegistration<TInstance>(registration: Registration<TInstance>, creatorArgs: any[]) {\r\n    //console.log('Resolve:', registration.typeSymbol)\r\n    for (let h of registration.onPreparing) h({container: this});\r\n    if (registration.instancePerDependency) {\r\n      return this.providePerDependency(registration, creatorArgs);\r\n    } else if (registration.singleInstance) {\r\n      return this.provideSingle(registration, creatorArgs);\r\n    } else if (registration.instancePerLifetimeScope) {\r\n      return this.providePerLifetimeScope(registration, creatorArgs);\r\n    } else if (registration.instancePerSwitchedLifetimeScope) {\r\n      return this.providePerSwitchedLifetimeScope(registration, creatorArgs);\r\n    } else if (registration.instancePerNamedLifetimeScope) {\r\n      return this.providePerNamedLifetimeScope(registration, creatorArgs);\r\n    } else if (this.options.defaultLifetime === ILifetime.PerDependency) {\r\n      return this.providePerDependency(registration, creatorArgs);\r\n    } else if (this.options.defaultLifetime === ILifetime.PerLifetimeScope) {\r\n      return this.providePerLifetimeScope(registration, creatorArgs);\r\n    } else if (this.options.defaultLifetime === ILifetime.Single) {\r\n      return this.provideSingle(registration, creatorArgs);\r\n    } else {\r\n      // This branch never entered?\r\n      return this.providePerDependency(registration, creatorArgs);\r\n    }\r\n  }\r\n\r\n  resolveFromCreator<TInstance>(creator: (...args: any[]) => TInstance) {\r\n    this.checkDisposed();\r\n    pushCurrentContainer(this);\r\n    try {\r\n      const instance = creator();\r\n      registerScope(instance, this);\r\n      // this.transientInstances.push(instance);\r\n      return instance;\r\n    } finally {\r\n      popCurrentContainer();\r\n    }\r\n  }\r\n\r\n  newFromRegistration<TInstance>(registration: Registration<TInstance>, creatorArgs: any[]) {\r\n    // console.log(\"NewFromRegistration\", this.scopeName, registration.typeSymbol);\r\n    try {\r\n      if (registration.regClass) {\r\n        pushCreator(registration.regClass);\r\n        return new registration.regClass(...creatorArgs);\r\n      }\r\n      if (registration.regCreator) {\r\n        pushCreator(registration.regCreator);\r\n        return registration.regCreator(...creatorArgs);\r\n      }\r\n      if (registration.regCreatorEx) {\r\n        pushCreator(registration.regCreatorEx);\r\n        return registration.regCreatorEx(this, ...creatorArgs);\r\n      }\r\n      debugger;\r\n      throw new Error(\"Neither class nor creator registered.\");\r\n    } finally {\r\n      popCreator();\r\n    }\r\n  }\r\n\r\n  providePerDependency<TInstance>(registration: Registration<TInstance>, creatorArgs: any[]) {\r\n    let instance = this.newFromRegistration(registration, creatorArgs);\r\n    registerScope(instance, this);\r\n    if (registration.onRelease.length > 0) {\r\n      this.disposeEvents.set(instance, registration.onRelease);\r\n    }\r\n    for (let h of registration.onActivating)\r\n      h({\r\n        container: this,\r\n        instance,\r\n        replaceInstance(newInstance) { // eslint-disable-line no-loop-func\r\n          instance = newInstance;\r\n        },\r\n      });\r\n    for (let h of registration.onActivated) {\r\n      getBottomContainer().scheduledOnActivated.push(() => h({container: this, instance})); // eslint-disable-line no-loop-func\r\n    }\r\n    this.transientInstances.push(instance);\r\n\r\n    return instance;\r\n  }\r\n\r\n  provideSingle(registration: Registration<any>, creatorArgs: any[]) {\r\n    const container = this.findRootContainer();\r\n    return this.provideFromContainer(container, registration, creatorArgs);\r\n  }\r\n\r\n  providePerLifetimeScope(registration: Registration<any>, creatorArgs: any[]) {\r\n    const container = this;\r\n    return this.provideFromContainer(container, registration, creatorArgs);\r\n  }\r\n\r\n  providePerSwitchedLifetimeScope(registration: Registration<any>, creatorArgs: any[]) {\r\n    const container = registration.instancePerSwitchedLifetimeScope!(this);\r\n    if (container) {\r\n      return this.provideFromContainer(container, registration, creatorArgs);\r\n    } else {\r\n      throw new Error(`Scope named ${registration.instancePerNamedLifetimeScope} not opened.`);\r\n    }\r\n  }\r\n\r\n  providePerNamedLifetimeScope(registration: Registration<any>, creatorArgs: any[]) {\r\n    const container = this.findFirstNamedContainer(registration.instancePerNamedLifetimeScope!);\r\n    if (container) {\r\n      return this.provideFromContainer(container, registration, creatorArgs);\r\n    } else {\r\n      throw new Error(`Scope named ${registration.instancePerNamedLifetimeScope} not opened.`);\r\n    }\r\n  }\r\n\r\n  provideFromContainer<TInstance>(\r\n    container: Container,\r\n    registration: Registration<TInstance>,\r\n    creatorArgs: any[]\r\n  ) {\r\n    // console.log(\"ProvideFromContainer\", container.scopeName, registration.typeSymbol);\r\n    if (container.instances.has(registration.typeSymbol!)) {\r\n      return container.instances.get(registration.typeSymbol!)!;\r\n    } else {\r\n      let instance = this.newFromRegistration(registration, creatorArgs);\r\n      registerScope(instance, this);\r\n      if (registration.onRelease.length > 0) {\r\n        this.disposeEvents.set(instance, registration.onRelease);\r\n      }\r\n      for (let h of registration.onActivating)\r\n        h({\r\n          container: this,\r\n          instance,\r\n          replaceInstance(newInstance) { // eslint-disable-line no-loop-func\r\n            instance = newInstance;\r\n          },\r\n        });\r\n      container.instances.set(registration.typeSymbol!, instance);\r\n      for (let h of registration.onActivated) {\r\n        getBottomContainer().scheduledOnActivated.push(() => h({container: this, instance})); // eslint-disable-line no-loop-func\r\n      }\r\n      return instance;\r\n    }\r\n  }\r\n\r\n  beginLifetimeScope(scopeName?: string, detached?: boolean): Container {\r\n    //console.log(\"Entering lifetime scope:\", scopeName);\r\n    const container = new Container(this.options);\r\n    container.scopeName = scopeName;\r\n    container.parent = this;\r\n    if (!detached) this.children.push(container);\r\n    return container;\r\n  }\r\n\r\n  dispose() {\r\n    // TODO: Dispose registered objects\r\n    //console.log(\"Disposing lifetime scope:\", this.scopeName);\r\n    // You might want to use TypeSymbol instance call to resolve something during disposal.\r\n    this.triggerOnThisScopeWillDispose();\r\n    pushCurrentContainer(this);\r\n    // console.log(\"Disposing\", this);\r\n    try {\r\n      const parent = this.parent;\r\n      for (let instance of this.instances.values()) {\r\n        const disposeEvent = this.disposeEvents.get(instance);\r\n        if (disposeEvent) {\r\n          for (let h of disposeEvent) h({instance, container: this});\r\n        }\r\n        // console.log(\"Disposing cached\", instance);\r\n        if (instance.dispose) instance.dispose();\r\n      }\r\n      this.instances.clear();\r\n      for (let instance of this.transientInstances) {\r\n        const disposeEvent = this.disposeEvents.get(instance);\r\n        if (disposeEvent) {\r\n          for (let h of disposeEvent) h({instance, container: this});\r\n        }\r\n        // console.log(\"Disposing transient\", instance);\r\n        if (instance.dispose) instance.dispose();\r\n      }\r\n      this.transientInstances.length = 0;\r\n      this.isDisposed = true;\r\n      if (this.parent) {\r\n        const idx = this.parent.children.findIndex((item) => item === this);\r\n        if (idx > -1) this.parent.children.splice(idx, 1);\r\n        this.parent = undefined;\r\n      }\r\n      return parent;\r\n    } finally {\r\n      popCurrentContainer();\r\n      this.triggerOnThisScopeDisposed();\r\n    }\r\n  }\r\n\r\n  disposeWithChildren() {\r\n    for (let child of [...this.children]) {\r\n      child.disposeWithChildren();\r\n    }\r\n    this.dispose();\r\n  }\r\n\r\n  findAllRegistrations<TInstance>(sym: ITypeSymbol<TInstance>): Array<Registration<any>> {\r\n    let registrations: Array<Registration<any>> = [];\r\n    if (this.parent) {\r\n      registrations.push(...this.parent.findAllRegistrations(sym));\r\n    }\r\n    if (this.registrations.has(sym)) {\r\n      registrations.push(...this.registrations.get(sym)!);\r\n    }\r\n    return registrations;\r\n  }\r\n\r\n  findRegistration<TInstance>(sym: ITypeSymbol<TInstance>): Registration<any> | undefined {\r\n    if (this.registrations.has(sym)) {\r\n      return this.registrations.get(sym)!.slice(-1)[0];\r\n    }\r\n    if (this.parent) {\r\n      return this.parent.findRegistration(sym);\r\n    } else {\r\n      return;\r\n    }\r\n  }\r\n\r\n  findRootContainer(): Container {\r\n    if (this.parent) return this.parent.findRootContainer();\r\n    return this;\r\n  }\r\n\r\n  findFirstNamedContainer(name: string): Container | undefined {\r\n    if (this.scopeName === name) return this;\r\n    if (this.parent) return this.parent.findFirstNamedContainer(name);\r\n    return;\r\n  }\r\n\r\n  findFirstContainer(pred: (cont: Container) => boolean): Container | undefined {\r\n    if (pred(this)) return this;\r\n    if (this.parent) return this.parent.findFirstContainer(pred);\r\n    return;\r\n  }\r\n\r\n  resolveFlowFinished() {\r\n    for (let h of this.scheduledOnActivated) h();\r\n    this.scheduledOnActivated.length = 0;\r\n  }\r\n\r\n  _onThisScopeDisposed: Array<($cont: Container) => void> = [];\r\n\r\n  onThisScopeDisposed(handler: ($cont: Container) => void) {\r\n    this._onThisScopeDisposed.push(handler);\r\n  }\r\n\r\n  triggerOnThisScopeDisposed() {\r\n    for (let h of this._onThisScopeDisposed) h(this);\r\n  }\r\n\r\n  _onThisScopeWillDispose: Array<($cont: Container) => void> = [];\r\n\r\n  onThisScopeWillDispose(handler: ($cont: Container) => void) {\r\n    this._onThisScopeWillDispose.push(handler);\r\n  }\r\n\r\n  triggerOnThisScopeWillDispose() {\r\n    for (let h of this._onThisScopeWillDispose) h(this);\r\n  }\r\n}\r\n\r\nexport interface IContainer {\r\n  register<TInstance>(\r\n    sym: ITypeSymbol<TInstance>,\r\n    creator?: () => TInstance,\r\n    creatorEx?: (container: Container) => TInstance\r\n  ): IRegistrator<TInstance>;\r\n\r\n  resolve<TInstance>(sym: ITypeSymbol<TInstance>): TInstance;\r\n\r\n  resolveAll<TInstance>(sym: ITypeSymbol<TInstance>): TInstance[];\r\n\r\n  resolveOptional<TInstance>(sym: ITypeSymbol<TInstance>): TInstance | undefined;\r\n\r\n  resolveFromCreator<TInstance>(creator: (...args: any[]) => TInstance): TInstance;\r\n\r\n  beginLifetimeScope(scopeName?: string): IContainer;\r\n\r\n  dispose(): void;\r\n}\r\n\r\nexport interface IRegistrator<TInstance> {\r\n  transientInstance(): IRegistrator<TInstance>;\r\n\r\n  singleInstance(): IRegistrator<TInstance>;\r\n\r\n  scopedInstance(\r\n    name?: string | (($cont: Container) => Container | undefined)\r\n  ): IRegistrator<TInstance>;\r\n\r\n  onActivated(handler: (args: IOnActivatedArgs<TInstance>) => void): IRegistrator<TInstance>;\r\n\r\n  onActivating(handler: (args: IOnActivatingArgs<TInstance>) => void): IRegistrator<TInstance>;\r\n\r\n  onPreparing(handler: (args: IOnPreparingArgs) => void): IRegistrator<TInstance>;\r\n\r\n  onRelease(handler: (args: IOnReleaseArgs<TInstance>) => void): IRegistrator<TInstance>;\r\n\r\n  forward(\r\n    fn: (registrator: IRegistrator<TInstance>) => IRegistrator<TInstance>\r\n  ): IRegistrator<TInstance>;\r\n}\r\n\r\nexport interface IOnPreparingArgs {\r\n  container: IContainer;\r\n}\r\n\r\nexport interface IOnReleaseArgs<TInstance> {\r\n  container: IContainer;\r\n  instance: TInstance;\r\n}\r\n\r\nexport interface IOnActivatingArgs<TInstance> {\r\n  container: IContainer;\r\n  instance: TInstance;\r\n\r\n  replaceInstance(newInstance: TInstance): void;\r\n}\r\n\r\nexport interface IOnActivatedArgs<TInstance> {\r\n  container: IContainer;\r\n  instance: TInstance;\r\n}\r\n\r\nexport interface ITypeSymbol<TInstance> {\r\n  (): TInstance;\r\n\r\n  symName: string;\r\n  injectAsGetter?: boolean;\r\n  injectAsCreator?: boolean;\r\n  usingContainer?: Container;\r\n  injectEnumeration?: boolean;\r\n  enumerationCacheKey: any;\r\n}\r\n\r\nlet _currentContainerStack: Container[] = new Array(10);\r\nlet _currentContainerStackTop = -1;\r\n\r\nexport function isContainerFlow() {\r\n  return _currentContainerStackTop > -1;\r\n}\r\n\r\nexport function getTopContainer() {\r\n  return _currentContainerStack[_currentContainerStackTop];\r\n}\r\n\r\nexport function getBottomContainer() {\r\n  return _currentContainerStack[0];\r\n}\r\n\r\nexport function pushCurrentContainer(currentContainer: Container) {\r\n  _currentContainerStackTop++;\r\n  _currentContainerStack[_currentContainerStackTop] = currentContainer;\r\n}\r\n\r\nexport function popCurrentContainer() {\r\n  const container = _currentContainerStack[_currentContainerStackTop];\r\n  _currentContainerStack[_currentContainerStackTop] = undefined!;\r\n  _currentContainerStackTop--;\r\n  if (_currentContainerStackTop === -1) {\r\n    container.resolveFlowFinished();\r\n  }\r\n  return container;\r\n}\r\n\r\nexport function getScopePath(container?: Container) {\r\n  if (!container) container = getTopContainer();\r\n  const result: Container[] = [];\r\n  while (container) {\r\n    result.push(container);\r\n    container = (container as any).parent;\r\n  }\r\n  return result;\r\n}\r\n\r\nlet _creatorStack: any[] = new Array(10);\r\nlet _creatorStackTop = -1;\r\n\r\nfunction pushCreator(creator: any) {\r\n  _creatorStackTop++;\r\n  _creatorStack[_creatorStackTop] = creator;\r\n}\r\n\r\nfunction popCreator() {\r\n  _creatorStack[_creatorStackTop] = undefined;\r\n  _creatorStackTop--;\r\n}\r\n\r\nexport function getCreatorStack() {\r\n  return _creatorStack.slice(0, _creatorStackTop + 1).reverse();\r\n}\r\n\r\nexport function TypeSymbol<TInstance>(symName: string): ITypeSymbol<TInstance> {\r\n  const resolve = (): TInstance => {\r\n    const container = getTopContainer();\r\n    if (!container) throw new Error(\"No resolution flow active.\");\r\n    return container.resolve<TInstance>(resolve as any);\r\n  };\r\n  resolve.symName = symName;\r\n  resolve.toString = () => `TypeSymbol <${symName}>`;\r\n  resolve.enumerationCacheKey = {};\r\n  return resolve;\r\n}\r\n\r\nexport function Func<TInstance>(tys: ITypeSymbol<TInstance>) {\r\n  const container = getTopContainer();\r\n  if (!container) throw new Error(\"No resolution flow active.\");\r\n  const resolve = (): ((...creatorArgs: any[]) => TInstance) => {\r\n    return (...creatorArgs: any[]) => {\r\n      const overrideContainer = getTopContainer();\r\n      return (overrideContainer || container).resolve<TInstance>(tys as any, ...creatorArgs);\r\n    };\r\n  };\r\n  resolve.symName = tys.symName;\r\n  resolve.toString = () => `Func <${tys.toString()}>`;\r\n  return resolve;\r\n}\r\n\r\nexport function Optional<TInstance>(tys: ITypeSymbol<TInstance>) {\r\n  const container = getTopContainer();\r\n  if (!container) throw new Error(\"No resolution flow active.\");\r\n  const resolve = (): TInstance | undefined => {\r\n    const overrideContainer = getTopContainer();\r\n    return (overrideContainer || container).resolveOptional<TInstance>(tys as any);\r\n  };\r\n  resolve.symName = tys.symName;\r\n  resolve.toString = () => `Optional <${tys.toString()}>`;\r\n  return resolve;\r\n}\r\n\r\nexport function Owned<TInstance>(tys: ITypeSymbol<TInstance>, scopeName?: string) {\r\n  const container = getTopContainer();\r\n  if (!container) throw new Error(\"No resolution flow active.\");\r\n  const resolve = (): ((creatorArgs?: any[]) => TInstance) => {\r\n    let scope: Container | undefined;\r\n    const creator = (creatorArgs?: any[]) => {\r\n      scope = container.beginLifetimeScope(scopeName);\r\n      return scope.resolve<TInstance>(tys as any, creatorArgs);\r\n    };\r\n    creator.dispose = () => {\r\n      if (scope) {\r\n        scope.dispose();\r\n      }\r\n    };\r\n    return creator;\r\n  };\r\n  resolve.symName = tys.symName;\r\n  resolve.toString = () => `Owned <${tys.toString()}>`;\r\n  return resolve;\r\n}\r\n\r\n/*\r\nexport function Enumeration<TInstance>(tys: ITypeSymbol<TInstance>) {\r\n  const resolve = (): TInstance[] => {\r\n    const container = getTopContainer();\r\n    if (!container) throw new Error(\"No resolution flow active.\");\r\n    return container.resolveAll(tys);\r\n  };\r\n  resolve.symName = tys.symName;\r\n  resolve.toString = () => `Enumeration <${tys.toString()}>`;\r\n  return resolve;\r\n}*/\r\n\r\nexport function Getter<TInstance>(tys: ITypeSymbol<TInstance>) {\r\n  tys.injectAsGetter = true;\r\n  return tys;\r\n}\r\n\r\nexport function InjectContainer() {\r\n  const container = getTopContainer();\r\n  if (!container) throw new Error(\"No resolution flow active.\");\r\n  return container;\r\n}\r\n\r\nconst _registeredScopes = new Map<any, Container>();\r\n\r\nexport function registerScope(instance: any, scope: Container) {\r\n  try {\r\n    _registeredScopes.set(instance, scope);\r\n  } catch (e) {\r\n    // When resolving primitive value, it cannot be inserted into weakmap\r\n    // Nor will we want to know, which scope it comes from.\r\n  }\r\n}\r\n\r\nexport function scopeFor(instance: any): Container | undefined {\r\n  return _registeredScopes.get(instance);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getGroupingConfiguration } from \"model/selectors/TablePanelView/getGroupingConfiguration\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { IGrouper } from \"./types/IGrouper\";\r\nimport { comparer, flow, IReactionDisposer, observable, reaction } from \"mobx\";\r\nimport { ICellOffset, IGroupTreeNode } from \"gui/Components/ScreenElements/Table/TableRendering/types\";\r\nimport { ServerSideGroupItem } from \"gui/Components/ScreenElements/Table/TableRendering/GroupItem\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { getOrderingConfiguration } from \"model/selectors/DataView/getOrderingConfiguration\";\r\nimport { joinWithAND } from \"./OrigamApiHelpers\";\r\nimport { parseAggregations } from \"./Aggregatioins\";\r\nimport { getUserFilters } from \"model/selectors/DataView/getUserFilters\";\r\nimport { getFilterConfiguration } from \"model/selectors/DataView/getFilterConfiguration\";\r\nimport { getCellOffset, getNextRowId, getPreviousRowId, getRowById, getRowIndex } from \"./GrouperCommon\";\r\nimport _ from \"lodash\";\r\nimport { IGroupingSettings } from \"./types/IGroupingConfiguration\";\r\nimport { DateGroupData, GenericGroupData, IGroupData } from \"./DateGroupData\";\r\nimport moment from \"moment\";\r\nimport { runGeneratorInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\n\r\n\r\nexport class ServerSideGrouper implements IGrouper {\r\n  @observable.shallow topLevelGroups: IGroupTreeNode[] = [];\r\n  parent?: any = null;\r\n  disposers: IReactionDisposer[] = [];\r\n  groupDisposers: Map<IGroupTreeNode, IReactionDisposer> = new Map<IGroupTreeNode, IReactionDisposer>()\r\n  @observable refreshTrigger = 0;\r\n\r\n  start() {\r\n    this.disposers.push(\r\n      reaction(\r\n        () => [\r\n          Array.from(getGroupingConfiguration(this).groupingSettings.values()),\r\n          Array.from(getGroupingConfiguration(this).groupingSettings.keys()),\r\n          this.refreshTrigger],\r\n        () => this.loadGroupsDebounced(),\r\n        {fireImmediately: true, equals: comparer.structural, delay: 50})\r\n    );\r\n  }\r\n\r\n  get allGroups() {\r\n    return this.topLevelGroups.flatMap(group => [group, ...group.allChildGroups]);\r\n  }\r\n\r\n  loadGroupsDebounced = _.debounce(this.loadGroupsImm, 10);\r\n\r\n  loadGroupsImm() {\r\n    const self = this;\r\n    runGeneratorInFlowWithHandler({ctx: this, generator: self.loadGroups()});\r\n  }\r\n\r\n  private*loadGroups(): any {\r\n    const firstGroupingColumn = getGroupingConfiguration(this).firstGroupingColumn;\r\n    if (!firstGroupingColumn) {\r\n      this.topLevelGroups.length = 0;\r\n      return;\r\n    }\r\n    const expandedGroupDisplayValues = this.allGroups\r\n      .filter(group => group.isExpanded)\r\n      .map(group => group.columnDisplayValue)\r\n    const dataView = getDataView(this);\r\n    const property = getDataTable(this).getPropertyById(firstGroupingColumn.columnId);\r\n    const lookupId = property && property.lookup && property.lookup.lookupId;\r\n    const aggregations = getTablePanelView(this).aggregations.aggregationList;\r\n    const groupData = yield getFormScreenLifecycle(this).loadGroups(dataView, firstGroupingColumn, lookupId, aggregations)\r\n    this.topLevelGroups = this.group(groupData, firstGroupingColumn.columnId, undefined);\r\n    yield*this.loadAndExpandChildren(this.topLevelGroups, expandedGroupDisplayValues);\r\n  }\r\n\r\n  private*loadAndExpandChildren(childGroups: IGroupTreeNode[], expandedGroupDisplayValues: string[]): Generator {\r\n    for (const group of childGroups) {\r\n      if (expandedGroupDisplayValues.includes(group.columnDisplayValue)) {\r\n        group.isExpanded = true;\r\n        yield*this.loadChildren(group);\r\n        yield*this.loadAndExpandChildren(group.childGroups, expandedGroupDisplayValues)\r\n      }\r\n    }\r\n  }\r\n\r\n  substituteRecord(row: any[]): void {\r\n    this.allGroups.map(group => group.substituteRecord(row))\r\n  }\r\n\r\n  refresh() {\r\n    this.refreshTrigger++;\r\n  }\r\n\r\n  getRowIndex(rowId: string): number | undefined {\r\n    return getRowIndex(this, rowId);\r\n  }\r\n\r\n  getRowById(id: string): any[] | undefined {\r\n    return getRowById(this, id);\r\n  }\r\n\r\n  getTotalRowCount(rowId: string): number | undefined {\r\n    return this.allGroups\r\n      .find(group => group.getRowById(rowId))?.rowCount;\r\n  }\r\n\r\n  getCellOffset(rowId: string): ICellOffset {\r\n    return getCellOffset(this, rowId);\r\n  }\r\n\r\n  getNextRowId(rowId: string): string {\r\n    return getNextRowId(this, rowId);\r\n  }\r\n\r\n  getPreviousRowId(rowId: string): string {\r\n    return getPreviousRowId(this, rowId);\r\n  }\r\n\r\n  notifyGroupClosed(group: IGroupTreeNode) {\r\n    if (this.groupDisposers.has(group)) {\r\n      this.groupDisposers.get(group)!();\r\n      this.groupDisposers.delete(group);\r\n    }\r\n  }\r\n\r\n  *loadChildren(groupHeader: IGroupTreeNode) {\r\n    if (this.groupDisposers.has(groupHeader)) {\r\n      this.groupDisposers.get(groupHeader)!();\r\n    }\r\n    this.groupDisposers.set(\r\n      groupHeader,\r\n      reaction(\r\n        () => [\r\n          getGroupingConfiguration(this).nextColumnToGroupBy(groupHeader.columnId),\r\n          this.composeFinalFilter(groupHeader),\r\n          [...getFilterConfiguration(this).activeFilters],\r\n          [...getTablePanelView(this).aggregations.aggregationList],\r\n          getOrderingConfiguration(this).groupChildrenOrdering\r\n        ],\r\n        () => this.loadChildrenReactionDebounced(groupHeader),\r\n      )\r\n    );\r\n    yield*this.reload(groupHeader);\r\n  }\r\n\r\n  loadChildrenReactionDebounced = _.debounce(this.loadChildrenReaction, 10);\r\n\r\n  private loadChildrenReaction(group: IGroupTreeNode) {\r\n    flow(() => this.reload(group))();\r\n  }\r\n\r\n  private*reload(group: IGroupTreeNode): any {\r\n    const groupingConfiguration = getGroupingConfiguration(this);\r\n    const nextColumnSettings = groupingConfiguration.nextColumnToGroupBy(group.columnId);\r\n    const dataView = getDataView(this);\r\n    const filter = this.composeFinalFilter(group);\r\n    const lifeCycle = getFormScreenLifecycle(this);\r\n    const aggregations = getTablePanelView(this).aggregations.aggregationList;\r\n    const orderingConfiguration = getOrderingConfiguration(this);\r\n    if (nextColumnSettings) {\r\n      const property = getDataTable(this).getPropertyById(nextColumnSettings.columnId);\r\n      const lookupId = property && property.lookup && property.lookup.lookupId;\r\n      const groupData = yield lifeCycle.loadChildGroups(dataView, filter, nextColumnSettings, aggregations, lookupId)\r\n      group.childGroups = this.group(groupData, nextColumnSettings.columnId, group);\r\n    } else {\r\n      const rows = yield lifeCycle.loadChildRows(dataView, filter, orderingConfiguration.groupChildrenOrdering)\r\n      group.childRows = rows;\r\n    }\r\n  }\r\n\r\n  composeFinalFilter(rowGroup: IGroupTreeNode) {\r\n    const groupingFilter = rowGroup.composeGroupingFilter();\r\n    const userFilters = getUserFilters({ctx: this, excludePropertyId: rowGroup.columnId});\r\n\r\n    return userFilters\r\n      ? joinWithAND([groupingFilter, userFilters])\r\n      : groupingFilter;\r\n  }\r\n\r\n\r\n  group(groupData: any[], columnId: string, parent: IGroupTreeNode | undefined): IGroupTreeNode[] {\r\n    const groupingConfiguration = getGroupingConfiguration(this);\r\n    const groupingSettings = groupingConfiguration.groupingSettings.get(columnId);\r\n    const level = groupingSettings?.groupIndex;\r\n\r\n    if (!level || !groupingSettings) {\r\n      throw new Error(\"Cannot find grouping index for column: \" + columnId);\r\n    }\r\n\r\n    let dataTable = getDataTable(this);\r\n    const property = dataTable.getPropertyById(columnId);\r\n\r\n    return groupData.map((groupDataItem) => {\r\n      const groupData = this.getGroupData(groupDataItem, groupingSettings);\r\n      return new ServerSideGroupItem({\r\n        childGroups: [] as IGroupTreeNode[],\r\n        childRows: [] as any[][],\r\n        columnId: columnId,\r\n        groupLabel: property!.name,\r\n        rowCount: groupDataItem[\"groupCount\"] as number,\r\n        parent: parent,\r\n        columnValue: groupData.value,\r\n        columnDisplayValue: groupData.label,\r\n        aggregations: parseAggregations(groupDataItem[\"aggregations\"]),\r\n        groupingUnit: groupingSettings.groupingUnit,\r\n        grouper: this,\r\n      });\r\n    });\r\n  }\r\n\r\n  getGroupData(groupDataItem: any, groupingSettings: IGroupingSettings): IGroupData {\r\n    if (!groupDataItem) {\r\n      new DateGroupData(undefined, \"\");\r\n    }\r\n    if (groupingSettings.groupingUnit !== undefined) {\r\n\r\n      const yearValue = groupDataItem[groupingSettings.columnId + \"_year\"];\r\n      const monthValue = groupDataItem[groupingSettings.columnId + \"_month\"]\r\n        ? groupDataItem[groupingSettings.columnId + \"_month\"] - 1\r\n        : 0;\r\n      const dayValue = groupDataItem[groupingSettings.columnId + \"_day\"] ?? 1\r\n      const hourValue = groupDataItem[groupingSettings.columnId + \"_hour\"] ?? 0;\r\n      const minuteValue = groupDataItem[groupingSettings.columnId + \"_minute\"] ?? 0;\r\n\r\n      const value = moment({y: yearValue, M: monthValue, d: dayValue, h: hourValue, m: minuteValue, s: 0})\r\n      return DateGroupData.create(value, groupingSettings.groupingUnit)\r\n    } else {\r\n      return new GenericGroupData(\r\n        groupDataItem[groupingSettings.columnId],\r\n        groupDataItem[\"groupCaption\"] ?? groupDataItem[groupingSettings.columnId]\r\n      );\r\n    }\r\n  }\r\n\r\n  dispose() {\r\n    for (let disposer of this.disposers) {\r\n      disposer();\r\n    }\r\n    this.allGroups.forEach(group => group.dispose())\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IGrouper } from \"./types/IGrouper\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { getGroupingConfiguration } from \"model/selectors/TablePanelView/getGroupingConfiguration\";\r\nimport { ICellOffset, IGroupTreeNode } from \"gui/Components/ScreenElements/Table/TableRendering/types\";\r\nimport { ClientSideGroupItem } from \"gui/Components/ScreenElements/Table/TableRendering/GroupItem\";\r\nimport { getTablePanelView } from \"../selectors/TablePanelView/getTablePanelView\";\r\nimport { IAggregationInfo } from \"./types/IAggregationInfo\";\r\nimport { computed } from \"mobx\";\r\nimport { AggregationType } from \"./types/AggregationType\";\r\nimport { getCellOffset, getNextRowId, getPreviousRowId, getRowById, getRowCount, getRowIndex } from \"./GrouperCommon\";\r\nimport { IGroupingSettings } from \"./types/IGroupingConfiguration\";\r\nimport { DateGroupData, GenericGroupData, IGroupData } from \"./DateGroupData\";\r\nimport moment from \"moment\";\r\nimport { getOrderingConfiguration } from \"model/selectors/DataView/getOrderingConfiguration\";\r\nimport { IOrderByDirection } from \"./types/IOrderingConfiguration\";\r\n\r\nexport class ClientSideGrouper implements IGrouper {\r\n  parent?: any = null;\r\n  expandedGroupDisplayValues: Set<string> = new Set();\r\n\r\n  @computed\r\n  get topLevelGroups() {\r\n    const firstGroupingColumn = getGroupingConfiguration(this).firstGroupingColumn;\r\n    if (firstGroupingColumn === undefined) {\r\n      return [];\r\n    }\r\n    const dataTable = getDataTable(this);\r\n    const groups = this.makeGroups(undefined, dataTable.rows, firstGroupingColumn);\r\n    this.loadRecursively(groups);\r\n    return groups;\r\n  }\r\n\r\n  get allGroups() {\r\n    return this.topLevelGroups.flatMap(group => [group, ...group.allChildGroups]);\r\n  }\r\n\r\n  substituteRecord(row: any[]): void {\r\n  }\r\n\r\n  getCellOffset(rowId: string): ICellOffset {\r\n    return getCellOffset(this, rowId);\r\n  }\r\n\r\n  getRowIndex(rowId: string): number | undefined {\r\n    return getRowIndex(this, rowId);\r\n  }\r\n\r\n  getRowById(id: string): any[] | undefined {\r\n    return getRowById(this, id);\r\n  }\r\n\r\n  getTotalRowCount(rowId: string): number | undefined {\r\n    return getRowCount(this, rowId);\r\n  }\r\n\r\n  getNextRowId(rowId: string): string {\r\n    return getNextRowId(this, rowId);\r\n  }\r\n\r\n  getPreviousRowId(rowId: string): string {\r\n    return getPreviousRowId(this, rowId);\r\n  }\r\n\r\n  loadRecursively(groups: IGroupTreeNode[]) {\r\n    for (let group of groups) {\r\n      if (this.expandedGroupDisplayValues.has(group.columnDisplayValue)) {\r\n        group.isExpanded = true;\r\n        this.loadChildrenInternal(group);\r\n        this.loadRecursively(group.childGroups);\r\n      }\r\n    }\r\n  }\r\n\r\n  expansionListener(item: ClientSideGroupItem) {\r\n    if (item.isExpanded) {\r\n      this.expandedGroupDisplayValues.add(item.columnDisplayValue);\r\n    } else {\r\n      this.expandedGroupDisplayValues.delete(item.columnDisplayValue);\r\n    }\r\n  }\r\n\r\n  makeGroups(parent: IGroupTreeNode | undefined, rows: any[][], groupingColumnSettings: IGroupingSettings): IGroupTreeNode[] {\r\n    const dataTable = getDataTable(this);\r\n    const property = dataTable.getPropertyById(groupingColumnSettings.columnId);\r\n    const orderingConfig = getOrderingConfiguration(this);\r\n    const orderingDirection = orderingConfig.orderings\r\n        .find(ordering => ordering.columnId === groupingColumnSettings.columnId)\r\n        ?.direction\r\n      ?? IOrderByDirection.ASC;\r\n\r\n    return this.groupToGroupDataList(groupingColumnSettings, rows)\r\n      .sort((a, b) =>\r\n        orderingDirection === IOrderByDirection.ASC\r\n          ? a.compare(b)\r\n          : -a.compare(b))\r\n      .map((groupData) => {\r\n        return new ClientSideGroupItem({\r\n          childGroups: [] as IGroupTreeNode[],\r\n          childRows: groupData.rows,\r\n          columnId: groupingColumnSettings.columnId,\r\n          groupLabel: property!.name,\r\n          rowCount: groupData.rows.length,\r\n          parent: parent,\r\n          columnValue: groupData.label,\r\n          columnDisplayValue: property ? dataTable.resolveCellText(property, groupData.label) : groupData.label,\r\n          aggregations: this.calcAggregations(groupData.rows),\r\n          grouper: this,\r\n          expansionListener: this.expansionListener.bind(this)\r\n        });\r\n      });\r\n  }\r\n\r\n  private groupToGroupDataList(groupingSettings: IGroupingSettings | undefined, rows: any[][]) {\r\n    if (!groupingSettings) {\r\n      return [];\r\n    }\r\n\r\n    const index = this.findDataIndex(groupingSettings.columnId);\r\n    const groupMap = new Map<string, IGroupData>();\r\n    for (let row of rows) {\r\n      const groupData = groupingSettings.groupingUnit === undefined\r\n        ? new GenericGroupData(row[index], row[index])\r\n        : DateGroupData.create(moment(row[index]), groupingSettings.groupingUnit)\r\n      if (!groupMap.has(groupData.label)) {\r\n        groupMap.set(groupData.label, groupData);\r\n      }\r\n      groupMap.get(groupData.label)!.rows!.push(row);\r\n    }\r\n\r\n    return Array.from(groupMap.values());\r\n  }\r\n\r\n  calcAggregations(rows: any[][]) {\r\n    return getTablePanelView(this).aggregations.aggregationList.map((aggregationInfo) => {\r\n      return {\r\n        columnId: aggregationInfo.ColumnName,\r\n        type: aggregationInfo.AggregationType,\r\n        value: this.calcAggregation(aggregationInfo, rows),\r\n      };\r\n    });\r\n  }\r\n\r\n  private calcAggregation(aggregationInfo: IAggregationInfo, rows: any[][]) {\r\n    const index = this.findDataIndex(aggregationInfo.ColumnName);\r\n    const valuesToAggregate = rows.map((row) => row[index]);\r\n\r\n    switch (aggregationInfo.AggregationType) {\r\n      case AggregationType.SUM:\r\n        return valuesToAggregate.reduce((a, b) => a + b, 0);\r\n      case AggregationType.AVG:\r\n        return valuesToAggregate.reduce((a, b) => a + b, 0) / rows.length;\r\n      case AggregationType.MIN:\r\n        return Math.min(...valuesToAggregate);\r\n      case AggregationType.MAX:\r\n        return Math.max(...valuesToAggregate);\r\n      default:\r\n        throw new Error(\"Aggregation type not implemented: \" + aggregationInfo.AggregationType);\r\n    }\r\n  }\r\n\r\n  findDataIndex(columnName: string) {\r\n    const dataTable = getDataTable(this);\r\n    const property = dataTable.getPropertyById(columnName);\r\n    if (!property) {\r\n      return 0;\r\n    }\r\n    return property.dataIndex;\r\n  }\r\n\r\n  *loadChildren(group: IGroupTreeNode) {\r\n    this.loadChildrenInternal(group);\r\n  }\r\n\r\n  loadChildrenInternal(group: IGroupTreeNode) {\r\n    const groupingConfiguration = getGroupingConfiguration(this);\r\n    const nextColumnName = groupingConfiguration.nextColumnToGroupBy(group.columnId);\r\n\r\n    if (nextColumnName) {\r\n      group.childGroups = this.makeGroups(group, group.childRows, nextColumnName);\r\n    }\r\n  }\r\n\r\n\r\n  notifyGroupClosed(group: IGroupTreeNode) {\r\n  }\r\n\r\n  start(): void {\r\n  }\r\n}\r\n\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from 'react';\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { Observer } from \"mobx-react\";\r\nimport { IRenderable } from \"modules/CommonTypes\";\r\nimport { ContribArray } from \"utils/common\";\r\nimport { IDataViewToolbarContribItem } from \"./DataViewTypes\";\r\n\r\nexport class DataViewBodyUI {\r\n  contrib = new ContribArray<IRenderable>();\r\n\r\n  render() {\r\n    return <Observer>{() => <>{this.contrib.asArray().map((item) => item.render())}</>}</Observer>;\r\n  }\r\n}\r\n\r\nexport const IDataViewBodyUI = TypeSymbol<DataViewBodyUI>(\"DataViewBodyUI\");\r\n\r\n\r\nexport class DataViewToolbarUI {\r\n  contrib = new ContribArray<IDataViewToolbarContribItem>();\r\n\r\n  renderSection(section: string) {\r\n    return (\r\n      <Observer>\r\n        {() => (\r\n          <>\r\n            {this.contrib\r\n              .asArray()\r\n              .filter((item) => item.section === section)\r\n              .map((item) => item.render())}\r\n          </>\r\n        )}\r\n      </Observer>\r\n    );\r\n  }\r\n}\r\n\r\nexport const IDataViewToolbarUI = TypeSymbol<DataViewToolbarUI>(\"DataViewToolbarUI\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IRenderable } from \"modules/CommonTypes\";\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { DataView } from 'model/entities/DataView';\r\n\r\nexport const SectionViewSwitchers = \"SectionViewSwitchers\";\r\n\r\nexport interface IDataViewToolbarContribItem extends IRenderable {\r\n  section: string;\r\n}\r\n\r\nexport const IDataView = TypeSymbol<DataView>(\"IDataView\");","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport Measure, { ContentRect } from \"react-measure\";\r\nimport S from \"./Dropdowner.module.scss\";\r\nimport { action, observable } from \"mobx\";\r\nimport { observer, Observer } from \"mobx-react\";\r\n\r\nclass DroppedBox extends React.Component<{\r\n  triggerRect: ContentRect;\r\n  dropdownRect: ContentRect;\r\n  dropdownRef: any;\r\n  openEvent?: MouseEvent;\r\n  onCloseRequest?: (event: any) => void;\r\n  onOutsideInteraction?: (event: any) => void;\r\n}> {\r\n  elmDropdown: HTMLDivElement | null = null;\r\n  refDropdown = (elm: HTMLDivElement | null) => {\r\n    this.elmDropdown = elm;\r\n    this.props.dropdownRef(elm);\r\n  };\r\n\r\n  isStillMounted = false;\r\n\r\n  componentDidMount() {\r\n    this.isStillMounted = true;\r\n    setTimeout(() => {\r\n      if (this.isStillMounted) {\r\n        window.addEventListener(\"mousedown\", this.handleMaybeClose);\r\n        window.addEventListener(\"mousewheel\", this.handleMaybeClose);\r\n      }\r\n    });\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.isStillMounted = false;\r\n    window.removeEventListener(\"mousedown\", this.handleMaybeClose);\r\n    window.removeEventListener(\"mousewheel\", this.handleMaybeClose);\r\n  }\r\n\r\n  @action.bound\r\n  handleMaybeClose(event: any) {\r\n    if (this.elmDropdown && !this.elmDropdown.contains(event.target)) {\r\n      this.props.onOutsideInteraction?.(event);\r\n      this.props.onCloseRequest && this.props.onCloseRequest(event);\r\n    }\r\n  }\r\n\r\n  calcPosition() {\r\n    let style: any = {};\r\n\r\n    const viewportWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\r\n    const viewportHeight = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\r\n\r\n    const tBounds = this.props.triggerRect.bounds!;\r\n    const dBounds = this.props.dropdownRect.bounds!;\r\n\r\n    if (tBounds.top + tBounds.height + dBounds.height + 20 < viewportHeight) {\r\n      style.top = tBounds.top + tBounds.height || 0;\r\n    } else {\r\n      style.top = tBounds.top - dBounds.height || 0;\r\n    }\r\n    if (tBounds!.left + dBounds.width + 20 < viewportWidth) {\r\n      style.left = tBounds.left || 0;\r\n    } else {\r\n      if(tBounds.left + tBounds.width - dBounds.width < 0){\r\n        style.left = viewportWidth / 2 - dBounds.width / 2;\r\n      }else{\r\n        style.left = tBounds.left + tBounds.width - dBounds.width || 0;\r\n      }\r\n    }\r\n    return style;\r\n  }\r\n\r\n  render() {\r\n    const style: any = this.props.openEvent\r\n      ? {left: this.props.openEvent.clientX, top: this.props.openEvent.clientY}\r\n      : this.calcPosition();\r\n\r\n    return ReactDOM.createPortal(\r\n      <div ref={this.refDropdown} style={style} className={S.droppedBox}>\r\n        {this.props.children}\r\n      </div>,\r\n      document.getElementById(\"dropdown-portal\")!\r\n    );\r\n  }\r\n}\r\n\r\n@observer\r\nexport class Dropdowner extends React.Component<{\r\n  className?: string;\r\n  style?: any;\r\n  trigger: (args: {\r\n    refTrigger: any;\r\n    measure: () => void;\r\n    setDropped: (state: boolean, event?: any) => void;\r\n    isDropped: boolean;\r\n  }) => React.ReactNode;\r\n  content: (args: { setDropped: (state: boolean) => void }) => React.ReactNode;\r\n  onDroppedDown?: () => void;\r\n  onDroppedUp?: () => void;\r\n  onContainerMouseDown?(event: any): void;\r\n  onOutsideInteraction?(event: any): void;\r\n}> {\r\n  refMeasTrigger = (elm: any) => (this.elmMeasTrigger = elm);\r\n  elmMeasTrigger: any | null = null;\r\n\r\n  refMeasDropdown = (elm: any) => (this.elmMeasDropdown = elm);\r\n  elmMeasDropdown: any | null = null;\r\n\r\n  @observable _isDropped = false;\r\n  openEvent: any;\r\n\r\n  get isDropped() {\r\n    return this._isDropped;\r\n  }\r\n\r\n  set isDropped(value: boolean) {\r\n    if (window.localStorage.getItem(\"debugKeepDropdownOpen\") && !value) return;\r\n    this._isDropped = value;\r\n  }\r\n\r\n  @action.bound\r\n  setDropped(state: boolean, event?: any) {\r\n    event?.persist();\r\n    this.openEvent = event;\r\n    if (!this.isDropped && state) {\r\n      this.isDropped = state;\r\n      this.reMeasure();\r\n      this.props.onDroppedDown && this.props.onDroppedDown();\r\n    } else if (this.isDropped && !state) {\r\n      this.isDropped = state;\r\n      this.props.onDroppedUp && this.props.onDroppedUp();\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  windowMouseWheel(event: any) {\r\n    this.setDropped(false);\r\n  }\r\n\r\n  @action.bound\r\n  reMeasure() {\r\n    this.elmMeasTrigger && this.elmMeasTrigger.measure();\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    if (this.isDropped) {\r\n      this.elmMeasDropdown && this.elmMeasDropdown.measure();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    (() => this.isDropped)();\r\n    return (\r\n      <Measure bounds={true} ref={this.refMeasTrigger}>\r\n        {({measureRef: mRefTrigger, contentRect: cRectTrigger, measure: measureTrigger}) => (\r\n          <Measure bounds={true} ref={this.refMeasDropdown}>\r\n            {({\r\n                measureRef: mRefDropdown,\r\n                contentRect: cRectDropdown,\r\n                measure: measureDropdown,\r\n              }) => (\r\n              <Observer>\r\n                {() => (\r\n                  <div\r\n                    className={\r\n                      S.dropdownerContainer +\r\n                      (this.props.className ? ` ${this.props.className}` : \"\")\r\n                    }\r\n                    style={this.props.style}\r\n                    onMouseDown={this.props.onContainerMouseDown}\r\n                  >\r\n                    {this.props.trigger({\r\n                      refTrigger: mRefTrigger,\r\n                      measure: this.reMeasure,\r\n                      setDropped: this.setDropped,\r\n                      isDropped: this.isDropped,\r\n                    })}\r\n                    {this.isDropped && (\r\n                      <DroppedBox\r\n                        openEvent={this.openEvent}\r\n                        triggerRect={cRectTrigger}\r\n                        dropdownRect={cRectDropdown}\r\n                        dropdownRef={mRefDropdown}\r\n                        onCloseRequest={() => {\r\n                          this.setDropped(false);\r\n                          this.props.onDroppedUp?.();\r\n                        }}\r\n                        onOutsideInteraction={this.props.onOutsideInteraction}\r\n                      >\r\n                        {this.props.content({setDropped: this.setDropped})}\r\n                      </DroppedBox>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </Observer>\r\n            )}\r\n          </Measure>\r\n        )}\r\n      </Measure>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/DataViewHeader/DataViewHeader.module.scss\";\r\nimport cx from 'classnames';\r\n\r\nexport const DataViewHeader: React.FC<{ domRef?: any, isVisible: boolean }> = props => (\r\n  <div className={cx(S.root, \"dataViewHeader\" , {isVisible: props.isVisible})}>\r\n    <div ref={props.domRef} className={S.inner}>\r\n      {props.children}\r\n    </div>\r\n  </div>\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/DataViewHeader/DataViewHeaderButton.module.scss\";\r\nimport cx from \"classnames\";\r\n\r\nexport const DataViewHeaderButton: React.FC<{\r\n  domRef?: any;\r\n  isHidden?: boolean;\r\n  disabled?: boolean;\r\n  title?: string;\r\n  onClick?(event: any): void;\r\n}> = (props) => (\r\n  <button\r\n    title={props.title}\r\n    ref={props.domRef}\r\n    className={cx(props.disabled ? S.disabled : S.enabled, S.root, {hidden: props.isHidden})}\r\n    onClick={props.onClick}\r\n    disabled={props.disabled}\r\n  >\r\n    {props.children}\r\n  </button>\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getAction } from \"./getAction\";\r\n\r\nexport function getIsEnabledAction(ctx: any) {\r\n  return getAction(ctx).isEnabled;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/Dropdown/Dropdown.module.scss\";\r\n\r\nexport const Dropdown: React.FC = props => (\r\n  <div className={S.root}>{props.children}</div>\r\n);","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/Dropdown/DropdownItem.module.scss\";\r\nimport cx from \"classnames\";\r\n\r\nexport const DropdownItem: React.FC<{\r\n  className?: string;\r\n  onClick?(event: any): void;\r\n  isDisabled?: boolean;\r\n  isSelected?: boolean;\r\n  id?: string;\r\n}> = props => {\r\n  function getStyle() {\r\n    if (props.isDisabled) {\r\n      return \"isDisabled\"\r\n    }\r\n    return props.isSelected ? S.isSelected : \"\"\r\n  }\r\n\r\n  return <div\r\n    id={props.id}\r\n    onClick={props.onClick}\r\n    className={cx(S.root, getStyle(), props.className, \"dropdownItem\")}\r\n  >\r\n    {props.children}\r\n  </div>\r\n};\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\n\r\nexport const DataViewHeaderDropDownItem: React.FC<{\r\n  onClick?(event: any): void;\r\n}> = (props) => (\r\n  <div onClick={props.onClick}>\r\n    {props.children}\r\n  </div>\r\n);","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { CriticalSection } from \"utils/sync\";\r\n\r\nexport const crs_fieldBlur_ActionClick = new CriticalSection();\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport actions from \"./actions\";\r\nimport columnConfigurationDialog from './columnConfigurationDialog';\r\nimport dataView from './dataView';\r\nimport formView from './formView';\r\nimport loginPage from './loginPage';\r\nimport mainMenu from './mainMenu';\r\nimport screenHeader from './screenHeader';\r\nimport screenTabHandleRow from './screenTabHandleRow';\r\nimport screenToolbar from './screenToolbar';\r\nimport selectionDialog from './selectionDialog';\r\nimport splitter from './splitter';\r\nimport tableView from './tableView';\r\nimport workQueues from './workQueues';\r\nimport workflow from './workflow';\r\n\r\nexport default {\r\n  actions,\r\n  columnConfigurationDialog,\r\n  dataView,\r\n  formView,\r\n  loginPage,\r\n  mainMenu,\r\n  screenHeader,\r\n  screenTabHandleRow,\r\n  screenToolbar,\r\n  selectionDialog,\r\n  splitter,\r\n  tableView,\r\n  workQueues,\r\n  workflow\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { IAction, IActionMode } from \"model/entities/types/IAction\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { getGridId } from \"model/selectors/DataView/getGridId\";\r\nimport { getEntity } from \"model/selectors/DataView/getEntity\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\nimport { handleError } from \"model/actions/handleError\";\r\n\r\nimport selectors from \"model/selectors-tree\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { crs_fieldBlur_ActionClick } from \"model/actions/actionSync\";\r\n\r\nexport default {\r\n  onActionClick(ctx: any) {\r\n    return flow(function*onActionClick(event: any, action: IAction) {\r\n      try {\r\n        yield*crs_fieldBlur_ActionClick.runGenerator(function*() {\r\n          if (!action.isEnabled) {\r\n            return;\r\n          }\r\n          getDataView(ctx).formFocusManager.stopAutoFocus();\r\n          const lifecycle = getFormScreenLifecycle(ctx);\r\n          const gridId = getGridId(ctx);\r\n          const entity = getEntity(ctx);\r\n          const rowId = getSelectedRowId(ctx);\r\n          switch (action.mode) {\r\n            case IActionMode.Always:\r\n              yield*lifecycle.onExecuteAction(gridId, entity, action, []);\r\n              break;\r\n            case IActionMode.ActiveRecord:\r\n              if (rowId) {\r\n                yield*lifecycle.onExecuteAction(gridId, entity, action, [rowId]);\r\n              }\r\n              break;\r\n            case IActionMode.MultipleCheckboxes:\r\n              const selectedRowIds = selectors.selectionCheckboxes.getSelectedRowIds(ctx);\r\n              yield*lifecycle.onExecuteAction(gridId, entity, action, Array.from(selectedRowIds));\r\n              break;\r\n          }\r\n        });\r\n      } catch (e) {\r\n        yield*handleError(ctx)(e);\r\n        throw e;\r\n      }\r\n    });\r\n  },\r\n};\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\n\r\nexport default {\r\n  onCloseClick(ctx: any) {\r\n    return flow(function*onCancelClick(event: any) {\r\n      try {\r\n        const lifecycle = getFormScreenLifecycle(ctx);\r\n        yield*lifecycle.onWorkflowCloseClick(event);\r\n      } catch (e) {\r\n        yield*handleError(ctx)(e);\r\n        throw e;\r\n      }\r\n    });\r\n  },\r\n\r\n  onRepeatClick(ctx: any) {\r\n    return flow(function*onRepeatClick(event: any) {\r\n      try {\r\n        const lifecycle = getFormScreenLifecycle(ctx);\r\n        yield*lifecycle.onWorkflowRepeatClick(event);\r\n      } catch (e) {\r\n        yield*handleError(ctx)(e);\r\n        throw e;\r\n      }\r\n    });\r\n  },\r\n};\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/DataViewHeader/DataViewHeaderButtonGroup.module.scss\";\r\nimport { IAction, IActionType } from \"model/entities/types/IAction\";\r\nimport { Dropdowner } from \"gui/Components/Dropdowner/Dropdowner\";\r\nimport { Observer } from \"mobx-react\";\r\nimport { DataViewHeaderButton } from \"gui/Components/DataViewHeader/DataViewHeaderButton\";\r\nimport { getIsEnabledAction } from \"model/selectors/Actions/getIsEnabledAction\";\r\nimport { Dropdown } from \"gui/Components/Dropdown/Dropdown\";\r\nimport { DropdownItem } from \"gui/Components/Dropdown/DropdownItem\";\r\nimport { DataViewHeaderDropDownItem } from \"gui/Components/DataViewHeader/DataViewHeaderDropDownItem\";\r\nimport uiActions from \"model/actions-ui-tree\";\r\n\r\nexport class DataViewHeaderButtonGroup extends React.Component<{\r\n  actions: IAction[];\r\n}> {\r\n\r\n  renderActions() {\r\n    return this.props.actions.map((action, idx) =>\r\n      this.renderAction(action, this.props.actions)\r\n    );\r\n  }\r\n\r\n  renderAction(action: IAction, actionsToRender: IAction[]) {\r\n    if (action.type === IActionType.Dropdown) {\r\n      const childActions = actionsToRender.filter(\r\n        (otherAction) => otherAction.groupId === action.id\r\n      );\r\n      return (\r\n        <Dropdowner\r\n          style={{width: \"auto\"}}\r\n          trigger={({refTrigger, setDropped}) => (\r\n            <Observer key={action.id}>\r\n              {() => (\r\n                <DataViewHeaderButton\r\n                  title={action.caption}\r\n                  disabled={!getIsEnabledAction(action)}\r\n                  onClick={() => setDropped(true)}\r\n                  domRef={refTrigger}\r\n                >\r\n                  {action.caption}\r\n                </DataViewHeaderButton>\r\n              )}\r\n            </Observer>\r\n          )}\r\n          content={() => (\r\n            <Dropdown>\r\n              {childActions.map((action) => (\r\n                <Observer key={action.id}>\r\n                  {() => (\r\n                    <DropdownItem isDisabled={!getIsEnabledAction(action)}>\r\n                      <DataViewHeaderDropDownItem\r\n                        onClick={(event) => uiActions.actions.onActionClick(action)(event, action)}\r\n                      >\r\n                        {action.caption}\r\n                      </DataViewHeaderDropDownItem>\r\n                    </DropdownItem>\r\n                  )}\r\n                </Observer>\r\n              ))}\r\n            </Dropdown>\r\n          )}\r\n        />\r\n      );\r\n    }\r\n    return (\r\n      <Observer key={action.id}>\r\n        {() => (\r\n          <DataViewHeaderButton\r\n            title={action.caption}\r\n            onClick={(event) => uiActions.actions.onActionClick(action)(event, action)}\r\n            disabled={!getIsEnabledAction(action)}\r\n          >\r\n            {action.caption}\r\n          </DataViewHeaderButton>\r\n        )}\r\n      </Observer>\r\n    );\r\n  }\r\n\r\n  render(){\r\n    return (\r\n      <div className={S.root}>\r\n        {this.renderActions()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport cx from \"classnames\";\r\nimport S from \"gui/Components/DataViewHeader/DataViewHeaderGroup.module.scss\";\r\n\r\nexport const DataViewHeaderGroup: React.FC<{\r\n  isHidden?: boolean;\r\n  noShrink?: boolean;\r\n  className?: string;\r\n  noDivider?: boolean;\r\n  domRef?: any;\r\n  grovable?: boolean;\r\n}> = (props) => (\r\n  <div\r\n    className={cx(S.root, props.className, {\r\n      isHidden: props.isHidden,\r\n      noDivider: props.noDivider,\r\n      grovable: props.grovable,\r\n      noShrink: props.noShrink,\r\n    })}\r\n    ref={props.domRef}\r\n  >\r\n    {props.children}\r\n  </div>\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { T } from \"utils/translation\";\r\nimport CS from \"gui/Components/Dialogs/DialogsCommon.module.css\";\r\nimport S from \"gui/Components/Dialogs/SaveFilterDialog.module.css\";\r\nimport { observable } from \"mobx\";\r\nimport { ModalDialog } from \"gui/Components/Dialog/ModalDialog\";\r\n\r\n@observer\r\nexport class SaveFilterDialog extends React.Component<{\r\n  onCancelClick: (event: any) => void;\r\n  onOkClick: (name: string, isGlobal: boolean) => void;\r\n}> {\r\n  @observable\r\n  filterName: string = \"\";\r\n\r\n  @observable\r\n  isGlobal: boolean = false;\r\n\r\n  refInput = React.createRef<HTMLInputElement>();\r\n\r\n  onNameChanged(event: any) {\r\n    this.filterName = event.target.value;\r\n  }\r\n\r\n  onIsGlobalClicked(event: any) {\r\n    this.isGlobal = event.target.checked;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.refInput.current?.focus();\r\n  }\r\n\r\n  onKeydown(event: React.KeyboardEvent<HTMLInputElement>) {\r\n    if (event.key === \"Enter\") {\r\n      this.props.onOkClick(this.filterName, this.isGlobal);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <ModalDialog\r\n        title={T(\"New Filter\", \"new_filter_title\")}\r\n        titleButtons={null}\r\n        buttonsCenter={\r\n          <>\r\n            <button\r\n              tabIndex={0}\r\n              autoFocus={true}\r\n              onClick={() => this.props.onOkClick(this.filterName, this.isGlobal)}\r\n            >\r\n              {T(\"Ok\", \"button_ok\")}\r\n            </button>\r\n            <button tabIndex={0} onClick={this.props.onCancelClick}>\r\n              {T(\"Cancel\", \"button_cancel\")}\r\n            </button>\r\n          </>\r\n        }\r\n        buttonsLeft={null}\r\n        buttonsRight={null}\r\n      >\r\n        <div className={CS.dialogContent}>\r\n          <div className={S.inpuContainer}>\r\n            <div className={S.row}>\r\n              <div className={S.label}>{T(\"Name:\", \"new_filter_name\")}</div>\r\n              <input\r\n                ref={this.refInput}\r\n                className={S.textInput}\r\n                value={this.filterName}\r\n                onChange={(event) => this.onNameChanged(event)}\r\n                onKeyDown={(event: React.KeyboardEvent<HTMLInputElement>) => this.onKeydown(event)}\r\n              />\r\n            </div>\r\n            <div className={S.row}>\r\n              <div className={S.label}>{T(\"Global:\", \"new_filter_global\")}</div>\r\n              <input\r\n                className={S.chcekBoxinput}\r\n                type=\"checkbox\"\r\n                checked={this.isGlobal}\r\n                onChange={(event) => this.onIsGlobalClicked(event)}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </ModalDialog>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { IFilterGroup } from \"model/entities/types/IFilterGroup\";\r\nimport { Dropdowner } from \"gui/Components/Dropdowner/Dropdowner\";\r\nimport { DataViewHeaderAction } from \"gui/Components/DataViewHeader/DataViewHeaderAction\";\r\nimport { Dropdown } from \"gui/Components/Dropdown/Dropdown\";\r\nimport { DropdownItem } from \"gui/Components/Dropdown/DropdownItem\";\r\nimport { T } from \"utils/translation\";\r\nimport { showDialog } from \"model/selectors/getDialogStack\";\r\nimport { SaveFilterDialog } from \"gui/Components/Dialogs/SaveFilterDialog\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { getFilterGroupManager } from \"model/selectors/DataView/getFilterGroupManager\";\r\nimport { FilterGroupManager } from \"model/entities/FilterGroupManager\";\r\nimport { runInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\n\r\n@observer\r\nexport class FilterDropDown extends React.Component<{ ctx: any }> {\r\n  filterManager: FilterGroupManager;\r\n\r\n  constructor(props: any) {\r\n    super(props);\r\n    this.filterManager = getFilterGroupManager(props.ctx)\r\n  }\r\n\r\n  onDropItemClick(filterGroup: IFilterGroup) {\r\n    this.filterManager.setFilterGroup(filterGroup);\r\n  }\r\n\r\n  onSaveFilterClick() {\r\n    const formScreenLifecycle = getFormScreenLifecycle(this.props.ctx);\r\n    const closeDialog = showDialog(formScreenLifecycle,\r\n      \"\",\r\n      <SaveFilterDialog\r\n        onOkClick={(name: string, isGlobal: boolean) => {\r\n          runInFlowWithHandler({\r\n            ctx: this.filterManager,\r\n            action: () => this.filterManager.saveActiveFiltersAsNewFilterGroup(name, isGlobal)\r\n          });\r\n          closeDialog();\r\n        }}\r\n        onCancelClick={() => {\r\n          closeDialog();\r\n        }}\r\n      />\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const filterGroups = this.filterManager.filterGroups ?? []\r\n\r\n    return (\r\n      <Dropdowner\r\n        trigger={({refTrigger, setDropped}) => (\r\n          <DataViewHeaderAction\r\n            refDom={refTrigger}\r\n            onMouseDown={() => setDropped(true)}\r\n            isActive={false}\r\n          >\r\n            <i className=\"fas fa-caret-down\"/>\r\n          </DataViewHeaderAction>\r\n        )}\r\n        content={({setDropped}) => (\r\n          <Dropdown>\r\n            <DropdownItem\r\n              isDisabled={this.filterManager.filtersHidden}\r\n              onClick={(event: any) => {\r\n                setDropped(false);\r\n                runInFlowWithHandler({\r\n                  ctx: this.filterManager,\r\n                  action: () => this.filterManager.clearFiltersAndClose(event)\r\n                });\r\n              }}\r\n            >\r\n              {T(\"Cancel and Hide Filter\", \"filter_menu_filter_off\")}\r\n            </DropdownItem>\r\n            <DropdownItem\r\n              isDisabled={this.filterManager.noFilterActive}\r\n              onClick={(event: any) => {\r\n                setDropped(false);\r\n                runInFlowWithHandler({\r\n                  ctx: this.filterManager,\r\n                  action: () => this.filterManager.setSelectedFilterGroupAsDefault()\r\n                });\r\n              }}\r\n            >\r\n              {T(\"Remember The Current Filter\", \"filter_menu_set_default_filter\")}\r\n            </DropdownItem>\r\n            <DropdownItem\r\n              isDisabled={!this.filterManager.defaultFilter || this.filterManager.filtersHidden}\r\n              onClick={(event: any) => {\r\n                setDropped(false);\r\n                runInFlowWithHandler({\r\n                  ctx: this.filterManager,\r\n                  action: () => this.filterManager.resetDefaultFilterGroup()\r\n                });\r\n              }}\r\n            >\r\n              {T(\"Cancel Default Filter\", \"filter_menu_cancel_default_filter\")}\r\n            </DropdownItem>\r\n            <DropdownItem\r\n              isDisabled={this.filterManager.noFilterActive}\r\n              onClick={(event: any) => {\r\n                setDropped(false);\r\n                this.onSaveFilterClick();\r\n              }}\r\n            >\r\n              {T(\"Save Current Filter\", \"filter_menu_save_filter\")}\r\n            </DropdownItem>\r\n            <DropdownItem\r\n              isDisabled={\r\n                !this.filterManager.selectedFilterGroup ||\r\n                this.filterManager.isSelectedFilterGroupDefault}\r\n              onClick={(event: any) => {\r\n                setDropped(false);\r\n                runInFlowWithHandler({\r\n                  ctx: this.filterManager,\r\n                  action: () => this.filterManager.deleteFilterGroup()\r\n                });\r\n              }}\r\n            >\r\n              {T(\"Delete\", \"filter_menu_delete\")}\r\n            </DropdownItem>\r\n            <DropdownItem\r\n              isDisabled={\r\n                !this.filterManager.selectedFilterGroup ||\r\n                this.filterManager.isSelectedFilterGroupDefault}\r\n              onClick={(event: any) => {\r\n                setDropped(false);\r\n                runInFlowWithHandler({\r\n                  ctx: this.filterManager,\r\n                  action: () => this.filterManager.cancelSelectedFilter()\r\n                });\r\n              }}\r\n            >\r\n              {T(\"Cancel Filter\", \"filter_menu_cancel\")}\r\n            </DropdownItem>\r\n            {filterGroups.map((filterGroup) => (\r\n              <DropdownItem\r\n                key={filterGroup.id}\r\n                isDisabled={false}\r\n                isSelected={this.filterManager.selectedFilterGroup?.id === filterGroup.id}\r\n                onClick={(event: any) => {\r\n                  setDropped(false);\r\n                  runInFlowWithHandler({\r\n                    ctx: this.filterManager,\r\n                    action: () => this.onDropItemClick(filterGroup)\r\n                  });\r\n                }}\r\n              >\r\n                {filterGroup.name}\r\n              </DropdownItem>\r\n            ))}\r\n          </Dropdown>\r\n        )}\r\n      />\r\n    );\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\n\r\nexport function getFilterGroupManager(ctx: any) {\r\n  return getTablePanelView(ctx).filterGroupManager;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\n\r\nexport function getIsRowMovingDisabled(ctx: any) {\r\n  return getDataView(ctx).dataTable.addedRowPositionLocked;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getTablePanelView } from \"./TablePanelView/getTablePanelView\";\r\n\r\nexport function getColumnConfigurationModel(ctx: any) {\r\n  return getTablePanelView(ctx).columnConfigurationModel;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFormScreen } from \"model/selectors/FormScreen/getFormScreen\";\r\nimport { IDataView } from \"model/entities/types/IDataView\";\r\nimport { handleUserInputOnChangingRow } from \"model/entities/FormScreenLifecycle/questionSaveDataAfterRecordChange\";\r\n\r\nexport async function shouldProceedToChangeRow(dataView: IDataView) {\r\n  const isDirty = getFormScreen(dataView).isDirty;\r\n  if (!isDirty) {\r\n    return true\r\n  }\r\n  return await handleUserInputOnChangingRow(dataView);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport function ValueBox<T>() {\r\n  let _active = false;\r\n  let _value: T | undefined;\r\n\r\n  function get() {\r\n    if (_active) return _value!;\r\n    throw new Error(\"Value not set.\");\r\n  }\r\n\r\n  function set(value: T) {\r\n    if (_active) throw new Error(\"Value already set.\");\r\n    _value = value;\r\n    _active = true;\r\n  }\r\n\r\n  function clear() {\r\n    _value = undefined;\r\n    _active = false;\r\n  }\r\n\r\n  get.get = get;\r\n  get.set = set;\r\n  get.clear = clear;\r\n\r\n  return get;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport function Memoized<T>(valueFn: () => T) {\r\n\r\n  let _computed = false;\r\n  let _value: T | undefined;\r\n\r\n  function get(): T {\r\n    if (_computed) return _value!;\r\n    _computed = true;\r\n    return (_value = valueFn());\r\n  }\r\n\r\n  function clear() {\r\n    _value = undefined;\r\n    _computed = false;\r\n  }\r\n\r\n  get.get = get;\r\n  get.clear = clear;\r\n\r\n  return get;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { ValueBox } from \"./common/ValueBox\";\r\nimport { IClickSubsItem, IMouseOverSubsItem, ITableRow } from \"./types\";\r\nimport { Memoized } from \"./common/Memoized\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { getIsSelectionCheckboxesShown } from \"model/selectors/DataView/getIsSelectionCheckboxesShown\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { getFormScreen } from \"model/selectors/FormScreen/getFormScreen\";\r\n\r\nexport const scRenderTable: Array<() => void> = [];\r\nexport const scRenderRow: Array<() => void> = [];\r\nexport const scRenderCell: Array<() => void> = [];\r\n\r\nexport const context = ValueBox<any>();\r\nscRenderTable.push(() => context.clear());\r\n\r\nexport const context2d = ValueBox<CanvasRenderingContext2D>();\r\nscRenderTable.push(() => context2d.clear());\r\n\r\nexport const rowIndex = ValueBox<number>();\r\nscRenderRow.push(() => rowIndex.clear());\r\n\r\nlet currentRowRightBorderDrawn = false;\r\n\r\nexport function setCurrentRowRightBorderDrawn(value: boolean) {\r\n  currentRowRightBorderDrawn = value;\r\n}\r\n\r\nexport function getCurrentRowRightBorderDrawn() {\r\n  return currentRowRightBorderDrawn;\r\n}\r\n\r\nexport const rowId = () => dataTable().getRowId(currentDataRow());\r\n\r\nexport const selectionColumnShown = () => getIsSelectionCheckboxesShown(context());\r\n\r\nexport const dataCellOffset = () => {\r\n  let offset = groupingColumnCount();\r\n  if (selectionColumnShown()) {\r\n    offset++;\r\n  }\r\n  return offset;\r\n}\r\n\r\nexport const drawingColumnIndex = ValueBox<number>();\r\nscRenderCell.push(() => drawingColumnIndex.clear());\r\n\r\nexport const tableRows = ValueBox<ITableRow[]>();\r\nscRenderTable.push(() => tableRows.clear());\r\n\r\nexport const viewportWidth = ValueBox<number>();\r\nscRenderTable.push(() => viewportWidth.clear());\r\n\r\nexport const viewportHeight = ValueBox<number>();\r\nscRenderTable.push(() => viewportHeight.clear());\r\n\r\nexport const scrollLeft = ValueBox<number>();\r\nscRenderTable.push(() => scrollLeft.clear());\r\n\r\nexport const scrollTop = ValueBox<number>();\r\nscRenderTable.push(() => scrollTop.clear());\r\n\r\nexport const viewportLeft = scrollLeft;\r\n\r\nexport const viewportTop = scrollTop;\r\n\r\nexport const viewportRight = () => viewportLeft() + viewportWidth();\r\n\r\nexport const viewportBottom = () => viewportTop() + viewportHeight();\r\n\r\nexport const worldWidth = Memoized(() => gridLeadCellDimensions().slice(-1)[0].right);\r\nscRenderTable.push(() => worldWidth.clear());\r\n\r\nexport const worldHeight = Memoized(() => tableRowsCount() * rowHeight());\r\nscRenderTable.push(() => worldHeight.clear());\r\n\r\nexport const rowHeight = ValueBox<number>();\r\nscRenderTable.push(() => rowHeight.clear());\r\n\r\nexport const tableColumnIds = ValueBox<string[]>();\r\nscRenderTable.push(() => tableColumnIds.clear());\r\n\r\nexport const groupingColumnIds = ValueBox<string[]>();\r\nscRenderTable.push(() => groupingColumnIds.clear());\r\n\r\nexport const groupingColumnCount = () => groupingColumnIds().length;\r\n\r\nexport const isGrouping = () => groupingColumnIds().length > 0;\r\n\r\nexport function currentRow(): ITableRow {\r\n  return tableRows()[rowIndex()];\r\n}\r\n\r\nexport function currentDataRow(): any[] {\r\n  return currentRow() as any[];\r\n}\r\n\r\nexport const isCheckBoxedTable = ValueBox<boolean>();\r\nscRenderTable.push(isCheckBoxedTable.clear);\r\n\r\nexport const fixedColumnCount = ValueBox<number>();\r\nscRenderTable.push(fixedColumnCount.clear);\r\n\r\nexport const columnWidths = ValueBox<Map<string, number>>();\r\nscRenderTable.push(columnWidths.clear);\r\n\r\nexport const realFixedColumnCount = () =>\r\n  isCheckBoxedTable() ? fixedColumnCount() + 1 : fixedColumnCount();\r\n\r\nexport const gridLeadCellDimensions = ValueBox<{ left: number; width: number; right: number }[]>();\r\nscRenderTable.push(gridLeadCellDimensions.clear);\r\n\r\nexport const propertyById = ValueBox<Map<string, IProperty>>();\r\nscRenderTable.push(propertyById.clear);\r\n\r\nexport const tableRowsCount = () => tableRows().length;\r\n\r\nexport const clickSubscriptions = ValueBox<IClickSubsItem[]>();\r\nscRenderTable.push(() => {\r\n  clickSubscriptions.clear();\r\n});\r\n\r\nexport const mouseMoveSubscriptions = ValueBox<IClickSubsItem[]>();\r\nscRenderTable.push(() => {\r\n  mouseMoveSubscriptions.clear();\r\n});\r\n\r\nexport const mouseOverSubscriptions = ValueBox<IMouseOverSubsItem[]>();\r\nscRenderTable.push(mouseOverSubscriptions.clear);\r\n\r\nexport const tablePanelView = () => getTablePanelView(context());\r\n// export const property = () => getTableViewPropertyById(tablePanelView(),  dataRowColumnIds()[drawingColumnIndex()]!);// currentColumnId()!);\r\n//export const property = () => getTableViewPropertyByIdx(tablePanelView(), drawingColumnIndex() - realFixedColumnCount());// currentColumnId()!);\r\n\r\nexport const dataTable = () => getDataTable(tablePanelView());\r\nexport const dataView = () => getDataView(context());\r\nexport const recordId = () => dataTable().getRowId(currentDataRow());\r\n\r\nexport const formScreen = () => getFormScreen(context());\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getRowStateById } from \"./getRowStateById\";\r\n\r\nexport function getRowStateAllowRead(\r\n  ctx: any,\r\n  rowId: string,\r\n  columnId: string\r\n) {\r\n  const rowState = getRowStateById(ctx, rowId);\r\n  const column = rowState ? rowState.columns.get(columnId) : undefined;\r\n  const allowRead = column ? column.allowRead : undefined;\r\n  return allowRead !== undefined ? allowRead : true;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getRowStateById } from \"./getRowStateById\";\r\n\r\nexport function getRowStateForegroundColor(ctx: any, rowId: string) {\r\n  const rowState = getRowStateById(ctx, rowId);\r\n  const rowStateForegroundColor = rowState ? rowState.foregroundColor : undefined;\r\n  if (rowStateForegroundColor) {\r\n    return rowStateForegroundColor;\r\n  }\r\n  return rowState ? rowState.foregroundColor : undefined;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getRowStateById } from \"./getRowStateById\";\r\n\r\nexport function getRowStateRowBgColor(ctx: any, rowId: string | undefined) {\r\n  if (rowId === undefined) {\r\n    return undefined;\r\n  }\r\n  const rowState = getRowStateById(ctx, rowId);\r\n  const rowStateBackgroundColor = rowState\r\n    ? rowState.backgroundColor\r\n    : undefined;\r\n  return rowStateBackgroundColor;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n\r\nconst canvas = document.createElement(\"canvas\");\r\nconst context = canvas.getContext(\"2d\") as any;\r\n\r\nexport function getCanvasPixelRatio() {\r\n  const devicePixelRatio = window.devicePixelRatio || 1;\r\n  const backingStoreRatio =\r\n    context!.webkitBackingStorePixelRatio ||\r\n    context!.mozBackingStorePixelRatio ||\r\n    context!.msBackingStorePixelRatio ||\r\n    context!.oBackingStorePixelRatio ||\r\n    context!.backingStorePixelRatio ||\r\n    1;\r\n\r\n  const ratio = devicePixelRatio / backingStoreRatio;\r\n  return ratio;\r\n}\r\n\r\n\r\nexport const CPR = () => getCanvasPixelRatio();\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport function shadeHexColor(color: string | undefined, percent: number) {\r\n  if (color === undefined) {\r\n    return undefined;\r\n  }\r\n  // eslint-disable-next-line no-mixed-operators\r\n  var f = parseInt(color.slice(1), 16), t = percent < 0 ? 0 : 255, p = percent < 0 ? percent * -1 : percent,\r\n    R = f >> 16, G = f >> 8 & 0x00FF, B = f & 0x0000FF;\r\n  return \"#\" + (0x1000000 + (Math.round((t - R) * p) + R) * 0x10000 + (Math.round((t - G) * p) + G) * 0x100 + (Math.round((t - B) * p) + B)).toString(16).slice(1);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { clickSubscriptions, mouseMoveSubscriptions, mouseOverSubscriptions, } from \"./renderingValues\";\r\nimport { IClickSubsItem, IMouseOverSubsItem } from \"./types\";\r\n\r\nexport function onClick(item: IClickSubsItem) {\r\n  clickSubscriptions().push(item);\r\n}\r\n\r\nexport function handleTableClick(\r\n  event: any,\r\n  canvasX: number,\r\n  canvasY: number,\r\n  scrollLeft: number,\r\n  scrollTop: number,\r\n  clickSubscriptions: IClickSubsItem[]\r\n) {\r\n  let handled = false;\r\n  for (let h of clickSubscriptions) {\r\n    if (h.x <= canvasX && h.x + h.w >= canvasX && h.y <= canvasY && h.y + h.h >= canvasY) {\r\n      h.handler(event, canvasX, canvasY, canvasX, canvasY);\r\n      handled = true;\r\n      break;\r\n    }\r\n  }\r\n  return {handled};\r\n}\r\n\r\nexport function onMouseMove(item: IClickSubsItem) {\r\n  mouseMoveSubscriptions().push(item);\r\n}\r\n\r\nexport function handleTableMouseMove(\r\n  event: any,\r\n  canvasX: number,\r\n  canvasY: number,\r\n  scrollLeft: number,\r\n  scrollTop: number,\r\n  mouseMoveSubscriptions: IClickSubsItem[]\r\n) {\r\n  let handled = false;\r\n  for (let h of mouseMoveSubscriptions) {\r\n    if (h.x <= canvasX && h.x + h.w >= canvasX && h.y <= canvasY && h.y + h.h >= canvasY) {\r\n      h.handler(event, canvasX, canvasY, canvasX, canvasY);\r\n      handled = true;\r\n      break;\r\n    }\r\n  }\r\n  return {handled};\r\n}\r\n\r\nexport function onMouseOver(item: IMouseOverSubsItem) {\r\n  mouseOverSubscriptions().push(item);\r\n}\r\n\r\nexport function getTooltip(\r\n  canvasX: number,\r\n  canvasY: number,\r\n  mouseOverSubscriptions: IMouseOverSubsItem[]\r\n) {\r\n  for (let h of mouseOverSubscriptions) {\r\n    if (h.x <= canvasX && h.x + h.w >= canvasX && h.y <= canvasY && h.y + h.h >= canvasY) {\r\n      return h.toolTipGetter(canvasX, canvasY, canvasX, canvasY);\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport {getDataView} from \"model/selectors/DataView/getDataView\";\r\nimport _ from \"lodash\";\r\n\r\nexport function clearTableDebugValues(ctx: any){\r\n  const dataView = getDataView(ctx);\r\n  const tableId = dataView.modelInstanceId;\r\n  const win = (window as any);\r\n  if(win.tableDebugMonitor && win.tableDebugMonitor[tableId]){\r\n    win.tableDebugMonitor[tableId].data = [];\r\n  }\r\n}\r\nexport const setTableDebugRendered = _.debounce(setRenderedInternal, 200);\r\n\r\nfunction ensureTableDataExists(win: any, tableId: string) {\r\n  if (!win.tableDebugMonitor) {\r\n    win.tableDebugMonitor = {};\r\n  }\r\n  if (!win.tableDebugMonitor[tableId]) {\r\n    win.tableDebugMonitor[tableId] = {\r\n      data: [],\r\n      rendered: false\r\n    }\r\n  }\r\n}\r\n\r\nexport function setRenderedInternal(ctx: any){\r\n  const dataView = getDataView(ctx);\r\n  const tableId = dataView.modelInstanceId;\r\n  const win = (window as any);\r\n  ensureTableDataExists(win, tableId);\r\n  win.tableDebugMonitor[tableId].rendered = true;\r\n}\r\n\r\nexport function setTableDebugValue(ctx: any, propertyId: string | null, rowIndex: number, value: any){\r\n  if(propertyId == null){\r\n    return;\r\n  }\r\n  const dataView = getDataView(ctx);\r\n  const tableId = dataView.modelInstanceId;\r\n  const win = (window as any);\r\n  ensureTableDataExists(win, tableId);\r\n  if(!win.tableDebugMonitor[tableId].data[rowIndex]){\r\n    win.tableDebugMonitor[tableId].data[rowIndex] = {};\r\n  }\r\n  win.tableDebugMonitor[tableId].data[rowIndex][propertyId] = value;\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport {\r\n  cellPaddingLeft,\r\n  cellPaddingRight,\r\n  numberCellPaddingRight\r\n} from \"gui/Components/ScreenElements/Table/TableRendering/cells/cellsCommon\";\r\nimport { getPaddingLeft } from \"gui/Components/ScreenElements/Table/TableRendering/cells/dataCellRenderer\";\r\n\r\nexport class CellAlignment {\r\n\r\n  paddingRight: number;\r\n  paddingLeft: number;\r\n  alignment: string;\r\n\r\n  constructor(isFirstColumn: boolean, type: string, style: ({ [key: string]: string }) | undefined) {\r\n\r\n    if (style?.[\"textAlign\"]) {\r\n      if (style[\"textAlign\"] === \"center\") {\r\n        this.paddingRight = 0;\r\n        this.paddingLeft = 0;\r\n        this.alignment = \"center\";\r\n      } else if (style[\"textAlign\"] === \"left\") {\r\n        this.paddingRight = cellPaddingRight;\r\n        this.paddingLeft = getPaddingLeft(isFirstColumn);\r\n        this.alignment = \"left\";\r\n      } else if (style[\"textAlign\"] === \"right\") {\r\n        this.paddingRight = numberCellPaddingRight;\r\n        this.paddingLeft = cellPaddingLeft;\r\n        this.alignment = \"right\";\r\n      } else {\r\n        throw new Error(`textAlign ${style[\"textAlign\"]} not implemented`);\r\n      }\r\n      return;\r\n    }\r\n\r\n    switch (type) {\r\n      case \"Number\":\r\n        this.paddingRight = numberCellPaddingRight;\r\n        this.paddingLeft = cellPaddingLeft;\r\n        this.alignment = \"right\";\r\n        break;\r\n      default:\r\n        this.paddingRight = cellPaddingRight;\r\n        this.paddingLeft = getPaddingLeft(isFirstColumn);\r\n        this.alignment = \"left\";\r\n    }\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport {\r\n  currentCellText,\r\n  currentCellValue,\r\n  currentColumnId,\r\n  currentColumnLeft,\r\n  currentColumnWidth,\r\n  currentProperty,\r\n  currentRowHeight,\r\n  currentRowTop,\r\n} from \"gui/Components/ScreenElements/Table/TableRendering/currentCell\";\r\nimport {\r\n  cellPaddingLeft,\r\n  cellPaddingLeftFirstCell,\r\n  cellPaddingRight,\r\n  checkBoxCharacterFontSize,\r\n  numberCellPaddingRight,\r\n  topTextOffset,\r\n} from \"gui/Components/ScreenElements/Table/TableRendering/cells/cellsCommon\";\r\nimport { CPR } from \"utils/canvas\";\r\nimport moment from \"moment\";\r\nimport selectors from \"model/selectors-tree\";\r\nimport {\r\n  context,\r\n  drawingColumnIndex,\r\n  formScreen,\r\n  rowHeight,\r\n  rowIndex,\r\n} from \"gui/Components/ScreenElements/Table/TableRendering/renderingValues\";\r\nimport { flashColor2htmlColor } from \"utils/flashColorFormat\";\r\nimport { setTableDebugValue } from \"gui/Components/ScreenElements/Table/TableRendering/DebugTableMonitor\";\r\nimport { CellAlignment } from \"gui/Components/ScreenElements/Table/TableRendering/cells/cellAlignment\";\r\n\r\ninterface IDataCellRenderer {\r\n  drawCellText(): void;\r\n  cellText: string | undefined;\r\n}\r\n\r\nexport function currentDataCellRenderer(ctx2d: CanvasRenderingContext2D) {\r\n  let property = currentProperty();\r\n  const type = property.column;\r\n  const cellAlignment = new CellAlignment( drawingColumnIndex() === 0, type, property.style);\r\n  switch (type) {\r\n    case \"CheckBox\":\r\n      return new CheckBoxCellRenderer(ctx2d);\r\n    case \"Date\":\r\n      return new DateCellRenderer(ctx2d);\r\n    case \"TagInput\":\r\n      return new TagInputCellRenderer(ctx2d);\r\n    case \"ComboBox\":\r\n    case \"Checklist\":\r\n      return new CheckListCellRenderer(ctx2d);\r\n    case \"Number\":\r\n      return new GenericCellRenderer(ctx2d, property.style, cellAlignment);\r\n    case \"Image\":\r\n      return new ImageCellRenderer(ctx2d);\r\n    case \"Color\":\r\n      return new ColorCellRenderer(ctx2d);\r\n    default:\r\n      return new GenericCellRenderer(ctx2d, property.style, cellAlignment);\r\n  }\r\n}\r\n\r\nclass ColorCellRenderer implements IDataCellRenderer {\r\n  constructor(private ctx2d: CanvasRenderingContext2D) {\r\n  }\r\n\r\n  cellText = \"\";\r\n\r\n  drawCellText(): void {\r\n    this.ctx2d.fillStyle = flashColor2htmlColor(currentCellValue()) || \"black\";\r\n    this.ctx2d.fillRect(\r\n      (currentColumnLeft() + 3) * CPR(),\r\n      (currentRowTop() + 3) * CPR(),\r\n      (currentColumnWidth() - 2 * 3) * CPR(),\r\n      (currentRowHeight() - 2 * 3) * CPR()\r\n    );\r\n  }\r\n}\r\n\r\nclass CheckBoxCellRenderer implements IDataCellRenderer {\r\n  constructor(private ctx2d: CanvasRenderingContext2D) {\r\n  }\r\n\r\n  get cellText() {\r\n    return currentCellText();\r\n  }\r\n\r\n  drawCellText(): void {\r\n    this.ctx2d.font = `${checkBoxCharacterFontSize * CPR()}px \"Font Awesome 5 Free\"`;\r\n    this.ctx2d.textAlign = \"center\";\r\n    this.ctx2d.textBaseline = \"middle\";\r\n\r\n    this.ctx2d.fillText(\r\n      !!this.cellText ? \"\\uf14a\" : \"\\uf0c8\",\r\n      CPR() * xCenter(),\r\n      CPR() * (currentRowTop() + topTextOffset - 5)\r\n    );\r\n    setTableDebugValue(context(), currentColumnId(), rowIndex(), this.cellText);\r\n  }\r\n}\r\n\r\nclass DateCellRenderer implements IDataCellRenderer {\r\n  constructor(private ctx2d: CanvasRenderingContext2D) {\r\n  }\r\n\r\n  get cellText() {\r\n    if (currentCellText() !== null && currentCellText() !== \"\") {\r\n      let momentValue = moment(currentCellText());\r\n      if (!momentValue.isValid()) {\r\n        return undefined;\r\n      }\r\n      return momentValue.format(currentProperty().formatterPattern);\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  drawCellText(): void {\r\n    const dateTimeText = this.cellText;\r\n    if (dateTimeText) {\r\n      this.ctx2d.fillText(\r\n        dateTimeText,\r\n        CPR() * (currentColumnLeft() + getPaddingLeft()),\r\n        CPR() * (currentRowTop() + topTextOffset)\r\n      );\r\n    }\r\n    setTableDebugValue(context(), currentColumnId(), rowIndex(), dateTimeText);\r\n  }\r\n}\r\n\r\nclass TagInputCellRenderer implements IDataCellRenderer {\r\n  constructor(private ctx2d: CanvasRenderingContext2D) {\r\n  }\r\n\r\n  get cellText() {\r\n    return currentCellText();\r\n  }\r\n\r\n  drawCellText(): void {\r\n    if (this.cellText !== null) {\r\n      this.ctx2d.fillText(\r\n        \"\" + this.cellText!,\r\n        CPR() * (currentColumnLeft() + getPaddingLeft()),\r\n        CPR() * (currentRowTop() + topTextOffset)\r\n      );\r\n    }\r\n    setTableDebugValue(context(), currentColumnId(), rowIndex(), this.cellText);\r\n  }\r\n}\r\n\r\nclass CheckListCellRenderer implements IDataCellRenderer {\r\n  constructor(private ctx2d: CanvasRenderingContext2D) {\r\n  }\r\n\r\n  get cellText() {\r\n    return currentCellText();\r\n  }\r\n\r\n  drawCellText(): void {\r\n    let isLink = false;\r\n    const property = currentProperty();\r\n    if (property.isLookup && property.lookupEngine) {\r\n      isLink = selectors.column.isLinkToForm(currentProperty());\r\n    }\r\n\r\n    if (isLink) {\r\n      this.ctx2d.save();\r\n      this.ctx2d.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--foreground1');\r\n    }\r\n    if (currentCellText() !== null) {\r\n      this.ctx2d.fillText(\r\n        \"\" + currentCellText()!,\r\n        CPR() * (currentColumnLeft() + getPaddingLeft()),\r\n        CPR() * (currentRowTop() + topTextOffset)\r\n      );\r\n    }\r\n    setTableDebugValue(context(), currentColumnId(), rowIndex(), currentCellText());\r\n    if (isLink) {\r\n      this.ctx2d.restore();\r\n    }\r\n  }\r\n}\r\n\r\nclass ImageCellRenderer implements IDataCellRenderer {\r\n  constructor(private ctx2d: CanvasRenderingContext2D) {\r\n  }\r\n\r\n  get cellText() {\r\n    return currentCellText();\r\n  }\r\n\r\n  drawCellText(): void {\r\n    const value = currentCellValue();\r\n    if (!value) {\r\n      return;\r\n    }\r\n    const {pictureCache} = formScreen();\r\n    const img = pictureCache.getImage(value);\r\n\r\n    if (!img || !img.complete) {\r\n      return;\r\n    }\r\n    const property = currentProperty();\r\n    const iw = img.width;\r\n    const ih = img.height;\r\n    const cw = property.width;\r\n    const ch = property.height;\r\n    const WR = cw / iw;\r\n    const HR = ch / ih;\r\n    let ratio = 0;\r\n    if (Math.abs(1 - WR) < Math.abs(1 - HR)) {\r\n      ratio = WR;\r\n    } else {\r\n      ratio = HR;\r\n    }\r\n    const finIW = ratio * iw;\r\n    const finIH = ratio * ih;\r\n    this.ctx2d.drawImage(\r\n      img,\r\n      CPR() * (xCenter() - finIW * 0.5),\r\n      CPR() * (yCenter() - finIH * 0.5),\r\n      CPR() * finIW,\r\n      CPR() * finIH\r\n    );\r\n  }\r\n}\r\n\r\nclass GenericCellRenderer implements IDataCellRenderer {\r\n  constructor(\r\n    private ctx2d: CanvasRenderingContext2D,\r\n    private style: ({[key: string]: string}) | undefined,\r\n    private cellAlignment: CellAlignment) {\r\n  }\r\n\r\n  get cellText() {\r\n    return currentCellText();\r\n  }\r\n\r\n  drawCellText(): void {\r\n    if (currentCellText() !== null) {\r\n      if (!currentProperty().isPassword) {\r\n        this.ctx2d.font = getCustomTextStyle(this.style, this.ctx2d);\r\n        let x = getCellXCoordinate(this.cellAlignment);\r\n        this.ctx2d.textAlign = this.cellAlignment.alignment as CanvasTextAlign;\r\n        this.ctx2d.fillText(\r\n          \"\" + currentCellText()!,\r\n          CPR() * x,\r\n          CPR() * (currentRowTop() + topTextOffset)\r\n        );\r\n      } else {\r\n        this.ctx2d.fillText(\"*******\", numberCellPaddingRight * CPR(), 15 * CPR());\r\n      }\r\n    }\r\n    setTableDebugValue(context(), currentColumnId(), rowIndex(), currentCellText())\r\n  }\r\n}\r\n\r\nexport function getPaddingLeft(isFirstColumn?: boolean) {\r\n  if(isFirstColumn === undefined){\r\n    isFirstColumn = drawingColumnIndex() === 0\r\n  }\r\n  return isFirstColumn ? cellPaddingLeftFirstCell : cellPaddingLeft;\r\n}\r\n\r\nexport function getPaddingRight() {\r\n  return cellPaddingRight;\r\n}\r\n\r\nexport function xCenter() {\r\n  return currentColumnLeft() + currentColumnWidth() / 2;\r\n}\r\n\r\nexport function yCenter() {\r\n  return currentRowTop() + rowHeight() / 2;\r\n}\r\n\r\nfunction getCustomTextStyle(style: ({[key: string]: string}) | undefined, ctx2d: CanvasRenderingContext2D){\r\n  if(style?.[\"fontWeight\"] === \"bold\"){\r\n   return \"bold \" + ctx2d.font\r\n  }\r\n  return ctx2d.font;\r\n}\r\n\r\nfunction getCellXCoordinate(cellAlignment: CellAlignment){\r\n\r\n  if(cellAlignment.alignment === \"center\") {\r\n    return xCenter() ;\r\n  }\r\n  else if(cellAlignment.alignment === \"right\"){\r\n    return currentColumnLeft() + currentColumnWidth() - cellAlignment.paddingRight;\r\n  }\r\n  else {\r\n    return currentColumnLeft()  + cellAlignment.paddingLeft;\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { getRowStateAllowRead } from \"model/selectors/RowState/getRowStateAllowRead\";\r\nimport { getRowStateForegroundColor } from \"model/selectors/RowState/getRowStateForegroundColor\";\r\nimport { getRowStateRowBgColor } from \"model/selectors/RowState/getRowStateRowBgColor\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { CPR } from \"utils/canvas\";\r\nimport { shadeHexColor } from \"utils/colorUtils\";\r\nimport actionsUi from \"model/actions-ui-tree\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { getShowToolTipsForMemoFieldsOnly } from \"model/selectors/Workbench/getShowToolTipsForMemoFieldsOnly\";\r\nimport {\r\n  currentCellErrorMessage,\r\n  currentColumnLeft,\r\n  currentColumnLeftVisible,\r\n  currentColumnWidth,\r\n  currentColumnWidthVisible,\r\n  currentProperty,\r\n  currentRowHeight,\r\n  currentRowTop,\r\n  isCurrentCellLoading,\r\n} from \"../currentCell\";\r\nimport { onClick, onMouseMove } from \"../onClick\";\r\nimport {\r\n  columnWidths,\r\n  context,\r\n  context2d,\r\n  currentDataRow,\r\n  drawingColumnIndex,\r\n  recordId,\r\n  rowIndex,\r\n  tableColumnIds,\r\n  tablePanelView,\r\n} from \"../renderingValues\";\r\nimport {\r\n  applyScrollTranslation,\r\n  checkBoxCharacterFontSize,\r\n  clipCell,\r\n  drawSelectedRowBorder,\r\n  fontSize,\r\n  frontStripWidth,\r\n  selectRowBorderWidth,\r\n  topTextOffset,\r\n} from \"./cellsCommon\";\r\nimport {\r\n  currentDataCellRenderer,\r\n  getPaddingLeft,\r\n  getPaddingRight,\r\n  xCenter,\r\n} from \"gui/Components/ScreenElements/Table/TableRendering/cells/dataCellRenderer\";\r\n\r\nexport function dataColumnsWidths() {\r\n  return tableColumnIds().map((id) => columnWidths().get(id) || 100);\r\n}\r\n\r\nexport function dataColumnsDraws() {\r\n  return tableColumnIds().map((id) => () => {\r\n    applyScrollTranslation();\r\n    drawDataCellBackground();\r\n    drawInvalidDataSymbol();\r\n    clipCell();\r\n    drawCellValue();\r\n    registerClickHandler(id);\r\n    registerToolTipGetter(id);\r\n  });\r\n}\r\n\r\nfunction registerToolTipGetter(columnId: string) {\r\n  const ctx2d = context2d();\r\n  const property = currentProperty();\r\n  const cellRenderer = currentDataCellRenderer(ctx2d);\r\n  const cellClickableArea = getCellClickableArea();\r\n  const cellWidth = currentColumnWidth();\r\n\r\n  if (property.column === \"CheckBox\" || property.column === \"Image\" || property.column === \"Blob\") {\r\n    return;\r\n  }\r\n\r\n  if (\r\n    getShowToolTipsForMemoFieldsOnly(property) &&\r\n    (property.column !== \"Text\" || !property.multiline)\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  const cellTextRendered = cellRenderer.cellText;\r\n  const textWidth = ctx2d.measureText(cellTextRendered).width / CPR();\r\n\r\n  const hasTooltip = cellWidth - getPaddingLeft() - getPaddingRight() < textWidth;\r\n  const tablePanelView = getTablePanelView(context());\r\n\r\n  onMouseMove({\r\n    x: cellClickableArea.x,\r\n    y: cellClickableArea.y,\r\n    w: cellClickableArea.width,\r\n    h: cellClickableArea.height,\r\n    handler(event: any) {\r\n      if (hasTooltip) {\r\n        tablePanelView.currentTooltipText = cellTextRendered;\r\n      } else {\r\n        tablePanelView.currentTooltipText = undefined;\r\n      }\r\n    },\r\n  });\r\n}\r\n\r\nfunction registerClickHandler(columnId: string) {\r\n  const ctx = context();\r\n  const row = currentDataRow();\r\n\r\n  const property = currentProperty();\r\n\r\n  const cellClickableArea = getCellClickableArea();\r\n  if (property.column === \"CheckBox\") {\r\n    const checkboxClickableArea = getCheckboxClickableArea();\r\n    onClick({\r\n      x: checkboxClickableArea.x,\r\n      y: checkboxClickableArea.y,\r\n      w: checkboxClickableArea.width,\r\n      h: checkboxClickableArea.height,\r\n      handler(event: any) {\r\n        flow(function*() {\r\n          if (event.isDouble) {\r\n            getTablePanelView(ctx).setEditing(false);\r\n            const defaultAction = getDataView(ctx).firstEnabledDefaultAction;\r\n            if (defaultAction) {\r\n              yield actionsUi.actions.onActionClick(ctx)(event, defaultAction);\r\n            }\r\n          } else {\r\n            yield*getTablePanelView(ctx).onCellClick(event, row, columnId, true);\r\n          }\r\n        })();\r\n      },\r\n    });\r\n  }\r\n  onClick({\r\n    x: cellClickableArea.x,\r\n    y: cellClickableArea.y,\r\n    w: cellClickableArea.width,\r\n    h: cellClickableArea.height,\r\n    handler(event: any) {\r\n      flow(function*() {\r\n        if (event.isDouble) {\r\n          getTablePanelView(ctx).setEditing(false);\r\n          const defaultAction = getDataView(ctx).firstEnabledDefaultAction;\r\n          if (defaultAction && defaultAction.isEnabled) {\r\n            yield actionsUi.actions.onActionClick(ctx)(event, defaultAction);\r\n          }\r\n        } else {\r\n          yield*getTablePanelView(ctx).onCellClick(event, row, columnId, false);\r\n        }\r\n      })();\r\n    },\r\n  });\r\n}\r\n\r\nfunction getCellClickableArea() {\r\n  return {\r\n    x: currentColumnLeftVisible(),\r\n    y: currentRowTop(),\r\n    width: currentColumnWidthVisible(),\r\n    height: currentRowHeight(),\r\n  };\r\n}\r\n\r\nfunction getCheckboxClickableArea() {\r\n  const fontSize = checkBoxCharacterFontSize;\r\n  return {\r\n    x: xCenter() - fontSize / 2,\r\n    y: currentRowTop() + topTextOffset - 4 - fontSize / 2,\r\n    width: fontSize,\r\n    height: fontSize,\r\n  };\r\n}\r\n\r\nexport function drawDataCellBackground() {\r\n  const ctx2d = context2d();\r\n  const ctx = context();\r\n  const selectedRowId = getSelectedRowId(tablePanelView());\r\n  const isRowCursor = recordId() === selectedRowId;\r\n\r\n  const thisCellRectangle = {\r\n    columnLeft: currentColumnLeft(),\r\n    columnWidth: currentColumnWidth(),\r\n    rowTop: currentRowTop(),\r\n    rowHeight: currentRowHeight(),\r\n  };\r\n  getTablePanelView(ctx).setCellRectangle(rowIndex(), drawingColumnIndex(), thisCellRectangle);\r\n  if (drawingColumnIndex() === 0) {\r\n    getTablePanelView(ctx).firstColumn = currentProperty();\r\n  }\r\n  ctx2d.fillStyle = getBackGroundColor();\r\n  ctx2d.fillRect(\r\n    CPR() * currentColumnLeft(),\r\n    CPR() * currentRowTop(),\r\n    CPR() * currentColumnWidth(),\r\n    CPR() * (currentRowHeight() - 1)\r\n  );\r\n  if (isRowCursor) {\r\n    drawSelectedRowBorder(frontStripWidth);\r\n  }\r\n}\r\n\r\nfunction drawInvalidDataSymbol() {\r\n  const ctx2d = context2d();\r\n  let isInvalid = !!currentCellErrorMessage();\r\n  const property = currentProperty();\r\n  const selectedRowId = getSelectedRowId(tablePanelView());\r\n  const isRowCursor = recordId() === selectedRowId;\r\n\r\n  let isLoading = false;\r\n  if (property.isLookup && property.lookupEngine) {\r\n    isLoading = isCurrentCellLoading();\r\n  }\r\n\r\n  if (isInvalid && !isLoading) {\r\n    const leftOffset = drawingColumnIndex() === 0 && isRowCursor ? frontStripWidth / 2 : 0;\r\n    const topBottomOffset = isRowCursor ? selectRowBorderWidth : 0;\r\n    ctx2d.save();\r\n    ctx2d.fillStyle = \"red\";\r\n    ctx2d.beginPath();\r\n    ctx2d.moveTo(\r\n      leftOffset + currentColumnLeft() * CPR(),\r\n      topBottomOffset + currentRowTop() * CPR()\r\n    );\r\n    ctx2d.lineTo(\r\n      (leftOffset + currentColumnLeft() + 5) * CPR(),\r\n      (currentRowTop() + 0.5 * currentRowHeight()) * CPR()\r\n    );\r\n    ctx2d.lineTo(\r\n      leftOffset + currentColumnLeft() * CPR(),\r\n      (currentRowTop() + currentRowHeight() - topBottomOffset) * CPR()\r\n    );\r\n    ctx2d.fill();\r\n    ctx2d.restore();\r\n  }\r\n}\r\n\r\nfunction drawCellValue() {\r\n  const ctx2d = context2d();\r\n  const property = currentProperty();\r\n  const isHidden = !getRowStateAllowRead(tablePanelView(), recordId(), property.id);\r\n  const foregroundColor = getRowStateForegroundColor(tablePanelView(), recordId());\r\n  let isLoading = false;\r\n  if (property.isLookup && property.lookupEngine) {\r\n    isLoading = isCurrentCellLoading();\r\n  }\r\n\r\n  ctx2d.font = `${fontSize * CPR()}px \"IBM Plex Sans\", sans-serif`;\r\n  if (isHidden) {\r\n    return;\r\n  }\r\n  if (isLoading) {\r\n    ctx2d.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--background6');\r\n    ctx2d.fillText(\r\n      \"Loading...\",\r\n      CPR() * (currentColumnLeft() + getPaddingLeft()),\r\n      CPR() * (currentRowTop() + topTextOffset)\r\n    );\r\n  } else {\r\n    ctx2d.fillStyle = foregroundColor || \"black\";\r\n    currentDataCellRenderer(ctx2d).drawCellText();\r\n  }\r\n}\r\n\r\nfunction getBackGroundColor() {\r\n  const isColumnOrderChangeSource =\r\n    tablePanelView().columnOrderChangingSourceId === currentProperty().id;\r\n  const selectedRowId = getSelectedRowId(tablePanelView());\r\n\r\n  const isRowCursor = recordId() === selectedRowId;\r\n\r\n  const backgroundColor = getRowStateRowBgColor(tablePanelView(), recordId());\r\n\r\n  if (isColumnOrderChangeSource) {\r\n    return getComputedStyle(document.documentElement).getPropertyValue('--background3');\r\n  } else if (isRowCursor) {\r\n    return backgroundColor\r\n      ? shadeHexColor(backgroundColor, -0.1)!\r\n      : getComputedStyle(document.documentElement).getPropertyValue('--foreground5');\r\n  } else {\r\n    if (backgroundColor) {\r\n      return backgroundColor;\r\n    } else {\r\n      return rowIndex() % 2 === 1\r\n        ? getComputedStyle(document.documentElement).getPropertyValue('--background2')\r\n        : getComputedStyle(document.documentElement).getPropertyValue('--background1');\r\n    }\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbenchLifecycle } from \"model/selectors/getWorkbenchLifecycle\";\r\n\r\nexport function getShowToolTipsForMemoFieldsOnly(ctx: any) {\r\n  return getWorkbenchLifecycle(ctx).portalSettings?.showToolTipsForMemoFieldsOnly;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\"\r\n\r\nexport function hasSelectedRowId(ctx: any, id: string) {\r\n  return getDataView(ctx).hasSelectedRowId(id);\r\n}\r\n\r\nexport function setSelectedStateRowId(ctx: any) {\r\n  return function*toggleSelectedId(id: string, newState: boolean) {\r\n    getDataView(ctx).setSelectedState(id, newState);\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport {\r\n  context,\r\n  context2d,\r\n  currentDataRow,\r\n  dataView,\r\n  isCheckBoxedTable,\r\n  recordId,\r\n  rowId,\r\n  tablePanelView\r\n} from \"../renderingValues\";\r\nimport {\r\n  currentColumnLeft,\r\n  currentColumnLeftVisible,\r\n  currentColumnWidth,\r\n  currentColumnWidthVisible,\r\n  currentRowHeight,\r\n  currentRowTop,\r\n} from \"../currentCell\";\r\nimport {\r\n  applyScrollTranslation,\r\n  checkBoxCellPaddingLeft,\r\n  checkBoxCharacterFontSize,\r\n  drawSelectedRowBorder,\r\n  frontStripWidth,\r\n  topTextOffset\r\n} from \"./cellsCommon\";\r\nimport { CPR } from \"utils/canvas\";\r\nimport { onClick } from \"../onClick\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { getSelectionMember } from \"model/selectors/DataView/getSelectionMember\";\r\nimport { getDataSourceFieldByName } from \"model/selectors/DataSources/getDataSourceFieldByName\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { flow } from \"mobx\";\r\nimport { hasSelectedRowId, setSelectedStateRowId, } from \"model/actions-tree/selectionCheckboxes\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\n\r\nexport const selectionCheckBoxColumnWidth = 20;\r\n\r\nexport function selectionCheckboxCellsWidths() {\r\n  return isCheckBoxedTable() ? [selectionCheckBoxColumnWidth] : [];\r\n}\r\n\r\nexport function selectionCheckboxCellsDraws() {\r\n  return isCheckBoxedTable()\r\n    ? [\r\n      () => {\r\n        applyScrollTranslation();\r\n        drawSelectionCheckboxBackground();\r\n        const ctx2d = context2d();\r\n        ctx2d.fillStyle = \"black\";\r\n        ctx2d.font = `${CPR() * checkBoxCharacterFontSize}px \"Font Awesome 5 Free\"`;\r\n        const state = dataView().isSelected(rowId());\r\n        ctx2d.fillText(\r\n          state ? \"\\uf14a\" : \"\\uf0c8\",\r\n          CPR() * (currentColumnLeft() + checkBoxCellPaddingLeft),\r\n          CPR() * (currentRowTop() + topTextOffset)\r\n        );\r\n        registerClickHandler();\r\n      },\r\n    ]\r\n    : [];\r\n}\r\n\r\nfunction registerClickHandler() {\r\n  const ctx = context();\r\n  const row = currentDataRow();\r\n  onClick({\r\n    x: currentColumnLeftVisible(),\r\n    y: currentRowTop(),\r\n    w: currentColumnWidthVisible(),\r\n    h: currentRowHeight(),\r\n    handler(event: any) {\r\n      flow(function*() {\r\n        // TODO: Move to tablePanelView\r\n        let newSelectionState = false;\r\n        const dataTable = getDataTable(ctx);\r\n        const rowId = dataTable.getRowId(row);\r\n        const selectionMember = getSelectionMember(ctx);\r\n        if (!!selectionMember) {\r\n          const dataSourceField = getDataSourceFieldByName(ctx, selectionMember);\r\n          if (dataSourceField) {\r\n            newSelectionState = !dataTable.getCellValueByDataSourceField(row, dataSourceField);\r\n            dataTable.setDirtyValue(row, selectionMember, newSelectionState);\r\n            yield*getFormScreenLifecycle(ctx).onFlushData();\r\n            const updatedRow = dataTable.getRowById(rowId)!;\r\n            newSelectionState = dataTable.getCellValueByDataSourceField(updatedRow, dataSourceField);\r\n            yield*setSelectedStateRowId(ctx)(rowId, newSelectionState);\r\n          }\r\n        } else {\r\n          newSelectionState = !hasSelectedRowId(ctx, rowId);\r\n          yield*setSelectedStateRowId(ctx)(rowId, newSelectionState);\r\n        }\r\n      })();\r\n    },\r\n  });\r\n}\r\n\r\nexport function selectionCheckboxEmptyCellsWidths() {\r\n  return isCheckBoxedTable() ? [selectionCheckBoxColumnWidth] : [];\r\n}\r\n\r\nexport function selectionCheckboxEmptyCellsDraws() {\r\n  return isCheckBoxedTable()\r\n    ? [\r\n      () => {\r\n        applyScrollTranslation();\r\n        drawSelectionCheckboxBackground();\r\n      },\r\n    ]\r\n    : [];\r\n}\r\n\r\nexport function drawSelectionCheckboxBackground() {\r\n  const ctx2d = context2d();\r\n  const selectedRowId = getSelectedRowId(tablePanelView());\r\n  const isRowCursor = selectedRowId && recordId() === selectedRowId;\r\n  ctx2d.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--background1');\r\n  ctx2d.fillRect(\r\n    CPR() * currentColumnLeft(),\r\n    CPR() * currentRowTop(),\r\n    CPR() * currentColumnWidth(),\r\n    CPR() * currentRowHeight()\r\n  );\r\n  if (isRowCursor) {\r\n    drawSelectedRowBorder(frontStripWidth / 2);\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { context2d, currentRow, recordId, tableColumnIds, tablePanelView } from \"../renderingValues\";\r\nimport { applyScrollTranslation, clipCell, fontSize, numberCellPaddingRight, topTextOffset } from \"./cellsCommon\";\r\nimport { getRowStateAllowRead } from \"model/selectors/RowState/getRowStateAllowRead\";\r\nimport { currentColumnId, currentColumnLeft, currentColumnWidth, currentProperty, currentRowTop } from \"../currentCell\";\r\nimport { CPR } from \"utils/canvas\";\r\nimport { isGroupRow } from \"../rowCells/groupRowCells\";\r\nimport { IGroupRow } from \"../types\";\r\nimport { dataColumnsWidths } from \"./dataCell\";\r\nimport { aggregationToString } from \"model/entities/Aggregatioins\";\r\n\r\n\r\nexport function aggregationColumnsWidths() {\r\n  return dataColumnsWidths();\r\n}\r\n\r\nexport function aggregationCellDraws() {\r\n  const row = currentRow();\r\n  if (isGroupRow(row)) {\r\n    return tableColumnIds().map((id) => () => drawAggregationCell());\r\n  } else return [];\r\n}\r\n\r\nexport function drawAggregationCell() {\r\n  applyScrollTranslation();\r\n  clipCell();\r\n  drawAggregationText();\r\n}\r\n\r\nfunction drawAggregationText() {\r\n  const ctx2d = context2d();\r\n  if (!currentColumnId()) return;\r\n  const isHidden = !getRowStateAllowRead(tablePanelView(), recordId(), currentProperty().id)\r\n\r\n  const row = currentRow();\r\n  if (isHidden || !isGroupRow(row)) {\r\n    return;\r\n  }\r\n  const groupRow = row as IGroupRow;\r\n  if (!groupRow.sourceGroup.aggregations) {\r\n    return;\r\n  }\r\n  const aggregation = groupRow.sourceGroup.aggregations\r\n    .find(aggregation => aggregation.columnId === currentProperty().id)\r\n  if (!aggregation) {\r\n    return;\r\n  }\r\n\r\n  ctx2d.font = `${fontSize * CPR()}px \"IBM Plex Sans\", sans-serif`;\r\n  ctx2d.fillStyle = \"black\";\r\n  ctx2d.textAlign = \"right\";\r\n  ctx2d.fillText(\r\n    aggregationToString(aggregation, currentProperty()),\r\n    CPR() * (currentColumnLeft() + currentColumnWidth() - numberCellPaddingRight),\r\n    CPR() * (currentRowTop() + topTextOffset));\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IGroupRow, ITableRow } from \"../types\";\r\nimport { selectionCheckboxEmptyCellsDraws, selectionCheckboxEmptyCellsWidths, } from \"../cells/selectionCheckboxCell\";\r\nimport { groupRowContentCellsDraws, groupRowContentCellsWidths, groupRowEmptyCellsWidths } from \"../cells/groupCell\";\r\nimport { currentRow } from \"../renderingValues\";\r\nimport { aggregationCellDraws, aggregationColumnsWidths } from \"../cells/aggregationCell\";\r\n\r\nexport function groupRowCellsWidths() {\r\n  return [\r\n    [...selectionCheckboxEmptyCellsWidths(), ...groupRowContentCellsWidths()],\r\n    [...selectionCheckboxEmptyCellsWidths(), ...groupRowEmptyCellsWidths(), ...aggregationColumnsWidths()]\r\n  ];\r\n}\r\n\r\nexport function groupRowCellsDraws() {\r\n  return [\r\n    [...selectionCheckboxEmptyCellsDraws(), ...groupRowContentCellsDraws()],\r\n    [...selectionCheckboxEmptyCellsDraws().map(x => () => {\r\n    }), ...aggregationCellDraws()]\r\n  ];\r\n}\r\n\r\nexport function isGroupRow(row: ITableRow): row is IGroupRow {\r\n  return (row as any).groupLevel !== undefined;\r\n}\r\n\r\nexport function isCurrentGroupRow() {\r\n  return isGroupRow(currentRow());\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { getGrouper } from \"model/selectors/DataView/getGrouper\";\r\nimport { IGroupRow } from \"gui/Components/ScreenElements/Table/TableRendering/types\";\r\n\r\nexport function onGroupHeaderToggleClick(ctx: any) {\r\n  return flow(function*onGroupHeaderToggleClick(\r\n    event: any,\r\n    groupHeader: IGroupRow\r\n  ) {\r\n    yield*getGrouper(ctx).loadChildren(groupHeader.sourceGroup);\r\n  });\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport {\r\n  context,\r\n  context2d,\r\n  currentRow,\r\n  gridLeadCellDimensions,\r\n  groupingColumnCount,\r\n  groupingColumnIds,\r\n  isCheckBoxedTable,\r\n  recordId,\r\n  tablePanelView,\r\n  worldWidth,\r\n} from \"../renderingValues\";\r\nimport { currentColumnLeft, currentColumnWidth, currentRowHeight, currentRowTop, } from \"../currentCell\";\r\nimport { IGroupRow, IGroupTreeNode } from \"../types\";\r\nimport { applyScrollTranslation, cellPaddingLeft, fontSize, selectRowBorderWidth, topTextOffset } from \"./cellsCommon\";\r\nimport { isGroupRow } from \"../rowCells/groupRowCells\";\r\nimport { onClick } from \"../onClick\";\r\nimport { CPR } from \"utils/canvas\";\r\nimport { onGroupHeaderToggleClick } from \"model/actions-ui/DataView/TableView/onGroupHeaderToggleClick\";\r\nimport { flow } from \"mobx\";\r\nimport { isInfiniteScrollingActive } from \"model/selectors/isInfiniteScrollingActive\";\r\nimport { getGrouper } from \"model/selectors/DataView/getGrouper\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { getSelectedRowId } from \"../../../../../../model/selectors/TablePanelView/getSelectedRowId\";\r\n\r\nconst groupCellWidth = 20;\r\nconst expandSymbolFontSize = 15;\r\n\r\nexport function groupRowEmptyCellsWidths() {\r\n  return groupingColumnIds().map(() => groupCellWidth);\r\n}\r\n\r\nexport function groupRowEmptyCellsDraws() {\r\n  return groupingColumnIds().map((id) => () => {\r\n    drawEmptyGroupCell();\r\n  });\r\n}\r\n\r\nexport function groupRowContentCellsWidths() {\r\n  const row = currentRow();\r\n  if (isGroupRow(row)) {\r\n    const grpCnt = groupingColumnCount();\r\n    const result: number[] = [];\r\n    for (let i = 0; i < grpCnt; i++) {\r\n      if (i < row.groupLevel) result.push(groupCellWidth);\r\n      else {\r\n        result.push(worldWidth() - gridLeadCellDimensions()[i].left);\r\n        break;\r\n      }\r\n    }\r\n    return result;\r\n  } else return [];\r\n}\r\n\r\nexport function groupRowContentCellsDraws() {\r\n  const row = currentRow();\r\n  if (isGroupRow(row)) {\r\n    const grpCnt = groupingColumnCount();\r\n    const result: (() => void)[] = [];\r\n    for (let i = 0; i < grpCnt; i++) {\r\n      if (i < row.groupLevel) result.push(drawEmptyGroupCell);\r\n      else {\r\n        result.push(drawGroupCell);\r\n        break;\r\n      }\r\n    }\r\n    return result;\r\n  } else return [];\r\n}\r\n\r\nexport function drawEmptyGroupCell() {\r\n  applyScrollTranslation();\r\n  // clipCell();\r\n  drawEmptyGroupCellBackground();\r\n}\r\n\r\nexport function drawGroupCell() {\r\n  applyScrollTranslation();\r\n  drawGroupCellBackground();\r\n\r\n  const ctx2d = context2d();\r\n  const row = currentRow();\r\n  if (isGroupRow(row)) {\r\n    const groupRow = row as IGroupRow;\r\n    ctx2d.fillStyle = \"black\";\r\n    ctx2d.font = `${CPR() * expandSymbolFontSize}px \"Font Awesome 5 Free\"`;\r\n    const state = row.isExpanded;\r\n    ctx2d.fillText(\r\n      state ? \"\\uf146\" : \"\\uf0fe\",\r\n      CPR() * (currentColumnLeft() + 6),\r\n      CPR() * (currentRowTop() + topTextOffset + 1)\r\n    );\r\n    ctx2d.font = `${CPR() * fontSize}px \"IBM Plex Sans\", Arial, sans-serif`;\r\n    ctx2d.fillText(\r\n      `${row.columnLabel} : ${formatColumnValue(row.columnValue)} [${row.sourceGroup.rowCount}]`,\r\n      CPR() * (currentColumnLeft() + cellPaddingLeft + groupCellWidth),\r\n      CPR() * (currentRowTop() + topTextOffset)\r\n    );\r\n\r\n    const ctx = context();\r\n    onClick({\r\n      x: currentColumnLeft(),\r\n      y: currentRowTop(),\r\n      w: groupCellWidth,\r\n      h: 20,\r\n      handler(event: any) {\r\n        flow(function*() {\r\n          if (!row.sourceGroup.isExpanded && row.sourceGroup.childGroups.length === 0) {\r\n            yield onGroupHeaderToggleClick(ctx)(event, groupRow);\r\n          }\r\n          const allGroups = getGrouper(ctx).allGroups;\r\n          if (shouldCloseOtherGroups(row.sourceGroup, allGroups, ctx)) {\r\n            const groupsToKeepOpen = [row.sourceGroup, ...row.sourceGroup.allParents]\r\n            allGroups\r\n              .filter(group => !groupsToKeepOpen.includes(group) && group.isExpanded)\r\n              .forEach(group => group.isExpanded = false);\r\n          }\r\n          row.sourceGroup.isExpanded = !row.sourceGroup.isExpanded;\r\n\r\n          unselectRowIfInClosedGroup(ctx, row);\r\n        })();\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\nfunction unselectRowIfInClosedGroup(ctx: any, row: IGroupRow) {\r\n  const dataView = getDataView(ctx);\r\n  if (!row.sourceGroup.isExpanded && dataView.selectedRowId) {\r\n    const containsSelectedRow = !!row.sourceGroup.getRowById(dataView.selectedRowId);\r\n    if (containsSelectedRow) {\r\n      dataView.selectedRowId = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nfunction shouldCloseOtherGroups(sourceGroup: IGroupTreeNode, allGroups: IGroupTreeNode[], ctx: any) {\r\n  const otherGroups = Array.from(allGroups).remove(sourceGroup);\r\n  return isInfiniteScrollingActive(ctx, undefined)\r\n    && otherGroups.some(group => group.isInfinitelyScrolled);\r\n}\r\n\r\nfunction formatColumnValue(value: string) {\r\n  if (value === undefined || value === null) {\r\n    return \"<empty>\";\r\n  } else {\r\n    return value\r\n  }\r\n}\r\n\r\nexport function drawGroupCellBackground() {\r\n  const ctx2d = context2d();\r\n  ctx2d.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--background4');\r\n  ctx2d.fillRect(\r\n    CPR() * currentColumnLeft(),\r\n    CPR() * currentRowTop(),\r\n    CPR() * currentColumnWidth(),\r\n    CPR() * currentRowHeight()\r\n  );\r\n}\r\n\r\nexport function drawEmptyGroupCellBackground() {\r\n  const ctx2d = context2d();\r\n  ctx2d.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--background1');\r\n  ctx2d.fillRect(\r\n    CPR() * currentColumnLeft(),\r\n    CPR() * currentRowTop(),\r\n    CPR() * currentColumnWidth(),\r\n    CPR() * currentRowHeight()\r\n  );\r\n  const selectedRowId = getSelectedRowId(tablePanelView());\r\n  const isSelected = recordId() === selectedRowId;\r\n\r\n  if (isSelected && isCheckBoxedTable()) {\r\n    drawSelectedRowBorder();\r\n  }\r\n}\r\n\r\nfunction drawSelectedRowBorder() {\r\n  const ctx2d = context2d();\r\n  ctx2d.beginPath();\r\n  ctx2d.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--foreground1');\r\n  ctx2d.lineWidth = selectRowBorderWidth * CPR();\r\n  ctx2d.moveTo(CPR() * currentColumnLeft(), CPR() * (currentRowTop() + 1.5));\r\n  ctx2d.lineTo(\r\n    CPR() * currentColumnLeft() + CPR() * currentColumnWidth(),\r\n    CPR() * (currentRowTop() + 1.5)\r\n  );\r\n  ctx2d.moveTo(CPR() * currentColumnLeft(), CPR() * (currentRowTop() + currentRowHeight() - 1.5));\r\n  ctx2d.lineTo(\r\n    CPR() * currentColumnLeft() + CPR() * currentColumnWidth(),\r\n    CPR() * (currentRowTop() + currentRowHeight() - 1.5)\r\n  );\r\n  ctx2d.stroke();\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { dataColumnsDraws, dataColumnsWidths } from \"../cells/dataCell\";\r\nimport { groupRowEmptyCellsDraws, groupRowEmptyCellsWidths } from \"../cells/groupCell\";\r\nimport { selectionCheckboxCellsDraws, selectionCheckboxCellsWidths } from \"../cells/selectionCheckboxCell\";\r\nimport { Memoized } from \"../common/Memoized\";\r\nimport { currentRow, scRenderRow, scRenderTable, tableColumnIds } from \"../renderingValues\";\r\nimport { ITableRow } from \"../types\";\r\n\r\n\r\nexport const dataRowCellsWidths = Memoized(() => {\r\n  return [\r\n    ...selectionCheckboxCellsWidths(),\r\n    ...groupRowEmptyCellsWidths(),\r\n    ...dataColumnsWidths()\r\n  ]\r\n})\r\nscRenderRow.push(dataRowCellsWidths.clear);\r\n\r\nexport const dataRowCellsDraws = Memoized(() => {\r\n  return [\r\n    ...selectionCheckboxCellsDraws(),\r\n    ...groupRowEmptyCellsDraws(),\r\n    ...dataColumnsDraws()\r\n  ]\r\n});\r\nscRenderRow.push(dataRowCellsDraws.clear);\r\n\r\nexport const dataRowColumnIds = Memoized(() => {\r\n  return [\r\n    ...selectionCheckboxCellsDraws().map(item => null),\r\n    ...groupRowEmptyCellsDraws().map(item => null),\r\n    ...tableColumnIds()\r\n  ]\r\n})\r\nscRenderTable.push(dataRowColumnIds.clear);\r\n\r\nexport function isDataRow(row: ITableRow): row is any[] {\r\n  return Array.isArray(row);\r\n}\r\n\r\nexport function isCurrentDataRow() {\r\n  return isDataRow(currentRow())\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { isCurrentGroupRow } from \"./rowCells/groupRowCells\";\r\n\r\nexport function cellLayerCount() {\r\n  return isCurrentGroupRow() ? 2 : 1;\r\n}\r\n\r\nlet _currentCellLayerIndex = 0;\r\n\r\nexport function setLayerIndex(layerIndex: number) {\r\n  _currentCellLayerIndex = layerIndex;\r\n}\r\n\r\nexport function currentCellLayerIndex() {\r\n  return _currentCellLayerIndex;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Memoized } from \"./common/Memoized\";\r\nimport { isCheckBoxedTable, scRenderRow, scrollLeft } from \"./renderingValues\";\r\nimport { dataRowCellsDraws, dataRowCellsWidths, isCurrentDataRow } from \"./rowCells/dataRowCells\";\r\nimport { groupRowCellsDraws, groupRowCellsWidths, isCurrentGroupRow, } from \"./rowCells/groupRowCells\";\r\nimport { currentCellLayerIndex } from \"./currentCellLayerIndex\";\r\n\r\nfunction computeDimensions(cellWidths: number[]) {\r\n  const result: { left: number; width: number; right: number; leftVisible: number; widthVisible: number; }[] = [];\r\n\r\n  let acc = 0;\r\n  for (let i = 0; i < cellWidths.length; i++) {\r\n    const left = acc;\r\n    const width = cellWidths[i];\r\n    let leftVisible = left;\r\n    let widthVisible = width;\r\n    if (isCheckBoxedTable() && scrollLeft() > left) {\r\n      if (i > 0) {\r\n        const fixedColumnWidth = cellWidths[0]\r\n        leftVisible = scrollLeft() + fixedColumnWidth\r\n        widthVisible = width - (leftVisible - left)\r\n      } else if (i === 0) {\r\n        leftVisible = scrollLeft()\r\n      }\r\n    }\r\n    acc = acc + width;\r\n    const right = acc;\r\n    result.push({left, width, right, leftVisible, widthVisible});\r\n  }\r\n  return result;\r\n}\r\n\r\nexport const currentRowCellsDimensions = Memoized(() => {\r\n  if (isCurrentDataRow()) {\r\n    return computeDimensions(dataRowCellsWidths());\r\n  } else if (isCurrentGroupRow()) {\r\n    return computeDimensions(groupRowCellsWidths()[currentCellLayerIndex()]);\r\n  } else {\r\n    return [];\r\n  }\r\n});\r\nscRenderRow.push(() => currentRowCellsDimensions.clear());\r\n\r\nexport const currentRowCellsDraws = Memoized(() => {\r\n  if (isCurrentDataRow()) {\r\n    return dataRowCellsDraws();\r\n  } else if (isCurrentGroupRow()) {\r\n    return groupRowCellsDraws()[currentCellLayerIndex()];\r\n  } else {\r\n    return [];\r\n  }\r\n});\r\nscRenderRow.push(currentRowCellsDraws.clear);\r\n\r\nexport function currentRowCellsCount() {\r\n  return currentRowCellsDraws().length;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFieldErrorMessage } from \"model/selectors/DataView/getFieldErrorMessage\";\r\nimport { Memoized } from \"./common/Memoized\";\r\nimport { currentRowCellsDimensions, currentRowCellsDraws } from \"./currentRowCells\";\r\nimport { stripHtml } from \"string-strip-html\";\r\nimport {\r\n  currentDataRow,\r\n  currentRow,\r\n  dataTable,\r\n  drawingColumnIndex,\r\n  gridLeadCellDimensions,\r\n  propertyById,\r\n  realFixedColumnCount,\r\n  rowHeight,\r\n  rowIndex,\r\n  scRenderCell,\r\n} from \"./renderingValues\";\r\nimport { dataRowColumnIds } from \"./rowCells/dataRowCells\";\r\n\r\nexport function drawCurrentCell() {\r\n  const colIdx = drawingColumnIndex();\r\n  const cellDraws = currentRowCellsDraws();\r\n  if (colIdx >= cellDraws.length) return;\r\n  currentRowCellsDraws()[drawingColumnIndex()]();\r\n}\r\n\r\nexport function currentColumnLeft() {\r\n  return currentRowCellsDimensions()[drawingColumnIndex()].left;\r\n}\r\n\r\nexport function currentColumnLeftVisible() {\r\n  return currentRowCellsDimensions()[drawingColumnIndex()].leftVisible;\r\n}\r\n\r\nexport function currentColumnWidthVisible() {\r\n  return currentRowCellsDimensions()[drawingColumnIndex()].widthVisible;\r\n}\r\n\r\nexport function currentColumnWidth() {\r\n  return currentRowCellsDimensions()[drawingColumnIndex()].width;\r\n}\r\n\r\nexport function currentColumnRight() {\r\n  return currentRowCellsDimensions()[drawingColumnIndex()].right;\r\n}\r\n\r\nexport function currentRowTop() {\r\n  return rowIndex() * rowHeight();\r\n}\r\n\r\nexport function currentRowHeight() {\r\n  return rowHeight();\r\n}\r\n\r\nexport function currentRowBottom() {\r\n  return currentRowTop() + currentRowHeight();\r\n}\r\n\r\nexport function isCurrentCellFixed() {\r\n  return drawingColumnIndex() < realFixedColumnCount();\r\n}\r\n\r\nexport function currentGridLeadCellLeft() {\r\n  return gridLeadCellDimensions()[drawingColumnIndex()].left;\r\n}\r\n\r\nexport function currentGridLeadCellWidth() {\r\n  return gridLeadCellDimensions()[drawingColumnIndex()].width;\r\n}\r\n\r\nexport function currentGridLeadCellRight() {\r\n  return gridLeadCellDimensions()[drawingColumnIndex()].right;\r\n}\r\n\r\nexport function currentColumnId() {\r\n  return dataRowColumnIds()[drawingColumnIndex()];\r\n}\r\n\r\nexport const currentProperty = () => {\r\n  const property = propertyById().get(currentColumnId() as any)!;\r\n  if (property.column === \"Polymorph\") {\r\n    return property.getPolymophicProperty(currentRow() as any[]);\r\n  } else {\r\n    return property;\r\n  }\r\n};\r\n\r\nexport const currentCellText = Memoized(() => {\r\n  const value = currentCellValue();\r\n  let text = dataTable().resolveCellText(currentProperty(), value);\r\n  if (text && currentProperty().multiline) {\r\n    text = stripHtml(text).result;\r\n  }\r\n  if (Array.isArray(text)) {\r\n    text = text.join(\", \");\r\n  }\r\n  return text;\r\n});\r\nscRenderCell.push(() => currentCellText.clear());\r\n\r\nexport const currentCellTextMultiline = Memoized(() => {\r\n  const value = currentCellValue();\r\n  let text = dataTable().resolveCellText(currentProperty(), value);\r\n  if (text && currentProperty().multiline) {\r\n    text = text.split(\"\\n\");\r\n  }\r\n  return text;\r\n});\r\nscRenderCell.push(() => currentCellTextMultiline.clear());\r\n\r\nexport const currentCellValue = Memoized(() => {\r\n  const property = propertyById().get(currentColumnId() as any)!\r\n  if (property.column === \"Polymorph\") {\r\n    const polymorphicProperty = currentProperty();\r\n    return dataTable().getCellValue(currentDataRow(), polymorphicProperty);\r\n  } else {\r\n    return dataTable().getCellValue(currentDataRow(), property);\r\n  }\r\n});\r\nscRenderCell.push(() => currentCellValue.clear());\r\n\r\nexport const currentCellErrorMessage = Memoized(() => {\r\n  return getFieldErrorMessage(currentProperty())(currentDataRow(), currentProperty());\r\n});\r\nscRenderCell.push(() => currentCellErrorMessage.clear());\r\n\r\nexport const isCurrentCellLoading = Memoized(() => {\r\n  const value = dataTable().isCellTextResolving(currentProperty(), currentCellValue());\r\n  return value;\r\n});\r\nscRenderCell.push(() => isCurrentCellLoading.clear());\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport {\r\n  context2d,\r\n  dataCellOffset,\r\n  drawingColumnIndex,\r\n  getCurrentRowRightBorderDrawn,\r\n  scrollLeft,\r\n  scrollTop,\r\n  selectionColumnShown,\r\n  setCurrentRowRightBorderDrawn,\r\n} from \"../renderingValues\";\r\nimport {\r\n  currentColumnLeft,\r\n  currentColumnRight,\r\n  currentColumnWidth,\r\n  currentRowHeight,\r\n  currentRowTop,\r\n  isCurrentCellFixed,\r\n} from \"../currentCell\";\r\nimport { CPR } from \"utils/canvas\";\r\nimport { getPaddingLeft, getPaddingRight } from \"./dataCellRenderer\";\r\n\r\nexport function applyScrollTranslation() {\r\n  const ctx2d = context2d();\r\n  ctx2d.translate(!isCurrentCellFixed() ? -CPR() * scrollLeft() : 0, -CPR() * scrollTop());\r\n}\r\n\r\nexport function clipCell() {\r\n  const ctx2d = context2d();\r\n  ctx2d.beginPath();\r\n  ctx2d.rect(\r\n    CPR() * (currentColumnLeft() + getPaddingLeft()),\r\n    CPR() * currentRowTop(),\r\n    CPR() * (currentColumnWidth() - getPaddingLeft() - getPaddingRight()),\r\n    CPR() * currentRowHeight()\r\n  );\r\n  ctx2d.clip();\r\n}\r\n\r\nexport function drawSelectedRowBorder(frontStripeWidth: number) {\r\n  const ctx2d = context2d();\r\n  ctx2d.beginPath();\r\n  ctx2d.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--foreground1');\r\n  ctx2d.lineWidth = selectRowBorderWidth * CPR();\r\n  ctx2d.moveTo(CPR() * currentColumnLeft(), CPR() * (currentRowTop() + 1.5));\r\n  ctx2d.lineTo(\r\n    CPR() * currentColumnLeft() + CPR() * currentColumnWidth(),\r\n    CPR() * (currentRowTop() + 1.5)\r\n  );\r\n  ctx2d.moveTo(CPR() * currentColumnLeft(), CPR() * (currentRowTop() + currentRowHeight() - 1.5));\r\n  ctx2d.lineTo(\r\n    CPR() * currentColumnLeft() + CPR() * currentColumnWidth(),\r\n    CPR() * (currentRowTop() + currentRowHeight() - 1.5)\r\n  );\r\n  ctx2d.stroke();\r\n\r\n  const currentIsTheLeftMostDataColumn = drawingColumnIndex() === dataCellOffset();\r\n\r\n  if (currentIsTheLeftMostDataColumn && !selectionColumnShown()) {\r\n    ctx2d.beginPath();\r\n    ctx2d.lineWidth = frontStripeWidth * CPR();\r\n    ctx2d.moveTo(CPR() * currentColumnLeft(), CPR() * (currentRowTop() + 1.5));\r\n    ctx2d.lineTo(CPR() * currentColumnLeft(), CPR() * (currentRowTop() + currentRowHeight() - 1.5));\r\n    ctx2d.stroke();\r\n  }\r\n  if (!getCurrentRowRightBorderDrawn()) {\r\n    ctx2d.beginPath();\r\n    ctx2d.lineWidth = selectRowBorderWidth * CPR();\r\n    ctx2d.moveTo(CPR() * currentColumnRight(), CPR() * (currentRowTop() + 1.5));\r\n    ctx2d.lineTo(CPR() * currentColumnRight(), CPR() * (currentRowTop() + currentRowHeight() - 1.5));\r\n    ctx2d.stroke();\r\n    setCurrentRowRightBorderDrawn(true);\r\n  }\r\n}\r\n\r\nexport const numberCellPaddingRight = 15;\r\nexport const cellPaddingLeft = 6;\r\nexport const cellPaddingRight = 6;\r\nexport const cellPaddingLeftFirstCell = 25;\r\nexport const cellPaddingRightFirstCell = 25;\r\nexport const topTextOffset = 17;\r\nexport const fontSize = 12;\r\nexport const checkBoxCellPaddingLeft = 5;\r\nexport const checkBoxCharacterFontSize = 12;\r\nexport const rowHeight = 25;\r\nexport const frontStripWidth = 8;\r\nexport const selectRowBorderWidth = 1;\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport S from \"gui/Components/Dialogs/ColumnsDialog.module.scss\";\r\nimport React from \"react\";\r\nimport { CloseButton } from \"@origam/components\";\r\nimport { AutoSizer, MultiGrid } from \"react-virtualized\";\r\nimport { bind } from \"bind-decorator\";\r\nimport { observable } from \"mobx\";\r\nimport { observer, Observer } from \"mobx-react\";\r\nimport { T } from \"utils/translation\";\r\nimport { rowHeight } from \"gui/Components/ScreenElements/Table/TableRendering/cells/cellsCommon\";\r\nimport { ITableConfiguration } from \"model/entities/TablePanelView/types/IConfigurationManager\";\r\nimport {\r\n  aggregationOptions,\r\n  ColumnConfigurationModel,\r\n  IColumnOptions, timeunitOptions\r\n} from \"model/entities/TablePanelView/ColumnConfigurationModel\";\r\nimport { SimpleDropdown } from \"@origam/components\";\r\nimport { ModalDialog } from \"gui/Components/Dialog/ModalDialog\";\r\n\r\n@observer\r\nexport class ColumnsDialog extends React.Component<{\r\n  model: ColumnConfigurationModel;\r\n}> {\r\n\r\n  columnOptions: Map<string, IColumnOptions>;\r\n  configuration: ITableConfiguration;\r\n\r\n  constructor(props: any) {\r\n    super(props);\r\n    this.configuration = this.props.model.columnsConfiguration;\r\n    this.columnOptions = this.props.model.columnOptions;\r\n  }\r\n\r\n  @observable columnWidths = [70, 220, 110, 150, 90];\r\n\r\n  refGrid = React.createRef<MultiGrid>();\r\n\r\n  render() {\r\n    return (\r\n      <ModalDialog\r\n        title={T(\"Columns\", \"column_config_title\")}\r\n        titleButtons={<CloseButton onClick={this.props.model.onColumnConfCancel}/>}\r\n        buttonsCenter={\r\n          <>\r\n            <button\r\n              id={\"columnConfigOk\"}\r\n              tabIndex={0}\r\n              onClick={(event: any) =>\r\n                this.props.model?.onColumnConfigurationSubmit()\r\n              }\r\n            >\r\n              {T(\"OK\", \"button_ok\")}\r\n            </button>\r\n            <button onClick={() => this.props.model.onSaveAsClick()}>\r\n              {T(\"Save As...\", \"column_config_save_as\")}\r\n            </button>\r\n            <button tabIndex={0} onClick={this.props.model.onColumnConfCancel}>\r\n              {T(\"Cancel\", \"button_cancel\")}\r\n            </button>\r\n          </>\r\n        }\r\n        buttonsLeft={null}\r\n        buttonsRight={null}\r\n      >\r\n        <div className={S.columnTable}>\r\n          <AutoSizer>\r\n            {({width, height}) => (\r\n              <Observer>\r\n                {() => (\r\n                  <MultiGrid\r\n                    ref={this.refGrid}\r\n                    fixedRowCount={1}\r\n                    cellRenderer={this.renderCell}\r\n                    columnCount={5}\r\n                    rowCount={1 + this.props.model.sortedColumnConfigs.length}\r\n                    columnWidth={({ index }: { index: number }) => {\r\n                      return this.columnWidths[index];\r\n                    }}\r\n                    rowHeight={rowHeight}\r\n                    width={width}\r\n                    height={height}\r\n                  />\r\n                )}\r\n              </Observer>\r\n            )}\r\n          </AutoSizer>\r\n        </div>\r\n        <div className={S.lockedColumns}>\r\n          {T(\"Locked columns count\", \"column_config_locked_columns_count\")}\r\n          <input\r\n            className={S.lockedColumnsInput}\r\n            type=\"number\"\r\n            min={0}\r\n            value={\"\" + this.configuration.fixedColumnCount}\r\n            onChange={this.props.model.handleFixedColumnsCountChange}\r\n          />\r\n        </div>\r\n      </ModalDialog>\r\n    );\r\n  }\r\n\r\n  getCell(rowIndex: number, columnIndex: number) {\r\n    const {\r\n      isVisible,\r\n      propertyId,\r\n      aggregationType,\r\n      groupingIndex,\r\n      timeGroupingUnit,\r\n    } = this.props.model.sortedColumnConfigs[rowIndex];\r\n\r\n    const { name, entity, canGroup, canAggregate, modelInstanceId } = this.columnOptions.get(propertyId)!;\r\n\r\n    const selectedAggregationOption = aggregationOptions.find(option => option.value === aggregationType)!;\r\n\r\n    const selectedTimeUnitOption = timeunitOptions.find(option => option.value === timeGroupingUnit)!;\r\n\r\n    switch (columnIndex) {\r\n      case 0:\r\n        return (\r\n          <input\r\n            type=\"checkbox\"\r\n            key={`${rowIndex}@${columnIndex}`}\r\n            onChange={(event: any) => this.props.model.setVisible(rowIndex, event.target.checked)}\r\n            checked={isVisible}\r\n          />\r\n        );\r\n      case 1:\r\n        return name;\r\n      case 2:\r\n        return (\r\n          <label id={\"group_index_\" + modelInstanceId} className={S.checkBox}>\r\n            <input\r\n              id={\"group_by_\" + modelInstanceId}\r\n              type=\"checkbox\"\r\n              key={`${rowIndex}@${columnIndex}`}\r\n              checked={groupingIndex > 0}\r\n              onChange={(event: any) => this.props.model.setGrouping(rowIndex, event.target.checked, entity)}\r\n              disabled={!canGroup}\r\n            />\r\n            <div>\r\n              {groupingIndex > 0 ? groupingIndex : \"\"}\r\n            </div>\r\n          </label>\r\n        );\r\n      case 3:\r\n        if (groupingIndex > 0 && entity === \"Date\") {\r\n          return (\r\n              <SimpleDropdown\r\n                options={timeunitOptions}\r\n                selectedOption={selectedTimeUnitOption}\r\n                onOptionClick={option =>  this.props.model.setTimeGroupingUnit(rowIndex, option.value)}\r\n                className={S.dropdown}\r\n              />\r\n          );\r\n        } else {\r\n          return \"\";\r\n        }\r\n      case 4:\r\n        if (\r\n          (entity === \"Currency\" ||\r\n            entity === \"Integer\" ||\r\n            entity === \"Float\" ||\r\n            entity === \"Long\") &&\r\n          canAggregate\r\n        ) {\r\n          return (\r\n            <SimpleDropdown\r\n              options={aggregationOptions}\r\n              selectedOption={selectedAggregationOption}\r\n              onOptionClick={option => this.props.model.setAggregation(rowIndex, option.value)}\r\n              className={S.dropdown}\r\n            />\r\n          );\r\n        } else {\r\n          return \"\";\r\n        }\r\n      default:\r\n        return \"\";\r\n    }\r\n  }\r\n\r\n  getCellClass(columnIndex: number){\r\n    let cellClass = S.columnTableCell\r\n    if(columnIndex === 0 || columnIndex === 2){\r\n      cellClass += \" \" + S.checkBoxCell\r\n    }\r\n    return cellClass;\r\n  }\r\n\r\n  @bind renderCell(args: {\r\n    columnIndex: number;\r\n    rowIndex: number;\r\n    style: any;\r\n    key: any;\r\n  }): React.ReactNode {\r\n    const Obsv = Observer as any;\r\n    if (args.rowIndex > 0) {\r\n      const rowClassName = args.rowIndex % 2 === 0 ? \"even\" : \"odd\";\r\n      return (\r\n        <Obsv style={args.style} key={args.key}>\r\n          {() => (\r\n            <div style={args.style} className={this.getCellClass(args.columnIndex) + \" \" + rowClassName}>\r\n              {this.getCell(args.rowIndex - 1, args.columnIndex)}\r\n            </div>\r\n          )}\r\n        </Obsv>\r\n      );\r\n    } else {\r\n      return (\r\n        <Obsv style={args.style} key={args.key}>\r\n          {() => (\r\n            <TableHeader\r\n              columnIndex={args.columnIndex}\r\n              style={args.style}\r\n              columnWidth={this.columnWidths[args.columnIndex]}\r\n            />\r\n          )}\r\n        </Obsv>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\n@observer\r\nexport class TableHeader extends React.Component<{\r\n  columnIndex: number;\r\n  columnWidth: number;\r\n  style: any;\r\n}> {\r\n  getHeader(columnIndex: number) {\r\n    switch (columnIndex) {\r\n      case 0:\r\n        return T(\"Visible\", \"column_config_visible\");\r\n      case 1:\r\n        return T(\"Name\", \"column_config_name\");\r\n      case 2:\r\n        return T(\"GroupBy\", \"column_config_group_by\");\r\n      case 3:\r\n        return T(\"Grouping Unit\", \"column_config_time_grouping_unit\");\r\n      case 4:\r\n        return T(\"Aggregation\", \"column_config_aggregation\");\r\n      default:\r\n        return \"?\";\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div style={this.props.style} className={S.columnTableCell + \" header\"}>\r\n        {this.getHeader(this.props.columnIndex)}\r\n        {this.props.columnIndex !== 4 && <div className={S.columnWidthHandle}/>}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { getDataView } from \"../../selectors/DataView/getDataView\";\r\nimport { getGridId } from \"../../selectors/DataView/getGridId\";\r\nimport { getEntity } from \"../../selectors/DataView/getEntity\";\r\nimport { getFormScreenLifecycle } from \"../../selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { handleError } from \"../../actions/handleError\";\r\nimport { shouldProceedToChangeRow } from \"./TableView/shouldProceedToChangeRow\";\r\n\r\nexport function onCopyRowClick(ctx: any, switchToFormPerspective?: boolean) {\r\n  return flow(function*onCopyRowClick(event: any) {\r\n    try {\r\n      const selectedRowId = getDataView(ctx).selectedRowId;\r\n      if (!selectedRowId) {\r\n        return;\r\n      }\r\n      const gridId = getGridId(ctx);\r\n      const entity = getEntity(ctx);\r\n      const formScreenLifecycle = getFormScreenLifecycle(ctx);\r\n      const dataView = getDataView(ctx);\r\n      if (!(yield shouldProceedToChangeRow(dataView))) {\r\n        return;\r\n      }\r\n      if(switchToFormPerspective){\r\n        dataView.activateFormView?.({saveNewState: false});\r\n      }\r\n      yield*formScreenLifecycle.onCopyRow(entity, gridId, selectedRowId);\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getGridId } from \"model/selectors/DataView/getGridId\";\r\nimport { getEntity } from \"model/selectors/DataView/getEntity\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { shouldProceedToChangeRow } from \"./TableView/shouldProceedToChangeRow\";\r\n\r\nexport function onCreateRowClick(ctx: any, switchToFormPerspective?: boolean) {\r\n  return flow(function*onCreateRowClick(event: any) {\r\n    try {\r\n      const gridId = getGridId(ctx);\r\n      const entity = getEntity(ctx);\r\n      const formScreenLifecycle = getFormScreenLifecycle(ctx);\r\n      const dataView = getDataView(ctx);\r\n      if (!(yield shouldProceedToChangeRow(dataView))) {\r\n        return;\r\n      }\r\n      if(switchToFormPerspective){\r\n        dataView.activateFormView?.({saveNewState: false});\r\n      }\r\n      yield*formScreenLifecycle.onCreateRow(entity, gridId);\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getTablePanelView } from \"../../selectors/TablePanelView/getTablePanelView\";\r\n\r\nexport function onDeleteRowClick(ctx: any) {\r\n  return flow(function*onDeleteRowClick(event: any) {\r\n    try {\r\n      const dataView = getDataView(ctx);\r\n      const selectedRow = getSelectedRow(ctx);\r\n      if (selectedRow) {\r\n        const dataTable = getDataTable(ctx);\r\n        const entity = dataView.entity;\r\n        const formScreenLifecycle = getFormScreenLifecycle(ctx);\r\n        yield*formScreenLifecycle.onDeleteRow(\r\n          entity,\r\n          dataTable.getRowId(selectedRow),\r\n          dataView\r\n        );\r\n        getTablePanelView(ctx)?.triggerOnFocusTable();\r\n      }\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\n\r\nexport function onExportToExcelClick(ctx: any) {\r\n  return flow(function*onExportToExcelClick(event: any) {\r\n    try {\r\n      getDataView(ctx).exportToExcel();\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"../../actions/handleError\";\r\nimport { getDataView } from \"../../selectors/DataView/getDataView\";\r\nimport { getFormScreenLifecycle } from \"../../selectors/FormScreen/getFormScreenLifecycle\";\r\n\r\nexport function onMoveRowDownClick(ctx: any) {\r\n  return flow(function*onMoveRowDownClick(event: any) {\r\n    try {\r\n      getDataView(ctx).moveSelectedRowDown();\r\n      yield*getFormScreenLifecycle(ctx).onFlushData();\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { getDataView } from \"../../selectors/DataView/getDataView\";\r\nimport { handleError } from \"../../actions/handleError\";\r\nimport { getFormScreenLifecycle } from \"../../selectors/FormScreen/getFormScreenLifecycle\";\r\n\r\nexport function onMoveRowUpClick(ctx: any) {\r\n  return flow(function*onMoveRowUpClick(event: any) {\r\n    try {\r\n      getDataView(ctx).moveSelectedRowUp();\r\n      yield*getFormScreenLifecycle(ctx).onFlushData();\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from 'model/selectors/DataView/getDataView';\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { isLazyLoading } from \"model/selectors/isLazyLoading\";\r\nimport { getGridFocusManager } from \"model/entities/GridFocusManager\";\r\n\r\nexport function selectNextRow(ctx: any) {\r\n  return function*selectNextRow() {\r\n    getDataView(ctx).selectNextRow();\r\n    getTablePanelView(ctx).scrollToCurrentRow();\r\n    if (!isLazyLoading(ctx)) {\r\n      setTimeout(() => {\r\n        getGridFocusManager(ctx).focusTableIfNeeded();\r\n      });\r\n    }\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { selectNextRow } from \"model/actions/DataView/selectNextRow\";\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { shouldProceedToChangeRow } from \"./TableView/shouldProceedToChangeRow\";\r\n\r\nexport function onNextRowClick(ctx: any) {\r\n  return flow(function*onNextRowClick(event: any) {\r\n    try {\r\n      const dataView = getDataView(ctx);\r\n      if (!(yield shouldProceedToChangeRow(dataView))) {\r\n        return;\r\n      }\r\n      yield*selectNextRow(ctx)();\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { isLazyLoading } from \"model/selectors/isLazyLoading\";\r\nimport { getGridFocusManager } from \"model/entities/GridFocusManager\";\r\n\r\nexport function selectPrevRow(ctx: any) {\r\n  return function*selectPrevRow() {\r\n    getDataView(ctx).selectPrevRow();\r\n    getTablePanelView(ctx).scrollToCurrentRow();\r\n    if (!isLazyLoading(ctx)) {\r\n      setTimeout(() => {\r\n        getGridFocusManager(ctx).focusTableIfNeeded();\r\n      });\r\n    }\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { selectPrevRow } from \"model/actions/DataView/selectPrevRow\";\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { shouldProceedToChangeRow } from \"./TableView/shouldProceedToChangeRow\";\r\n\r\nexport function onPrevRowClick(ctx: any) {\r\n  return flow(function*onPrevRowClick(event: any) {\r\n    try {\r\n      const dataView = getDataView(ctx);\r\n      if (!(yield shouldProceedToChangeRow(dataView))) {\r\n        return;\r\n      }\r\n      yield*selectPrevRow(ctx)();\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { getMenuItemId } from \"model/selectors/getMenuItemId\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\nimport { getDataStructureEntityId } from \"model/selectors/DataView/getDataStructureEntityId\";\r\nimport { getRecordInfo } from \"model/selectors/RecordInfo/getRecordInfo\";\r\n\r\nexport function onRecordInfoClick(ctx: any) {\r\n  return flow(function*onRecordInfoClick(event: any) {\r\n    const menuId = getMenuItemId(ctx);\r\n    const dataStructureEntityId = getDataStructureEntityId(ctx);\r\n    const rowId = getSelectedRowId(ctx);\r\n    if (rowId) {\r\n      yield*getRecordInfo(ctx).onOpenRecordInfoClick(\r\n        event,\r\n        menuId,\r\n        dataStructureEntityId,\r\n        rowId\r\n      );\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\nimport { getConfigurationManager } from \"model/selectors/TablePanelView/getConfigurationManager\";\r\n\r\nexport function getDataViewLabel(ctx: any) {\r\n  const activeConfigName = getConfigurationManager(ctx).activeTableConfiguration.name;\r\n  return activeConfigName\r\n    ? `${getDataView(ctx).name} [${activeConfigName}]`\r\n    : getDataView(ctx).name\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { IPanelViewType } from \"model/entities/types/IPanelViewType\";\r\n\r\nexport class ViewConfiguration {\r\n  constructor(\r\n    public saveConfiguration: (activePerspectiveTag: string) => Generator,\r\n    public getActivePerspectiveTag: () => IPanelViewType\r\n  ) {\r\n  }\r\n\r\n  *anounceActivePerspective(tag: string) {\r\n    yield*this.saveConfiguration(tag);\r\n  }\r\n\r\n  get activePerspective(): IPanelViewType {\r\n    return this.getActivePerspectiveTag();\r\n  }\r\n}\r\n\r\nexport const IViewConfiguration = TypeSymbol<ViewConfiguration>(\"IViewConfiguration\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { scopeFor } from \"dic/Container\";\r\nimport { IViewConfiguration } from \"modules/DataView/ViewConfiguration\";\r\n\r\nexport function getActivePerspective(ctx: any) {\r\n  const dataView = getDataView(ctx);\r\n  const $cont = scopeFor(dataView);\r\n  const viewConfiguration = $cont && $cont.resolve(IViewConfiguration);\r\n  return viewConfiguration?.activePerspective\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getRelationState as getRelationRowState } from \"../RowState/getRelationState\";\r\nimport { getDataView } from \"./getDataView\";\r\nimport { IPanelViewType } from \"model/entities/types/IPanelViewType\";\r\nimport { getActivePerspective } from \"model/selectors/DataView/getActivePerspective\";\r\n\r\nexport function getIsAddButtonVisible(ctx: any) {\r\n  const dataView = getDataView(ctx);\r\n  if (getActivePerspective(ctx) === IPanelViewType.Map) {\r\n    return false;\r\n  }\r\n  const relationRowState = getRelationRowState(ctx);\r\n  if (relationRowState?.allowCreate !== undefined) {\r\n    return dataView.showAddButton && relationRowState.allowCreate;\r\n  }\r\n  return dataView.showAddButton\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"../DataView/getDataView\";\r\nimport { getRowStateById } from \"./getRowStateById\";\r\n\r\nexport function getRelationState(ctx: any) {\r\n  const dataView = getDataView(ctx);\r\n  const bindingParent = dataView.bindingParent;\r\n  if (bindingParent?.selectedRowId) {\r\n    return getRowStateById(bindingParent, bindingParent!.selectedRowId!)\r\n      ?.relations\r\n      .find(relation => relation.name === dataView.entity);\r\n  }\r\n  return undefined;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getIsAddButtonVisible } from \"./getIsAddButtonVisible\";\r\n\r\nexport function getIsCopyButtonVisible(ctx: any) {\r\n  return getIsAddButtonVisible(ctx);\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getRowStateById } from \"../RowState/getRowStateById\";\r\nimport { getDataView } from \"./getDataView\";\r\nimport { getActivePerspective } from \"model/selectors/DataView/getActivePerspective\";\r\nimport { IPanelViewType } from \"model/entities/types/IPanelViewType\";\r\n\r\nexport function getIsDelButtonVisible(ctx: any) {\r\n  const dataView = getDataView(ctx);\r\n  if (getActivePerspective(ctx) === IPanelViewType.Map) {\r\n    return false;\r\n  }\r\n  if (dataView.selectedRowId) {\r\n    const rowState = getRowStateById(ctx, dataView.selectedRowId);\r\n    if (rowState?.allowDelete !== undefined) {\r\n      return dataView.showDeleteButton && rowState.allowDelete;\r\n    }\r\n  }\r\n  return dataView.showDeleteButton\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\nimport { getRowStateAllowUpdate } from \"../RowState/getRowStateAllowUpdate\";\r\nimport { getSelectedRowId } from \"../TablePanelView/getSelectedRowId\";\r\n\r\nexport function getIsMoveRowMenuVisible(ctx: any) {\r\n  const {orderProperty} = getDataView(ctx);\r\n  const currentRowId = getSelectedRowId(ctx);\r\n  return (\r\n    !!orderProperty &&\r\n    !orderProperty?.readOnly &&\r\n    currentRowId &&\r\n    getRowStateAllowUpdate(ctx, currentRowId, orderProperty?.id)\r\n  );\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getPanelViewActions(ctx: any) {\r\n  return getDataView(ctx).panelViewActions;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { isInfiniteScrollingActive } from \"../isInfiniteScrollingActive\";\r\nimport { getGroupingConfiguration } from \"../TablePanelView/getGroupingConfiguration\";\r\nimport { getDataView } from \"./getDataView\";\r\nimport { getGrouper } from \"./getGrouper\";\r\n\r\n\r\nexport function getTotalRowCount(ctx: any) {\r\n  if (!getGroupingConfiguration(ctx).isGrouping) {\r\n    if (isInfiniteScrollingActive(ctx)) {\r\n      return getDataView(ctx).totalRowCount;\r\n    } else {\r\n      return getDataView(ctx).dataTable.rows.length;\r\n    }\r\n  } else {\r\n    return getGrouper(ctx).topLevelGroups\r\n      .reduce((count, group) => count + group.rowCount, 0);\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFilterConfiguration } from \"../DataView/getFilterConfiguration\";\r\n\r\nexport function getIsFilterControlsDisplayed(ctx: any) {\r\n  return getFilterConfiguration(ctx).isFilterControlsDisplayed;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { isLazyLoading } from \"model/selectors/isLazyLoading\";\r\nimport { getGridFocusManager } from \"model/entities/GridFocusManager\";\r\n\r\nexport function selectFirstRow(ctx: any) {\r\n  return function*selectFirstRow() {\r\n    let dataView = getDataView(ctx);\r\n    if (dataView.infiniteScrollLoader) yield*dataView.infiniteScrollLoader!.loadFirstPage();\r\n    dataView.selectFirstRow();\r\n    getTablePanelView(ctx).scrollToCurrentRow();\r\n    if (!isLazyLoading(ctx)) {\r\n      setTimeout(() => {\r\n        getGridFocusManager(ctx).focusTableIfNeeded();\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { isLazyLoading } from \"model/selectors/isLazyLoading\";\r\nimport { getGridFocusManager } from \"model/entities/GridFocusManager\";\r\n\r\nexport function selectLastRow(ctx: any) {\r\n  return function*selectLastRow() {\r\n    let dataView = getDataView(ctx);\r\n    if (dataView.infiniteScrollLoader){\r\n      yield*dataView.infiniteScrollLoader.loadLastPage();\r\n    }\r\n    dataView.selectLastRow();\r\n    getTablePanelView(ctx).scrollToCurrentRow();\r\n    if (!isLazyLoading(ctx)) {\r\n      setTimeout(() => {\r\n        getGridFocusManager(ctx).focusTableIfNeeded();\r\n      });\r\n    }\r\n  };\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getPanelMenuActions(ctx: any) {\r\n  return getDataView(ctx).panelMenuActions;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from './DropdownDivider.module.scss';\r\n\r\nexport function DropdownDivider() {\r\n  return <div className={S.root}/>;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getAreCrudButtonsEnabled(ctx: any) {\r\n  const dataView = getDataView(ctx);\r\n  if (dataView.parentBindings.length === 0) {\r\n    return true;\r\n  }\r\n  return dataView.parentBindings.some(binding => binding.parentDataView.selectedRowId)\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { scopeFor } from \"dic/Container\";\r\nimport { Dropdowner } from \"gui/Components/Dropdowner/Dropdowner\";\r\nimport { CtxDataViewHeaderExtension, DataViewHeaderExtension, } from \"gui/Components/ScreenElements/DataView\";\r\nimport { DataViewHeader } from \"gui/Components/DataViewHeader/DataViewHeader\";\r\nimport { DataViewHeaderAction } from \"gui/Components/DataViewHeader/DataViewHeaderAction\";\r\nimport { DataViewHeaderButtonGroup } from \"gui/Components/DataViewHeader/DataViewHeaderButtonGroup\";\r\nimport { DataViewHeaderGroup } from \"gui/Components/DataViewHeader/DataViewHeaderGroup\";\r\nimport { Dropdown } from \"gui/Components/Dropdown/Dropdown\";\r\nimport { DropdownItem } from \"gui/Components/Dropdown/DropdownItem\";\r\nimport { Icon } from \"@origam/components\";\r\nimport { FilterDropDown } from \"gui/connections/FilterDropDown\";\r\nimport { MobXProviderContext, Observer, observer } from \"mobx-react\";\r\nimport uiActions from \"model/actions-ui-tree\";\r\nimport { getIsRowMovingDisabled } from \"model/actions-ui/DataView/getIsRowMovingDisabled\";\r\nimport { onColumnConfigurationClick } from \"model/actions-ui/DataView/onColumnConfigurationClick\";\r\nimport { onCopyRowClick } from \"model/actions-ui/DataView/onCopyRowClick\";\r\nimport { onCreateRowClick } from \"model/actions-ui/DataView/onCreateRowClick\";\r\nimport { onDeleteRowClick } from \"model/actions-ui/DataView/onDeleteRowClick\";\r\nimport { onExportToExcelClick } from \"model/actions-ui/DataView/onExportToExcelClick\";\r\nimport { onFilterButtonClick } from \"model/actions-ui/DataView/onFilterButtonClick\";\r\nimport { onMoveRowDownClick } from \"model/actions-ui/DataView/onMoveRowDownClick\";\r\nimport { onMoveRowUpClick } from \"model/actions-ui/DataView/onMoveRowUpClick\";\r\nimport { onNextRowClick } from \"model/actions-ui/DataView/onNextRowClick\";\r\nimport { onPrevRowClick } from \"model/actions-ui/DataView/onPrevRowClick\";\r\nimport { onRecordInfoClick } from \"model/actions-ui/RecordInfo/onRecordInfoClick\";\r\nimport { IAction, IActionMode, IActionPlacement } from \"model/entities/types/IAction\";\r\nimport { getIsEnabledAction } from \"model/selectors/Actions/getIsEnabledAction\";\r\nimport { getDataViewLabel } from \"model/selectors/DataView/getDataViewLabel\";\r\nimport { getExpandedGroupRowCount } from \"model/selectors/DataView/getExpandedGroupRowCount\";\r\nimport { getIsAddButtonVisible } from \"model/selectors/DataView/getIsAddButtonVisible\";\r\nimport { getIsCopyButtonVisible } from \"model/selectors/DataView/getIsCopyButtonVisible\";\r\nimport { getIsDelButtonVisible } from \"model/selectors/DataView/getIsDelButtonVisible\";\r\nimport { getIsMoveRowMenuVisible } from \"model/selectors/DataView/getIsMoveRowMenuVisible\";\r\nimport { getPanelViewActions } from \"model/selectors/DataView/getPanelViewActions\";\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\nimport { getTotalRowCount } from \"model/selectors/DataView/getTotalGroupRowCount\";\r\nimport { getOpenedScreen } from \"model/selectors/getOpenedScreen\";\r\nimport { getGroupingConfiguration } from \"model/selectors/TablePanelView/getGroupingConfiguration\";\r\nimport { getIsFilterControlsDisplayed } from \"model/selectors/TablePanelView/getIsFilterControlsDisplayed\";\r\nimport { SectionViewSwitchers } from \"modules/DataView/DataViewTypes\";\r\nimport { IDataViewToolbarUI } from \"modules/DataView/DataViewUI\";\r\nimport React, { useContext } from \"react\";\r\nimport Measure from \"react-measure\";\r\nimport { onFirstRowClick } from \"model/actions-ui/DataView/onFirstRowClick\";\r\nimport { onLastRowClick } from \"model/actions-ui/DataView/onLastRowClick\";\r\nimport { T } from \"utils/translation\";\r\nimport { getConfigurationManager } from \"model/selectors/TablePanelView/getConfigurationManager\";\r\nimport { computed } from \"mobx\";\r\nimport { getPanelMenuActions } from \"model/selectors/DataView/getPanelMenuActions\";\r\nimport { DropdownDivider } from \"gui/Components/Dropdown/DropdownDivider\";\r\nimport { getTrueSelectedRowIndex } from \"model/selectors/DataView/getTrueSelectedRowIndex\";\r\nimport { getAreCrudButtonsEnabled } from \"model/selectors/DataView/getAreCrudButtonsEnabled\";\r\nimport { IDataView } from \"model/entities/types/IDataView\";\r\nimport { saveColumnConfigurationsAsync } from \"model/actions/DataView/TableView/saveColumnConfigurations\";\r\n\r\n@observer\r\nexport class CDataViewHeaderInner extends React.Component<{\r\n  isVisible: boolean;\r\n  extension: DataViewHeaderExtension;\r\n}> {\r\n  static contextType = MobXProviderContext;\r\n\r\n  get dataView() {\r\n    return this.context.dataView;\r\n  }\r\n\r\n  state = {\r\n    hiddenActionIds: new Set<string>(),\r\n  };\r\n\r\n  shouldBeShown(action: IAction) {\r\n    return getIsEnabledAction(action) || action.mode !== IActionMode.ActiveRecord;\r\n  }\r\n\r\n  @computed\r\n  get relevantActions() {\r\n    return this.allActions\r\n      .filter((action) => !action.groupId)\r\n      .filter((action) => this.shouldBeShown(action));\r\n  }\r\n\r\n  @computed\r\n  get relevantMenuActions() {\r\n    return this.allMenuActions\r\n      .filter((action) => !action.groupId)\r\n      .filter((action) => this.shouldBeShown(action));\r\n  }\r\n\r\n  renderMenuActions(args: { setMenuDropped(state: boolean): void }) {\r\n    return this.relevantMenuActions.map((action) => {\r\n      return (\r\n        <DropdownItem\r\n          key={action.id}\r\n          onClick={(event) => {\r\n            args.setMenuDropped(false);\r\n            uiActions.actions.onActionClick(action)(event, action);\r\n          }}\r\n        >\r\n          {action.caption}\r\n        </DropdownItem>\r\n      );\r\n    });\r\n  }\r\n\r\n  @computed\r\n  get isBarVisible() {\r\n    return this.props.isVisible || this.hasSomeRelevantActions;\r\n  }\r\n\r\n  @computed\r\n  get isActionsOnly() {\r\n    return !this.props.isVisible && this.hasSomeRelevantActions;\r\n  }\r\n\r\n  @computed\r\n  get hasSomeRelevantActions() {\r\n    return (\r\n      this.relevantActions.filter((action) => action.placement !== IActionPlacement.PanelMenu)\r\n        .length > 0\r\n    );\r\n  }\r\n\r\n  @computed\r\n  get allActions() {\r\n    return getPanelViewActions(this.dataView);\r\n  }\r\n\r\n  @computed\r\n  get allMenuActions() {\r\n    return getPanelMenuActions(this.dataView);\r\n  }\r\n\r\n  render() {\r\n    const {dataView} = this;\r\n    const label = getDataViewLabel(dataView);\r\n    const isFilterSettingsVisible = getIsFilterControlsDisplayed(dataView);\r\n    const onColumnConfigurationClickEvt = onColumnConfigurationClick(dataView);\r\n    const onExportToExcelClickEvt = onExportToExcelClick(dataView);\r\n    const onDeleteRowClickEvt = onDeleteRowClick(dataView);\r\n    const onCreateRowClickEvt = onCreateRowClick(dataView);\r\n    const onMoveRowUpClickEvt = onMoveRowUpClick(dataView);\r\n    const isRowMovingDisabled = getIsRowMovingDisabled(dataView);\r\n    const onMoveRowDownClickEvt = onMoveRowDownClick(dataView);\r\n    const onCopyRowClickEvt = onCopyRowClick(dataView);\r\n    const onFilterButtonClickEvt = onFilterButtonClick(dataView);\r\n    const onFirstRowClickEvt = onFirstRowClick(dataView);\r\n    const onPrevRowClickEvt = onPrevRowClick(dataView);\r\n    const onNextRowClickEvt = onNextRowClick(dataView);\r\n    const onLastRowClickEvt = onLastRowClick(dataView);\r\n\r\n    const isMoveRowMenuVisible = getIsMoveRowMenuVisible(dataView);\r\n    const selectedRow = getSelectedRow(dataView);\r\n\r\n    const isAddButton = getIsAddButtonVisible(dataView);\r\n    const isDelButton = getIsDelButtonVisible(dataView);\r\n    const isCopyButton = getIsCopyButtonVisible(dataView);\r\n    const showCrudButtons =  isAddButton || (isDelButton && !!selectedRow) || (isCopyButton && !!selectedRow)\r\n    const crudButtonsEnabled = getAreCrudButtonsEnabled(dataView);\r\n\r\n    const $cont = scopeFor(dataView);\r\n    const uiToolbar = $cont && $cont.resolve(IDataViewToolbarUI);\r\n    const isDialog = !!getOpenedScreen(dataView).dialogInfo;\r\n\r\n    const goToFirstRowDisabled =\r\n      getGroupingConfiguration(dataView).isGrouping; // || isInfiniteScrollingActive(dataView);\r\n    const goToLastRowDisabled =\r\n      getGroupingConfiguration(dataView).isGrouping; // || isInfiniteScrollingActive(dataView);\r\n\r\n    const configurationManager = getConfigurationManager(dataView);\r\n    const customTableConfigsExist = configurationManager.customTableConfigurations.length > 0;\r\n    return (\r\n      <Measure bounds={true}>\r\n        {({measureRef, contentRect}) => {\r\n          const containerWidth = contentRect.bounds?.width || 0;\r\n          const isBreak640 = containerWidth < 640;\r\n          return (\r\n            <Observer>\r\n              {() => (\r\n                <DataViewHeader domRef={measureRef} isVisible={this.isBarVisible}>\r\n                  {this.isBarVisible &&\r\n                  (this.isActionsOnly ? (\r\n                    <DataViewHeaderGroup grovable={true} noDivider={true}>\r\n                      {this.props.extension.render(\"actions\")}\r\n                      <DataViewHeaderButtonGroup actions={this.relevantActions}/>\r\n                    </DataViewHeaderGroup>\r\n                  ) : (\r\n                    <>\r\n                      <h2 title={label}>{label}</h2>\r\n\r\n                      <div className=\"fullspaceBlock\">\r\n                        {isMoveRowMenuVisible ? (\r\n                          <DataViewHeaderGroup isHidden={false} noShrink={true}>\r\n                            <DataViewHeaderAction\r\n                              onMouseDown={onMoveRowUpClickEvt}\r\n                              isDisabled={isRowMovingDisabled}\r\n                            >\r\n                              <Icon\r\n                                src=\"./icons/move-up.svg\"\r\n                                tooltip={T(\"Move Up\", \"increase_tool_tip\")}\r\n                              />\r\n                            </DataViewHeaderAction>\r\n                            <DataViewHeaderAction\r\n                              onMouseDown={onMoveRowDownClickEvt}\r\n                              isDisabled={isRowMovingDisabled}\r\n                            >\r\n                              <Icon\r\n                                src=\"./icons/move-down.svg\"\r\n                                tooltip={T(\"Move Down\", \"decrease_tool_tip\")}\r\n                              />\r\n                            </DataViewHeaderAction>\r\n                          </DataViewHeaderGroup>\r\n                        ) : null}\r\n                        {showCrudButtons &&\r\n                          <DataViewHeaderGroup noShrink={true}>\r\n                            {isAddButton && (\r\n                              <DataViewHeaderAction\r\n                                className={\"addRow \" + (crudButtonsEnabled ? \"isGreenHover\" : \"\")}\r\n                                onClick={onCreateRowClickEvt}\r\n                                onShortcut={onCreateRowClickEvt}\r\n                                isDisabled={!crudButtonsEnabled}\r\n                                shortcutPredicate={isAddRecordShortcut}\r\n                              >\r\n                                <Icon src=\"./icons/add.svg\" tooltip={T(\"Add\", \"add_tool_tip\")}/>\r\n                              </DataViewHeaderAction>\r\n                            )}\r\n\r\n                            {isDelButton && !!selectedRow && (\r\n                              <DataViewHeaderAction\r\n                                className=\"deleteRow isRedHover\"\r\n                                onMouseDown={onDeleteRowClickEvt}\r\n                                onShortcut={onDeleteRowClickEvt}\r\n                                shortcutPredicate={isDeleteRecordShortcut}\r\n                              >\r\n                                <Icon\r\n                                  src=\"./icons/minus.svg\"\r\n                                  tooltip={T(\"Delete\", \"delete_tool_tip\")}\r\n                                />\r\n                              </DataViewHeaderAction>\r\n                            )}\r\n\r\n                            {isCopyButton && !!selectedRow && (\r\n                              <DataViewHeaderAction\r\n                                className=\"copyRow isOrangeHover\"\r\n                                onMouseDown={onCopyRowClickEvt}\r\n                                onShortcut={onCopyRowClickEvt}\r\n                                shortcutPredicate={isDuplicateRecordShortcut}\r\n                              >\r\n                                <Icon\r\n                                  src=\"./icons/duplicate.svg\"\r\n                                  tooltip={T(\"Duplicate\", \"add_duplicate_tool_tip\")}\r\n                                />\r\n                              </DataViewHeaderAction>\r\n                            )}\r\n                          </DataViewHeaderGroup>\r\n                        }\r\n\r\n                        <DataViewHeaderGroup grovable={true}>\r\n                          {this.props.extension.render(\"actions\")}\r\n                          <DataViewHeaderButtonGroup actions={this.relevantActions}/>\r\n                        </DataViewHeaderGroup>\r\n\r\n                        {!isBreak640 && (\r\n                          <>\r\n                            <DataViewHeaderGroup noShrink={true}>\r\n                              <DataViewHeaderAction\r\n                                onMouseDown={onFirstRowClickEvt}\r\n                                isDisabled={goToFirstRowDisabled}\r\n                              >\r\n                                <Icon\r\n                                  src=\"./icons/list-arrow-first.svg\"\r\n                                  tooltip={T(\"First\", \"move_first_tool_tip\")}\r\n                                />\r\n                              </DataViewHeaderAction>\r\n                              <DataViewHeaderAction onMouseDown={onPrevRowClickEvt}>\r\n                                <Icon\r\n                                  src=\"./icons/list-arrow-previous.svg\"\r\n                                  tooltip={T(\"Previous\", \"move_prev_tool_tip\")}\r\n                                />\r\n                              </DataViewHeaderAction>\r\n                              <DataViewHeaderAction onMouseDown={onNextRowClickEvt}>\r\n                                <Icon\r\n                                  src=\"./icons/list-arrow-next.svg\"\r\n                                  tooltip={T(\"Next\", \"move_next_tool_tip\")}\r\n                                />\r\n                              </DataViewHeaderAction>\r\n                              <DataViewHeaderAction\r\n                                onMouseDown={onLastRowClickEvt}\r\n                                isDisabled={goToLastRowDisabled}\r\n                              >\r\n                                <Icon\r\n                                  src=\"./icons/list-arrow-last.svg\"\r\n                                  tooltip={T(\"Last\", \"move_last_tool_tip\")}\r\n                                />\r\n                              </DataViewHeaderAction>\r\n                            </DataViewHeaderGroup>\r\n\r\n                              <DataViewHeaderGroup noShrink={true} className={\"rowCount\"}>\r\n                                {renderRowCount(this.dataView)}\r\n                              </DataViewHeaderGroup>\r\n                            </>\r\n                          )}\r\n\r\n                        <DataViewHeaderGroup noShrink={true}>\r\n                          {uiToolbar && uiToolbar.renderSection(SectionViewSwitchers)}\r\n                        </DataViewHeaderGroup>\r\n\r\n                        <DataViewHeaderGroup noShrink={true}>\r\n                          <DataViewHeaderAction\r\n                            onMouseDown={onFilterButtonClickEvt}\r\n                            onShortcut={onFilterButtonClickEvt}\r\n                            shortcutPredicate={isFilterRecordShortcut}\r\n                            isActive={isFilterSettingsVisible}\r\n                            className={\"test-filter-button\"}\r\n                          >\r\n                            <Icon\r\n                              src=\"./icons/search-filter.svg\"\r\n                              tooltip={T(\"Filter\", \"filter_tool_tip\")}\r\n                            />\r\n                          </DataViewHeaderAction>\r\n                          <FilterDropDown ctx={dataView}/>\r\n                        </DataViewHeaderGroup>\r\n                      </div>\r\n\r\n                        <DataViewHeaderGroup noShrink={true}>\r\n                          <Dropdowner\r\n                            trigger={({ refTrigger, setDropped }) => (\r\n                              <DataViewHeaderAction\r\n                                className={\"threeDotMenu\"}\r\n                                refDom={refTrigger}\r\n                                onMouseDown={() => setDropped(true)}\r\n                                isActive={false}\r\n                              >\r\n                                <Icon\r\n                                  src=\"./icons/dot-menu.svg\"\r\n                                  tooltip={T(\"Tools\", \"tools_tool_tip\")}\r\n                                />\r\n                              </DataViewHeaderAction>\r\n                            )}\r\n                            content={({ setDropped }) => (\r\n                              <Dropdown>\r\n                                <DropdownItem\r\n                                  onClick={(event: any) => {\r\n                                    setDropped(false);\r\n                                    onExportToExcelClickEvt(event);\r\n                                  }}\r\n                                >\r\n                                  {T(\"Export to Excel\", \"excel_tool_tip\")}\r\n                                </DropdownItem>\r\n                                <DropdownItem\r\n                                  id={\"columnConfigItem\"}\r\n                                  onClick={(event: any) => {\r\n                                    setDropped(false);\r\n                                    onColumnConfigurationClickEvt(event);\r\n                                  }}\r\n                                >\r\n                                  {T(\"Column configuration\", \"column_config_tool_tip\")}\r\n                                </DropdownItem>\r\n                                {!isDialog && (\r\n                                  <DropdownItem\r\n                                    isDisabled={false}\r\n                                    onClick={(event: any) => {\r\n                                      setDropped(false);\r\n                                      onRecordInfoClick(dataView)(event);\r\n                                    }}\r\n                                  >\r\n                                    {T(\"Show record information\", \"info_button_tool_tip\")}\r\n                                  </DropdownItem>\r\n                                )}\r\n                                {customTableConfigsExist && [\r\n                                  <DropdownItem\r\n                                    isDisabled={false}\r\n                                    isSelected={\r\n                                      configurationManager.defaultTableConfiguration.isActive\r\n                                    }\r\n                                    onClick={async (event: any) => {\r\n                                      setDropped(false);\r\n                                      configurationManager.activeTableConfiguration =\r\n                                        configurationManager.defaultTableConfiguration;\r\n                                      await saveColumnConfigurationsAsync(configurationManager);\r\n                                    }}\r\n                                  >\r\n                                    {T(\"Default View\", \"default_grid_view_view\")}\r\n                                  </DropdownItem>,\r\n                                  ...configurationManager.customTableConfigurations.map(\r\n                                    (tableConfig) => (\r\n                                      <DropdownItem\r\n                                        key={tableConfig.id}\r\n                                        isDisabled={false}\r\n                                        isSelected={tableConfig.isActive}\r\n                                        onClick={async (event: any) => {\r\n                                          setDropped(false);\r\n                                          configurationManager.activeTableConfiguration = tableConfig;\r\n                                          await saveColumnConfigurationsAsync(configurationManager);\r\n                                        }}\r\n                                      >\r\n                                        {tableConfig.name}\r\n                                      </DropdownItem>\r\n                                    )\r\n                                  ),\r\n                                  <DropdownItem\r\n                                    isDisabled={false}\r\n                                    onClick={async (event: any) => {\r\n                                      setDropped(false);\r\n                                      await saveColumnConfigurationsAsync(configurationManager);\r\n                                    }}\r\n                                  >\r\n                                    {T(\"Save View\", \"save_current_column_config\")}\r\n                                  </DropdownItem>,\r\n                                  <DropdownItem\r\n                                    isDisabled={\r\n                                      configurationManager.defaultTableConfiguration.isActive\r\n                                    }\r\n                                    onClick={async (event: any) => {\r\n                                      setDropped(false);\r\n                                      await configurationManager.deleteActiveTableConfiguration();\r\n                                    }}\r\n                                  >\r\n                                    {T(\"Delete View\", \"delete_current_column_config\")}\r\n                                  </DropdownItem>,\r\n                                ]}\r\n                                {this.relevantMenuActions.length > 0 && <DropdownDivider />}\r\n                                {this.renderMenuActions({ setMenuDropped: setDropped })}\r\n                              </Dropdown>\r\n                            )}\r\n                          />\r\n                        </DataViewHeaderGroup>\r\n                      </>\r\n                    ))}\r\n                </DataViewHeader>\r\n              )}\r\n            </Observer>\r\n          );\r\n        }}\r\n      </Measure>\r\n    );\r\n  }\r\n}\r\n\r\nexport function renderRowCount(dataView: IDataView) {\r\n  const selectedRowIndex = getTrueSelectedRowIndex(dataView);\r\n  const totalRowCount = getTotalRowCount(dataView);\r\n  const groupRowCount = getExpandedGroupRowCount(dataView);\r\n  if (groupRowCount) {\r\n    return (\r\n      <>\r\n        {selectedRowIndex !== undefined ? selectedRowIndex + 1 : \" - \"}\r\n        &nbsp;/&nbsp;\r\n        {groupRowCount}\r\n        {totalRowCount ? \" (\" + totalRowCount + \")\" : \"\"}\r\n      </>\r\n    );\r\n  } else {\r\n    return (\r\n      <>\r\n        {selectedRowIndex !== undefined ? selectedRowIndex + 1 : \" - \"}\r\n        &nbsp;/&nbsp;\r\n        {totalRowCount}\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport function CDataViewHeader(props: { isVisible: boolean }) {\r\n  const extension = useContext(CtxDataViewHeaderExtension);\r\n  return <CDataViewHeaderInner isVisible={props.isVisible} extension={extension}/>;\r\n}\r\n\r\nexport function isAddRecordShortcut(event: any) {\r\n  return (\r\n    ((event.ctrlKey || event.metaKey) && !event.shiftKey && event.key === \"i\") ||\r\n    ((event.ctrlKey || event.metaKey) && event.shiftKey && event.key === \"j\")\r\n  );\r\n}\r\n\r\nexport function isDeleteRecordShortcut(event: any) {\r\n  return (event.ctrlKey || event.metaKey) && !event.shiftKey && event.key === \"Delete\";\r\n}\r\n\r\nexport function isDuplicateRecordShortcut(event: any) {\r\n  return (\r\n    (event.ctrlKey || event.metaKey) && !event.shiftKey && (event.key === \"d\" || event.key === \"k\")\r\n  );\r\n}\r\n\r\nexport function isFilterRecordShortcut(event: any) {\r\n  return (event.ctrlKey || event.metaKey) && event.key === \"f\";\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getColumnConfigurationModel } from \"model/selectors/getColumnConfigurationModel\";\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { shouldProceedToChangeRow } from \"./TableView/shouldProceedToChangeRow\";\r\nimport { getDialogStack } from \"model/selectors/DialogStack/getDialogStack\";\r\nimport { ColumnsDialog } from \"gui/Components/Dialogs/ColumnsDialog\";\r\nimport React from \"react\";\r\nimport { dialogKey } from \"model/entities/TablePanelView/ColumnConfigurationModel\";\r\n\r\nexport function onColumnConfigurationClick(ctx: any) {\r\n  return flow(function*onColumnConfigurationClick(event: any) {\r\n    try {\r\n      if (yield shouldProceedToChangeRow(ctx)) {\r\n        const columnConfigModel = getColumnConfigurationModel(ctx);\r\n        columnConfigModel.reset();\r\n        getDialogStack(ctx).pushDialog(\r\n          dialogKey,\r\n          <ColumnsDialog\r\n            model={columnConfigModel}\r\n          />\r\n        );\r\n      }\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFilterConfiguration } from \"model/selectors/DataView/getFilterConfiguration\";\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\n\r\nexport function onFilterButtonClick(ctx: any) {\r\n  return flow(function*onFilterButtonClick(event: any) {\r\n    try {\r\n      const dataView = getDataView(ctx);\r\n      if (dataView.isFormViewActive()) {\r\n        dataView.activateTableView?.();\r\n      }\r\n      getFilterConfiguration(ctx).onFilterDisplayClick(event);\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { selectFirstRow } from \"../../actions/DataView/selectFirstRow\";\r\nimport { handleError } from \"../../actions/handleError\";\r\n\r\nexport function onFirstRowClick(ctx: any) {\r\n  return flow(function*onPrevRowClick(event: any) {\r\n    try {\r\n      yield*selectFirstRow(ctx)();\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { selectLastRow } from \"../../actions/DataView/selectLastRow\";\r\nimport { handleError } from \"../../actions/handleError\";\r\n\r\nexport function onLastRowClick(ctx: any) {\r\n  return flow(function*onLastRowClick(event: any) {\r\n    try {\r\n      yield*selectLastRow(ctx)();\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getTrueSelectedRowIndex(ctx: any) {\r\n  return getDataView(ctx).trueSelectedRowIndex;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getGroupingConfiguration } from \"../TablePanelView/getGroupingConfiguration\";\r\nimport { getDataView } from \"./getDataView\";\r\nimport { getGrouper } from \"./getGrouper\";\r\n\r\n\r\nexport function getExpandedGroupRowCount(ctx: any) {\r\n  if (!getGroupingConfiguration(ctx).isGrouping) {\r\n    return undefined;\r\n  }\r\n\r\n  if (getGrouper(ctx).allGroups.some((group) => group.isExpanded)) {\r\n    const dataView = getDataView(ctx);\r\n    return getGrouper(ctx).getTotalRowCount(dataView.selectedRowId!);\r\n  } else {\r\n    return undefined;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getIsDataViewWorking(ctx: any) {\r\n  return getDataView(ctx).isWorking;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFormScreenLifecycle } from \"./getFormScreenLifecycle\";\r\n\r\nexport function getIsFormScreenWorkingDelayed(ctx: any) {\r\n  return getFormScreenLifecycle(ctx).isWorkingDelayed;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDataView } from \"../../entities/types/IDataView\";\r\nimport { getOpenedScreen } from \"../getOpenedScreen\";\r\n\r\nexport function getDataViewById(ctx: any, id: string): IDataView | undefined {\r\n  return getOpenedScreen(ctx).content.formScreen!.dataViews.find(\r\n    item => item.id === id\r\n  );\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"./DataViewLoading.module.css\";\r\n\r\nexport class DataViewLoading extends React.Component {\r\n  render() {\r\n    return (\r\n      <div className={S.container}>\r\n        {/*<div className={S.label}>Loading</div>*/}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDataTable } from \"./types/IDataTable\";\r\nimport { IProperty } from \"./types/IProperty\";\r\nimport { IRowsContainer } from \"./types/IRowsContainer\";\r\nimport { IAdditionalRowData } from \"./types/IAdditionalRecordData\";\r\nimport { IDataSourceField } from \"./types/IDataSourceField\";\r\nimport { computed, observable } from \"mobx\";\r\nimport { getDataSource } from \"../selectors/DataSources/getDataSource\";\r\n\r\nexport class TreeDataTable implements IDataTable {\r\n  $type_IDataTable: 1 = 1;\r\n  $type_TreeDataTable: 1 = 1;\r\n  properties: IProperty[] = [];\r\n  rowsContainer: IRowsContainer = null as any;\r\n  rowsAddedSinceSave = 0;\r\n  @observable.shallow rows: any[] = [];\r\n\r\n  get allRows(): any[][] {\r\n    return this.rows;\r\n  }\r\n\r\n  start() {\r\n\r\n  }\r\n\r\n  stop() {\r\n\r\n  }\r\n\r\n  @computed get identifierProperty() {\r\n    return this.properties.find((prop) => prop.id === this.dataSource.identifier);\r\n  }\r\n\r\n  get identifierDataIndex() {\r\n    return this.identifierProperty!.dataIndex;\r\n  }\r\n\r\n  additionalRowData: Map<string, IAdditionalRowData> = new Map();\r\n  parentIdProperty: string;\r\n  isEmpty: boolean = false;\r\n  idProperty: string;\r\n\r\n  constructor(idProperty: string, parentIdProperty: string) {\r\n    this.parentIdProperty = parentIdProperty;\r\n    this.idProperty = idProperty;\r\n  }\r\n\r\n  getTrueIndexById(id: string): number | undefined {\r\n    const idx = this.rows.findIndex((row) => this.getRowId(row) === id);\r\n    return idx > -1 ? idx : undefined;\r\n  }\r\n\r\n  deleteAdditionalCellData(row: any[], propertyId: string): void {\r\n    throw new Error(\"Method not implemented.\");\r\n  }\r\n\r\n  rowRemovedListeners: (() => void)[] = [];\r\n\r\n  getRowId(row: any[]): string {\r\n    return row[this.dataSource.getFieldByName(this.idProperty)!.index];\r\n  }\r\n\r\n  getCellValue(row: any[], property: IProperty): any {\r\n    throw new Error(\"Not implemented\");\r\n  }\r\n\r\n  getOriginalCellValue(row: any[], property: IProperty): any {\r\n    throw new Error(\"Not implemented\");\r\n  }\r\n\r\n  getCellValueByDataSourceField(row: any[], dsField: IDataSourceField) {\r\n    return row[dsField.index];\r\n  }\r\n\r\n  getCellText(row: any[], property: IProperty): any {\r\n    throw new Error(\"Not implemented\");\r\n  }\r\n\r\n  getOriginalCellText(row: any[], property: IProperty): any {\r\n    throw new Error(\"Not implemented\");\r\n  }\r\n\r\n  resolveCellText(property: IProperty, value: any): any {\r\n    throw new Error(\"Not implemented\");\r\n  }\r\n\r\n  getRowByExistingIdx(idx: number): any[] {\r\n    return this.rows[idx];\r\n  }\r\n\r\n  getRowById(id: string): any[] | undefined {\r\n    return this.rows.find((row) => this.getRowId(row) === id);\r\n  }\r\n\r\n  getExistingRowIdxById(id: string): number | undefined {\r\n    for (let i = 0; i < this.rows.length; i++) {\r\n      if (this.getRowId(this.rows[i]) === id) {\r\n        return i;\r\n      }\r\n    }\r\n  }\r\n\r\n  getPropertyById(id: string): IProperty | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getFirstRow(): any[] | undefined {\r\n    if (this.rows.length > 0) {\r\n      return this.rows[0];\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  getNearestRow(row: any[]): any[] | undefined {\r\n    throw new Error(\"Not implemented\");\r\n  }\r\n\r\n  getNextExistingRowId(id: string): string | undefined {\r\n    throw new Error(\"Not implemented\");\r\n  }\r\n\r\n  getPrevExistingRowId(id: string): string | undefined {\r\n    throw new Error(\"Not implemented\");\r\n  }\r\n\r\n  getDirtyValues(row: any[]): Map<string, any> {\r\n    return new Map<string, any>();\r\n  }\r\n\r\n  getDirtyValueRows(): any[][] {\r\n    return [];\r\n  }\r\n\r\n  getAllValuesOfProp(property: IProperty): Set<any> {\r\n    throw new Error(\"Not implemented\");\r\n  }\r\n\r\n  async setRecords(rows: any[][]): Promise<any> {\r\n    this.rows = [...this.sortTreeRows(rows, null)];\r\n  }\r\n\r\n  appendRecords(rows: any[][]): void {\r\n    this.rows = [...this.rows, ...this.sortTreeRows(rows, null)];\r\n  }\r\n\r\n  private*sortTreeRows(rows: any[], parent: any[] | null): Generator {\r\n    const children = this.getChildren(rows, parent);\r\n    if (parent) {\r\n      yield parent;\r\n    }\r\n    for (let child of children) {\r\n      yield*this.sortTreeRows(rows, child);\r\n    }\r\n  }\r\n\r\n  private getChildren(rows: any[], parent: any[] | null) {\r\n    const parentId = parent ? this.getRowId(parent) : null;\r\n    return rows\r\n      .filter((row) => parentId === this.getParentId(row))\r\n      .sort((row1, row2) => this.compareLabels(row1, row2));\r\n  }\r\n\r\n  setFormDirtyValue(row: any[], propertyId: string, value: any): void {\r\n    throw new Error(\"Not implemented\");\r\n  }\r\n\r\n  setDirtyValue(row: any[], columnId: string, value: any): void {\r\n    throw new Error(\"Not implemented\");\r\n  }\r\n\r\n  flushFormToTable(row: any[]): void {\r\n  }\r\n\r\n  deleteAdditionalRowData(row: any[]): void {\r\n    throw new Error(\"Not implemented\");\r\n  }\r\n\r\n  deleteRow(row: any[]): void {\r\n    throw new Error(\"Not implemented\");\r\n  }\r\n\r\n  clear(): void {\r\n    throw new Error(\"Not implemented\");\r\n  }\r\n\r\n  clearRecordDirtyValues(id: string): void {\r\n\r\n  }\r\n\r\n  substituteRecord(row: any[]): void {\r\n    const idx = this.allRows.findIndex((r) => this.getRowId(r) === this.getRowId(row));\r\n    if (idx > -1) {\r\n      this.allRows.splice(idx, 1, row);\r\n    }\r\n  }\r\n\r\n  insertRecord(index: number, row: any[], shouldLockNewRowAtTop?: boolean): Promise<any> {\r\n    throw new Error(\"Not implemented\");\r\n  }\r\n\r\n  @computed get dataSource() {\r\n    return getDataSource(this);\r\n  }\r\n\r\n  parent?: any;\r\n\r\n  getLastRow(): any[] | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  getParentId(row: any) {\r\n    const dataSourceField = this.dataSource.getFieldByName(this.parentIdProperty)!;\r\n    return this.getCellValueByDataSourceField(row, dataSourceField);\r\n  }\r\n\r\n  getLabel(row: any[]) {\r\n    const dataSourceField = this.dataSource.getFieldByName(\"Name\")!;\r\n    return this.getCellValueByDataSourceField(row, dataSourceField);\r\n  }\r\n\r\n  compareLabels(row1: any[], row2: any[]) {\r\n    return this.getLabel(row1).localeCompare(this.getLabel(row2));\r\n  }\r\n\r\n  isCellTextResolving(property: IProperty, value: any): boolean {\r\n    return false;\r\n  }\r\n\r\n  unlockAddedRowPosition(): void {\r\n  }\r\n\r\n  async updateSortAndFilter(data?: { retainPreviousSelection?: true }) {\r\n  }\r\n\r\n  addedRowPositionLocked: boolean = false;\r\n}\r\n\r\nexport const isTreeDataTable = (o: any): o is TreeDataTable => o.$type_TreeDataTable;\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { IDataView } from \"../../../model/entities/types/IDataView\";\r\nimport { action, computed, observable } from \"mobx\";\r\nimport S from \"./TreeView.module.css\";\r\nimport cx from \"classnames\";\r\nimport { isTreeDataTable, TreeDataTable } from \"../../../model/entities/TreeDataTable\";\r\n\r\n@observer\r\nexport class TreeView extends React.Component<{ dataView: IDataView }> {\r\n  constructor(props: Readonly<{ dataView: IDataView }>) {\r\n    super(props);\r\n\r\n    if (!isTreeDataTable(this.props.dataView.dataTable)) {\r\n      throw new Error(\"TreeView requires TreeDataTable to work properly\");\r\n    }\r\n  }\r\n\r\n  @computed\r\n  get nodes() {\r\n    const nodes = this.props.dataView.dataTable.rows.map(\r\n      (row) => new Node({\r\n        id: this.getRowId(row),\r\n        label: this.getLabel(row),\r\n        row: row,\r\n        expansionGetter: (id: string) => this.expanded.includes(id)\r\n      })\r\n    );\r\n\r\n    for (let node of nodes) {\r\n      const parentId = this.getParentId(node.row);\r\n      if (parentId) {\r\n        node.parent = nodes.find((otherNode) => otherNode.id === parentId);\r\n      }\r\n    }\r\n    return nodes;\r\n  }\r\n\r\n  getRowId(row: any) {\r\n    return this.props.dataView.dataTable.getRowId(row);\r\n  }\r\n\r\n  getParentId(row: any) {\r\n    return (this.props.dataView.dataTable as TreeDataTable).getParentId(row);\r\n  }\r\n\r\n  private getLabel(row: any[]) {\r\n    return (this.props.dataView.dataTable as TreeDataTable).getLabel(row);\r\n  }\r\n\r\n  @observable\r\n  expanded: string[] = []\r\n\r\n  onRowClick(node: Node) {\r\n    this.props.dataView.setSelectedRowId(node.id);\r\n  }\r\n\r\n  onCaretClick(node: Node) {\r\n    if (this.expanded.includes(node.id)) {\r\n      this.expanded.remove(node.id);\r\n    } else {\r\n      this.expanded.push(node.id);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className={S.treeView}>\r\n        {this.nodes\r\n          .filter((node) => node.isVisible)\r\n          .map((node) => (\r\n            <Row\r\n              key={node.id}\r\n              node={node}\r\n              isSelected={node.id === this.props.dataView.selectedRowId}\r\n              onRowClick={() => this.onRowClick(node)}\r\n              onCaretClick={() => this.onCaretClick(node)}\r\n            />\r\n          ))}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nclass Node {\r\n  id: string;\r\n  label: string;\r\n  _parent: Node | undefined;\r\n  row: any[];\r\n  isFolder: boolean = false;\r\n  expansionGetter: (nodeId: string) => boolean;\r\n\r\n  get isExpanded() {\r\n    return this.expansionGetter(this.id);\r\n  }\r\n\r\n  constructor(args: { id: string, label: string, row: any[], expansionGetter: (nodeId: string) => boolean }) {\r\n    this.id = args.id;\r\n    this.label = args.label;\r\n    this.row = args.row;\r\n    this.expansionGetter = args.expansionGetter;\r\n  }\r\n\r\n  get level() {\r\n    return this.countParents(this, 0);\r\n  }\r\n\r\n  get parent(): Node | undefined {\r\n    return this._parent;\r\n  }\r\n\r\n  set parent(value: Node | undefined) {\r\n    this._parent = value;\r\n    if (this._parent) {\r\n      this._parent.isFolder = true;\r\n    }\r\n  }\r\n\r\n  @computed\r\n  get isVisible() {\r\n    if (!this.parent) {\r\n      return true;\r\n    }\r\n    return this.parent.isExpanded;\r\n  }\r\n\r\n  private countParents(node: Node, parentCount: number): number {\r\n    if (!node.parent) {\r\n      return parentCount;\r\n    }\r\n    parentCount++;\r\n    return this.countParents(node.parent, parentCount);\r\n  }\r\n}\r\n\r\nclass Row extends React.Component<{\r\n  node: Node;\r\n  isSelected: boolean;\r\n  onRowClick: () => void;\r\n  onCaretClick: () => void;\r\n}> {\r\n  getIndent() {\r\n    return this.props.node.level * 20 + \"px\";\r\n  }\r\n\r\n  @action.bound\r\n  handleRowClick(event: any) {\r\n    this.props.onRowClick?.();\r\n    if (!this.props.node?.isExpanded) {\r\n      event.stopPropagation();\r\n      this.props.onCaretClick?.();\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  handleCaretClick(event: any) {\r\n    this.props.onCaretClick?.();\r\n    event.stopPropagation();\r\n  }\r\n\r\n  render() {\r\n    const {isExpanded} = this.props.node;\r\n    return (\r\n      <div\r\n        className={S.node + \" \" + (this.props.isSelected ? S.nodeSelected : \"\")}\r\n        onClick={this.handleRowClick}\r\n      >\r\n        <div className={S.nodeLabel} style={{paddingLeft: this.getIndent()}}>\r\n          {this.props.node.label}\r\n        </div>\r\n        {this.props.node.isFolder ? (\r\n          <div className={S.noSelect + \" \" + S.expander} onClick={this.handleCaretClick}>\r\n            <i\r\n              className={cx({\"fas fa-caret-right\": !isExpanded, \"fas fa-caret-down\": isExpanded})}\r\n            />\r\n          </div>\r\n        ) : (\r\n          \"\"\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport type IPSSubscriber<T> = (arg?: T) => void;\r\n\r\nexport class PubSub<T> {\r\n  newId = 0;\r\n  subscribers = new Map();\r\n\r\n  subscribe(subscriber: IPSSubscriber<T>) {\r\n    const myId = this.newId++;\r\n    this.subscribers.set(myId, subscriber);\r\n    return () => {\r\n      this.subscribers.delete(myId);\r\n    };\r\n  }\r\n\r\n  trigger(arg?: T) {\r\n    for (let subscriber of this.subscribers.values()) {\r\n      subscriber(arg);\r\n    }\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\n\r\nimport S from \"./FilterSettingsComboBox.module.scss\";\r\nimport { Observer, observer } from \"mobx-react\";\r\nimport { action, observable } from \"mobx\";\r\nimport { createPortal } from \"react-dom\";\r\nimport Measure from \"react-measure\";\r\nimport _ from \"lodash\";\r\n\r\n@observer\r\nexport class FilterSettingsComboBox extends React.Component<{\r\n  trigger: React.ReactNode;\r\n  id: string;\r\n}> {\r\n  @observable isDroppedDown = false;\r\n\r\n  refDropdown = React.createRef<HTMLDivElement>();\r\n\r\n  @action.bound setDroppedDown(state: boolean) {\r\n    if (state && !this.isDroppedDown) {\r\n      this.measureImm();\r\n      this.isDroppedDown = true;\r\n      window.addEventListener(\"click\", this.handleWindowClick);\r\n      window.addEventListener(\"scroll\", this.handleWindowScroll, true);\r\n    } else if (!state && this.isDroppedDown) {\r\n      this.isDroppedDown = false;\r\n      window.removeEventListener(\"click\", this.handleWindowClick);\r\n      window.removeEventListener(\"scroll\", this.handleWindowScroll, true);\r\n    }\r\n  }\r\n\r\n  @action.bound handleTriggerClick(event: any) {\r\n    if (this.isDroppedDown) {\r\n      this.setDroppedDown(false);\r\n    } else {\r\n      this.setDroppedDown(true);\r\n    }\r\n  }\r\n\r\n  @action.bound handleWindowClick(event: any) {\r\n    if (!this.refDropdown.current || !this.refDropdown.current.contains(event.target)) {\r\n      this.setDroppedDown(false);\r\n    }\r\n  }\r\n\r\n  @action.bound handleWindowScroll(event: any) {\r\n    this.setDroppedDown(false);\r\n  }\r\n\r\n  @action.bound handleDropdownClick(event: any) {\r\n    this.setDroppedDown(false);\r\n  }\r\n\r\n  @action.bound measureImm() {\r\n    this.elmMeasure?.measure();\r\n  }\r\n\r\n  measureThrottled = _.throttle(this.measureImm, 100);\r\n\r\n  refMeasure = (elm: any) => (this.elmMeasure = elm);\r\n  elmMeasure: any;\r\n\r\n  render() {\r\n    return (\r\n      <Measure ref={this.refMeasure} bounds={true}>\r\n        {({measureRef: refTriggerMeasure, contentRect: triggerContentRect}) => (\r\n          <Observer>\r\n            {() => (\r\n              <div id={this.props.id} className={S.container} ref={this.refDropdown}>\r\n                <div\r\n                  ref={refTriggerMeasure}\r\n                  className={S.trigger}\r\n                  onClick={this.handleTriggerClick}\r\n                >\r\n                  {this.props.trigger}\r\n                  <div className={S.dropdownSymbol}>\r\n                    <i className=\"fas fa-caret-down\"/>\r\n                  </div>\r\n                </div>\r\n                {this.isDroppedDown &&\r\n                  createPortal(\r\n                    <div\r\n                      id={\"dropdown_\" + this.props.id}\r\n                      className={S.dropdown}\r\n                      onClick={this.handleDropdownClick}\r\n                      style={{\r\n                        position: \"absolute\",\r\n                        top: triggerContentRect.bounds?.bottom,\r\n                        left: triggerContentRect.bounds?.left,\r\n                        minWidth: triggerContentRect.bounds?.width,\r\n                      }}\r\n                    >\r\n                      {this.props.children}\r\n                    </div>,\r\n                    document.getElementById(\"dropdown-portal\")!\r\n                  )}\r\n              </div>\r\n            )}\r\n          </Observer>\r\n        )}\r\n      </Measure>\r\n    );\r\n  }\r\n}\r\n\r\nexport const FilterSettingsComboBoxItem: React.FC<{\r\n  onClick?: (event: any) => void;\r\n}> = (props) => (\r\n  <div className={S.dropdownItem} onClick={props.onClick}>\r\n    {props.children}\r\n  </div>\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\n\r\nexport const Checkbox: React.FC<{\r\n  checked?: boolean;\r\n  indeterminate?: boolean;\r\n  onChange?: (event: any) => void;\r\n  onClick?: (event: any) => void;\r\n  onClickCapture?: (event: any) => void;\r\n  id: string;\r\n}> = props => (\r\n  <input\r\n    id={props.id}\r\n    type=\"checkbox\"\r\n    checked={props.checked}\r\n    onChange={props.onChange}\r\n    onClick={props.onClick}\r\n    onClickCapture={props.onClickCapture}\r\n    ref={el => {\r\n      if (el) {\r\n        el.indeterminate = !!props.indeterminate;\r\n      }\r\n    }}\r\n  />\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IFilterSetting } from \"../../../../../../model/entities/types/IFilterSetting\";\r\n\r\nimport { observable } from \"mobx\";\r\n\r\nexport const EDITOR_DALEY_MS = 500;\r\n\r\nexport class FilterSetting implements IFilterSetting {\r\n  @observable type: string;\r\n  @observable val1?: any;\r\n  @observable val2?: any;\r\n  isComplete: boolean;\r\n  lookupId: string | undefined;\r\n\r\n  get filterValue1() {\r\n    return this.val1;\r\n  }\r\n\r\n  get filterValue2() {\r\n    return this.type === \"between\" || this.type === \"nbetween\"\r\n      ? this.val2\r\n      : undefined;\r\n  }\r\n\r\n  get val1ServerForm() {\r\n    return this.val1;\r\n  }\r\n\r\n  get val2ServerForm() {\r\n    return this.val2;\r\n  }\r\n\r\n  constructor(type: string, isComplete: boolean = false, val1?: any, val2?: any) {\r\n    this.type = type;\r\n    this.isComplete = isComplete;\r\n    this.val1 = val1 ?? undefined;\r\n    this.val2 = val2 ?? undefined;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { T } from \"utils/translation\";\r\n\r\nexport class Operator {\r\n  static operators: Operator[] = []\r\n\r\n  private captionGetter: () => JSX.Element;\r\n  private _caption: JSX.Element | undefined;\r\n\r\n  get caption() {\r\n    if (this._caption === undefined) {\r\n      this._caption = this.captionGetter();\r\n    }\r\n    return this._caption;\r\n  }\r\n\r\n  constructor(\r\n    public type: string,\r\n    public numberValue: number,\r\n    captionGetter: () => JSX.Element) {\r\n    this.captionGetter = captionGetter;\r\n    Operator.operators.push(this);\r\n  }\r\n\r\n  static equals = new Operator(\"eq\", 1, () => <>=</>)\r\n  static between = new Operator(\"between\", 2, () => <>{T(\"between\", \"filter_operator_between\")}</>)\r\n  static startsWith = new Operator(\"starts\", 3, () => <>{T(\"begins with\", \"filter_operator_begins_with\")}</>)\r\n  static endsWith = new Operator(\"ends\", 4, () => <>{T(\"ends with\", \"filter_operator_ends_with\")}</>)\r\n  static contains = new Operator(\"contains\", 5, () => <>{T(\"contains\", \"filter_operator_contains\")}</>)\r\n  static greaterThan = new Operator(\"gt\", 6, () => <>&#62;</>)\r\n  static lessThan = new Operator(\"lt\", 7, () => <>&#60;</>)\r\n  static greaterThanOrEquals = new Operator(\"gte\", 8, () => <>&ge;</>)\r\n  static lessThanOrEquals = new Operator(\"lte\", 9, () => <>&le;</>)\r\n  static notEquals = new Operator(\"neq\", 10, () => <>&ne;</>)\r\n  static notBetween = new Operator(\"nbetween\", 11, () => <>{T(\"not between\", \"filter_operator_not_between\")}</>)\r\n  static notStartsWith = new Operator(\"nstarts\", 12, () => <>{T(\"not begins with\", \"filter_operator_not_begins_with\")}</>)\r\n  static notEndsWith = new Operator(\"nends\", 13, () => <>{T(\"not ends with\", \"filter_operator_not_ends_with\")}</>)\r\n  static notContains = new Operator(\"ncontains\", 14, () => <>{T(\"not contains\", \"filter_operator_not_contains\")}</>)\r\n  static isNull = new Operator(\"null\", 15, () => <>{T(\"is null\", \"filter_operator_is_null\")}</>)\r\n  static isNotNull = new Operator(\"nnull\", 16, () => <>{T(\"is not null\", \"filter_operator_not_is_null\")}</>)\r\n\r\n  static in = new Operator(\"in\", 1, () => <>=</>)\r\n  static notIn = new Operator(\"nin\", 10, () => <>&ne;</>)\r\n\r\n  static fromNumber(operatorNumber: number) {\r\n    const operator = Operator.operators.find(operator => operator.numberValue === operatorNumber);\r\n    if (!operator) {\r\n      throw new Error(\"Cannot find string value for filter operator number: \" + operatorNumber);\r\n    }\r\n    return operator;\r\n  }\r\n}\r\n\r\nconst filterMapComboBox = new Map<number, string>([\r\n  [1, \"in\"],\r\n  [10, \"nin\"]\r\n]);\r\nconst filterMap = new Map<number, string>([\r\n  [0, \"none\"],\r\n  [1, \"eq\"],\r\n  [2, \"between\"],\r\n  [3, \"starts\"],\r\n  [4, \"ends\"],\r\n  [5, \"contains\"],\r\n  [6, \"gt\"],\r\n  [7, \"lt\"],\r\n  [8, \"gte\"],\r\n  [9, \"lte\"],\r\n  [10, \"neq\"],\r\n  [11, \"nbetween\"],\r\n  [12, \"nstarts\"],\r\n  [13, \"nends\"],\r\n  [14, \"ncontains\"],\r\n  [15, \"null\"],\r\n  [16, \"nnull\"],\r\n]);\r\n\r\nexport function filterTypeToNumber(filterType: string) {\r\n  const typeNumber = Array.from(filterMap)\r\n      .find(entry => entry[1] === filterType)?.[0]\r\n    ?? Array.from(filterMapComboBox)\r\n      .find(entry => entry[1] === filterType)?.[0]\r\n  if (!typeNumber) {\r\n    throw new Error(\"Cannot find filter operator number for filter type: \" + filterType)\r\n  }\r\n  return typeNumber;\r\n}\r\n\r\nexport function filterTypeFromNumber(filterOperatorNum: number, columnType: string) {\r\n  const stringValue = columnType === \"ComboBox\"\r\n    ? filterMapComboBox.get(filterOperatorNum) ?? filterMap.get(filterOperatorNum)\r\n    : filterMap.get(filterOperatorNum);\r\n  if (!stringValue) {\r\n    throw new Error(\"Cannot find string value for filter operator number: \" + filterOperatorNum)\r\n  }\r\n  return stringValue;\r\n}\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport S from \"gui/connections/MobileComponents/Form/MobileBooleanInput.module.scss\";\r\n\r\nexport const MobileBooleanInput: React.FC<{\r\n  checked: boolean | null | undefined;\r\n  onChange: (event: IBooleanEvent)=> void;\r\n  disabled?: boolean;\r\n}> = (props) => {\r\n\r\n  function onClick(){\r\n    if(!props.disabled){\r\n      props.onChange({\r\n        target: {checked: !props.checked},\r\n        type: \"click\"\r\n      })\r\n    }\r\n  }\r\n\r\n  function getStateClass(){\r\n    if(props.checked === null || props.checked === undefined){\r\n      return S.undefined;\r\n    }\r\n    if(props.checked){\r\n      return S.on;\r\n    }\r\n    return S.off;\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className={S.root}\r\n      onClick={onClick}\r\n    >\r\n      <div className={S.slot + \" \" + getStateClass() + \" \" + (props.disabled ? S.readOnly : \"\")}>\r\n        <div className={S.nob}/>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport interface IBooleanEvent {\r\n  target: IBooleanTarget;\r\n  type: string\r\n}\r\n\r\nexport interface IBooleanTarget {\r\n  checked: boolean\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n/* eslint-disable no-whitespace-before-property */\r\nimport React from \"react\";\r\nimport { FilterSettingsComboBox, FilterSettingsComboBoxItem } from \"../FilterSettingsComboBox\";\r\n\r\nimport { Checkbox } from \"gui/Components/CheckBox/Checkbox\";\r\nimport { observer } from \"mobx-react\";\r\nimport { action } from \"mobx\";\r\nimport { FilterSetting } from \"./FilterSetting\";\r\nimport { Operator } from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/Operator\";\r\nimport { MobileBooleanInput } from \"gui/connections/MobileComponents/Form/MobileBooleanInput\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\nimport S from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/FilterSettingsBoolean.module.scss\";\r\n\r\nconst OPERATORS: Operator[] = [Operator.equals];\r\n\r\n@observer\r\nexport class FilterSettingsBoolean extends React.Component<{\r\n  setting?: any;\r\n  id: string;\r\n  ctx: any;\r\n}> {\r\n\r\n  static get defaultSettings() {\r\n    return new FilterSetting(OPERATORS[0].type)\r\n  }\r\n\r\n  @action.bound handleValueClick(event: any) {\r\n    const setting = this.props.setting;\r\n    if (setting.val1 === undefined) {\r\n      setting.val1 = false;\r\n      setting.isComplete = true;\r\n    } else if (setting.val1 === false) {\r\n      setting.val1 = true;\r\n      setting.isComplete = true;\r\n    } else if (setting.val1 === true) {\r\n      setting.val1 = undefined;\r\n      setting.isComplete = false;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        <FilterSettingsComboBox\r\n          id={\"combo_\" + this.props.id}\r\n          trigger={<>=</>}\r\n        >\r\n          <FilterSettingsComboBoxItem>=</FilterSettingsComboBoxItem>\r\n        </FilterSettingsComboBox>\r\n        {isMobileLayoutActive(this.props.ctx)\r\n          ? <div className={S.mobileInputContainer}>\r\n            <MobileBooleanInput\r\n              checked={this.props.setting.val1}\r\n              onChange={this.handleValueClick}\r\n            />\r\n          </div>\r\n          : <Checkbox\r\n            id={\"input_\" + this.props.id}\r\n            indeterminate={this.props.setting.val1 === undefined}\r\n            checked={this.props.setting.val1}\r\n            onClick={this.handleValueClick}\r\n          />\r\n        }\r\n      </>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/connections/MobileComponents/Grid/InputClearButton.module.scss\";\r\n\r\nexport const InputClearButton: React.FC<{\r\n  visible: boolean;\r\n  onClick: (event: any) => void;\r\n}> = (props) => {\r\n\r\n  if(!props.visible){\r\n    return null;\r\n  }\r\n  return (\r\n    <button\r\n        className={S.root}\r\n        onClick={props.onClick}\r\n      >\r\n      X\r\n      </button>\r\n  );\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useContext } from \"react\";\r\nimport S from \"gui/connections/MobileComponents/Grid/ClearableInput.module.scss\";\r\nimport { MobXProviderContext } from \"mobx-react\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\nimport { InputClearButton } from \"gui/connections/MobileComponents/Grid/InputClearButton\";\r\n\r\ninterface IClearableInputData{\r\n  id?: string;\r\n  className?: string;\r\n  value?: string;\r\n  onChange?: (event: any) => void;\r\n  onBlur?: (event: any) => void;\r\n  autofocus?: boolean;\r\n}\r\n\r\nexport const ClearableInput = React.forwardRef<HTMLInputElement, IClearableInputData>((props, ref) => {\r\n\r\n  const application = useContext(MobXProviderContext).application;\r\n\r\n  if (!isMobileLayoutActive(application)) {\r\n    return <input\r\n      id={props.id}\r\n      className={props.className}\r\n      value={props.value}\r\n      onChange={props.onChange}\r\n      onBlur={props.onBlur}\r\n      ref={ref}\r\n    />\r\n  }\r\n\r\n  function onClearClick() {\r\n    const event = {target: {value: \"\"}};\r\n    props.onChange?.(event);\r\n  }\r\n\r\n  return (\r\n    <div className={S.root}>\r\n      <input\r\n        id={props.id}\r\n        className={props.className}\r\n        value={props.value}\r\n        onChange={props.onChange}\r\n        onBlur={props.onBlur}\r\n        ref={ref}\r\n      />\r\n      <InputClearButton\r\n        visible={props.value !== \"\"}\r\n        onClick={onClearClick}\r\n      />\r\n    </div>\r\n  );\r\n});\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport {\r\n  FilterSettingsComboBox,\r\n  FilterSettingsComboBoxItem,\r\n} from \"gui/Components/ScreenElements/Table/FilterSettings/FilterSettingsComboBox\";\r\n\r\nimport CS from \"./FilterSettingsCommon.module.scss\";\r\nimport { action, observable, runInAction } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport { EDITOR_DALEY_MS, FilterSetting } from \"./FilterSetting\";\r\nimport { Operator } from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/Operator\";\r\nimport { ClearableInput } from \"gui/connections/MobileComponents/Grid/ClearableInput\";\r\n\r\nconst OPERATORS = [\r\n  Operator.contains,\r\n  Operator.startsWith,\r\n  Operator.notStartsWith,\r\n  Operator.notContains,\r\n  Operator.endsWith,\r\n  Operator.notEndsWith,\r\n  Operator.equals,\r\n  Operator.notEquals,\r\n  Operator.isNull,\r\n  Operator.isNotNull,\r\n];\r\n\r\nconst OpCombo: React.FC<{\r\n  setting: any;\r\n  id: string;\r\n  onChange: () => void;\r\n}> = observer((props) => {\r\n  return (\r\n    <FilterSettingsComboBox\r\n      id={props.id}\r\n      trigger={<>{(OPERATORS.find((op) => op.type === props.setting.type) || {}).caption}</>}\r\n    >\r\n      {OPERATORS.map((op) => (\r\n        <FilterSettingsComboBoxItem\r\n          key={op.type}\r\n          onClick={() =>\r\n            runInAction(() => {\r\n                props.setting.type = op.type;\r\n                props.onChange()\r\n              }\r\n            )}\r\n        >\r\n          {op.caption}\r\n        </FilterSettingsComboBoxItem>\r\n      ))}\r\n    </FilterSettingsComboBox>\r\n  );\r\n});\r\n\r\n\r\n@observer\r\nclass OpEditors extends React.Component<{\r\n  id: string;\r\n  setting?: any;\r\n  onCurrentValueChanged: (currentValue: string) => void;\r\n  currentValue: string;\r\n  onChange: () => void;\r\n  autoFocus: boolean;\r\n}> {\r\n\r\n  inputRef = (elm: any) => (this.inputTag = elm);\r\n  inputTag: any;\r\n\r\n  componentDidMount() {\r\n    if (this.props.autoFocus) {\r\n      setTimeout(() => {\r\n        this.inputTag?.focus();\r\n      });\r\n    }\r\n  }\r\n\r\n  render() {\r\n    switch (this.props.setting.type) {\r\n      case \"eq\":\r\n      case \"neq\":\r\n      case \"starts\":\r\n      case \"nstarts\":\r\n      case \"ends\":\r\n      case \"nends\":\r\n      case \"contains\":\r\n      case \"ncontains\":\r\n        return (\r\n          <ClearableInput\r\n            id={this.props.id}\r\n            className={CS.input}\r\n            value={this.props.currentValue ?? \"\"}\r\n            onChange={(event: any) => this.props.onCurrentValueChanged(event.target.value)}\r\n            onBlur={this.props.onChange}\r\n            ref={this.inputRef}\r\n          />\r\n        );\r\n      case \"null\":\r\n      case \"nnull\":\r\n      default:\r\n        return null;\r\n    }\r\n\r\n  }\r\n}\r\n\r\n@observer\r\nexport class FilterSettingsString extends React.Component<{\r\n  setting?: any;\r\n  autoFocus: boolean;\r\n  onChange: ()=>void;\r\n  id:string;\r\n}> {\r\n\r\n  static get defaultSettings() {\r\n    return new FilterSetting(OPERATORS[0].type)\r\n  }\r\n\r\n  @action.bound\r\n  handleChange() {\r\n    const setting = this.props.setting;\r\n    setting.isComplete = setting.type === \"null\" || setting.type === \"nnull\" || setting.val1 !== undefined;\r\n    setting.val2 = undefined;\r\n  }\r\n\r\n  @action.bound\r\n  handleFilterTypeChange() {\r\n    if (this.props.setting.type === \"null\" || this.props.setting.type === \"nnull\") {\r\n      this.currentValue = \"\";\r\n      this.props.setting.val1 = undefined;\r\n      this.props.setting.val2 = undefined;\r\n    }\r\n    this.handleChange();\r\n  }\r\n\r\n  componentDidUpdate(prevProps: any) {\r\n    if (prevProps.setting.val1 !== this.props.setting.val1) {\r\n      this.currentValue = this.props.setting.val1;\r\n    }\r\n  }\r\n\r\n  @observable\r\n  currentValue = this.props.setting.val1;\r\n\r\n  onCurrentValueChanged(newValue: string) {\r\n    this.currentValue = newValue;\r\n\r\n    const timeOutId = setTimeout(() => {\r\n      runInAction(() => {\r\n        this.props.setting.val1 = this.currentValue === \"\" ? undefined : this.currentValue;\r\n        this.handleChange();\r\n        this.props.onChange();\r\n      })\r\n    }, EDITOR_DALEY_MS);\r\n    return () => {\r\n      clearTimeout(timeOutId);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        <OpCombo\r\n          id={\"combo_\"+this.props.id}\r\n          setting={this.props.setting}\r\n          onChange={this.handleFilterTypeChange} />\r\n        <OpEditors\r\n          id={\"input_\"+this.props.id}\r\n          setting={this.props.setting} \r\n          onChange={this.handleChange}\r\n          currentValue={this.currentValue}\r\n          onCurrentValueChanged={value => this.onCurrentValueChanged(value)}\r\n          autoFocus={this.props.autoFocus}/>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport * as React from \"react\";\r\nimport moment from \"moment\";\r\nimport { action, observable } from \"mobx\";\r\nimport S from \"gui/Components/ScreenElements/Editors/DateTimeEditor/CalendarWidget.module.scss\";\r\nimport cx from \"classnames\";\r\n\r\n@observer\r\nexport class CalendarWidget extends React.Component<{\r\n  initialDisplayDate?: moment.Moment;\r\n  selectedDay?: moment.Moment;\r\n  onDayClick?(event: any, day: moment.Moment): void;\r\n}> {\r\n  @observable.ref\r\n  displayedMonth = moment(this.props.initialDisplayDate).startOf(\"month\");\r\n\r\n  componentDidUpdate(\r\n    prevProps: Readonly<{ initialDisplayDate?: moment.Moment; selectedDay?: moment.Moment; onDayClick?(event: any, day: moment.Moment): void }>,\r\n    prevState: Readonly<{}>,\r\n    snapshot?: any) {\r\n    if (\r\n      this.props.initialDisplayDate !== prevProps.initialDisplayDate &&\r\n      this.props.initialDisplayDate?.isValid()\r\n    ) {\r\n      this.displayedMonth = moment(this.props.initialDisplayDate).startOf(\"month\");\r\n    }\r\n  }\r\n\r\n  getDayHeaders() {\r\n    const result: any[] = [];\r\n    for (\r\n      let day = moment(this.displayedMonth).startOf(\"week\"), i = 0;\r\n      i < 7;\r\n      day.add({days: 1}), i++\r\n    ) {\r\n      result.push(\r\n        <div\r\n          key={day.toISOString()}\r\n          className={S.dayHeaderCell}\r\n          title={day.format(\"dddd\")}\r\n        >\r\n          {day.format(\"dd\")[0]}\r\n        </div>\r\n      );\r\n    }\r\n    return result;\r\n  }\r\n\r\n  getDates(weekInc: number) {\r\n    const result: any[] = [];\r\n    const today = moment();\r\n    for (\r\n      let day = moment(this.displayedMonth).startOf(\"week\").add({weeks: weekInc}), i = 0;\r\n      i < 7;\r\n      day.add({days: 1}), i++\r\n    ) {\r\n      const isNeighbourMonth = day.month() !== this.displayedMonth.month();\r\n      const isSelectedDay = day.isSame(this.props.selectedDay, \"day\");\r\n      const isToday = day.isSame(today, \"days\");\r\n      const dayCopy = moment(day);\r\n      result.push(\r\n        <div\r\n          key={day.toISOString()}\r\n          className={cx(\"calendarWidgetCell\", {\r\n            [S.neighbourMonthCell]: isNeighbourMonth,\r\n            [S.selectedDay]: isSelectedDay,\r\n            isToday,\r\n          })}\r\n          onClick={(event: any) => this.handleDayClick(event, dayCopy)}\r\n        >\r\n          {day.format(\"D\")}\r\n        </div>\r\n      );\r\n    }\r\n    return result;\r\n  }\r\n\r\n  getDateRows() {\r\n    const result: any[] = [];\r\n    for (let i = 0; i < 6; i++) {\r\n      result.push(<div key={i} className={S.row}>{this.getDates(i)}</div>);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  @action.bound\r\n  handleMonthDecClick(event: any) {\r\n    this.displayedMonth = moment(this.displayedMonth).subtract({months: 1});\r\n  }\r\n\r\n  @action.bound\r\n  handleMonthIncClick(event: any) {\r\n    this.displayedMonth = moment(this.displayedMonth).add({months: 1});\r\n  }\r\n\r\n  @action.bound\r\n  handleYearDecClick(event: any) {\r\n    this.displayedMonth = moment(this.displayedMonth).subtract({years: 1});\r\n  }\r\n\r\n  @action.bound\r\n  handleYearIncClick(event: any) {\r\n    this.displayedMonth = moment(this.displayedMonth).add({years: 1});\r\n  }\r\n\r\n  @action.bound handleDayClick(event: any, day: moment.Moment) {\r\n    this.props.onDayClick && this.props.onDayClick(event, day);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div\r\n        className={S.container}\r\n        onMouseDown={(e) => {\r\n          /* Prevent mousedown default action causong onblur being fired on the editors input\r\n              which triggered data update\r\n          */\r\n          e.preventDefault();\r\n        }}\r\n      >\r\n        <div className={S.dayTable}>\r\n          <div className={S.row}>\r\n            <div className={S.header}>\r\n              <button className={S.controlBtn} onClick={this.handleMonthDecClick}>\r\n                <i className=\"fas fa-caret-left\"/>\r\n              </button>\r\n              <button className={S.controlBtn} onClick={this.handleMonthIncClick}>\r\n                <i className=\"fas fa-caret-right\"/>\r\n              </button>\r\n              <div\r\n                className={S.title}\r\n                title={this.displayedMonth.format(\"YYYY MMMM\")}\r\n              >\r\n                {this.displayedMonth.format(\"YYYY MMMM\")}\r\n              </div>\r\n              <button className={S.controlBtn} onClick={this.handleYearDecClick}>\r\n                <i className=\"fas fa-caret-down\"/>\r\n              </button>\r\n              <button className={S.controlBtn} onClick={this.handleYearIncClick}>\r\n                <i className=\"fas fa-caret-up\"/>\r\n              </button>\r\n            </div>\r\n          </div>\r\n          <div className={S.row}>{this.getDayHeaders()}</div>\r\n          {this.getDateRows()}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport moment from \"moment\";\r\nimport { DateSequence } from \"../../../../utils/cookies\";\r\n\r\nexport default class DateCompleter {\r\n  dateSequence: DateSequence;\r\n  expectedFormat: string;\r\n  dateSeparator: string;\r\n  timeSeparator: string;\r\n  dateTimeSeparator: string;\r\n  expectedDateFormat: string;\r\n  timeNowFunc: () => moment.Moment;\r\n\r\n  constructor(\r\n    dateSequence: DateSequence,\r\n    expectedFormat: string,\r\n    dateSeparator: string,\r\n    timeSeparator: string,\r\n    dateTimeSeparator: string,\r\n    timeNowFunc: () => moment.Moment\r\n  ) {\r\n    this.expectedFormat = expectedFormat;\r\n    this.dateSeparator = dateSeparator;\r\n    this.timeSeparator = timeSeparator;\r\n    this.dateTimeSeparator = dateTimeSeparator;\r\n    this.expectedDateFormat = this.expectedFormat.split(this.dateTimeSeparator)[0];\r\n    this.timeNowFunc = timeNowFunc;\r\n    this.dateSequence = dateSequence;\r\n  }\r\n\r\n  isUSCompletionTriggered(datetimeTextIn: string) {\r\n    const t = datetimeTextIn;\r\n    return (\r\n      t.match(/^\\d\\d?\\d?$/) ||\r\n      t.match(/^\\d\\d\\d\\d\\d\\d\\d\\d$/) ||\r\n      t.match(/^\\d\\d\\d\\d\\d\\d$/) ||\r\n      t.match(/^\\d\\d\\d\\s+\\d\\d\\d\\d$/) ||\r\n      t.match(/^\\d\\d\\d\\d?\\s+\\d\\d$/) ||\r\n      t.match(/^\\d\\d\\d\\d\\d\\d\\d\\d\\s+\\d\\d\\d\\d\\d\\d$/) ||\r\n      t.match(/^\\d\\d?\\/\\d\\d?$/) ||\r\n      t.match(/^\\d\\d?\\/\\d\\d?\\s+\\d\\d?$/) ||\r\n      t.match(/^\\d\\d?\\/\\d\\d?\\s+\\d\\d\\d\\d$/) ||\r\n      t.match(/^\\d\\d?\\/\\d\\d?\\s+\\d\\d:\\d\\d$/) ||\r\n      t.match(/^\\d\\d?\\/\\d\\d?\\/\\d\\d?$/)\r\n    );\r\n  }\r\n\r\n  isEUCompletionTriggered(datetimeTextIn: string) {\r\n    const t = datetimeTextIn;\r\n    return (\r\n      t.match(/^\\d\\d\\d\\d$/) ||\r\n      t.match(/^\\d\\d\\d\\d\\d\\d\\d\\d$/) ||\r\n      t.match(/^\\d\\d\\d\\d\\d\\d$/) ||\r\n      t.match(/^\\d\\d\\d\\d\\s+\\d\\d\\d\\d$/) ||\r\n      t.match(/^\\d\\d\\d\\d\\s+\\d\\d$/) ||\r\n      t.match(/^\\d\\d\\d\\d\\d\\d\\d\\d \\d\\d\\d\\d\\d\\d$/) ||\r\n      t.match(/^\\d\\d?$/)\r\n    );\r\n  }\r\n\r\n  autoComplete(text: string | undefined): moment.Moment | undefined {\r\n    if (!text) {\r\n      return undefined;\r\n    }\r\n    const trimmedText = text.trim();\r\n    if (this.dateSequence === DateSequence.MonthDayYear) {\r\n      if (!this.isUSCompletionTriggered(trimmedText)) return;\r\n    } else {\r\n      if (!this.isEUCompletionTriggered(trimmedText)) return;\r\n    }\r\n    const dateAndTime = trimmedText.split(this.dateTimeSeparator);\r\n    const dateText = dateAndTime[0];\r\n    let completeDate = this.autoCompleteDate(dateText);\r\n\r\n    if (dateAndTime.length === 2) {\r\n      const timeText = dateAndTime[1];\r\n      const completeTime = this.autoCompleteTime(timeText);\r\n      completeDate += this.dateTimeSeparator + completeTime;\r\n    }\r\n    return moment(completeDate, this.expectedFormat);\r\n  }\r\n\r\n  reformat(completeDateTime: string) {\r\n    const dateTime = moment(completeDateTime, this.expectedFormat);\r\n    if (dateTime.hour() === 0 && dateTime.minute() === 0 && dateTime.second() === 0) {\r\n      return dateTime.format(this.expectedDateFormat);\r\n    }\r\n    return dateTime.format(this.expectedFormat);\r\n  }\r\n\r\n  autoCompleteTime(incompleteTime: string): string {\r\n    if (incompleteTime.includes(this.timeSeparator)) {\r\n      return this.completeTimeWithSeparators(incompleteTime);\r\n    }\r\n    return this.completeTimeWithoutSeparators(incompleteTime);\r\n  }\r\n\r\n  completeTimeWithoutSeparators(incompleteTime: string): string {\r\n    switch (incompleteTime.length) {\r\n      case 1:\r\n      case 2:\r\n        return incompleteTime + this.timeSeparator + \"00\" + this.timeSeparator + \"00\";\r\n      case 3:\r\n      case 4:\r\n        return (\r\n          incompleteTime.substring(0, 2) +\r\n          this.timeSeparator +\r\n          incompleteTime.substring(2) +\r\n          this.timeSeparator +\r\n          \"00\"\r\n        );\r\n      default:\r\n        return (\r\n          incompleteTime.substring(0, 2) +\r\n          this.timeSeparator +\r\n          incompleteTime.substring(2, 4) +\r\n          this.timeSeparator +\r\n          incompleteTime.substring(4)\r\n        );\r\n    }\r\n  }\r\n\r\n  completeTimeWithSeparators(incompleteTime: string): string {\r\n    const splitTime = incompleteTime.split(this.timeSeparator);\r\n    if (splitTime.length === 2) {\r\n      return moment([2010, 1, 1, splitTime[0], splitTime[1], 0, 0]).format(\"hh:mm:ss A\");\r\n    }\r\n    if (splitTime.length === 3) {\r\n      return moment([2010, 1, 1, splitTime[0], splitTime[1], splitTime[2], 0]).format(\"hh:mm:ss A\");\r\n    }\r\n    return incompleteTime;\r\n  }\r\n\r\n  autoCompleteDate(incompleteDate: string): string {\r\n    return incompleteDate.includes(this.dateSeparator)\r\n      ? this.completeDateWithSeparators(incompleteDate)\r\n      : this.completeDateWithoutSeparators(incompleteDate);\r\n  }\r\n\r\n  completeDateWithSeparators(incompleteDate: string): string {\r\n    const splitDate = incompleteDate.split(this.dateSeparator);\r\n    if (splitDate.length === 2) {\r\n      return incompleteDate + this.dateSeparator + this.timeNowFunc().year();\r\n    } else {\r\n      return incompleteDate;\r\n    }\r\n  }\r\n\r\n  completeDateWithoutSeparators(incompleteDate: string): string {\r\n    switch (incompleteDate.length) {\r\n      case 1:\r\n      case 2: {\r\n        // assuming input is always a day.\r\n        return this.addMonthAndYear(incompleteDate);\r\n      }\r\n      case 3:\r\n      case 4: {\r\n        // assuming input is day and month in order specified by\r\n        // current culture\r\n        return this.addYear(incompleteDate);\r\n      }\r\n      case 6: {\r\n        // assuming input is day and month in order specified by\r\n        // current culture followed by incomplete year (yy)\r\n        const incompleteWithSeparators = this.addSeparators(incompleteDate);\r\n        return incompleteWithSeparators;\r\n      }\r\n      default:\r\n        return this.addSeparators(incompleteDate);\r\n    }\r\n  }\r\n\r\n  addMonthAndYear(day: string): string {\r\n    const now = this.timeNowFunc();\r\n    const usDateString = now.month() + 1 + \"/\" + day + \"/\" + now.year();\r\n\r\n    const date = moment(usDateString, \"M/D/YYYY\");\r\n\r\n    return date ? date.format(this.expectedDateFormat) : day;\r\n  }\r\n\r\n  addYear(dayAndMonth: string): string {\r\n    return (\r\n      dayAndMonth.substring(0, 2) +\r\n      this.dateSeparator +\r\n      dayAndMonth.substring(2) +\r\n      this.dateSeparator +\r\n      this.timeNowFunc().year()\r\n    );\r\n  }\r\n\r\n  addSeparators(incompleteDate: string): string {\r\n    const format = this.getDoubleDayAndMonthFormat();\r\n\r\n    const firstIndex = format.indexOf(this.dateSeparator);\r\n    const secondIndex = format.lastIndexOf(this.dateSeparator);\r\n    const dateLength = incompleteDate.length;\r\n\r\n    if (firstIndex < dateLength && secondIndex >= dateLength) {\r\n      return (\r\n        incompleteDate.substring(0, firstIndex) +\r\n        this.dateSeparator +\r\n        incompleteDate.substring(firstIndex)\r\n      );\r\n    }\r\n    if (firstIndex < dateLength && secondIndex < dateLength) {\r\n      return (\r\n        incompleteDate.substring(0, firstIndex) +\r\n        this.dateSeparator +\r\n        incompleteDate.substring(firstIndex, firstIndex + 2) +\r\n        this.dateSeparator +\r\n        incompleteDate.substring(secondIndex - 1)\r\n      );\r\n    }\r\n    return incompleteDate;\r\n  }\r\n\r\n  getDoubleDayAndMonthFormat(): string {\r\n    // dateFormat might be d/m/yyyy, this,\r\n    // method makes sure we get dd/mm/yyyy\r\n    const formatHasSingleDigitDayAndMonth = this.expectedDateFormat.length === 8;\r\n    let format;\r\n    if (formatHasSingleDigitDayAndMonth) {\r\n      format = this.expectedFormat.toLowerCase().replace(\"d\", \"dd\").replace(\"m\", \"mm\");\r\n    } else {\r\n      format = this.expectedFormat;\r\n    }\r\n    return format;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n\r\nimport { action, computed, observable } from \"mobx\";\r\nimport { toOrigamServerString } from \"@origam/utils\";\r\nimport { getDefaultCsDateFormatDataFromCookie } from \"utils/cookies\";\r\nimport DateCompleter from \"gui/Components/ScreenElements/Editors/DateCompleter\";\r\nimport moment, { Moment } from \"moment\";\r\n\r\nexport interface IEditorState{\r\n  value: string | null;\r\n}\r\n\r\nexport class DateEditorModel {\r\n  constructor(\r\n    private editorState: IEditorState,\r\n    public outputFormat: string,\r\n    private onChange?: (event: any, isoDay: string | undefined | null) => void,\r\n    private onClick?: (event: any) => void,\r\n    private onKeyDown?: (event: any) => void,\r\n    private onEditorBlur?: (event: any) => void,\r\n    private onChangeByCalendar?: (event: any, isoDay: string) => void\r\n  ) {\r\n  }\r\n\r\n  @action.bound handleInputBlur(event: any) {\r\n    const dateCompleter = this.getDateCompleter();\r\n    const completedMoment = dateCompleter.autoComplete(this.dirtyTextualValue);\r\n    if (completedMoment) {\r\n      this.onChange?.(event, toOrigamServerString(completedMoment));\r\n    } else if (this.momentValue?.isValid()) {\r\n      this.onChange?.(event, toOrigamServerString(this.momentValue));\r\n    }\r\n\r\n    this.dirtyTextualValue = undefined;\r\n    this.onEditorBlur && this.onEditorBlur(event);\r\n  }\r\n\r\n  private get autoCompletedMoment() {\r\n    const dateCompleter = this.getDateCompleter();\r\n    return dateCompleter.autoComplete(this.dirtyTextualValue);\r\n  }\r\n\r\n  get autocompletedText() {\r\n    const completedMoment = this.autoCompletedMoment;\r\n    if (completedMoment) {\r\n      if (this.autoCompletedMoment?.isValid()) {\r\n        return this.formatMomentValue(this.autoCompletedMoment);\r\n      } else return \"?\";\r\n    } else {\r\n      if (this.momentValue?.isValid()) {\r\n        return this.formatMomentValue(this.momentValue);\r\n      } else return \"?\";\r\n    }\r\n  }\r\n\r\n  @action.bound getDateCompleter() {\r\n    const formatData = getDefaultCsDateFormatDataFromCookie();\r\n    return new DateCompleter(\r\n      formatData.defaultDateSequence,\r\n      this.outputFormat,\r\n      formatData.defaultDateSeparator,\r\n      formatData.defaultTimeSeparator,\r\n      formatData.defaultDateTimeSeparator,\r\n      () => moment()\r\n    );\r\n  }\r\n\r\n\r\n  @action.bound handleTextFieldChange(event: any) {\r\n    this.dirtyTextualValue = event.target.value;\r\n    if (this.dirtyTextualValue === \"\") {\r\n      this.onChange && this.onChange(event, null);\r\n      return;\r\n    }\r\n  }\r\n\r\n  @action.bound handleKeyDown(event: any) {\r\n    if (event.key === \"Enter\" || event.key === \"Tab\") {\r\n      const completedMoment = this.autoCompletedMoment;\r\n      if (completedMoment) {\r\n        this.onChange?.(event, toOrigamServerString(completedMoment));\r\n      } else if (this.momentValue?.isValid()) {\r\n        this.onChange?.(event, toOrigamServerString(this.momentValue));\r\n      }\r\n      this.dirtyTextualValue = undefined;\r\n    } else if (event.key === \"Escape\") {\r\n    }\r\n    this.onKeyDown?.(event);\r\n  }\r\n\r\n  @observable dirtyTextualValue: string | undefined;\r\n\r\n  get momentValue() {\r\n    if (this.dirtyTextualValue) {\r\n      return moment(this.dirtyTextualValue, this.outputFormat);\r\n    }\r\n    return !!this.editorState.value ? moment(this.editorState.value) : null;\r\n  }\r\n\r\n  formatMomentValue(value: Moment | null | undefined) {\r\n    if (!value) return \"\";\r\n    return value.format(this.outputFormat);\r\n  }\r\n\r\n  get formattedMomentValue() {\r\n    return this.formatMomentValue(this.momentValue);\r\n  }\r\n\r\n  @computed get textFieldValue() {\r\n    return this.dirtyTextualValue !== undefined && this.dirtyTextualValue !== \"\"\r\n      ? this.dirtyTextualValue\r\n      : this.formattedMomentValue;\r\n  }\r\n\r\n\r\n  @action.bound handleDayClick(event: any, day: moment.Moment) {\r\n    this.dirtyTextualValue = undefined;\r\n    this.onChangeByCalendar && this.onChangeByCalendar(event, day.toISOString(true));\r\n    this.onChange && this.onChange(event, toOrigamServerString(day));\r\n  }\r\n\r\n  onClearClick(event: any){\r\n    this.dirtyTextualValue = undefined;\r\n    this.onChange && this.onChange(event, null);\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Dropdowner } from \"gui/Components/Dropdowner/Dropdowner\";\r\nimport { action, computed, observable, runInAction } from \"mobx\";\r\nimport { observer, Observer } from \"mobx-react\";\r\nimport moment from \"moment\";\r\nimport * as React from \"react\";\r\nimport { IFocusable } from \"model/entities/FormFocusManager\";\r\nimport S from \"gui/Components/ScreenElements/Editors/DateTimeEditor/DateTimeEditor.module.scss\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { CalendarWidget } from \"gui/Components/ScreenElements/Editors/DateTimeEditor/CalendarWidget\";\r\nimport {\r\n  DateEditorModel,\r\n  IEditorState\r\n} from \"gui/Components/ScreenElements/Editors/DateTimeEditor/DateEditorModel\";\r\nimport cx from \"classnames\";\r\n\r\n\r\nclass DesktopEditorState implements IEditorState{\r\n  constructor(value: string | null) {\r\n    this.value = value;\r\n  }\r\n\r\n  @observable\r\n  value : string | null;\r\n}\r\n\r\n@observer\r\nexport class DateTimeEditor extends React.Component<{\r\n  id?: string;\r\n  value: string | null;\r\n  outputFormat: string;\r\n  outputFormatToShow: string;\r\n  isReadOnly?: boolean;\r\n  autoFocus?: boolean;\r\n  foregroundColor?: string;\r\n  backgroundColor?: string;\r\n  onChange?: (event: any, isoDay: string | undefined | null) => void;\r\n  onChangeByCalendar?: (event: any, isoDay: string) => void;\r\n  onClick?: (event: any) => void;\r\n  onDoubleClick?: (event: any) => void;\r\n  onKeyDown?: (event: any) => void;\r\n  onEditorBlur?: (event: any) => void;\r\n  refocuser?: (cb: () => void) => () => void;\r\n  subscribeToFocusManager?: (obj: IFocusable) => void;\r\n  className?: string;\r\n}> {\r\n  @observable isDroppedDown = false;\r\n\r\n  @observable isShowFormatHintTooltip = false;\r\n\r\n  refDropdowner = (elm: Dropdowner | null) => (this.elmDropdowner = elm);\r\n  elmDropdowner: Dropdowner | null = null;\r\n\r\n  editorState = new DesktopEditorState(this.props.value);\r\n\r\n  editorModel = new DateEditorModel(\r\n    this.editorState,\r\n    this.props.outputFormat,\r\n    this.props.onChange,\r\n    this.props.onClick,\r\n    this.props.onKeyDown,\r\n    this.props.onEditorBlur,\r\n    this.props.onChangeByCalendar);\r\n\r\n  @action.bound handleDropperClick(event: any) {\r\n    event.stopPropagation();\r\n    this.makeDroppedDown();\r\n  }\r\n\r\n  @action.bound makeDroppedDown() {\r\n    if (!this.isDroppedDown) {\r\n      this.isDroppedDown = true;\r\n      window.addEventListener(\"click\", this.handleWindowClick);\r\n    }\r\n  }\r\n\r\n  @action.bound makeDroppedUp() {\r\n    if (this.isDroppedDown) {\r\n      this.isDroppedDown = false;\r\n      window.removeEventListener(\"click\", this.handleWindowClick);\r\n    }\r\n  }\r\n\r\n  @action.bound handleWindowClick(event: any) {\r\n    if (this.elmContainer && !this.elmContainer.contains(event.target)) {\r\n      this.makeDroppedUp();\r\n    }\r\n  }\r\n\r\n  disposers: any[] = [];\r\n\r\n  componentDidMount() {\r\n    this.makeFocusedIfNeeded();\r\n    if (this.elmInput && this.props.subscribeToFocusManager) {\r\n      this.props.subscribeToFocusManager(this.elmInput);\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.disposers.forEach((d) => d());\r\n  }\r\n\r\n  componentDidUpdate(prevProps: { value: string | null }) {\r\n    runInAction(() => {\r\n      if (prevProps.value !== null && this.props.value === null) {\r\n        this.editorModel.dirtyTextualValue = \"\";\r\n      }\r\n    });\r\n    this.editorState.value = this.props.value;\r\n  }\r\n\r\n  @action.bound\r\n  makeFocusedIfNeeded() {\r\n    setTimeout(() => {\r\n      if ((this.props.autoFocus) && this.elmInput) {\r\n        this.elmInput.select();\r\n        this.elmInput.focus();\r\n        this.elmInput.scrollLeft = 0;\r\n      }\r\n    });\r\n  }\r\n\r\n  _hLocationInterval: any;\r\n\r\n  @action.bound\r\n  handleWindowMouseWheel(e: any) {\r\n    this.setShowFormatHint(false);\r\n  }\r\n\r\n  @action.bound\r\n  setShowFormatHint(state: boolean) {\r\n    if (state && !this.isShowFormatHintTooltip) {\r\n      this.measureInputElement();\r\n      this._hLocationInterval = setInterval(() => this.measureInputElement(), 500);\r\n      window.addEventListener(\"mousewheel\", this.handleWindowMouseWheel);\r\n    } else if (!state && this.isShowFormatHintTooltip) {\r\n      clearInterval(this._hLocationInterval);\r\n      window.removeEventListener(\"mousewheel\", this.handleWindowMouseWheel);\r\n    }\r\n    this.isShowFormatHintTooltip = state;\r\n  }\r\n\r\n  @action.bound handleInputBlur(event: any) {\r\n    this.setShowFormatHint(false);\r\n    this.editorModel.handleInputBlur(event);\r\n  }\r\n\r\n  @action.bound handleKeyDown(event: any) {\r\n    if (event.key === \"Escape\") {\r\n      this.setShowFormatHint(false);\r\n    }\r\n    this.editorModel.handleKeyDown(event);\r\n  }\r\n\r\n  @action.bound handleContainerMouseDown(event: any) {\r\n    setTimeout(() => {\r\n      this.elmInput?.focus();\r\n    }, 30);\r\n  }\r\n\r\n  refContainer = (elm: HTMLDivElement | null) => (this.elmContainer = elm);\r\n  elmContainer: HTMLDivElement | null = null;\r\n  refInput = (elm: HTMLInputElement | null) => {\r\n    this.elmInput = elm;\r\n  };\r\n  @observable inputRect: any;\r\n  elmInput: HTMLInputElement | null = null;\r\n\r\n  @action.bound\r\n  measureInputElement() {\r\n    if (this.elmInput) {\r\n      this.inputRect = this.elmInput.getBoundingClientRect();\r\n    } else {\r\n      this.inputRect = undefined;\r\n    }\r\n  }\r\n\r\n  @computed get isTooltipShown() {\r\n    return (\r\n      this.editorModel.textFieldValue !== undefined &&\r\n      (!moment(this.editorModel.textFieldValue, this.props.outputFormat) ||\r\n        this.editorModel.formattedMomentValue !== this.editorModel.textFieldValue)\r\n    );\r\n  }\r\n\r\n  @action.bound handleTextFieldChange(event: any) {\r\n    this.setShowFormatHint(true);\r\n    this.editorModel.handleTextFieldChange(event);\r\n  }\r\n\r\n  @action.bound handleDayClick(event: any, day: moment.Moment) {\r\n    this.elmDropdowner && this.elmDropdowner.setDropped(false);\r\n    this.editorModel.handleDayClick(event, day);\r\n  }\r\n\r\n  @action.bound\r\n  handleFocus(event: any) {\r\n    if (this.elmInput) {\r\n      this.elmInput.select();\r\n      this.elmInput.scrollLeft = 0;\r\n    }\r\n  }\r\n\r\n  customFormatContainsDate() {\r\n    return (\r\n      this.props.outputFormat.includes(\"D\") ||\r\n      this.props.outputFormat.includes(\"M\") ||\r\n      this.props.outputFormat.includes(\"Y\")\r\n    );\r\n  }\r\n\r\n  renderWithCalendarWidget() {\r\n    return (\r\n      <Dropdowner\r\n        ref={this.refDropdowner}\r\n        onContainerMouseDown={this.handleContainerMouseDown}\r\n        trigger={({refTrigger, setDropped}) => (\r\n          <div\r\n            className={S.editorContainer}\r\n            ref={this.refContainer}\r\n            style={{\r\n              zIndex: this.isDroppedDown ? 1000 : undefined,\r\n            }}\r\n          >\r\n            <Observer>\r\n              {() => (\r\n                <>\r\n                  {this.isShowFormatHintTooltip && (\r\n                    <FormatHintTooltip\r\n                      boundingRect={this.inputRect}\r\n                      line1={this.editorModel.autocompletedText}\r\n                      line2={this.props.outputFormatToShow}\r\n                    />\r\n                  )}\r\n                  <input\r\n                    id={this.props.id}\r\n                    title={this.editorModel.autocompletedText + '\\n' + this.props.outputFormatToShow}\r\n                    style={{\r\n                      color: this.props.foregroundColor,\r\n                      backgroundColor: this.props.backgroundColor,\r\n                    }}\r\n                    className={cx(S.input, this.props.className)}\r\n                    type=\"text\"\r\n                    onBlur={this.handleInputBlur}\r\n                    onFocus={this.handleFocus}\r\n                    ref={(elm) => {\r\n                      this.refInput(elm);\r\n                    }}\r\n                    value={this.editorModel.textFieldValue}\r\n                    readOnly={this.props.isReadOnly}\r\n                    onChange={this.handleTextFieldChange}\r\n                    onClick={this.props.onClick}\r\n                    onDoubleClick={this.props.onDoubleClick}\r\n                    onKeyDown={this.handleKeyDown}\r\n                  />\r\n                </>\r\n              )}\r\n            </Observer>\r\n\r\n            {!this.props.isReadOnly && (\r\n              <div\r\n                className={S.dropdownSymbol}\r\n                onMouseDown={() => setDropped(true)}\r\n                ref={refTrigger}\r\n              >\r\n                <i className=\"far fa-calendar-alt\"/>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n        content={() => (\r\n          <div className={S.droppedPanelContainer}>\r\n            <CalendarWidget\r\n              onDayClick={this.handleDayClick}\r\n              initialDisplayDate={this.editorModel.momentValue?.isValid() ? this.editorModel.momentValue : moment()}\r\n              selectedDay={this.editorModel.momentValue?.isValid() ? this.editorModel.momentValue : moment()}\r\n            />\r\n          </div>\r\n        )}\r\n      />\r\n    );\r\n  }\r\n\r\n  renderInputFieldOnly() {\r\n    return (\r\n      <div\r\n        className={S.editorContainer}\r\n        ref={this.refContainer}\r\n        style={{\r\n          zIndex: this.isDroppedDown ? 1000 : undefined,\r\n        }}\r\n      >\r\n        <input\r\n          id={this.props.id}\r\n          style={{\r\n            color: this.props.foregroundColor,\r\n            backgroundColor: this.props.backgroundColor,\r\n          }}\r\n          title={this.editorModel.autocompletedText + '\\n' + this.props.outputFormat}\r\n          className={S.input}\r\n          type=\"text\"\r\n          onBlur={this.handleInputBlur}\r\n          onFocus={this.handleFocus}\r\n          ref={this.refInput}\r\n          value={this.editorModel.textFieldValue}\r\n          readOnly={this.props.isReadOnly}\r\n          onChange={this.handleTextFieldChange}\r\n          onClick={this.props.onClick}\r\n          onDoubleClick={this.props.onDoubleClick}\r\n          onKeyDown={this.handleKeyDown}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    if (!this.props.outputFormat || this.customFormatContainsDate()) {\r\n      return this.renderWithCalendarWidget();\r\n    } else {\r\n      return this.renderInputFieldOnly();\r\n    }\r\n  }\r\n}\r\n\r\nexport function FormatHintTooltip(props: { boundingRect?: any; line1?: string; line2?: string }) {\r\n  const [tooltipHeight, setTooltipHeight] = React.useState(0);\r\n\r\n  function refTooltip(elm: any) {\r\n    if (elm) {\r\n      setTooltipHeight(elm.getBoundingClientRect().height);\r\n    }\r\n  }\r\n\r\n  if (!props.boundingRect || (!props.line1 && !props.line2)) return null;\r\n  const bounds = props.boundingRect;\r\n\r\n  return createPortal(\r\n    <div\r\n      ref={refTooltip}\r\n      className={S.formatHintTooltip}\r\n      style={{top: bounds.top - 1 - tooltipHeight, left: bounds.left}}\r\n    >\r\n      {props.line1}\r\n      {props.line2 && <br/>}\r\n      {props.line2}\r\n    </div>,\r\n    document.getElementById(\"tooltip-portal\")!\r\n  );\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport * as React from \"react\";\r\nimport { useContext, useState } from \"react\";\r\nimport moment from \"moment\";\r\nimport SD from \"gui/Components/ScreenElements/Editors/DateTimeEditor/DateTimeEditor.module.scss\";\r\nimport S from \"gui/connections/MobileComponents/Form/MobileDateTimeEditor.module.scss\"\r\nimport cx from \"classnames\";\r\nimport { EditLayoutState } from \"model/entities/MobileState/MobileLayoutState\";\r\nimport { MobileState } from \"model/entities/MobileState/MobileState\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { CalendarWidget } from \"gui/Components/ScreenElements/Editors/DateTimeEditor/CalendarWidget\";\r\nimport {\r\n  DateEditorModel,\r\n  IEditorState,\r\n} from \"gui/Components/ScreenElements/Editors/DateTimeEditor/DateEditorModel\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\nimport { InputClearButton } from \"gui/connections/MobileComponents/Grid/InputClearButton\";\r\nimport { T } from \"utils/translation\";\r\n\r\n\r\nexport const MobileDateTimeEditor: React.FC<{\r\n  id?: string;\r\n  value: string | null;\r\n  outputFormat: string;\r\n  outputFormatToShow: string;\r\n  isReadOnly?: boolean;\r\n  autoFocus?: boolean;\r\n  foregroundColor?: string;\r\n  backgroundColor?: string;\r\n  onChange: (event: any, isoDay: string | undefined | null) => void;\r\n  onChangeByCalendar?: (event: any, isoDay: string) => void;\r\n  onClick?: (event: any) => void;\r\n  onDoubleClick?: (event: any) => void;\r\n  onKeyDown?: (event: any) => void;\r\n  onEditorBlur: (event: any) => void;\r\n  property: IProperty;\r\n  editorState?: IEditorState;\r\n  showClearButton?: boolean;\r\n  inputClass?: string\r\n}> = observer((props) => {\r\n\r\n  const mobileState = useContext(MobXProviderContext).application.mobileState as MobileState;\r\n\r\n  // eslint-disable-next-line\r\n  const [editorModel, setEditorModel] = useState(\r\n    new DateEditorModel(\r\n      props.editorState ?? new MobileEditorState(props.property),\r\n      props.outputFormat,\r\n      props.onChange,\r\n      props.onClick,\r\n      props.onKeyDown,\r\n      props.onEditorBlur,\r\n      props.onChangeByCalendar)\r\n  );\r\n\r\n  function onClick() {\r\n    const previousLayout = mobileState.layoutState;\r\n    mobileState.layoutState = new EditLayoutState(\r\n      <FullScreenDateTimeEditor\r\n        id={props.id}\r\n        editorModel={editorModel}\r\n        onClick={props.onClick}\r\n        property={props.property}\r\n      />,\r\n      props.property.name,\r\n      previousLayout\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className={S.root}>\r\n      <div\r\n        className={cx(S.input, SD.input, props.inputClass)}\r\n        onClick={onClick}\r\n      >\r\n        <div\r\n          id={props.id}\r\n          style={{\r\n            color: props.foregroundColor,\r\n            backgroundColor: props.backgroundColor,\r\n          }}\r\n        >\r\n          {editorModel.textFieldValue}\r\n        </div>\r\n\r\n        {!props.isReadOnly && (\r\n          <div><i className=\"far fa-calendar-alt\"/></div>\r\n        )}\r\n      </div>\r\n      {props.showClearButton &&\r\n        <InputClearButton\r\n          visible={editorModel.textFieldValue !== \"\"}\r\n          onClick={(event) => editorModel.onClearClick(event)}\r\n        />\r\n      }\r\n    </div>\r\n  );\r\n});\r\n\r\nexport const FullScreenDateTimeEditor: React.FC<{\r\n  id?: string;\r\n  onClick?: (event: any) => void;\r\n  editorModel: DateEditorModel;\r\n  property: IProperty\r\n}> = observer((props) => {\r\n\r\n  return (\r\n    <div className={S.fullScreenEditorRoot}>\r\n      <div className={S.fullScreenEditorInputContainer}>\r\n        <div className={S.inputRow}>\r\n          <input\r\n            id={props.id}\r\n            className={cx(\"input\", S.input, S.fullScreenEditorInput)}\r\n            type=\"text\"\r\n            onBlur={props.editorModel.handleInputBlur}\r\n            value={props.editorModel.textFieldValue}\r\n            onChange={props.editorModel.handleTextFieldChange}\r\n            onClick={props.onClick}\r\n            onKeyDown={props.editorModel.handleKeyDown}\r\n          />\r\n          <button\r\n            className={S.autoCompleteButton}\r\n            onClick={(event)=> props.editorModel.onClearClick(event)}\r\n          >\r\n            X\r\n          </button>\r\n          <button\r\n            className={S.autoCompleteButton}\r\n          >\r\n            {T(\"Auto Complete\", \"auto_complete_date\")}\r\n          </button>\r\n        </div>\r\n        <div className={S.fullScreenEditorInfoRow}>\r\n          {T(\"Format\", \"format\") + \": \" + props.editorModel.outputFormat}\r\n        </div>\r\n        <div className={S.fullScreenEditorInfoRow}>\r\n          {T(\"Preview\", \"preview\") + \": \" + props.editorModel.autocompletedText}\r\n        </div>\r\n      </div>\r\n      <CalendarWidget\r\n        onDayClick={props.editorModel.handleDayClick}\r\n        initialDisplayDate={props.editorModel.momentValue?.isValid() ? props.editorModel.momentValue : moment()}\r\n        selectedDay={props.editorModel.momentValue?.isValid() ? props.editorModel.momentValue : moment()}\r\n      />\r\n    </div>\r\n  );\r\n});\r\n\r\nexport class MobileEditorState implements IEditorState {\r\n\r\n  constructor(private property: IProperty) {\r\n  }\r\n\r\n  get value(){\r\n    const dataTable = getDataTable(this.property);\r\n    let row = getSelectedRow(this.property);\r\n    if(!row){\r\n      return null;\r\n    }\r\n    return dataTable.getCellValue(row, this.property);\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { DateTimeEditor } from \"gui/Components/ScreenElements/Editors/DateTimeEditor/DateTimeEditor\";\r\nimport { action, runInAction } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport {\r\n  FilterSettingsComboBox,\r\n  FilterSettingsComboBoxItem,\r\n} from \"gui/Components/ScreenElements/Table/FilterSettings/FilterSettingsComboBox\";\r\nimport { FilterSetting } from \"./FilterSetting\";\r\nimport { Operator } from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/Operator\";\r\nimport { getDefaultCsDateFormatDataFromCookie } from \"utils/cookies\";\r\nimport { csToMomentFormat } from \"@origam/utils\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { MobileDateTimeEditor } from \"gui/connections/MobileComponents/Form/MobileDateTimeEditor\";\r\nimport { IFilterSetting } from \"model/entities/types/IFilterSetting\";\r\nimport { IEditorState } from \"gui/Components/ScreenElements/Editors/DateTimeEditor/DateEditorModel\";\r\nimport S from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/FilterSettingsCommon.module.scss\";\r\n\r\nconst OPERATORS = [\r\n  Operator.equals,\r\n  Operator.notEquals,\r\n  Operator.lessThanOrEquals,\r\n  Operator.greaterThanOrEquals,\r\n  Operator.lessThan,\r\n  Operator.greaterThan,\r\n  Operator.between,\r\n  Operator.notBetween,\r\n  Operator.isNull,\r\n  Operator.isNotNull\r\n];\r\n\r\nconst OpCombo: React.FC<{\r\n  setting: any;\r\n  onChange: (newSetting: any) => void;\r\n  id: string;\r\n}> = observer((props) => {\r\n  return (\r\n    <FilterSettingsComboBox\r\n      id={props.id}\r\n      trigger={<>{(OPERATORS.find((item) => item.type === props.setting.type) || {}).caption}</>}\r\n    >\r\n      {OPERATORS.map((op) => (\r\n        <FilterSettingsComboBoxItem\r\n          key={op.type}\r\n          onClick={() => {\r\n            props.setting.type = op.type;\r\n            props.onChange(props.setting);\r\n          }\r\n          }\r\n        >\r\n          {op.caption}\r\n        </FilterSettingsComboBoxItem>\r\n      ))}\r\n    </FilterSettingsComboBox>\r\n  );\r\n});\r\n\r\nconst OpEditors: React.FC<{\r\n  setting: IFilterSetting;\r\n  onChange?: (newSetting: any) => void;\r\n  onBlur?: (event: any) => void;\r\n  onKeyDown?: (event: any) => void;\r\n  autoFocus: boolean;\r\n  id: string;\r\n  property: IProperty;\r\n}> = observer((props) => {\r\n  const {setting} = props;\r\n  const dateFormatCs = getDefaultCsDateFormatDataFromCookie().defaultLongDateFormat;\r\n  const dateFormatMoment = csToMomentFormat(dateFormatCs)!;\r\n  switch (setting.type) {\r\n    case \"eq\":\r\n    case \"neq\":\r\n    case \"lt\":\r\n    case \"gt\":\r\n    case \"lte\":\r\n    case \"gte\":\r\n      if (isMobileLayoutActive(props.property)) {\r\n        return (\r\n          <MobileDateTimeEditor\r\n            value={setting.val1 ?? \"\"}\r\n            property={props.property}\r\n            outputFormat={dateFormatMoment}\r\n            outputFormatToShow={dateFormatCs}\r\n            onChange={(event, isoDay) => {\r\n              runInAction(() => {\r\n                setting.val1 = isoDay === null ? undefined : removeTimeZone(isoDay);\r\n                props.onChange && props.onChange(setting)\r\n              })\r\n            }}\r\n            autoFocus={props.autoFocus}\r\n            onEditorBlur={() => {\r\n            }}\r\n            onKeyDown={props.onKeyDown}\r\n            editorState={new MobileFilterEditorStateVal1(setting)}\r\n            showClearButton={true}\r\n            inputClass={S.dateTimeInput}\r\n          />);\r\n      } else {\r\n        return (\r\n          <DateTimeEditor\r\n            id={props.id}\r\n            value={setting.val1 ?? \"\"}\r\n            outputFormat={dateFormatMoment}\r\n            outputFormatToShow={dateFormatCs}\r\n            onChange={(event, isoDay) => {\r\n              runInAction(() => {\r\n                setting.val1 = isoDay === null ? undefined : removeTimeZone(isoDay);\r\n                props.onChange && props.onChange(setting)\r\n              })\r\n            }}\r\n            autoFocus={props.autoFocus}\r\n            onEditorBlur={props.onBlur}\r\n            onKeyDown={props.onKeyDown}\r\n            className={S.dateTimeInput}\r\n          />\r\n        );\r\n      }\r\n    case \"between\":\r\n    case \"nbetween\":\r\n      if (isMobileLayoutActive(props.property)) {\r\n        return (\r\n          <>\r\n            <MobileDateTimeEditor\r\n              value={setting.val1}\r\n              property={props.property}\r\n              outputFormat={dateFormatMoment}\r\n              outputFormatToShow={dateFormatCs}\r\n              onChange={(event, isoDay) => {\r\n                runInAction(() => {\r\n                  setting.val1 = isoDay === null ? undefined : removeTimeZone(isoDay);\r\n                  props.onChange && props.onChange(setting)\r\n                })\r\n              }}\r\n              autoFocus={props.autoFocus}\r\n              onEditorBlur={() => {\r\n              }}\r\n              onKeyDown={props.onKeyDown}\r\n              editorState={new MobileFilterEditorStateVal1(setting)}\r\n              showClearButton={true}\r\n              inputClass={S.dateTimeInput}\r\n            />\r\n            <MobileDateTimeEditor\r\n              value={setting.val2}\r\n              property={props.property}\r\n              outputFormat={dateFormatMoment}\r\n              outputFormatToShow={dateFormatCs}\r\n              onChange={(event, isoDay) => {\r\n                runInAction(() => {\r\n                  setting.val2 = isoDay === null ? undefined : removeTimeZone(isoDay);\r\n                  props.onChange && props.onChange(setting)\r\n                })\r\n              }}\r\n              autoFocus={props.autoFocus}\r\n              onEditorBlur={() => {\r\n              }}\r\n              onKeyDown={props.onKeyDown}\r\n              editorState={new MobileFilterEditorStateVal2(setting)}\r\n              showClearButton={true}\r\n              inputClass={S.dateTimeInput}\r\n            />\r\n          </>\r\n        );\r\n      } else {\r\n        return (\r\n          <>\r\n            <DateTimeEditor\r\n              id={\"from_\" + props.id}\r\n              value={setting.val1}\r\n              outputFormat={dateFormatMoment}\r\n              outputFormatToShow={dateFormatCs}\r\n              onChange={(event, isoDay) => {\r\n                runInAction(() => {\r\n                  setting.val1 = isoDay === null ? undefined : removeTimeZone(isoDay);\r\n                  props.onChange &&\r\n                  props.onChange(setting)\r\n                })\r\n              }}\r\n              onEditorBlur={props.onBlur}\r\n              onKeyDown={props.onKeyDown}\r\n              className={S.dateTimeInput}\r\n            />\r\n            <DateTimeEditor\r\n              id={\"to_\" + props.id}\r\n              value={setting.val2}\r\n              outputFormat={dateFormatMoment}\r\n              outputFormatToShow={dateFormatCs}\r\n              onChange={(event, isoDay) => {\r\n                runInAction(() => {\r\n                  setting.val2 = isoDay === null ? undefined : removeTimeZone(isoDay);\r\n                  props.onChange &&\r\n                  props.onChange(setting)\r\n                })\r\n              }}\r\n              onEditorBlur={props.onBlur}\r\n              onKeyDown={props.onKeyDown}\r\n              className={S.dateTimeInput}\r\n            />\r\n          </>\r\n        );\r\n      }\r\n    case \"null\":\r\n    case \"nnull\":\r\n    default:\r\n      return null;\r\n  }\r\n});\r\n\r\n@observer\r\nexport class FilterSettingsDate extends React.Component<{\r\n  setting: IFilterSetting;\r\n  autoFocus: boolean\r\n  id: string;\r\n  property: IProperty;\r\n}> {\r\n\r\n  static get defaultSettings() {\r\n    return new FilterSetting(OPERATORS[0].type)\r\n  }\r\n\r\n  @action.bound\r\n  handleChange(newSetting: any) {\r\n    this.handleSettingChange();\r\n  }\r\n\r\n  handleSettingChange() {\r\n    const setting = this.props.setting;\r\n    switch (setting.type) {\r\n      case \"eq\":\r\n      case \"neq\":\r\n      case \"lt\":\r\n      case \"gt\":\r\n      case \"lte\":\r\n      case \"gte\":\r\n        setting.isComplete = setting.val1 !== undefined;\r\n        setting.val2 = undefined;\r\n        break;\r\n      case \"between\":\r\n      case \"nbetween\":\r\n        setting.isComplete = setting.val1 !== undefined && setting.val2 !== undefined;\r\n        break;\r\n      default:\r\n        setting.val1 = undefined;\r\n        setting.val2 = undefined;\r\n        setting.isComplete = setting.type === \"null\" || setting.type === \"nnull\";\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        <OpCombo\r\n          setting={this.props.setting}\r\n          onChange={this.handleChange}\r\n          id={\"combo_\" + this.props.id}\r\n        />\r\n        <OpEditors\r\n          id={\"input_\" + this.props.id}\r\n          setting={this.props.setting}\r\n          onChange={this.handleChange}\r\n          autoFocus={this.props.autoFocus}\r\n          property={this.props.property}\r\n        />\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nfunction removeTimeZone(isoDateString: string | null | undefined) {\r\n  if (!isoDateString) return isoDateString;\r\n  return isoDateString.substring(0, 23);\r\n}\r\n\r\nclass MobileFilterEditorStateVal1 implements IEditorState {\r\n\r\n  constructor(private setting: IFilterSetting) {\r\n  }\r\n\r\n  get value() {\r\n    return this.setting.val1;\r\n  }\r\n}\r\n\r\nclass MobileFilterEditorStateVal2 implements IEditorState {\r\n\r\n  constructor(private setting: IFilterSetting) {\r\n  }\r\n\r\n  get value() {\r\n    return this.setting.val2;\r\n  }\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport {\r\n  FilterSettingsComboBox,\r\n  FilterSettingsComboBoxItem,\r\n} from \"gui/Components/ScreenElements/Table/FilterSettings/FilterSettingsComboBox\";\r\n\r\nimport CS from \"./FilterSettingsCommon.module.scss\";\r\nimport { action, observable, runInAction } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport { EDITOR_DALEY_MS, FilterSetting } from \"./FilterSetting\";\r\nimport { Operator } from \"./Operator\";\r\nimport { getCurrentDecimalSeparator } from \"model/entities/NumberFormating\";\r\nimport { ClearableInput } from \"gui/connections/MobileComponents/Grid/ClearableInput\";\r\n\r\nconst OPERATORS =\r\n  [\r\n    Operator.equals,\r\n    Operator.notEquals,\r\n    Operator.lessThanOrEquals,\r\n    Operator.greaterThanOrEquals,\r\n    Operator.lessThan,\r\n    Operator.greaterThan,\r\n    Operator.between,\r\n    Operator.notBetween,\r\n    Operator.isNull,\r\n    Operator.isNotNull\r\n  ];\r\n\r\nconst OpCombo: React.FC<{\r\n  setting: any;\r\n  onChange: () => void;\r\n  id: string;\r\n}> = observer((props) => {\r\n  return (\r\n    <FilterSettingsComboBox\r\n      id={props.id}\r\n      trigger={<>{(OPERATORS.find((item) => item.type === props.setting.type) || {}).caption}</>}\r\n    >\r\n      {OPERATORS.map((op) => (\r\n        <FilterSettingsComboBoxItem\r\n          key={op.type}\r\n          onClick={() => {\r\n            props.setting.type = op.type;\r\n            props.onChange();\r\n          }\r\n          }\r\n        >\r\n          {op.caption}\r\n        </FilterSettingsComboBoxItem>\r\n      ))}\r\n    </FilterSettingsComboBox>\r\n  );\r\n});\r\n\r\n@observer\r\nclass OpEditors extends React.Component<{\r\n  setting?: any;\r\n  onBlur?: (event: any) => void;\r\n  allowDecimalSeparator: boolean;\r\n  currentValue1: any;\r\n  currentValue2: any;\r\n  onCurrentValue1Changed: ((value1: any) => void);\r\n  onCurrentValue2Changed: ((value2: any) => void);\r\n  autoFocus: boolean;\r\n  id: string;\r\n}> {\r\n\r\n  inputRef = React.createRef<HTMLInputElement>();\r\n\r\n  componentDidMount() {\r\n    if (this.props.autoFocus) {\r\n      setTimeout(() => {\r\n        this.inputRef.current?.focus();\r\n      });\r\n    }\r\n  }\r\n\r\n  onChange(event: any){\r\n    const value = this.removeInvalidCharacters(event);\r\n    this.props.onCurrentValue1Changed(value)\r\n  }\r\n\r\n  private removeInvalidCharacters(event: any) {\r\n    let separator = getCurrentDecimalSeparator();\r\n    const invalidChars = new RegExp(\"[^\\\\d\\\\-\" + (this.props.allowDecimalSeparator ? separator : \"\") + \"]\", \"g\");\r\n    let clearedValue = (event.target.value || \"\").replace(invalidChars, \"\");\r\n    let firstSeparatorIndex = clearedValue.indexOf(separator);\r\n    if(firstSeparatorIndex > -1){\r\n      let lastSeparatorIndex = clearedValue.lastIndexOf(separator);\r\n      for (let i = 0; i < 1000; i++) {\r\n        if (firstSeparatorIndex === lastSeparatorIndex) break;\r\n        clearedValue = clearedValue.slice(0, lastSeparatorIndex) + clearedValue.slice(lastSeparatorIndex + 1);\r\n      }\r\n    }\r\n    if(clearedValue === separator){\r\n      clearedValue = \"0\" + separator\r\n    }\r\n    return isNaN(parseFloat(clearedValue)) ? \"\" : clearedValue;\r\n  }\r\n\r\n  render() {\r\n    switch (this.props.setting.type) {\r\n      case \"eq\":\r\n      case \"neq\":\r\n      case \"lt\":\r\n      case \"gt\":\r\n      case \"lte\":\r\n      case \"gte\":\r\n        return (\r\n          <ClearableInput\r\n            id={this.props.id}\r\n            className={CS.input}\r\n            value={this.props.currentValue1 ?? \"\"}\r\n            onChange={(event: any) => {\r\n              const value = this.removeInvalidCharacters(event);\r\n              this.props.onCurrentValue1Changed(value);\r\n            }}\r\n            onBlur={this.props.onBlur}\r\n            ref={this.inputRef}\r\n          />\r\n        );\r\n\r\n      case \"between\":\r\n      case \"nbetween\":\r\n        return (\r\n          <>\r\n            <ClearableInput\r\n              id={\"from_\" + this.props.id}\r\n              className={CS.input}\r\n              value={this.props.currentValue1 ?? \"\"}\r\n              onChange={(event: any) => {\r\n                const value = this.removeInvalidCharacters(event);\r\n                this.props.onCurrentValue1Changed(value);\r\n              }}\r\n              onBlur={this.props.onBlur}\r\n              ref={this.inputRef}\r\n            />\r\n            <ClearableInput\r\n              id={\"to_\" + this.props.id}\r\n              className={CS.input}\r\n              value={this.props.currentValue2 ?? \"\"}\r\n              onChange={(event: any) => {\r\n                const value = this.removeInvalidCharacters(event);\r\n                this.props.onCurrentValue2Changed(value);\r\n              }}\r\n              onBlur={this.props.onBlur}\r\n            />\r\n          </>\r\n        );\r\n      case \"null\":\r\n      case \"nnull\":\r\n      default:\r\n        return null;\r\n    }\r\n  }\r\n}\r\n\r\n@observer\r\nexport class FilterSettingsNumber extends React.Component<{\r\n  setting?: any;\r\n  allowDecimalSeparator: boolean;\r\n  autoFocus: boolean;\r\n  onChange: ()=>void;\r\n  id: string;\r\n}> {\r\n\r\n  static get defaultSettings() {\r\n    return new FilterSetting(OPERATORS[0].type)\r\n  }\r\n\r\n  @action.bound\r\n  handleBlur() {\r\n    this.handleSettingChange();\r\n  }\r\n\r\n  @action.bound\r\n  handleFilterTypeChange() {\r\n    if (this.props.setting.type === \"null\" || this.props.setting.type === \"nnull\") {\r\n      this.currentValue1 = \"\";\r\n      this.currentValue2 = \"\";\r\n      this.props.setting.val1 = undefined;\r\n      this.props.setting.val2 = undefined;\r\n    }\r\n    this.handleSettingChange();\r\n  }\r\n\r\n  componentDidUpdate(prevProps: any) {\r\n    if (prevProps.setting.val1 !== this.props.setting.val1) {\r\n      this.currentValue1 = this.props.setting.val1;\r\n    }\r\n    if (prevProps.setting.val2 !== this.props.setting.val2) {\r\n      this.currentValue2 = this.props.setting.val2;\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  private handleSettingChange() {\r\n    switch (this.props.setting.type) {\r\n      case \"eq\":\r\n      case \"neq\":\r\n      case \"lt\":\r\n      case \"gt\":\r\n      case \"lte\":\r\n      case \"gte\":\r\n        this.props.setting.isComplete = this.props.setting.val1 !== undefined;\r\n        this.props.setting.val2 = undefined;\r\n        break;\r\n      case \"between\":\r\n      case \"nbetween\":\r\n        this.props.setting.isComplete =\r\n          this.props.setting.val1 !== undefined && this.props.setting.val2 !== undefined;\r\n        break;\r\n      default:\r\n        this.props.setting.val1 = undefined;\r\n        this.props.setting.val2 = undefined;\r\n        this.props.setting.isComplete = this.props.setting.type === \"null\" || this.props.setting.type === \"nnull\";\r\n    }\r\n  }\r\n\r\n  @observable\r\n  currentValue1 = this.props.setting.val1;\r\n\r\n  @observable\r\n  currentValue2 = this.props.setting.val2;\r\n\r\n  onCurrentValue1Changed(newValue: string) {\r\n    this.currentValue1 = newValue;\r\n\r\n    const timeOutId = setTimeout(() => {\r\n      runInAction(() => {\r\n        this.props.setting.val1 = this.currentValue1 === \"\"\r\n          ? undefined\r\n          : parseFloat(this.currentValue1.replace(getCurrentDecimalSeparator(), \".\"));\r\n        this.handleSettingChange();\r\n        this.props.onChange();\r\n      })\r\n    }, EDITOR_DALEY_MS);\r\n    return () => {\r\n      clearTimeout(timeOutId);\r\n    }\r\n  }\r\n\r\n  onCurrentValue2Changed(newValue: string) {\r\n    this.currentValue2 = newValue;\r\n\r\n    const timeOutId = setTimeout(() => {\r\n      runInAction(() => {\r\n        this.props.setting.val2 = this.currentValue2 === \"\"\r\n          ? undefined\r\n          : parseFloat(this.currentValue2.replace(getCurrentDecimalSeparator(), \".\"));\r\n        this.handleSettingChange();\r\n      })\r\n    }, EDITOR_DALEY_MS);\r\n    return () => {\r\n      clearTimeout(timeOutId);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        <OpCombo\r\n          id={\"combo_\" + this.props.id}\r\n          setting={this.props.setting}\r\n          onChange={this.handleFilterTypeChange}\r\n        />\r\n        <OpEditors\r\n          id={\"input_\" + this.props.id}\r\n          setting={this.props.setting} \r\n          onBlur={this.handleBlur}\r\n          currentValue1={this.currentValue1}\r\n          currentValue2={this.currentValue2}\r\n          onCurrentValue1Changed={val1 => this.onCurrentValue1Changed(val1)}\r\n          onCurrentValue2Changed={val2 => this.onCurrentValue2Changed(val2)}\r\n          allowDecimalSeparator={this.props.allowDecimalSeparator}\r\n          autoFocus={this.props.autoFocus}\r\n        />\r\n      </>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport type CancellablePromise<T> = Promise<T> & { cancel(): void };\r\n\r\nexport const delay = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));\r\n\r\nexport const EagerlyLoadedGrid = \"EagerlyLoadedGrid\";\r\nexport const LazilyLoadedTree = \"LazilyLoadedTree\";\r\nexport const EagerlyLoadedTree = \"EagerlyLoadedTree\";\r\nexport const LazilyLoadedGrid = \"LazilyLoadedGrid\";\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { action, computed, observable } from \"mobx\";\r\nimport { EagerlyLoadedGrid, LazilyLoadedGrid } from \"./DropdownEditorCommon\";\r\nimport { IDropdownEditorData } from \"./DropdownEditorData\";\r\nimport { DropdownEditorSetup } from \"modules/Editors/DropdownEditor/DropdownEditorSetup\";\r\n\r\nexport class DropdownDataTable {\r\n  constructor(\r\n    private setup: () => DropdownEditorSetup,\r\n    private dropdownEditorData: IDropdownEditorData\r\n  ) {\r\n  }\r\n\r\n  @observable.shallow allRows: any[][] = [];\r\n  @observable filterPhrase: string = \"\";\r\n\r\n  @computed\r\n  get index() {\r\n    return new Index(this.allRows);\r\n  }\r\n\r\n  get rowsBeforeRedundancyFilter(): any[][] {\r\n    const setup = this.setup();\r\n    switch (setup.dropdownType) {\r\n      case EagerlyLoadedGrid: {\r\n        if (this.filterPhrase !== \"\") {\r\n          return this.index.search(this.filterPhrase);\r\n        }\r\n        return this.allRows;\r\n      }\r\n      default:\r\n      case LazilyLoadedGrid: {\r\n        return this.allRows;\r\n      }\r\n    }\r\n  }\r\n\r\n  @computed get rows(): any[][] {\r\n    return this.rowsBeforeRedundancyFilter.filter(\r\n      (row) => !this.dropdownEditorData.idsInEditor.includes(this.getRowIdentifier(row))\r\n    );\r\n  }\r\n\r\n  get rowCount() {\r\n    return this.rows.length;\r\n  }\r\n\r\n  @computed\r\n  get columnIdsWithNoData() {\r\n    const result: string[] = [];\r\n    outer: for (let column of this.setup().visibleColumnNames) {\r\n      for (let i = 0; i < this.allRows.length; i++) {\r\n        if (this.allRows[i][this.setup().columnNameToIndex.get(column)!] !== null) {\r\n          continue outer;\r\n        }\r\n      }\r\n      result.push(column);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  getValue(dataRowIndex: number, dataColumnIndex: number) {\r\n    return this.rows[dataRowIndex][dataColumnIndex];\r\n  }\r\n\r\n  getRowByIndex(rowIndex: number) {\r\n    return this.rows[rowIndex];\r\n  }\r\n\r\n  getRowIdentifierByIndex(rowIndex: number) {\r\n    return this.rows[rowIndex][this.setup().identifierIndex];\r\n  }\r\n\r\n  getRowIdentifier(row: any[]) {\r\n    return row[this.setup().identifierIndex];\r\n  }\r\n\r\n  getRowById(id: string) {\r\n    return this.rows.find((row) => this.getRowIdentifier(row) === id);\r\n  }\r\n\r\n  getRowIndexById(id: string) {\r\n    return this.rows.findIndex((row) => this.getRowIdentifier(row) === id);\r\n  }\r\n\r\n  getRowAfterId(id: string) {\r\n    const idx = this.getRowIndexById(id);\r\n    if (idx > -1 && idx < this.rowCount - 1) {\r\n      return this.getRowByIndex(idx + 1);\r\n    } else return undefined;\r\n  }\r\n\r\n  getRowBeforeId(id: string) {\r\n    const idx = this.getRowIndexById(id);\r\n    if (idx > 0) {\r\n      return this.getRowByIndex(idx - 1);\r\n    } else return undefined;\r\n  }\r\n\r\n  getRowIdAfterId(id: string) {\r\n    const row = this.getRowAfterId(id);\r\n    if (row) return this.getRowIdentifier(row);\r\n  }\r\n\r\n  getRowIdBeforeId(id: string) {\r\n    const row = this.getRowBeforeId(id);\r\n    if (row) return this.getRowIdentifier(row);\r\n  }\r\n\r\n  @action.bound setData(rows: any[][]) {\r\n    this.allRows = rows;\r\n  }\r\n\r\n  @action.bound appendData(rows: any[][]) {\r\n    this.allRows.push(...rows);\r\n  }\r\n\r\n  @action.bound clearData() {\r\n    this.allRows.length = 0;\r\n  }\r\n\r\n  @action.bound setFilterPhrase(phrase: string) {\r\n    this.filterPhrase = phrase;\r\n  }\r\n}\r\n\r\nexport const IDropdownDataTable = TypeSymbol<DropdownDataTable>(\"IDropdownDataTable\");\r\n\r\nexport interface IHeaderCellDriver {\r\n  render(): React.ReactNode;\r\n}\r\n\r\nexport interface IBodyCellDriver {\r\n  render(rowIndex: number): React.ReactNode;\r\n\r\n  formattedText(i: number): string;\r\n}\r\n\r\nexport interface IDropdownColumnDriver {\r\n  columnId: string;\r\n  headerCellDriver: IHeaderCellDriver;\r\n  bodyCellDriver: IBodyCellDriver;\r\n}\r\n\r\nexport class DropdownColumnDrivers {\r\n  @observable\r\n  allDrivers: IDropdownColumnDriver[] = [];\r\n\r\n  driversFilter = (driver: IDropdownColumnDriver) => {\r\n    return true;\r\n  };\r\n\r\n  @computed\r\n  get drivers() {\r\n    return this.allDrivers.filter((driver) => {\r\n      return this.driversFilter(driver);\r\n    });\r\n  }\r\n\r\n  get driverCount() {\r\n    return this.drivers.length;\r\n  }\r\n\r\n  getDriver(columnIndex: number) {\r\n    return this.drivers[columnIndex];\r\n  }\r\n}\r\n\r\nexport const IDropdownColumnDrivers = TypeSymbol<DropdownColumnDrivers>(\"IDropdownColumnDrivers\");\r\n\r\nclass Index {\r\n  private items: IndexItem[] = [];\r\n\r\n  constructor(rows: any[][]) {\r\n    if (rows.length > 0) {\r\n      this.items = rows.map((row) => new IndexItem(row));\r\n    }\r\n  }\r\n\r\n  search(phrase: string) {\r\n    const phraseLower = phrase.toLowerCase();\r\n    return this.items.filter((item) => item.matches(phraseLower)).map((item) => item.row);\r\n  }\r\n}\r\n\r\nclass IndexItem {\r\n  private textInLower: string;\r\n  public row: any[];\r\n\r\n  constructor(row: any[]) {\r\n    this.row = row;\r\n    this.textInLower = row.slice(1).join(\"\").toLowerCase();\r\n  }\r\n\r\n  matches(phraseInLower: string) {\r\n    return this.textInLower.includes(phraseInLower);\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { LookupListCacheMulti } from \"modules/Lookup/LookupListCacheMulti\";\r\nimport { DropdownEditorSetup } from \"modules/Editors/DropdownEditor/DropdownEditorSetup\";\r\n\r\nexport class DropdownEditorLookupListCache {\r\n  constructor(private setup: () => DropdownEditorSetup, private cache: LookupListCacheMulti) {\r\n  }\r\n\r\n  get lookupId() {\r\n    return this.setup().lookupId;\r\n  }\r\n\r\n  setCachedListRows(rows: any[][]) {\r\n    this.cache.setLookupList(this.lookupId, rows);\r\n  }\r\n\r\n  getCachedListRows(): any[][] {\r\n    return this.cache.getLookupList(this.lookupId)!;\r\n  }\r\n\r\n  hasCachedListRows(): boolean {\r\n    return this.cache.hasLookupList(this.lookupId);\r\n  }\r\n\r\n  clean() {\r\n    return this.cache.deleteLookup(this.lookupId);\r\n  }\r\n}\r\n\r\nexport const IDropdownEditorLookupListCache = TypeSymbol<DropdownEditorLookupListCache>(\r\n  \"IDropdownEditorLookupListCache\"\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport _ from \"lodash\";\r\nimport { action, computed, decorate, flow, observable } from \"mobx\";\r\nimport { IDropdownEditorApi } from \"./DropdownEditorApi\";\r\nimport { CancellablePromise, EagerlyLoadedGrid, LazilyLoadedGrid } from \"./DropdownEditorCommon\";\r\nimport { IDropdownEditorData } from \"./DropdownEditorData\";\r\nimport { DropdownEditorLookupListCache } from \"./DropdownEditorLookupListCache\";\r\nimport { DropdownDataTable } from \"./DropdownTableModel\";\r\nimport { IFocusable } from \"../../../model/entities/FormFocusManager\";\r\nimport { compareStrings } from \"../../../utils/string\";\r\nimport { IDriverState } from \"modules/Editors/DropdownEditor/Cells/IDriverState\";\r\nimport { DropdownEditorSetup } from \"modules/Editors/DropdownEditor/DropdownEditorSetup\";\r\n\r\nexport const  dropdownPageSize = 100;\r\n\r\nexport interface IDropdownEditorBehavior extends IDriverState{\r\n  scrollToRowIndex: number | undefined;\r\n  willLoadPage: number;\r\n  handleScroll(args: {\r\n    clientHeight: number;\r\n    clientWidth: number;\r\n    scrollHeight: number;\r\n    scrollLeft: number;\r\n    scrollTop: number;\r\n    scrollWidth: number;\r\n  }): void;\r\n}\r\n\r\nexport interface IBehaviorData {\r\n  api: IDropdownEditorApi,\r\n  data: IDropdownEditorData,\r\n  dataTable: DropdownDataTable,\r\n  setup: () => DropdownEditorSetup,\r\n  cache: DropdownEditorLookupListCache,\r\n  isReadOnly: boolean,\r\n  onDoubleClick?: (event: any) => void,\r\n  onClick?: (event: any) => void,\r\n  subscribeToFocusManager?: (obj: IFocusable) => void,\r\n  onKeyDown?: (event: any) => void,\r\n  autoSort?: boolean,\r\n  onTextOverflowChanged?: (toolTip: string | null | undefined) => void,\r\n}\r\n\r\nexport class DropdownEditorBehavior implements IDropdownEditorBehavior{\r\n\r\n  private api: IDropdownEditorApi;\r\n  private data: IDropdownEditorData;\r\n  private dataTable: DropdownDataTable;\r\n  private setup: () => DropdownEditorSetup;\r\n  private cache: DropdownEditorLookupListCache;\r\n  public isReadOnly: boolean;\r\n  public onDoubleClick?: (event: any) => void;\r\n  public onClick?: (event: any) => void;\r\n  public subscribeToFocusManager?: (obj:IFocusable) => void;\r\n  private onKeyDown?: (event: any) => void;\r\n  private autoSort?: boolean;\r\n  private onTextOverflowChanged?: (toolTip: string | null | undefined) => void;\r\n\r\n  constructor(args: IBehaviorData) {\r\n    this.api = args.api;\r\n    this.data = args.data;\r\n    this.dataTable = args.dataTable;\r\n    this.setup = args.setup;\r\n    this.cache = args.cache;\r\n    this.isReadOnly = args.isReadOnly;\r\n    this.onDoubleClick = args.onDoubleClick;\r\n    this.onClick = args.onClick;\r\n    this.subscribeToFocusManager = args.subscribeToFocusManager;\r\n    this.onKeyDown = args.onKeyDown;\r\n    this.autoSort = args.autoSort;\r\n    this.onTextOverflowChanged = args.onTextOverflowChanged;\r\n  }\r\n\r\n  @observable isDropped = false;\r\n  @observable isWorking = false;\r\n  @observable userEnteredValue: string | undefined = undefined;\r\n  @observable scrollToRowIndex: number | undefined = undefined;\r\n  dontClearScrollToRow = true;\r\n\r\n  @observable cursorRowId = \"\";\r\n\r\n  willLoadPage = 1;\r\n  willLoadNextPage = true;\r\n\r\n  @computed get isBodyDisplayed() {\r\n    return this.isDropped && this.dataTable.rowCount > 0;\r\n  }\r\n\r\n  @computed get chosenRowId() {\r\n    return this.data.value;\r\n  }\r\n\r\n  @computed get inputValue() {\r\n    return this.userEnteredValue !== undefined ? this.userEnteredValue : this.data.text;\r\n  }\r\n\r\n  @action.bound\r\n  dropUp() {\r\n    if (this.isDropped) {\r\n      this.ensureRequestCancelled();\r\n      this.userEnteredValue = undefined;\r\n      this.dataTable.clearData();\r\n      this.isDropped = false;\r\n      this.willLoadPage = 1;\r\n      this.willLoadNextPage = true;\r\n      this.scrollToRowIndex = 0;\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  private dropDown() {\r\n    const setup = this.setup();\r\n    if (!this.isDropped) {\r\n      if (setup.dropdownType === EagerlyLoadedGrid) {\r\n        this.dataTable.setFilterPhrase(this.userEnteredValue || \"\");\r\n      }\r\n      if (\r\n        setup.dropdownType === EagerlyLoadedGrid &&\r\n        setup.cached &&\r\n        this.cache.hasCachedListRows()\r\n      ) {\r\n        this.dataTable.setData(this.cache.getCachedListRows());\r\n      } else {\r\n        this.ensureRequestRunning();\r\n      }\r\n      if (this.chosenRowId !== null && !Array.isArray(this.chosenRowId)) {\r\n        this.cursorRowId = this.chosenRowId;\r\n      }\r\n    }\r\n    this.isDropped = true;\r\n    this.scrollToChosenRowIfPossible();\r\n    this.makeFocused();\r\n  }\r\n\r\n  makeFocused() {\r\n    if (this.elmInputElement) {\r\n      this.elmInputElement.focus();\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  private scrollToChosenRowIfPossible() {\r\n    if (this.chosenRowId && !_.isArray(this.chosenRowId)) {\r\n      const index = this.dataTable.getRowIndexById(this.chosenRowId);\r\n      if (index > -1) {\r\n        this.dontClearScrollToRow = true;\r\n        this.scrollToRowIndex = index + 1;\r\n      }\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  private scrollToCursoredRowIfNeeded() {\r\n    const index = this.dataTable.getRowIndexById(this.cursorRowId);\r\n    if (index > -1) {\r\n      this.dontClearScrollToRow = true;\r\n      this.scrollToRowIndex = index + 1;\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  handleInputFocus(event: any) {\r\n    const {target} = event;\r\n    if (target) {\r\n      target.select();\r\n      target.scrollLeft = 0;\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  handleInputBlur(event: any) {\r\n    if (this.userEnteredValue && this.isDropped && !this.isWorking && this.cursorRowId) {\r\n      this.data.chooseNewValue(this.cursorRowId);\r\n    } else if (this.userEnteredValue === \"\") {\r\n      this.data.chooseNewValue(null);\r\n    }\r\n    this.dropUp();\r\n  }\r\n\r\n  @action.bound\r\n  handleInputBtnClick(event: any) {\r\n    if (!this.isDropped) {\r\n      this.dropDown();\r\n    } else {\r\n      this.dropUp();\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  handleInputKeyDown(event: any) {\r\n    switch (event.key) {\r\n      case \"Escape\":\r\n        this.dropUp();\r\n        this.userEnteredValue = undefined;\r\n        break;\r\n      case \"Enter\":\r\n        const wasDropped = this.isDropped;\r\n        if (this.isDropped && !this.isWorking && this.cursorRowId) {\r\n          this.data.chooseNewValue(this.cursorRowId);\r\n          this.dropUp();\r\n        }\r\n        if (wasDropped) {\r\n          event.stopPropagation();\r\n          event.preventDefault();\r\n          // Do not pass event to props.onKeyDown\r\n          return;\r\n        }\r\n        break;\r\n      case \"Tab\":\r\n        if (this.isDropped) {\r\n          if (this.cursorRowId) {\r\n            this.data.chooseNewValue(this.cursorRowId);\r\n          }\r\n        }\r\n        break;\r\n      case \"Delete\":\r\n        this.userEnteredValue = undefined;\r\n        this.cursorRowId = \"\";\r\n        this.data.chooseNewValue(null);\r\n        break;\r\n      case \"ArrowUp\":\r\n        if (this.isDropped) {\r\n          event.preventDefault();\r\n          if (!this.dataTable.getRowById(this.cursorRowId)) {\r\n            this.trySelectFirstRow();\r\n            this.selectChosenRow();\r\n          } else {\r\n            const prevRowId = this.dataTable.getRowIdBeforeId(this.cursorRowId);\r\n            if (prevRowId) {\r\n              this.cursorRowId = prevRowId;\r\n            }\r\n          }\r\n          this.scrollToCursoredRowIfNeeded();\r\n        }\r\n        break;\r\n      case \"ArrowDown\":\r\n        if (this.isDropped) {\r\n          event.preventDefault();\r\n          if (!this.dataTable.getRowById(this.cursorRowId)) {\r\n            this.trySelectFirstRow();\r\n            this.selectChosenRow();\r\n          } else {\r\n            const nextRowId = this.dataTable.getRowIdAfterId(this.cursorRowId);\r\n            if (nextRowId) {\r\n              this.cursorRowId = nextRowId;\r\n            }\r\n          }\r\n          this.scrollToCursoredRowIfNeeded();\r\n        } else if (event.ctrlKey || event.metaKey) {\r\n          this.dropDown();\r\n          this.trySelectFirstRow();\r\n        }\r\n        break;\r\n    }\r\n    this.onKeyDown && this.onKeyDown(event);\r\n  }\r\n\r\n  handleInputChangeDeb = _.debounce(this.handleInputChangeImm, 300);\r\n\r\n  @action.bound\r\n  handleInputChange(event: any) {\r\n    this.userEnteredValue = event.target.value;\r\n    this.isDropped = true;\r\n\r\n    if (this.setup().dropdownType === EagerlyLoadedGrid) {\r\n      this.dataTable.setFilterPhrase(this.userEnteredValue || \"\");\r\n      if (this.setup().cached && this.cache.hasCachedListRows()) {\r\n        this.dataTable.setData(this.cache.getCachedListRows());\r\n      } else {\r\n        this.ensureRequestRunning();\r\n      }\r\n      if (!this.dataTable.getRowById(this.cursorRowId) && this.userEnteredValue) {\r\n        this.trySelectFirstRow();\r\n      }\r\n    } else if (this.setup().dropdownType === LazilyLoadedGrid) {\r\n      this.handleInputChangeDeb();\r\n    }\r\n    this.updateTextOverflowState();\r\n  }\r\n\r\n  @action.bound\r\n  private handleInputChangeImm() {\r\n    if (this.setup().dropdownType === LazilyLoadedGrid) {\r\n      this.willLoadNextPage = true;\r\n      this.willLoadPage = 1;\r\n      this.dataTable.clearData();\r\n    }\r\n    this.ensureRequestCancelled();\r\n    this.ensureRequestRunning();\r\n  }\r\n\r\n  @action.bound\r\n  handleTableCellClicked(event: any, visibleRowIndex: any) {\r\n    const id = this.dataTable.getRowIdentifierByIndex(visibleRowIndex);\r\n    this.data.chooseNewValue(id);\r\n    this.dropUp();\r\n  }\r\n\r\n  @action.bound\r\n  handleTriggerContextMenu(event: any) {\r\n    this.dropUp();\r\n  }\r\n\r\n  @action.bound\r\n  handleControlMouseDown(event: any) {\r\n    if (this.isDropped) {\r\n      event.stopPropagation();\r\n      event.preventDefault();\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  handleBodyMouseDown(event: any) {\r\n    if (this.isDropped) {\r\n      event.stopPropagation();\r\n      event.preventDefault();\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  handleWindowMouseDown(event: any) {\r\n    if (this.userEnteredValue === \"\") {\r\n      this.data.chooseNewValue(null);\r\n    }\r\n    if (this.isDropped) {\r\n      this.dropUp();\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  handleScroll(args: {\r\n    clientHeight: number;\r\n    clientWidth: number;\r\n    scrollHeight: number;\r\n    scrollLeft: number;\r\n    scrollTop: number;\r\n    scrollWidth: number;\r\n  }) {\r\n    const setup = this.setup();\r\n    if (setup.dropdownType === LazilyLoadedGrid) {\r\n      if (\r\n        this.willLoadNextPage &&\r\n        !this.isWorking &&\r\n        args.scrollTop > args.scrollHeight - args.clientHeight - 500\r\n      ) {\r\n        this.willLoadPage++;\r\n        this.ensureRequestRunning();\r\n      }\r\n    }\r\n    if (this.dontClearScrollToRow) {\r\n      this.dontClearScrollToRow = false;\r\n    } else {\r\n      this.scrollToRowIndex = undefined;\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  private ensureRequestRunning() {\r\n    if (!this.isWorking) {\r\n      this.runGetLookupList(\r\n        this.setup().dropdownType === EagerlyLoadedGrid ? \"\" : this.userEnteredValue || \"\"\r\n      );\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  private ensureRequestCancelled() {\r\n    if (this.runningPromise) this.runningPromise.cancel();\r\n  }\r\n\r\n  runningPromise: CancellablePromise<any> | undefined;\r\n\r\n  @action.bound\r\n  private trySelectFirstRow() {\r\n    if (this.dataTable.rows.length > 0) {\r\n      this.cursorRowId = this.dataTable.getRowIdentifierByIndex(0);\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  private selectChosenRow() {\r\n    if (\r\n      this.dataTable.rows.length > 0 &&\r\n      this.chosenRowId &&\r\n      !_.isArray(this.chosenRowId) &&\r\n      this.dataTable.getRowById(this.chosenRowId)\r\n    ) {\r\n      this.cursorRowId = this.chosenRowId;\r\n    }\r\n  }\r\n\r\n  updateTextOverflowState() {\r\n    if (!this.elmInputElement) {\r\n      return;\r\n    }\r\n    const textOverflow = this.elmInputElement.offsetWidth < this.elmInputElement.scrollWidth\r\n    this.onTextOverflowChanged?.(textOverflow ? this.inputValue : undefined);\r\n  }\r\n\r\n  @action.bound\r\n  private runGetLookupList(searchTerm: string) {\r\n    const self = this;\r\n    this.runningPromise = flow(function*() {\r\n      try {\r\n        self.isWorking = true;\r\n        const setup = self.setup();\r\n        const items = yield*self.api.getLookupList(searchTerm);\r\n        if (self.autoSort) {\r\n          items.sort((i1: any[], i2: any[]) => compareLookUpItems(i1[1], i2[1]))\r\n        }\r\n        if (setup.dropdownType === EagerlyLoadedGrid) {\r\n          self.dataTable.setData(items);\r\n          if (setup.cached) {\r\n            self.cache.setCachedListRows(items);\r\n          }\r\n        } else if (setup.dropdownType === LazilyLoadedGrid) {\r\n          if (items.length < dropdownPageSize) {\r\n            self.willLoadNextPage = false;\r\n          }\r\n          self.scrollToRowIndex = undefined;\r\n          self.dataTable.appendData(items);\r\n        }\r\n        if (!self.dataTable.getRowById(self.cursorRowId) && self.userEnteredValue) {\r\n          self.trySelectFirstRow();\r\n        }\r\n        self.scrollToChosenRowIfPossible();\r\n        self.selectChosenRow();\r\n      } finally {\r\n        self.isWorking = false;\r\n        self.runningPromise = undefined;\r\n      }\r\n    })();\r\n  }\r\n\r\n  @action.bound\r\n  clearCache() {\r\n    this.cache.clean();\r\n  }\r\n\r\n  _refInputDisposer: any;\r\n  refInputElement = (elm: any) => {\r\n    this.elmInputElement = elm;\r\n  };\r\n\r\n  elmInputElement: any;\r\n  refDropdownBody = (elm: any) => (this.elmDropdownBody = elm);\r\n  elmDropdownBody: any;\r\n}\r\n\r\nexport function compareLookUpItems(item1: any, item2: any) {\r\n  if (typeof item1 === 'number' && typeof item2 === 'number') {\r\n    if (item1 > item2) return 1;\r\n    if (item1 < item2) return -1;\r\n    return 0;\r\n  }\r\n  return compareStrings(item1, item2)\r\n}\r\n\r\ndecorate(DropdownEditorBehavior, {\r\n  isReadOnly: observable,\r\n});\r\n\r\n// export const IDropdownEditorBehavior = TypeSymbol<DropdownEditorBehavior>(\r\n//   \"IDropdownEditorBehavior\"\r\n// );\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n\r\nimport { IDropdownEditorApi } from \"modules/Editors/DropdownEditor/DropdownEditorApi\";\r\nimport { IDropdownEditorData } from \"modules/Editors/DropdownEditor/DropdownEditorData\";\r\nimport { DropdownDataTable } from \"modules/Editors/DropdownEditor/DropdownTableModel\";\r\nimport { DropdownEditorLookupListCache } from \"modules/Editors/DropdownEditor/DropdownEditorLookupListCache\";\r\nimport { action, computed, flow, observable } from \"mobx\";\r\nimport {\r\n  CancellablePromise,\r\n  EagerlyLoadedGrid,\r\n  LazilyLoadedGrid\r\n} from \"modules/Editors/DropdownEditor/DropdownEditorCommon\";\r\nimport _ from \"lodash\";\r\nimport {\r\n  compareLookUpItems,\r\n  dropdownPageSize,\r\n  IDropdownEditorBehavior\r\n} from \"modules/Editors/DropdownEditor/DropdownEditorBehavior\";\r\nimport { DropdownEditorSetup } from \"modules/Editors/DropdownEditor/DropdownEditorSetup\";\r\n\r\nexport interface IMobileBehaviorData {\r\n  api: IDropdownEditorApi,\r\n  data: IDropdownEditorData,\r\n  dataTable: DropdownDataTable,\r\n  setup: () => DropdownEditorSetup,\r\n  cache: DropdownEditorLookupListCache,\r\n  onValueSelected?: () => void,\r\n  autoSort?: boolean,\r\n  onTextOverflowChanged?: (toolTip: string | null | undefined) => void,\r\n}\r\n\r\nexport class MobileDropdownBehavior implements IDropdownEditorBehavior{\r\n\r\n  private api: IDropdownEditorApi;\r\n  private data: IDropdownEditorData;\r\n  private dataTable: DropdownDataTable;\r\n  private setup: () => DropdownEditorSetup;\r\n  private cache: DropdownEditorLookupListCache;\r\n  public onValueSelected?: () => void;\r\n  private autoSort?: boolean;\r\n  private onTextOverflowChanged?: (toolTip: string | null | undefined) => void;\r\n\r\n  constructor(args: IMobileBehaviorData) {\r\n    this.api = args.api;\r\n    this.data = args.data;\r\n    this.dataTable = args.dataTable;\r\n    this.setup = args.setup;\r\n    this.cache = args.cache;\r\n    this.onValueSelected = args.onValueSelected;\r\n    this.autoSort = args.autoSort;\r\n    this.onTextOverflowChanged = args.onTextOverflowChanged;\r\n  }\r\n\r\n  @observable isWorking = false;\r\n  @observable userEnteredValue: string | undefined = undefined;\r\n  @observable scrollToRowIndex: number | undefined = undefined;\r\n  dontClearScrollToRow = true;\r\n\r\n  @observable cursorRowId = \"\";\r\n\r\n  willLoadPage = 1;\r\n  willLoadNextPage = true;\r\n\r\n  @computed get chosenRowId() {\r\n    return this.data.value;\r\n  }\r\n\r\n  @computed get inputValue() {\r\n    return this.userEnteredValue ?? \"\";\r\n  }\r\n\r\n  makeFocused() {\r\n    if (this.elmInputElement) {\r\n      this.elmInputElement.focus();\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  private scrollToChosenRowIfPossible() {\r\n    if (this.chosenRowId && !_.isArray(this.chosenRowId)) {\r\n      const index = this.dataTable.getRowIndexById(this.chosenRowId);\r\n      if (index > -1) {\r\n        this.dontClearScrollToRow = true;\r\n        this.scrollToRowIndex = index + 1;\r\n      }\r\n    }\r\n  }\r\n\r\n  handleInputChangeDeb = _.debounce(this.handleInputChangeImm, 300);\r\n\r\n  @action.bound\r\n  handleInputChange(event: any) {\r\n    this.userEnteredValue = event.target.value;\r\n\r\n    if (this.setup().dropdownType === EagerlyLoadedGrid) {\r\n      this.dataTable.setFilterPhrase(this.userEnteredValue || \"\");\r\n      if (this.setup().cached && this.cache.hasCachedListRows()) {\r\n        this.dataTable.setData(this.cache.getCachedListRows());\r\n      } else {\r\n        this.ensureRequestRunning();\r\n      }\r\n      this.trySelectFirstRow();\r\n    } else if (this.setup().dropdownType === LazilyLoadedGrid) {\r\n      this.handleInputChangeDeb();\r\n    }\r\n    this.updateTextOverflowState();\r\n  }\r\n\r\n  @action.bound\r\n  private handleInputChangeImm() {\r\n    if (this.setup().dropdownType === LazilyLoadedGrid) {\r\n      this.willLoadNextPage = true;\r\n      this.willLoadPage = 1;\r\n      this.dataTable.clearData();\r\n    }\r\n    this.ensureRequestCancelled();\r\n    this.ensureRequestRunning();\r\n  }\r\n\r\n  @action.bound\r\n  handleTableCellClicked(event: any, visibleRowIndex: any) {\r\n    const id = this.dataTable.getRowIdentifierByIndex(visibleRowIndex);\r\n    this.data.chooseNewValue(id);\r\n\r\n    this.ensureRequestCancelled();\r\n    this.userEnteredValue = \"\";\r\n    this.dataTable.setFilterPhrase(\"\");\r\n    this.willLoadPage = 1;\r\n    this.willLoadNextPage = true;\r\n    this.scrollToRowIndex = 0;\r\n\r\n    this.onValueSelected?.();\r\n  }\r\n\r\n  @action.bound\r\n  handleScroll(args: {\r\n    clientHeight: number;\r\n    clientWidth: number;\r\n    scrollHeight: number;\r\n    scrollLeft: number;\r\n    scrollTop: number;\r\n    scrollWidth: number;\r\n  }) {\r\n    const setup = this.setup();\r\n    if (setup.dropdownType === LazilyLoadedGrid) {\r\n      if (\r\n        this.willLoadNextPage &&\r\n        !this.isWorking &&\r\n        args.scrollTop > args.scrollHeight - args.clientHeight - 500\r\n      ) {\r\n        this.willLoadPage++;\r\n        this.ensureRequestRunning();\r\n      }\r\n    }\r\n    if (this.dontClearScrollToRow) {\r\n      this.dontClearScrollToRow = false;\r\n    } else {\r\n      this.scrollToRowIndex = undefined;\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  private ensureRequestRunning() {\r\n    if (!this.isWorking) {\r\n      this.runGetLookupList(\r\n        this.setup().dropdownType === EagerlyLoadedGrid ? \"\" : this.userEnteredValue || \"\"\r\n      );\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  private ensureRequestCancelled() {\r\n    if (this.runningPromise) this.runningPromise.cancel();\r\n  }\r\n\r\n  runningPromise: CancellablePromise<any> | undefined;\r\n\r\n  @action.bound\r\n  private trySelectFirstRow() {\r\n    if (\r\n      !this.dataTable.getRowById(this.cursorRowId) &&\r\n      this.userEnteredValue &&\r\n      this.dataTable.rows.length > 0\r\n    ) {\r\n      this.cursorRowId = this.dataTable.getRowIdentifierByIndex(0);\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  private selectChosenRow() {\r\n    if (\r\n      this.dataTable.rows.length > 0 &&\r\n      this.chosenRowId &&\r\n      !_.isArray(this.chosenRowId) &&\r\n      this.dataTable.getRowById(this.chosenRowId)\r\n    ) {\r\n      this.cursorRowId = this.chosenRowId;\r\n    }\r\n  }\r\n\r\n  updateTextOverflowState() {\r\n    if (!this.elmInputElement) {\r\n      return;\r\n    }\r\n    const textOverflow = this.elmInputElement.offsetWidth < this.elmInputElement.scrollWidth\r\n    this.onTextOverflowChanged?.(textOverflow ? this.inputValue : undefined);\r\n  }\r\n\r\n  @action.bound\r\n  private runGetLookupList(searchTerm: string) {\r\n    const self = this;\r\n    this.runningPromise = flow(function*() {\r\n      try {\r\n        self.isWorking = true;\r\n        const setup = self.setup();\r\n        const items = yield*self.api.getLookupList(searchTerm);\r\n        if (self.autoSort) {\r\n          items.sort((i1: any[], i2: any[]) => compareLookUpItems(i1[1], i2[1]))\r\n        }\r\n        if (setup.dropdownType === EagerlyLoadedGrid) {\r\n          self.dataTable.setData(items);\r\n          if (setup.cached) {\r\n            self.cache.setCachedListRows(items);\r\n          }\r\n        } else if (setup.dropdownType === LazilyLoadedGrid) {\r\n          if (items.length < dropdownPageSize) {\r\n            self.willLoadNextPage = false;\r\n          }\r\n          self.scrollToRowIndex = undefined;\r\n          self.dataTable.appendData(items);\r\n        }\r\n        self.trySelectFirstRow();\r\n        self.scrollToChosenRowIfPossible();\r\n        self.selectChosenRow();\r\n      } finally {\r\n        self.isWorking = false;\r\n        self.runningPromise = undefined;\r\n      }\r\n    })();\r\n  }\r\n\r\n  refInputElement = (elm: any) => {\r\n    this.elmInputElement = elm;\r\n  };\r\n\r\n  elmInputElement: any;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { IHeaderCellDriver } from \"../DropdownTableModel\";\r\nimport { TypeSymbol } from \"dic/Container\";\r\n\r\nexport class DefaultHeaderCellDriver implements IHeaderCellDriver {\r\n  constructor(private name: string) {\r\n  }\r\n\r\n  render() {\r\n    return <div className={\"header cell\"}>{this.name}</div>;\r\n  }\r\n}\r\n\r\nexport const IDefaultHeaderCellDriver = TypeSymbol<DefaultHeaderCellDriver>(\r\n  \"IDefaultHeaderCellDriver\"\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport cx from \"classnames\";\r\n\r\nexport function bodyCellClass(rowIndex: number, selected: boolean, withCursor: boolean) {\r\n  return cx(\"cell\", rowIndex % 2 ? \"ord2\" : \"ord1\", {withCursor, selected});\r\n}\r\n\r\nexport const CtxCell = React.createContext({visibleRowIndex: 0, visibleColumnIndex: 0});\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { bodyCellClass } from \"./CellsCommon\";\r\nimport { DropdownDataTable, IBodyCellDriver } from \"../DropdownTableModel\";\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { IDriverState } from \"modules/Editors/DropdownEditor/Cells/IDriverState\";\r\n\r\nexport class TextCellDriver implements IBodyCellDriver {\r\n  constructor(\r\n    private dataIndex: number,\r\n    private dataTable: DropdownDataTable,\r\n    private driverState: IDriverState\r\n  ) {\r\n  }\r\n\r\n  formattedText(rowIndex: number){\r\n    if(this.dataTable.rowCount <= rowIndex){\r\n      return \"\";\r\n    }\r\n    return this.dataTable.getValue(rowIndex, this.dataIndex) ?? \"\";\r\n  }\r\n\r\n  render(rowIndex: number) {\r\n    const rowId = this.dataTable.getRowIdentifierByIndex(rowIndex);\r\n    return (\r\n      <div\r\n        className={bodyCellClass(\r\n          rowIndex,\r\n          this.driverState.chosenRowId === rowId,\r\n          this.driverState.cursorRowId === rowId\r\n        )}\r\n        onClick={(e) => {\r\n          this.driverState.handleTableCellClicked(e, rowIndex)\r\n        }\r\n        }\r\n      >\r\n        {this.formattedText(rowIndex)}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport const ITextCellDriver = TypeSymbol<TextCellDriver>(\"ITextCellDriver\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { csToMomentFormat } from \"@origam/utils\";\r\nimport { T } from \"../utils/translation\";\r\nimport { getDefaultCsDateFormatDataFromCookie } from \"../utils/cookies\";\r\n\r\nexport function replaceDefaultDateFormats(formatFromServer: string) {\r\n  if (formatFromServer === \"long\") {\r\n    let defaultDateFormatData = getDefaultCsDateFormatDataFromCookie();\r\n    return defaultDateFormatData.defaultLongDateFormat;\r\n  }\r\n\r\n  if (formatFromServer === \"short\") {\r\n    let defaultDateFormatData = getDefaultCsDateFormatDataFromCookie();\r\n    return defaultDateFormatData.defaultShortDateFormat;\r\n  }\r\n\r\n  if (formatFromServer === \"time\") {\r\n    let defaultDateFormatData = getDefaultCsDateFormatDataFromCookie();\r\n    return defaultDateFormatData.defaultTimeFormat;\r\n  }\r\n  return formatFromServer;\r\n}\r\n\r\n\r\nexport function getMomentFormat(propertyXmlNode: any) {\r\n  const nodeAttributes = propertyXmlNode.attributes;\r\n  const csFormat = replaceDefaultDateFormats(nodeAttributes.FormatterPattern);\r\n  const momentFormat = csToMomentFormat(csFormat)\r\n  if (!momentFormat) {\r\n    throw new Error(T(\"CustomFormat \\\"{0}\\\" of the field named: \\\"{1}\\\", id: \\\"{2}\\\" is not valid\",\r\n      \"invalid_field_format\",\r\n      nodeAttributes.FormatterPattern, nodeAttributes.Name, nodeAttributes.ModelInstanceId));\r\n  }\r\n  return momentFormat;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { bodyCellClass } from \"./CellsCommon\";\r\nimport { DropdownDataTable, IBodyCellDriver } from \"../DropdownTableModel\";\r\nimport cx from \"classnames\";\r\nimport S from \"./NumberCell.module.scss\";\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { IDriverState } from \"modules/Editors/DropdownEditor/Cells/IDriverState\";\r\n\r\nexport class NumberCellDriver implements IBodyCellDriver {\r\n  constructor(\r\n    private dataIndex: number,\r\n    private dataTable: DropdownDataTable,\r\n    private driverState: IDriverState\r\n  ) {\r\n  }\r\n\r\n  formattedText(rowIndex: number){\r\n    if(this.dataTable.rowCount <= rowIndex){\r\n      return \"\";\r\n    }\r\n    return this.dataTable.getValue(rowIndex, this.dataIndex) ?? \"\";\r\n  }\r\n\r\n  render(rowIndex: number) {\r\n    const rowId = this.dataTable.getRowIdentifierByIndex(rowIndex);\r\n    return (\r\n      <div\r\n        className={cx(\r\n          bodyCellClass(\r\n            rowIndex,\r\n            this.driverState.chosenRowId === rowId,\r\n            this.driverState.cursorRowId === rowId\r\n          ),\r\n          S.cell\r\n        )}\r\n        onClick={(e) => this.driverState.handleTableCellClicked(e, rowIndex)}\r\n      >\r\n        {this.formattedText(rowIndex)}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport const INumberCellDriver = TypeSymbol<NumberCellDriver>(\"INumberCellDriver\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport cx from \"classnames\";\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport React from \"react\";\r\nimport { DropdownDataTable, IBodyCellDriver } from \"../DropdownTableModel\";\r\nimport S from \"./BooleanCell.module.scss\";\r\nimport { bodyCellClass } from \"./CellsCommon\";\r\nimport { IDriverState } from \"modules/Editors/DropdownEditor/Cells/IDriverState\";\r\n\r\nexport class BooleanCellDriver implements IBodyCellDriver {\r\n  constructor(\r\n    private dataIndex: number,\r\n    private dataTable: DropdownDataTable,\r\n    private driverState: IDriverState\r\n  ) {\r\n  }\r\n\r\n  formattedText(rowIndex: number){\r\n    if(this.dataTable.rowCount <= rowIndex){\r\n      return \"\";\r\n    }\r\n    return this.dataTable.getValue(rowIndex, this.dataIndex) ?? \"\";\r\n  }\r\n\r\n  render(rowIndex: number) {\r\n    const rowId = this.dataTable.getRowIdentifierByIndex(rowIndex);\r\n    return (\r\n      <div\r\n        className={cx(\r\n          bodyCellClass(rowIndex, this.driverState.chosenRowId === rowId, this.driverState.cursorRowId === rowId),\r\n          S.cell\r\n        )}\r\n        onClick={(e) => this.driverState.handleTableCellClicked(e, rowIndex)}\r\n      >\r\n        {this.formattedText(rowIndex) ? <i className=\"far fa-check-square\"></i> : <i className=\"far fa-square\"></i>}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport const IBooleanCellDriver = TypeSymbol<BooleanCellDriver>(\"IBooleanCellDriver\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { DropdownDataTable, IBodyCellDriver, } from \"modules/Editors/DropdownEditor/DropdownTableModel\";\r\nimport { bodyCellClass } from \"modules/Editors/DropdownEditor/Cells/CellsCommon\";\r\nimport React from \"react\";\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { TextCellDriver } from \"modules/Editors/DropdownEditor/Cells/TextCellDriver\";\r\nimport moment from \"moment\";\r\nimport { IDriverState } from \"modules/Editors/DropdownEditor/Cells/IDriverState\";\r\n\r\nexport class DateCellDriver implements IBodyCellDriver {\r\n  constructor(\r\n    private dataIndex: number,\r\n    private dataTable: DropdownDataTable,\r\n    private driverState: IDriverState,\r\n    private formatterPattern: string\r\n  ) {\r\n  }\r\n\r\n  formattedText(rowIndex: number){\r\n    if(this.dataTable.rowCount <= rowIndex){\r\n      return \"\";\r\n    }\r\n    const value = this.dataTable.getValue(rowIndex, this.dataIndex);\r\n    let momentValue = moment(value);\r\n    return momentValue.isValid() ? momentValue.format(this.formatterPattern) : \"\";\r\n  }\r\n\r\n  render(rowIndex: number) {\r\n    const rowId = this.dataTable.getRowIdentifierByIndex(rowIndex);\r\n\r\n    return (\r\n      <div\r\n        className={bodyCellClass(\r\n          rowIndex,\r\n          this.driverState.chosenRowId === rowId,\r\n          this.driverState.cursorRowId === rowId\r\n        )}\r\n        onClick={(e) => {\r\n          this.driverState.handleTableCellClicked(e, rowIndex);\r\n        }}\r\n      >\r\n        {this.formattedText(rowIndex)}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport const IDateCellDriver = TypeSymbol<TextCellDriver>(\"ITextCellDriver\");\r\n","import { DropdownColumnDrivers, DropdownDataTable } from \"modules/Editors/DropdownEditor/DropdownTableModel\";\r\nimport { IDriverState } from \"modules/Editors/DropdownEditor/Cells/IDriverState\";\r\nimport { findStopping } from \"xmlInterpreters/xmlUtils\";\r\nimport { getMomentFormat } from \"xmlInterpreters/getMomentFormat\";\r\nimport { TextCellDriver } from \"modules/Editors/DropdownEditor/Cells/TextCellDriver\";\r\nimport { NumberCellDriver } from \"modules/Editors/DropdownEditor/Cells/NumberCellDriver\";\r\nimport { BooleanCellDriver } from \"modules/Editors/DropdownEditor/Cells/BooleanCellDriver\";\r\nimport { DateCellDriver } from \"modules/Editors/DropdownEditor/Cells/DateCellDriver\";\r\nimport { DefaultHeaderCellDriver } from \"modules/Editors/DropdownEditor/Cells/HeaderCell\";\r\n\r\nexport class DropdownEditorSetup {\r\n  constructor(\r\n    public propertyId: string,\r\n    public lookupId: string,\r\n    public columnNames: string[],\r\n    public visibleColumnNames: string[],\r\n    public columnNameToIndex: Map<string, number>,\r\n    public showUniqueValues: boolean,\r\n    public identifier: string,\r\n    public identifierIndex: number,\r\n    public parameters: { [key: string]: any },\r\n    public dropdownType: string,\r\n    public cached: boolean,\r\n    public searchByFirstColumnOnly: boolean,\r\n    public columnDrivers: DropdownColumnDrivers,\r\n    public isLink?: boolean,\r\n  ) {\r\n  }\r\n}\r\n\r\nexport function DropdownEditorSetupFromXml(\r\n  xmlNode: any,\r\n  dropdownEditorDataTable: DropdownDataTable,\r\n  dropdownEditorBehavior: IDriverState,\r\n  isLink: boolean | undefined\r\n): DropdownEditorSetup {\r\n  const rat = xmlNode.attributes;\r\n  const lookupId = rat.LookupId;\r\n  const propertyId = rat.Id;\r\n  const showUniqueValues = rat.DropDownShowUniqueValues === \"true\";\r\n  const identifier = rat.Identifier;\r\n  let identifierIndex = 0;\r\n  const dropdownType = rat.DropDownType;\r\n  const cached = rat.Cached === \"true\";\r\n  const searchByFirstColumnOnly = rat.SearchByFirstColumnOnly === \"true\";\r\n\r\n  const columnNames: string[] = [identifier];\r\n  const visibleColumnNames: string[] = [];\r\n  const columnNameToIndex = new Map<string, number>([[identifier, identifierIndex]]);\r\n  let index = 0;\r\n  const drivers = new DropdownColumnDrivers();\r\n  if (rat.SuppressEmptyColumns === \"true\") {\r\n    drivers.driversFilter = (driver) => {\r\n      return dropdownEditorDataTable.columnIdsWithNoData.indexOf(driver.columnId) < 0;\r\n    };\r\n  }\r\n  for (let propertyXml of findStopping(xmlNode, (n) => n.name === \"Property\")) {\r\n    index++;\r\n    const attributes = propertyXml.attributes;\r\n    const id = attributes.Id;\r\n    columnNames.push(id);\r\n    columnNameToIndex.set(id, index);\r\n\r\n    const formatterPattern = attributes.FormatterPattern\r\n      ? getMomentFormat(propertyXml)\r\n      : \"\";\r\n    visibleColumnNames.push(id);\r\n    const name = attributes.Name;\r\n    const column = attributes.Column;\r\n\r\n    let bodyCellDriver;\r\n    switch (column) {\r\n      case \"Text\":\r\n        bodyCellDriver = new TextCellDriver(\r\n          index,\r\n          dropdownEditorDataTable,\r\n          dropdownEditorBehavior\r\n        );\r\n        break;\r\n      case \"Number\":\r\n        bodyCellDriver = new NumberCellDriver(\r\n          index,\r\n          dropdownEditorDataTable,\r\n          dropdownEditorBehavior\r\n        );\r\n        break;\r\n      case \"CheckBox\":\r\n        bodyCellDriver = new BooleanCellDriver(\r\n          index,\r\n          dropdownEditorDataTable,\r\n          dropdownEditorBehavior\r\n        );\r\n        break;\r\n      case \"Date\":\r\n        bodyCellDriver = new DateCellDriver(\r\n          index,\r\n          dropdownEditorDataTable,\r\n          dropdownEditorBehavior,\r\n          formatterPattern\r\n        );\r\n        break;\r\n      default:\r\n        throw new Error(\"Unknown column type \" + column);\r\n    }\r\n\r\n    drivers.allDrivers.push({\r\n      columnId: id,\r\n      headerCellDriver: new DefaultHeaderCellDriver(name),\r\n      bodyCellDriver,\r\n    });\r\n  }\r\n  const parameters: { [k: string]: any } = {};\r\n\r\n  for (let ddp of findStopping(xmlNode, (n) => n.name === \"ComboBoxParameterMapping\")) {\r\n    const pat = ddp.attributes;\r\n    parameters[pat.ParameterName] = pat.FieldName;\r\n  }\r\n  return new DropdownEditorSetup(\r\n    propertyId,\r\n    lookupId,\r\n    columnNames,\r\n    visibleColumnNames,\r\n    columnNameToIndex,\r\n    showUniqueValues,\r\n    identifier,\r\n    identifierIndex,\r\n    parameters,\r\n    dropdownType,\r\n    cached,\r\n    searchByFirstColumnOnly,\r\n    drivers,\r\n    isLink\r\n  );\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { bind } from \"@decorize/bind\";\r\nimport { DataViewAPI } from \"modules/DataView/DataViewAPI\";\r\nimport { RowCursor } from \"modules/DataView/TableCursor\";\r\nimport { dropdownPageSize, IDropdownEditorBehavior } from \"./DropdownEditorBehavior\";\r\nimport { EagerlyLoadedGrid } from \"./DropdownEditorCommon\";\r\nimport { DropdownEditorSetup } from \"modules/Editors/DropdownEditor/DropdownEditorSetup\";\r\n\r\nexport interface IDropdownEditorApi {\r\n  getLookupList(searchTerm: string): Generator;\r\n}\r\n\r\n@bind\r\nexport class DropdownEditorApi implements IDropdownEditorApi {\r\n  constructor(\r\n    private setup: () => DropdownEditorSetup,\r\n    private rowCursor: RowCursor,\r\n    private api: DataViewAPI,\r\n    private behavior: () => IDropdownEditorBehavior,\r\n  ) {\r\n  }\r\n\r\n  *getLookupList(searchTerm: string): Generator {\r\n    const setup = this.setup();\r\n    if (setup.dropdownType === EagerlyLoadedGrid) {\r\n      return yield*this.api.getLookupList({\r\n        ColumnNames: setup.columnNames,\r\n        Property: setup.propertyId,\r\n        Id: this.rowCursor.selectedId!,\r\n        LookupId: setup.lookupId,\r\n        Parameters: setup.parameters,\r\n        ShowUniqueValues: setup.showUniqueValues,\r\n        SearchText: searchTerm || \"\",\r\n        PageSize: -1,\r\n        PageNumber: 1,\r\n      });\r\n    } else {\r\n      return yield*this.api.getLookupList({\r\n        ColumnNames: setup.columnNames,\r\n        Property: setup.propertyId,\r\n        Id: this.rowCursor.selectedId!,\r\n        LookupId: setup.lookupId,\r\n        Parameters: setup.parameters,\r\n        ShowUniqueValues: setup.showUniqueValues,\r\n        SearchText: searchTerm || \"\",\r\n        PageSize: dropdownPageSize,\r\n        PageNumber: this.behavior().willLoadPage,\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Observer } from \"mobx-react\";\r\nimport React, { useContext, useEffect, useMemo } from \"react\";\r\nimport { CtxDropdownEditor } from \"./DropdownEditor\";\r\nimport cx from 'classnames';\r\nimport S from \"@origam/components/src/components/Dropdown/Dropdown.module.scss\"\r\n\r\nexport function DropdownEditorInput(props: {\r\n  backgroundColor?: string;\r\n  foregroundColor?: string;\r\n  customStyle?: any;\r\n}) {\r\n  const beh = useContext(CtxDropdownEditor).behavior;\r\n  const data = useContext(CtxDropdownEditor).editorData;\r\n  const setup = useContext(CtxDropdownEditor).setup;\r\n  const refInput = useMemo(() => {\r\n    return (elm: any) => {\r\n      beh.refInputElement(elm);\r\n    };\r\n  }, [beh]);\r\n\r\n  useEffect(() => {\r\n    if (beh.subscribeToFocusManager && beh.elmInputElement) {\r\n      beh.subscribeToFocusManager(beh.elmInputElement);\r\n    }\r\n    beh.updateTextOverflowState();\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    beh.updateTextOverflowState();\r\n  }); // eslint-disable-line react-hooks/exhaustive-deps\r\n  function getStyle() {\r\n    if (props.customStyle) {\r\n      return props.customStyle;\r\n    } else {\r\n      return {\r\n        color: props.foregroundColor,\r\n        backgroundColor: props.backgroundColor,\r\n      };\r\n    }\r\n  }\r\n\r\n\r\n  return (\r\n    <Observer>\r\n      {() => (\r\n        <input\r\n          className={cx(\"input\", S.input, {isLink: setup.isLink})}\r\n          readOnly={beh.isReadOnly}\r\n          ref={refInput}\r\n          placeholder={data.isResolving ? \"Loading...\" : \"\"}\r\n          onChange={beh.handleInputChange}\r\n          onKeyDown={beh.handleInputKeyDown}\r\n          onFocus={!beh.isReadOnly ? beh.handleInputFocus : undefined}\r\n          onBlur={!beh.isReadOnly ? beh.handleInputBlur : undefined}\r\n          onDoubleClick={beh.onDoubleClick}\r\n          onClick={beh.onClick}\r\n          value={beh.inputValue || \"\"}\r\n          style={getStyle()}\r\n          autoComplete={\"off\"}\r\n          autoCorrect={\"off\"}\r\n          autoCapitalize={\"off\"}\r\n          spellCheck={\"false\"}\r\n        />\r\n      )}\r\n    </Observer>\r\n  );\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Observer } from \"mobx-react\";\r\nimport React, { useContext, useState } from \"react\";\r\nimport CS from \"@origam/components/src/components/Dropdown/Dropdown.module.scss\"\r\nimport cx from \"classnames\";\r\nimport { CtxDropdownRefCtrl } from \"@origam/components\";\r\nimport { CtxDropdownEditor } from \"./DropdownEditor\";\r\nimport { DropdownEditorInput } from \"./DropdownEditorInput\";\r\nimport { action, observable } from \"mobx\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { DropdownEditorBehavior } from \"./DropdownEditorBehavior\";\r\n\r\nexport function TriggerContextMenu(props: { state: TriggerContextMenuState }) {\r\n  return (\r\n    <Observer>\r\n      {() => (\r\n        <>\r\n          {props.state.isDropped\r\n            ? createPortal(\r\n              <div\r\n                className={\"Dropdowner_droppedBox\"}\r\n                style={{top: props.state.top, left: props.state.left}}\r\n              >\r\n                <div className=\"Dropdown_root\">\r\n                  <div\r\n                    className={\"DropdownItem_root\"}\r\n                    onMouseDown={(e) => e.stopPropagation()}\r\n                    onClick={props.state.handleRefreshClick}\r\n                  >\r\n                    Refresh\r\n                  </div>\r\n                </div>\r\n              </div>,\r\n              document.getElementById(\"dropdown-portal\")!\r\n            )\r\n            : null}\r\n        </>\r\n      )}\r\n    </Observer>\r\n  );\r\n}\r\n\r\nclass TriggerContextMenuState {\r\n  constructor(public behaviour: DropdownEditorBehavior) {\r\n  }\r\n\r\n  @observable isDropped = false;\r\n  @observable top = 0;\r\n  @observable left = 0;\r\n\r\n  @action.bound\r\n  handleTriggerContextMenu(event: any) {\r\n    event.preventDefault();\r\n    if (!this.isDropped) {\r\n      this.top = event.clientY;\r\n      this.left = event.clientX;\r\n      this.isDropped = true;\r\n      window.addEventListener(\"mousedown\", this.handleScreenMouseDown);\r\n    } else {\r\n      this.isDropped = false;\r\n      window.removeEventListener(\"mousedown\", this.handleScreenMouseDown);\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  handleScreenContextMenu(event: any) {\r\n    event.preventDefault();\r\n    this.isDropped = false;\r\n  }\r\n\r\n  @action.bound\r\n  handleScreenMouseDown(event: any) {\r\n    event.preventDefault();\r\n    this.isDropped = false;\r\n  }\r\n\r\n  @action.bound\r\n  handleRefreshClick(event: any) {\r\n    this.isDropped = false;\r\n    this.behaviour.clearCache();\r\n  }\r\n}\r\n\r\nexport function DropdownEditorControl(props: {\r\n  backgroundColor?: string;\r\n  foregroundColor?: string;\r\n  customStyle?: any;\r\n}) {\r\n  const ref = useContext(CtxDropdownRefCtrl);\r\n  const beh = useContext(CtxDropdownEditor).behavior;\r\n  const [triggerContextMenu] = useState(() => new TriggerContextMenuState(beh));\r\n\r\n  return (\r\n    <Observer>\r\n      {() => (\r\n        <div className={CS.control} ref={ref} onMouseDown={beh.handleControlMouseDown}>\r\n          <DropdownEditorInput\r\n            backgroundColor={props.backgroundColor}\r\n            foregroundColor={props.foregroundColor}\r\n            customStyle={props.customStyle}\r\n          />\r\n          <div\r\n            className={cx(\"inputBtn\", \"lastOne\", beh.isReadOnly && \"readOnly\")}\r\n            tabIndex={-1}\r\n            onClick={!beh.isReadOnly ? beh.handleInputBtnClick : undefined}\r\n            onContextMenu={(event) => {\r\n              beh.handleTriggerContextMenu(event);\r\n              triggerContextMenu.handleTriggerContextMenu(event);\r\n            }}\r\n            onMouseDown={!beh.isReadOnly ? beh.handleControlMouseDown : undefined}\r\n          >\r\n            {!beh.isWorking ? (\r\n              <i className=\"fas fa-caret-down\"/>\r\n            ) : (\r\n              <i className=\"fas fa-spinner fa-spin\"/>\r\n            )}\r\n          </div>\r\n\r\n          <TriggerContextMenu state={triggerContextMenu}/>\r\n        </div>\r\n      )}\r\n    </Observer>\r\n  );\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { bind } from \"@decorize/bind\";\r\nimport { action, computed } from \"mobx\";\r\nimport { DataViewData } from \"modules/DataView/DataViewData\";\r\nimport { RowCursor } from \"modules/DataView/TableCursor\";\r\nimport { DropdownEditorSetup } from \"modules/Editors/DropdownEditor/DropdownEditorSetup\";\r\n\r\nexport interface IDropdownEditorData {\r\n  idsInEditor: string[];\r\n  value: string | string[] | null;\r\n  text: string;\r\n  isResolving: boolean;\r\n\r\n  chooseNewValue(value: any): void;\r\n\r\n  remove(value: any): void;\r\n\r\n  setValue(value: string[]): void;\r\n}\r\n\r\n@bind\r\nexport class DropdownEditorData implements IDropdownEditorData {\r\n  constructor(\r\n    private dataTable: DataViewData,\r\n    private rowCursor: RowCursor,\r\n    private setup: () => DropdownEditorSetup\r\n  ) {\r\n  }\r\n\r\n  setValue(value: string[]) {\r\n  }\r\n\r\n  @computed get value(): string | string[] | null {\r\n    if (this.rowCursor.selectedId) {\r\n      return this.dataTable.getCellValue(this.rowCursor.selectedId, this.setup().propertyId);\r\n    } else return null;\r\n  }\r\n\r\n  @computed get text(): string {\r\n    if (!this.isResolving && this.value) {\r\n      return this.dataTable.getCellText(this.setup().propertyId, this.value);\r\n    } else return \"\";\r\n  }\r\n\r\n  get isResolving() {\r\n    return this.dataTable.getIsCellTextLoading(this.setup().propertyId, this.value);\r\n  }\r\n\r\n  @action.bound chooseNewValue(value: any) {\r\n    if (this.rowCursor.selectedId) {\r\n      this.dataTable.setNewValue(this.rowCursor.selectedId, this.setup().propertyId, value);\r\n    }\r\n  }\r\n\r\n  idsInEditor: string[] = [];\r\n\r\n  remove(value: any): void {\r\n    // not needed in DropdownEditorData\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nlet dummyCanvas: HTMLCanvasElement | undefined;\r\n\r\nexport function getTextWidth(text: string, font : string) {\r\n  const canvas = dummyCanvas || (dummyCanvas = document.createElement(\"canvas\"));\r\n  const context = canvas.getContext(\"2d\");\r\n  context!.font = font;\r\n  const metrics = context!.measureText(text);\r\n  return metrics.width;\r\n}\r\n\r\nfunction getCssStyle(element: HTMLElement, prop: string) {\r\n  return window.getComputedStyle(element, null).getPropertyValue(prop);\r\n}\r\n\r\nexport function getCanvasFontSize(el = document.body) {\r\n  const fontWeight = getCssStyle(el, 'font-weight') || 'normal';\r\n  const fontSize = getCssStyle(el, 'font-size') || '16px';\r\n  const fontFamily = getCssStyle(el, 'font-family') || 'Times New Roman';\r\n\r\n  return `${fontWeight} ${fontSize} ${fontFamily}`;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { bind } from \"@decorize/bind\";\r\nimport { DataViewData } from \"../../DataView/DataViewData\";\r\nimport { RowCursor } from \"../../DataView/TableCursor\";\r\nimport { action, computed } from \"mobx\";\r\nimport { DropdownEditorData, IDropdownEditorData } from \"./DropdownEditorData\";\r\nimport { DropdownEditorSetup } from \"modules/Editors/DropdownEditor/DropdownEditorSetup\";\r\n\r\n@bind\r\nexport class TagInputEditorData implements IDropdownEditorData {\r\n  dropdownEditorData: IDropdownEditorData;\r\n\r\n  constructor(\r\n    private dataTable: DataViewData,\r\n    private rowCursor: RowCursor,\r\n    private setup: () => DropdownEditorSetup\r\n  ) {\r\n    this.dropdownEditorData = new DropdownEditorData(dataTable, rowCursor, setup);\r\n  }\r\n\r\n  setValue(value: string[]) {\r\n  }\r\n\r\n  @computed get value(): string | string[] | null {\r\n    return this.dropdownEditorData.value;\r\n  }\r\n\r\n  @computed get text(): string {\r\n    return this.dropdownEditorData.text;\r\n  }\r\n\r\n  get isResolving() {\r\n    return this.dropdownEditorData.isResolving;\r\n  }\r\n\r\n  @action.bound chooseNewValue(value: any) {\r\n    if (this.value && this.value.includes(value)) {\r\n      return;\r\n    }\r\n    const newArray = [...this.value ?? [], value];\r\n    if (this.rowCursor.selectedId) {\r\n      this.dataTable.setNewValue(this.rowCursor.selectedId, this.setup().propertyId, newArray);\r\n    }\r\n  }\r\n\r\n  get idsInEditor() {\r\n    return (this.value ? this.value : []) as string[];\r\n  }\r\n\r\n  remove(value: any): void {\r\n    // not needed in TagInputEditorData\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { MobXProviderContext, Observer } from \"mobx-react\";\r\nimport React, { createContext, useContext, useEffect, useState } from \"react\";\r\nimport { DropdownLayout, DropdownLayoutBody } from \"@origam/components\";\r\nimport { DropdownEditorApi } from \"./DropdownEditorApi\";\r\nimport { DropdownEditorBehavior} from \"./DropdownEditorBehavior\";\r\nimport { DropdownEditorBody } from \"./DropdownEditorBody\";\r\nimport { DropdownEditorControl } from \"./DropdownEditorControl\";\r\nimport { DropdownEditorData, IDropdownEditorData } from \"./DropdownEditorData\";\r\nimport { DropdownEditorLookupListCache } from \"./DropdownEditorLookupListCache\";\r\nimport { DropdownDataTable } from \"./DropdownTableModel\";\r\nimport { TagInputEditorData } from \"./TagInputEditorData\";\r\nimport { IFocusable } from \"../../../model/entities/FormFocusManager\";\r\nimport { IWorkbench } from \"model/entities/types/IWorkbench\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\nimport { DropdownEditorSetup, DropdownEditorSetupFromXml } from \"modules/Editors/DropdownEditor/DropdownEditorSetup\";\r\n\r\nexport interface IDropdownEditorContext {\r\n  behavior: DropdownEditorBehavior;\r\n  editorData: IDropdownEditorData;\r\n  editorDataTable: DropdownDataTable;\r\n  setup: DropdownEditorSetup;\r\n}\r\n\r\nexport const CtxDropdownEditor = createContext<IDropdownEditorContext>(null as any);\r\n\r\nexport const IGetDropdownEditorSetup = TypeSymbol<() => DropdownEditorSetup>(\r\n  \"IGetDropdownEditorSetup\"\r\n);\r\n\r\nexport function DropdownEditor(props: {\r\n  editor?: JSX.Element;\r\n  backgroundColor?: string;\r\n  foregroundColor?: string;\r\n  customStyle?: any;\r\n}) {\r\n  const beh = useContext(CtxDropdownEditor).behavior;\r\n  const workbench = useContext(MobXProviderContext).workbench as IWorkbench;\r\n  return (\r\n    <Observer>\r\n      {() => (\r\n        <DropdownLayout\r\n          isDropped={beh.isBodyDisplayed}\r\n          onDropupRequest={beh.dropUp}\r\n          renderCtrl={() =>\r\n            props.editor ? (\r\n              props.editor\r\n            ) : (\r\n              <DropdownEditorControl\r\n                backgroundColor={props.backgroundColor}\r\n                foregroundColor={props.foregroundColor}\r\n                customStyle={props.customStyle}\r\n              />\r\n            )\r\n          }\r\n          renderDropdown={() =>\r\n            <DropdownLayoutBody\r\n              render={() => <DropdownEditorBody/>}\r\n              minSideMargin={isMobileLayoutActive(workbench) ? 20 : 50}\r\n            />\r\n          }\r\n        />\r\n      )}\r\n    </Observer>\r\n  );\r\n}\r\n\r\nexport function XmlBuildDropdownEditor(props: {\r\n  xmlNode: any;\r\n  isReadOnly: boolean;\r\n  backgroundColor?: string;\r\n  foregroundColor?: string;\r\n  customStyle?: any;\r\n  tagEditor?: JSX.Element;\r\n  isLink?: boolean;\r\n  autoSort?: boolean;\r\n  onTextOverflowChanged?: (toolTip: string | null | undefined) => void;\r\n  onDoubleClick?: (event: any) => void;\r\n  onClick?: (event: any) => void;\r\n  subscribeToFocusManager?: (obj: IFocusable) => void;\r\n  onKeyDown?(event: any): void;\r\n}) {\r\n  const mobxContext = useContext(MobXProviderContext);\r\n  const {dataViewRowCursor, dataViewApi, dataViewData} = mobxContext.dataView;\r\n  const workbench = mobxContext.workbench;\r\n  const {lookupListCache} = workbench;\r\n\r\n  const [dropdownEditorInfrastructure] = useState<IDropdownEditorContext>(() => {\r\n    const dropdownEditorApi: DropdownEditorApi = new DropdownEditorApi(\r\n      () => dropdownEditorSetup,\r\n      dataViewRowCursor,\r\n      dataViewApi,\r\n      () => dropdownEditorBehavior\r\n    );\r\n    const dropdownEditorData: IDropdownEditorData = props.tagEditor\r\n      ? new TagInputEditorData(dataViewData, dataViewRowCursor, () => dropdownEditorSetup)\r\n      : new DropdownEditorData(dataViewData, dataViewRowCursor, () => dropdownEditorSetup);\r\n    const dropdownEditorDataTable = new DropdownDataTable(\r\n      () => dropdownEditorSetup,\r\n      dropdownEditorData\r\n    );\r\n\r\n    const dropdownEditorLookupListCache = new DropdownEditorLookupListCache(\r\n      () => dropdownEditorSetup,\r\n      lookupListCache\r\n    );\r\n\r\n    const dropdownEditorBehavior = new DropdownEditorBehavior({\r\n      api: dropdownEditorApi,\r\n      data: dropdownEditorData,\r\n      dataTable: dropdownEditorDataTable,\r\n      setup: () => dropdownEditorSetup,\r\n      cache: dropdownEditorLookupListCache,\r\n      isReadOnly: props.isReadOnly,\r\n      onDoubleClick: props.onDoubleClick,\r\n      onClick: props.onClick,\r\n      subscribeToFocusManager: props.subscribeToFocusManager,\r\n      onKeyDown: props.onKeyDown,\r\n      autoSort: props.autoSort,\r\n      onTextOverflowChanged: props.onTextOverflowChanged,\r\n    });\r\n\r\n    const dropdownEditorSetup = DropdownEditorSetupFromXml(\r\n      props.xmlNode, dropdownEditorDataTable, dropdownEditorBehavior, props.isLink);\r\n\r\n    return {\r\n      behavior: dropdownEditorBehavior,\r\n      editorData: dropdownEditorData,\r\n      columnDrivers: dropdownEditorSetup.columnDrivers,\r\n      editorDataTable: dropdownEditorDataTable,\r\n      setup: dropdownEditorSetup,\r\n    };\r\n  });\r\n\r\n  useEffect(() => {\r\n      dropdownEditorInfrastructure.behavior.isReadOnly = props.isReadOnly;\r\n\r\n    },\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    [props.isReadOnly, dropdownEditorInfrastructure.behavior.isReadOnly]\r\n  );\r\n\r\n  dropdownEditorInfrastructure.behavior.onClick = props.onClick;\r\n  dropdownEditorInfrastructure.behavior.onDoubleClick = props.onDoubleClick;\r\n\r\n  return (\r\n    <CtxDropdownEditor.Provider value={dropdownEditorInfrastructure}>\r\n      <DropdownEditor\r\n        editor={props.tagEditor}\r\n        backgroundColor={props.backgroundColor}\r\n        foregroundColor={props.foregroundColor}\r\n        customStyle={props.customStyle}\r\n      />\r\n    </CtxDropdownEditor.Provider>\r\n  );\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { observer, Observer } from \"mobx-react\";\r\nimport React, { useContext, useEffect, useMemo, createRef } from \"react\";\r\nimport { GridCellProps, MultiGrid } from \"react-virtualized\";\r\nimport { CtxCell } from \"./Cells/CellsCommon\";\r\nimport S from \"@origam/components/src/components/Dropdown/Dropdown.module.scss\"\r\nimport { CtxDropdownCtrlRect, CtxDropdownRefBody } from \"@origam/components\";\r\nimport { CtxDropdownEditor } from \"./DropdownEditor\";\r\nimport { rowHeight } from \"gui/Components/ScreenElements/Table/TableRendering/cells/cellsCommon\";\r\nimport cx from \"classnames\";\r\nimport { getCanvasFontSize, getTextWidth } from \"utils/textMeasurement\";\r\nimport { DropdownColumnDrivers, DropdownDataTable } from \"modules/Editors/DropdownEditor/DropdownTableModel\";\r\nimport { BoundingRect } from \"react-measure\";\r\nimport { IDropdownEditorBehavior } from \"modules/Editors/DropdownEditor/DropdownEditorBehavior\";\r\nimport { observable } from \"mobx\";\r\n\r\nexport function DropdownEditorBody() {\r\n  const refCtxBody = useContext(CtxDropdownRefBody);\r\n  const beh = useContext(CtxDropdownEditor).behavior;\r\n\r\n  const ref = useMemo(\r\n    () => (elm: any) => {\r\n      refCtxBody(elm);\r\n      beh.refDropdownBody(elm);\r\n    },\r\n    [beh, refCtxBody]\r\n  );\r\n\r\n  useEffect(() => {\r\n    window.addEventListener(\"mousedown\", beh.handleWindowMouseDown);\r\n    return () => window.removeEventListener(\"mousedown\", beh.handleWindowMouseDown);\r\n  }, [beh]);\r\n\r\n  const drivers = useContext(CtxDropdownEditor).setup.columnDrivers;\r\n  const dataTable = useContext(CtxDropdownEditor).editorDataTable;\r\n  const rectCtrl = useContext(CtxDropdownCtrlRect);\r\n\r\n  return (\r\n    <Observer>\r\n      {() => (\r\n        <div ref={ref} className={S.body} onMouseDown={beh.handleBodyMouseDown}>\r\n          <DropdownEditorTable\r\n            drivers={drivers}\r\n            dataTable={dataTable}\r\n            rectCtrl={rectCtrl}\r\n            beh={beh}\r\n            rowHeight={rowHeight}\r\n          />\r\n        </div>\r\n      )}\r\n    </Observer>\r\n  );\r\n}\r\n\r\n@observer\r\nexport class DropdownEditorTable extends  React.Component<{\r\n  drivers: DropdownColumnDrivers,\r\n  dataTable: DropdownDataTable,\r\n  rectCtrl: BoundingRect,\r\n  beh: IDropdownEditorBehavior,\r\n  rowHeight: number\r\n}> {\r\n  refMultiGrid = createRef<MultiGrid>();\r\n  @observable\r\n  scrollbarSize = { horiz: 0, vert: 0 };\r\n  hasHeader: boolean;\r\n  hoveredRowIndex= - 1;\r\n  columnCount = 0;\r\n  readonly cellPadding = 20;\r\n  readonly maxHeight = 150;\r\n\r\n  get rowCount(){\r\n    return this.props.dataTable.rowCount + (this.hasHeader ? 1 : 0);\r\n  }\r\n\r\n  get height(){\r\n    let height = 0;\r\n    for (let i = 0; i < this.rowCount; i++) {\r\n      height = height + this.props.rowHeight;\r\n    }\r\n    return Math.min(height, this.maxHeight) + this.scrollbarSize.horiz;\r\n  }\r\n\r\n  constructor(props: any) {\r\n    super(props);\r\n    this.columnCount = this.props.drivers.driverCount;\r\n    this.hasHeader = this.columnCount > 1;\r\n  }\r\n\r\n  handleScrollbarPresenceChange(args: {\r\n    horizontal: boolean;\r\n    size: number;\r\n    vertical: boolean;\r\n  }) {\r\n    this.scrollbarSize = {\r\n      horiz: args.horizontal ? args.size : 0,\r\n      vert: args.vertical ? args.size : 0,\r\n    };\r\n  }\r\n\r\n\r\n  renderTableCell({columnIndex, key, parent, rowIndex, style}: GridCellProps) {\r\n    const Prov = CtxCell.Provider as any;\r\n    return (\r\n      <Prov\r\n        key={key}\r\n        value={{visibleColumnIndex: columnIndex, visibleRowIndex: rowIndex}}\r\n        style={style}\r\n      >\r\n        {(this.hasHeader && rowIndex > 0) || !this.hasHeader ? (\r\n          <div\r\n            style={style}\r\n            className={cx({ isHoveredRow: rowIndex === this.hoveredRowIndex })}\r\n            onMouseOver={(evt) => {\r\n              this.hoveredRowIndex = rowIndex;\r\n            }}\r\n            onMouseOut={(evt) => {\r\n              this.hoveredRowIndex= -1;\r\n            }}\r\n          >\r\n            <Observer>\r\n              {() => (\r\n                <>\r\n                  {this.props.drivers\r\n                    .getDriver(columnIndex)\r\n                    .bodyCellDriver.render(rowIndex - (this.hasHeader ? 1 : 0))}\r\n                </>\r\n              )}\r\n            </Observer>\r\n          </div>\r\n        ) : (\r\n          <div style={style}>\r\n            <Observer>\r\n              {() => <>{this.props.drivers.getDriver(columnIndex).headerCellDriver.render()}</>}\r\n            </Observer>\r\n          </div>\r\n        )}\r\n      </Prov>\r\n    );\r\n  }\r\n\r\n  render(){\r\n    let columnWidthSum = 0;\r\n    let width = 0;\r\n    let widths: number[] = [];\r\n    for (let columnIndex = 0; columnIndex < this.columnCount; columnIndex++) {\r\n      let cellWidth = 100;\r\n      for (let rowIndex = 0; rowIndex < this.rowCount - 1; rowIndex++) {\r\n        const cellText = this.props.drivers.getDriver(columnIndex).bodyCellDriver.formattedText(rowIndex);\r\n        const currentCellWidth = Math.round(getTextWidth(cellText, getCanvasFontSize())) + this.cellPadding;\r\n        if(currentCellWidth > cellWidth){\r\n          cellWidth = currentCellWidth;\r\n        }\r\n      }\r\n\r\n      width = width + cellWidth;\r\n      widths.push(cellWidth);\r\n      columnWidthSum = columnWidthSum + cellWidth;\r\n      if (width >= window.innerWidth - 100) {\r\n        width = window.innerWidth - 100;\r\n        break;\r\n      }\r\n    }\r\n\r\n    width = Math.max(width + this.scrollbarSize.vert, this.props.rectCtrl.width!);\r\n    let columnGrowFactor = 1;\r\n    if (columnWidthSum > 0 && columnWidthSum < this.props.rectCtrl.width!) {\r\n      columnGrowFactor = (width - this.scrollbarSize.vert) / columnWidthSum;\r\n    }\r\n    widths = widths.map((w) => w * columnGrowFactor);\r\n\r\n    if(width === 0){\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <MultiGrid\r\n        ref={this.refMultiGrid}\r\n        scrollToRow={this.props.beh.scrollToRowIndex}\r\n        scrollToAlignment=\"center\"\r\n        onScrollbarPresenceChange={args => this.handleScrollbarPresenceChange(args)}\r\n        classNameTopRightGrid={S.table}\r\n        classNameBottomRightGrid={S.table}\r\n        columnCount={this.columnCount}\r\n        rowCount={this.rowCount}\r\n        columnWidth={({ index }) => widths[index]}\r\n        rowHeight={this.props.rowHeight}\r\n        fixedRowCount={this.hasHeader ? 1 : 0}\r\n        height={this.height}\r\n        width={width}\r\n        cellRenderer={args => this.renderTableCell(args)}\r\n        onScroll={this.props.beh.handleScroll}\r\n      />\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Observer } from \"mobx-react\";\r\nimport React, { useEffect, useMemo } from \"react\";\r\nimport cx from 'classnames';\r\nimport S from \"@origam/components/src/components/Dropdown/Dropdown.module.scss\"\r\nimport { MobileDropdownBehavior } from \"gui/connections/MobileComponents/Form/ComboBox/MobileDropdownBehavior\";\r\nimport { IDropdownEditorData } from \"modules/Editors/DropdownEditor/DropdownEditorData\";\r\n\r\nexport function MobileDropdownEditorInput(props: {\r\n  backgroundColor?: string;\r\n  foregroundColor?: string;\r\n  customStyle?: any;\r\n  behavior: MobileDropdownBehavior,\r\n  isLink?: boolean,\r\n  editorData: IDropdownEditorData\r\n}) {\r\n  const refInput = useMemo(() => {\r\n    return (elm: any) => {\r\n      props.behavior.refInputElement(elm);\r\n    };\r\n  }, [props.behavior]);\r\n\r\n  useEffect(() => {\r\n    props.behavior.updateTextOverflowState();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n  function getStyle() {\r\n    if (props.customStyle) {\r\n      return props.customStyle;\r\n    } else {\r\n      return {\r\n        color: props.foregroundColor,\r\n        backgroundColor: props.backgroundColor,\r\n      };\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Observer>\r\n      {() => (\r\n        <input\r\n          className={cx(\"input\", S.input, {isLink: props.isLink})}\r\n          ref={refInput}\r\n          placeholder={props.editorData.isResolving ? \"Loading...\" : \"\"}\r\n          onChange={props.behavior.handleInputChange}\r\n          value={props.behavior.inputValue || \"\"}\r\n          style={getStyle()}\r\n          autoComplete={\"off\"}\r\n          autoCorrect={\"off\"}\r\n          autoCapitalize={\"off\"}\r\n          spellCheck={\"false\"}\r\n        />\r\n      )}\r\n    </Observer>\r\n  );\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useContext, useEffect } from \"react\";\r\nimport S from \"gui/connections/MobileComponents/Form/ComboBox/ComboFullScreenEditor.module.scss\";\r\nimport cx from \"classnames\";\r\nimport CS from \"@origam/components/src/components/Dropdown/Dropdown.module.scss\";\r\nimport { CtxDropdownRefCtrl } from \"@origam/components\";\r\nimport { DropdownEditorTable } from \"modules/Editors/DropdownEditor/DropdownEditorBody\";\r\nimport { MobileDropdownBehavior } from \"gui/connections/MobileComponents/Form/ComboBox/MobileDropdownBehavior\";\r\nimport { DropdownColumnDrivers, DropdownDataTable } from \"modules/Editors/DropdownEditor/DropdownTableModel\";\r\nimport { MobileDropdownEditorInput } from \"gui/connections/MobileComponents/Form/ComboBox/MobileDropdownEditorInput\";\r\nimport { IDropdownEditorData } from \"modules/Editors/DropdownEditor/DropdownEditorData\";\r\n\r\n\r\ninterface IComboFullScreenEditorProps {\r\n  behavior: MobileDropdownBehavior;\r\n  dataTable: DropdownDataTable;\r\n  columnDrivers: DropdownColumnDrivers;\r\n  editorData: IDropdownEditorData;\r\n  backgroundColor?: string;\r\n  foregroundColor?: string;\r\n  customStyle?: any;\r\n  isLink?: boolean,\r\n}\r\n\r\nexport const ComboFullScreenEditor: React.FC<IComboFullScreenEditorProps> = (props) => {\r\n\r\n  const ref = useContext(CtxDropdownRefCtrl);\r\n\r\n  useEffect(()=>{\r\n    props.behavior.handleInputChange({target:{value:\"\"}});\r\n    props.behavior.makeFocused();\r\n  });\r\n\r\n  return (\r\n    <div className={cx(CS.control, S.root)} ref={ref}>\r\n      <MobileDropdownEditorInput\r\n        backgroundColor={props.backgroundColor}\r\n        foregroundColor={props.foregroundColor}\r\n        customStyle={props.customStyle}\r\n        isLink={props.isLink}\r\n        behavior={props.behavior}\r\n        editorData={props.editorData}\r\n      />\r\n      <DropdownEditorTable\r\n        drivers={props.columnDrivers}\r\n        dataTable={props.dataTable}\r\n        rectCtrl={{\r\n          top: 0,\r\n          left: 0,\r\n          width: window.screen.width,\r\n          height: 0,\r\n          bottom: 0,\r\n          right: 0,\r\n        }}\r\n        beh={props.behavior}\r\n        rowHeight={30}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\n\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"./TagInput.module.css\";\r\n\r\nexport const TagInput: React.FC<{ className?: string }> = (props) => {\r\n  return (\r\n    <div className={S.tagInputContainer + (props.className ? ` ${props.className}` : \"\")}>\r\n      {props.children}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const TagInputAdd: React.FC<{\r\n  domRef?: any;\r\n  className?: string;\r\n  onClick: (event: any) => void;\r\n  onMouseDown?: (event: any) => void;\r\n}> = (props) => {\r\n\r\n  return (\r\n    <div\r\n      className={S.tagInputAdd + (props.className ? ` ${props.className}` : \"\")}\r\n      onClick={(event) => props.onClick(event)}\r\n      onMouseDown={props.onMouseDown}\r\n      ref={props.domRef}\r\n    >\r\n      <i className=\"fas fa-plus\"/>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const TagInputItemDelete: React.FC<{\r\n  onClick?: (event: any) => void;\r\n  className?: string;\r\n}> = (props) => {\r\n  return (\r\n    <div\r\n      className={S.tagInputItemDelete + (props.className ? ` ${props.className}` : \"\")}\r\n      onClick={props.onClick}\r\n    >\r\n      <i className=\"fas fa-times\"/>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const TagInputItem: React.FC<{ className?: string }> = (props) => {\r\n  return (\r\n    <div className={S.tagInputItem + (props.className ? ` ${props.className}` : \"\")}>\r\n      {props.children}\r\n    </div>\r\n  );\r\n};\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useContext, useEffect, useMemo, useRef, useState } from \"react\";\r\n\r\nimport CS from \"gui/Components/ScreenElements/Editors/CommonStyle.module.css\";\r\nimport S from \"gui/Components/ScreenElements/Editors/TagInputEditor.module.css\";\r\n\r\nimport { TagInput, TagInputAdd, TagInputItem, TagInputItemDelete, } from \"gui/Components/TagInput/TagInput\";\r\nimport { inject, observer } from \"mobx-react\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { CtxDropdownEditor } from \"modules/Editors/DropdownEditor/DropdownEditor\";\r\nimport { CtxDropdownRefCtrl } from \"@origam/components\";\r\n\r\nexport const TagInputEditor = inject(({property}: { property: IProperty }, {value}) => {\r\n  const dataTable = getDataTable(property);\r\n  return {\r\n    textualValues: value?.map((valueItem: any) => dataTable.resolveCellText(property, valueItem)),\r\n  };\r\n})(\r\n  observer(\r\n    (props: {\r\n      value: string[];\r\n      textualValues?: string[];\r\n      isReadOnly: boolean;\r\n      backgroundColor?: string;\r\n      foregroundColor?: string;\r\n      customStyle?: any;\r\n      onChange?(event: any, value: string[]): void;\r\n      onKeyDown?(event: any): void;\r\n      onClick?(event: any): void;\r\n      onDoubleClick?(event: any): void;\r\n      onEditorBlur?(event: any): void;\r\n      customInputClass?: string;\r\n      autoFocus?: boolean;\r\n      id?: string;\r\n    }) => {\r\n      const beh = useContext(CtxDropdownEditor).behavior;\r\n      const ref = useContext(CtxDropdownRefCtrl);\r\n      const data = useContext(CtxDropdownEditor).editorData;\r\n\r\n      const value = Array.isArray(props.value) ? [...props.value] : props.value;\r\n      data.setValue(value);\r\n\r\n      function getStyle() {\r\n        if (props.customStyle) {\r\n          return props.customStyle;\r\n        } else {\r\n          return {\r\n            color: props.foregroundColor,\r\n            backgroundColor: props.backgroundColor,\r\n          };\r\n        }\r\n      }\r\n\r\n      function removeItem(event: any, item: string) {\r\n        if (props.isReadOnly) {\r\n          return;\r\n        }\r\n        const index = value.indexOf(item);\r\n        if (index > -1) {\r\n          const removedItem = value.splice(index, 1)[0];\r\n          if (props.onChange) {\r\n            props.onChange(event, value);\r\n          }\r\n          if (props.onEditorBlur) {\r\n            props.onEditorBlur(event);\r\n          }\r\n          data.remove(removedItem);\r\n        }\r\n      }\r\n\r\n      const [inputElement, setInputElement] = useState<any | undefined>(undefined);\r\n\r\n      const refInput = useMemo(() => {\r\n        return (elm: any) => {\r\n          beh.refInputElement(elm);\r\n          setInputElement(elm);\r\n        };\r\n      }, [beh]);\r\n\r\n      useEffect(() => {\r\n        if (beh.subscribeToFocusManager && beh.elmInputElement) {\r\n          beh.subscribeToFocusManager(beh.elmInputElement);\r\n        }\r\n        if (props.autoFocus) {\r\n          setTimeout(() => inputElement?.focus());\r\n        }\r\n      }, [beh, inputElement, props.autoFocus]);\r\n\r\n      const previousValueRef = useRef<string[]>();\r\n\r\n      useEffect(() => {\r\n        if (previousValueRef.current?.length !== value?.length) {\r\n          beh.elmInputElement.value = \"\";\r\n        }\r\n        previousValueRef.current = value;\r\n      }, [ // eslint-disable-line react-hooks/exhaustive-deps\r\n        previousValueRef.current,\r\n        previousValueRef.current?.length, // eslint-disable-line react-hooks/exhaustive-deps\r\n        value,\r\n        value?.length, // eslint-disable-line react-hooks/exhaustive-deps\r\n        beh.elmInputElement?.value, // eslint-disable-line react-hooks/exhaustive-deps\r\n      ]);\r\n\r\n      function handleInputKeyDown(event: any) {\r\n        if (event.key === \"Backspace\" && event.target.value === \"\" && value.length > 0) {\r\n          removeItem(event, value[value.length - 1]);\r\n        }\r\n        beh.handleInputKeyDown(event);\r\n        props.onKeyDown?.(event);\r\n      }\r\n\r\n      return (\r\n        <div className={CS.editorContainer} ref={ref}>\r\n          <TagInput className={\"tagInput\"}>\r\n            {value\r\n              ? value.map((valueItem, idx) => (\r\n                <TagInputItem key={valueItem}>\r\n                  <TagInputItemDelete\r\n                    onClick={(event) => {\r\n                      removeItem(event, valueItem);\r\n                    }}\r\n                  />\r\n                  {props.textualValues![idx] || \"\"}\r\n                </TagInputItem>\r\n              ))\r\n              : null}\r\n            {props.isReadOnly ? null : (\r\n              <TagInputAdd onClick={(event) => {\r\n                beh.handleInputBtnClick(event);\r\n                beh.elmInputElement.focus();\r\n              }}/>\r\n            )}\r\n            <input\r\n              id={props.id}\r\n              disabled={props.isReadOnly}\r\n              className={S.filterInput + \" \" + props.customInputClass}\r\n              ref={refInput}\r\n              placeholder={data.isResolving ? \"Loading...\" : \"\"}\r\n              onChange={beh.handleInputChange}\r\n              onKeyDown={handleInputKeyDown}\r\n              onFocus={beh.handleInputFocus}\r\n              onBlur={beh.handleInputBlur}\r\n              onDoubleClick={props.onDoubleClick}\r\n              autoComplete={\"off\"}\r\n              style={getStyle()}\r\n              size={1}\r\n            />\r\n          </TagInput>\r\n        </div>\r\n      );\r\n    }\r\n  )\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n\r\nimport { ILookup } from \"model/entities/types/ILookup\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { CancellablePromise } from \"mobx/lib/api/flow\";\r\nimport React, { useContext, useState } from \"react\";\r\nimport { MobXProviderContext } from \"mobx-react\";\r\nimport {\r\n  CtxDropdownEditor,\r\n  DropdownEditor,\r\n  IDropdownEditorContext\r\n} from \"modules/Editors/DropdownEditor/DropdownEditor\";\r\nimport { IDropdownEditorApi } from \"modules/Editors/DropdownEditor/DropdownEditorApi\";\r\nimport { IDropdownEditorData } from \"modules/Editors/DropdownEditor/DropdownEditorData\";\r\nimport { DropdownColumnDrivers, DropdownDataTable } from \"modules/Editors/DropdownEditor/DropdownTableModel\";\r\nimport { DropdownEditorLookupListCache } from \"modules/Editors/DropdownEditor/DropdownEditorLookupListCache\";\r\nimport { DropdownEditorBehavior } from \"modules/Editors/DropdownEditor/DropdownEditorBehavior\";\r\nimport { DefaultHeaderCellDriver } from \"modules/Editors/DropdownEditor/Cells/HeaderCell\";\r\nimport { TextCellDriver } from \"modules/Editors/DropdownEditor/Cells/TextCellDriver\";\r\nimport { getGroupingConfiguration } from \"model/selectors/TablePanelView/getGroupingConfiguration\";\r\nimport { DropdownEditorSetup } from \"modules/Editors/DropdownEditor/DropdownEditorSetup\";\r\nimport { TagInputEditor } from \"gui/Components/ScreenElements/Editors/TagInputEditor\";\r\nimport S from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/FilterSettingsLookup.module.scss\";\r\nimport { action, computed, observable } from \"mobx\";\r\n\r\nexport function TagLookupFilterEditor(props: {\r\n  lookup: ILookup;\r\n  property: IProperty;\r\n  getOptions: (searchTerm: string) => CancellablePromise<Array<any>>;\r\n  onChange(selectedItems: Array<any>): void;\r\n  values: Array<any>;\r\n  autoFocus: boolean;\r\n  id?: string;\r\n}) {\r\n  const mobxContext = useContext(MobXProviderContext);\r\n\r\n\r\n  const workbench = mobxContext.workbench;\r\n  const {lookupListCache} = workbench;\r\n\r\n  const [dropdownEditorInfrastructure] = useState<IDropdownEditorContext>(() => {\r\n    const dropdownEditorApi: IDropdownEditorApi = new FilterDropDownApi(props.getOptions);\r\n    const dropdownEditorData: IDropdownEditorData = new FilterEditorData(props.onChange);\r\n\r\n    const dropdownEditorDataTable = new DropdownDataTable(\r\n      () => dropdownEditorSetup,\r\n      dropdownEditorData\r\n    );\r\n    const dropdownEditorLookupListCache = new DropdownEditorLookupListCache(\r\n      () => dropdownEditorSetup,\r\n      lookupListCache\r\n    );\r\n    const dropdownEditorBehavior = new DropdownEditorBehavior(\r\n      {\r\n        api: dropdownEditorApi,\r\n        data: dropdownEditorData,\r\n        dataTable: dropdownEditorDataTable,\r\n        setup: () => dropdownEditorSetup,\r\n        cache: dropdownEditorLookupListCache,\r\n        isReadOnly: false,\r\n      }\r\n    );\r\n\r\n    const drivers = new DropdownColumnDrivers();\r\n\r\n    let identifierIndex = 0;\r\n    const columnNameToIndex = new Map<string, number>([\r\n      [props.property.identifier!, identifierIndex],\r\n    ]);\r\n    const visibleColumnNames: string[] = [];\r\n\r\n    columnNameToIndex.set(props.property.name, 1);\r\n    visibleColumnNames.push(props.property.name);\r\n\r\n    drivers.allDrivers.push({\r\n      columnId: props.property.id,\r\n      headerCellDriver: new DefaultHeaderCellDriver(props.property.name),\r\n      bodyCellDriver: new TextCellDriver(1, dropdownEditorDataTable, dropdownEditorBehavior),\r\n    });\r\n\r\n    const showUniqueValues = true;\r\n\r\n    const cached = getGroupingConfiguration(props.property).isGrouping\r\n      ? false\r\n      : props.property.lookup?.cached!\r\n\r\n    const dropdownEditorSetup = new DropdownEditorSetup(\r\n      props.property.id,\r\n      props.lookup.lookupId,\r\n      [],\r\n      visibleColumnNames,\r\n      columnNameToIndex,\r\n      showUniqueValues,\r\n      props.property.identifier!,\r\n      identifierIndex,\r\n      props.property.parameters,\r\n      props.property.lookup?.dropDownType!,\r\n      cached,\r\n      !props.property.lookup?.searchByFirstColumnOnly,\r\n      drivers\r\n    );\r\n\r\n    return {\r\n      behavior: dropdownEditorBehavior,\r\n      editorData: dropdownEditorData,\r\n      editorDataTable: dropdownEditorDataTable,\r\n      setup: dropdownEditorSetup\r\n    };\r\n  });\r\n\r\n  function onItemRemoved(event: any, value: string[]) {\r\n    props.onChange(value);\r\n  }\r\n\r\n  const value = props.values;\r\n  return (\r\n    <CtxDropdownEditor.Provider value={dropdownEditorInfrastructure}>\r\n      <DropdownEditor\r\n        editor={\r\n          <TagInputEditor\r\n            id={props.id}\r\n            customInputClass={S.tagInput}\r\n            value={value}\r\n            isReadOnly={false}\r\n            onChange={onItemRemoved}\r\n            onClick={undefined}\r\n            autoFocus={props.autoFocus}\r\n          />\r\n        }\r\n      />\r\n    </CtxDropdownEditor.Provider>\r\n  );\r\n}\r\n\r\n\r\nexport class FilterDropDownApi implements IDropdownEditorApi {\r\n  constructor(private getOptions: (searchTerm: string) => CancellablePromise<Array<any>>) {\r\n  }\r\n\r\n  *getLookupList(searchTerm: string): Generator {\r\n    return yield this.getOptions(searchTerm);\r\n  }\r\n}\r\n\r\n\r\nexport class FilterEditorData implements IDropdownEditorData {\r\n  constructor(private onChange: (selectedItems: Array<any>) => void) {\r\n  }\r\n\r\n  setValue(value: string | string[] | null) {\r\n    if (value) {\r\n      this._value = Array.isArray(value) ? value : [value];\r\n    }\r\n  }\r\n\r\n  @computed get value(): string | string[] | null {\r\n    return this._value;\r\n  }\r\n\r\n  @observable\r\n  _value: any[] = [];\r\n\r\n  @computed get text(): string {\r\n    return \"\";\r\n  }\r\n\r\n  get isResolving() {\r\n    return false;\r\n  }\r\n\r\n  @action.bound chooseNewValue(value: any) {\r\n    if (value !== null && !this._value.includes(value)) {\r\n      this._value = [...this._value, value];\r\n      this.onChange(this._value);\r\n    }\r\n  }\r\n\r\n  get idsInEditor() {\r\n    return this._value as string[];\r\n  }\r\n\r\n  remove(valueToRemove: any): void {\r\n    const index = this._value.indexOf(valueToRemove)\r\n    if (index > -1) {\r\n      this._value.splice(index, 1);\r\n    }\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n\r\nimport CS from \"gui/Components/ScreenElements/Editors/CommonStyle.module.css\";\r\nimport S from \"gui/Components/ScreenElements/Editors/TagInputEditor.module.css\";\r\n\r\nimport { TagInput, TagInputAdd, TagInputItem, TagInputItemDelete, } from \"gui/Components/TagInput/TagInput\";\r\nimport { observer } from \"mobx-react\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\nimport React from \"react\";\r\n\r\nexport const MobileTagInputEditor = (\r\n  observer(\r\n    (props: {\r\n      isReadOnly: boolean;\r\n      backgroundColor?: string;\r\n      foregroundColor?: string;\r\n      customStyle?: any;\r\n      customInputClass?: string;\r\n      id?: string;\r\n      property: IProperty;\r\n      onPlusButtonClick: ()=> void;\r\n      onChange?: (event: any, newValue: string[])=> void;\r\n      values?: any[];\r\n    }) => {\r\n      const dataTable = getDataTable(props.property);\r\n\r\n      const values = props.values ?? getTagInputValues(props.property);\r\n      const textValues = values.map((valueItem: any) => dataTable.resolveCellText(props.property, valueItem));\r\n\r\n      function getStyle() {\r\n        if (props.customStyle) {\r\n          return props.customStyle;\r\n        } else {\r\n          return {\r\n            color: props.foregroundColor,\r\n            backgroundColor: props.backgroundColor,\r\n          };\r\n        }\r\n      }\r\n\r\n      function removeItem(event: any, item: string) {\r\n        if (props.isReadOnly) {\r\n          return;\r\n        }\r\n        const index = values.indexOf(item);\r\n        if (index > -1) {\r\n          values.remove(item);\r\n          props.onChange?.(event, values);\r\n        }\r\n      }\r\n\r\n      function onPlusButtonClick(){\r\n        if(props.isReadOnly){\r\n          return;\r\n        }\r\n        props.onPlusButtonClick();\r\n      }\r\n\r\n      return (\r\n        <div className={CS.editorContainer + \" tagEditorContainer\"}>\r\n          <TagInput className={S.tagInput}>\r\n            {values.map((valueItem, idx) => (\r\n                <TagInputItem key={valueItem}>\r\n                  <TagInputItemDelete\r\n                    onClick={(event) => {\r\n                      removeItem(event, valueItem);\r\n                    }}\r\n                  />\r\n                  {textValues![idx] || \"\"}\r\n                </TagInputItem>\r\n              ))}\r\n            {props.isReadOnly ? null : (\r\n              <TagInputAdd onClick={onPlusButtonClick}/>\r\n            )}\r\n            <input\r\n              id={props.id}\r\n              disabled={props.isReadOnly}\r\n              className={S.filterInput + \" \" + props.customInputClass}\r\n              autoComplete={\"off\"}\r\n              style={getStyle()}\r\n              size={1}\r\n            />\r\n          </TagInput>\r\n        </div>\r\n      );\r\n    }\r\n  )\r\n);\r\n\r\nexport function getTagInputValues(property: IProperty): any[]{\r\n  const dataTable = getDataTable(property);\r\n  const row = getSelectedRow(property);\r\n  if(!row){\r\n    return [];\r\n  }\r\n\r\n  const cellValue = dataTable.getCellValue(row, property);\r\n  return (Array.isArray(cellValue) ? [...cellValue] : cellValue) as any[];\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useContext, useState } from \"react\";\r\nimport { ILookup } from \"model/entities/types/ILookup\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { CancellablePromise } from \"mobx/lib/api/flow\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { IMobileDropdownContext } from \"gui/connections/MobileComponents/Form/ComboBox/ComboBox\";\r\nimport { IDropdownEditorApi } from \"modules/Editors/DropdownEditor/DropdownEditorApi\";\r\nimport { IDropdownEditorData } from \"modules/Editors/DropdownEditor/DropdownEditorData\";\r\nimport { DropdownColumnDrivers, DropdownDataTable } from \"modules/Editors/DropdownEditor/DropdownTableModel\";\r\nimport { DropdownEditorLookupListCache } from \"modules/Editors/DropdownEditor/DropdownEditorLookupListCache\";\r\nimport { MobileDropdownBehavior } from \"gui/connections/MobileComponents/Form/ComboBox/MobileDropdownBehavior\";\r\nimport { DefaultHeaderCellDriver } from \"modules/Editors/DropdownEditor/Cells/HeaderCell\";\r\nimport { TextCellDriver } from \"modules/Editors/DropdownEditor/Cells/TextCellDriver\";\r\nimport { getGroupingConfiguration } from \"model/selectors/TablePanelView/getGroupingConfiguration\";\r\nimport { DropdownEditorSetup } from \"modules/Editors/DropdownEditor/DropdownEditorSetup\";\r\nimport { ComboFullScreenEditor } from \"gui/connections/MobileComponents/Form/ComboBox/ComboFullScreenEditor\";\r\nimport {\r\n  FilterDropDownApi,\r\n  FilterEditorData\r\n} from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/TagLookupFilterEditor\";\r\nimport { MobileTagInputEditor } from \"gui/connections/MobileComponents/Form/ComboBox/MobileTagInputEditor\";\r\nimport { getMobileState } from \"model/selectors/getMobileState\";\r\nimport { EditLayoutState } from \"model/entities/MobileState/MobileLayoutState\";\r\nimport { IFilterSetting } from \"model/entities/types/IFilterSetting\";\r\n\r\nexport const MobileTagLookupFilterEditor: React.FC<{\r\n  lookup: ILookup;\r\n  property: IProperty;\r\n  getOptions: (searchTerm: string) => CancellablePromise<Array<any>>;\r\n  onChange(selectedItems: Array<any>): void;\r\n  values: Array<any>;\r\n  autoFocus: boolean;\r\n  setting: IFilterSetting;\r\n  id?: string;\r\n}> = observer((props) => {\r\n  return (\r\n    <MobileTagInputEditor\r\n      key={props.id}\r\n      isReadOnly={false}\r\n      property={props.property}\r\n      values={props.setting.val1 ?? []}\r\n      onChange={(event, newValue) => props.onChange(newValue)}\r\n      onPlusButtonClick={() => {\r\n        let mobileState = getMobileState(props.property);\r\n        let layoutBeforeEditing = mobileState.layoutState;\r\n        mobileState.layoutState = new EditLayoutState(\r\n          <FullScreenFilterLookupTagEditor\r\n            id={props.id}\r\n            lookup={props.lookup}\r\n            property={props.property}\r\n            getOptions={props.getOptions}\r\n            onChange={(selectedItems) => {\r\n              props.onChange(selectedItems);\r\n              mobileState.layoutState = layoutBeforeEditing;\r\n            }}\r\n            values={props.setting.val1 ?? []}\r\n            autoFocus={props.autoFocus}\r\n          />,\r\n          props.property.name,\r\n          layoutBeforeEditing\r\n        )\r\n      }}\r\n    />);\r\n});\r\n\r\n\r\nfunction FullScreenFilterLookupTagEditor(props: {\r\n  lookup: ILookup;\r\n  property: IProperty;\r\n  getOptions: (searchTerm: string) => CancellablePromise<Array<any>>;\r\n  onChange(selectedItems: Array<any>): void;\r\n  values: Array<any>;\r\n  autoFocus: boolean;\r\n  id?: string;\r\n}) {\r\n  const mobxContext = useContext(MobXProviderContext);\r\n\r\n\r\n  const workbench = mobxContext.workbench;\r\n  const {lookupListCache} = workbench;\r\n\r\n  const [dropdownEditorInfrastructure] = useState<IMobileDropdownContext>(() => {\r\n    const dropdownEditorApi: IDropdownEditorApi = new FilterDropDownApi(props.getOptions);\r\n    const dropdownEditorData: IDropdownEditorData = new FilterEditorData(props.onChange);\r\n    dropdownEditorData.setValue(props.values);\r\n\r\n    const dropdownEditorDataTable = new DropdownDataTable(\r\n      () => dropdownEditorSetup,\r\n      dropdownEditorData\r\n    );\r\n    const dropdownEditorLookupListCache = new DropdownEditorLookupListCache(\r\n      () => dropdownEditorSetup,\r\n      lookupListCache\r\n    );\r\n\r\n    const dropdownEditorBehavior = new MobileDropdownBehavior({\r\n      api: dropdownEditorApi,\r\n      data: dropdownEditorData,\r\n      dataTable: dropdownEditorDataTable,\r\n      setup: () => dropdownEditorSetup,\r\n      cache: dropdownEditorLookupListCache,\r\n    });\r\n\r\n    const drivers = new DropdownColumnDrivers();\r\n\r\n    let identifierIndex = 0;\r\n    const columnNameToIndex = new Map<string, number>([\r\n      [props.property.identifier!, identifierIndex],\r\n    ]);\r\n    const visibleColumnNames: string[] = [];\r\n\r\n    columnNameToIndex.set(props.property.name, 1);\r\n    visibleColumnNames.push(props.property.name);\r\n\r\n    drivers.allDrivers.push({\r\n      columnId: props.property.id,\r\n      headerCellDriver: new DefaultHeaderCellDriver(props.property.name),\r\n      bodyCellDriver: new TextCellDriver(1, dropdownEditorDataTable, dropdownEditorBehavior),\r\n    });\r\n\r\n    const showUniqueValues = true;\r\n\r\n    const cached = getGroupingConfiguration(props.property).isGrouping\r\n      ? false\r\n      : props.property.lookup?.cached!\r\n\r\n    const dropdownEditorSetup = new DropdownEditorSetup(\r\n      props.property.id,\r\n      props.lookup.lookupId,\r\n      [],\r\n      visibleColumnNames,\r\n      columnNameToIndex,\r\n      showUniqueValues,\r\n      props.property.identifier!,\r\n      identifierIndex,\r\n      props.property.parameters,\r\n      props.property.lookup?.dropDownType!,\r\n      cached,\r\n      !props.property.lookup?.searchByFirstColumnOnly,\r\n      drivers\r\n    );\r\n\r\n    return {\r\n      behavior: dropdownEditorBehavior,\r\n      editorData: dropdownEditorData,\r\n      editorDataTable: dropdownEditorDataTable,\r\n      setup: dropdownEditorSetup\r\n    };\r\n  });\r\n\r\n  return (\r\n    <ComboFullScreenEditor\r\n      {...props}\r\n      behavior={dropdownEditorInfrastructure.behavior}\r\n      dataTable={dropdownEditorInfrastructure.editorDataTable}\r\n      columnDrivers={dropdownEditorInfrastructure.setup.columnDrivers}\r\n      editorData={dropdownEditorInfrastructure.editorData}\r\n    />\r\n  );\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action, observable, runInAction } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport { CancellablePromise } from \"mobx/lib/api/flow\";\r\nimport React from \"react\";\r\nimport {\r\n  FilterSettingsComboBox,\r\n  FilterSettingsComboBoxItem,\r\n} from \"gui/Components/ScreenElements/Table/FilterSettings/FilterSettingsComboBox\";\r\nimport CS from \"./FilterSettingsCommon.module.scss\";\r\nimport { IFilterSetting } from \"model/entities/types/IFilterSetting\";\r\nimport { ILookup } from \"model/entities/types/ILookup\";\r\nimport { Operator } from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/Operator\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { MobileTagLookupFilterEditor } from \"gui/connections/MobileComponents/Grid/MobileTagLookupFilterEditor\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\nimport {\r\n  TagLookupFilterEditor\r\n} from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/TagLookupFilterEditor\";\r\n\r\nconst OPERATORS = [\r\n  Operator.in,\r\n  Operator.notIn,\r\n  Operator.startsWith,\r\n  Operator.notStartsWith,\r\n  Operator.contains,\r\n  Operator.notContains,\r\n  Operator.isNull,\r\n  Operator.isNotNull\r\n];\r\n\r\nconst LOOKUP_TYPE_OPERATORS = [\r\n  Operator.startsWith,\r\n  Operator.notStartsWith,\r\n  Operator.contains,\r\n  Operator.notContains\r\n];\r\n\r\nfunction operatorGroupChanges(oldOperator: string, newOperator: string) {\r\n  let lookupOperatorTypes = LOOKUP_TYPE_OPERATORS.map(operator => operator.type);\r\n  return newOperator === \"null\" || newOperator === \"nnull\" ||\r\n    lookupOperatorTypes.includes(newOperator) && !lookupOperatorTypes.includes(oldOperator);\r\n}\r\n\r\nconst OpCombo: React.FC<{\r\n  setting: any;\r\n  enableLookupTypeFilters: boolean\r\n  id: string;\r\n}> = observer((props) => {\r\n  return (\r\n    <FilterSettingsComboBox\r\n      id={props.id}\r\n      trigger={<>{(OPERATORS.find((op) => op.type === props.setting.type) || {}).caption}</>}\r\n    >\r\n      {OPERATORS\r\n        .filter(operator => props.enableLookupTypeFilters || !LOOKUP_TYPE_OPERATORS.includes(operator))\r\n        .map((op) => (\r\n          <FilterSettingsComboBoxItem\r\n            key={op.type}\r\n            onClick={() => {\r\n              runInAction(() => {\r\n                if (operatorGroupChanges(props.setting.type, op.type)) {\r\n                  props.setting.val1 = undefined;\r\n                  props.setting.val2 = undefined;\r\n                }\r\n                props.setting.type = op.type;\r\n                props.setting.isComplete = op.type === \"null\" || op.type === \"nnull\" ||\r\n                  props.setting.val1 !== undefined || props.setting.val2 !== undefined;\r\n              });\r\n            }}\r\n          >\r\n            {op.caption}\r\n          </FilterSettingsComboBoxItem>\r\n        ))}\r\n    </FilterSettingsComboBox>\r\n  );\r\n});\r\n\r\nexport interface ITagEditorItem {\r\n  text: string;\r\n  value: string;\r\n}\r\n\r\n@observer\r\nclass OpEditors extends React.Component<{\r\n  setting: IFilterSetting;\r\n  getOptions: (searchTerm: string) => CancellablePromise<Array<any>>;\r\n  lookup: ILookup;\r\n  property: IProperty;\r\n  autoFocus: boolean;\r\n  id: string;\r\n}> {\r\n\r\n  @action.bound handleSelectedItemsChange(items: Array<any>) {\r\n    this.props.setting.val1 = [...items];\r\n    this.props.setting.val2 = undefined;\r\n    this.props.setting.isComplete = this.props.setting.val1 !== undefined && this.props.setting.val1.length > 0;\r\n  }\r\n\r\n  @action.bound handleTermChange(event: any) {\r\n    this.props.setting.val1 = undefined;\r\n    this.props.setting.val2 = event.target.value;\r\n    this.props.setting.isComplete = !!this.props.setting.val2;\r\n  }\r\n\r\n  render() {\r\n    const {setting} = this.props;\r\n    switch (setting?.type) {\r\n      case \"in\":\r\n      case \"nin\":\r\n        if (isMobileLayoutActive(this.props.property)) {\r\n          return (\r\n            <MobileTagLookupFilterEditor\r\n              id={this.props.id}\r\n              lookup={this.props.lookup}\r\n              property={this.props.property}\r\n              getOptions={this.props.getOptions}\r\n              onChange={this.handleSelectedItemsChange}\r\n              values={this.props.setting.val1 ?? []}\r\n              autoFocus={this.props.autoFocus}\r\n              setting={this.props.setting}\r\n            />\r\n          );\r\n        } else {\r\n          return (\r\n            <TagLookupFilterEditor\r\n              id={this.props.id}\r\n              lookup={this.props.lookup}\r\n              property={this.props.property}\r\n              getOptions={this.props.getOptions}\r\n              onChange={this.handleSelectedItemsChange}\r\n              values={this.props.setting.val1 ?? []}\r\n              autoFocus={this.props.autoFocus}\r\n            />\r\n          );\r\n        }\r\n      case \"starts\":\r\n      case \"nstarts\":\r\n      case \"contains\":\r\n      case \"ncontains\":\r\n        return (\r\n          <input\r\n            id={this.props.id}\r\n            value={this.props.setting.val2 ?? \"\"}\r\n            className={CS.input}\r\n            onChange={this.handleTermChange}\r\n          />\r\n        );\r\n      case \"null\":\r\n      case \"nnull\":\r\n      default:\r\n        return null;\r\n    }\r\n  }\r\n}\r\n\r\n@observer\r\nexport class FilterSettingsLookup extends React.Component<{\r\n  getOptions: (searchTerm: string) => CancellablePromise<Array<any>>;\r\n  lookup: ILookup;\r\n  property: IProperty;\r\n  setting: IFilterSetting;\r\n  autoFocus: boolean;\r\n  id: string;\r\n}> {\r\n  static get defaultSettings() {\r\n    return new LookupFilterSetting(OPERATORS[0].type)\r\n  }\r\n\r\n  render() {\r\n    const setting = this.props.setting;\r\n    return (\r\n      <>\r\n        <OpCombo\r\n          id={\"combo_\" + this.props.id}\r\n          setting={setting}\r\n          enableLookupTypeFilters={this.props.property.supportsServerSideSorting}/>\r\n        <OpEditors\r\n          id={\"input_\" + this.props.id}\r\n          setting={setting}\r\n          getOptions={this.props.getOptions}\r\n          lookup={this.props.lookup}\r\n          property={this.props.property}\r\n          autoFocus={this.props.autoFocus}\r\n        />\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport class LookupFilterSetting implements IFilterSetting {\r\n  @observable type: string;\r\n  @observable val1?: any; // used for \"in\" operator ... string[]\r\n  @observable val2?: any; // used for \"contains\" operator ... string\r\n  isComplete: boolean;\r\n\r\n  private _lookupId: string | undefined;\r\n\r\n  public get lookupId(): string | undefined {\r\n    if (LOOKUP_TYPE_OPERATORS.map(operator => operator.type).includes(this.type)) {\r\n      return this._lookupId;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  public set lookupId(value: string | undefined) {\r\n    this._lookupId = value;\r\n  }\r\n\r\n  get filterValue1() {\r\n    if (!this.val1) {\r\n      return this.val1;\r\n    }\r\n    switch (this.type) {\r\n      case \"contain\":\r\n      case \"ncontain\":\r\n        return this.val2;\r\n      case \"in\":\r\n      case \"nin\":\r\n        return this.val1;\r\n      default:\r\n        return undefined;\r\n    }\r\n  }\r\n\r\n  get filterValue2() {\r\n    return this.val2;\r\n  }\r\n\r\n\r\n  get val1ServerForm() {\r\n    return this.val1 ? this.val1.join(\",\") : this.val1;\r\n  }\r\n\r\n  get val2ServerForm() {\r\n    return this.val2;\r\n  }\r\n\r\n  constructor(type: string, isComplete = false, val1?: string, val2?: any) {\r\n    this.type = type;\r\n    this.isComplete = isComplete;\r\n    if (Array.isArray(val1)) {\r\n      this.val1 = [...new Set(val1)];\r\n    } else if (val1 !== undefined && val1 !== null) {\r\n      this.val1 = [...new Set(val1.split(\",\"))];\r\n    }\r\n    this.val2 = val2 ?? undefined;\r\n  }\r\n}\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IProperty } from \"./types/IProperty\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { getMenuItemId } from \"model/selectors/getMenuItemId\";\r\nimport { getSessionId } from \"model/selectors/getSessionId\";\r\nimport { getDataStructureEntityId } from \"model/selectors/DataView/getDataStructureEntityId\";\r\nimport { getUserFilters } from \"model/selectors/DataView/getUserFilters\";\r\nimport { getUserFilterLookups } from \"model/selectors/DataView/getUserFilterLookups\";\r\n\r\nexport function*getAllLookupIds(property: IProperty): Generator {\r\n  const dataView = getDataView(property);\r\n  if (dataView.isLazyLoading) {\r\n    return yield getAllValuesOfProp(property);\r\n  } else {\r\n    const dataTable = getDataTable(property);\r\n    return yield dataTable.getAllValuesOfProp(property);\r\n  }\r\n}\r\n\r\nasync function getAllValuesOfProp(property: IProperty): Promise<Set<any>> {\r\n  const api = getApi(property);\r\n  const listValues = await api.getFilterListValues({\r\n    MenuId: getMenuItemId(property),\r\n    SessionFormIdentifier: getSessionId(property),\r\n    DataStructureEntityId: getDataStructureEntityId(property),\r\n    Property: property.id,\r\n    Filter: property.column === \"TagInput\"\r\n      ? \"\"\r\n      : getUserFilters({ctx: property, excludePropertyId: property.id}),\r\n    FilterLookups: getUserFilterLookups(property),\r\n  });\r\n  return new Set(\r\n    listValues\r\n      .map(listValue => listValue)\r\n      .filter(listValue => listValue)\r\n  );\r\n}\r\n","import { ILookup } from \"model/entities/types/ILookup\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { CancellablePromise } from \"mobx/lib/api/flow\";\r\nimport { IFilterSetting } from \"model/entities/types/IFilterSetting\";\r\nimport React, { useContext, useState } from \"react\";\r\nimport { MobXProviderContext } from \"mobx-react\";\r\nimport {\r\n  CtxDropdownEditor,\r\n  DropdownEditor,\r\n  IDropdownEditorContext\r\n} from \"modules/Editors/DropdownEditor/DropdownEditor\";\r\nimport { IDropdownEditorApi } from \"modules/Editors/DropdownEditor/DropdownEditorApi\";\r\nimport { IDropdownEditorData } from \"modules/Editors/DropdownEditor/DropdownEditorData\";\r\nimport { DropdownColumnDrivers, DropdownDataTable } from \"modules/Editors/DropdownEditor/DropdownTableModel\";\r\nimport { DropdownEditorLookupListCache } from \"modules/Editors/DropdownEditor/DropdownEditorLookupListCache\";\r\nimport { DropdownEditorBehavior } from \"modules/Editors/DropdownEditor/DropdownEditorBehavior\";\r\nimport { prepareForFilter } from \"model/selectors/PortalSettings/getStringFilterConfig\";\r\nimport { DefaultHeaderCellDriver } from \"modules/Editors/DropdownEditor/Cells/HeaderCell\";\r\nimport { TextCellDriver } from \"modules/Editors/DropdownEditor/Cells/TextCellDriver\";\r\nimport { DropdownEditorSetup } from \"modules/Editors/DropdownEditor/DropdownEditorSetup\";\r\nimport { TagInputEditor } from \"gui/Components/ScreenElements/Editors/TagInputEditor\";\r\nimport S from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/FilterSettingsLookup.module.scss\";\r\nimport { action, computed } from \"mobx\";\r\nimport {\r\n  FilterDropDownApi\r\n} from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/TagLookupFilterEditor\";\r\n\r\nexport function TagFilterEditor(props: {\r\n  lookup: ILookup;\r\n  property: IProperty;\r\n  getOptions: (searchTerm: string) => CancellablePromise<Array<any>>;\r\n  values: Array<any>;\r\n  setting: IFilterSetting;\r\n  autoFocus: boolean;\r\n  id: string;\r\n}) {\r\n  const mobxContext = useContext(MobXProviderContext);\r\n  const workbench = mobxContext.workbench;\r\n  const {lookupListCache} = workbench;\r\n\r\n  const [dropdownEditorInfrastructure] = useState<IDropdownEditorContext>(() => {\r\n    const dropdownEditorApi: IDropdownEditorApi = new FilterDropDownApi(props.getOptions);\r\n    const dropdownEditorData: IDropdownEditorData = new FilterEditorData(props.setting);\r\n\r\n    const dropdownEditorDataTable = new DropdownDataTable(\r\n      () => dropdownEditorSetup,\r\n      dropdownEditorData\r\n    );\r\n    const dropdownEditorLookupListCache = new DropdownEditorLookupListCache(\r\n      () => dropdownEditorSetup,\r\n      lookupListCache\r\n    );\r\n    const dropdownEditorBehavior = new DropdownEditorBehavior(\r\n      {\r\n        api: dropdownEditorApi,\r\n        data: dropdownEditorData,\r\n        dataTable: dropdownEditorDataTable,\r\n        setup: () => dropdownEditorSetup,\r\n        cache: dropdownEditorLookupListCache,\r\n        isReadOnly: false,\r\n        onDoubleClick: text => prepareForFilter(props.property, text)!,\r\n      }\r\n    );\r\n\r\n    const drivers = new DropdownColumnDrivers();\r\n\r\n    let identifierIndex = 0;\r\n    const columnNameToIndex = new Map<string, number>([\r\n      [props.property.identifier!, identifierIndex],\r\n    ]);\r\n    const visibleColumnNames: string[] = [];\r\n\r\n    columnNameToIndex.set(props.property.name, 1);\r\n    visibleColumnNames.push(props.property.name);\r\n\r\n    drivers.allDrivers.push({\r\n      columnId: props.property.id,\r\n      headerCellDriver: new DefaultHeaderCellDriver(props.property.name),\r\n      bodyCellDriver: new TextCellDriver(1, dropdownEditorDataTable, dropdownEditorBehavior),\r\n    });\r\n\r\n    const showUniqueValues = true;\r\n\r\n    const dropdownEditorSetup = new DropdownEditorSetup(\r\n      props.property.id,\r\n      props.lookup.lookupId,\r\n      [],\r\n      visibleColumnNames,\r\n      columnNameToIndex,\r\n      showUniqueValues,\r\n      props.property.identifier!,\r\n      identifierIndex,\r\n      props.property.parameters,\r\n      props.property.lookup?.dropDownType!,\r\n      props.property.lookup?.cached!,\r\n      !props.property.lookup?.searchByFirstColumnOnly,\r\n      drivers\r\n    );\r\n\r\n    return {\r\n      behavior: dropdownEditorBehavior,\r\n      editorData: dropdownEditorData,\r\n      editorDataTable: dropdownEditorDataTable,\r\n      setup: dropdownEditorSetup\r\n    };\r\n  });\r\n\r\n  (dropdownEditorInfrastructure.editorData as FilterEditorData).setting = props.setting;\r\n\r\n  const value = props.values;\r\n  return (\r\n    <CtxDropdownEditor.Provider value={dropdownEditorInfrastructure}>\r\n      <DropdownEditor\r\n        editor={\r\n          <TagInputEditor\r\n            id={props.id}\r\n            customInputClass={S.tagInput}\r\n            value={value}\r\n            isReadOnly={false}\r\n            autoFocus={props.autoFocus}\r\n            onClick={undefined}\r\n          />\r\n        }\r\n      />\r\n    </CtxDropdownEditor.Provider>\r\n  );\r\n}\r\n\r\n\r\nexport class FilterEditorData implements IDropdownEditorData {\r\n  constructor(\r\n    public setting: IFilterSetting,\r\n    private onChange?: ()=>void\r\n  ) {\r\n  }\r\n\r\n  setValue(value: string[]) {\r\n  }\r\n\r\n  @computed get value(): string | string[] | null {\r\n    return this.setting.val1;\r\n  }\r\n\r\n  @computed get text(): string {\r\n    return \"\";\r\n  }\r\n\r\n  get isResolving() {\r\n    return false;\r\n  }\r\n\r\n  private onValueChanged() {\r\n    this.setting.val2 = undefined;\r\n    this.setting.isComplete = this.setting.val1 !== undefined && this.setting.val1.length > 0;\r\n    this.onChange?.();\r\n  }\r\n\r\n  @action.bound\r\n  chooseNewValue(value: any) {\r\n    if (value !== null && !this.setting.val1?.includes(value)) {\r\n      if (this.setting.val1 === undefined) {\r\n        this.setting.val1 = [value];\r\n      } else {\r\n        this.setting.val1 = [...this.setting.val1, value];\r\n      }\r\n      this.onValueChanged();\r\n    }\r\n  }\r\n\r\n  get idsInEditor() {\r\n    return this.setting.val1 ?? [] as string[];\r\n  }\r\n\r\n  @action.bound\r\n  remove(valueToRemove: any): void {\r\n    const index = this.setting.val1.indexOf(valueToRemove)\r\n    if (index > -1) {\r\n      this.setting.val1.splice(index, 1);\r\n    }\r\n    if (this.setting.val1?.length === 0) {\r\n      this.setting.val1 = undefined;\r\n    } else {\r\n      this.setting.val1 = [...this.setting.val1];\r\n    }\r\n    this.onValueChanged();\r\n  }\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useContext, useState } from \"react\";\r\nimport { MobileTagInputEditor } from \"gui/connections/MobileComponents/Form/ComboBox/MobileTagInputEditor\";\r\nimport { getMobileState } from \"model/selectors/getMobileState\";\r\nimport { EditLayoutState } from \"model/entities/MobileState/MobileLayoutState\";\r\nimport {\r\n  FilterEditorData,\r\n} from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/TagFilterEditor\";\r\nimport { IFilterSetting } from \"model/entities/types/IFilterSetting\";\r\nimport { CancellablePromise } from \"mobx/lib/api/flow\";\r\nimport { ILookup } from \"model/entities/types/ILookup\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { MobXProviderContext } from \"mobx-react\";\r\nimport { IMobileDropdownContext } from \"gui/connections/MobileComponents/Form/ComboBox/ComboBox\";\r\nimport { IDropdownEditorApi } from \"modules/Editors/DropdownEditor/DropdownEditorApi\";\r\nimport { IDropdownEditorData } from \"modules/Editors/DropdownEditor/DropdownEditorData\";\r\nimport { DropdownColumnDrivers, DropdownDataTable } from \"modules/Editors/DropdownEditor/DropdownTableModel\";\r\nimport { DropdownEditorLookupListCache } from \"modules/Editors/DropdownEditor/DropdownEditorLookupListCache\";\r\nimport { MobileDropdownBehavior } from \"gui/connections/MobileComponents/Form/ComboBox/MobileDropdownBehavior\";\r\nimport { DefaultHeaderCellDriver } from \"modules/Editors/DropdownEditor/Cells/HeaderCell\";\r\nimport { TextCellDriver } from \"modules/Editors/DropdownEditor/Cells/TextCellDriver\";\r\nimport { DropdownEditorSetup } from \"modules/Editors/DropdownEditor/DropdownEditorSetup\";\r\nimport { ComboFullScreenEditor } from \"gui/connections/MobileComponents/Form/ComboBox/ComboFullScreenEditor\";\r\nimport {\r\n  FilterDropDownApi\r\n} from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/TagLookupFilterEditor\";\r\n\r\nexport const MobileTagFilterEditor: React.FC<{\r\n  setting: IFilterSetting;\r\n  getOptions: (searchTerm: string) => CancellablePromise<Array<any>>;\r\n  lookup: ILookup;\r\n  property: IProperty;\r\n  autoFocus: boolean;\r\n  id: string;\r\n}> = (props) => {\r\n  return <MobileTagInputEditor\r\n    key={props.id}\r\n    isReadOnly={false}\r\n    property={props.property}\r\n    values={props.setting.val1 ?? []}\r\n    onPlusButtonClick={() => {\r\n      let mobileState = getMobileState(props.property);\r\n      let layoutBeforeEditing = mobileState.layoutState;\r\n      mobileState.layoutState = new EditLayoutState(\r\n        <FullScreenFilterTagEditor\r\n          id={props.id}\r\n          lookup={props.lookup}\r\n          property={props.property}\r\n          getOptions={props.getOptions}\r\n          onChange={() => {\r\n            mobileState.layoutState = layoutBeforeEditing;\r\n          }}\r\n          setting={props.setting}\r\n          values={props.setting.val1 ?? []}\r\n          autoFocus={props.autoFocus}\r\n        />,\r\n        props.property.name,\r\n        layoutBeforeEditing\r\n      )\r\n    }}\r\n  />\r\n}\r\n\r\n\r\nfunction FullScreenFilterTagEditor(props: {\r\n  lookup: ILookup;\r\n  property: IProperty;\r\n  getOptions: (searchTerm: string) => CancellablePromise<Array<any>>;\r\n  values: Array<any>;\r\n  onChange: () => void;\r\n  setting: IFilterSetting;\r\n  autoFocus: boolean;\r\n  id: string;\r\n}) {\r\n  const mobxContext = useContext(MobXProviderContext);\r\n  const workbench = mobxContext.workbench;\r\n  const {lookupListCache} = workbench;\r\n\r\n  const [dropdownEditorInfrastructure] = useState<IMobileDropdownContext>(() => {\r\n    const dropdownEditorApi: IDropdownEditorApi = new FilterDropDownApi(props.getOptions);\r\n    const dropdownEditorData: IDropdownEditorData = new FilterEditorData(props.setting, props.onChange);\r\n\r\n    const dropdownEditorDataTable = new DropdownDataTable(\r\n      () => dropdownEditorSetup,\r\n      dropdownEditorData\r\n    );\r\n    const dropdownEditorLookupListCache = new DropdownEditorLookupListCache(\r\n      () => dropdownEditorSetup,\r\n      lookupListCache\r\n    );\r\n\r\n    const dropdownEditorBehavior = new MobileDropdownBehavior({\r\n      api: dropdownEditorApi,\r\n      data: dropdownEditorData,\r\n      dataTable: dropdownEditorDataTable,\r\n      setup: () => dropdownEditorSetup,\r\n      cache: dropdownEditorLookupListCache,\r\n    });\r\n\r\n    const drivers = new DropdownColumnDrivers();\r\n\r\n    let identifierIndex = 0;\r\n    const columnNameToIndex = new Map<string, number>([\r\n      [props.property.identifier!, identifierIndex],\r\n    ]);\r\n    const visibleColumnNames: string[] = [];\r\n\r\n    columnNameToIndex.set(props.property.name, 1);\r\n    visibleColumnNames.push(props.property.name);\r\n\r\n    drivers.allDrivers.push({\r\n      columnId: props.property.id,\r\n      headerCellDriver: new DefaultHeaderCellDriver(props.property.name),\r\n      bodyCellDriver: new TextCellDriver(1, dropdownEditorDataTable, dropdownEditorBehavior),\r\n    });\r\n\r\n    const showUniqueValues = true;\r\n\r\n    const dropdownEditorSetup = new DropdownEditorSetup(\r\n      props.property.id,\r\n      props.lookup.lookupId,\r\n      [],\r\n      visibleColumnNames,\r\n      columnNameToIndex,\r\n      showUniqueValues,\r\n      props.property.identifier!,\r\n      identifierIndex,\r\n      props.property.parameters,\r\n      props.property.lookup?.dropDownType!,\r\n      props.property.lookup?.cached!,\r\n      !props.property.lookup?.searchByFirstColumnOnly,\r\n      drivers\r\n    );\r\n\r\n    return {\r\n      behavior: dropdownEditorBehavior,\r\n      editorData: dropdownEditorData,\r\n      editorDataTable: dropdownEditorDataTable,\r\n      setup: dropdownEditorSetup\r\n    };\r\n  });\r\n\r\n  (dropdownEditorInfrastructure.editorData as FilterEditorData).setting = props.setting;\r\n\r\n  return (\r\n    <ComboFullScreenEditor\r\n      {...props}\r\n      behavior={dropdownEditorInfrastructure.behavior}\r\n      dataTable={dropdownEditorInfrastructure.editorDataTable}\r\n      columnDrivers={dropdownEditorInfrastructure.setup.columnDrivers}\r\n      editorData={dropdownEditorInfrastructure.editorData}\r\n    />\r\n  );\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { observable, runInAction } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport { CancellablePromise } from \"mobx/lib/api/flow\";\r\nimport React from \"react\";\r\nimport {\r\n  FilterSettingsComboBox,\r\n  FilterSettingsComboBoxItem,\r\n} from \"gui/Components/ScreenElements/Table/FilterSettings/FilterSettingsComboBox\";\r\nimport { IFilterSetting } from \"model/entities/types/IFilterSetting\";\r\nimport { ILookup } from \"model/entities/types/ILookup\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { Operator } from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/Operator\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\nimport { TagFilterEditor } from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/TagFilterEditor\";\r\nimport { MobileTagFilterEditor } from \"gui/connections/MobileComponents/Grid/MobileTagFilterEditor\";\r\n\r\nconst OPERATORS = [\r\n  Operator.in,\r\n  Operator.notIn,\r\n  Operator.isNull,\r\n  Operator.isNotNull\r\n];\r\n\r\nconst OpCombo: React.FC<{\r\n  setting: IFilterSetting\r\n  id: string;\r\n}> = observer((props) => {\r\n  return (\r\n    <FilterSettingsComboBox\r\n      id={props.id}\r\n      trigger={<>{(OPERATORS.find((op) => op.type === props.setting.type) || {}).caption}</>}\r\n    >\r\n      {OPERATORS.map((op) => (\r\n        <FilterSettingsComboBoxItem\r\n          key={op.type}\r\n          onClick={() => {\r\n            runInAction(() => {\r\n              props.setting.type = op.type;\r\n              props.setting.isComplete = op.type === \"null\" || op.type === \"nnull\" || props.setting.val1 !== undefined;\r\n              if (op.type === \"null\" || op.type === \"nnull\") {\r\n                props.setting.val1 = undefined;\r\n                props.setting.val2 = undefined;\r\n              }\r\n            });\r\n          }}\r\n        >\r\n          {op.caption}\r\n        </FilterSettingsComboBoxItem>\r\n      ))}\r\n    </FilterSettingsComboBox>\r\n  );\r\n});\r\n\r\nexport interface ITagEditorItem {\r\n  text: string;\r\n  value: string;\r\n}\r\n\r\n@observer\r\nclass OpEditors extends React.Component<{\r\n  setting: IFilterSetting;\r\n  getOptions: (searchTerm: string) => CancellablePromise<Array<any>>;\r\n  lookup: ILookup;\r\n  property: IProperty;\r\n  autoFocus: boolean;\r\n  id: string;\r\n}> {\r\n\r\n  render() {\r\n    const {setting} = this.props;\r\n    switch (setting?.type) {\r\n      case \"in\":\r\n      case \"nin\":\r\n        if (isMobileLayoutActive(this.props.property)) {\r\n          return <MobileTagFilterEditor\r\n            id={this.props.id}\r\n            lookup={this.props.lookup}\r\n            property={this.props.property}\r\n            getOptions={this.props.getOptions}\r\n            setting={setting}\r\n            autoFocus={this.props.autoFocus}\r\n          />\r\n        } else {\r\n          return (\r\n            <TagFilterEditor\r\n              id={this.props.id}\r\n              lookup={this.props.lookup}\r\n              property={this.props.property}\r\n              getOptions={this.props.getOptions}\r\n              values={setting.val1 ?? []}\r\n              setting={setting}\r\n              autoFocus={this.props.autoFocus}\r\n            />\r\n          );\r\n        }\r\n      case \"null\":\r\n      case \"nnull\":\r\n      default:\r\n        return null;\r\n    }\r\n  }\r\n}\r\n\r\n@observer\r\nexport class FilterSettingsTagInput extends React.Component<{\r\n  getOptions: (searchTerm: string) => CancellablePromise<Array<any>>;\r\n  lookup: ILookup;\r\n  property: IProperty;\r\n  setting: IFilterSetting;\r\n  autoFocus: boolean;\r\n  id: string;\r\n}> {\r\n  static get defaultSettings() {\r\n    return new TagInputFilterSetting(OPERATORS[0].type)\r\n  }\r\n\r\n  render() {\r\n    const setting = this.props.setting;\r\n    return (\r\n      <>\r\n        <OpCombo\r\n          setting={setting}\r\n          id={\"combo_\" + this.props.id}\r\n        />\r\n        <OpEditors\r\n          id={\"input_\" + this.props.id}\r\n          setting={setting}\r\n          getOptions={this.props.getOptions}\r\n          lookup={this.props.lookup}\r\n          property={this.props.property}\r\n          autoFocus={this.props.autoFocus}\r\n        />\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport class TagInputFilterSetting implements IFilterSetting {\r\n  @observable type: string;\r\n  @observable val1?: any; // used for \"in\" operator ... string[]\r\n  @observable val2?: any; // used for \"contains\" operator ... string\r\n  isComplete: boolean;\r\n  lookupId: string | undefined;\r\n\r\n  get filterValue1() {\r\n    if (!this.val1) {\r\n      return this.val1;\r\n    }\r\n    switch (this.type) {\r\n      case \"in\":\r\n      case \"nin\":\r\n        return this.val1;\r\n      default:\r\n        return undefined;\r\n    }\r\n  }\r\n\r\n  get filterValue2() {\r\n    return this.type === \"between\" || this.type === \"nbetween\"\r\n      ? this.val2\r\n      : undefined;\r\n  }\r\n\r\n\r\n  get val1ServerForm() {\r\n    return this.val1 ? this.val1.join(\",\") : this.val1;\r\n  }\r\n\r\n  get val2ServerForm() {\r\n    return this.val2;\r\n  }\r\n\r\n  constructor(type: string, isComplete = false, val1?: string, val2?: any) {\r\n    this.type = type;\r\n    this.isComplete = isComplete;\r\n    if (val1 !== undefined && val1 !== null) {\r\n      this.val1 = [...new Set(val1.split(\",\"))];\r\n    }\r\n    this.val2 = val2 ?? undefined;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useContext } from \"react\";\r\nimport { FilterSettingsBoolean } from \"./HeaderControls/FilterSettingsBoolean\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { FilterSettingsString } from \"./HeaderControls/FilterSettingsString\";\r\nimport { FilterSettingsDate } from \"./HeaderControls/FilterSettingsDate\";\r\nimport { observer } from \"mobx-react-lite\";\r\nimport { FilterSettingsNumber } from \"./HeaderControls/FilterSettingsNumber\";\r\nimport { FilterSettingsLookup } from \"./HeaderControls/FilterSettingsLookup\";\r\nimport { flow } from \"mobx\";\r\nimport { MobXProviderContext } from \"mobx-react\";\r\nimport { onApplyFilterSetting } from \"model/actions-ui/DataView/TableView/onApplyFilterSetting\";\r\nimport { getFilterSettingByProperty } from \"model/selectors/DataView/getFilterSettingByProperty\";\r\nimport { IFilterSetting } from \"model/entities/types/IFilterSetting\";\r\nimport { getAllLookupIds } from \"model/entities/getAllLookupIds\";\r\nimport { FilterSettingsTagInput } from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/FilterSettingsTagInput\";\r\nimport { getGridFocusManager } from \"../../../../../model/entities/GridFocusManager\";\r\n\r\nexport const FilterSettings: React.FC<{ autoFocus: boolean, ctx: any }> = observer((props) => {\r\n  const property = useContext(MobXProviderContext).property as IProperty;\r\n\r\n  function getSettings(defaultValue: IFilterSetting) {\r\n    let setting = getFilterSettingByProperty(property, property.id);\r\n    if (!setting) {\r\n      setting = defaultValue;\r\n      onApplyFilterSetting(property)(setting);\r\n    }\r\n    return setting;\r\n  }\r\n\r\n  function onFilterValueChange() {\r\n    getGridFocusManager(props.ctx).focusTableOnReload = false;\r\n  }\r\n\r\n  switch (property.column) {\r\n    case \"Text\":\r\n      return <FilterSettingsString\r\n        id={property.modelInstanceId}\r\n        setting={getSettings(FilterSettingsString.defaultSettings)}\r\n        onChange={onFilterValueChange}\r\n        autoFocus={props.autoFocus}/>;\r\n    case \"CheckBox\":\r\n      return <FilterSettingsBoolean\r\n        id={property.modelInstanceId}\r\n        setting={getSettings(FilterSettingsBoolean.defaultSettings)}\r\n        ctx={property}\r\n      />;\r\n    case \"Date\":\r\n      return <FilterSettingsDate\r\n        id={property.modelInstanceId}\r\n        setting={getSettings(FilterSettingsDate.defaultSettings)}\r\n        autoFocus={props.autoFocus}\r\n        property={property}\r\n      />;\r\n    case \"Number\":\r\n      return <FilterSettingsNumber\r\n        id={property.modelInstanceId}\r\n        allowDecimalSeparator={property.entity !== \"Integer\" && property.entity !== \"Long\"}\r\n        setting={getSettings(FilterSettingsNumber.defaultSettings)}\r\n        onChange={onFilterValueChange}\r\n        autoFocus={props.autoFocus}/>;\r\n    case \"ComboBox\":\r\n      const setting = getSettings(FilterSettingsLookup.defaultSettings);\r\n      setting.lookupId = property.lookupId;\r\n      return (\r\n        <FilterSettingsLookup\r\n          id={property.modelInstanceId}\r\n          setting={setting}\r\n          property={property}\r\n          lookup={property.lookup!}\r\n          autoFocus={props.autoFocus}\r\n          getOptions={flow(function*(searchTerm: string) {\r\n            let allLookupIds = yield*getAllLookupIds(property);\r\n            const lookupMap = yield property.lookupEngine?.lookupResolver.resolveList(allLookupIds);\r\n\r\n            return Array.from(allLookupIds.values())\r\n              .map((id) => [id, lookupMap.get(id)])\r\n              .filter\r\n              (\r\n                (array) =>\r\n                  array[1] &&\r\n                  array[1].toLocaleLowerCase().includes((searchTerm || \"\").toLocaleLowerCase())\r\n              )\r\n              .sort((x, y) => x[1] > y[1] ? 1 : -1);\r\n          })}\r\n        />\r\n      );\r\n    case \"TagInput\":\r\n      return (\r\n        <FilterSettingsTagInput\r\n          id={property.modelInstanceId}\r\n          setting={getSettings(FilterSettingsTagInput.defaultSettings)}\r\n          property={property}\r\n          lookup={property.lookup!}\r\n          autoFocus={props.autoFocus}\r\n          getOptions={flow(function*(searchTerm: string) {\r\n            let allLookupIds = yield*getAllLookupIds(property);\r\n            const lookupMap: Map<any, any> =\r\n              yield property.lookupEngine?.lookupResolver.resolveList(allLookupIds);\r\n            return Array.from(lookupMap.entries())\r\n              .filter\r\n              (\r\n                (array) =>\r\n                  array[1] &&\r\n                  array[1].toLocaleLowerCase().includes((searchTerm || \"\").toLocaleLowerCase())\r\n              )\r\n              .sort((x, y) => x[1] > y[1] ? 1 : -1);\r\n          })}\r\n        />\r\n      );\r\n    default:\r\n      return <>{property.column}</>;\r\n  }\r\n});\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFilterConfiguration } from \"./getFilterConfiguration\";\r\n\r\nexport function getFilterSettingByProperty(ctx: any, prop: string) {\r\n  const filter = getFilterConfiguration(ctx).getSettingByPropertyId(prop);\r\n  return filter ? filter.setting : undefined;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { getProperty } from \"model/selectors/DataView/getProperty\";\r\nimport { getFilterConfiguration } from \"../../../selectors/DataView/getFilterConfiguration\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { IFilterSetting } from \"../../../entities/types/IFilterSetting\";\r\n\r\nexport function onApplyFilterSetting(ctx: any) {\r\n  const prop = getProperty(ctx);\r\n  return flow(function*onApplyFilterSetting(setting: IFilterSetting) {\r\n    try {\r\n      getFilterConfiguration(ctx).setFilter(\r\n        {propertyId: prop.id, dataType: prop.column, setting});\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { FilterSettings } from \"gui/Components/ScreenElements/Table/FilterSettings/FilterSettings\";\r\nimport { getTableViewProperties } from \"model/selectors/TablePanelView/getTableViewProperties\";\r\nimport { IDataView } from \"model/entities/types/IDataView\";\r\nimport { observer, Provider } from \"mobx-react\";\r\nimport S from \"./FilterEditor.module.scss\";\r\nimport { getTotalRowCount } from \"model/selectors/DataView/getTotalGroupRowCount\";\r\nimport { T } from \"utils/translation\";\r\n\r\nexport const FilterEditor: React.FC<{\r\n  dataView: IDataView\r\n}> = observer((props) => {\r\n\r\n  const propertiesToDisplay = getTableViewProperties(props.dataView)\r\n    .filter(prop => prop.column !== \"Image\");\r\n  const totalRowCount = getTotalRowCount(props.dataView);\r\n\r\n  return (\r\n\r\n    <div className={S.root}>\r\n      <div className={S.rowContainer}>\r\n        {\r\n          propertiesToDisplay.map(property =>\r\n            <div className={S.filterRow}>\r\n              <Provider property={property}>\r\n                <div className={S.label}>\r\n                  {property.name}\r\n                </div>\r\n                <div className={S.filterSettingContainer}>\r\n                  <FilterSettings\r\n                    key={`filter-settings-${property.id}`}\r\n                    autoFocus={false} ctx={props.dataView}/>\r\n                </div>\r\n              </Provider>\r\n            </div>\r\n          )\r\n        }\r\n      </div>\r\n      <div className={S.rowCount}>\r\n        {T(\"Rows\", \"row_count\") + \": \" + totalRowCount}\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { getConfigurationManager } from \"model/selectors/TablePanelView/getConfigurationManager\";\r\nimport { runGeneratorInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\n\r\nexport function onColumnOrderChangeFinished(ctx: any, id1: string, id2: string) {\r\n  runGeneratorInFlowWithHandler({\r\n    ctx: ctx,\r\n    generator: function*() {\r\n      const tablePanelView = getTablePanelView(ctx);\r\n      tablePanelView?.swapColumns(id1, id2);\r\n      yield*getConfigurationManager(ctx).onColumnOrderChanged();\r\n    }()\r\n  })\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { getTableViewProperties } from \"model/selectors/TablePanelView/getTableViewProperties\";\r\nimport { IDataView } from \"model/entities/types/IDataView\";\r\nimport { DragDropContext, Draggable, DraggableProvided, Droppable, DropResult } from \"react-beautiful-dnd\";\r\nimport { onColumnOrderChangeFinished } from \"model/actions-ui/DataView/TableView/onColumnOrderChangeFinished\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport S from \"./ColumnOrderEditor.module.scss\";\r\nimport { observer } from \"mobx-react\";\r\n\r\nexport const ColumnOrderEditor: React.FC<{\r\n  dataView: IDataView\r\n}> = observer((props) => {\r\n\r\n  let properties = getTableViewProperties(props.dataView);\r\n\r\n  function onColumnDragEnd(result: DropResult) {\r\n    if (!result.destination) {\r\n      return;\r\n    }\r\n    const tablePanelView = getTablePanelView(props.dataView);\r\n    onColumnOrderChangeFinished(\r\n      tablePanelView,\r\n      tablePanelView.tablePropertyIds[result.source.index],\r\n      tablePanelView.tablePropertyIds[result.destination.index]\r\n    );\r\n  }\r\n\r\n  function renderRow(caption: string, provided: DraggableProvided){\r\n    return(\r\n      <div\r\n        className={S.row}\r\n        ref={provided?.innerRef}\r\n        {...provided?.draggableProps}\r\n        {...provided.dragHandleProps}\r\n      >\r\n        {caption}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n\r\n      <DragDropContext onDragEnd={(result) => onColumnDragEnd(result)}>\r\n        <Droppable droppableId=\"mobileHeaders\" direction=\"vertical\">\r\n          {(provided) =>\r\n            <div  className={S.root} {...provided.droppableProps} ref={provided.innerRef}>\r\n              {\r\n                properties.map((prop, i) =>\r\n                  <Draggable draggableId={prop.id} index={i} key={prop.id}>\r\n                    {(provided) => renderRow(prop.name, provided)}\r\n                  </Draggable>\r\n                )\r\n              }\r\n              {provided.placeholder}\r\n            </div>\r\n          }\r\n        </Droppable>\r\n      </DragDropContext>\r\n  );\r\n});\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/connections/MobileComponents/BottomToolBar/BottomIcon.module.scss\";\r\nimport { Icon } from \"@origam/components\";\r\n\r\nexport const BottomIcon: React.FC<{\r\n  iconPath?: string;\r\n  onClick: ()=>void;\r\n  hidden?: boolean;\r\n  className?: string;\r\n}> = (props) => {\r\n  return (\r\n    <div\r\n      className={S.root}\r\n      onClick={props.onClick}\r\n    >\r\n      {props.iconPath && <div className={S.icon}>\r\n        <Icon\r\n          src={props.iconPath}\r\n          className={props.className + \" \" + (props.hidden ? S.hidden : \"\")}\r\n        />\r\n      </div>}\r\n    </div>\r\n  );\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/connections/MobileComponents/Navigation/NavigationButton.module.scss\";\r\nimport { Icon } from \"@origam/components\";\r\nimport SN from \"gui/connections/MobileComponents/Navigation/NavigationButton.module.scss\";\r\n\r\nexport const NavigationButton: React.FC<{\r\n  label: string;\r\n  onClick: () => void;\r\n  isOpen?: boolean;\r\n}> = (props) => {\r\n\r\n  return (\r\n    <div>\r\n      <div\r\n        className={S.navigationButton}\r\n        onClick={props.onClick}\r\n      >\r\n        <div className={S.label}>\r\n          {props.label}\r\n        </div>\r\n        <Icon\r\n          src={props.isOpen ? \"./icons/noun-chevron-933246.svg\" : \"./icons/noun-chevron-933251.svg\"}\r\n          className={SN.navigationIcon}\r\n        />\r\n      </div>\r\n      {props.children}\r\n    </div>\r\n  );\r\n};","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useContext, useState } from \"react\";\r\nimport S from \"gui/connections/MobileComponents/Grid/ColumnConfiguration.module.scss\";\r\nimport { IDataView } from \"model/entities/types/IDataView\";\r\nimport { getColumnConfigurationModel } from \"model/selectors/getColumnConfigurationModel\";\r\nimport { IColumnConfiguration } from \"model/entities/TablePanelView/types/IConfigurationManager\";\r\nimport { T } from \"utils/translation\";\r\nimport {\r\n  aggregationOptions,\r\n  ColumnConfigurationModel,\r\n  timeunitOptions\r\n} from \"model/entities/TablePanelView/ColumnConfigurationModel\";\r\nimport { Button, SimpleDropdown } from \"@origam/components\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { MobileState } from \"model/entities/MobileState/MobileState\";\r\nimport { EditLayoutState, ScreenLayoutState } from \"model/entities/MobileState/MobileLayoutState\";\r\nimport { MobileBooleanInput } from \"gui/connections/MobileComponents/Form/MobileBooleanInput\";\r\nimport { ColumnOrderEditor } from \"gui/connections/MobileComponents/Grid/ColumnOrderEditor\";\r\nimport { BottomIcon } from \"gui/connections/MobileComponents/BottomToolBar/BottomIcon\";\r\nimport { NavigationButton } from \"gui/connections/MobileComponents/Navigation/NavigationButton\";\r\n\r\nexport const ColumnConfiguration: React.FC<{\r\n  dataView: IDataView\r\n}> = observer((props) => {\r\n\r\n  const configModel = getColumnConfigurationModel(props.dataView);\r\n\r\n  const mobileState = useContext(MobXProviderContext).application.mobileState as MobileState;\r\n\r\n  return (\r\n    <div className={S.root}>\r\n      <div className={S.content}>\r\n        <div className={S.columnConfigs}>\r\n          {configModel.sortedColumnConfigs.map((config, i) =>\r\n            <ColumnConfig\r\n              index={i}\r\n              config={config}\r\n              model={configModel}\r\n            />\r\n          )}\r\n        </div>\r\n      </div>\r\n      <div className={S.lockedColumnsRow}>\r\n        {T(\"Locked columns count\", \"column_config_locked_columns_count\")}\r\n        <input\r\n          className={S.input}\r\n          type=\"number\"\r\n          min={0}\r\n          value={\"\" + configModel.columnsConfiguration.fixedColumnCount}\r\n          onChange={configModel.handleFixedColumnsCountChange}\r\n        />\r\n      </div>\r\n      <div className={S.buttonRow}>\r\n        <Button\r\n          label={T(\"OK\", \"button_ok\")}\r\n          onClick={() => {\r\n            configModel.onColumnConfigurationSubmit();\r\n            mobileState.layoutState = new ScreenLayoutState();\r\n          }}\r\n        />\r\n        <Button\r\n          label={T(\"Save As...\", \"column_config_save_as\")}\r\n          onClick={() => configModel.onSaveAsClick()}\r\n        />\r\n        <Button\r\n          label={T(\"Order\", \"order_columns_button\")}\r\n          onClick={() => {\r\n            const previousLayout = mobileState.layoutState;\r\n            mobileState.layoutState = new EditLayoutState(\r\n              <ColumnOrderEditor dataView={props.dataView}/>,\r\n              T(\"Order Columns\" , \"order_columns_title\"),\r\n              previousLayout,\r\n              true,\r\n            );\r\n          }}\r\n        />\r\n        <BottomIcon\r\n          key={\"close\"}\r\n          iconPath={\"./icons/noun-close-25798.svg\"}\r\n          onClick={async () => {\r\n            configModel.onColumnConfCancel();\r\n            mobileState.layoutState = new ScreenLayoutState();\r\n          }}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nexport const ColumnConfig: React.FC<{\r\n  config: IColumnConfiguration,\r\n  index: number;\r\n  model: ColumnConfigurationModel;\r\n}> = observer((props) => {\r\n\r\n\r\n  const selectedAggregationOption = aggregationOptions.find(option => option.value === props.config.aggregationType)!;\r\n\r\n  const selectedTimeUnitOption = timeunitOptions.find(option => option.value === props.config.timeGroupingUnit)!;\r\n\r\n  const {\r\n    name,\r\n    entity,\r\n    canGroup,\r\n    canAggregate,\r\n    modelInstanceId // eslint-disable-line\r\n  } = props.model.columnOptions.get(props.config.propertyId)!;\r\n\r\n  const isDefault = props.config.groupingIndex === 0 && props.config.isVisible && !props.config.aggregationType\r\n\r\n  const [isExpanded, setIsExpanded] = useState<boolean>(!isDefault);\r\n\r\n  function renderContent() {\r\n    return (\r\n      <>\r\n        <div\r\n          key={\"Visible\"}\r\n          className={S.row}>\r\n          <div className={S.label}>\r\n            {T(\"Visible\", \"column_config_visible\")}\r\n          </div>\r\n          <MobileBooleanInput\r\n            onChange={(event: any) => props.model.setVisible(props.index, event.target.checked)}\r\n            checked={props.config.isVisible}\r\n          />\r\n        </div>\r\n        {canGroup &&\r\n          <div\r\n            key={\"GroupBy\"}\r\n            className={S.row}>\r\n            <div className={S.label}>\r\n              {T(\"GroupBy\", \"column_config_group_by\")}\r\n            </div>\r\n            <MobileBooleanInput\r\n              checked={props.config.groupingIndex > 0}\r\n              onChange={(event: any) => props.model.setGrouping(props.index, event.target.checked, entity)}\r\n              disabled={!canGroup}\r\n            />\r\n          </div>\r\n        }\r\n        {props.config.groupingIndex > 0 && entity === \"Date\" &&\r\n          <div\r\n            key={\"Grouping Unit\"}\r\n            className={S.row}>\r\n            <div className={S.label}>\r\n              {T(\"Grouping Unit\", \"column_config_time_grouping_unit\")}\r\n            </div>\r\n            <SimpleDropdown\r\n              className={S.dropdown}\r\n              options={timeunitOptions}\r\n              selectedOption={selectedTimeUnitOption}\r\n              onOptionClick={option => props.model.setTimeGroupingUnit(props.index, option.value)}\r\n            />\r\n          </div>\r\n        }\r\n        {(entity === \"Currency\" ||\r\n            entity === \"Integer\" ||\r\n            entity === \"Float\" ||\r\n            entity === \"Long\") &&\r\n          canAggregate &&\r\n          <div\r\n            key={\"Aggregation\"}\r\n            className={S.row}>\r\n            <div className={S.label}>\r\n              {T(\"Aggregation\", \"column_config_aggregation\")}\r\n            </div>\r\n            <SimpleDropdown\r\n              className={S.dropdown}\r\n              options={aggregationOptions}\r\n              selectedOption={selectedAggregationOption}\r\n              onOptionClick={option => props.model.setAggregation(props.index, option.value)}\r\n            />\r\n          </div>\r\n        }\r\n        <div\r\n          key={\"Width\"}\r\n          className={S.row}>\r\n          <div className={S.label}>\r\n            {T(\"Width\", \"column_width\")}\r\n          </div>\r\n          <input\r\n            className={S.input}\r\n            type=\"number\"\r\n            onChange={(event: any) => props.model.setWidth(props.index, event.target.value)}\r\n            value={props.config.width}\r\n          />\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <NavigationButton\r\n      label={name}\r\n      onClick={() => setIsExpanded(!isExpanded)}\r\n      isOpen={isExpanded}\r\n    >\r\n      {isExpanded && renderContent()}\r\n    </NavigationButton>\r\n  );\r\n});\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/SidebarInfoSection/SidebarRecordInfo.module.scss\";\r\n\r\nexport const SidebarRecordInfo: React.FC<{ lines: string[] }> = props => (\r\n  <div className={S.root}>\r\n    {props.lines.map((line, idx) => (\r\n      <p key={idx} dangerouslySetInnerHTML={{__html: line}}/>\r\n    ))}\r\n  </div>\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/connections/MobileComponents/Grid/RecordInfo.module.scss\";\r\nimport { SidebarRecordInfo } from \"gui/Components/SidebarInfoSection/SidebarRecordInfo\";\r\nimport { IRecordInfo } from \"model/entities/types/IRecordInfo\";\r\n\r\nexport const RecordInfo: React.FC<{\r\n  recordInfo: IRecordInfo\r\n}> = (props) => {\r\n  return (\r\n    <div className={S.root}>\r\n        {props.recordInfo.info.length > 0 && (\r\n          <SidebarRecordInfo lines={props.recordInfo.info}/>\r\n        )}\r\n    </div>\r\n  );\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Dropdowner } from \"gui/Components/Dropdowner/Dropdowner\";\r\nimport { CtxDataViewHeaderExtension, DataViewHeaderExtension, } from \"gui/Components/ScreenElements/DataView\";\r\nimport { DataViewHeaderAction } from \"gui/Components/DataViewHeader/DataViewHeaderAction\";\r\nimport { DataViewHeaderGroup } from \"gui/Components/DataViewHeader/DataViewHeaderGroup\";\r\nimport { Dropdown } from \"gui/Components/Dropdown/Dropdown\";\r\nimport { DropdownItem } from \"gui/Components/Dropdown/DropdownItem\";\r\nimport { Icon } from \"@origam/components\";\r\nimport { FilterDropDown } from \"gui/connections/FilterDropDown\";\r\nimport { MobXProviderContext, Observer, observer } from \"mobx-react\";\r\nimport uiActions from \"model/actions-ui-tree\";\r\nimport { getIsRowMovingDisabled } from \"model/actions-ui/DataView/getIsRowMovingDisabled\";\r\nimport { onCopyRowClick } from \"model/actions-ui/DataView/onCopyRowClick\";\r\nimport { onCreateRowClick } from \"model/actions-ui/DataView/onCreateRowClick\";\r\nimport { onDeleteRowClick } from \"model/actions-ui/DataView/onDeleteRowClick\";\r\nimport { onExportToExcelClick } from \"model/actions-ui/DataView/onExportToExcelClick\";\r\nimport { onMoveRowDownClick } from \"model/actions-ui/DataView/onMoveRowDownClick\";\r\nimport { onMoveRowUpClick } from \"model/actions-ui/DataView/onMoveRowUpClick\";\r\nimport { onNextRowClick } from \"model/actions-ui/DataView/onNextRowClick\";\r\nimport { onPrevRowClick } from \"model/actions-ui/DataView/onPrevRowClick\";\r\nimport { onRecordInfoClick } from \"model/actions-ui/RecordInfo/onRecordInfoClick\";\r\nimport { IAction, IActionMode } from \"model/entities/types/IAction\";\r\nimport { getIsEnabledAction } from \"model/selectors/Actions/getIsEnabledAction\";\r\nimport { getIsAddButtonVisible } from \"model/selectors/DataView/getIsAddButtonVisible\";\r\nimport { getIsCopyButtonVisible } from \"model/selectors/DataView/getIsCopyButtonVisible\";\r\nimport { getIsDelButtonVisible } from \"model/selectors/DataView/getIsDelButtonVisible\";\r\nimport { getIsMoveRowMenuVisible } from \"model/selectors/DataView/getIsMoveRowMenuVisible\";\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\nimport { getOpenedScreen } from \"model/selectors/getOpenedScreen\";\r\nimport { getIsFilterControlsDisplayed } from \"model/selectors/TablePanelView/getIsFilterControlsDisplayed\";\r\nimport React, { useContext } from \"react\";\r\nimport Measure from \"react-measure\";\r\nimport { T } from \"utils/translation\";\r\nimport { getConfigurationManager } from \"model/selectors/TablePanelView/getConfigurationManager\";\r\nimport { action, computed } from \"mobx\";\r\nimport { getPanelMenuActions } from \"model/selectors/DataView/getPanelMenuActions\";\r\nimport { DropdownDivider } from \"gui/Components/Dropdown/DropdownDivider\";\r\nimport { getAreCrudButtonsEnabled } from \"model/selectors/DataView/getAreCrudButtonsEnabled\";\r\nimport {\r\n  isAddRecordShortcut,\r\n  isDeleteRecordShortcut,\r\n  isDuplicateRecordShortcut,\r\n  isFilterRecordShortcut,\r\n  renderRowCount\r\n} from \"gui/connections/CDataViewHeader\";\r\nimport { DataViewHeader } from \"gui/Components/DataViewHeader/DataViewHeader\";\r\nimport \"gui/connections/MobileComponents/Grid/DataViewHeader.module.scss\"\r\nimport { getMobileState } from \"model/selectors/getMobileState\";\r\nimport { EditLayoutState, ScreenLayoutState } from \"model/entities/MobileState/MobileLayoutState\";\r\nimport { FilterEditor } from \"gui/connections/MobileComponents/Grid/FilterEditor\";\r\nimport { ColumnConfiguration } from \"gui/connections/MobileComponents/Grid/ColumnConfiguration\";\r\nimport { getColumnConfigurationModel } from \"model/selectors/getColumnConfigurationModel\";\r\nimport { saveColumnConfigurationsAsync } from \"model/actions/DataView/TableView/saveColumnConfigurations\";\r\nimport { getRecordInfo } from \"model/selectors/RecordInfo/getRecordInfo\";\r\nimport { RecordInfo } from \"gui/connections/MobileComponents/Grid/RecordInfo\";\r\n\r\n@observer\r\nexport class DataViewHeaderInner extends React.Component<{\r\n  isVisible: boolean;\r\n  extension: DataViewHeaderExtension;\r\n}> {\r\n  static contextType = MobXProviderContext;\r\n\r\n  get dataView() {\r\n    return this.context.dataView;\r\n  }\r\n\r\n  state = {\r\n    hiddenActionIds: new Set<string>(),\r\n  };\r\n\r\n  shouldBeShown(action: IAction) {\r\n    return getIsEnabledAction(action) || action.mode !== IActionMode.ActiveRecord;\r\n  }\r\n\r\n  @computed\r\n  get relevantMenuActions() {\r\n    return this.allMenuActions\r\n      .filter((action) => !action.groupId)\r\n      .filter((action) => this.shouldBeShown(action));\r\n  }\r\n\r\n  renderMenuActions(args: { setMenuDropped(state: boolean): void }) {\r\n    return this.relevantMenuActions.map((action) => {\r\n      return (\r\n        <DropdownItem\r\n          key={action.id}\r\n          onClick={(event) => {\r\n            args.setMenuDropped(false);\r\n            uiActions.actions.onActionClick(action)(event, action);\r\n          }}\r\n        >\r\n          {action.caption}\r\n        </DropdownItem>\r\n      );\r\n    });\r\n  }\r\n\r\n  get mobileState(){\r\n    return getMobileState(this.dataView);\r\n  }\r\n\r\n  @computed\r\n  get isBarVisible() {\r\n    return this.props.isVisible;\r\n  }\r\n\r\n  @computed\r\n  get allMenuActions() {\r\n    return getPanelMenuActions(this.dataView);\r\n  }\r\n\r\n  @action\r\n  onFilterButtonClick(){\r\n    this.mobileState.layoutState =  new EditLayoutState(\r\n      <FilterEditor dataView={this.dataView}/>,\r\n      T(\"Filter\", \"filter_tool_tip\"),\r\n      new ScreenLayoutState(),\r\n      true,\r\n    );\r\n  }\r\n\r\n  @action\r\n  onColumnConfigurationClick(){\r\n    const configurationModel = getColumnConfigurationModel(this.dataView);\r\n    configurationModel.reset();\r\n    this.mobileState.layoutState =  new EditLayoutState(\r\n      <ColumnConfiguration dataView={this.dataView}/>,\r\n      !configurationModel.columnsConfiguration.name\r\n        ?  T(\"Default View\", \"default_grid_view_view\")\r\n        : configurationModel.columnsConfiguration.name,\r\n      new ScreenLayoutState(),\r\n      false,\r\n    );\r\n  }\r\n\r\n  async onRecordInfoClick(dataView: any){\r\n    await onRecordInfoClick(dataView)(null);\r\n    let previousLayout = this.mobileState.layoutState;\r\n    this.mobileState.layoutState = new EditLayoutState(\r\n      <RecordInfo recordInfo={getRecordInfo(dataView)}/>,\r\n      T(\"Record Info\", \"infopanel_title\"),\r\n      previousLayout\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const {dataView} = this;\r\n    const isFilterSettingsVisible = getIsFilterControlsDisplayed(dataView);\r\n    const onExportToExcelClickEvt = onExportToExcelClick(dataView);\r\n    const onDeleteRowClickEvt = onDeleteRowClick(dataView);\r\n    const onCreateRowClickEvt = onCreateRowClick(dataView, true);\r\n    const onMoveRowUpClickEvt = onMoveRowUpClick(dataView);\r\n    const isRowMovingDisabled = getIsRowMovingDisabled(dataView);\r\n    const onMoveRowDownClickEvt = onMoveRowDownClick(dataView);\r\n    const onCopyRowClickEvt = onCopyRowClick(dataView, true);\r\n    const onPrevRowClickEvt = onPrevRowClick(dataView);\r\n    const onNextRowClickEvt = onNextRowClick(dataView);\r\n\r\n    const isMoveRowMenuVisible = getIsMoveRowMenuVisible(dataView);\r\n\r\n    const selectedRow = getSelectedRow(dataView);\r\n\r\n    const isAddButton = getIsAddButtonVisible(dataView);\r\n    const isDelButton = getIsDelButtonVisible(dataView);\r\n    const isCopyButton = getIsCopyButtonVisible(dataView);\r\n    const showCrudButtons = isAddButton || (isDelButton && !!selectedRow) || (isCopyButton && !!selectedRow)\r\n    const crudButtonsEnabled = getAreCrudButtonsEnabled(dataView);\r\n\r\n    const isDialog = !!getOpenedScreen(dataView).dialogInfo;\r\n\r\n    const configurationManager = getConfigurationManager(dataView);\r\n    const customTableConfigsExist = configurationManager.customTableConfigurations.length > 0;\r\n    return (\r\n      <Measure bounds={true}>\r\n        {({measureRef, contentRect}) => {\r\n          return (\r\n            <Observer>\r\n              {() => (\r\n                <DataViewHeader domRef={measureRef} isVisible={this.isBarVisible}>\r\n                  {this.isBarVisible &&\r\n                    <>\r\n                      <div className=\"fullspaceBlock\">\r\n                        <DataViewHeaderGroup noShrink={true} className={\"rowCount\"} noDivider={true}>\r\n                          {renderRowCount(this.dataView)}\r\n                        </DataViewHeaderGroup>\r\n                        {isMoveRowMenuVisible ? (\r\n                          <DataViewHeaderGroup isHidden={false} noShrink={true} className={\"noDivider\"}>\r\n                            <DataViewHeaderAction\r\n                              onMouseDown={onMoveRowUpClickEvt}\r\n                              isDisabled={isRowMovingDisabled}\r\n                            >\r\n                              <Icon\r\n                                src=\"./icons/move-up.svg\"\r\n                                tooltip={T(\"Move Up\", \"increase_tool_tip\")}\r\n                              />\r\n                            </DataViewHeaderAction>\r\n                            <DataViewHeaderAction\r\n                              onMouseDown={onMoveRowDownClickEvt}\r\n                              isDisabled={isRowMovingDisabled}\r\n                            >\r\n                              <Icon\r\n                                src=\"./icons/move-down.svg\"\r\n                                tooltip={T(\"Move Down\", \"decrease_tool_tip\")}\r\n                              />\r\n                            </DataViewHeaderAction>\r\n                          </DataViewHeaderGroup>\r\n                        ) : null}\r\n                        {showCrudButtons &&\r\n                          <DataViewHeaderGroup noShrink={true} className={\"noDivider\"}>\r\n                            {isAddButton && (\r\n                              <DataViewHeaderAction\r\n                                className={\"addRow \" + (crudButtonsEnabled ? \"isGreenHover\" : \"\")}\r\n                                onClick={onCreateRowClickEvt}\r\n                                onShortcut={onCreateRowClickEvt}\r\n                                isDisabled={!crudButtonsEnabled}\r\n                                shortcutPredicate={isAddRecordShortcut}\r\n                              >\r\n                                <Icon src=\"./icons/add.svg\" tooltip={T(\"Add\", \"add_tool_tip\")}/>\r\n                              </DataViewHeaderAction>\r\n                            )}\r\n\r\n                            {isDelButton && !!selectedRow && (\r\n                              <DataViewHeaderAction\r\n                                className=\"deleteRow isRedHover\"\r\n                                onMouseDown={onDeleteRowClickEvt}\r\n                                onShortcut={onDeleteRowClickEvt}\r\n                                shortcutPredicate={isDeleteRecordShortcut}\r\n                              >\r\n                                <Icon\r\n                                  src=\"./icons/minus.svg\"\r\n                                  tooltip={T(\"Delete\", \"delete_tool_tip\")}\r\n                                />\r\n                              </DataViewHeaderAction>\r\n                            )}\r\n\r\n                            {isCopyButton && !!selectedRow && (\r\n                              <DataViewHeaderAction\r\n                                className=\"copyRow isOrangeHover\"\r\n                                onMouseDown={onCopyRowClickEvt}\r\n                                onShortcut={onCopyRowClickEvt}\r\n                                shortcutPredicate={isDuplicateRecordShortcut}\r\n                              >\r\n                                <Icon\r\n                                  src=\"./icons/duplicate.svg\"\r\n                                  tooltip={T(\"Duplicate\", \"add_duplicate_tool_tip\")}\r\n                                />\r\n                              </DataViewHeaderAction>\r\n                            )}\r\n                          </DataViewHeaderGroup>\r\n                        }\r\n                      </div>\r\n                      {dataView.isFormViewActive() &&\r\n                        <DataViewHeaderGroup noShrink={true}>\r\n                          <DataViewHeaderAction onMouseDown={onPrevRowClickEvt}>\r\n                            <Icon\r\n                              src=\"./icons/list-arrow-previous.svg\"\r\n                              tooltip={T(\"Previous\", \"move_prev_tool_tip\")}\r\n                            />\r\n                          </DataViewHeaderAction>\r\n                          <DataViewHeaderAction onMouseDown={onNextRowClickEvt}>\r\n                            <Icon\r\n                              src=\"./icons/list-arrow-next.svg\"\r\n                              tooltip={T(\"Next\", \"move_next_tool_tip\")}\r\n                            />\r\n                          </DataViewHeaderAction>\r\n                        </DataViewHeaderGroup>\r\n                      }\r\n                      {dataView.isTableViewActive() &&\r\n                        <DataViewHeaderGroup noShrink={true}>\r\n                          <DataViewHeaderAction\r\n                            onMouseDown={() => this.onFilterButtonClick()}\r\n                            shortcutPredicate={isFilterRecordShortcut}\r\n                            isActive={isFilterSettingsVisible}\r\n                            className={\"test-filter-button\"}\r\n                          >\r\n                            <Icon\r\n                              src=\"./icons/search-filter.svg\"\r\n                              tooltip={T(\"Filter\", \"filter_tool_tip\")}\r\n                            />\r\n                          </DataViewHeaderAction>\r\n                          <FilterDropDown ctx={dataView}/>\r\n                        </DataViewHeaderGroup>\r\n                      }\r\n\r\n                      <DataViewHeaderGroup noShrink={true}>\r\n                        <Dropdowner\r\n                          trigger={({refTrigger, setDropped}) => (\r\n                            <DataViewHeaderAction\r\n                              className={\"threeDotMenu\"}\r\n                              refDom={refTrigger}\r\n                              onMouseDown={() => setDropped(true)}\r\n                              isActive={false}\r\n                            >\r\n                              <Icon\r\n                                src=\"./icons/dot-menu.svg\"\r\n                                tooltip={T(\"Tools\", \"tools_tool_tip\")}\r\n                              />\r\n                            </DataViewHeaderAction>\r\n                          )}\r\n                          content={({setDropped}) => (\r\n                            <Dropdown>\r\n                              <DropdownItem\r\n                                onClick={(event: any) => {\r\n                                  setDropped(false);\r\n                                  onExportToExcelClickEvt(event);\r\n                                }}\r\n                              >\r\n                                {T(\"Export to Excel\", \"excel_tool_tip\")}\r\n                              </DropdownItem>\r\n                              <DropdownItem\r\n                                id={\"columnConfigItem\"}\r\n                                onClick={(event: any) => {\r\n                                  setDropped(false);\r\n                                  this.onColumnConfigurationClick();\r\n                                }}\r\n                              >\r\n                                {T(\"Column configuration\", \"column_config_tool_tip\")}\r\n                              </DropdownItem>\r\n                              {!isDialog && (\r\n                                <DropdownItem\r\n                                  isDisabled={false}\r\n                                  onClick={(event: any) => {\r\n                                    setDropped(false);\r\n                                    this.onRecordInfoClick(dataView);\r\n                                  }}\r\n                                >\r\n                                  {T(\"Show record information\", \"info_button_tool_tip\")}\r\n                                </DropdownItem>\r\n                              )}\r\n                              {customTableConfigsExist && [\r\n                                <DropdownItem\r\n                                  isDisabled={false}\r\n                                  isSelected={\r\n                                    configurationManager.defaultTableConfiguration.isActive\r\n                                  }\r\n                                  onClick={async (event: any) => {\r\n                                    setDropped(false);\r\n                                    configurationManager.activeTableConfiguration =\r\n                                      configurationManager.defaultTableConfiguration;\r\n                                    await saveColumnConfigurationsAsync(configurationManager);\r\n                                  }}\r\n                                >\r\n                                  {T(\"Default View\", \"default_grid_view_view\")}\r\n                                </DropdownItem>,\r\n                                ...configurationManager.customTableConfigurations.map(\r\n                                  (tableConfig) => (\r\n                                    <DropdownItem\r\n                                      key={tableConfig.id}\r\n                                      isDisabled={false}\r\n                                      isSelected={tableConfig.isActive}\r\n                                      onClick={async (event: any) => {\r\n                                        setDropped(false);\r\n                                        configurationManager.activeTableConfiguration = tableConfig;\r\n                                        await saveColumnConfigurationsAsync(configurationManager);\r\n                                      }}\r\n                                    >\r\n                                      {tableConfig.name}\r\n                                    </DropdownItem>\r\n                                  )\r\n                                ),\r\n                                <DropdownItem\r\n                                  isDisabled={false}\r\n                                  onClick={async (event: any) => {\r\n                                    setDropped(false);\r\n                                    await saveColumnConfigurationsAsync(configurationManager);\r\n                                  }}\r\n                                >\r\n                                  {T(\"Save View\", \"save_current_column_config\")}\r\n                                </DropdownItem>,\r\n                                <DropdownItem\r\n                                  isDisabled={\r\n                                    configurationManager.defaultTableConfiguration.isActive\r\n                                  }\r\n                                  onClick={async (event: any) => {\r\n                                    setDropped(false);\r\n                                    await configurationManager.deleteActiveTableConfiguration();\r\n                                  }}\r\n                                >\r\n                                  {T(\"Delete View\", \"delete_current_column_config\")}\r\n                                </DropdownItem>,\r\n                              ]}\r\n                              {this.relevantMenuActions.length > 0 && <DropdownDivider/>}\r\n                              {this.renderMenuActions({setMenuDropped: setDropped})}\r\n                            </Dropdown>\r\n                          )}\r\n                        />\r\n                      </DataViewHeaderGroup>\r\n                    </>\r\n                  }\r\n                </DataViewHeader>\r\n              )}\r\n            </Observer>\r\n          );\r\n        }}\r\n      </Measure>\r\n    );\r\n  }\r\n}\r\n\r\nexport function MobileDataViewHeader(props: { isVisible: boolean }) {\r\n  const extension = useContext(CtxDataViewHeaderExtension);\r\n  return <DataViewHeaderInner isVisible={props.isVisible} extension={extension}/>;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { CDataViewHeader } from \"gui/connections/CDataViewHeader\";\r\nimport { inject, Observer, observer, Provider } from \"mobx-react\";\r\nimport { getIsDataViewOrFormScreenWorkingDelayed } from \"model/selectors/DataView/getIsDataViewOrFormScreenWorking\";\r\nimport React, { createContext, ReactNode, useState } from \"react\";\r\nimport { IDataView } from \"../../../model/entities/types/IDataView\";\r\nimport { getDataViewById } from \"../../../model/selectors/DataView/getDataViewById\";\r\nimport S from \"./DataView.module.css\";\r\nimport { DataViewLoading } from \"./DataViewLoading\";\r\nimport { scopeFor } from \"dic/Container\";\r\nimport { IDataViewBodyUI } from \"modules/DataView/DataViewUI\";\r\nimport { TreeView } from \"./TreeView\";\r\nimport { observable } from \"mobx\";\r\nimport { getIsDataViewOrFormScreenWorking } from \"model/selectors/DataView/getIsDataViewOrFormScreenWorking.1\";\r\nimport { PubSub } from \"utils/events\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\nimport { MobileDataViewHeader } from \"gui/connections/MobileComponents/Grid/DataViewHeader\";\r\n\r\nexport interface IDataViewHeaderExtensionItem {\r\n  $iid: number;\r\n  group: string;\r\n\r\n  render(): ReactNode;\r\n}\r\n\r\nexport class DataViewHeaderExtension {\r\n  @observable items = new Map<number, IDataViewHeaderExtensionItem>();\r\n\r\n  put(item: IDataViewHeaderExtensionItem) {\r\n    this.items.set(item.$iid, item);\r\n  }\r\n\r\n  del(item: { $iid: number }) {\r\n    this.items.delete(item.$iid);\r\n  }\r\n\r\n  render(group: string) {\r\n    return (\r\n      <Observer>\r\n        {() => (\r\n          <>\r\n            {Array.from(this.items)\r\n              .filter(([iid, item]) => item.group === group)\r\n              .map(([iid, item]) => (\r\n                <Observer key={iid}>{() => <>{item.render()}</>}</Observer>\r\n              ))}\r\n          </>\r\n        )}\r\n      </Observer>\r\n    );\r\n  }\r\n}\r\n\r\nexport const CtxDataViewHeaderExtension = createContext<DataViewHeaderExtension>(\r\n  new DataViewHeaderExtension()\r\n);\r\n\r\ninterface IDataViewProps {\r\n  id: string;\r\n  modelInstanceId: string;\r\n  height?: number;\r\n  width?: number;\r\n  isHeadless: boolean;\r\n  dataView?: IDataView;\r\n}\r\n\r\n@inject(({formScreen}, {id}) => {\r\n  const dataView = getDataViewById(formScreen, id);\r\n  return {\r\n    dataView,\r\n  };\r\n})\r\n@observer\r\nexport class DataViewInner extends React.Component<IDataViewProps> {\r\n  dataViewHeaderExtension = new DataViewHeaderExtension();\r\n\r\n  getDataViewStyle() {\r\n    if (this.props.height !== undefined || this.props.width !== undefined) {\r\n      return {\r\n        flexGrow: 0,\r\n        minHeight: this.props.height,\r\n        minWidth: this.props.width,\r\n      };\r\n    } else {\r\n      return {\r\n        flexGrow: 1,\r\n        flexShrink: 0,\r\n        // width: \"100%\",\r\n        // height: \"100%\"\r\n      };\r\n    }\r\n  }\r\n\r\n  renderUiBodyWithHeader() {\r\n    const $cont = scopeFor(this.props.dataView);\r\n    const uiBody = $cont && $cont.resolve(IDataViewBodyUI);\r\n    const isWorking = getIsDataViewOrFormScreenWorking(this.props.dataView);\r\n    return (\r\n      <>\r\n        <div className={S.overlayContainer}>\r\n          {isMobileLayoutActive(this.props.dataView)\r\n            ? <MobileDataViewHeader isVisible={!this.props.isHeadless}/>\r\n            : <CDataViewHeader isVisible={!this.props.isHeadless}/>\r\n          }\r\n\r\n          {isWorking && <DataViewLoading/>}\r\n        </div>\r\n        <div className={S.dataViewContentContainer}>{uiBody && uiBody.render()}</div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    if(!this.props.dataView){\r\n      return null;\r\n    }\r\n    // TODO: Move styling to stylesheet\r\n    const isWorkingDelayed = getIsDataViewOrFormScreenWorkingDelayed(this.props.dataView);\r\n\r\n    return (\r\n      <CtxDataViewHeaderExtension.Provider value={this.dataViewHeaderExtension}>\r\n        <Provider dataView={this.props.dataView}>\r\n          <div className={S.dataView} style={this.getDataViewStyle()} id={\"dataView_\" + this.props.modelInstanceId}>\r\n            {this.props.dataView?.type === \"TreePanel\" ? (\r\n              <TreeView dataView={this.props.dataView}/>\r\n            ) : (\r\n              this.renderUiBodyWithHeader()\r\n            )}\r\n\r\n            {isWorkingDelayed && <DataViewLoading/>}\r\n          </div>\r\n        </Provider>\r\n      </CtxDataViewHeaderExtension.Provider>\r\n    );\r\n  }\r\n}\r\n\r\nexport class DataViewContext {\r\n  private tableKeyDownChannel = new PubSub();\r\n\r\n  subscribeTableKeyDownHandler(fn: (event: any) => void) {\r\n    return this.tableKeyDownChannel.subscribe(fn);\r\n  }\r\n\r\n  handleTableKeyDown(event: any) {\r\n    this.tableKeyDownChannel.trigger(event);\r\n  }\r\n}\r\n\r\nexport const CtxDataView = createContext<DataViewContext | undefined>(undefined);\r\n\r\nexport function DataView(props: IDataViewProps) {\r\n  const [context] = useState(() => new DataViewContext());\r\n  return (\r\n    <CtxDataView.Provider value={context}>\r\n      <DataViewInner {...props} />\r\n    </CtxDataView.Provider>\r\n  );\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getIsDataViewWorking } from \"./getIsDataViewWorking\";\r\nimport { getFormScreenLifecycle } from \"../FormScreen/getFormScreenLifecycle\";\r\n\r\n\r\nexport function getIsDataViewOrFormScreenWorking(ctx: any) {\r\n  return getIsDataViewWorking(ctx) || getFormScreenLifecycle(ctx).isWorking;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getIsDataViewWorking } from \"./getIsDataViewWorking\";\r\nimport { getIsFormScreenWorkingDelayed } from \"../FormScreen/getIsFormScreenWorking\";\r\n\r\nexport function getIsDataViewOrFormScreenWorkingDelayed(ctx: any) {\r\n  return getIsDataViewWorking(ctx) || getIsFormScreenWorkingDelayed(ctx);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { PropsWithChildren, useContext } from \"react\";\r\nimport S from \"gui/Components/DataViewHeader/DataViewHeaderAction.module.scss\";\r\nimport cx from \"classnames\";\r\nimport { action } from \"mobx\";\r\nimport { CtxDataView, DataViewContext } from \"../ScreenElements/DataView\";\r\n\r\ninterface IDataViewHeaderActionProps {\r\n  onMouseDown?(event: any): void;\r\n\r\n  onClick?(event: any): void;\r\n\r\n  className?: string;\r\n  isActive?: boolean;\r\n  isDisabled?: boolean;\r\n  refDom?: any;\r\n\r\n  onShortcut?(event: any): void;\r\n\r\n  shortcutPredicate?(event: any): boolean;\r\n}\r\n\r\nexport class DataViewHeaderActionInner extends React.Component<IDataViewHeaderActionProps & { dataViewContext?: DataViewContext }> {\r\n  @action.bound\r\n  handleMouseDown(event: any) {\r\n    if (!this.props.isDisabled && this.props.onMouseDown) {\r\n      this.props.onMouseDown(event);\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  handleClick(event: any) {\r\n    if (!this.props.isDisabled && this.props.onClick) {\r\n      this.props.onClick(event);\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  handleTriggerAreaKeyDown(event: any) {\r\n    if (this.props.shortcutPredicate?.(event)) {\r\n      event.preventDefault();\r\n      this.props.onShortcut?.(event);\r\n    }\r\n  }\r\n\r\n  _disposer: any;\r\n\r\n  kbdHandlerUp() {\r\n    this._disposer?.();\r\n    if (this.props.dataViewContext) {\r\n      this._disposer = this.props.dataViewContext.subscribeTableKeyDownHandler(\r\n        this.handleTriggerAreaKeyDown\r\n      );\r\n    }\r\n  }\r\n\r\n  kbdHandlerDown() {\r\n    this._disposer?.();\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (this.props.onShortcut && this.props.shortcutPredicate) {\r\n      this.kbdHandlerUp();\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(prevProps: any) {\r\n    if (\r\n      (!prevProps.onShortcut || !prevProps.shortcutPredicate) &&\r\n      this.props.onShortcut &&\r\n      this.props.shortcutPredicate\r\n    ) {\r\n      this.kbdHandlerUp();\r\n    } else if (\r\n      prevProps.onShortcut &&\r\n      prevProps.shortcutPredicate &&\r\n      (!this.props.onShortcut || !this.props.shortcutPredicate)\r\n    ) {\r\n      this.kbdHandlerDown();\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.kbdHandlerDown();\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div\r\n        className={cx(\r\n          S.root,\r\n          this.props.className,\r\n          {isActive: this.props.isActive},\r\n          this.props.isDisabled ? S.isDisabled : \"\"\r\n        )}\r\n        onMouseDown={this.handleMouseDown}\r\n        onClick={this.handleClick}\r\n        ref={this.props.refDom}\r\n      >\r\n        {this.props.children}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport function DataViewHeaderAction(props: PropsWithChildren<IDataViewHeaderActionProps>) {\r\n  const dataViewContext = useContext(CtxDataView);\r\n  return <DataViewHeaderActionInner {...props} dataViewContext={dataViewContext}/>;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { ContribArray } from \"utils/common\";\r\nimport bind from \"bind-decorator\";\r\n\r\nexport interface IPerspectiveContrib {\r\n  deactivate(): Generator;\r\n\r\n  activateDefault(): Generator;\r\n}\r\n\r\nexport class Perspective {\r\n  contrib = new ContribArray<IPerspectiveContrib>();\r\n\r\n  @bind\r\n  *deactivate() {\r\n    for (let c of this.contrib) {\r\n      yield*c.deactivate();\r\n    }\r\n  }\r\n\r\n  @bind\r\n  *activateDefault() {\r\n    for (let c of this.contrib) {\r\n      yield*c.activateDefault();\r\n    }\r\n  }\r\n\r\n}\r\n\r\nexport const IPerspective = TypeSymbol<Perspective>(\"IPerspective\");","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action, computed, flow, reaction } from \"mobx\";\r\nimport { parse as wktParse, stringify as wktStringify } from \"wkt\";\r\nimport { getDataSourceFieldIndexByName } from \"model/selectors/DataSources/getDataSourceFieldIndexByName\";\r\nimport { MapRootStore } from \"./MapRootStore\";\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\nimport { getDataViewPropertyById } from \"model/selectors/DataView/getDataViewPropertyById\";\r\nimport { onFieldChangeG } from \"model/actions-ui/DataView/TableView/onFieldChange\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport _ from \"lodash\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\n\r\nexport class MapObjectsStore {\r\n  constructor(private root: MapRootStore) {\r\n  }\r\n\r\n  get dataView() {\r\n    return this.root.dataView;\r\n  }\r\n\r\n  get setup() {\r\n    return this.root.mapSetupStore;\r\n  }\r\n\r\n  get search() {\r\n    return this.root.mapSearchStore;\r\n  }\r\n\r\n  get navigationStore() {\r\n    return this.root.mapNavigationStore;\r\n  }\r\n\r\n  @computed get fldLocationIndex() {\r\n    return this.setup.mapLocationMember\r\n      ? getDataSourceFieldIndexByName(this.dataView, this.setup.mapLocationMember)\r\n      : undefined;\r\n  }\r\n\r\n  @computed get fldNameIndex() {\r\n    return this.setup.mapTextMember\r\n      ? getDataSourceFieldIndexByName(this.dataView, this.setup.mapTextMember)\r\n      : undefined;\r\n  }\r\n\r\n  @computed get fldIconIndex() {\r\n    return this.setup.mapIconMember\r\n      ? getDataSourceFieldIndexByName(this.dataView, this.setup.mapIconMember)\r\n      : undefined;\r\n  }\r\n\r\n  @computed get fldIconAzimuth() {\r\n    return this.setup.mapAzimuthMember\r\n      ? getDataSourceFieldIndexByName(this.dataView, this.setup.mapAzimuthMember)\r\n      : undefined;\r\n  }\r\n\r\n  @computed get fldColorIndex() {\r\n    return this.setup.mapColorMember\r\n      ? getDataSourceFieldIndexByName(this.dataView, this.setup.mapColorMember)\r\n      : undefined;\r\n  }\r\n\r\n  @computed get fldIdentifier() {\r\n    return getDataSourceFieldIndexByName(this.dataView, \"Id\");\r\n  }\r\n\r\n  @computed\r\n  get mapObjects() {\r\n    if (this.fldIdentifier === undefined) {\r\n      return [];\r\n    }\r\n    const result: IMapObject[] = [];\r\n    if (this.setup.isReadOnlyView) {\r\n      const tableRows = this.dataView.tableRows;\r\n\r\n      for (let row of tableRows) {\r\n        if (_.isArray(row) && this.fldLocationIndex !== undefined && row[this.fldLocationIndex]) {\r\n          const objectGeoJson = wktParse(row[this.fldLocationIndex]);\r\n          if (objectGeoJson)\r\n            result.push({\r\n              ...objectGeoJson,\r\n              id: row[this.fldIdentifier],\r\n              name: this.fldNameIndex !== undefined ? row[this.fldNameIndex] : \"\",\r\n              icon: this.fldIconIndex !== undefined ? row[this.fldIconIndex] : undefined,\r\n              color: this.fldColorIndex !== undefined ? row[this.fldColorIndex] : undefined,\r\n              azimuth: this.fldIconAzimuth !== undefined ? row[this.fldIconAzimuth] : undefined,\r\n            });\r\n        }\r\n      }\r\n    } else {\r\n      let selectedRow = getSelectedRow(this.dataView);\r\n      if (selectedRow) {\r\n        const row = selectedRow;\r\n        if (_.isArray(row) && this.fldLocationIndex && row[this.fldLocationIndex]) {\r\n          let objectGeoJson: any;\r\n          try {\r\n            objectGeoJson = wktParse(row[this.fldLocationIndex]);\r\n          } catch (e) {\r\n            // TODO: Erorr dialog?\r\n            console.error(e); // eslint-disable-line no-console\r\n          }\r\n          if (objectGeoJson) {\r\n            result.push({\r\n              ...objectGeoJson,\r\n              id: row[this.fldIdentifier],\r\n              name: this.fldNameIndex !== undefined ? row[this.fldNameIndex] : \"\",\r\n              icon: this.fldIconIndex && row[this.fldIconIndex],\r\n              color: this.fldColorIndex !== undefined ? row[this.fldColorIndex] : undefined,\r\n              azimuth: this.fldIconAzimuth && row[this.fldIconAzimuth],\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  @action.bound\r\n  handleGeometryChange(geoJson: any) {\r\n    const self = this;\r\n    return flow(function*() {\r\n      const property = getDataViewPropertyById(self.dataView, self.setup.mapLocationMember);\r\n      const selectedRow = getSelectedRow(self.dataView);\r\n      if (property && selectedRow) {\r\n        yield*onFieldChangeG(self.dataView)({\r\n          event: undefined,\r\n          row: selectedRow,\r\n          property: property,\r\n          value: geoJson ? wktStringify(geoJson) : null,\r\n        });\r\n        getDataTable(self.dataView).flushFormToTable(selectedRow);\r\n        yield*getFormScreenLifecycle(self.dataView).onFlushData();\r\n      }\r\n    })();\r\n  }\r\n\r\n  @action.bound\r\n  handleLayerClick(id: string) {\r\n    if (this.setup.isReadOnlyView) {\r\n      getDataView(this.dataView).setSelectedRowId(id);\r\n      this.search.selectSearchResultById(id);\r\n      this.navigationStore.highlightSelectedSearchResult();\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  handleMapMounted() {\r\n    return reaction(\r\n      () => getSelectedRowId(this.dataView),\r\n      (rowId: string | undefined) => {\r\n        if (this.setup.isReadOnlyView && rowId) {\r\n          this.search.selectSearchResultById(rowId);\r\n          this.navigationStore.highlightSelectedSearchResult();\r\n        }\r\n      },\r\n      {fireImmediately: true}\r\n    );\r\n  }\r\n}\r\n\r\nexport enum IMapObjectType {\r\n  POINT = \"Point\",\r\n  POLYGON = \"Polygon\",\r\n  LINESTRING = \"LineString\",\r\n}\r\n\r\nexport interface IMapObjectBase {\r\n  id: string;\r\n  name: string;\r\n  icon: string;\r\n  color: number | undefined;\r\n  azimuth: number;\r\n}\r\n\r\nexport interface IMapPoint extends IMapObjectBase {\r\n  type: IMapObjectType.POINT;\r\n  coordinates: [number, number];\r\n}\r\n\r\nexport interface IMapPolygon extends IMapObjectBase {\r\n  type: IMapObjectType.POLYGON;\r\n  coordinates: [number, number][][];\r\n}\r\n\r\nexport interface IMapPolyline extends IMapObjectBase {\r\n  type: IMapObjectType.LINESTRING;\r\n  coordinates: [number, number][][];\r\n}\r\n\r\nexport type IMapObject = IMapPoint | IMapPolygon | IMapPolyline;\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { observable } from \"mobx\";\r\nimport { getIdent, IIId } from \"utils/common\";\r\nimport { IPerspective, IPerspectiveContrib } from \"../Perspective\";\r\nimport bind from \"bind-decorator\";\r\nimport { IPanelViewType } from \"model/entities/types/IPanelViewType\";\r\nimport { IViewConfiguration } from \"modules/DataView/ViewConfiguration\";\r\n\r\nexport class MapPerspective implements IIId, IPerspectiveContrib {\r\n  $iid = getIdent();\r\n\r\n  constructor(\r\n    public perspective = IPerspective(),\r\n    public viewConfiguration = IViewConfiguration()\r\n  ) {\r\n  }\r\n\r\n  @observable isActive = false;\r\n\r\n  @bind\r\n  *handleToolbarBtnClick() {\r\n    if (this.isActive) return;\r\n    yield*this.perspective.deactivate();\r\n    this.isActive = true;\r\n    yield*this.viewConfiguration.anounceActivePerspective(IPanelViewType.Map);\r\n  }\r\n\r\n  @bind\r\n  *deactivate() {\r\n    this.isActive = false;\r\n  }\r\n\r\n  @bind\r\n  *activateDefault() {\r\n    if (this.viewConfiguration.activePerspective === IPanelViewType.Map) this.isActive = true;\r\n  }\r\n}\r\n\r\nexport const IMapPerspective = TypeSymbol<MapPerspective>(\"IMapPerspective\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport cx from \"classnames\";\r\nimport L from \"leaflet\";\r\nimport \"leaflet-draw/dist/leaflet.draw-src.js\";\r\nimport \"leaflet-draw/dist/leaflet.draw-src.css\";\r\nimport \"leaflet/dist/leaflet.css\";\r\nimport { action, autorun, computed, observable, reaction, runInAction } from \"mobx\";\r\nimport qs from \"querystring\";\r\nimport React from \"react\";\r\nimport S from \"./MapPerspectiveUI.module.scss\";\r\nimport { IMapObject, IMapObjectType } from \"./stores/MapObjectsStore\";\r\nimport { MapLayer } from \"./stores/MapSetupStore\";\r\nimport Measure, { ContentRect } from \"react-measure\";\r\nimport { flashColor2htmlColor } from \"utils/flashColorFormat\";\r\nimport { ring as area } from \"@mapbox/geojson-area\";\r\n\r\ndelete (L.Icon.Default.prototype as any)._getIconUrl;\r\n\r\nL.Icon.Default.mergeOptions({\r\n  iconRetinaUrl: require(\"leaflet/dist/images/marker-icon-2x.png\"),\r\n  iconUrl: require(\"leaflet/dist/images/marker-icon.png\"),\r\n  shadowUrl: require(\"leaflet/dist/images/marker-shadow.png\"),\r\n});\r\n\r\ninterface IMapPerspectiveComProps {\r\n  mapCenter: { type: \"Point\"; coordinates: [number, number] } | undefined;\r\n  initialZoom: number | undefined;\r\n  getMapObjects: () => IMapObject[];\r\n  getRoutefinderRoute: () => any[];\r\n  getRoutefinderEditables: () => any[];\r\n  lastDetailedObject?: IMapObject;\r\n  mapLayers: MapLayer[];\r\n  isReadOnly: boolean;\r\n  isActive: boolean;\r\n\r\n  onChange?(geoJson: any): void;\r\n\r\n  onLayerClick?(id: string): void;\r\n\r\n  onRoutefinderGeometryChange?(obj: any): void;\r\n\r\n  onRoutefinderGeometryEditStart?(): void;\r\n\r\n  onRoutefinderGeometryEditSave?(): void;\r\n\r\n  onRoutefinderGeometryEditCancel?(): void;\r\n}\r\n\r\nconst MAP_ANIMATE_SETTING = {\r\n  animate: true,\r\n  duration: 1.1,\r\n};\r\n\r\nfunction getOptionsEPSG(options: any) {\r\n  switch (options.crs?.toUpperCase()) {\r\n    case \"EPSG4326\":\r\n      return L.CRS.EPSG4326;\r\n  }\r\n  return undefined;\r\n}\r\n\r\nexport class MapPerspectiveCom extends React.Component<IMapPerspectiveComProps> {\r\n  elmMapDiv: HTMLDivElement | null = null;\r\n  refMapDiv = (elm: any) => (this.elmMapDiv = elm);\r\n\r\n  leafletMap?: L.DrawMap;\r\n\r\n  leafletMapObjects = new L.FeatureGroup();\r\n  leafletMapRoute = new L.FeatureGroup();\r\n\r\n  editingObjectsRepaintDisabled = false;\r\n\r\n  _disposers: any[] = [];\r\n\r\n  panToCenter() {\r\n    if (this.props.mapCenter) {\r\n      this.leafletMap?.panTo(\r\n        [this.props.mapCenter.coordinates[1], this.props.mapCenter.coordinates[0]],\r\n        {...MAP_ANIMATE_SETTING}\r\n      );\r\n    } else {\r\n      this.leafletMap?.panTo([0, 0], {...MAP_ANIMATE_SETTING});\r\n    }\r\n  }\r\n\r\n  panToLoc(loc: [number, number]) {\r\n    this.leafletMap?.panTo(loc, {...MAP_ANIMATE_SETTING});\r\n  }\r\n\r\n  panToSelectedObject() {\r\n    for (let [obj, lLayer] of this.mapDrawnObjectLayers) {\r\n      if (obj.id === this.props.lastDetailedObject?.id) {\r\n        this.panToLayer(lLayer);\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  panToLayer(lLayer: L.Layer) {\r\n    if ((lLayer as any).getBounds) {\r\n      const bounds = (lLayer as any).getBounds() as L.LatLngBounds;\r\n      this.leafletMap?.fitBounds(bounds.pad(0.1), {...MAP_ANIMATE_SETTING});\r\n    } else if ((lLayer as any).getLatLng) {\r\n      const latLng = (lLayer as any).getLatLng();\r\n      this.leafletMap?.panTo(latLng, {...MAP_ANIMATE_SETTING});\r\n    }\r\n  }\r\n\r\n  panToFirstObject() {\r\n    if (this.mapDrawnObjectLayers.length > 0) {\r\n      this.panToLayer(this.mapDrawnObjectLayers[0][1]);\r\n    }\r\n  }\r\n\r\n  isPropMapCenterDifferent(prevProps: IMapPerspectiveComProps) {\r\n    return (\r\n      this.props.mapCenter?.coordinates[0] !== prevProps.mapCenter?.coordinates[0] ||\r\n      this.props.mapCenter?.coordinates[1] !== prevProps.mapCenter?.coordinates[1]\r\n    );\r\n  }\r\n\r\n  isPropActiveDifferent(prevProps: IMapPerspectiveComProps) {\r\n    return this.props.isActive !== prevProps.isActive;\r\n  }\r\n\r\n  componentDidUpdate(prevProps: IMapPerspectiveComProps) {\r\n    runInAction(() => {\r\n      if (this.isPropActiveDifferent(prevProps)) {\r\n        if (this.props.isActive) {\r\n          this.mountLeaflet();\r\n        } else {\r\n          //this.unmountLeaflet();\r\n        }\r\n      }\r\n      if (this.isPropMapCenterDifferent(prevProps)) {\r\n        this.panToCenter();\r\n      }\r\n      /*const { lastDetailedObject } = this.props;\r\n      if (\r\n        lastDetailedObject &&\r\n        (!prevProps.lastDetailedObject ||\r\n          !_.isEqual(lastDetailedObject, prevProps.lastDetailedObject))\r\n      ) {\r\n        this.panToSelectedObject();\r\n        this.highlightSelectedLayer();\r\n      }\r\n      if (!lastDetailedObject && prevProps.lastDetailedObject) {\r\n        this.highlightSelectedLayer();\r\n      }*/\r\n    });\r\n  }\r\n\r\n  highlightLayer(obj: IMapObject, lLayer: L.Layer) {\r\n    if ((lLayer as any).setStyle) {\r\n      (lLayer as any).setStyle({color: \"yellow\"});\r\n    }\r\n    if ((lLayer as any).setIcon) {\r\n      (lLayer as any).setIcon(\r\n        L.divIcon({\r\n          ...(lLayer as any).getIcon().options,\r\n          className: \"markerHighlighted\",\r\n        })\r\n      );\r\n    }\r\n  }\r\n\r\n  unHighlightLayer(obj: IMapObject, lLayer: L.Layer) {\r\n    if ((lLayer as any).setStyle) {\r\n      (lLayer as any).setStyle({\r\n        color:\r\n          obj.color !== undefined && obj.color !== 0 && obj.color !== null\r\n            ? flashColor2htmlColor(obj.color)\r\n            : \"blue\",\r\n      });\r\n    }\r\n    if ((lLayer as any).setIcon) {\r\n      (lLayer as any).setIcon(\r\n        L.divIcon({\r\n          ...(lLayer as any).getIcon().options,\r\n          className: \"\",\r\n        })\r\n      );\r\n    }\r\n  }\r\n\r\n  highlightSelectedLayer() {\r\n    for (let [obj, lLayer] of this.mapDrawnObjectLayers) {\r\n      if (obj.id === this.props.lastDetailedObject?.id) {\r\n        this.highlightLayer(obj, lLayer);\r\n      } else {\r\n        this.unHighlightLayer(obj, lLayer);\r\n      }\r\n    }\r\n  }\r\n\r\n  @computed get layerList() {\r\n    return this.props.mapLayers\r\n      .map((rawLayer, index) => {\r\n        if (rawLayer.type === \"OSM\") {\r\n          return [\r\n            rawLayer,\r\n            L.tileLayer(rawLayer.getUrl(), {...rawLayer.getOptions(), zIndex: index}),\r\n          ];\r\n        } else if (rawLayer.type === \"WMS\") {\r\n          return [\r\n            rawLayer,\r\n            L.tileLayer.wms(rawLayer.getUrl(), {\r\n              ...rawLayer.getOptions(),\r\n              zIndex: index,\r\n              crs: getOptionsEPSG(rawLayer.getOptions()),\r\n            }),\r\n          ];\r\n        }\r\n        return undefined;\r\n      })\r\n      .filter((layer) => layer) as [MapLayer, L.TileLayer][];\r\n  }\r\n\r\n  @computed get leafletlayersDescriptor() {\r\n    return Object.fromEntries(\r\n      this.layerList.map((layer) => {\r\n        return [layer[0].getTitle(), layer[1]];\r\n      })\r\n    );\r\n  }\r\n\r\n  @computed get mapDrawnObjectLayers() {\r\n    return this.props\r\n      .getMapObjects()\r\n      .map((obj) => {\r\n        let result: [IMapObject, L.Layer];\r\n        switch (obj.type) {\r\n          case IMapObjectType.POINT: {\r\n            const iconUrl = obj.icon || \"img/map/marker-icon.png#anchor=[12,41]\";\r\n            const pq = iconUrl ? qs.parse(iconUrl.split(\"#\")[1] || \"\") : null;\r\n            const anchor = pq?.anchor ? JSON.parse(pq.anchor as string) : [0, 0];\r\n            const iconAnchor: [number, number] = anchor;\r\n            const iconRotation = obj.azimuth || 0;\r\n            const myIcon = L.divIcon({\r\n              html: `<img src=\"${iconUrl}\" style=\"\r\n                transform: rotate3d(0,0,1,${iconRotation}deg);\r\n                transform-origin: ${iconAnchor[0]}px ${iconAnchor[1]}px;\" />`,\r\n              // iconSize: [38, 95],\r\n              iconAnchor,\r\n              className: \"\",\r\n              //popupAnchor: [-3, -76],\r\n            });\r\n            result = [\r\n              obj,\r\n              L.marker([obj.coordinates[1], obj.coordinates[0]], {\r\n                icon: myIcon,\r\n              }).bindTooltip(obj.name),\r\n            ];\r\n          }\r\n            break;\r\n          case IMapObjectType.POLYGON:\r\n            result = [\r\n              obj,\r\n              L.polygon(\r\n                obj.coordinates[0].map((coords) => [coords[1], coords[0]]),\r\n                {\r\n                  color:\r\n                    obj.color !== undefined && obj.color !== 0 && obj.color !== null\r\n                      ? flashColor2htmlColor(obj.color)\r\n                      : \"blue\",\r\n                }\r\n              ).bindTooltip(obj.name),\r\n            ];\r\n            break;\r\n          case IMapObjectType.LINESTRING:\r\n            result = [\r\n              obj,\r\n              L.polyline(\r\n                obj.coordinates.map((coords) => [coords[1], coords[0]]),\r\n                {\r\n                  color:\r\n                    obj.color !== undefined && obj.color !== 0 && obj.color !== null\r\n                      ? flashColor2htmlColor(obj.color)\r\n                      : \"blue\",\r\n                }\r\n              ).bindTooltip(obj.name),\r\n            ];\r\n            break;\r\n        }\r\n        return result;\r\n      })\r\n      .filter((layer) => layer) as [IMapObject, L.Layer][];\r\n  }\r\n\r\n  @computed get mapRoutefinderRoute() {\r\n    return this.props\r\n      .getRoutefinderRoute()\r\n      .map((obj) => {\r\n        switch (obj.type) {\r\n          case \"LineString\":\r\n            return L.polyline(\r\n              obj.coordinates.map((coords: any) => [coords[1], coords[0]]),\r\n              {color: \"blue\"}\r\n            );\r\n        }\r\n        return undefined;\r\n      })\r\n      .filter((obj) => obj);\r\n  }\r\n\r\n  @computed get mapRoutefinderEditables() {\r\n    return this.props\r\n      .getRoutefinderEditables()\r\n      .map((obj) => {\r\n        switch (obj.type) {\r\n          case \"LineString\":\r\n            return L.polyline(\r\n              obj.coordinates.map((coords: any) => [coords[1], coords[0]]),\r\n              {color: \"green\", dashArray: \"10 5 3 5\", opacity: 1.0, weight: 1.5}\r\n            );\r\n        }\r\n        return undefined;\r\n      })\r\n      .filter((obj) => obj);\r\n  }\r\n\r\n  @action.bound handleOjectCreated(event: any) {\r\n    const layer = event.layer;\r\n    this.leafletMapObjects.clearLayers();\r\n    this.leafletMapObjects.addLayer(layer);\r\n    const geoJSON = layer.toGeoJSON();\r\n    const geometry = geoJSON.geometry.type === \"Polygon\"\r\n      ? this.getCounterClockWisePolygonPoints(geoJSON.geometry)\r\n      : geoJSON.geometry;\r\n    this.props.onChange?.(geometry);\r\n  }\r\n\r\n  getCounterClockWisePolygonPoints(polygonGeometry: any){\r\n    if(!polygonGeometry || polygonGeometry.coordinates?.length !== 1){\r\n      // eslint-disable-next-line no-console\r\n      console.warn(`Failed to check polygonGeometry:`);\r\n      // eslint-disable-next-line no-console\r\n      console.warn(polygonGeometry);\r\n      return polygonGeometry;\r\n    }\r\n    const polygonArea = area(polygonGeometry.coordinates[0]);\r\n    if(polygonArea > 0) {\r\n      return {\r\n        type: \"Polygon\",\r\n        coordinates: [polygonGeometry.coordinates[0].reverse()]\r\n      };\r\n    }\r\n    return polygonGeometry\r\n  }\r\n\r\n  @action.bound handleObjectEdited(event: any) {\r\n    const layers = (event as any).layers;\r\n    const obj = layers.toGeoJSON().features?.[0]?.geometry;\r\n    if (obj) {\r\n      this.props.onChange?.(obj);\r\n    }\r\n  }\r\n\r\n  @action.bound handleObjectDeleted(event: any) {\r\n    this.props.onChange?.(undefined);\r\n  }\r\n\r\n  @action.bound handleRoutefinderOjectCreated(event: any) {\r\n    const layer = event.layer;\r\n    this.leafletMapObjects.clearLayers();\r\n    this.leafletMapObjects.addLayer(layer);\r\n    const obj = (this.leafletMapObjects as any).toGeoJSON().features?.[0]?.geometry;\r\n    this.routefinderUpdate(obj);\r\n  }\r\n\r\n  @action.bound handleRoutefinderObjectEdited(event: any) {\r\n    const obj = (this.leafletMapObjects as any).toGeoJSON().features?.[0]?.geometry;\r\n    this.routefinderUpdate(obj);\r\n  }\r\n\r\n  @action.bound handleRoutefinderObjectDeleted(event: any) {\r\n    this.routefinderUpdate(undefined);\r\n  }\r\n\r\n  @action.bound handleRoutefinderVertexDrawn(event: any) {\r\n    const obj = {\r\n      type: \"LineString\",\r\n      coordinates: event.layers\r\n        .getLayers()\r\n        .map((layer: any) => [layer.getLatLng().lng, layer.getLatLng().lat]),\r\n    };\r\n    this.routefinderUpdate(obj);\r\n  }\r\n\r\n  @action.bound handleRoutefinderVertexEdited(event: any) {\r\n    const obj = (this.leafletMapObjects as any).toGeoJSON().features?.[0]?.geometry;\r\n    this.routefinderUpdate(obj);\r\n  }\r\n\r\n  @action.bound routefinderUpdate(obj: any) {\r\n    this.props.onRoutefinderGeometryChange?.(obj);\r\n  }\r\n\r\n  @action.bound handleRoutefinderEditStart() {\r\n    this.editingObjectsRepaintDisabled = true;\r\n    this.props.onRoutefinderGeometryEditStart?.();\r\n  }\r\n\r\n  @action.bound handleRoutefinderDrawStart() {\r\n    this.handleRoutefinderEditStart();\r\n  }\r\n\r\n  _isCancelAction = false;\r\n\r\n  @action.bound handleRoutefinderEditStop() {\r\n    this.editingObjectsRepaintDisabled = false;\r\n    if (this._isCancelAction) {\r\n      this.props.onRoutefinderGeometryEditCancel?.();\r\n    } else {\r\n      this.props.onRoutefinderGeometryEditSave?.();\r\n    }\r\n  }\r\n\r\n  @action.bound handleRoutefinderDrawStop() {\r\n    this.handleRoutefinderEditStop();\r\n  }\r\n\r\n  setMapControlCancelHack() {\r\n    /*\r\n      This is need to distinguish between Finish and Cancel button click.\r\n    */\r\n    const self = this;\r\n\r\n    const edit = (this.mapControl! as any)._toolbars.edit;\r\n    const oldEditDisable = edit.disable;\r\n    (this.mapControl! as any)._toolbars.edit.disable = function () {\r\n      self._isCancelAction = true;\r\n      oldEditDisable.apply(edit, arguments);\r\n      self._isCancelAction = false;\r\n    };\r\n\r\n    const draw = (this.mapControl! as any)._toolbars.draw;\r\n    const oldDrawDisable = draw.disable;\r\n    (this.mapControl! as any)._toolbars.draw.disable = function () {\r\n      self._isCancelAction = true;\r\n      oldDrawDisable.apply(draw, arguments);\r\n      self._isCancelAction = false;\r\n    };\r\n  }\r\n\r\n  initLeafletDrawControls() {\r\n    this.activateNormalControls();\r\n  }\r\n\r\n  mapControl: L.Control.Draw | undefined;\r\n  mapControlDisposers: Array<() => void> = [];\r\n\r\n  activateRoutingControls() {\r\n    for (let h of this.mapControlDisposers) h();\r\n    this.mapControlDisposers = [];\r\n    this.leafletMapObjects.clearLayers();\r\n    this.leafletMapRoute.clearLayers();\r\n    this.leafletMap?.addControl(\r\n      (this.mapControl = new L.Control.Draw({\r\n        edit: {\r\n          featureGroup: this.leafletMapObjects,\r\n          poly: {\r\n            allowIntersection: true,\r\n          },\r\n          circle: false,\r\n          circlemarker: false,\r\n        },\r\n        draw: {\r\n          polygon: false,\r\n          point: false,\r\n          marker: false,\r\n          circle: false,\r\n          circlemarker: false,\r\n          rectangle: false,\r\n        },\r\n      } as any)) // \r\n    );\r\n\r\n    this.setMapControlCancelHack();\r\n\r\n    this.leafletMap?.on(L.Draw.Event.CREATED, this.handleRoutefinderOjectCreated);\r\n    this.leafletMap?.on(L.Draw.Event.EDITED, this.handleRoutefinderObjectEdited);\r\n    this.leafletMap?.on(L.Draw.Event.DELETED, this.handleRoutefinderObjectDeleted);\r\n    this.leafletMap?.on(L.Draw.Event.DRAWVERTEX, this.handleRoutefinderVertexDrawn);\r\n    this.leafletMap?.on(L.Draw.Event.EDITVERTEX, this.handleRoutefinderVertexEdited);\r\n\r\n    this.leafletMap?.on(L.Draw.Event.EDITSTART, this.handleRoutefinderEditStart);\r\n    this.leafletMap?.on(L.Draw.Event.EDITSTOP, this.handleRoutefinderEditStop);\r\n    this.leafletMap?.on(L.Draw.Event.DRAWSTART, this.handleRoutefinderDrawStart);\r\n    this.leafletMap?.on(L.Draw.Event.DRAWSTOP, this.handleRoutefinderDrawStop);\r\n\r\n    this.mapControlDisposers.push(() => {\r\n      this.leafletMap?.off(L.Draw.Event.CREATED, this.handleRoutefinderOjectCreated);\r\n      this.leafletMap?.off(L.Draw.Event.EDITED, this.handleRoutefinderObjectEdited);\r\n      this.leafletMap?.off(L.Draw.Event.DELETED, this.handleRoutefinderObjectDeleted);\r\n      this.leafletMap?.off(L.Draw.Event.DRAWVERTEX, this.handleRoutefinderVertexDrawn);\r\n      this.leafletMap?.off(L.Draw.Event.EDITVERTEX, this.handleRoutefinderVertexEdited);\r\n\r\n      this.leafletMap?.off(L.Draw.Event.EDITSTART, this.handleRoutefinderEditStart);\r\n      this.leafletMap?.off(L.Draw.Event.EDITSTOP, this.handleRoutefinderEditStop);\r\n      this.leafletMap?.off(L.Draw.Event.DRAWSTART, this.handleRoutefinderDrawStart);\r\n      this.leafletMap?.off(L.Draw.Event.DRAWSTOP, this.handleRoutefinderDrawStop);\r\n\r\n      if (this.mapControl) this.leafletMap?.removeControl(this.mapControl);\r\n      this.mapControl = undefined;\r\n    });\r\n  }\r\n\r\n  activateNormalControls() {\r\n    for (let h of this.mapControlDisposers) h();\r\n    this.mapControlDisposers = [];\r\n    this.leafletMapObjects.clearLayers();\r\n    this.leafletMapRoute.clearLayers();\r\n    this.leafletMap?.addControl(\r\n      (this.mapControl = new L.Control.Draw({\r\n        edit: {\r\n          featureGroup: this.leafletMapObjects,\r\n          poly: {\r\n            allowIntersection: true,\r\n          },\r\n          circle: false,\r\n          circlemarker: false,\r\n        },\r\n        draw: {\r\n          polygon: {\r\n            allowIntersection: false,\r\n            showArea: true,\r\n          },\r\n          circle: false,\r\n          circlemarker: false,\r\n        },\r\n      } as any)) // \r\n    );\r\n    this.leafletMap?.on(L.Draw.Event.CREATED, this.handleOjectCreated);\r\n    this.leafletMap?.on(L.Draw.Event.EDITED, this.handleObjectEdited);\r\n    this.leafletMap?.on(L.Draw.Event.DELETED, this.handleObjectDeleted);\r\n    this.mapControlDisposers.push(() => {\r\n      this.leafletMap?.off(L.Draw.Event.CREATED, this.handleOjectCreated);\r\n      this.leafletMap?.off(L.Draw.Event.EDITED, this.handleObjectEdited);\r\n      this.leafletMap?.off(L.Draw.Event.DELETED, this.handleObjectDeleted);\r\n      if (this.mapControl) this.leafletMap?.removeControl(this.mapControl);\r\n      this.mapControl = undefined;\r\n    });\r\n  }\r\n\r\n  mapFittedToLayers = false;\r\n\r\n  initLeaflet() {\r\n    const lmap = L.map(this.elmMapDiv!, {\r\n      layers: this.layerList\r\n        .filter(([rawLayer, leaLayer]) => rawLayer.defaultEnabled)\r\n        .map(([rawLayer, leaLayer]) => leaLayer),\r\n    });\r\n    this.leafletMap = lmap;\r\n    lmap.setZoom(this.props.initialZoom || 0);\r\n    this.panToCenter();\r\n    L.control\r\n      .layers({}, this.leafletlayersDescriptor, {position: \"topleft\", collapsed: true})\r\n      .addTo(lmap);\r\n    L.control.scale().addTo(lmap);\r\n\r\n    lmap.addLayer(this.leafletMapObjects);\r\n    lmap.addLayer(this.leafletMapRoute);\r\n\r\n    this._disposers.push(\r\n      reaction(\r\n        () => this.mapDrawnObjectLayers,\r\n        (layers) => {\r\n          this.leafletMapObjects.clearLayers();\r\n          let allLayerBounds = L.latLngBounds([]);\r\n          for (let layer of layers) {\r\n            this.leafletMapObjects.addLayer(layer[1]);\r\n            if ((layer[1] as any).getBounds) {\r\n              allLayerBounds.extend((layer[1] as any).getBounds());\r\n            } else if ((layer[1] as any).getLatLng) {\r\n              allLayerBounds.extend((layer[1] as any).getLatLng());\r\n            }\r\n            layer[1].on(\"click\", () => this.props.onLayerClick?.(layer[0].id));\r\n          }\r\n          if (!this.props.mapCenter && allLayerBounds.isValid() && !this.mapFittedToLayers) {\r\n            allLayerBounds = allLayerBounds.pad(0.1);\r\n            const mapCenter = allLayerBounds.getCenter();\r\n            lmap.panTo(mapCenter);\r\n            this.mapFittedToLayers = true;\r\n          }\r\n          this.highlightSelectedLayer();\r\n          if(layers.length === 1){\r\n            this.panToFirstObject();\r\n          }\r\n        },\r\n        {\r\n          delay: 100,\r\n          fireImmediately: true,\r\n        }\r\n      ),\r\n      reaction(\r\n        () => this.mapRoutefinderRoute,\r\n        (layers) => {\r\n          this.leafletMapRoute.clearLayers();\r\n          for (let layer of layers) {\r\n            this.leafletMapRoute.addLayer(layer!);\r\n          }\r\n        }\r\n      ),\r\n      reaction(\r\n        () => this.mapRoutefinderEditables,\r\n        (layers) => {\r\n          if (this.editingObjectsRepaintDisabled) return;\r\n          this.leafletMapObjects.clearLayers();\r\n          for (let layer of layers) {\r\n            this.leafletMapObjects.addLayer(layer!);\r\n          }\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  _isMounted = false;\r\n\r\n  mountLeaflet() {\r\n    if (!this._isMounted) {\r\n      this.initLeaflet();\r\n      if (!this.props.isReadOnly) {\r\n        this.initLeafletDrawControls();\r\n      }\r\n      this._isMounted = true;\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    autorun(\r\n      () => {\r\n        if (\r\n          (this.contentRect?.bounds?.width || 0) > 40 &&\r\n          (this.contentRect?.bounds?.height || 0) > 40 &&\r\n          this.props.isActive\r\n        ) {\r\n          this.mountLeaflet();\r\n        }\r\n      },\r\n      {delay: 500}\r\n    );\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this._disposers.forEach((d) => d());\r\n  }\r\n\r\n  @observable.ref contentRect?: ContentRect;\r\n\r\n  @action.bound\r\n  handleResize(rect: ContentRect) {\r\n    this.contentRect = rect;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Measure bounds={true} onResize={this.handleResize}>\r\n        {({measureRef}) => (\r\n          <div ref={measureRef} style={{width: \"100%\", height: \"100%\"}}>\r\n            <div\r\n              className={cx(S.mapDiv, {isHidden: !this.props.isActive})}\r\n              ref={(elm) => {\r\n                this.refMapDiv(elm);\r\n              }}\r\n            ></div>\r\n          </div>\r\n        )}\r\n      </Measure>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action } from \"mobx\";\r\nimport { MapRootStore } from \"./MapRootStore\";\r\n\r\nexport class MapNavigationStore {\r\n  constructor(private root: MapRootStore) {\r\n  }\r\n\r\n  refMapComponent = (elm: any) => (this.elmMapComponent = elm);\r\n  elmMapComponent: {\r\n    panToCenter(): void;\r\n    panToSelectedObject(): void;\r\n    panToFirstObject(): void;\r\n    highlightSelectedLayer(): void;\r\n    activateRoutingControls(): void;\r\n    activateNormalControls(): void;\r\n  } | null = null;\r\n\r\n  get setupStore() {\r\n    return this.root.mapSetupStore;\r\n  }\r\n\r\n  get searchStore() {\r\n    return this.root.mapSearchStore;\r\n  }\r\n\r\n  @action.bound\r\n  highlightSelectedSearchResult() {\r\n    // We might select some result right before this point in the same action.\r\n    // Wait for React to propagate props.\r\n    setTimeout(() => this.elmMapComponent?.highlightSelectedLayer(), 100);\r\n  }\r\n\r\n  @action.bound\r\n  fitToSelectedSearchResult() {\r\n    // We might select some result right before this point in the same action.\r\n    // Wait for React to propagate props.\r\n    setTimeout(() => this.elmMapComponent?.panToSelectedObject(), 100);\r\n  }\r\n\r\n  @action.bound\r\n  handleCenterMapClick(event: any) {\r\n    this.elmMapComponent?.panToCenter();\r\n  }\r\n\r\n  @action.bound\r\n  activateRoutingControls() {\r\n    this.elmMapComponent?.activateRoutingControls();\r\n  }\r\n\r\n  @action.bound\r\n  activateNormalControls() {\r\n    this.elmMapComponent?.activateNormalControls();\r\n  }\r\n\r\n  @action.bound\r\n  handleLookupObjectClick(event: any) {\r\n    if (this.setupStore.isReadOnlyView) {\r\n      if (this.searchStore.selectedSearchResult) {\r\n        this.elmMapComponent?.panToSelectedObject();\r\n      }\r\n    } else {\r\n      this.elmMapComponent?.panToFirstObject();\r\n    }\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action, computed, observable } from \"mobx\";\r\nimport { MapRootStore } from \"./MapRootStore\";\r\n\r\nexport class MapRoutefinderStore {\r\n  constructor(private root: MapRootStore) {\r\n  }\r\n\r\n  get navigation() {\r\n    return this.root.mapNavigationStore;\r\n  }\r\n\r\n  get objects() {\r\n    return this.root.mapObjectsStore;\r\n  }\r\n\r\n  @observable isActive = false;\r\n\r\n  @observable.shallow routeLatLngs: any[] = [];\r\n  @observable.shallow driveThruPointsEditing: any[] = [];\r\n  @observable.shallow driveThruPoints: any[] = [];\r\n\r\n  @computed get mapObjectsRoute() {\r\n    return [{type: \"LineString\", coordinates: this.routeLatLngs.map((latLng) => latLng)}];\r\n  }\r\n\r\n  @computed get mapObjectsEditable() {\r\n    return [\r\n      {\r\n        type: \"LineString\",\r\n        coordinates: this.driveThruPoints.map((latLng) => latLng),\r\n      },\r\n    ];\r\n  }\r\n\r\n  @action.bound\r\n  handleRoutefinderButtonClick(event: any) {\r\n    if (!this.isActive) {\r\n      this.isActive = true;\r\n      this.navigation.activateRoutingControls();\r\n    } else {\r\n      this.isActive = false;\r\n      this.navigation.activateNormalControls();\r\n    }\r\n  }\r\n\r\n  @action.bound handleResultsReceived(results: any) {\r\n    this.routeLatLngs = results.geometry.map((coord: any) => [coord.x, coord.y]);\r\n  }\r\n\r\n  @action.bound handleEditingFinished() {\r\n    this.driveThruPoints = this.driveThruPointsEditing;\r\n    if (this.routeLatLngs.length > 0) {\r\n      this.objects.handleGeometryChange(this.mapObjectsRoute[0]);\r\n    }\r\n  }\r\n\r\n  @action.bound handleEditingCancelled() {\r\n    this.driveThruPointsEditing = [];\r\n    if (this.driveThruPoints.length > 1) {\r\n      this.calculateRoute(this.driveThruPoints);\r\n    } else {\r\n      this.routeLatLngs = [];\r\n    }\r\n  }\r\n\r\n  @action.bound handleEditingStarted() {\r\n    this.driveThruPointsEditing = this.driveThruPoints;\r\n  }\r\n\r\n  @action.bound handleResultsError() {\r\n    console.error(\"Route lookup failed.\"); // eslint-disable-line no-console\r\n  }\r\n\r\n  @action.bound\r\n  handleGeometryChange(obj: any) {\r\n    if (obj) {\r\n      const gjsCoords = obj.coordinates;\r\n      this.driveThruPointsEditing = gjsCoords;\r\n      this.calculateRoute(gjsCoords);\r\n    }\r\n  }\r\n\r\n  @action.bound calculateRoute(gjsCoords: any) {\r\n    if (gjsCoords.length > 1) {\r\n      const smapCoords = gjsCoords.map((ll: any) =>\r\n        (window as any).SMap.Coords.fromWGS84(ll[0], ll[1])\r\n      );\r\n      new (window as any).SMap.Route(smapCoords, (route: any) => {\r\n        const results = route.getResults();\r\n        if (results.error) {\r\n          this.handleResultsError();\r\n        } else {\r\n          this.handleResultsReceived(results);\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action, computed, observable } from \"mobx\";\r\nimport { IMapObject } from \"./MapObjectsStore\";\r\nimport { MapRootStore } from \"./MapRootStore\";\r\n\r\nexport class SearchStore {\r\n  constructor(private root: MapRootStore) {\r\n  }\r\n\r\n  get navigationStore() {\r\n    return this.root.mapNavigationStore;\r\n  }\r\n\r\n  get allMapObjects() {\r\n    return this.root.mapObjectsStore.mapObjects;\r\n  }\r\n\r\n  @computed get searchResults(): IMapObject[] {\r\n    if (!this.searchPhrase) return this.allMapObjects;\r\n    return this.allMapObjects.filter((obj) =>\r\n      obj.name.toLocaleLowerCase().includes(this.searchPhrase.toLocaleLowerCase())\r\n    );\r\n  }\r\n\r\n  @observable selectedSearchResult?: IMapObject;\r\n\r\n  @observable isDropped = false;\r\n\r\n  refSearchField = (elm: any) => (this.elmSearchField = elm);\r\n  elmSearchField: any = null;\r\n\r\n  refDropdown = (elm: any) => (this.elmDropdown = elm);\r\n  elmDropdown: any = null;\r\n\r\n  @observable searchPhrase = \"\";\r\n\r\n  @observable rect: any = {top: 0, left: 0, right: 0, bottom: 0, height: 0, width: 0};\r\n\r\n  @action.bound\r\n  measureSearchField() {\r\n    if (this.elmSearchField) {\r\n      this.rect = this.elmSearchField.getBoundingClientRect();\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  dropDown() {\r\n    this.measureSearchField();\r\n    this.isDropped = true;\r\n    window.addEventListener(\"mousedown\", this.handleWindowMouseDown);\r\n  }\r\n\r\n  @action.bound\r\n  dropUp() {\r\n    this.isDropped = false;\r\n    window.removeEventListener(\"mousedown\", this.handleWindowMouseDown);\r\n  }\r\n\r\n  @action.bound\r\n  handleSearchInputChange(event: any) {\r\n    this.searchPhrase = event.target.value;\r\n    if (!this.isDropped) {\r\n      this.dropDown();\r\n    }\r\n  }\r\n\r\n  @action.bound handleSearchInputFocus(event: any) {\r\n    event.target.select?.();\r\n  }\r\n\r\n  @action.bound handleSearchInputBlur(event: any) {\r\n    if (!this.searchPhrase) {\r\n      this.selectedSearchResult = undefined;\r\n      this.navigationStore.fitToSelectedSearchResult();\r\n      this.navigationStore.highlightSelectedSearchResult();\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  handleSearchInputKeyDown(event: any) {\r\n    switch (event.key) {\r\n      case \"Escape\":\r\n        if (this.isDropped) {\r\n          this.dropUp();\r\n        }\r\n        break;\r\n      case \"Enter\":\r\n        if (!this.searchPhrase) {\r\n          this.selectedSearchResult = undefined;\r\n          this.navigationStore.fitToSelectedSearchResult();\r\n          this.navigationStore.highlightSelectedSearchResult();\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  get searchInputValue() {\r\n    return this.searchPhrase;\r\n  }\r\n\r\n  @action.bound\r\n  handleCaretMouseDown(event: any) {\r\n    event.stopPropagation();\r\n    event.preventDefault();\r\n    if (this.isDropped) {\r\n      this.dropUp();\r\n    } else {\r\n      this.searchPhrase = \"\";\r\n      this.dropDown();\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  handleClearClick(event: any) {\r\n    this.searchPhrase = \"\";\r\n    this.selectedSearchResult = undefined;\r\n    this.navigationStore.fitToSelectedSearchResult();\r\n    this.navigationStore.highlightSelectedSearchResult();\r\n  }\r\n\r\n  @action.bound\r\n  handleClearMouseDown(event: any) {\r\n  }\r\n\r\n  @action.bound\r\n  selectSearchResultById(resultId: string) {\r\n    this.selectedSearchResult = this.allMapObjects.find((item) => item.id === resultId);\r\n    this.searchPhrase = this.selectedSearchResult?.name || \"\";\r\n  }\r\n\r\n  @action.bound\r\n  handleSearchResultClick(event: any, resultId: string) {\r\n    this.selectSearchResultById(resultId);\r\n    this.navigationStore.fitToSelectedSearchResult();\r\n    this.navigationStore.highlightSelectedSearchResult();\r\n    this.dropUp();\r\n  }\r\n\r\n  @action.bound\r\n  handleWindowMouseDown(event: any) {\r\n    if (!this.elmDropdown?.contains(event.target) && !this.elmSearchField?.contains(event.target)) {\r\n      this.dropUp();\r\n    }\r\n  }\r\n\r\n  get dropdownTop() {\r\n    return this.rect.bottom;\r\n  }\r\n\r\n  get dropdownLeft() {\r\n    return this.rect.left;\r\n  }\r\n\r\n  get dropdownWidth() {\r\n    return this.rect.width;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { computed } from \"mobx\";\r\nimport { parse as wktParse } from \"wkt\";\r\nimport { MapRootStore } from \"./MapRootStore\";\r\n\r\nexport class MapLayer {\r\n  id: string = \"\";\r\n  title: string = \"\";\r\n  defaultEnabled: boolean = false;\r\n  type: string = \"\";\r\n  mapLayerParameters = new Map<string, any>();\r\n\r\n  getUrl() {\r\n    return this.mapLayerParameters.get(\"url\");\r\n  }\r\n\r\n  getTitle() {\r\n    return this.title;\r\n  }\r\n\r\n  getOptions() {\r\n    const rawOptions = Object.fromEntries(this.mapLayerParameters);\r\n    delete rawOptions.url;\r\n    delete rawOptions.title;\r\n    return {\r\n      ...rawOptions,\r\n      id: this.id,\r\n      minZoom: rawOptions.minZoom !== undefined ? parseInt(rawOptions.minZoom) : undefined,\r\n      maxZoom: rawOptions.maxZoom !== undefined ? parseInt(rawOptions.maxZoom) : undefined,\r\n    };\r\n  }\r\n}\r\n\r\nexport class MapSetupStore {\r\n  constructor(private rootStore: MapRootStore) {\r\n  }\r\n\r\n  mapLocationMember: string = \"\";\r\n  mapAzimuthMember: string = \"\";\r\n  mapColorMember: string = \"\";\r\n  mapIconMember: string = \"\";\r\n  mapTextMember: string = \"\";\r\n  mapResolutionRaw: string = \"\";\r\n  textColorMember: string = \"\";\r\n  textLocationMember: string = \"\";\r\n  textRotationMember: string = \"\";\r\n  mapCenterRaw: string = \"\";\r\n  isReadOnlyView: boolean = false;\r\n\r\n  layers: MapLayer[] = [];\r\n\r\n  get mapZoom() {\r\n    let zoom = this.mapResolutionRaw ? parseInt(this.mapResolutionRaw) : 0;\r\n    if (zoom < 0 || zoom > 15) {\r\n      throw new Error(\"Map zoom must be between 0 and 15. The value is: \" + zoom);\r\n    }\r\n    return zoom;\r\n  }\r\n\r\n  @computed\r\n  get mapCenter() {\r\n    try {\r\n      return this.mapCenterRaw ? wktParse(this.mapCenterRaw) : undefined;\r\n    } catch (e) {\r\n      console.error(e); // eslint-disable-line no-console\r\n      return undefined;\r\n    }\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDataView } from \"model/entities/types/IDataView\";\r\nimport { createContext } from \"react\";\r\nimport { MapNavigationStore } from \"./MapNavigationStore\";\r\nimport { MapObjectsStore } from \"./MapObjectsStore\";\r\nimport { MapRoutefinderStore } from \"./MapRoutefinderStore\";\r\nimport { SearchStore } from \"./MapSearchStore\";\r\nimport { MapSetupStore } from \"./MapSetupStore\";\r\n\r\nexport class MapRootStore {\r\n  constructor(public dataView: IDataView) {\r\n  }\r\n\r\n  mapSearchStore = new SearchStore(this);\r\n  mapObjectsStore = new MapObjectsStore(this);\r\n  mapSetupStore = new MapSetupStore(this);\r\n  mapNavigationStore = new MapNavigationStore(this);\r\n  mapRoutefinderStore = new MapRoutefinderStore(this);\r\n}\r\n\r\nexport const CtxMapRootStore = createContext<MapRootStore>(null!);\r\n\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Observer } from \"mobx-react\";\r\nimport React, { useContext } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { Grid } from \"react-virtualized\";\r\nimport Highlighter from \"react-highlight-words\";\r\nimport cx from \"classnames\";\r\nimport S from \"./MapPerspectiveUI.module.scss\";\r\nimport { CtxMapRootStore } from \"./stores/MapRootStore\";\r\n\r\nexport function MapPerspectiveSearch() {\r\n  const {mapSearchStore, mapSetupStore} = useContext(CtxMapRootStore);\r\n  return (\r\n    <Observer>\r\n      {() => (\r\n        <>\r\n          {mapSetupStore.isReadOnlyView ? (\r\n            <div className={S.mapSearch} ref={mapSearchStore.refSearchField}>\r\n              <input\r\n                className={\"input\"}\r\n                value={mapSearchStore.searchInputValue}\r\n                onChange={mapSearchStore.handleSearchInputChange}\r\n                onKeyDown={mapSearchStore.handleSearchInputKeyDown}\r\n                onFocus={mapSearchStore.handleSearchInputFocus}\r\n              />\r\n              <div className={\"inputActions\"}>\r\n                <button\r\n                  className={\"inputClear\"}\r\n                  onClick={mapSearchStore.handleClearClick}\r\n                  onMouseDown={mapSearchStore.handleClearMouseDown}\r\n                >\r\n                  <i className=\"fas fa-times\"/>\r\n                </button>\r\n                <button className={\"inputCaret\"} onMouseDown={mapSearchStore.handleCaretMouseDown}>\r\n                  <i className=\"fas fa-caret-down\"/>\r\n                </button>\r\n              </div>\r\n              {mapSearchStore.isDropped &&\r\n              createPortal(\r\n                <MapPerspectiveSearchDropdown\r\n                  domRef={mapSearchStore.refDropdown}\r\n                  top={mapSearchStore.dropdownTop + 2}\r\n                  left={mapSearchStore.dropdownLeft}\r\n                  width={mapSearchStore.dropdownWidth}\r\n                />,\r\n                document.getElementById(\"dropdown-portal\")!\r\n              )}\r\n            </div>\r\n          ) : null}\r\n        </>\r\n      )}\r\n    </Observer>\r\n  );\r\n}\r\n\r\nexport function MapPerspectiveSearchDropdown(props: {\r\n  top: number;\r\n  left: number;\r\n  width: number;\r\n  domRef: any;\r\n}) {\r\n  return (\r\n    <div\r\n      ref={props.domRef}\r\n      style={{top: props.top, left: props.left, width: props.width}}\r\n      className={S.mapSearchDropdown}\r\n    >\r\n      <SearchResults width={props.width - 4}/>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst ROW_HEIGHT = 25;\r\n\r\nexport function SearchResults(props: { width: number }) {\r\n  const {mapSearchStore} = useContext(CtxMapRootStore);\r\n  const rowCount = mapSearchStore.searchResults.length;\r\n  return (\r\n    <Observer>\r\n      {() => (\r\n        <Grid\r\n          width={props.width}\r\n          height={Math.min(rowCount * ROW_HEIGHT, 10 * ROW_HEIGHT)}\r\n          rowHeight={ROW_HEIGHT}\r\n          columnWidth={props.width}\r\n          rowCount={rowCount}\r\n          columnCount={1}\r\n          cellRenderer={({key, style, rowIndex, columnIndex}) => {\r\n            const searchResult = mapSearchStore.searchResults[rowIndex];\r\n            return (\r\n              <Observer key={key}>\r\n                {() => (\r\n                  <div\r\n                    className={cx(\"cell\", {c1: rowIndex % 2 === 0, c2: rowIndex % 2 === 1})}\r\n                    style={style}\r\n                    onClick={(e) => mapSearchStore.handleSearchResultClick(e, searchResult.id)}\r\n                  >\r\n                    <Highlighter\r\n                      searchWords={[mapSearchStore.searchPhrase]}\r\n                      textToHighlight={searchResult.name}\r\n                    />\r\n                  </div>\r\n                )}\r\n              </Observer>\r\n            );\r\n          }}\r\n        />\r\n      )}\r\n    </Observer>\r\n  );\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { PropsWithChildren, useContext, useEffect } from \"react\";\r\nimport cx from \"classnames\";\r\nimport { action, flow } from \"mobx\";\r\nimport { IDataViewBodyUI, IDataViewToolbarUI } from \"modules/DataView/DataViewUI\";\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { SectionViewSwitchers } from \"modules/DataView/DataViewTypes\";\r\nimport { getIdent, IIId } from \"utils/common\";\r\nimport { DataViewHeaderAction } from \"gui/Components/DataViewHeader/DataViewHeaderAction\";\r\nimport { Icon } from \"@origam/components\";\r\nimport { IMapPerspective, MapPerspective } from \"./MapPerspective\";\r\nimport { Observer } from \"mobx-react\";\r\nimport { IPerspective } from \"../Perspective\";\r\nimport { MapPerspectiveCom } from \"./MapPerspectiveUI\";\r\nimport { CtxDataViewHeaderExtension, IDataViewHeaderExtensionItem, } from \"gui/Components/ScreenElements/DataView\";\r\nimport { MapPerspectiveSearch } from \"./MapPerspectiveSearch\";\r\nimport { CtxMapRootStore, MapRootStore } from \"./stores/MapRootStore\";\r\nimport S from \"./MapPerspectiveUI.module.scss\";\r\n\r\nexport class MapPerspectiveDirector implements IIId {\r\n  $iid = getIdent();\r\n\r\n  constructor(\r\n    public dataViewToolbarUI = IDataViewToolbarUI(),\r\n    public dataViewBodyUI = IDataViewBodyUI(),\r\n    public mapPerspective = IMapPerspective(),\r\n    public perspective = IPerspective()\r\n  ) {\r\n  }\r\n\r\n  rootStore: MapRootStore = null!;\r\n\r\n  toolbarActionsExtension = new ToolbarActionsExtension(this.mapPerspective, () => this.rootStore);\r\n\r\n  @action.bound\r\n  setup() {\r\n    this.dataViewBodyUI.contrib.put({\r\n      $iid: this.$iid,\r\n      render: () => (\r\n        <CtxMapRootStore.Provider value={this.rootStore} key={this.$iid}>\r\n          <MapContentUI\r\n            mapPerspective={this.mapPerspective}\r\n            toolbarActionsExtension={this.toolbarActionsExtension}\r\n          />\r\n        </CtxMapRootStore.Provider>\r\n      ),\r\n    });\r\n\r\n    this.dataViewToolbarUI.contrib.put({\r\n      $iid: this.$iid,\r\n      section: SectionViewSwitchers,\r\n      render: () => (\r\n        <Observer key={this.$iid}>\r\n          {() => (\r\n            <DataViewHeaderAction\r\n              onMouseDown={flow(this.mapPerspective.handleToolbarBtnClick)}\r\n              isActive={this.mapPerspective.isActive}\r\n            >\r\n              <Icon src=\"./icons/geo-coordinates.svg\"/>\r\n            </DataViewHeaderAction>\r\n          )}\r\n        </Observer>\r\n      ),\r\n    });\r\n\r\n    this.perspective.contrib.put(this.mapPerspective);\r\n  }\r\n\r\n  @action.bound\r\n  teardown() {\r\n    this.dataViewBodyUI.contrib.del(this);\r\n    this.dataViewToolbarUI.contrib.del(this);\r\n    this.perspective.contrib.del(this.mapPerspective);\r\n  }\r\n\r\n  dispose() {\r\n    this.teardown();\r\n  }\r\n}\r\n\r\nexport const IMapPerspectiveDirector = TypeSymbol<MapPerspectiveDirector>(\r\n  \"IMapPerspectiveDirector\"\r\n);\r\n\r\nexport function MapPerspectiveComContainer(\r\n  props: PropsWithChildren<{ toolbarActionsExtension: ToolbarActionsExtension }>\r\n) {\r\n  const toolbarExtension = useContext(CtxDataViewHeaderExtension);\r\n  useEffect(() => {\r\n    toolbarExtension.put(props.toolbarActionsExtension);\r\n    return () => toolbarExtension.del(props.toolbarActionsExtension);\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n  return <>{props.children}</>;\r\n}\r\n\r\nclass ToolbarActionsExtension implements IDataViewHeaderExtensionItem {\r\n  constructor(public mapPerspective: MapPerspective, public getRootStore: () => MapRootStore) {\r\n  }\r\n\r\n  get rootStore() {\r\n    return this.getRootStore();\r\n  }\r\n\r\n  $iid = getIdent();\r\n  group = \"actions\";\r\n\r\n  render(): React.ReactNode {\r\n    return this.mapPerspective.isActive ? (\r\n      <CtxMapRootStore.Provider value={this.rootStore} key={this.$iid}>\r\n        <MapPerspectiveNavigation/>\r\n        <MapPerspectiveSearch/>\r\n        {/*<MapPerspectiveRoutefind />*/}\r\n      </CtxMapRootStore.Provider>\r\n    ) : null;\r\n  }\r\n}\r\n\r\nfunction MapContentUI(props: {\r\n  toolbarActionsExtension: ToolbarActionsExtension;\r\n  mapPerspective: MapPerspective;\r\n}) {\r\n  const {\r\n    mapSetupStore,\r\n    mapObjectsStore,\r\n    mapSearchStore,\r\n    mapNavigationStore,\r\n    mapRoutefinderStore,\r\n  } = useContext(CtxMapRootStore);\r\n  return (\r\n    <Observer>\r\n      {() => (\r\n        <MapPerspectiveComContainer toolbarActionsExtension={props.toolbarActionsExtension}>\r\n          <MapPerspectiveCom\r\n            ref={mapNavigationStore.refMapComponent}\r\n            lastDetailedObject={mapSearchStore.selectedSearchResult}\r\n            mapCenter={mapSetupStore.mapCenter || undefined}\r\n            initialZoom={mapSetupStore.mapZoom}\r\n            getMapObjects={() => (mapRoutefinderStore.isActive ? [] : mapObjectsStore.mapObjects)}\r\n            getRoutefinderRoute={() => mapRoutefinderStore.mapObjectsRoute}\r\n            getRoutefinderEditables={() => mapRoutefinderStore.mapObjectsEditable}\r\n            mapLayers={mapSetupStore.layers}\r\n            isReadOnly={mapSetupStore.isReadOnlyView}\r\n            isActive={props.mapPerspective.isActive}\r\n            onChange={(geoJson) => {\r\n              mapObjectsStore.handleGeometryChange(geoJson);\r\n            }}\r\n            onRoutefinderGeometryChange={mapRoutefinderStore.handleGeometryChange}\r\n            onRoutefinderGeometryEditStart={mapRoutefinderStore.handleEditingStarted}\r\n            onRoutefinderGeometryEditSave={mapRoutefinderStore.handleEditingFinished}\r\n            onRoutefinderGeometryEditCancel={mapRoutefinderStore.handleEditingCancelled}\r\n            onLayerClick={mapObjectsStore.handleLayerClick}\r\n          />\r\n        </MapPerspectiveComContainer>\r\n      )}\r\n    </Observer>\r\n  );\r\n}\r\n\r\nfunction MapPerspectiveNavigation() {\r\n  const {mapObjectsStore, mapNavigationStore} = useContext(CtxMapRootStore);\r\n  useEffect(() => mapObjectsStore.handleMapMounted(), []); // eslint-disable-line react-hooks/exhaustive-deps\r\n  return (\r\n    <Observer>\r\n      {() => (\r\n        <>\r\n          <button\r\n            className={cx(S.mapToolbarButton)}\r\n            onClick={mapNavigationStore.handleCenterMapClick}\r\n          >\r\n            <i className=\"fas fa-crosshairs fa-lg\"/>\r\n          </button>\r\n          <button\r\n            className={cx(S.mapToolbarButton)}\r\n            onClick={mapNavigationStore.handleLookupObjectClick}\r\n          >\r\n            <i className=\"fas fa-search-location fa-lg\"/>\r\n          </button>\r\n        </>\r\n      )}\r\n    </Observer>\r\n  );\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Container } from \"dic/Container\";\r\nimport { IMapPerspectiveDirector, MapPerspectiveDirector } from \"./MapPerspectiveDirector\";\r\nimport { IMapPerspective, MapPerspective } from \"./MapPerspective\";\r\n\r\nexport const SCOPE_MapPerspective = \"MapPerspective\";\r\n\r\nexport function register($cont: Container) {\r\n  $cont\r\n    .registerClass(IMapPerspectiveDirector, MapPerspectiveDirector)\r\n    .scopedInstance(SCOPE_MapPerspective);\r\n\r\n  $cont.registerClass(IMapPerspective, MapPerspective).scopedInstance(SCOPE_MapPerspective);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { flow, observable } from \"mobx\";\r\nimport { getIdent, IIId } from \"utils/common\";\r\nimport { IPerspective, IPerspectiveContrib } from \"../Perspective\";\r\nimport bind from \"bind-decorator\";\r\nimport { IViewConfiguration } from \"modules/DataView/ViewConfiguration\";\r\nimport { IPanelViewType } from \"model/entities/types/IPanelViewType\";\r\n\r\nexport class FormPerspective implements IIId, IPerspectiveContrib {\r\n  $iid = getIdent();\r\n\r\n  constructor(\r\n    public perspective = IPerspective(),\r\n    public viewConfiguration = IViewConfiguration()\r\n  ) {\r\n  }\r\n\r\n  @observable isActive = false;\r\n\r\n  @bind\r\n  handleClick(args?: { saveNewState: boolean }) {\r\n    const self = this;\r\n    return flow(function*() {\r\n      if (self.isActive) return;\r\n      yield*self.perspective.deactivate();\r\n      self.isActive = true;\r\n      if (args?.saveNewState) {\r\n        yield*self.viewConfiguration.anounceActivePerspective(IPanelViewType.Form);\r\n      }\r\n    })();\r\n  }\r\n\r\n  @bind\r\n  *deactivate() {\r\n    this.isActive = false;\r\n  }\r\n\r\n  @bind\r\n  *activateDefault() {\r\n    if (this.viewConfiguration.activePerspective === IPanelViewType.Form) this.isActive = true;\r\n  }\r\n}\r\n\r\nexport const IFormPerspective = TypeSymbol<FormPerspective>(\"IFormPerspective\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"./FormView.module.scss\";\r\nimport { inject, observer, Provider } from \"mobx-react\";\r\nimport { IFormPanelView } from \"model/entities/FormPanelView/types/IFormPanelView\";\r\nimport cx from \"classnames\";\r\n\r\n@inject(({dataView}) => {\r\n  return {\r\n    formPanelView: dataView.formPanelView,\r\n  };\r\n})\r\n@observer\r\nexport class FormView extends React.Component<{\r\n  formPanelView?: IFormPanelView;\r\n}> {\r\n  render() {\r\n    return (\r\n      <Provider formPanelView={this.props.formPanelView}>\r\n        <div className={cx(S.formView, \"isFormView\")}>\r\n          <form className={S.formViewForm} onSubmit={(event: any) => event.preventDefault()}>\r\n            {this.props.children}\r\n          </form>\r\n        </div>\r\n      </Provider>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport S from \"./FormRoot.module.scss\";\r\nimport React from \"react\";\r\nimport { observer } from \"mobx-react\";\r\nimport { action } from \"mobx\";\r\nimport cx from \"classnames\";\r\n\r\n@observer\r\nexport class FormRoot extends React.Component<{\r\n  className?: string;\r\n  style?: any\r\n}> {\r\n  componentDidMount() {\r\n    window.addEventListener(\"click\", this.handleWindowClick);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener(\"click\", this.handleWindowClick);\r\n  }\r\n\r\n  @action.bound handleWindowClick(event: any) {\r\n    if (this.elmFormRoot && !this.elmFormRoot.contains(event.target)) {\r\n    }\r\n  }\r\n\r\n  elmFormRoot: HTMLDivElement | null = null;\r\n  refFormRoot = (elm: HTMLDivElement | null) => (this.elmFormRoot = elm);\r\n\r\n  render() {\r\n    return (\r\n      <div\r\n        ref={this.refFormRoot}\r\n        className={cx(this.props.className, S.formRoot)}\r\n        style={this.props.style}\r\n      >\r\n        {this.props.children}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getRowStateById } from \"./getRowStateById\";\r\n\r\nexport function getRowStateDynamicLabel(ctx: any, rowId: string, columnId: string) {\r\n  const rowState = getRowStateById(ctx, rowId);\r\n  const column = rowState ? rowState.columns.get(columnId) : undefined;\r\n  const dynamicLabel = column ? column.dynamicLabel : undefined;\r\n  return dynamicLabel;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport S from \"gui/Components/ScreenElements/Table/Table.module.scss\";\r\nimport * as React from \"react\";\r\n\r\nexport function formatTooltipText(content: string | string[] | undefined) {\r\n  if (!content) {\r\n    return \"\";\r\n  }\r\n  const lines = Array.isArray(content)\r\n    ? content.flatMap((line) => splitToLines(line))\r\n    : splitToLines(content);\r\n  return formatToolTipLines(lines);\r\n}\r\n\r\nfunction splitToLines(value: string) {\r\n  if (!value) {\r\n    return [];\r\n  }\r\n  if (typeof value.split !== 'function') {\r\n    return [value.toString()];\r\n  }\r\n  return value.split(/\\\\r\\\\n|\\\\n|<br\\/>|<BR\\/>/);\r\n}\r\n\r\nfunction formatToolTipLines(content: string[]) {\r\n  const equalLengthLines = content;\r\n  const linesToShow =\r\n    equalLengthLines.length > 10 ? equalLengthLines.slice(0, 9).concat([\"...\"]) : equalLengthLines;\r\n  return (\r\n    <div className={S.tooltipContent}>\r\n      {linesToShow.map((line) => (\r\n        <div className={S.toolTipLine}>{line}</div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function formatTooltipPlaintext(content: string | string[] | undefined) {\r\n  if (!content) return;\r\n  const lines = Array.isArray(content)\r\n    ? content.flatMap((line) => splitToLines(line))\r\n    : splitToLines(content);\r\n  return formatToolTipLinesPlaintext(lines);\r\n}\r\n\r\nfunction formatToolTipLinesPlaintext(content: string[]) {\r\n  const equalLengthLines = content;\r\n  const linesToShow =\r\n    equalLengthLines.length > 10 ? equalLengthLines.slice(0, 9).concat([\"...\"]) : equalLengthLines;\r\n  return linesToShow.join(\"\\n\");\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { inject, observer } from \"mobx-react\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { getDataStructureEntityId } from \"model/selectors/DataView/getDataStructureEntityId\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\nimport { getMenuItemId } from \"model/selectors/getMenuItemId\";\r\nimport { getEntity } from \"model/selectors/DataView/getEntity\";\r\nimport { getSessionId } from \"model/selectors/getSessionId\";\r\nimport { IApi } from \"model/entities/types/IApi\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { action, flow, observable } from \"mobx\";\r\nimport S from \"./BlobEditor.module.scss\";\r\nimport { IProcessCRUDResult } from \"model/actions/Actions/processActionResult\";\r\nimport { processCRUDResult } from \"model/actions/DataLoading/processCRUDResult\";\r\nimport { getDialogStack } from \"model/selectors/DialogStack/getDialogStack\";\r\nimport { IDialogStack } from \"model/entities/types/IDialogStack\";\r\nimport { changeManyFields } from \"model/actions-ui/DataView/TableView/onFieldChange\";\r\nimport { flushCurrentRowData } from \"model/actions/DataView/TableView/flushCurrentRowData\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { IFocusable } from \"model/entities/FormFocusManager\";\r\nimport cx from \"classnames\";\r\nimport { Dropdowner } from \"gui/Components/Dropdowner/Dropdowner\";\r\nimport { Dropdown } from \"gui/Components/Dropdown/Dropdown\";\r\nimport { DropdownItem } from \"gui/Components/Dropdown/DropdownItem\";\r\nimport { T } from \"utils/translation\";\r\nimport CS from \"@origam/components/src/components/Dropdown/Dropdown.module.scss\"\r\nimport { runGeneratorInFlowWithHandler, runInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\nimport { ModalDialog } from \"gui/Components/Dialog/ModalDialog\";\r\n\r\n@inject(({property}: { property: IProperty }, {value}) => {\r\n  return {\r\n    api: getApi(property),\r\n    processCRUDResult: (result: any) => processCRUDResult(property, result),\r\n    changeManyFields: changeManyFields(property),\r\n    flushCurrentRowData: flushCurrentRowData(property),\r\n    handleError: handleError(property),\r\n    dialogStack: getDialogStack(property),\r\n    DataStructureEntityId: getDataStructureEntityId(property),\r\n    Property: property.id,\r\n    RowId: getSelectedRowId(property),\r\n    menuItemId: getMenuItemId(property),\r\n    Entity: getEntity(property),\r\n    SessionFormIdentifier: getSessionId(property),\r\n    parameters: property.parameters,\r\n  };\r\n})\r\n@observer\r\nexport class BlobEditor extends React.Component<{\r\n  value: string;\r\n  api?: IApi;\r\n  isReadOnly: boolean;\r\n  processCRUDResult?: IProcessCRUDResult;\r\n  changeManyFields?: (values: Array<{ fieldId: string; value: any }>) => Generator;\r\n  flushCurrentRowData?: () => Generator;\r\n  handleError?: (error: any) => Generator;\r\n  dialogStack?: IDialogStack;\r\n  DataStructureEntityId?: string;\r\n  Property?: string;\r\n  RowId?: string;\r\n  menuItemId?: string;\r\n  Entity?: string;\r\n  SessionFormIdentifier?: string;\r\n  parameters?: any;\r\n  subscribeToFocusManager?: (obj: IFocusable) => void;\r\n  canUpload: boolean;\r\n  onKeyDown?(event: any): void;\r\n  onChange?(event: any, value: string): void;\r\n  onEditorBlur?(event: any): void;\r\n}> {\r\n  elmInput: HTMLInputElement | null = null;\r\n  refInput = (elm: HTMLInputElement | any) => {\r\n    this.elmInput = elm;\r\n  };\r\n\r\n  @observable\r\n  focused = false;\r\n\r\n  componentDidMount() {\r\n    if (this.elmInput && this.props.subscribeToFocusManager) {\r\n      this.props.subscribeToFocusManager(this.elmInput);\r\n    }\r\n  }\r\n\r\n  handleFileChange(event: any) {\r\n    this.fileList = event.target.files;\r\n    flow(this.upload.bind(this))();\r\n  }\r\n\r\n  @observable.ref fileList: any = [];\r\n  @observable progressValue = 0;\r\n  @observable speedValue = 0;\r\n  @observable isUploading = false;\r\n\r\n  async download(args: { isPreview: boolean }) {\r\n    const token = await this.props.api!.getDownloadToken({\r\n      SessionFormIdentifier: this.props.SessionFormIdentifier!,\r\n      MenuId: this.props.menuItemId!,\r\n      DataStructureEntityId: this.props.DataStructureEntityId!,\r\n      Entity: this.props.Entity!,\r\n      RowId: this.props.RowId!,\r\n      Property: this.props.Property!,\r\n      FileName: this.props.value,\r\n      parameters: this.props.parameters,\r\n      isPreview: args.isPreview,\r\n    });\r\n    await this.props.api!.getBlob({downloadToken: token});\r\n  }\r\n\r\n  *upload(): any {\r\n    this.progressValue = 0;\r\n    this.speedValue = 0;\r\n    this.isUploading = true;\r\n    try {\r\n      if (this.fileList && this.fileList.length > 0) {\r\n        for (let file of this.fileList) {\r\n          const token = yield this.props.api!.getUploadToken({\r\n            SessionFormIdentifier: this.props.SessionFormIdentifier!,\r\n            MenuId: this.props.menuItemId!,\r\n            DataStructureEntityId: this.props.DataStructureEntityId!,\r\n            Entity: this.props.Entity!,\r\n            RowId: this.props.RowId!,\r\n            Property: this.props.Property!,\r\n            FileName: this.props.value,\r\n            parameters: this.props.parameters,\r\n            DateCreated: \"2010-01-01\",\r\n            DateLastModified: \"2010-01-01\",\r\n          });\r\n\r\n          let lastTime: number | undefined;\r\n          let lastSize: number = 0;\r\n          yield this.props.api!.putBlob(\r\n            {\r\n              uploadToken: token,\r\n              fileName: file.name,\r\n              file,\r\n            },\r\n            action((event: any) => {\r\n              this.progressValue = event.loaded / event.total;\r\n              if (lastTime !== undefined) {\r\n                this.speedValue = ((event.loaded - lastSize) / (event.timeStamp - lastTime)) * 1000;\r\n              }\r\n              lastTime = event.timeStamp;\r\n              lastSize = event.loaded;\r\n            })\r\n          );\r\n          const crudResult = yield this.props.api!.changes({\r\n            SessionFormIdentifier: this.props.SessionFormIdentifier!,\r\n            Entity: this.props.Entity!,\r\n            RowId: this.props.RowId!,\r\n          });\r\n          yield*this.props.processCRUDResult!(crudResult);\r\n        }\r\n      }\r\n    } catch (e) {\r\n      yield*this.props.handleError!(e);\r\n    } finally {\r\n      this.isUploading = false;\r\n      if (this.elmInput) this.elmInput.value = \"\";\r\n    }\r\n  }\r\n\r\n  *delete(): any {\r\n    if (\r\n      yield new Promise(\r\n        action((resolve: (value: boolean) => void) => {\r\n          const closeDialog = this.props.dialogStack!.pushDialog(\r\n            \"\",\r\n            <ModalDialog\r\n              title={T(\"Question\", \"question_title\")}\r\n              titleButtons={null}\r\n              buttonsCenter={\r\n                <>\r\n                  <button\r\n                    tabIndex={0}\r\n                    autoFocus={true}\r\n                    onClick={() => {\r\n                      closeDialog();\r\n                      resolve(true);\r\n                    }}\r\n                  >\r\n                    {T(\"Yes\", \"button_yes\")}\r\n                  </button>\r\n                  <button\r\n                    tabIndex={0}\r\n                    onClick={() => {\r\n                      closeDialog();\r\n                      resolve(false);\r\n                    }}\r\n                  >\r\n                    {T(\"No\", \"button_no\")}\r\n                  </button>\r\n                </>\r\n              }\r\n              buttonsLeft={null}\r\n              buttonsRight={null}\r\n            >\r\n              <div className={S.dialogContent}>\r\n                {T(\"Do you wish to delete {0}?\", \"blob_delete_confirmation\", this.props.value)}\r\n              </div>\r\n            </ModalDialog>\r\n          );\r\n        })\r\n      )\r\n    ) {\r\n      const {parameters} = this.props;\r\n      const changeSet: Array<{ fieldId: string; value: any }> = [];\r\n      changeSet.push({fieldId: this.props.Property!, value: null});\r\n      if (parameters[\"AuthorMember\"]) {\r\n        changeSet.push({fieldId: parameters[\"AuthorMember\"], value: null});\r\n      }\r\n      if (parameters[\"BlobMember\"]) {\r\n        changeSet.push({fieldId: parameters[\"BlobMember\"], value: null});\r\n      }\r\n      if (parameters[\"CompressionStateMember\"]) {\r\n        changeSet.push({fieldId: parameters[\"CompressionStateMember\"], value: null});\r\n      }\r\n      if (parameters[\"DateCreatedMember\"]) {\r\n        changeSet.push({fieldId: parameters[\"DateCreatedMember\"], value: null});\r\n      }\r\n      if (parameters[\"DateLastModifiedMember\"]) {\r\n        changeSet.push({fieldId: parameters[\"DateLastModifiedMember\"], value: null});\r\n      }\r\n      if (parameters[\"FileSizeMember\"]) {\r\n        changeSet.push({fieldId: parameters[\"FileSizeMember\"], value: null});\r\n      }\r\n      if (parameters[\"OriginalPathMember\"]) {\r\n        changeSet.push({fieldId: parameters[\"OriginalPathMember\"], value: null});\r\n      }\r\n      if (parameters[\"RemarkMember\"]) {\r\n        changeSet.push({fieldId: parameters[\"RemarkMember\"], value: null});\r\n      }\r\n      if (parameters[\"ThumbnailMember\"]) {\r\n        changeSet.push({fieldId: parameters[\"ThumbnailMember\"], value: null});\r\n      }\r\n      yield * this.props.changeManyFields!(changeSet);\r\n      yield * this.props.flushCurrentRowData!();\r\n    }\r\n  }\r\n\r\n  @observable displayImageEditor = false;\r\n  imageObjectUrl: any;\r\n\r\n  render() {\r\n    return (\r\n      <div className={S.editorContainer}>\r\n        {this.renderInput()}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private onFocus() {\r\n    this.focused = true;\r\n  }\r\n\r\n  private onBlur() {\r\n    this.focused = false;\r\n  }\r\n\r\n  private renderInput() {\r\n    if (this.props.isReadOnly && !this.props.value) {\r\n      return (\r\n        <div className={S.blobEditor}>\r\n          <input\r\n            readOnly={true}\r\n            className={\"fileName \" + (this.focused ? S.focusedBorder : S.standardBorder)}\r\n            value={this.props.value || \"\"}\r\n          />\r\n        </div>\r\n      );\r\n    }\r\n    if (!this.props.value) {\r\n      return (\r\n        <div className={S.blobEditor}>\r\n          <label className=\"customBtnChoose\" title={\"Upload new file.\"}>\r\n            <input\r\n              className=\"btnChooseFile\"\r\n              name=\"file\"\r\n              type=\"file\"\r\n              multiple={false}\r\n              onChange={(event) => this.handleFileChange(event)}\r\n              ref={this.refInput}\r\n              onFocus={() => this.onFocus()}\r\n              onBlur={() => this.onBlur()}\r\n              onKeyDown={(event) => this.props.onKeyDown && this.props.onKeyDown(event)}\r\n            />\r\n            {T(\"Upload\", \"blob_upload\")}\r\n          </label>\r\n          {this.isUploading && (\r\n            <div className=\"progress\">\r\n              <div className=\"progressBar\" style={{width: `${this.progressValue * 100}%`}}>\r\n                <div className=\"progressBar\" style={{width: `${this.progressValue * 100}%`}}>\r\n                  {(this.progressValue * 100).toFixed(0)}%\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className={S.blobEditor + \" \" + CS.control}>\r\n        <input\r\n          className={\"input \" + (this.focused ? S.focusedBorder : S.standardBorder)}\r\n          value={this.props.value || \"\"}\r\n          disabled={this.props.isReadOnly}\r\n          onChange={(event: any) =>\r\n            !this.props.isReadOnly && this.props.onChange && this.props.onChange(event, event.target.value)\r\n          }\r\n          onBlur={event => !this.props.isReadOnly && this.props.onEditorBlur && this.props.onEditorBlur(event)}\r\n        />\r\n        <div>\r\n          <Dropdowner\r\n            trigger={({refTrigger, setDropped, isDropped}) => (\r\n              <div className={CS.control} ref={refTrigger}>\r\n                <div\r\n                  className={cx(\"inputBtn\", \"lastOne\")}\r\n                  onClick={(event) => setDropped(true)}\r\n                >\r\n                  {!isDropped ? (\r\n                    <i className=\"fas fa-caret-down\"></i>\r\n                  ) : (\r\n                    <i className=\"fas fa-caret-up\"></i>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            )}\r\n            content={({setDropped}) => (\r\n              <Dropdown>\r\n                <DropdownItem\r\n                  onClick={(event: any) => {\r\n                    setDropped(false);\r\n                    runInFlowWithHandler({\r\n                      ctx: this.props.Property!,\r\n                      action: async () => await this.download({isPreview: false}),\r\n                    });\r\n                  }}\r\n                >\r\n                  {T(\"Download\", \"blob_download\")}\r\n                </DropdownItem>\r\n                <DropdownItem\r\n                  isDisabled={this.props.isReadOnly}\r\n                  onClick={(event: any) => {\r\n                    setDropped(false);\r\n                    runGeneratorInFlowWithHandler({\r\n                      ctx: this.props.Property!,\r\n                      generator: this.delete.bind(this)(),\r\n                    });\r\n                  }}\r\n                >\r\n                  {T(\"Delete\", \"blob_delete\")}\r\n                </DropdownItem>\r\n                <DropdownItem\r\n                  onClick={(event: any) => {\r\n                    setDropped(false);\r\n                    runInFlowWithHandler({\r\n                      ctx: this.props.Property!,\r\n                      action: async () => await this.download({isPreview: true}),\r\n                    });\r\n                  }}\r\n                >\r\n                  {T(\"Preview\", \"blob_preview\")}\r\n                </DropdownItem>\r\n              </Dropdown>\r\n            )}\r\n          />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { RefObject, useContext, useEffect, useRef, useState } from \"react\";\r\nimport S from \"./CheckList.module.scss\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { action, computed, flow, observable } from \"mobx\";\r\nimport { IApi } from \"model/entities/types/IApi\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { getDataStructureEntityId } from \"model/selectors/DataView/getDataStructureEntityId\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\nimport { getMenuItemId } from \"model/selectors/getMenuItemId\";\r\nimport { getEntity } from \"model/selectors/DataView/getEntity\";\r\nimport { getSessionId } from \"model/selectors/getSessionId\";\r\nimport { IFocusable } from \"../../../../model/entities/FormFocusManager\";\r\nimport cx from \"classnames\";\r\n\r\nexport interface IRawCheckListProps {\r\n  api: IApi;\r\n  value: string[];\r\n  onClick: () => void;\r\n  Entity: string;\r\n  SessionFormIdentifier: string;\r\n  DataStructureEntityId: string;\r\n  Identifier: string;\r\n  ColumnNames: string[];\r\n  Property: string;\r\n  RowId: string | undefined;\r\n  LookupId: string;\r\n  Parameters: any;\r\n  menuItemId: string;\r\n  isReadonly?: boolean;\r\n  subscribeToFocusManager?: (obj: IFocusable) => void;\r\n\r\n  onChange?(newValue: string[]): void;\r\n\r\n  onKeyDown(event: any): void;\r\n}\r\n\r\nexport class CheckListControler {\r\n  @observable lookupList: string[][] = [];\r\n\r\n  @computed get items() {\r\n    return this.lookupList.map((llitem) => ({\r\n      value: llitem[0],\r\n      label: llitem[1],\r\n    }));\r\n  }\r\n\r\n  @action.bound\r\n  loadLookupList() {\r\n    const self = this;\r\n    flow(function*() {\r\n      const lookupList = yield self.props.api.getLookupList({\r\n        Entity: self.props.Entity,\r\n        SessionFormIdentifier: self.props.SessionFormIdentifier,\r\n        DataStructureEntityId: self.props.DataStructureEntityId, // Data view entity identifier\r\n        ColumnNames: [self.props.Identifier || \"Id\", ...self.props.ColumnNames], // Columns to download\r\n        Property: self.props.Property!, // Columnn Id\r\n        Id: self.props.RowId!, // Id of the selected row\r\n        LookupId: self.props.LookupId!, // Id of the lookup object\r\n        Parameters: self.props.Parameters!,\r\n        MenuId: self.props.menuItemId!,\r\n        ShowUniqueValues: false,\r\n        SearchText: \"\",\r\n        PageSize: 10000,\r\n        PageNumber: 1,\r\n      });\r\n      self.lookupList = lookupList;\r\n    })();\r\n  }\r\n\r\n  @action.bound handleClick(event: any, item: { value: string; label: string }) {\r\n    event.preventDefault();\r\n    const currentIndex = this.props.value.findIndex((id) => item.value === id);\r\n    if (currentIndex > -1) {\r\n      const newValue = [...this.props.value];\r\n      newValue.splice(currentIndex, 1);\r\n      this.props.onChange && this.props.onChange(newValue);\r\n      return;\r\n    } else {\r\n      const newValue = [...this.props.value, item.value];\r\n      this.props.onChange && this.props.onChange(newValue);\r\n    }\r\n  }\r\n\r\n  @observable.ref props: IRawCheckListProps = undefined as any;\r\n}\r\n\r\nexport const CheckList: React.FC<{\r\n  value: string[];\r\n  onChange?(newValue: string[]): void;\r\n  isReadonly?: boolean;\r\n  subscribeToFocusManager?: (obj: IFocusable) => void;\r\n  onKeyDown(event: any): void;\r\n  onClick: () => void;\r\n}> = observer((props) => {\r\n  const {property} = useContext(MobXProviderContext);\r\n\r\n  return (\r\n    <CheckListRaw\r\n      value={props.value}\r\n      onChange={!props.isReadonly ? props.onChange : undefined}\r\n      api={getApi(property)}\r\n      DataStructureEntityId={getDataStructureEntityId(property)}\r\n      ColumnNames={property!.lookup.dropDownColumns.map((column: any) => column.id)}\r\n      Property={property.id}\r\n      Parameters={property!.lookup.parameters}\r\n      RowId={getSelectedRowId(property)}\r\n      Identifier={property.identifier}\r\n      LookupId={property!.lookup.lookupId}\r\n      menuItemId={getMenuItemId(property)}\r\n      Entity={getEntity(property)}\r\n      SessionFormIdentifier={getSessionId(property)}\r\n      isReadonly={props.isReadonly}\r\n      subscribeToFocusManager={props.subscribeToFocusManager}\r\n      onKeyDown={props.onKeyDown}\r\n      onClick={props.onClick}\r\n    />\r\n  );\r\n});\r\n\r\nexport const CheckListRaw: React.FC<IRawCheckListProps> = observer((props) => {\r\n  const [controller] = useState(() => new CheckListControler());\r\n  controller.props = props;\r\n\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  useEffect(controller.loadLookupList, [props.RowId]);\r\n\r\n  const inputRefs: InputReference[] = [];\r\n\r\n  function focusLeft(x: number, y: number) {\r\n    const inputsOnTheLeft = inputRefs\r\n      .filter((input) => input.hasYEqualTo(y) && input.isOnTheLeftOf(x))\r\n      .sort((i1, i2) => i2.x - i1.x);\r\n\r\n    if (inputsOnTheLeft.length > 0) {\r\n      inputsOnTheLeft[0].focus();\r\n    }\r\n  }\r\n\r\n  function focusRight(x: number, y: number) {\r\n    const inputsOnTheRight = inputRefs\r\n      .filter((input) => input.hasYEqualTo(y) && input.isOnTheRightOf(x))\r\n      .sort((i1, i2) => i1.x - i2.x);\r\n\r\n    if (inputsOnTheRight.length > 0) {\r\n      inputsOnTheRight[0].focus();\r\n    }\r\n  }\r\n\r\n  function focusUp(x: number, y: number) {\r\n    const inputsAbove = inputRefs\r\n      .filter((input) => input.hasXEqualTo(x) && input.isAbove(y))\r\n      .sort((i1, i2) => i2.y - i1.y);\r\n\r\n    if (inputsAbove.length > 0) {\r\n      inputsAbove[0].focus();\r\n    }\r\n  }\r\n\r\n  function focusDown(x: number, y: number) {\r\n    const inputsBelow = inputRefs\r\n      .filter((input) => input.hasXEqualTo(x) && input.isBelow(y))\r\n      .sort((i1, i2) => i1.y - i2.y);\r\n\r\n    if (inputsBelow.length > 0) {\r\n      inputsBelow[0].focus();\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className={S.editorContainer}>\r\n      <div className={cx(S.root, {isReadonly: props.isReadonly})}>\r\n        {controller.items.map((item, i) => (\r\n          <CheckListItem\r\n            key={item.value}\r\n            checked={props.value && !!props.value.find((v) => v === item.value)}\r\n            onClick={(event) => {\r\n              props.onClick();\r\n              if (!props.isReadonly) {\r\n                controller.handleClick(event, item);\r\n              }\r\n            }}\r\n            // tabIndex={i === 0 ? props.tabIndex : -1}\r\n            subscribeToFocusManager={i === 0 ? props.subscribeToFocusManager : undefined}\r\n            inputSetter={(inputRef: InputReference) => inputRefs.push(inputRef)}\r\n            focusLeft={focusLeft}\r\n            focusRight={focusRight}\r\n            focusUp={focusUp}\r\n            focusDown={focusDown}\r\n            onKeyDown={!props.isReadonly ? props.onKeyDown : undefined}\r\n            label={item.label}\r\n          />\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nexport const CheckListItem: React.FC<{\r\n  checked: boolean;\r\n  onClick?(event: any): void;\r\n  tabIndex?: number;\r\n  inputSetter: (inputRef: InputReference) => void;\r\n  focusLeft: (x: number, y: number) => void;\r\n  focusRight: (x: number, y: number) => void;\r\n  focusUp: (x: number, y: number) => void;\r\n  focusDown: (x: number, y: number) => void;\r\n  label: string;\r\n  subscribeToFocusManager?: (obj: IFocusable) => void;\r\n  onKeyDown?(event: any): void;\r\n}> = (props) => {\r\n  const [isFocused, setIsFocused] = useState<boolean>(false);\r\n\r\n  const refInput = useRef<HTMLInputElement>(null);\r\n  props.inputSetter(new InputReference(refInput));\r\n\r\n  useEffect(() => {\r\n    if (props.subscribeToFocusManager && refInput.current) {\r\n      props.subscribeToFocusManager(refInput.current);\r\n    }\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  function onKeyDown(event: any) {\r\n    const boundingRect = refInput.current?.getBoundingClientRect()!;\r\n    switch (event.key) {\r\n      case \"Tab\":\r\n        props.onKeyDown?.(event);\r\n        break;\r\n      case \"ArrowUp\":\r\n        event.preventDefault();\r\n        props.focusUp(boundingRect.x, boundingRect.y);\r\n        break;\r\n      case \"ArrowDown\":\r\n        event.preventDefault();\r\n        props.focusDown(boundingRect.x, boundingRect.y);\r\n        break;\r\n      case \"ArrowRight\":\r\n        event.preventDefault();\r\n        props.focusRight(boundingRect.x, boundingRect.y);\r\n        break;\r\n      case \"ArrowLeft\":\r\n        event.preventDefault();\r\n        props.focusLeft(boundingRect.x, boundingRect.y);\r\n        break;\r\n    }\r\n  }\r\n\r\n  function onInputFocus() {\r\n    setIsFocused(true);\r\n  }\r\n\r\n  function onInputBlur() {\r\n    setIsFocused(false);\r\n  }\r\n\r\n  function onClick(event: any) {\r\n    props.onClick && props.onClick(event);\r\n    refInput?.current?.focus();\r\n  }\r\n\r\n\r\n  return (\r\n    <div className={S.item} onClick={onClick}>\r\n      <input\r\n        ref={refInput}\r\n        type=\"checkbox\"\r\n        className={\"checkbox \" + S.input}\r\n        checked={props.checked}\r\n        tabIndex={props.tabIndex ? props.tabIndex : undefined}\r\n        onKeyDown={onKeyDown}\r\n        onFocus={onInputFocus}\r\n        onBlur={onInputBlur}\r\n      />\r\n      <div className={\"content \" + (isFocused ? S.focusedLabel : S.unFocusedLabel)}>\r\n        {props.label}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nclass InputReference {\r\n  constructor(private inputRef: RefObject<HTMLInputElement>) {\r\n  }\r\n\r\n  get x() {\r\n    return this.inputRef.current?.getBoundingClientRect()!.x || 0;\r\n  }\r\n\r\n  get y() {\r\n    return this.inputRef.current?.getBoundingClientRect()!.y || 0;\r\n  }\r\n\r\n  hasXEqualTo(x: number) {\r\n    return Math.abs(this.x - x) < 1;\r\n  }\r\n\r\n  hasYEqualTo(y: number) {\r\n    return Math.abs(this.y - y) < 1;\r\n  }\r\n\r\n  isOnTheLeftOf(x: number) {\r\n    return this.x < x;\r\n  }\r\n\r\n  isOnTheRightOf(x: number) {\r\n    return this.x > x;\r\n  }\r\n\r\n  isAbove(y: number) {\r\n    return this.y < y;\r\n  }\r\n\r\n  isBelow(y: number) {\r\n    return this.y > y;\r\n  }\r\n\r\n  focus() {\r\n    this.inputRef.current?.focus();\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { inject, observer } from \"mobx-react\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { getSessionId } from \"model/selectors/getSessionId\";\r\nimport { getEntity } from \"model/selectors/DataView/getEntity\";\r\nimport { getMenuItemId } from \"model/selectors/getMenuItemId\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\nimport { getDataStructureEntityId } from \"model/selectors/DataView/getDataStructureEntityId\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport S from \"./ImageEditor.module.scss\";\r\nimport { processedImageURL } from \"utils/image\";\r\n\r\n@inject(({property}: { property: IProperty }, {value}) => {\r\n  return {\r\n    api: getApi(property),\r\n    DataStructureEntityId: getDataStructureEntityId(property),\r\n    Property: property.id,\r\n    RowId: getSelectedRowId(property),\r\n    Identifier: property.identifier,\r\n    MenuId: getMenuItemId(property),\r\n    Entity: getEntity(property),\r\n    SessionFormIdentifier: getSessionId(property),\r\n  };\r\n})\r\n@observer\r\nexport class ImageEditor extends React.Component<{\r\n  value: string;\r\n}> {\r\n  render() {\r\n    const preparedUrl = processedImageURL(this.props.value).value;\r\n    return preparedUrl ? <img className={S.image} src={preparedUrl} alt=\"\"/> : null;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action } from \"mobx\";\r\nimport * as React from \"react\";\r\nimport S from \"./NumberEditor.module.scss\";\r\nimport cx from \"classnames\";\r\nimport {\r\n  formatNumber,\r\n  getCurrentDecimalSeparator,\r\n  getCurrentGroupSeparator,\r\n} from \"../../../../model/entities/NumberFormating\";\r\nimport { IFocusable } from \"../../../../model/entities/FormFocusManager\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { runInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\n\r\nexport class NumberEditor extends React.Component<{\r\n  value: string | number | null;\r\n  isReadOnly: boolean;\r\n  isPassword?: boolean;\r\n  property?: IProperty;\r\n  backgroundColor?: string;\r\n  foregroundColor?: string;\r\n  customNumberFormat?: string | undefined;\r\n  maxLength?: number;\r\n  customStyle?: any;\r\n  onChange?(event: any, value: string | null): Promise<void>;\r\n  onKeyDown?(event: any): void;\r\n  onClick?(event: any): void;\r\n  onDoubleClick?(event: any): void;\r\n  onEditorBlur?(event: any): void;\r\n  subscribeToFocusManager?: (obj: IFocusable) => void;\r\n  onTextOverflowChanged?: (toolTip: string | null | undefined) => void;\r\n  id?: string\r\n}> {\r\n  state = { value: this.formatForDisplay(this.props.value), cursorPosition: 0};\r\n  disposer: undefined | (()=> void);\r\n  inputRef = React.createRef<HTMLInputElement>();\r\n\r\n  formatForDisplay(value: string | number | null){\r\n    let rawValue = value === null ? \"0\" : value;\r\n    if(typeof value === \"string\"){\r\n      rawValue = value\r\n        .replaceAll(getCurrentGroupSeparator(), \"\")\r\n        .replaceAll(getCurrentDecimalSeparator(), \".\")\r\n      if(value.trim() === \"\"){\r\n        rawValue = \"0\";\r\n      }\r\n    }\r\n    return formatNumber(\r\n      this.props.customNumberFormat,\r\n      this.props.property?.entity ?? \"\",\r\n      Number(rawValue)\r\n    );\r\n  }\r\n\r\n  formatForOnChange(value: string | number | null){\r\n    return this.formatForDisplay(value)\r\n      .replaceAll(getCurrentGroupSeparator(), \"\")\r\n      .replaceAll(getCurrentDecimalSeparator(), \".\");\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (this.inputRef.current && this.props.subscribeToFocusManager) {\r\n      this.props.subscribeToFocusManager(this.inputRef.current);\r\n    }\r\n    this.updateTextOverflowState();\r\n  }\r\n\r\n  componentDidUpdate(prevProps: { value: any }) {\r\n    if (this.props.value !== prevProps.value) {\r\n      this.setState(\r\n        { value: this.formatForDisplay(this.props.value)}\r\n      );\r\n    }\r\n    this.updateTextOverflowState();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.handleBlur(null);\r\n    this.disposer?.();\r\n  }\r\n\r\n  @action.bound\r\n  handleFocus(event: any) {\r\n    if (this.inputRef.current) {\r\n      this.inputRef.current.select();\r\n      this.inputRef.current.scrollLeft = 0;\r\n    }\r\n  }\r\n\r\n  updateTextOverflowState() {\r\n    if (!this.inputRef.current) {\r\n      return;\r\n    }\r\n    const textOverflow = this.inputRef.current.offsetWidth < this.inputRef.current.scrollWidth\r\n    this.props.onTextOverflowChanged?.(textOverflow ? this.state.value : undefined);\r\n  }\r\n\r\n  @action.bound\r\n  async handleBlur(event: any) {\r\n    await runInFlowWithHandler({\r\n      ctx: this.props.property,\r\n      action: async () => {\r\n        let value = this.formatForOnChange(this.state.value);\r\n        if(this.formatForOnChange(this.props.value) !== value){\r\n          this.props.onChange && await this.props.onChange(null, value);\r\n        }\r\n        this.props.onEditorBlur?.(event);\r\n        this.setState(\r\n          { value: this.formatForDisplay(this.state.value)}\r\n        );\r\n      }})\r\n  }\r\n\r\n  @action.bound handleChange(event: any) {\r\n    const {cleanValue, invalidCharactersBeforeCursor} = getValidCharacters(event);\r\n\r\n    const newState = isValidNumber(cleanValue)\r\n      ? { value: cleanValue, cursorPosition: event.target.selectionStart - invalidCharactersBeforeCursor }\r\n      : { value: this.state.value, cursorPosition: event.target.selectionStart - 1 };\r\n\r\n    this.setState(\r\n      newState,\r\n      () => {\r\n        if(this.inputRef.current){\r\n          this.inputRef.current.selectionStart = this.state.cursorPosition;\r\n          this.inputRef.current.selectionEnd =  this.state.cursorPosition;\r\n        }\r\n      });\r\n\r\n    this.updateTextOverflowState();\r\n  }\r\n\r\n  @action.bound\r\n  async handleKeyDown(event: any) {\r\n    await runInFlowWithHandler({\r\n      ctx: this.props.property,\r\n      action: async () => {\r\n        if (event.key === \"Enter\" || event.key === \"Tab\"){\r\n          let value = this.formatForOnChange(this.state.value);\r\n          if(this.formatForOnChange(this.props.value) !== value){\r\n            this.props.onChange && await this.props.onChange(null, value);\r\n          }\r\n        }\r\n        this.props.onKeyDown && this.props.onKeyDown(event);\r\n      }})\r\n  }\r\n\r\n  getStyle() {\r\n    if (this.props.customStyle) {\r\n      return this.props.customStyle;\r\n    } else {\r\n      return {\r\n        color: this.props.foregroundColor,\r\n        backgroundColor: this.props.backgroundColor,\r\n      };\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const maxLength = (this.props.maxLength === 0 ? undefined : this.props.maxLength) || undefined;\r\n    return (\r\n      <div className={S.editorContainer}>\r\n        <input\r\n          id={this.props.id}\r\n          style={this.getStyle()}\r\n          title={this.props.customNumberFormat || undefined}\r\n          className={cx(S.input)}\r\n          type={this.props.isPassword ? \"password\" : \"text\"}\r\n          autoComplete={this.props.isPassword ? \"new-password\" : undefined}\r\n          value={this.state.value}\r\n          maxLength={maxLength}\r\n          readOnly={this.props.isReadOnly}\r\n          ref={this.inputRef}\r\n          onChange={this.handleChange}\r\n          onKeyDown={this.handleKeyDown}\r\n          onClick={this.props.onClick}\r\n          onDoubleClick={this.props.onDoubleClick}\r\n          onBlur={this.handleBlur}\r\n          onFocus={this.handleFocus}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nfunction getValidCharacters(event: any){\r\n  const cleanChars = [];\r\n  let invalidCharactersBeforeCursor = 0;\r\n  for (let i = 0; i < event.target.value.length; i++) {\r\n    const char = event.target.value[i];\r\n    if(isValidCharacter(char)){\r\n      cleanChars.push(char)\r\n    }else{\r\n      if(i < event.target.selectionStart){\r\n        invalidCharactersBeforeCursor++;\r\n      }\r\n    }\r\n  }\r\n  return {\r\n    cleanValue:cleanChars.join(\"\"),\r\n    invalidCharactersBeforeCursor: invalidCharactersBeforeCursor\r\n  };\r\n}\r\n\r\nfunction isValidNumber(value: string){\r\n  let formattedValue = value\r\n    .replaceAll(getCurrentGroupSeparator(), \"\")\r\n    .replaceAll(getCurrentDecimalSeparator(), \".\");\r\n  return !isNaN(Number(formattedValue))\r\n}\r\n\r\nfunction isValidCharacter(char: string){\r\n  if(\r\n    char === getCurrentDecimalSeparator() ||\r\n    char === getCurrentGroupSeparator()\r\n  ) {\r\n    return true;\r\n  }\r\n  return !isNaN(parseInt(char, 10))\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport * as React from \"react\";\r\nimport { useCallback, useEffect, useState } from \"react\";\r\nimport S from \"./TextEditor.module.scss\";\r\nimport { IFocusable } from \"../../../../model/entities/FormFocusManager\";\r\n\r\nimport { ContentState, convertToRaw, EditorState } from \"draft-js\";\r\nimport { Editor } from \"react-draft-wysiwyg\";\r\nimport draftToHtml from \"draftjs-to-html\";\r\nimport htmlToDraft from \"html-to-draftjs\";\r\n\r\nimport \"react-draft-wysiwyg/dist/react-draft-wysiwyg.css\";\r\nimport { IDockType } from \"model/entities/types/IProperty\";\r\n\r\nconst autoUpdateUntervalMs = 60_000;\r\n\r\n@observer\r\nexport class TextEditor extends React.Component<{\r\n  id?: string;\r\n  value: string | null;\r\n  isMultiline?: boolean;\r\n  isReadOnly: boolean;\r\n  isPassword?: boolean;\r\n  backgroundColor?: string;\r\n  foregroundColor?: string;\r\n  maxLength?: number;\r\n  isRichText: boolean;\r\n  customStyle?: any;\r\n  wrapText: boolean;\r\n  subscribeToFocusManager?: (obj: IFocusable) => void;\r\n  onChange?(event: any, value: string): void;\r\n  onKeyDown?(event: any): void;\r\n  onClick?(event: any): void;\r\n  onDoubleClick?(event: any): void;\r\n  onEditorBlur?(event: any): void;\r\n  onAutoUpdate?(value: string): void;\r\n  onTextOverflowChanged?: (toolTip: string | null | undefined) => void;\r\n  dock?: IDockType;\r\n}> {\r\n  disposers: any[] = [];\r\n  currentValue = this.props.value;\r\n  lastAutoUpdatedValue = this.props.value;\r\n  updateInterval: NodeJS.Timeout | undefined;\r\n\r\n  componentDidMount() {\r\n    if (this.props.isMultiline) {\r\n      this.disposers.push(this.startAutoUpdate());\r\n    }\r\n    this.updateTextOverflowState();\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.updateTextOverflowState();\r\n  }\r\n\r\n  private updateTextOverflowState() {\r\n    if (this.props.isMultiline || !this.elmInput) {\r\n      return;\r\n    }\r\n    const textOverflow = this.elmInput.offsetWidth < this.elmInput.scrollWidth\r\n    this.props.onTextOverflowChanged?.(textOverflow ? this.props.value : undefined);\r\n  }\r\n\r\n  private startAutoUpdate() {\r\n    this.updateInterval = setInterval(() => {\r\n      if (this.lastAutoUpdatedValue !== this.currentValue) {\r\n        this.props.onAutoUpdate?.(this.currentValue ?? \"\");\r\n        this.lastAutoUpdatedValue = this.currentValue;\r\n      }\r\n    }, autoUpdateUntervalMs);\r\n    return () => this.updateInterval && clearTimeout(this.updateInterval);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.disposers.forEach((d) => d());\r\n  }\r\n\r\n  @action.bound\r\n  handleFocus(event: any) {\r\n    if (this.elmInput) {\r\n      const isNotMemoField = this.props.maxLength && this.props.maxLength > 0;\r\n      if (isNotMemoField) {\r\n        this.elmInput.select();\r\n      }\r\n      this.elmInput.scrollLeft = 0;\r\n    }\r\n  }\r\n\r\n  elmInput: any = null;\r\n  refInput = (elm: any) => {\r\n    this.elmInput = elm;\r\n    if (this.elmInput && this.props.subscribeToFocusManager) {\r\n      this.props.subscribeToFocusManager(this.elmInput);\r\n    }\r\n  };\r\n\r\n  getStyle() {\r\n    if (this.props.customStyle) {\r\n      return this.props.customStyle;\r\n    } else {\r\n      return {\r\n        color: this.props.foregroundColor,\r\n        backgroundColor: this.props.backgroundColor,\r\n      };\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className={S.editorContainer}>\r\n        {this.renderValueTag()}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  getMultilineDivClass() {\r\n    if (this.props.wrapText) {\r\n      return S.readonlyDiv + \" \" + S.input + \" \" + S.wrapText;\r\n    }\r\n    return S.readonlyDiv + \" \" + S.input + \" \" + (isMultiLine(this.props.value) ? S.scrollY : S.noScrollY);\r\n  }\r\n\r\n  private renderValueTag() {\r\n    const maxLength = this.props.maxLength === 0 ? undefined : this.props.maxLength;\r\n    if (this.props.isRichText) {\r\n      if (this.props.isReadOnly) {\r\n        return (\r\n          <div className={S.editorContainer}>\r\n            <div\r\n              id={this.props.id}\r\n              style={this.getStyle()}\r\n              className={S.input}\r\n              dangerouslySetInnerHTML={{__html: this.props.value ?? \"\"}}\r\n              onKeyDown={this.props.onKeyDown}\r\n              onClick={this.props.onClick}\r\n              onDoubleClick={this.props.onDoubleClick}\r\n              onBlur={this.props.onEditorBlur}\r\n              onFocus={this.handleFocus}\r\n            />\r\n          </div>\r\n        );\r\n      } else {\r\n        return (\r\n          <div className={S.richTextWrappContainer} >\r\n              <RichTextEditor \r\n                value={this.props.value ?? \"\"}\r\n                onChange={(newValue: any) => {\r\n                  this.currentValue = newValue;\r\n                  this.props.onChange?.(undefined, newValue);\r\n                }}\r\n                refInput={this.refInput}\r\n                onBlur={this.props.onEditorBlur}\r\n                onFocus={this.handleFocus}\r\n              />\r\n          </div>\r\n        );\r\n      }\r\n    }\r\n    if (!this.props.isMultiline) {\r\n      return (\r\n        <input\r\n          id={this.props.id}\r\n          style={this.getStyle()}\r\n          className={S.input}\r\n          type={this.props.isPassword ? \"password\" : \"text\"}\r\n          autoComplete={this.props.isPassword ? \"new-password\" : undefined}\r\n          value={this.props.value || \"\"}\r\n          readOnly={this.props.isReadOnly}\r\n          maxLength={maxLength}\r\n          ref={this.refInput}\r\n          onChange={(event: any) => {\r\n            this.props.onChange && this.props.onChange(event, event.target.value)\r\n            this.updateTextOverflowState();\r\n          }\r\n          }\r\n          onKeyDown={this.props.onKeyDown}\r\n          onClick={this.props.onClick}\r\n          onDoubleClick={this.props.onDoubleClick}\r\n          onBlur={this.props.onEditorBlur}\r\n          onFocus={this.handleFocus}\r\n        />\r\n      );\r\n    }\r\n    if (this.props.isReadOnly) {\r\n      return (\r\n        <div\r\n          id={this.props.id}\r\n          className={this.getMultilineDivClass()}\r\n          onClick={this.props.onClick}\r\n          onDoubleClick={this.props.onDoubleClick}\r\n          onBlur={this.props.onEditorBlur}\r\n          onFocus={this.handleFocus}\r\n        >\r\n          <span style={this.getStyle()} className={S.multiLine}>\r\n            {this.props.value || \"\"}\r\n          </span>\r\n        </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <textarea\r\n          id={this.props.id}\r\n          style={this.getStyle()}\r\n          className={S.input}\r\n          value={this.props.value || \"\"}\r\n          readOnly={this.props.isReadOnly}\r\n          ref={this.refInput}\r\n          maxLength={maxLength}\r\n          onChange={(event: any) => {\r\n            this.currentValue = event.target.value;\r\n            this.props.onChange && this.props.onChange(event, event.target.value);\r\n          }}\r\n          onKeyDown={this.props.onKeyDown}\r\n          onDoubleClick={this.props.onDoubleClick}\r\n          onClick={this.props.onClick}\r\n          onBlur={this.props.onEditorBlur}\r\n          onFocus={this.handleFocus}\r\n        />\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nfunction isMultiLine(text: string | null) {\r\n  if (text === null || text === undefined) {\r\n    return false;\r\n  }\r\n  return text.includes(\"\\n\") || text.includes(\"\\r\");\r\n}\r\n\r\nfunction RichTextEditor(props: {\r\n  value: any;\r\n  onChange?: (newValue: any) => void;\r\n  onBlur?: (event: any) => void;\r\n  onFocus?: (event: any) => void;\r\n  refInput?: (elm: any) => void;\r\n}) {\r\n  const [internalEditorState, setInternalEditorState] = useState(() => EditorState.createEmpty());\r\n  const [internalEditorStateHtml, setInternalEditorStateHtml] = useState(\"\");\r\n\r\n\r\n  const onEditorStateChange = useCallback(\r\n    (newEditorState: any) => {\r\n      setInternalEditorState(newEditorState);\r\n      const html = draftToHtml(convertToRaw(newEditorState.getCurrentContent()));\r\n      setInternalEditorStateHtml(html);\r\n      props.onChange?.(html);\r\n    },\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    [setInternalEditorState, setInternalEditorStateHtml, props.onChange]\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (props.refInput) {\r\n      props.refInput(document.querySelector(\"[role='textbox']\"));\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (props.value !== internalEditorStateHtml) {\r\n      const blocksFromHtml = htmlToDraft(props.value);\r\n      const {contentBlocks, entityMap} = blocksFromHtml;\r\n      const contentState = ContentState.createFromBlockArray(contentBlocks, entityMap);\r\n      const editorState = EditorState.createWithContent(contentState);\r\n      setInternalEditorStateHtml(props.value);\r\n      setInternalEditorState(editorState);\r\n    }\r\n  }, [props.value, internalEditorStateHtml]);\r\n\r\n  return (\r\n        <Editor\r\n          editorState={internalEditorState}\r\n          wrapperClassName={S.richTextWrappStyle}\r\n          editorClassName={S.richTextEditorStyle}\r\n          onEditorStateChange={onEditorStateChange}\r\n          onBlur={props.onBlur}\r\n        />\r\n  );\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flushCurrentRowData } from \"../../../actions/DataView/TableView/flushCurrentRowData\";\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { crs_fieldBlur_ActionClick } from \"model/actions/actionSync\";\r\n\r\nexport function onFieldBlur(ctx: any) {\r\n  return flow(function*onFieldBlur(event: any) {\r\n    try {\r\n      yield*crs_fieldBlur_ActionClick.runGenerator(function*() {\r\n        yield*flushCurrentRowData(ctx)();\r\n      });\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport * as React from \"react\";\r\nimport { observer } from \"mobx-react\";\r\nimport S from \"./BoolEditor.module.scss\";\r\nimport cx from \"classnames\";\r\nimport { IFocusable } from \"../../../../model/entities/FormFocusManager\";\r\n\r\n@observer\r\nexport class BoolEditor extends React.Component<{\r\n  value: boolean;\r\n  isReadOnly: boolean;\r\n  readOnlyNoGrey?: boolean;\r\n  onChange?(event: any, value: boolean): void;\r\n  onKeyDown?(event: any): void;\r\n  onClick?(event: any): void;\r\n  onBlur?: () => void;\r\n  onFocus?: () => void;\r\n  id?: string;\r\n  subscribeToFocusManager?: (obj: IFocusable) => void;\r\n}> {\r\n  elmInput: HTMLInputElement | null = null;\r\n  refInput = (elm: HTMLInputElement | any) => {\r\n    this.elmInput = elm;\r\n  };\r\n\r\n  componentDidMount() {\r\n    if (this.elmInput && this.props.subscribeToFocusManager) {\r\n      this.props.subscribeToFocusManager(this.elmInput);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className={cx(S.editorContainer)}>\r\n        <input\r\n          id={this.props.id ? this.props.id : undefined}\r\n          className=\"editor\"\r\n          type=\"checkbox\"\r\n          checked={this.props.value || false}\r\n          readOnly={!this.props.readOnlyNoGrey && this.props.isReadOnly}\r\n          disabled={!this.props.readOnlyNoGrey && this.props.isReadOnly}\r\n          onChange={(event: any) => {\r\n            this.props.onChange &&\r\n            !this.props.isReadOnly &&\r\n            this.props.onChange(event, event.target.checked);\r\n          }}\r\n          onKeyDown={this.props.onKeyDown}\r\n          onClick={this.props.onClick}\r\n          onBlur={this.props.onBlur}\r\n          onFocus={this.props.onFocus}\r\n          ref={this.refInput}\r\n          tabIndex={0}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Dropdowner } from \"gui/Components/Dropdowner/Dropdowner\";\r\nimport { action, observable, runInAction } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport S from \"./ColorEditor.module.scss\";\r\nimport { ColorResult, SketchPicker } from \"react-color\";\r\nimport { createMachine, interpret } from \"xstate\";\r\n\r\nimport { IFocusable } from \"model/entities/FormFocusManager\";\r\n\r\n@observer\r\nexport default class ColorEditor extends React.Component<{\r\n  value: string | null;\r\n  isReadOnly?: boolean;\r\n  onChange?: (value: string | null) => void;\r\n  onFocus?: () => void;\r\n  onBlur?: () => void;\r\n  onKeyDown?(event: any): void;\r\n  subscribeToFocusManager?: (obj: IFocusable) => void;\r\n}> {\r\n  refContainer = (elm: any) => (this.elmContainer = elm);\r\n  elmContainer: any;\r\n\r\n  refDropdowner = (elm: any) => (this.elmDropdowner = elm);\r\n  elmDropdowner: Dropdowner | null = null;\r\n  refDroppedPanelContainer = (elm: any) => (this.elmDroppedPanelContainer = elm);\r\n  elmDroppedPanelContainer: any;\r\n\r\n  elmInput: any = null;\r\n  refInput = (elm: any) => {\r\n    this.elmInput = elm;\r\n    if (this.elmInput && this.props.subscribeToFocusManager) {\r\n      this.props.subscribeToFocusManager(this.elmInput);\r\n    }\r\n  };\r\n\r\n  constructor(props: any) {\r\n    super(props);\r\n    this.revertAppliedValue();\r\n  }\r\n\r\n  componentDidUpdate(prevProps: any) {\r\n    runInAction(() => {\r\n      if (prevProps.value !== this.props.value) {\r\n        this.revertAppliedValue();\r\n      }\r\n    });\r\n  }\r\n\r\n  machine = interpret(\r\n    createMachine(\r\n      {\r\n        id: \"colorEditor\",\r\n        type: \"parallel\",\r\n        states: {\r\n          UI: {\r\n            initial: \"CLOSED_INACTIVE\",\r\n            states: {\r\n              CLOSED_INACTIVE: {\r\n                on: {\r\n                  DROPDOWN_SYMBOL_MOUSE_DOWN: {\r\n                    actions: \"setDroppedDown\",\r\n                  },\r\n                  PICKER_DROPPED_DOWN: \"OPEN\",\r\n                  INPUT_FIELD_FOCUS: \"CLOSED_ACTIVE\",\r\n                },\r\n              },\r\n              CLOSED_ACTIVE: {\r\n                on: {\r\n                  DROPDOWN_SYMBOL_MOUSE_DOWN: {\r\n                    actions: \"setDroppedDown\",\r\n                  },\r\n                  PICKER_DROPPED_DOWN: \"OPEN\",\r\n                  INPUT_FIELD_BLUR: {\r\n                    actions: [\"signalComponentBlur\", \"commitAppliedValue\"],\r\n                    target: \"CLOSED_INACTIVE\",\r\n                  },\r\n                  INPUT_FIELD_KEY_DOWN: [\r\n                    {\r\n                      actions: \"commitAppliedValue\",\r\n                      cond: \"eventKeyIsEnter\",\r\n                    },\r\n                    {\r\n                      actions: \"revertAppliedValue\",\r\n                      cond: \"eventKeyIsEscape\",\r\n                    },\r\n                  ],\r\n                },\r\n                /*after: {\r\n                  100: {\r\n                    actions: \"focusInputField\",\r\n                  },\r\n                },*/\r\n              },\r\n              OPEN: {\r\n                entry: \"pickValueFromApplied\",\r\n                on: {\r\n                  PICKER_KEY_DOWN: [\r\n                    {\r\n                      actions: [\"applyPickedValue\", \"commitAppliedValue\", \"setDroppedUp\"],\r\n                      cond: \"eventKeyIsEnter\",\r\n                    },\r\n                    {\r\n                      cond: \"eventKeyIsEscape\",\r\n                      actions: [\"setDroppedUp\"],\r\n                    },\r\n                  ],\r\n                  PICKER_OUTSIDE_INTERACTION: {\r\n                    target: \"CLOSED_INACTIVE\",\r\n                    actions: [\r\n                      \"applyPickedValue\",\r\n                      \"commitAppliedValue\",\r\n                      \"signalComponentBlur\",\r\n                      \"setDroppedUp\",\r\n                    ],\r\n                  },\r\n                  PICKER_DROPPED_UP: {\r\n                    target: \"CLOSED_ACTIVE\",\r\n                  },\r\n                },\r\n                after: {\r\n                  100: {\r\n                    actions: \"focusPickerContainer\",\r\n                  },\r\n                },\r\n              },\r\n            },\r\n          },\r\n        },\r\n      },\r\n      {\r\n        actions: {\r\n          applyPickedValue: (ctx, event) => {\r\n            this.applyPickedValue();\r\n          },\r\n          commitAppliedValue: (ctx, event) => {\r\n            this.commitAppliedValue();\r\n          },\r\n          revertAppliedValue: (ctx, event) => {\r\n            this.revertAppliedValue();\r\n          },\r\n          pickValueFromApplied: (ctx, event) => {\r\n            this.pickValueFromApplied();\r\n          },\r\n          setDroppedDown: (ctx, event) => {\r\n            this.setDropped(true);\r\n          },\r\n          setDroppedUp: (ctx, event) => {\r\n            this.setDropped(false);\r\n          },\r\n          focusPickerContainer: (ctx, event) => {\r\n            this.elmDroppedPanelContainer?.focus();\r\n          },\r\n          focusInputField: (ctx, event) => {\r\n            this.elmInput?.select();\r\n          },\r\n          signalComponentBlur: (ctx, event) => {\r\n            this.props.onBlur?.();\r\n          },\r\n        },\r\n        guards: {\r\n          eventKeyIsEnter: (ctx, event) => {\r\n            return event.payload.event.key === \"Enter\";\r\n          },\r\n          eventKeyIsEscape: (ctx, event) => {\r\n            return event.payload.event.key === \"Escape\";\r\n          },\r\n        },\r\n      }\r\n    )\r\n  )\r\n    .onTransition((state, event) => {\r\n      if (state.changed) {\r\n        this.machineState = state;\r\n      }\r\n    })\r\n    .start();\r\n\r\n  @observable machineState = this.machine.state;\r\n\r\n  @action.bound setDropped(state: boolean) {\r\n    this.elmDropdowner?.setDropped(state);\r\n  }\r\n\r\n  get isDroppedDown() {\r\n    return this.machineState.matches(\"UI.OPEN\");\r\n  }\r\n\r\n  @observable pickedColor: string | null = \"#000000\";\r\n  @observable appliedValue: string | null = \"#000000\";\r\n\r\n  @action.bound\r\n  handleColorChange(colorResult: ColorResult, event: any) {\r\n    this.pickedColor = colorResult.hex.toUpperCase();\r\n  }\r\n\r\n  @action.bound applyPickedValue() {\r\n    this.appliedValue = this.pickedColor;\r\n  }\r\n\r\n  @action.bound commitAppliedValue() {\r\n    if (this.appliedValue !== this.props.value) {\r\n      this.props.onChange?.(this.appliedValue);\r\n    }\r\n  }\r\n\r\n  @action.bound revertAppliedValue() {\r\n    this.appliedValue = this.props.value;\r\n  }\r\n\r\n  @action.bound pickValueFromApplied() {\r\n    this.pickedColor = this.appliedValue;\r\n  }\r\n\r\n  @action.bound send(evt: any) {\r\n    this.machine.send(evt);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Dropdowner\r\n        ref={this.refDropdowner}\r\n        onContainerMouseDown={undefined /*this.handleContainerMouseDown*/}\r\n        onDroppedUp={() => this.send({type: \"PICKER_DROPPED_UP\"})}\r\n        onDroppedDown={() => this.send({type: \"PICKER_DROPPED_DOWN\"})}\r\n        onOutsideInteraction={() => this.send({type: \"PICKER_OUTSIDE_INTERACTION\"})}\r\n        trigger={({refTrigger, setDropped}) => (\r\n          <div\r\n            className={S.editorContainer}\r\n            ref={this.refContainer}\r\n            style={{\r\n              zIndex: this.isDroppedDown ? 1000 : undefined,\r\n            }}\r\n          >\r\n            <div\r\n              className={S.colorDiv}\r\n              tabIndex={0}\r\n              ref={(elm) => {\r\n                refTrigger(elm);\r\n                this.refInput(elm);\r\n              }}\r\n              onMouseDown={() => this.send({type: \"DROPDOWN_SYMBOL_MOUSE_DOWN\"})}\r\n              onFocus={() => this.send({type: \"INPUT_FIELD_FOCUS\"})}\r\n              onBlur={() => this.send({type: \"INPUT_FIELD_BLUR\"})}\r\n              onKeyDown={(event) => this.props.onKeyDown?.(event)}\r\n            >\r\n              <div\r\n                className={S.colorRect}\r\n                style={{\r\n                  backgroundColor:\r\n                    (this.isDroppedDown ? this.pickedColor : this.appliedValue) || \"#000000\",\r\n                }}\r\n              />\r\n            </div>\r\n            {/*<input\r\n              style={{\r\n                backgroundColor:\r\n                  ,\r\n              }}\r\n              className={S.input}\r\n              type=\"text\"\r\n              readOnly={true}\r\n              onBlur={() => this.send({ type: \"INPUT_FIELD_BLUR\" })}\r\n              onFocus={() => this.send({ type: \"INPUT_FIELD_FOCUS\" })}\r\n              ref={this.refInput}\r\n            />*/}\r\n          </div>\r\n        )}\r\n        content={({setDropped}) => (\r\n          <div\r\n            tabIndex={0}\r\n            ref={this.refDroppedPanelContainer}\r\n            className={S.droppedPanelContainer}\r\n            onKeyDown={(event: any) => {\r\n              this.send({type: \"PICKER_KEY_DOWN\", payload: {event}});\r\n            }}\r\n          >\r\n            <SketchPicker\r\n              color={this.pickedColor || \"#000000\"}\r\n              onChange={this.handleColorChange}\r\n              disableAlpha={true}\r\n            />\r\n          </div>\r\n        )}\r\n      />\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { BlobEditor } from \"gui/Components/ScreenElements/Editors/BlobEditor\";\r\nimport { CheckList } from \"gui/Components/ScreenElements/Editors/CheckList\";\r\nimport { ImageEditor } from \"gui/Components/ScreenElements/Editors/ImageEditor\";\r\nimport { NumberEditor } from \"gui/Components/ScreenElements/Editors/NumberEditor\";\r\nimport { TagInputEditor } from \"gui/Components/ScreenElements/Editors/TagInputEditor\";\r\nimport { TextEditor } from \"gui/Components/ScreenElements/Editors/TextEditor\";\r\nimport { inject, observer } from \"mobx-react\";\r\nimport { onFieldBlur } from \"model/actions-ui/DataView/TableView/onFieldBlur\";\r\nimport { onFieldChange } from \"model/actions-ui/DataView/TableView/onFieldChange\";\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\nimport { getRowStateForegroundColor } from \"model/selectors/RowState/getRowStateForegroundColor\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\nimport React from \"react\";\r\nimport uiActions from \"model/actions-ui-tree\";\r\nimport { IDockType, IProperty } from \"model/entities/types/IProperty\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { isReadOnly } from \"model/selectors/RowState/isReadOnly\";\r\nimport { XmlBuildDropdownEditor } from \"modules/Editors/DropdownEditor/DropdownEditor\";\r\nimport { BoolEditor } from \"gui/Components/ScreenElements/Editors/BoolEditor\";\r\nimport { DateTimeEditor } from \"gui/Components/ScreenElements/Editors/DateTimeEditor/DateTimeEditor\";\r\nimport { FormFocusManager } from \"model/entities/FormFocusManager\";\r\nimport { DomEvent } from \"leaflet\";\r\nimport { onDropdownEditorClick } from \"model/actions/DropdownEditor/onDropdownEditorClick\";\r\nimport { shadeHexColor } from \"utils/colorUtils\";\r\nimport { getIsFormScreenDirty } from \"model/selectors/FormScreen/getisFormScreenDirty\";\r\nimport { runInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\nimport ColorEditor from \"gui/Components/ScreenElements/Editors/ColorEditor\";\r\nimport { flashColor2htmlColor, htmlColor2FlashColor } from \"utils/flashColorFormat\";\r\nimport { onTextFieldAutoUpdate } from \"model/actions-ui/DataView/OnTextFieldAutoUpdate\";\r\nimport { CellAlignment } from \"gui/Components/ScreenElements/Table/TableRendering/cells/cellAlignment\";\r\n\r\n\r\n@inject(({property, formPanelView}) => {\r\n  return {\r\n    property,\r\n    onEditorBlur: (event: any) => onFieldBlur(formPanelView)(event),\r\n    onChange: async (event: any, value: any) => {\r\n      const row = getSelectedRow(property);\r\n      if(row === undefined){\r\n        return;\r\n      }\r\n      await onFieldChange(formPanelView)({\r\n        event: event,\r\n        row: row,\r\n        property: property,\r\n        value: value,\r\n      });\r\n    },\r\n  };\r\n})\r\n@observer\r\nexport class FormViewEditor extends React.Component<{\r\n  xmlNode?: any;\r\n  value?: any;\r\n  textualValue?: any;\r\n  property?: IProperty;\r\n  isRichText: boolean;\r\n  onChange?: (event: any, value: any) => Promise<void>;\r\n  onEditorBlur?: (event: any) => Promise<any>;\r\n  backgroundColor?: string;\r\n  onTextOverflowChanged?: (toolTip: string | null | undefined) => void;\r\n  dock?: IDockType;\r\n}> {\r\n  focusManager: FormFocusManager;\r\n\r\n  constructor(props: any) {\r\n    super(props);\r\n    this.focusManager = getDataView(this.props.property).formFocusManager;\r\n  }\r\n\r\n  getEditor() {\r\n    const rowId = getSelectedRowId(this.props.property);\r\n    const row = getSelectedRow(this.props.property);\r\n    const foregroundColor = getRowStateForegroundColor(this.props.property, rowId || \"\");\r\n    const readOnly = !row || isReadOnly(this.props.property!, rowId);\r\n    const backgroundColor = readOnly\r\n      ? shadeHexColor(this.props.backgroundColor, -0.1)\r\n      : this.props.backgroundColor;\r\n\r\n    switch (this.props.property!.column) {\r\n      case \"Number\":\r\n        return (\r\n          <NumberEditor\r\n            id={\"editor_\" + this.props.property?.modelInstanceId}\r\n            value={this.props.value}\r\n            isReadOnly={readOnly}\r\n            isPassword={this.props.property!.isPassword}\r\n            property={this.props.property}\r\n            maxLength={this.props.property?.maxLength}\r\n            backgroundColor={backgroundColor}\r\n            foregroundColor={foregroundColor}\r\n            customNumberFormat={this.props.property!.customNumericFormat}\r\n            customStyle={resolveNumericCellAlignment(this.props.property?.style)}\r\n            onChange={this.props.onChange}\r\n            onKeyDown={this.makeOnKeyDownCallBack()}\r\n            onEditorBlur={this.props.onEditorBlur}\r\n            onTextOverflowChanged={this.props.onTextOverflowChanged}\r\n            subscribeToFocusManager={(textEditor) =>\r\n              this.focusManager.subscribe(\r\n                textEditor,\r\n                this.props.property?.id,\r\n                this.props.property?.tabIndex\r\n              )\r\n            }\r\n          />\r\n        );\r\n      case \"Text\":\r\n        return (\r\n          <TextEditor\r\n            id={\"editor_\" + this.props.property?.modelInstanceId}\r\n            value={this.props.value}\r\n            isReadOnly={readOnly}\r\n            isMultiline={this.props.property!.multiline}\r\n            isPassword={this.props.property!.isPassword}\r\n            customStyle={this.props.property?.style}\r\n            maxLength={this.props.property?.maxLength}\r\n            backgroundColor={backgroundColor}\r\n            foregroundColor={foregroundColor}\r\n            onChange={this.props.onChange}\r\n            onKeyDown={this.makeOnKeyDownCallBack()}\r\n            wrapText={true}\r\n            onEditorBlur={this.props.onEditorBlur}\r\n            onAutoUpdate={value => onTextFieldAutoUpdate(this.props.property!, value)}\r\n            isRichText={this.props.isRichText}\r\n            onTextOverflowChanged={this.props.onTextOverflowChanged}\r\n            subscribeToFocusManager={(textEditor) =>\r\n              this.focusManager.subscribe(\r\n                textEditor,\r\n                this.props.property?.id,\r\n                this.props.property?.tabIndex\r\n              )\r\n            }\r\n            dock={this.props.dock}\r\n          />\r\n        );\r\n      case \"Date\":\r\n        return (\r\n          <DateTimeEditor\r\n            value={this.props.value}\r\n            outputFormat={this.props.property!.formatterPattern}\r\n            outputFormatToShow={this.props.property!.modelFormatterPattern}\r\n            isReadOnly={readOnly}\r\n            backgroundColor={backgroundColor}\r\n            foregroundColor={foregroundColor}\r\n            onChange={this.props.onChange}\r\n            onEditorBlur={this.props.onEditorBlur}\r\n            subscribeToFocusManager={(textEditor) =>\r\n              this.focusManager.subscribe(\r\n                textEditor,\r\n                this.props.property?.id,\r\n                this.props.property?.tabIndex\r\n              )\r\n            }\r\n            onKeyDown={this.makeOnKeyDownCallBack()}\r\n          />\r\n        );\r\n      case \"CheckBox\":\r\n        return (\r\n          <BoolEditor\r\n            value={this.props.value}\r\n            isReadOnly={readOnly}\r\n            onChange={this.props.onChange}\r\n            onClick={event => this.focusManager.stopAutoFocus()}\r\n            onKeyDown={undefined}\r\n            subscribeToFocusManager={(textEditor) =>\r\n              this.focusManager.subscribe(\r\n                textEditor,\r\n                this.props.property?.id,\r\n                this.props.property?.tabIndex\r\n              )\r\n            }\r\n          />\r\n        );\r\n      case \"ComboBox\":\r\n        return (\r\n          <XmlBuildDropdownEditor\r\n            key={this.props.xmlNode.$iid}\r\n            onTextOverflowChanged={this.props.onTextOverflowChanged}\r\n            xmlNode={this.props.xmlNode}\r\n            isReadOnly={readOnly}\r\n            subscribeToFocusManager={(textEditor) =>\r\n              this.focusManager.subscribe(\r\n                textEditor,\r\n                this.props.property?.id,\r\n                this.props.property?.tabIndex\r\n              )\r\n            }\r\n            autoSort={this.props.property?.autoSort}\r\n            backgroundColor={backgroundColor}\r\n            foregroundColor={foregroundColor}\r\n            customStyle={this.props.property?.style}\r\n            isLink={this.props.property?.isLink}\r\n            onClick={(event) => {\r\n              onDropdownEditorClick(this.props.property)(event, this.props.property, row);\r\n            }}\r\n            onKeyDown={this.makeOnKeyDownCallBack()}\r\n          />\r\n        );\r\n      case \"TagInput\":\r\n        return (\r\n          <XmlBuildDropdownEditor\r\n            key={this.props.xmlNode.$iid}\r\n            xmlNode={this.props.xmlNode}\r\n            isReadOnly={readOnly}\r\n            subscribeToFocusManager={(firstCheckInput) =>\r\n              this.focusManager.subscribe(\r\n                firstCheckInput,\r\n                this.props.property?.id,\r\n                this.props.property?.tabIndex\r\n              )\r\n            }\r\n            autoSort={this.props.property?.autoSort}\r\n            tagEditor={\r\n              <TagInputEditor\r\n                value={this.props.value}\r\n                isReadOnly={readOnly}\r\n                backgroundColor={backgroundColor}\r\n                foregroundColor={foregroundColor}\r\n                customStyle={this.props.property?.style}\r\n                onChange={this.props.onChange}\r\n                onKeyDown={this.makeOnKeyDownCallBack()}\r\n                onEditorBlur={this.props.onEditorBlur}\r\n              />\r\n            }\r\n          />\r\n        );\r\n      case \"Checklist\":\r\n        return (\r\n          <CheckList\r\n            value={this.props.value}\r\n            onChange={(newValue) => this.props.onChange && this.props.onChange({}, newValue)}\r\n            isReadonly={readOnly}\r\n            subscribeToFocusManager={(firstCheckInput) =>\r\n              this.focusManager.subscribe(\r\n                firstCheckInput,\r\n                this.props.property?.id,\r\n                this.props.property?.tabIndex\r\n              )\r\n            }\r\n            onKeyDown={this.makeOnKeyDownCallBack()}\r\n            onClick={() => this.focusManager.stopAutoFocus()}\r\n          />\r\n        );\r\n      case \"Color\":\r\n        return (\r\n          <ColorEditor\r\n            value={flashColor2htmlColor(this.props.value) || null}\r\n            onChange={(value) => this.props.onChange?.(undefined, htmlColor2FlashColor(value))}\r\n            onBlur={() => this.props.onEditorBlur?.(undefined)}\r\n            onKeyDown={this.makeOnKeyDownCallBack()}\r\n            isReadOnly={readOnly}\r\n            subscribeToFocusManager={(textEditor) =>\r\n              this.focusManager.subscribe(\r\n                textEditor,\r\n                this.props.property?.id,\r\n                this.props.property?.tabIndex\r\n              )\r\n            }\r\n          />\r\n        );\r\n      case \"Image\":\r\n        return <ImageEditor value={this.props.value}/>;\r\n      case \"Blob\":\r\n        const isDirty = getIsFormScreenDirty(this.props.property);\r\n        return (\r\n          <BlobEditor\r\n            isReadOnly={readOnly}\r\n            value={this.props.value}\r\n            onKeyDown={this.makeOnKeyDownCallBack()}\r\n            canUpload={!isDirty}\r\n            subscribeToFocusManager={(inputEditor) =>\r\n              this.focusManager.subscribe(\r\n                inputEditor,\r\n                this.props.property?.id,\r\n                this.props.property?.tabIndex\r\n              )\r\n            }\r\n            onChange={this.props.onChange}\r\n            onEditorBlur={this.props.onEditorBlur}\r\n          />\r\n        );\r\n      case \"Polymorph\":\r\n        console.warn(`Type of polymorphic column was not determined, no editor was rendered`); // eslint-disable-line no-console\r\n        return \"\";\r\n      default:\r\n        console.warn(`Unknown column type \"${this.props.property!.column}\", no editor was rendered` // eslint-disable-line no-console\r\n        );\r\n        return \"\";\r\n    }\r\n  }\r\n\r\n  private makeOnKeyDownCallBack() {\r\n    const dataView = getDataView(this.props.property);\r\n\r\n    return (event: any) => {\r\n      runInFlowWithHandler({\r\n        ctx: this.props.property,\r\n        action: async () => {\r\n          dataView.formFocusManager.stopAutoFocus();\r\n          if (event.key === \"Tab\") {\r\n            DomEvent.preventDefault(event);\r\n            if (event.shiftKey) {\r\n              this.focusManager.focusPrevious(document.activeElement);\r\n            } else {\r\n              this.focusManager.focusNext(document.activeElement);\r\n            }\r\n            return;\r\n          }\r\n          if (this.props.property!.multiline) {\r\n            return;\r\n          }\r\n          if (event.key === \"Enter\") {\r\n            await this.props.onEditorBlur?.(null);\r\n            if (dataView.firstEnabledDefaultAction) {\r\n              uiActions.actions.onActionClick(dataView.firstEnabledDefaultAction)(\r\n                event,\r\n                dataView.firstEnabledDefaultAction\r\n              );\r\n            }\r\n          }\r\n        },\r\n      });\r\n    };\r\n  }\r\n\r\n  render() {\r\n    return this.getEditor();\r\n  }\r\n}\r\n\r\nexport function resolveNumericCellAlignment(customStyle: { [p: string]: string } | undefined) {\r\n  let cellAlignment = new CellAlignment(false, \"Number\", customStyle);\r\n  const style = customStyle ? Object.assign({}, customStyle) : {};\r\n  style[\"paddingLeft\"] = cellAlignment.paddingLeft + \"px\";\r\n  style[\"textAlign\"] = cellAlignment.alignment;\r\n  return style;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport S from \"gui/Components/Form/FormField.module.scss\";\r\nimport { inject, observer } from \"mobx-react\";\r\nimport { IDockType, IProperty } from \"model/entities/types/IProperty\";\r\nimport { getRowStateDynamicLabel } from \"model/selectors/RowState/getRowStateNameOverride\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\nimport React from \"react\";\r\nimport { formatTooltipPlaintext } from \"../ToolTip/FormatTooltipText\";\r\nimport { FormViewEditor } from \"gui/Workbench/ScreenArea/FormView/FormViewEditor\";\r\nimport { observable } from \"mobx\";\r\nimport { FieldDimensions } from \"gui/Components/Form/FieldDimensions\";\r\nimport { getFieldErrorMessage } from \"model/selectors/DataView/getFieldErrorMessage\";\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\n\r\nexport enum ICaptionPosition {\r\n  Left = \"Left\",\r\n  Right = \"Right\",\r\n  Top = \"Top\",\r\n  None = \"None\",\r\n}\r\n\r\nexport interface IFormFieldProps {\r\n  caption: React.ReactNode;\r\n  captionPosition?: ICaptionPosition;\r\n  captionLength: number;\r\n  dock?: IDockType;\r\n  fieldDimensions: FieldDimensions;\r\n  isCheckbox?: boolean;\r\n  isHidden?: boolean;\r\n  hideCaption?: boolean;\r\n  captionColor?: string;\r\n  toolTip?: string;\r\n  xmlNode?: any;\r\n  value?: any;\r\n  textualValue?: any;\r\n  isRichText: boolean;\r\n  backgroundColor?: string;\r\n  property?: IProperty;\r\n}\r\n\r\n@inject(({property}, {caption}) => {\r\n  const rowId = getSelectedRowId(property);\r\n\r\n  const ovrCaption = getRowStateDynamicLabel(property, rowId || \"\", property.id);\r\n\r\n  return {\r\n    caption: !!ovrCaption ? ovrCaption : caption,\r\n    property: property\r\n  };\r\n})\r\n@observer\r\nexport class FormField extends React.Component<IFormFieldProps> {\r\n\r\n  @observable\r\n  toolTip: string | undefined | null;\r\n\r\n  render() {\r\n    const row = getSelectedRow(this.props.property);\r\n    const invalidMessage = row\r\n      ? getFieldErrorMessage(this.props.property!)(row, this.props.property!)\r\n      : undefined;\r\n\r\n    return (\r\n      <>\r\n        {this.props.captionPosition !== ICaptionPosition.None && !this.props.hideCaption &&\r\n        <label\r\n          className={S.caption}\r\n          style={getCaptionStyle(this.props)}\r\n          title={getToolTip(this.props, this.toolTip)}\r\n        >\r\n          {this.props.caption}\r\n        </label>\r\n        }\r\n        <div\r\n          className={S.editor}\r\n          style={getFormFieldStyle(this.props)}\r\n          title={getToolTip(this.props, this.toolTip)}\r\n        >\r\n          <FormViewEditor\r\n            value={this.props.value}\r\n            isRichText={this.props.isRichText}\r\n            textualValue={this.props.textualValue}\r\n            xmlNode={this.props.xmlNode}\r\n            backgroundColor={this.props.backgroundColor}\r\n            onTextOverflowChanged={toolTip => this.toolTip = toolTip}\r\n            dock={this.props.dock}\r\n          />\r\n          {invalidMessage && (\r\n            <div className={S.notification} title={invalidMessage}>\r\n              <i className=\"fas fa-exclamation-circle red\"/>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport function getCaptionStyle(props: IFormFieldProps) {\r\n  const dimensions = props.fieldDimensions;\r\n  const style = {...(props.property?.style ?? {})};\r\n  if(dimensions.isUnset){\r\n    return {...dimensions.asStyle(), ...style};\r\n  }\r\n  if (props.isHidden) {\r\n    style[\"display\"] = \"none\";\r\n    return style;\r\n  }\r\n  switch (props.captionPosition) {\r\n    default:\r\n    case ICaptionPosition.Left:\r\n      style[\"top\"] = dimensions.top;\r\n      style[\"left\"] = dimensions.left! - props.captionLength;\r\n      style[\"color\"] = props.captionColor;\r\n      return style;\r\n    case ICaptionPosition.Right:\r\n      // 20 is expected checkbox width, might be needed to be set dynamically\r\n      // if there is some difference in chekbox sizes between various platforms.\r\n      style[\"top\"] = dimensions.top;\r\n      style[\"left\"] = props.isCheckbox ? dimensions.left! + 20 : dimensions.left! + dimensions.width! + 4;\r\n      style[\"color\"] = props.captionColor;\r\n      return style;\r\n    case ICaptionPosition.Top:\r\n      style[\"top\"] = dimensions.top! - 20; // TODO: Move this constant somewhere else...\r\n      style[\"left\"] = dimensions.left;\r\n      style[\"color\"] = props.captionColor\r\n      return style;\r\n  }\r\n}\r\n\r\nexport function getFormFieldStyle(props: IFormFieldProps) {\r\n  const dimensions = props.fieldDimensions;\r\n  if(dimensions.isUnset){\r\n    return dimensions.asStyle();\r\n  }\r\n  if (props.isHidden) {\r\n    return {\r\n      display: \"none\",\r\n    };\r\n  }\r\n  if (props.dock === IDockType.Fill) {\r\n    return {\r\n      top: 0,\r\n      left: 0,\r\n      width: \"100%\",\r\n      height: \"100%\",\r\n    };\r\n  }\r\n  return {\r\n    left: dimensions.left,\r\n    top: dimensions.top,\r\n    width: dimensions.width,\r\n    height: dimensions.height,\r\n  };\r\n}\r\n\r\nexport function getToolTip(props: IFormFieldProps, toolTip: string | undefined | null){\r\n  let finalToolTip = props.toolTip ?? \"\";\r\n  if (toolTip) {\r\n    finalToolTip = toolTip + \"\\n\\n\" + finalToolTip;\r\n  }\r\n  return formatTooltipPlaintext(finalToolTip);\r\n}\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IProperty } from \"../../entities/types/IProperty\";\r\nimport { getDataView } from \"../../selectors/DataView/getDataView\";\r\nimport { getSessionId } from \"../../selectors/getSessionId\";\r\nimport { getApi } from \"../../selectors/getApi\";\r\nimport { runInFlowWithHandler } from \"../../../utils/runInFlowWithHandler\";\r\n\r\nexport function onTextFieldAutoUpdate(property: IProperty, value: string) {\r\n\r\n  const dataView = getDataView(property);\r\n  if (!dataView.selectedRowId) {\r\n    return;\r\n  }\r\n  const sessionId = getSessionId(dataView);\r\n  let api = getApi(dataView);\r\n\r\n  const valueObj = {} as any;\r\n  valueObj[property.id] = value;\r\n\r\n  const updateData = [\r\n    {\r\n      RowId: dataView.selectedRowId,\r\n      Values: valueObj,\r\n    }\r\n  ];\r\n  runInFlowWithHandler({\r\n    ctx: dataView,\r\n    action: async () => {\r\n      await api.updateObject({\r\n        SessionFormIdentifier: sessionId,\r\n        Entity: dataView.entity,\r\n        UpdateData: updateData,\r\n      });\r\n    }\r\n  });\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\n\r\nexport function onDropdownEditorClick(ctx: any) {\r\n  return flow(function*onDropdownEditorClick(\r\n    event: any,\r\n    property: IProperty | undefined,\r\n    currentRow: any[] | undefined\r\n  ) {\r\n    if (currentRow && property?.isLink && (event.ctrlKey || event.metaKey)) {\r\n      yield*getDataView(ctx).navigateLookupLink(property, currentRow);\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/Form/FormSectionHeader.module.scss\";\r\n\r\nexport const FormSectionHeader: React.FC<{\r\n  foreGroundColor: string | undefined;\r\n  tooltip?: string;\r\n}> = (props) => (\r\n  <h1 className={S.root} style={{color: props.foreGroundColor}} title={props.tooltip}>\r\n    {props.children}\r\n  </h1>\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport \"gui/Components/Form/FormSection.module.scss\";\r\nimport cx from \"classnames\";\r\nimport { FormSectionHeader } from \"gui/Components/Form/FormSectionHeader\";\r\nimport { FieldDimensions } from \"gui/Components/Form/FieldDimensions\";\r\n\r\nexport const FormSection: React.FC<{\r\n  title?: string;\r\n  backgroundColor: string | undefined;\r\n  foreGroundColor: string | undefined;\r\n  dimensions: FieldDimensions;\r\n}> = (props) => {\r\n\r\n  function getStyle(){\r\n    const style = props.dimensions.asStyle();\r\n    style[\"backgroundColor\"] = props.backgroundColor;\r\n    return style;\r\n  }\r\n  const hasTitle = !!props.title;\r\n  return (\r\n    <div\r\n      className={cx(\"formSection\", {hasTitle})}\r\n      style={getStyle()}\r\n    >\r\n      {hasTitle && (\r\n        <FormSectionHeader foreGroundColor={props.foreGroundColor} tooltip={props.title}>\r\n          {props.title}\r\n        </FormSectionHeader>\r\n      )}\r\n      {props.children}\r\n    </div>\r\n  );\r\n};\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/Form/FormLabel.module.scss\";\r\nimport { FieldDimensions } from \"gui/Components/Form/FieldDimensions\";\r\n\r\nexport const FormLabel: React.FC<{\r\n  title: string;\r\n  fieldDimensions: FieldDimensions\r\n  foregroundColor: string | undefined;\r\n}> = props => {\r\n\r\n  function getStyle() {\r\n    const style = props.fieldDimensions.asStyle();\r\n    style[\"color\"] = props.foregroundColor;\r\n    return style;\r\n  }\r\n\r\n  return <div\r\n    className={S.root}\r\n    style={getStyle()}\r\n  >\r\n    {props.title}\r\n  </div>\r\n};\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/Form/RadioButton.module.scss\";\r\nimport { IFocusable } from \"model/entities/FormFocusManager\";\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { FieldDimensions } from \"gui/Components/Form/FieldDimensions\";\r\nimport cx from \"classnames\";\r\n\r\n\r\nexport class RadioButton extends React.Component<{\r\n  caption: string;\r\n  fieldDimensions: FieldDimensions;\r\n  name: string;\r\n  value: string;\r\n  onSelected: (value: any) => void;\r\n  checked: boolean;\r\n  onKeyDown: (event: any) => void;\r\n  subscribeToFocusManager?: (obj: IFocusable) => void;\r\n  onClick: () => void;\r\n  labelColor?: string;\r\n  className?: string;\r\n}> {\r\n  inputId = uuidv4();\r\n  elmInput: HTMLInputElement | null = null;\r\n  refInput = (elm: HTMLInputElement | any) => {\r\n    this.elmInput = elm;\r\n  };\r\n\r\n  componentDidMount() {\r\n    if (this.elmInput && this.props.subscribeToFocusManager) {\r\n      this.props.subscribeToFocusManager(this.elmInput);\r\n    }\r\n  }\r\n\r\n  onChange(event: any) {\r\n    if (event.target.value === this.props.value) {\r\n      this.props.onSelected(this.props.value);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div\r\n        className={cx(S.root, this.props.className)}\r\n        style={this.props.fieldDimensions.asStyle()}\r\n      >\r\n        <input\r\n          ref={this.refInput}\r\n          className={S.input}\r\n          type={\"radio\"}\r\n          onClick={() => this.props.onClick()}\r\n          id={this.inputId}\r\n          name={this.props.name}\r\n          value={this.props.value}\r\n          checked={this.props.checked}\r\n          onKeyDown={event => this.props.onKeyDown(event)}\r\n          onChange={event => this.onChange(event)}/>\r\n        <label\r\n          className={S.label}\r\n          htmlFor={this.inputId}\r\n          style={{color: this.props.labelColor}}>\r\n          {this.props.caption}\r\n        </label>\r\n      </div>\r\n    );\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useState } from \"react\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { BoolEditor } from \"gui/Components/ScreenElements/Editors/BoolEditor\";\r\nimport S from \"gui/Components/Form/CheckBox.module.scss\";\r\nimport { inject } from \"mobx-react\";\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\nimport { onFieldBlur } from \"model/actions-ui/DataView/TableView/onFieldBlur\";\r\nimport { onFieldChange } from \"model/actions-ui/DataView/TableView/onFieldChange\";\r\nimport { IFocusable } from \"model/entities/FormFocusManager\";\r\nimport { FieldDimensions } from \"gui/Components/Form/FieldDimensions\";\r\n\r\nexport const CheckBox: React.FC<{\r\n  checked: boolean;\r\n  readOnly: boolean;\r\n  isHidden?: boolean;\r\n  onChange?: (event: any, value: any) => void;\r\n  property?: IProperty;\r\n  onKeyDown: (event: any) => void;\r\n  subscribeToFocusManager?: (obj: IFocusable) => void;\r\n  onClick: () => void;\r\n  labelColor?: string;\r\n  fieldDimensions: FieldDimensions;\r\n}> = inject(({property, formPanelView}) => {\r\n  const row = getSelectedRow(formPanelView)!;\r\n  return {\r\n    property,\r\n    onEditorBlur: (event: any) => onFieldBlur(formPanelView)(event),\r\n    onChange: (event: any, value: any) => onFieldChange(formPanelView)({\r\n      event: event,\r\n      row: row,\r\n      property: property,\r\n      value: value,\r\n    }),\r\n  };\r\n})((props) => {\r\n  const [isFocused, setIsFocused] = useState<boolean>(false);\r\n\r\n  const label = props.property!.name;\r\n  const left = props.fieldDimensions?.left;\r\n  const top = props.fieldDimensions?.top;\r\n\r\n  function captionStyle() {\r\n    if (props.isHidden) {\r\n      return {\r\n        display: \"none\",\r\n      };\r\n    }\r\n    if(props.fieldDimensions.isUnset){\r\n      const style = props.fieldDimensions.asStyle();\r\n      style[\"color\"] = props.labelColor;\r\n      return style;\r\n    }\r\n    // 20 is expected checkbox width, might be needed to be set dynamically\r\n    // if there is some difference in chekbox sizes between various platforms.\r\n    return {\r\n      top: top,\r\n      left: left! + 20,\r\n      color: props.labelColor\r\n    };\r\n  }\r\n\r\n  function formFieldStyle() {\r\n    if (props.isHidden) {\r\n      return {\r\n        display: \"none\",\r\n      };\r\n    }\r\n    return props.fieldDimensions.asStyle();\r\n  }\r\n\r\n  function onChange(event: any, state: boolean) {\r\n    if (!props.readOnly) props.onChange?.(event, state);\r\n  }\r\n\r\n  function onInputFocus() {\r\n    setIsFocused(true);\r\n  }\r\n\r\n  function onInputBlur() {\r\n    setIsFocused(false);\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <div className={S.editor} style={formFieldStyle()}>\r\n        <BoolEditor\r\n          id={props.property!.modelInstanceId}\r\n          value={props.checked}\r\n          isReadOnly={props.readOnly}\r\n          onBlur={onInputBlur}\r\n          onFocus={onInputFocus}\r\n          onChange={onChange}\r\n          onKeyDown={event => props.onKeyDown(event)}\r\n          subscribeToFocusManager={props.subscribeToFocusManager}\r\n          onClick={props.onClick}\r\n        />\r\n      </div>\r\n      <label\r\n        htmlFor={props.property!.modelInstanceId}\r\n        className={S.caption + \" \" + (isFocused ? S.focusedLabel : S.unFocusedLabel)}\r\n        style={captionStyle()}\r\n      >\r\n        {label}\r\n      </label>\r\n    </div>\r\n  );\r\n});\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\n\r\nexport const CtxPanelVisibility = React.createContext<{ isVisible: boolean }>({\r\n  isVisible: false\r\n});\r\n","import React from \"react\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\n\r\nexport class FieldDimensions {\r\n\r\n  top: number | undefined;\r\n  left: number | undefined;\r\n  width: number | undefined;\r\n  height: number | undefined;\r\n\r\n  constructor(args?:{\r\n    top: number;\r\n    left: number;\r\n    width: number;\r\n    height: number;\r\n  }){\r\n    if(args) {\r\n      this.top = args.top;\r\n      this.left = args.left;\r\n      this.width = args.width;\r\n      this.height = args.height;\r\n    }\r\n  }\r\n  get isUnset(){\r\n    return !this.top || !this.left || !this.width || !this.height\r\n  }\r\n\r\n  asStyle(){\r\n    if(this.isUnset){\r\n      return {\r\n        top: \"unset\",\r\n        left: \"unset\",\r\n        height: \"unset\",\r\n        width: \"unset\",\r\n        position: \"relative\"\r\n      } as React.CSSProperties\r\n    }\r\n    else{\r\n      return {\r\n        top: this.top,\r\n        left: this.left,\r\n        height: this.height,\r\n        width: this.width,\r\n      } as React.CSSProperties\r\n    }\r\n  }\r\n}\r\n\r\nexport function dimensionsFromXmlNode(xmlNode: any) {\r\n  return new FieldDimensions({\r\n    left: parseInt(xmlNode.attributes.X, 10),\r\n    top: parseInt(xmlNode.attributes.Y, 10),\r\n    width: parseInt(xmlNode.attributes.Width, 10),\r\n    height: parseInt(xmlNode.attributes.Height, 10)\r\n  });\r\n}\r\n\r\nexport function dimensionsFromProperty(property: IProperty){\r\n  return new FieldDimensions({\r\n    height: property.height,\r\n    width: property.width,\r\n    left: property.x,\r\n    top: property.y\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { inject, observer, Observer, Provider } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { IDataView } from \"model/entities/types/IDataView\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { getDataViewPropertyById } from \"model/selectors/DataView/getDataViewPropertyById\";\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\nimport { FormRoot } from \"./FormRoot\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\nimport { getRowStateRowBgColor } from \"model/selectors/RowState/getRowStateRowBgColor\";\r\nimport { FormField } from \"gui/Components/Form/FormField\";\r\nimport { FormSection } from \"gui/Components/Form/FormSection\";\r\nimport { FormLabel } from \"gui/Components/Form/FormLabel\";\r\nimport { RadioButton } from \"gui/Components/Form/RadioButton\";\r\nimport { getDataSourceFieldByName } from \"model/selectors/DataSources/getDataSourceFieldByName\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { flow } from \"mobx\";\r\nimport { CheckBox } from \"gui/Components/Form/CheckBox\";\r\nimport { isReadOnly } from \"model/selectors/RowState/isReadOnly\";\r\nimport { DomEvent } from \"leaflet\";\r\nimport { getRowStateAllowRead } from \"model/selectors/RowState/getRowStateAllowRead\";\r\nimport { getRowStateMayCauseFlicker } from \"model/selectors/RowState/getRowStateMayCauseFlicker\";\r\nimport { CtxPanelVisibility } from \"gui/contexts/GUIContexts\";\r\nimport { getRowStateForegroundColor } from \"model/selectors/RowState/getRowStateForegroundColor\";\r\nimport { dimensionsFromProperty, dimensionsFromXmlNode } from \"gui/Components/Form/FieldDimensions\";\r\nimport { findStrings } from \"xmlInterpreters/xmlUtils\";\r\n\r\n\r\n@inject(({dataView}) => {\r\n  return {dataView, xmlFormRootObject: dataView.formViewUI};\r\n})\r\n@observer\r\nexport class FormBuilder extends React.Component<{\r\n  xmlFormRootObject?: any;\r\n  dataView?: IDataView;\r\n}> {\r\n  static contextType = CtxPanelVisibility\r\n\r\n  componentDidMount() {\r\n    document.addEventListener(\"click\", event => this.notifyClick(event))\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener(\"click\", event => this.notifyClick(event));\r\n  }\r\n\r\n  notifyClick(event: any) {\r\n    this.props.dataView!.formFocusManager.setLastFocused(event.target);\r\n  }\r\n\r\n  onKeyDown(event: any) {\r\n    if (event.key === \"Tab\") {\r\n      DomEvent.preventDefault(event);\r\n      if (event.shiftKey) {\r\n        this.props.dataView!.formFocusManager.focusPrevious(document.activeElement);\r\n      } else {\r\n        this.props.dataView!.formFocusManager.focusNext(document.activeElement);\r\n      }\r\n      return;\r\n    }\r\n  }\r\n\r\n  buildForm() {\r\n    const self = this;\r\n    const row = getSelectedRow(this.props.dataView);\r\n    const rowId = getSelectedRowId(this.props.dataView);\r\n    const dataTable = getDataTable(this.props.dataView);\r\n    let backgroundColor: string | undefined;\r\n    let foreGroundColor: string | undefined;\r\n    if (row && rowId) {\r\n      backgroundColor = getRowStateRowBgColor(self.props.dataView, rowId);\r\n      foreGroundColor = getRowStateForegroundColor(\r\n        self.props.dataView,\r\n        rowId || \"\"\r\n      );\r\n    }\r\n    const focusManager = self.props.dataView!.formFocusManager;\r\n\r\n    function recursive(xfo: any) {\r\n      if (xfo.name === \"FormRoot\") {\r\n        return (\r\n          <FormRoot key={xfo.$iid} style={{backgroundColor}}>\r\n            {xfo.elements.map((child: any) => recursive(child))}\r\n          </FormRoot>\r\n        );\r\n      } else if (xfo.name === \"FormElement\" && xfo.attributes.Type === \"FormSection\") {\r\n        return (\r\n          <FormSection\r\n            key={xfo.$iid}\r\n            dimensions={dimensionsFromXmlNode(xfo)}\r\n            title={xfo.attributes.Title}\r\n            backgroundColor={backgroundColor}\r\n            foreGroundColor={foreGroundColor}\r\n          >\r\n            {xfo.elements.map((child: any) => recursive(child))}\r\n          </FormSection>\r\n        );\r\n      } else if (xfo.name === \"FormElement\" && xfo.attributes.Type === \"Label\") {\r\n        return (\r\n          <FormLabel\r\n            key={xfo.$iid}\r\n            title={xfo.attributes.Title}\r\n            fieldDimensions={dimensionsFromXmlNode(xfo)}\r\n            foregroundColor={foreGroundColor}\r\n          />\r\n        );\r\n      } else if (xfo.name === \"Control\" && xfo.attributes.Column === \"RadioButton\") {\r\n        const sourceField = getDataSourceFieldByName(self.props.dataView, xfo.attributes.Id);\r\n\r\n        const checked = row\r\n          ? String(dataTable.getCellValueByDataSourceField(row, sourceField!)) === xfo.attributes.Value\r\n          : false;\r\n\r\n        return (\r\n          <RadioButton\r\n            key={xfo.$iid}\r\n            caption={xfo.attributes.Name}\r\n            fieldDimensions={dimensionsFromXmlNode(xfo)}\r\n            name={xfo.attributes.Id}\r\n            value={xfo.attributes.Value}\r\n            checked={checked}\r\n            onKeyDown={(event) => self.onKeyDown(event)}\r\n            subscribeToFocusManager={(radioInput) =>\r\n              focusManager.subscribe(radioInput, xfo.attributes.Id, xfo.attributes.TabIndex)\r\n            }\r\n            labelColor={foreGroundColor}\r\n            onClick={() => self?.props?.dataView?.formFocusManager.stopAutoFocus()}\r\n            onSelected={(value) => {\r\n              const formScreenLifecycle = getFormScreenLifecycle(self.props.dataView);\r\n              flow(function*() {\r\n                yield*formScreenLifecycle.updateRadioButtonValue(\r\n                  self.props.dataView!,\r\n                  row,\r\n                  xfo.attributes.Id,\r\n                  value\r\n                );\r\n              })();\r\n            }}\r\n          />\r\n        );\r\n      } else if (xfo.name === \"PropertyNames\") {\r\n        const propertyNames = findStrings(xfo);\r\n        return propertyNames.map((propertyId) => {\r\n          return (\r\n            <Observer key={propertyId}>\r\n              {() => {\r\n                let property = getDataViewPropertyById(self.props.dataView, propertyId);\r\n                if (row && property?.column === \"Polymorph\") {\r\n                  property = property.getPolymophicProperty(row);\r\n                }\r\n                let value;\r\n                let textualValue = value;\r\n                if (row && property) {\r\n                  value = dataTable.getCellValue(row, property);\r\n                  if (property.isLookup) {\r\n                    textualValue = dataTable.getCellText(row, property);\r\n                  }\r\n                }\r\n                if (!property) {\r\n                  return <></>;\r\n                }\r\n\r\n                const isHidden =\r\n                  (!getRowStateAllowRead(property, rowId || \"\", property.id) ||\r\n                    getRowStateMayCauseFlicker(property)) && !!row;\r\n\r\n                  if (property.column === \"CheckBox\") {\r\n                    return (\r\n                      <Provider property={property}>\r\n                        <CheckBox\r\n                          fieldDimensions={dimensionsFromProperty(property)}\r\n                          isHidden={isHidden}\r\n                          checked={value}\r\n                          readOnly={!row || isReadOnly(property, rowId)}\r\n                          onKeyDown={(event) => self.onKeyDown(event)}\r\n                          subscribeToFocusManager={(radioInput) =>\r\n                            focusManager.subscribe(radioInput, property!.id, property!.tabIndex)\r\n                          }\r\n                          onClick={() => self?.props?.dataView?.formFocusManager.stopAutoFocus()}\r\n                          labelColor={foreGroundColor}\r\n                        />\r\n                      </Provider>\r\n                    );\r\n                  }\r\n\r\n                  return (\r\n                    <Provider property={property} key={property.id}>\r\n                      <FormField\r\n                        isHidden={isHidden}\r\n                        caption={property.name}\r\n                        hideCaption={property.column === \"Image\"}\r\n                        captionLength={property.captionLength}\r\n                        captionPosition={property.captionPosition}\r\n                        captionColor={foreGroundColor}\r\n                        dock={property.dock}\r\n                        fieldDimensions={dimensionsFromProperty(property)}\r\n                        toolTip={property.toolTip}\r\n                        value={value}\r\n                        isRichText={property.isRichText}\r\n                        textualValue={textualValue}\r\n                        xmlNode={property.xmlNode}\r\n                        backgroundColor={backgroundColor}\r\n                      />\r\n                    </Provider>\r\n                  );\r\n                }}\r\n              </Observer>\r\n            );\r\n          });\r\n      } else {\r\n        return xfo.elements.map((child: any) => recursive(child));\r\n      }\r\n    }\r\n\r\n    const form = recursive(this.props.xmlFormRootObject);\r\n    if (this.props.dataView?.isFirst && this.context.isVisible) {\r\n      focusManager.autoFocus();\r\n    }\r\n    return form;\r\n  }\r\n\r\n  render() {\r\n    return this.buildForm();\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useContext, useState } from \"react\";\r\nimport S from \"gui/connections/MobileComponents/Form/ComboBox/ComboBox.module.scss\";\r\nimport cx from \"classnames\";\r\nimport CS from \"@origam/components/src/components/Dropdown/Dropdown.module.scss\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { MobileState } from \"model/entities/MobileState/MobileState\";\r\nimport { EditLayoutState, ScreenLayoutState } from \"model/entities/MobileState/MobileLayoutState\";\r\nimport { ComboFullScreenEditor } from \"gui/connections/MobileComponents/Form/ComboBox/ComboFullScreenEditor\";\r\nimport { IDataView } from \"model/entities/types/IDataView\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\nimport { MobileDropdownBehavior } from \"gui/connections/MobileComponents/Form/ComboBox/MobileDropdownBehavior\";\r\nimport { DropdownEditorApi } from \"modules/Editors/DropdownEditor/DropdownEditorApi\";\r\nimport { DropdownEditorData, IDropdownEditorData } from \"modules/Editors/DropdownEditor/DropdownEditorData\";\r\nimport { TagInputEditorData } from \"modules/Editors/DropdownEditor/TagInputEditorData\";\r\nimport {  DropdownDataTable } from \"modules/Editors/DropdownEditor/DropdownTableModel\";\r\nimport { DropdownEditorLookupListCache } from \"modules/Editors/DropdownEditor/DropdownEditorLookupListCache\";\r\nimport { DropdownEditorSetup, DropdownEditorSetupFromXml } from \"modules/Editors/DropdownEditor/DropdownEditorSetup\";\r\nimport { onMobileLinkClick } from \"model/actions/DropdownEditor/onMobileLinkClick\";\r\n\r\n\r\nexport interface IComboBoxProps {\r\n  xmlNode: any;\r\n  isReadOnly: boolean;\r\n  backgroundColor?: string;\r\n  foregroundColor?: string;\r\n  customStyle?: any;\r\n  tagEditor?: JSX.Element;\r\n  isLink?: boolean;\r\n  autoSort?: boolean;\r\n  onTextOverflowChanged?: (toolTip: string | null | undefined) => void;\r\n  dataView: IDataView;\r\n  property: IProperty;\r\n  onKeyDown?(event: any): void;\r\n}\r\n\r\nexport const ComboBox: React.FC<IComboBoxProps> = observer((props) => {\r\n\r\n  const mobileState = useContext(MobXProviderContext).application.mobileState as MobileState;\r\n  const row = getSelectedRow(props.property);\r\n  const currentValue = row && props.dataView.dataTable.getCellText(row, props.property);\r\n\r\n  function onTextClick(){\r\n    if(props.isLink){\r\n      onMobileLinkClick(props.property, row)\r\n    }\r\n  }\r\n\r\n  function onButtonClick(){\r\n    if(props.isReadOnly){\r\n      return;\r\n    }\r\n    mobileState.layoutState = new EditLayoutState(\r\n      <XmlBuildDropdownEditor\r\n        {...props}\r\n        onValueSelected={() => mobileState.layoutState = new ScreenLayoutState()}\r\n      />,\r\n      props.property.name\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className={cx(CS.control, S.mobileInput, props.isReadOnly ? S.readOnly : \"\")}>\r\n      <div\r\n        className={cx(\"input\", S.input, props.isLink ? S.link : \"\")}\r\n        onClick={onTextClick}\r\n      >\r\n        {currentValue}\r\n      </div>\r\n      <div\r\n        className={cx(\"inputBtn\", \"lastOne\")}\r\n        onClick={onButtonClick}\r\n      >\r\n        <i className=\"fas fa-caret-down\"/>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nexport interface IMobileDropdownContext {\r\n  behavior: MobileDropdownBehavior;\r\n  editorData: IDropdownEditorData;\r\n  editorDataTable: DropdownDataTable;\r\n  setup: DropdownEditorSetup;\r\n}\r\n\r\nexport function XmlBuildDropdownEditor(props: {\r\n  xmlNode: any;\r\n  isReadOnly: boolean;\r\n  editingTags?: boolean;\r\n  isLink?: boolean;\r\n  autoSort?: boolean;\r\n  onTextOverflowChanged?: (toolTip: string | null | undefined) => void;\r\n  onValueSelected: ()=> void;\r\n  onKeyDown?(event: any): void;\r\n  dataView: IDataView,\r\n  property: IProperty;\r\n}) {\r\n  const mobxContext = useContext(MobXProviderContext);\r\n  const {dataViewRowCursor, dataViewApi, dataViewData} = props.dataView;\r\n  const workbench = mobxContext.workbench;\r\n  const {lookupListCache} = workbench;\r\n\r\n  const [dropdownEditorInfrastructure] = useState<IMobileDropdownContext>(() => {\r\n    const dropdownEditorApi: DropdownEditorApi = new DropdownEditorApi(\r\n      () => dropdownEditorSetup,\r\n      dataViewRowCursor,\r\n      dataViewApi,\r\n      () => dropdownEditorBehavior\r\n    );\r\n    const dropdownEditorData: IDropdownEditorData = props.editingTags\r\n      ? new TagInputEditorData(dataViewData, dataViewRowCursor, () => dropdownEditorSetup)\r\n      : new DropdownEditorData(dataViewData, dataViewRowCursor, () => dropdownEditorSetup);\r\n    const dropdownEditorDataTable = new DropdownDataTable(\r\n      () => dropdownEditorSetup,\r\n      dropdownEditorData\r\n    );\r\n\r\n    const dropdownEditorLookupListCache = new DropdownEditorLookupListCache(\r\n      () => dropdownEditorSetup,\r\n      lookupListCache\r\n    );\r\n\r\n    const dropdownEditorBehavior = new MobileDropdownBehavior({\r\n      api: dropdownEditorApi,\r\n      data: dropdownEditorData,\r\n      dataTable: dropdownEditorDataTable,\r\n      setup: () => dropdownEditorSetup,\r\n      cache: dropdownEditorLookupListCache,\r\n      autoSort: props.autoSort,\r\n      onTextOverflowChanged: props.onTextOverflowChanged,\r\n      onValueSelected: props.onValueSelected\r\n    });\r\n\r\n    const dropdownEditorSetup = DropdownEditorSetupFromXml(\r\n      props.xmlNode, dropdownEditorDataTable, dropdownEditorBehavior, props.isLink);\r\n\r\n    return {\r\n      behavior: dropdownEditorBehavior,\r\n      editorData: dropdownEditorData,\r\n      columnDrivers: dropdownEditorSetup.columnDrivers,\r\n      editorDataTable: dropdownEditorDataTable,\r\n      setup: dropdownEditorSetup,\r\n    };\r\n  });\r\n\r\n  return (\r\n      <ComboFullScreenEditor\r\n        {...props}\r\n        behavior={dropdownEditorInfrastructure.behavior}\r\n        dataTable={dropdownEditorInfrastructure.editorDataTable}\r\n        columnDrivers={dropdownEditorInfrastructure.setup.columnDrivers}\r\n        editorData={dropdownEditorInfrastructure.editorData}\r\n      />\r\n  );\r\n}\r\n\r\n\r\n\r\n\r\n","import { IProperty } from \"model/entities/types/IProperty\";\r\nimport { runGeneratorInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\n\r\nexport function onMobileLinkClick(property: IProperty | undefined, currentRow: any[] | undefined) {\r\n  if(!currentRow || !property?.isLink){\r\n    return\r\n  }\r\n\r\n  const value = getDataView(property).dataTable.getCellValue(currentRow, property);\r\n  if(!value){\r\n    return;\r\n  }\r\n\r\n  runGeneratorInFlowWithHandler({\r\n    ctx: property,\r\n    generator: function*() {\r\n      yield*getDataView(property).navigateLookupLink(property, currentRow);\r\n    }()\r\n  });\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useContext } from \"react\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\nimport { getRowStateForegroundColor } from \"model/selectors/RowState/getRowStateForegroundColor\";\r\nimport { isReadOnly } from \"model/selectors/RowState/isReadOnly\";\r\nimport { shadeHexColor } from \"utils/colorUtils\";\r\nimport { ComboBox, XmlBuildDropdownEditor } from \"gui/connections/MobileComponents/Form/ComboBox/ComboBox\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { FormViewEditor } from \"gui/Workbench/ScreenArea/FormView/FormViewEditor\";\r\nimport { MobileTagInputEditor } from \"gui/connections/MobileComponents/Form/ComboBox/MobileTagInputEditor\";\r\nimport { MobXProviderContext } from \"mobx-react\";\r\nimport { MobileState } from \"model/entities/MobileState/MobileState\";\r\nimport { EditLayoutState, ScreenLayoutState } from \"model/entities/MobileState/MobileLayoutState\";\r\nimport { onFieldChange } from \"model/actions-ui/DataView/TableView/onFieldChange\";\r\nimport { MobileDateTimeEditor } from \"gui/connections/MobileComponents/Form/MobileDateTimeEditor\";\r\nimport { onFieldBlur } from \"model/actions-ui/DataView/TableView/onFieldBlur\";\r\n\r\nexport const MobileFormViewEditor: React.FC<{\r\n  value?: any;\r\n  textualValue?: any;\r\n  isRichText: boolean;\r\n  property: IProperty;\r\n  xmlNode: any;\r\n  onTextOverflowChanged?: (toolTip: string | null | undefined) => void;\r\n  backgroundColor?: string;\r\n}> = (props) => {\r\n\r\n  const mobileState = useContext(MobXProviderContext).application.mobileState as MobileState;\r\n  const rowId = getSelectedRowId(props.property);\r\n  const row = getSelectedRow(props.property);\r\n  const foregroundColor = getRowStateForegroundColor(props.property, rowId || \"\");\r\n  const readOnly = !row || isReadOnly(props.property!, rowId);\r\n  const backgroundColor = readOnly\r\n    ? shadeHexColor(props.backgroundColor, -0.1)\r\n    : props.backgroundColor;\r\n\r\n  function onChange(event: any, newValue: any) {\r\n    const row = getSelectedRow(props.property);\r\n    if(!row){\r\n      return;\r\n    }\r\n    onFieldChange(props.property)({\r\n      event: event,\r\n      row: row!,\r\n      property: props.property,\r\n      value: newValue,\r\n    });\r\n  }\r\n\r\n  const onEditorBlur = (event: any) => onFieldBlur(props.property)(event);\r\n\r\n  if (props.property!.column === \"ComboBox\") {\r\n    return (\r\n      <ComboBox\r\n        key={props.xmlNode.$iid}\r\n        onTextOverflowChanged={props.onTextOverflowChanged}\r\n        xmlNode={props.xmlNode}\r\n        isReadOnly={readOnly}\r\n        autoSort={props.property?.autoSort}\r\n        backgroundColor={backgroundColor}\r\n        foregroundColor={foregroundColor}\r\n        customStyle={props.property?.style}\r\n        isLink={props.property?.isLink}\r\n        dataView={getDataView(props.property)}\r\n        property={props.property!}\r\n      />);\r\n  }\r\n  if (props.property!.column === \"TagInput\") {\r\n    return (\r\n      <MobileTagInputEditor\r\n        key={props.xmlNode.$iid}\r\n        isReadOnly={readOnly}\r\n        backgroundColor={backgroundColor}\r\n        foregroundColor={foregroundColor}\r\n        customStyle={props.property.style}\r\n        property={props.property}\r\n        onChange={onChange}\r\n        onPlusButtonClick={() => {\r\n          mobileState.layoutState = new EditLayoutState(\r\n            <XmlBuildDropdownEditor\r\n              {...props}\r\n              isReadOnly={readOnly}\r\n              dataView={getDataView(props.property)}\r\n              property={props.property}\r\n              editingTags={true}\r\n              onValueSelected={() => mobileState.layoutState = new ScreenLayoutState()}\r\n            />,\r\n            props.property.name\r\n          )\r\n        }}\r\n      />);\r\n  }\r\n  if (props.property!.column === \"Date\") {\r\n    return (\r\n      <MobileDateTimeEditor\r\n        value={props.value}\r\n        property={props.property}\r\n        outputFormat={props.property!.formatterPattern}\r\n        outputFormatToShow={props.property!.modelFormatterPattern}\r\n        isReadOnly={readOnly}\r\n        backgroundColor={backgroundColor}\r\n        foregroundColor={foregroundColor}\r\n        onChange={onChange}\r\n        onEditorBlur={onEditorBlur}\r\n      />\r\n    );\r\n  }\r\n  return (\r\n    <FormViewEditor\r\n      value={props.value}\r\n      isRichText={props.isRichText}\r\n      textualValue={props.textualValue}\r\n      xmlNode={props.xmlNode}\r\n      backgroundColor={props.backgroundColor}\r\n      onTextOverflowChanged={props.onTextOverflowChanged}\r\n    />);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport \"gui/connections/MobileComponents/Form/MobileForm.module.scss\";\r\nimport {\r\n  getCaptionStyle, getFormFieldStyle,\r\n  getToolTip,\r\n  ICaptionPosition,\r\n  IFormFieldProps\r\n} from \"gui/Components/Form/FormField\";\r\nimport { inject, observer } from \"mobx-react\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\nimport { getRowStateDynamicLabel } from \"model/selectors/RowState/getRowStateNameOverride\";\r\nimport { observable } from \"mobx\";\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\nimport { getFieldErrorMessage } from \"model/selectors/DataView/getFieldErrorMessage\";\r\nimport S from \"gui/Components/Form/FormField.module.scss\";\r\nimport { MobileFormViewEditor } from \"gui/connections/MobileComponents/Form/MobileFormViewEditor\";\r\n\r\n@inject(({property}, {caption}) => {\r\n  const rowId = getSelectedRowId(property);\r\n\r\n  const ovrCaption = getRowStateDynamicLabel(property, rowId || \"\", property.id);\r\n\r\n  return {\r\n    caption: !!ovrCaption ? ovrCaption : caption,\r\n    property: property\r\n  };\r\n})\r\n@observer\r\nexport class MobileFormField extends React.Component<IFormFieldProps> {\r\n\r\n  @observable\r\n  toolTip: string | undefined | null;\r\n\r\n  render() {\r\n    const row = getSelectedRow(this.props.property);\r\n    const invalidMessage = row\r\n      ? getFieldErrorMessage(this.props.property!)(row, this.props.property!)\r\n      : undefined;\r\n\r\n    return (\r\n      <div className={\"formItem\"}>\r\n        {this.props.captionPosition !== ICaptionPosition.None && !this.props.hideCaption &&\r\n          <label\r\n            className={S.caption}\r\n            style={getCaptionStyle(this.props)}\r\n            title={getToolTip(this.props, this.toolTip)}\r\n          >\r\n            {this.props.caption}\r\n          </label>\r\n        }\r\n        <div\r\n          className={S.editor}\r\n          style={getFormFieldStyle(this.props)}\r\n          title={getToolTip(this.props, this.toolTip)}\r\n        >\r\n          <MobileFormViewEditor\r\n            value={this.props.value}\r\n            isRichText={this.props.isRichText}\r\n            textualValue={this.props.textualValue}\r\n            xmlNode={this.props.xmlNode}\r\n            backgroundColor={this.props.backgroundColor}\r\n            onTextOverflowChanged={toolTip => this.toolTip = toolTip}\r\n            property={this.props.property!}\r\n          />\r\n          {invalidMessage && (\r\n            <div className={S.notification} title={invalidMessage}>\r\n              <i className=\"fas fa-exclamation-circle red\"/>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport \"gui/connections/MobileComponents/Form/MobileFormSection.module.scss\";\r\nimport { FieldDimensions } from \"gui/Components/Form/FieldDimensions\";\r\nimport { FormSection } from \"gui/Components/Form/FormSection\";\r\n\r\nexport const MobileFormSection: React.FC<{\r\n  title?: string;\r\n  backgroundColor: string | undefined;\r\n  foreGroundColor: string | undefined;\r\n}> = (props) => {\r\n\r\n  return (\r\n    <div className={\"mobileFormSection\"}>\r\n      <FormSection\r\n        title={props.title}\r\n        backgroundColor={props.backgroundColor}\r\n        foreGroundColor={props.foreGroundColor}\r\n        dimensions={new FieldDimensions()}\r\n      >\r\n        {props.children}\r\n      </FormSection>\r\n    </div>\r\n  );\r\n};\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { FieldDimensions } from \"gui/Components/Form/FieldDimensions\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { inject } from \"mobx-react\";\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\nimport { onFieldBlur } from \"model/actions-ui/DataView/TableView/onFieldBlur\";\r\nimport { onFieldChange } from \"model/actions-ui/DataView/TableView/onFieldChange\";\r\nimport { MobileBooleanInput } from \"gui/connections/MobileComponents/Form/MobileBooleanInput\";\r\n\r\nexport const MobileCheckBox: React.FC<{\r\n  isHidden?: boolean;\r\n  checked: boolean;\r\n  readOnly: boolean;\r\n  onChange?: (event: any, value: any) => void;\r\n  labelColor?: string;\r\n  property?: IProperty;\r\n}> = inject(({property, formPanelView}) => {\r\n  const row = getSelectedRow(formPanelView)!;\r\n  return {\r\n    property,\r\n    onEditorBlur: (event: any) => onFieldBlur(formPanelView)(event),\r\n    onChange: (event: any, value: any) => onFieldChange(formPanelView)({\r\n      event: event,\r\n      row: row,\r\n      property: property,\r\n      value: value,\r\n    }),\r\n  };\r\n})((props) => {\r\n  const label = props.property!.name;\r\n  const fieldDimensions = new FieldDimensions();\r\n\r\n  function captionStyle() {\r\n    if (props.isHidden) {\r\n      return {\r\n        display: \"none\",\r\n      };\r\n    }\r\n    const style = fieldDimensions.asStyle();\r\n    style[\"color\"] = props.labelColor;\r\n    return style;\r\n  }\r\n\r\n  function formFieldStyle() {\r\n    if (props.isHidden) {\r\n      return {\r\n        display: \"none\",\r\n      };\r\n    }\r\n    return fieldDimensions.asStyle();\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <label\r\n        htmlFor={props.property!.modelInstanceId}\r\n        style={captionStyle()}\r\n      >\r\n        {label}\r\n      </label>\r\n      <div style={formFieldStyle()}>\r\n        <MobileBooleanInput\r\n          checked={props.checked}\r\n          disabled={props.readOnly}\r\n          onChange={event => props.onChange?.(event, event.target.checked)}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { inject, observer, Observer, Provider } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { IDataView } from \"model/entities/types/IDataView\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\nimport { getRowStateRowBgColor } from \"model/selectors/RowState/getRowStateRowBgColor\";\r\nimport { RadioButton } from \"gui/Components/Form/RadioButton\";\r\nimport { getDataSourceFieldByName } from \"model/selectors/DataSources/getDataSourceFieldByName\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { flow } from \"mobx\";\r\nimport { isReadOnly } from \"model/selectors/RowState/isReadOnly\";\r\nimport { DomEvent } from \"leaflet\";\r\nimport { getRowStateAllowRead } from \"model/selectors/RowState/getRowStateAllowRead\";\r\nimport { getRowStateMayCauseFlicker } from \"model/selectors/RowState/getRowStateMayCauseFlicker\";\r\nimport { CtxPanelVisibility } from \"gui/contexts/GUIContexts\";\r\nimport { getRowStateForegroundColor } from \"model/selectors/RowState/getRowStateForegroundColor\";\r\nimport { FieldDimensions } from \"gui/Components/Form/FieldDimensions\";\r\nimport { compareTabIndexOwners, ITabIndexOwner } from \"model/entities/TabIndexOwner\";\r\nimport { FormRoot } from \"gui/Workbench/ScreenArea/FormView/FormRoot\";\r\nimport \"gui/connections/MobileComponents/Form/MobileForm.module.scss\";\r\nimport { MobileFormField } from \"gui/connections/MobileComponents/Form/MobileFormField\";\r\nimport { MobileFormSection } from \"gui/connections/MobileComponents/Form/MobileFormSection\";\r\nimport { MobileCheckBox } from \"gui/connections/MobileComponents/Form/CheckBox\";\r\nimport { getDataViewPropertyById } from \"model/selectors/DataView/getDataViewPropertyById\";\r\nimport { findStrings } from \"xmlInterpreters/xmlUtils\";\r\n\r\n\r\n@inject(({dataView}) => {\r\n  return {dataView, xmlFormRootObject: dataView.formViewUI};\r\n})\r\n@observer\r\nexport class MobileFormBuilder extends React.Component<{\r\n  xmlFormRootObject?: any;\r\n  dataView?: IDataView;\r\n}> {\r\n  static contextType = CtxPanelVisibility\r\n\r\n  componentDidMount() {\r\n    document.addEventListener(\"click\", event => this.notifyClick(event))\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener(\"click\", event => this.notifyClick(event));\r\n  }\r\n\r\n  notifyClick(event: any) {\r\n    this.props.dataView!.formFocusManager.setLastFocused(event.target);\r\n  }\r\n\r\n  onKeyDown(event: any) {\r\n    if (event.key === \"Tab\") {\r\n      DomEvent.preventDefault(event);\r\n      if (event.shiftKey) {\r\n        this.props.dataView!.formFocusManager.focusPrevious(document.activeElement);\r\n      } else {\r\n        this.props.dataView!.formFocusManager.focusNext(document.activeElement);\r\n      }\r\n      return;\r\n    }\r\n  }\r\n\r\n  buildForm() {\r\n    const self = this;\r\n    const row = getSelectedRow(this.props.dataView);\r\n    const rowId = getSelectedRowId(this.props.dataView);\r\n    const dataTable = getDataTable(this.props.dataView);\r\n    let backgroundColor: string | undefined;\r\n    let foreGroundColor: string | undefined;\r\n    if (row && rowId) {\r\n      backgroundColor = getRowStateRowBgColor(self.props.dataView, rowId);\r\n      foreGroundColor = getRowStateForegroundColor(\r\n        self.props.dataView,\r\n        rowId || \"\"\r\n      );\r\n    }\r\n    const focusManager = self.props.dataView!.formFocusManager;\r\n\r\n    function recursive(xfo: any, indexInParent: number): FormItem[] | undefined {\r\n      if (xfo.name === \"FormRoot\") {\r\n        return [new FormItem(\"-1\",\r\n          <FormRoot\r\n            key={xfo.$iid}\r\n            style={{backgroundColor}}\r\n            className={\"formRootMobile\"}\r\n          >\r\n            {\r\n              xfo.elements\r\n                .flatMap((child: any, index: number) => recursive(child, index))\r\n                .flat()\r\n                .filter((item: any) => item)\r\n                .sort(compareTabIndexOwners)\r\n                .map((item: FormItem) => item.element)\r\n            }\r\n          </FormRoot>\r\n        )];\r\n      } else if (xfo.name === \"FormElement\" && xfo.attributes.Type === \"FormSection\") {\r\n        return [new FormItem((xfo.attributes.TabIndex)?.toString(),\r\n          <MobileFormSection\r\n            key={xfo.$iid}\r\n            title={xfo.attributes.Title}\r\n            backgroundColor={backgroundColor}\r\n            foreGroundColor={foreGroundColor}\r\n          >\r\n            {\r\n              xfo.elements\r\n                .flatMap((child: any, index: number) => recursive(child, index))\r\n                .flat()\r\n                .filter((item: any) => item)\r\n                .sort(compareTabIndexOwners)\r\n                .map((item: FormItem) => item.element)\r\n            }\r\n          </MobileFormSection>\r\n        )];\r\n      } else if (xfo.name === \"FormElement\" && xfo.attributes.Type === \"Label\") {\r\n        return undefined;\r\n      } else if (xfo.name === \"Control\" && xfo.attributes.Column === \"RadioButton\") {\r\n        const sourceField = getDataSourceFieldByName(self.props.dataView, xfo.attributes.Id);\r\n\r\n        const checked = row\r\n          ? String(dataTable.getCellValueByDataSourceField(row, sourceField!)) === xfo.attributes.Value\r\n          : false;\r\n\r\n        return [new FormItem(xfo.attributes.TabIndex,\r\n          <RadioButton\r\n            key={xfo.$iid}\r\n            caption={xfo.attributes.Name}\r\n            className={\"formItem\"}\r\n            fieldDimensions={new FieldDimensions()}\r\n            name={xfo.attributes.Id}\r\n            value={xfo.attributes.Value}\r\n            checked={checked}\r\n            onKeyDown={(event) => self.onKeyDown(event)}\r\n            subscribeToFocusManager={(radioInput) =>\r\n              focusManager.subscribe(radioInput, xfo.attributes.Id, xfo.attributes.TabIndex)\r\n            }\r\n            labelColor={foreGroundColor}\r\n            onClick={() => self?.props?.dataView?.formFocusManager.stopAutoFocus()}\r\n            onSelected={(value) => {\r\n              const formScreenLifecycle = getFormScreenLifecycle(self.props.dataView);\r\n              flow(function*() {\r\n                yield*formScreenLifecycle.updateRadioButtonValue(\r\n                  self.props.dataView!,\r\n                  row,\r\n                  xfo.attributes.Id,\r\n                  value\r\n                );\r\n              })();\r\n            }}\r\n          />\r\n        )];\r\n      } else if (xfo.name === \"PropertyNames\") {\r\n        return findPropertiesInPropertyNode(xfo, self.props.dataView)\r\n          .map((property) => {\r\n            return (new FormItem(property!.tabIndex,\r\n              <Observer key={property!.id}>\r\n                {() => {\r\n                  let value;\r\n                  let textualValue = value;\r\n                  if (row && property) {\r\n                    value = dataTable.getCellValue(row, property);\r\n                    if (property.isLookup) {\r\n                      textualValue = dataTable.getCellText(row, property);\r\n                    }\r\n                  }\r\n                  if (!property) {\r\n                    return <></>;\r\n                  }\r\n\r\n                  const isHidden =\r\n                    (!getRowStateAllowRead(property, rowId || \"\", property.id) ||\r\n                      getRowStateMayCauseFlicker(property)) && !!row;\r\n\r\n                  if (property.column === \"CheckBox\") {\r\n                    return (\r\n                      <Provider property={property}>\r\n                        <MobileCheckBox\r\n                          isHidden={isHidden}\r\n                          checked={value}\r\n                          readOnly={!row || isReadOnly(property, rowId)}\r\n                          labelColor={foreGroundColor}\r\n                        />\r\n                      </Provider>\r\n                    );\r\n                  }\r\n\r\n                  return (\r\n                    <Provider property={property} key={property.id}>\r\n                      <MobileFormField\r\n                        isHidden={isHidden}\r\n                        caption={property.name}\r\n                        hideCaption={property.column === \"Image\"}\r\n                        captionLength={property.captionLength}\r\n                        captionColor={foreGroundColor}\r\n                        dock={property.dock}\r\n                        toolTip={property.toolTip}\r\n                        value={value}\r\n                        isRichText={property.isRichText}\r\n                        textualValue={textualValue}\r\n                        xmlNode={property.xmlNode}\r\n                        backgroundColor={backgroundColor}\r\n                        fieldDimensions={new FieldDimensions()}\r\n                      />\r\n                    </Provider>\r\n                  );\r\n                }}\r\n              </Observer>\r\n            ));\r\n          });\r\n      } else {\r\n        return xfo.elements.map((child: any, index: number) => recursive(child, index));\r\n      }\r\n    }\r\n\r\n    const form = recursive(this.props.xmlFormRootObject, 0)!\r\n      .filter(item => item)\r\n      .sort(compareTabIndexOwners)\r\n      .map(item => item.element);\r\n\r\n    if (this.props.dataView?.isFirst && this.context.isVisible) {\r\n      focusManager.autoFocus();\r\n    }\r\n    return form;\r\n  }\r\n\r\n  render() {\r\n    return this.buildForm();\r\n  }\r\n}\r\n\r\nclass FormItem implements ITabIndexOwner {\r\n  constructor(\r\n    public tabIndex: string | undefined,\r\n    public element: JSX.Element) {\r\n  }\r\n}\r\n\r\nfunction findPropertiesInPropertyNode(xfo: any, dataView: IDataView | undefined) {\r\n  if (xfo.name !== \"PropertyNames\") {\r\n    throw new Error(\"Nor a property node\")\r\n  }\r\n  if (!dataView) {\r\n    return [];\r\n  }\r\n  const row = getSelectedRow(dataView);\r\n  const propertyNames = findStrings(xfo);\r\n  return propertyNames\r\n    .map(propertyId => {\r\n      let property = getDataViewPropertyById(dataView, propertyId);\r\n      if (row && property?.column === \"Polymorph\") {\r\n        property = property.getPolymophicProperty(row);\r\n      }\r\n      return property;\r\n    })\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useContext } from \"react\";\r\nimport { action } from \"mobx\";\r\nimport { IDataViewBodyUI, IDataViewToolbarUI } from \"modules/DataView/DataViewUI\";\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { SectionViewSwitchers } from \"modules/DataView/DataViewTypes\";\r\nimport { getIdent, IIId } from \"utils/common\";\r\nimport { DataViewHeaderAction } from \"gui/Components/DataViewHeader/DataViewHeaderAction\";\r\nimport { Icon } from \"@origam/components\";\r\n\r\nimport { MobXProviderContext, observer, Observer } from \"mobx-react\";\r\nimport { IFormPerspective } from \"./FormPerspective\";\r\nimport { IPerspective } from \"../Perspective\";\r\nimport { FormView } from \"gui/Workbench/ScreenArea/FormView/FormView\";\r\nimport { FormBuilder } from \"gui/Workbench/ScreenArea/FormView/FormBuilder\";\r\nimport { T } from \"../../../../utils/translation\";\r\nimport S from \"./FormPerspectiveDirector.module.scss\";\r\nimport cx from \"classnames\";\r\nimport { MobileFormBuilder } from \"gui/connections/MobileComponents/Form/MobileFormBuilder\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\nimport { IApplication } from \"model/entities/types/IApplication\";\r\n\r\nexport class FormPerspectiveDirector implements IIId {\r\n  $iid = getIdent();\r\n\r\n  constructor(\r\n    public dataViewToolbarUI = IDataViewToolbarUI(),\r\n    public dataViewBodyUI = IDataViewBodyUI(),\r\n    public formPerspective = IFormPerspective(),\r\n    public perspective = IPerspective()\r\n  ) {\r\n  }\r\n\r\n  @action.bound\r\n  setup() {\r\n    this.dataViewBodyUI.contrib.put({\r\n      $iid: this.$iid,\r\n      render: () => (\r\n        <FormPerspectiveDirectorComponent\r\n          key={this.$iid}\r\n          formPerspectiveActive={this.formPerspective.isActive}\r\n        />\r\n      ),\r\n    });\r\n\r\n    this.dataViewToolbarUI.contrib.put({\r\n      $iid: this.$iid,\r\n      section: SectionViewSwitchers,\r\n      render: () => (\r\n        <Observer key={this.$iid}>\r\n          {() => (\r\n            <DataViewHeaderAction\r\n              className={\"formPerspectiveButton\"}\r\n              onMouseDown={()=> this.formPerspective.handleClick({saveNewState: true})}\r\n              isActive={this.formPerspective.isActive}\r\n            >\r\n              <Icon src=\"./icons/detail-view.svg\" tooltip={T(\"Grid\", \"form_tool_tip\")}/>\r\n            </DataViewHeaderAction>\r\n          )}\r\n        </Observer>\r\n      ),\r\n    });\r\n\r\n    this.perspective.contrib.put(this.formPerspective);\r\n  }\r\n\r\n  @action.bound\r\n  teardown() {\r\n    this.dataViewBodyUI.contrib.del(this);\r\n    this.dataViewToolbarUI.contrib.del(this);\r\n    this.perspective.contrib.del(this.formPerspective);\r\n  }\r\n\r\n  dispose() {\r\n    this.teardown();\r\n  }\r\n}\r\n\r\nconst FormPerspectiveDirectorComponent: React.FC<{\r\n  formPerspectiveActive: boolean;\r\n}> = observer((props) => {\r\n  const application = useContext(MobXProviderContext).application as IApplication\r\n\r\n  return (\r\n    !props.formPerspectiveActive ? (\r\n      <></>\r\n    ) : (\r\n      <div className={cx(S.root, {isActive: props.formPerspectiveActive})}>\r\n        <FormView>\r\n          {isMobileLayoutActive(application)\r\n            ?<MobileFormBuilder/>\r\n            :<FormBuilder/>\r\n          }\r\n        </FormView>\r\n      </div>\r\n    )\r\n  );\r\n});\r\n\r\n\r\nexport const IFormPerspectiveDirector = TypeSymbol<FormPerspectiveDirector>(\r\n  \"IFormPerspectiveDirector\"\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Container } from \"dic/Container\";\r\nimport { FormPerspectiveDirector, IFormPerspectiveDirector } from \"./FormPerspectiveDirector\";\r\nimport { FormPerspective, IFormPerspective } from \"./FormPerspective\";\r\n\r\nexport const SCOPE_FormPerspective = \"FormPerspective\";\r\n\r\nexport function register($cont: Container) {\r\n  $cont\r\n    .registerClass(IFormPerspectiveDirector, FormPerspectiveDirector)\r\n    .scopedInstance(SCOPE_FormPerspective);\r\n\r\n  $cont.registerClass(IFormPerspective, FormPerspective).scopedInstance(SCOPE_FormPerspective);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { observable } from \"mobx\";\r\nimport { getIdent, IIId } from \"utils/common\";\r\nimport { IPerspective, IPerspectiveContrib } from \"../Perspective\";\r\nimport bind from \"bind-decorator\";\r\nimport { IPanelViewType } from \"model/entities/types/IPanelViewType\";\r\nimport { IViewConfiguration } from \"modules/DataView/ViewConfiguration\";\r\n\r\nexport class TablePerspective implements IIId, IPerspectiveContrib {\r\n  $iid = getIdent();\r\n\r\n  constructor(\r\n    public perspective = IPerspective(),\r\n    public viewConfiguration = IViewConfiguration()\r\n  ) {\r\n  }\r\n\r\n  @observable isActive = false;\r\n\r\n  @bind\r\n  *handleToolbarBtnClick() {\r\n    if (this.isActive) return;\r\n    yield*this.perspective.deactivate();\r\n    this.isActive = true;\r\n    yield*this.viewConfiguration.anounceActivePerspective(IPanelViewType.Table);\r\n    this.onTablePerspectiveShown?.();\r\n  }\r\n\r\n  onTablePerspectiveShown: (() => void) | undefined;\r\n\r\n  @bind\r\n  *deactivate() {\r\n    this.isActive = false;\r\n  }\r\n\r\n  @bind\r\n  *activateDefault() {\r\n    if (this.viewConfiguration.activePerspective === IPanelViewType.Table) this.isActive = true;\r\n  }\r\n}\r\n\r\nexport const ITablePerspective = TypeSymbol<TablePerspective>(\"ITablePerspective\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getTablePanelView } from \"../../../selectors/TablePanelView/getTablePanelView\";\r\n\r\nexport function selectPrevColumn(ctx: any) {\r\n  return function selectPrevColumn(prevRowWhenStart?: boolean) {\r\n    getTablePanelView(ctx).selectPrevColumn(prevRowWhenStart);\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\n\r\nexport function selectNextColumn(ctx: any) {\r\n  return function selectNextColumn(nextRowWhenEnd?: boolean) {\r\n    getTablePanelView(ctx).selectNextColumn(nextRowWhenEnd);\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getOrderingConfiguration } from \"model/selectors/DataView/getOrderingConfiguration\";\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getProperties } from \"model/selectors/DataView/getProperties\";\r\n\r\nexport function onColumnHeaderClick(ctx: any) {\r\n  return flow(function*onColumnHeaderClick(event: any, column: string) {\r\n    try {\r\n      const property = getProperties(ctx).find(prop => prop.id === column);\r\n      if (property?.column === \"Blob\" || property?.column === \"TagInput\") {\r\n        return;\r\n      }\r\n      if (event.ctrlKey || event.metaKey) {\r\n        getOrderingConfiguration(ctx).addOrdering(column);\r\n      } else {\r\n        getOrderingConfiguration(ctx).setOrdering(column);\r\n      }\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { observer } from \"mobx-react\";\r\nimport S from \"./Header.module.scss\";\r\nimport { IOrderByDirection } from \"model/entities/types/IOrderingConfiguration\";\r\nimport { Draggable, DraggableProvided } from \"react-beautiful-dnd\";\r\nimport { action, observable } from \"mobx\";\r\n\r\nconst MIN_COLUMN_WIDTH = 30;\r\n\r\n@observer\r\nexport class Header extends React.Component<{\r\n  id: string;\r\n  width: number;\r\n  label: string;\r\n  isFixed: boolean;\r\n  isFirst: boolean;\r\n  isLast: boolean;\r\n  columnIndex: number;\r\n  orderingDirection: IOrderByDirection;\r\n  orderingOrder: number;\r\n  additionalHeaderContent?: () => React.ReactNode;\r\n  onColumnWidthChange: (id: string, newWidth: number) => void;\r\n  onColumnWidthChangeFinished: (id: string, newWidth: number) => void;\r\n  onClick?: (event: any, id: string) => void;\r\n  isDragDisabled: boolean;\r\n}> {\r\n  width0: number = 0;\r\n  mouseX0: number = 0;\r\n  mouseY0: number = 0;\r\n  @observable isMouseIn: boolean = false;\r\n  width1: number = 0;\r\n\r\n  @action.bound handleHeaderWidthHandleMouseDown(event: any) {\r\n    event.preventDefault();\r\n    this.width0 = this.props.width;\r\n    this.width1 = this.props.width;\r\n    this.mouseX0 = event.screenX;\r\n    this.mouseY0 = event.screenY;\r\n    window.addEventListener(\"mousemove\", this.handleWindowMouseMoveForColumnWidthChange);\r\n    window.addEventListener(\"mouseup\", this.handleWindowMouseUpForColumnWidthChange);\r\n  }\r\n\r\n  @action.bound handleWindowMouseMoveForColumnWidthChange(event: any) {\r\n    const shVecX = event.screenX - this.mouseX0;\r\n    this.width1 = this.width0 + shVecX;\r\n    if (this.width1 >= MIN_COLUMN_WIDTH) {\r\n      this.props.onColumnWidthChange && this.props.onColumnWidthChange(this.props.id, this.width1);\r\n    }\r\n  }\r\n\r\n  @action.bound handleWindowMouseUpForColumnWidthChange(event: any) {\r\n    window.removeEventListener(\"mousemove\", this.handleWindowMouseMoveForColumnWidthChange);\r\n    window.removeEventListener(\"mouseup\", this.handleWindowMouseUpForColumnWidthChange);\r\n    this.props.onColumnWidthChangeFinished &&\r\n    this.props.onColumnWidthChangeFinished(this.props.id, this.width1);\r\n  }\r\n\r\n  makeHeaderStyle() {\r\n    const headerDividerWidth = this.props.isLast ? 3 : 5;\r\n    const style = {\r\n      minWidth: this.props.width - headerDividerWidth,\r\n      maxWidth: this.props.width - headerDividerWidth,\r\n    } as any;\r\n    if (this.props.isFirst) {\r\n      style[\"paddingLeft\"] = \"1.9em\";\r\n    }\r\n    return style;\r\n  }\r\n\r\n  render() {\r\n    if (this.props.isFixed) {\r\n      return this.renderHeader();\r\n    }\r\n    return (\r\n      <Draggable\r\n        draggableId={this.props.id}\r\n        index={this.props.columnIndex}\r\n        key={this.props.id}\r\n        isDragDisabled={this.props.isDragDisabled}\r\n      >\r\n        {(provided) => this.renderHeader(provided)}\r\n      </Draggable>\r\n    );\r\n  }\r\n\r\n  private renderHeader(provided?: DraggableProvided) {\r\n    return <div className={S.root} ref={provided?.innerRef} {...provided?.draggableProps}>\r\n      <div\r\n        {...provided?.dragHandleProps}\r\n        className={S.header}\r\n        style={this.makeHeaderStyle()}\r\n        title={this.props.label}\r\n      >\r\n        <div className={S.inHeaderRow}>\r\n          <div\r\n            className={S.label}\r\n            onClick={(event) => this.props.onClick && this.props.onClick(event, this.props.id)}\r\n          >\r\n            {this.props.label}\r\n          </div>\r\n          {this.props.orderingDirection !== IOrderByDirection.NONE && (\r\n            <div className={S.order}>\r\n              {this.props.orderingOrder > 0 && <span>{this.props.orderingOrder}</span>}\r\n              {this.props.orderingDirection === IOrderByDirection.ASC && (\r\n                <i className=\"fas fa-caret-up\"/>\r\n              )}\r\n              {this.props.orderingDirection === IOrderByDirection.DESC && (\r\n                <i className=\"fas fa-caret-down\"/>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n        {this.props.additionalHeaderContent && (\r\n          <div className={S.additionalContentsRow}>{this.props.additionalHeaderContent()}</div>\r\n        )}\r\n      </div>\r\n      <div\r\n        onMouseDown={this.handleHeaderWidthHandleMouseDown}\r\n        className={S.columnWidthHandle + \" \" + (this.props.isLast ? S.rightSeparator : S.middleSeparator)}\r\n      />\r\n    </div>;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"./Canvas.module.css\";\r\nimport { action, computed } from \"mobx\";\r\nimport { CPR } from \"utils/canvas\";\r\n\r\nexport class Canvas extends React.Component<{ width: number; height: number, refCanvasElement: any }> {\r\n  firstVisibleRowIndex = 0;\r\n  lastVisibleRowIndex = 0;\r\n\r\n  ctxCanvas: CanvasRenderingContext2D | null = null;\r\n\r\n  @action.bound\r\n  refCanvas(elm: HTMLCanvasElement | null) {\r\n    this.props.refCanvasElement(elm);\r\n    if (elm) {\r\n      this.ctxCanvas = elm.getContext(\"2d\");\r\n    } else {\r\n      this.ctxCanvas = null;\r\n    }\r\n  }\r\n\r\n  @computed\r\n  public get canvasWidthPX() {\r\n    return Math.ceil(this.props.width * CPR()) || 0;\r\n  }\r\n\r\n  @computed\r\n  public get canvasHeightPX() {\r\n    return Math.ceil(this.props.height * CPR()) || 0;\r\n  }\r\n\r\n  @computed\r\n  public get canvasWidthCSS() {\r\n    return Math.ceil(this.props.width * CPR()) / CPR() || 0;\r\n  }\r\n\r\n  @computed\r\n  public get canvasHeightCSS() {\r\n    return Math.ceil(this.props.height * CPR()) / CPR() || 0;\r\n  }\r\n\r\n  @computed\r\n  public get canvasProps() {\r\n    return {\r\n      width: this.canvasWidthPX,\r\n      height: this.canvasHeightPX,\r\n      style: {\r\n        // +1 because added 1px border makes canvas resizing and blurry.\r\n        // Has to by synchronized with stylesheet :/\r\n        minWidth: this.canvasWidthCSS + 1,\r\n        maxWidth: this.canvasWidthCSS + 1,\r\n        minHeight: this.canvasHeightCSS,\r\n        maxHeight: this.canvasHeightCSS,\r\n      },\r\n    };\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <canvas\r\n        className={S.canvas}\r\n        {...this.canvasProps}\r\n        /*width={0}\r\n        height={0}*/\r\n        ref={this.refCanvas}\r\n      />\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport * as React from \"react\";\r\nimport { IHeaderRowProps } from \"./types\";\r\nimport { observer } from \"mobx-react\";\r\nimport S from \"./HeaderRow.module.scss\";\r\n\r\n@observer\r\nexport class HeaderRow extends React.Component<IHeaderRowProps> {\r\n  render() {\r\n    return <div className={S.headerRow} style={{zIndex: this.props.zIndex || 0}}>{this.props.headerElements}</div>;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport * as React from \"react\";\r\nimport * as ReactDOM from \"react-dom\";\r\nimport { IPositionedFieldProps } from \"./types\";\r\nimport { observer } from \"mobx-react\";\r\nimport S from \"./PositionedField.module.css\";\r\nimport cx from \"classnames\";\r\n\r\n@observer\r\nexport class PositionedField extends React.Component<IPositionedFieldProps> {\r\n  render() {\r\n    const {columnIndex, worldBounds, cellRectangle} = this.props;\r\n    const columnLeft = cellRectangle.columnLeft;\r\n    const columnWidth = cellRectangle.columnWidth;\r\n    const rowTop = cellRectangle.rowTop;\r\n    const rowHeight = 25; //cellRectangle.rowHeight;\r\n    const {scrollTop, scrollLeft} = this.props.scrollOffsetSource;\r\n    return ReactDOM.createPortal(\r\n      <div\r\n        className={cx(S.positionedField, {isFirstColumn: columnIndex === 0})}\r\n        onClick={(event: any) => event.stopPropagation()}\r\n        onMouseEnter={this.props.onMouseEnter}\r\n        style={{\r\n          top: worldBounds.top + rowTop - scrollTop,\r\n          left:\r\n            columnIndex < this.props.fixedColumnsCount\r\n              ? worldBounds.left + columnLeft\r\n              : worldBounds.left + columnLeft - scrollLeft,\r\n          width: columnWidth,\r\n          height: rowHeight,\r\n        }}\r\n      >\r\n        {this.props.children}\r\n      </div>,\r\n      document.getElementById(\"form-field-portal\")!\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { observer } from \"mobx-react\";\r\nimport * as React from \"react\";\r\nimport { IScrolleeProps } from \"./types\";\r\nimport S from \"./Scrollee.module.css\";\r\n\r\n/*\r\n  Component translating its content according to scrollOffsetSource.\r\n*/\r\n\r\n// TODO: Maybe add hideOverflow property to disable content clipping? (or allow some custom class?)\r\n@observer\r\nexport default class Scrollee extends React.Component<IScrolleeProps> {\r\n  public render() {\r\n    return (\r\n      <div\r\n        className={S.scrollee}\r\n        style={{\r\n          width: this.props.width,\r\n          height: this.props.height,\r\n          zIndex: this.props.zIndex || 0,\r\n        }}\r\n      >\r\n        <div\r\n          className={S.scrolleeShifted}\r\n          style={{\r\n            top:\r\n              (this.props.fixedVert ? 0 : -this.props.scrollOffsetSource.scrollTop) +\r\n              (this.props.offsetTop || 0),\r\n            left:\r\n              (this.props.fixedHoriz ? 0 : -this.props.scrollOffsetSource.scrollLeft) +\r\n              (this.props.offsetLeft || 0),\r\n          }}\r\n        >\r\n          {this.props.children}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action, observable } from \"mobx\";\r\nimport * as React from \"react\";\r\nimport { IScrollerProps } from \"./types\";\r\nimport { observer } from \"mobx-react\";\r\nimport S from \"./Scroller.module.css\";\r\nimport { busyDelayMillis } from \"../../../../utils/flow\";\r\n\r\n/*\r\n  Two divs broadcasting the outer one's scroll state to scrollOffsetTarget.\r\n*/\r\n@observer\r\nexport default class Scroller extends React.Component<IScrollerProps> {\r\n  @observable.ref private elmScrollerDiv: HTMLDivElement | null = null;\r\n  private lastScrollLeft: number = 0;\r\n  private lastScrollTop: number = 0;\r\n  private clickHandler: SequentialSingleDoubleClickHandler = new SequentialSingleDoubleClickHandler(\r\n    (event: any) => this.runOnclick(event)\r\n  );\r\n\r\n  @action.bound scrollTo(coords: { scrollLeft?: number; scrollTop?: number }) {\r\n    if (this.elmScrollerDiv) {\r\n      if (coords.scrollTop !== undefined) {\r\n        this.elmScrollerDiv.scrollTop = coords.scrollTop;\r\n      }\r\n      if (coords.scrollLeft !== undefined) {\r\n        this.forceScrollLeft(coords.scrollLeft); // will scroll even if this.props.scrollingDisabled is true\r\n        this.elmScrollerDiv.scrollLeft = coords.scrollLeft;\r\n      }\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  private handleScroll(event: any) {\r\n    if (this.props.scrollingDisabled) {\r\n      event.target.scrollLeft = this.lastScrollLeft;\r\n      event.target.scrollTop = this.lastScrollTop;\r\n    } else {\r\n      this.lastScrollLeft = event.target.scrollLeft;\r\n      this.lastScrollTop = event.target.scrollTop;\r\n    }\r\n\r\n    this.props.onScroll(event, event.target.scrollLeft, event.target.scrollTop);\r\n  }\r\n\r\n  forceScrollLeft(left: number) {\r\n    this.lastScrollLeft = left;\r\n  }\r\n\r\n  set scrollTop(value: number) {\r\n    if (this.elmScrollerDiv) {\r\n      this.elmScrollerDiv.scrollTop = value;\r\n    }\r\n  }\r\n\r\n  set scrollLeft(value: number) {\r\n    if (this.elmScrollerDiv) {\r\n      this.elmScrollerDiv.scrollLeft = value;\r\n    }\r\n  }\r\n\r\n  get scrollTop() {\r\n    return this.elmScrollerDiv ? this.elmScrollerDiv.scrollTop : 0;\r\n  }\r\n\r\n  get scrollLeft() {\r\n    return this.elmScrollerDiv ? this.elmScrollerDiv.scrollLeft : 0;\r\n  }\r\n\r\n  public get horizontalScrollbarSize() {\r\n    return this.elmScrollerDiv\r\n      ? this.elmScrollerDiv.offsetHeight - this.elmScrollerDiv.clientHeight\r\n      : 0;\r\n  }\r\n\r\n  public get verticalScrollbarSize() {\r\n    return this.elmScrollerDiv\r\n      ? this.elmScrollerDiv.offsetWidth - this.elmScrollerDiv.clientWidth\r\n      : 0;\r\n  }\r\n\r\n  public focus() {\r\n    this.elmScrollerDiv && this.elmScrollerDiv.focus();\r\n  }\r\n\r\n  @action.bound\r\n  private refScrollerDiv(elm: HTMLDivElement) {\r\n    this.elmScrollerDiv = elm;\r\n  }\r\n\r\n  private runOnclick(event: any) {\r\n    const scrollerRect = this.elmScrollerDiv!.getBoundingClientRect();\r\n    this.props.onClick &&\r\n    this.props.onClick(\r\n      event,\r\n      event.clientX - scrollerRect.left,\r\n      event.clientY - scrollerRect.top\r\n    );\r\n  }\r\n\r\n  lastMouseX = 0;\r\n  lastMouseY = 0;\r\n  timeout: NodeJS.Timeout | undefined;\r\n\r\n  @action.bound\r\n  handleMouseMove(event: React.MouseEvent<HTMLDivElement, MouseEvent>) {\r\n    event.persist();\r\n    const scrollerRect = this.elmScrollerDiv!.getBoundingClientRect();\r\n    this.props.onMouseMove?.(\r\n      event,\r\n      event.clientX - scrollerRect.left,\r\n      event.clientY - scrollerRect.top\r\n    );\r\n    const distanceSinceLastMove = Math.sqrt(\r\n      (event.clientX - this.lastMouseX) ** 2 + (event.clientY - this.lastMouseY) ** 2\r\n    );\r\n    this.lastMouseX = event.clientX;\r\n    this.lastMouseY = event.clientY;\r\n\r\n    if (distanceSinceLastMove > 1) {\r\n      if (this.timeout) {\r\n        clearTimeout(this.timeout);\r\n      }\r\n\r\n      const boundingRectangle = this.elmScrollerDiv!.getBoundingClientRect();\r\n      this.timeout = setTimeout(() => {\r\n        this.props.onMouseOver(event, boundingRectangle);\r\n      }, 500);\r\n    }\r\n  }\r\n\r\n  handleMouseLeave(event: any) {\r\n    if (this.timeout) {\r\n      clearTimeout(this.timeout);\r\n    }\r\n    this.props.onMouseLeave(event);\r\n  }\r\n\r\n  @action.bound\r\n  private handleWindowClick(event: any) {\r\n    if (this.elmScrollerDiv && !this.elmScrollerDiv.contains(event.target)) {\r\n      this.props.onOutsideClick && this.props.onOutsideClick(event);\r\n    }\r\n  }\r\n\r\n  public componentDidMount() {\r\n    window.addEventListener(\"click\", this.handleWindowClick);\r\n  }\r\n\r\n  public componentWillUnmount() {\r\n    window.removeEventListener(\"click\", this.handleWindowClick);\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <div\r\n        className={\r\n          S.scroller +\r\n          (1 ? \" horiz-scrollbar\" : \"\") +\r\n          (1 ? \" vert-scrollbar\" : \"\") +\r\n          (!this.props.isVisible ? \" hidden\" : \"\")\r\n        }\r\n        tabIndex={1}\r\n        style={{width: this.props.width, height: this.props.height}}\r\n        onScroll={this.handleScroll}\r\n        onClick={(e) => this.clickHandler.handleClick(e)}\r\n        onMouseMove={(event) => this.handleMouseMove(event)}\r\n        onMouseLeave={(event) => this.handleMouseLeave(event)}\r\n        onKeyDown={(event) => this.props.onKeyDown?.(event)}\r\n        onFocus={() => this.props.onFocus()}\r\n        ref={this.refScrollerDiv}\r\n      >\r\n        <div\r\n          className={S.fakeContent}\r\n          style={{\r\n            width: this.props.contentWidth + this.horizontalScrollbarSize,\r\n            height: this.props.contentHeight + this.verticalScrollbarSize,\r\n          }}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n// Ensures that single click is handled before double click and\r\n// that single click callback does not prevent double click from being registered\r\nclass SequentialSingleDoubleClickHandler {\r\n  private timer: any = null;\r\n  private readonly runOnclick: (event: any) => void;\r\n  private singleClickIsRunning = false;\r\n  firstEvent: any | undefined;\r\n  private readonly doubleClickDelayMillis = busyDelayMillis;\r\n\r\n  constructor(runOnclick: (event: any) => void) {\r\n    this.runOnclick = runOnclick;\r\n  }\r\n\r\n  sleep(ms: number) {\r\n    return new Promise((resolve) => (this.timer = setTimeout(resolve, ms)));\r\n  }\r\n\r\n  @action.bound\r\n  async handleClick(event: any) {\r\n    event.persist();\r\n    event.preventDefault();\r\n\r\n    if (!this.singleClickIsRunning) {\r\n      this.singleClickIsRunning = true;\r\n      this.singleClick(event);\r\n      await this.sleep(this.doubleClickDelayMillis);\r\n      this.singleClickIsRunning = false;\r\n    } else {\r\n      if (clickDistance(this.firstEvent, event) < 5) {\r\n        this.doubleClick(event);\r\n      }\r\n      this.firstEvent = undefined;\r\n      this.singleClickIsRunning = false;\r\n    }\r\n  }\r\n\r\n  private singleClick(event: any) {\r\n    this.firstEvent = event;\r\n    event.isDouble = false;\r\n    this.runOnclick(event);\r\n  }\r\n\r\n  private doubleClick(event: any) {\r\n    event.isDouble = true;\r\n    this.runOnclick(event);\r\n  }\r\n}\r\n\r\nfunction clickDistance(event1: any, event2: any) {\r\n  return Math.sqrt((event1.screenX - event2.screenX) ** 2 + (event1.screenY - event2.screenY) ** 2);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { rowHeight, viewportBottom, viewportTop } from \"./renderingValues\";\r\n\r\n\r\nexport function firstDrawableRowIndex() {\r\n  return Math.floor(viewportTop() / rowHeight());\r\n}\r\n\r\nexport function lastDrawableRowIndex() {\r\n  return Math.ceil(viewportBottom() / rowHeight());\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { currentRowCellsDimensions } from \"./currentRowCells\";\r\nimport { viewportLeft, viewportRight } from \"./renderingValues\";\r\n\r\nexport function firstDrawableColumnIndex() {\r\n  const dimensions = currentRowCellsDimensions();\r\n  const wpLeft = viewportLeft();\r\n  for (let i = 0; i < dimensions.length; i++) {\r\n    if (dimensions[i].right >= wpLeft) return i\r\n  }\r\n}\r\n\r\nexport function lastDrawableColumnIndex() {\r\n  const dimensions = currentRowCellsDimensions();\r\n  const wpRight = viewportRight();\r\n  for (let i = dimensions.length - 1; i >= 0; i--) {\r\n    if (dimensions[i].left <= wpRight) return i\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport {\r\n  clickSubscriptions,\r\n  columnWidths,\r\n  context,\r\n  context2d,\r\n  currentRow,\r\n  drawingColumnIndex,\r\n  fixedColumnCount,\r\n  gridLeadCellDimensions,\r\n  groupingColumnIds,\r\n  isCheckBoxedTable,\r\n  mouseMoveSubscriptions,\r\n  mouseOverSubscriptions,\r\n  propertyById,\r\n  realFixedColumnCount,\r\n  rowHeight,\r\n  rowIndex,\r\n  scRenderCell,\r\n  scRenderRow,\r\n  scRenderTable,\r\n  scrollLeft,\r\n  scrollTop,\r\n  setCurrentRowRightBorderDrawn,\r\n  tableColumnIds,\r\n  tableRows,\r\n  viewportHeight,\r\n  viewportWidth,\r\n} from \"./renderingValues\";\r\nimport { firstDrawableRowIndex, lastDrawableRowIndex } from \"./drawableRowIndex\";\r\nimport { drawCurrentCell } from \"./currentCell\";\r\nimport { firstDrawableColumnIndex, lastDrawableColumnIndex } from \"./drawableColumnIndex\";\r\nimport { IClickSubsItem, IMouseOverSubsItem, ITableRow } from \"./types\";\r\nimport { CPR } from \"utils/canvas\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { currentRowCellsDimensions, currentRowCellsDraws, } from \"./currentRowCells\";\r\nimport { cellLayerCount, setLayerIndex } from \"./currentCellLayerIndex\";\r\nimport {\r\n  clearTableDebugValues,\r\n  setTableDebugRendered\r\n} from \"gui/Components/ScreenElements/Table/TableRendering/DebugTableMonitor\";\r\n\r\nexport function renderTable(\r\n  aCtx: any,\r\n  aCtx2d: CanvasRenderingContext2D,\r\n  aTableRows: ITableRow[],\r\n  aGroupedColumnIds: string[],\r\n  aTableColumnIds: string[],\r\n  aPropertyById: Map<string, IProperty>,\r\n  aScrollLeft: number,\r\n  aScrollTop: number,\r\n  aViewportWidth: number,\r\n  aViewportHeight: number,\r\n  aIsCheckBoxedTable: boolean,\r\n  aGridLeadCellDimensions: { left: number; width: number; right: number }[],\r\n  aColumnWidths: Map<string, number>,\r\n  aFixedColumnCount: number,\r\n  aClickSubscriptions: IClickSubsItem[],\r\n  aMouseMoveSubscriptions: IClickSubsItem[],\r\n  aMouseOverSubscriptions: IMouseOverSubsItem[],\r\n  aRowHeight: number\r\n) {\r\n  context.set(aCtx);\r\n  context2d.set(aCtx2d);\r\n  tableRows.set(aTableRows);\r\n  groupingColumnIds.set(aGroupedColumnIds);\r\n  tableColumnIds.set(aTableColumnIds);\r\n  propertyById.set(aPropertyById);\r\n  scrollLeft.set(aScrollLeft);\r\n  scrollTop.set(aScrollTop);\r\n  viewportWidth.set(aViewportWidth);\r\n  viewportHeight.set(aViewportHeight);\r\n  isCheckBoxedTable.set(aIsCheckBoxedTable);\r\n  gridLeadCellDimensions.set(aGridLeadCellDimensions);\r\n  rowHeight.set(aRowHeight);\r\n  columnWidths.set(aColumnWidths);\r\n  fixedColumnCount.set(aFixedColumnCount);\r\n  clickSubscriptions.set(aClickSubscriptions);\r\n  mouseMoveSubscriptions.set(aMouseMoveSubscriptions);\r\n  mouseOverSubscriptions.set(aMouseOverSubscriptions);\r\n  try {\r\n    clearTableDebugValues(context());\r\n    clickSubscriptions().length = 0;\r\n    mouseOverSubscriptions().length = 0;\r\n    mouseMoveSubscriptions().length = 0;\r\n    const ctx2d = context2d();\r\n    ctx2d.fillStyle = \"white\";\r\n    ctx2d.fillRect(0, 0, CPR() * viewportWidth(), CPR() * viewportHeight());\r\n    const i0 = firstDrawableRowIndex();\r\n    const i1 = lastDrawableRowIndex();\r\n    if (i0 === undefined || i1 === undefined) return;\r\n    for (let i = i0; i <= i1; i++) {\r\n      renderRow(i);\r\n    }\r\n    setTableDebugRendered(context())\r\n  } finally {\r\n    for (let d of scRenderTable) d();\r\n  }\r\n}\r\n\r\nfunction renderRowInternal() {\r\n  if(rowIndex() === 0){\r\n    clearTableDebugValues(context());\r\n  }\r\n  const fixColC = realFixedColumnCount();\r\n  const firstDrCI = firstDrawableColumnIndex();\r\n  const lastDrCI = lastDrawableColumnIndex();\r\n  if (firstDrCI !== undefined && lastDrCI !== undefined) {\r\n    const i0 = Math.max(fixColC, firstDrCI);\r\n    const i1 = lastDrCI;\r\n    for (let i = i1; i >= i0; i--) {\r\n      renderCell(i);\r\n    }\r\n  }\r\n  for (let i = 0; i < fixColC; i++) {\r\n    renderCell(i);\r\n  }\r\n}\r\n\r\nfunction renderSecondLayerCells() {\r\n  setLayerIndex(1);\r\n  currentRowCellsDimensions.clear();\r\n  currentRowCellsDraws.clear()\r\n  renderRowInternal();\r\n  setLayerIndex(0);\r\n}\r\n\r\nexport function renderRow(rowIdx: number) {\r\n  rowIndex.set(rowIdx);\r\n  setCurrentRowRightBorderDrawn(false);\r\n  try {\r\n    if (!currentRow()) return;\r\n    renderRowInternal();\r\n    if (cellLayerCount() === 2) {\r\n      renderSecondLayerCells();\r\n    }\r\n  } finally {\r\n    for (let d of scRenderRow) d();\r\n  }\r\n}\r\n\r\nexport function renderCell(columnIdx: number) {\r\n  drawingColumnIndex.set(columnIdx);\r\n  try {\r\n    const ctx2d = context2d();\r\n    ctx2d.save();\r\n    drawCurrentCell();\r\n    ctx2d.restore();\r\n  } finally {\r\n    for (let d of scRenderCell) d();\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { CtxPanelVisibility } from \"gui/contexts/GUIContexts\";\r\nimport { action, autorun, comparer, computed, observable, runInAction } from \"mobx\";\r\nimport { MobXProviderContext, Observer, observer } from \"mobx-react\";\r\nimport { ITablePanelView } from \"model/entities/TablePanelView/types/ITablePanelView\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { getIsSelectionCheckboxesShown } from \"model/selectors/DataView/getIsSelectionCheckboxesShown\";\r\nimport { getProperties } from \"model/selectors/DataView/getProperties\";\r\nimport { getGroupingConfiguration } from \"model/selectors/TablePanelView/getGroupingConfiguration\";\r\nimport { getTableViewProperties } from \"model/selectors/TablePanelView/getTableViewProperties\";\r\nimport * as React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport Measure, { BoundingRect } from \"react-measure\";\r\nimport { Canvas } from \"./Canvas\";\r\nimport { HeaderRow } from \"./HeaderRow\";\r\nimport { PositionedField } from \"./PositionedField\";\r\nimport Scrollee from \"./Scrollee\";\r\nimport Scroller from \"./Scroller\";\r\nimport S from \"./Table.module.scss\";\r\nimport { getTooltip, handleTableClick, handleTableMouseMove } from \"./TableRendering/onClick\";\r\nimport { renderTable } from \"./TableRendering/renderTable\";\r\nimport { IClickSubsItem, IMouseOverSubsItem, ITableRow, IToolTipData } from \"./TableRendering/types\";\r\nimport { IGridDimensions, ITableProps } from \"./types\";\r\nimport { DragDropContext, Droppable } from \"react-beautiful-dnd\";\r\nimport { onColumnOrderChangeFinished } from \"model/actions-ui/DataView/TableView/onColumnOrderChangeFinished\";\r\n\r\nfunction createTableRenderer(ctx: any, gridDimensions: IGridDimensions) {\r\n  const groupedColumnSettings = computed(\r\n    () => getGroupingConfiguration(ctx).orderedGroupingColumnSettings\r\n  );\r\n  const properties = observable<IProperty>(getProperties(ctx));\r\n  const propertyById = computed(\r\n    () => new Map(properties.map((property) => [property.id, property]))\r\n  );\r\n\r\n  const tableColumnIds = computed(() => getTableViewProperties(ctx).map((prop) => prop.id));\r\n\r\n  const scrollTopObs = observable.box<number>(0);\r\n  const scrollLeftObs = observable.box<number>(0);\r\n  const viewportWidthObs = observable.box<number>(500);\r\n  const viewportHeightObs = observable.box<number>(300);\r\n\r\n  const clickSubscriptions: IClickSubsItem[] = [];\r\n  const mouseOverSubscriptions: IMouseOverSubsItem[] = [];\r\n  const mouseMoveSubscriptions: IClickSubsItem[] = [];\r\n\r\n  const isCheckBoxedTable = getIsSelectionCheckboxesShown(ctx);\r\n\r\n  function drawTable(\r\n    ctx2d: CanvasRenderingContext2D,\r\n    fixedColumnCount: number,\r\n    tableRows: ITableRow[]\r\n  ) {\r\n    renderTable(\r\n      ctx,\r\n      ctx2d,\r\n      tableRows,\r\n      groupedColumnSettings.get().map((settings) => settings.columnId),\r\n      tableColumnIds.get(),\r\n      propertyById.get(),\r\n      scrollLeftObs.get(),\r\n      scrollTopObs.get(),\r\n      viewportWidthObs.get(),\r\n      viewportHeightObs.get(),\r\n      isCheckBoxedTable,\r\n      gridDimensions.displayedColumnDimensionsCom,\r\n      gridDimensions.columnWidths,\r\n      fixedColumnCount,\r\n      clickSubscriptions,\r\n      mouseMoveSubscriptions,\r\n      mouseOverSubscriptions,\r\n      gridDimensions.rowHeight\r\n    );\r\n  }\r\n\r\n  function setScroll(scrollLeft: number, scrollTop: number) {\r\n    runInAction(() => {\r\n      scrollTopObs.set(scrollTop);\r\n      scrollLeftObs.set(scrollLeft);\r\n    });\r\n  }\r\n\r\n  function handleClick(event: any) {\r\n    const domRect = event.target.getBoundingClientRect();\r\n    const handlingResult = handleTableClick(\r\n      event,\r\n      event.clientX - domRect.x,\r\n      event.clientY - domRect.y,\r\n      scrollLeftObs.get(),\r\n      scrollTopObs.get(),\r\n      clickSubscriptions\r\n    );\r\n    return handlingResult;\r\n  }\r\n\r\n  function handleMouseMove(event: any) {\r\n    const domRect = event.target.getBoundingClientRect();\r\n    const handlingResult = handleTableMouseMove(\r\n      event,\r\n      event.clientX - domRect.x,\r\n      event.clientY - domRect.y,\r\n      scrollLeftObs.get(),\r\n      scrollTopObs.get(),\r\n      mouseMoveSubscriptions\r\n    );\r\n    return handlingResult;\r\n  }\r\n\r\n  function setViewportSize(width: number, height: number) {\r\n    runInAction(() => {\r\n      viewportWidthObs.set(width);\r\n      viewportHeightObs.set(height);\r\n    });\r\n  }\r\n\r\n  function getToolTipContent(event: any, boundingRectangle: DOMRect) {\r\n    return getTooltip(\r\n      event.clientX - boundingRectangle.x + scrollLeftObs.get(),\r\n      event.clientY - boundingRectangle.y + scrollTopObs.get(),\r\n      mouseOverSubscriptions\r\n    );\r\n  }\r\n\r\n  return {drawTable, setScroll, handleClick, handleMouseMove, setViewportSize, getToolTipContent};\r\n}\r\n\r\nexport const Table: React.FC<ITableProps & {\r\n  refTable(elm: RawTable | null): void;\r\n}> = (props) => {\r\n  const ctxPanelVisibility = React.useContext(CtxPanelVisibility);\r\n  return <RawTable {...props} isVisible={ctxPanelVisibility.isVisible} ref={props.refTable}/>;\r\n};\r\n\r\n@observer\r\nexport class RawTable extends React.Component<ITableProps & { isVisible: boolean }> {\r\n  static contextType = MobXProviderContext;\r\n\r\n  tableRenderer = createTableRenderer(this.context.tablePanelView, this.props.gridDimensions);\r\n\r\n  @observable _contentBounds: BoundingRect = {\r\n    top: 0,\r\n    left: 0,\r\n    bottom: 0,\r\n    right: 0,\r\n    width: 0,\r\n    height: 0,\r\n  };\r\n  @computed({equals: comparer.structural}) get contentBounds() {\r\n    return this._contentBounds;\r\n  }\r\n\r\n  set contentBounds(value: BoundingRect) {\r\n    this._contentBounds = value;\r\n  }\r\n\r\n  @observable.ref elmCanvasFixed: Canvas | null = null;\r\n  @observable.ref elmCanvasMoving: Canvas | null = null;\r\n\r\n  @observable.ref elmCanvasElement: HTMLCanvasElement | null = null;\r\n  @observable.ref ctxCanvas: CanvasRenderingContext2D | null = null;\r\n\r\n  @observable.ref elmScroller: Scroller | null = null;\r\n\r\n  elmMeasure: Measure | null = null;\r\n\r\n  @action.bound handleWindowClick(event: any) {\r\n    const domNode = ReactDOM.findDOMNode(this.elmScroller);\r\n    if (domNode && !domNode.contains(event.target)) {\r\n      this.props.onOutsideTableClick && this.props.onOutsideTableClick(event);\r\n    }\r\n  }\r\n\r\n  @action.bound refCanvasFixed(elm: Canvas | null) {\r\n    this.elmCanvasFixed = elm;\r\n  }\r\n\r\n  @action.bound refCanvasMoving(elm: Canvas | null) {\r\n    this.elmCanvasMoving = elm;\r\n    this.props.refCanvasMovingComponent && this.props.refCanvasMovingComponent(elm);\r\n  }\r\n\r\n  @action.bound refCanvasElement(elm: HTMLCanvasElement | null) {\r\n    this.elmCanvasElement = elm;\r\n    if (elm) {\r\n      this.ctxCanvas = elm.getContext(\"2d\");\r\n    } else {\r\n      this.ctxCanvas = null;\r\n    }\r\n  }\r\n\r\n  @action.bound refMeasure(elm: Measure | null) {\r\n    this.elmMeasure = elm;\r\n  }\r\n\r\n  @action.bound refScroller(elm: Scroller | null) {\r\n    this.elmScroller = elm;\r\n    if (elm) {\r\n      this.props.scrollState.scrollToFunction = elm.scrollTo;\r\n      window.addEventListener(\"click\", this.handleWindowClick);\r\n    } else {\r\n      window.removeEventListener(\"click\", this.handleWindowClick);\r\n    }\r\n  }\r\n\r\n  disposers: Array<() => void> = [];\r\n\r\n  componentDidMount() {\r\n    this.disposers.push(\r\n      autorun(\r\n        () => {\r\n          if (this.ctxCanvas) {\r\n            this.tableRenderer.drawTable(\r\n              this.ctxCanvas,\r\n              this.props.fixedColumnCount,\r\n              this.props.tableRows\r\n            );\r\n          }\r\n        },\r\n        {\r\n          scheduler(fn) {\r\n            requestAnimationFrame(fn);\r\n          },\r\n        }\r\n      )\r\n    );\r\n    this.props.listenForScrollToCell &&\r\n    this.disposers.push(\r\n      this.props.listenForScrollToCell((rowIdx, colIdx) => {\r\n        this.scrollToCellShortest(rowIdx, colIdx);\r\n      })\r\n    );\r\n  }\r\n\r\n  componentDidUpdate(prevProps: ITableProps & { isVisible: boolean }) {\r\n    if (this.props.isVisible !== prevProps.isVisible) {\r\n      this.remeasureCellArea();\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.disposers.forEach((d) => d());\r\n  }\r\n\r\n  @action.bound remeasureCellArea() {\r\n    if (this.elmMeasure && (this.elmMeasure as any).measure) {\r\n      (this.elmMeasure as any).measure();\r\n    }\r\n  }\r\n\r\n  @action.bound focusTable() {\r\n    this.elmScroller && this.elmScroller.focus();\r\n  }\r\n\r\n  @action.bound scrollToCellShortest(rowIdx: number, dataColumnIndex: number) {\r\n    // TODO: Refactor to take real scrollbar sizes\r\n    //const freeColIndex = columnIdx + this.fixedColumnCount;\r\n    const {gridDimensions} = this.props;\r\n    const SCROLLBAR_SIZE = 20;\r\n    if (this.elmScroller) {\r\n      const top = gridDimensions.getRowTop(rowIdx);\r\n      const bottom = gridDimensions.getRowBottom(rowIdx);\r\n      const left = gridDimensions.getColumnLeft(dataColumnIndex);\r\n      const right = gridDimensions.getColumnRight(dataColumnIndex);\r\n\r\n      if (left - this.elmScroller.scrollLeft < this.fixedColumnsWidth) {\r\n        this.elmScroller.scrollTo({\r\n          scrollLeft: left - this.fixedColumnsWidth,\r\n        });\r\n      }\r\n      if (right - this.elmScroller.scrollLeft > this.contentBounds.width - SCROLLBAR_SIZE) {\r\n        this.elmScroller.scrollTo({\r\n          scrollLeft: right - this.contentBounds.width + SCROLLBAR_SIZE,\r\n        });\r\n      }\r\n      if (top - this.elmScroller.scrollTop < 0) {\r\n        this.elmScroller.scrollTo({scrollTop: top});\r\n      }\r\n      if (bottom - this.elmScroller.scrollTop > this.contentBounds.height - SCROLLBAR_SIZE) {\r\n        this.elmScroller.scrollTo({\r\n          scrollTop: bottom - this.contentBounds.height + SCROLLBAR_SIZE,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  get fixedColumnCount() {\r\n    return this.fixedHeaderContainers.length;\r\n  }\r\n\r\n  get hasFixedColumns() {\r\n    return this.fixedHeaderContainers.length !== 0;\r\n  }\r\n\r\n  @computed get fixedColumnsWidth() {\r\n    return this.fixedHeaderContainers\r\n      .map((container) => container.width)\r\n      .reduce((x, y) => x + y, 0);\r\n  }\r\n\r\n  @computed get freeHeaderContainers() {\r\n    return this.props.headerContainers.filter((container) => !container.isFixed);\r\n  }\r\n\r\n  @computed get freeHeaders() {\r\n    return this.freeHeaderContainers.map((container) => container.header);\r\n  }\r\n\r\n  @computed get fixedHeaderContainers() {\r\n    return this.props.headerContainers.filter((container) => container.isFixed);\r\n  }\r\n\r\n  @computed get fixedHeaders() {\r\n    return this.fixedHeaderContainers.map((container) => container.header);\r\n  }\r\n\r\n  get tablePanelView() {\r\n    return this.context.tablePanelView as ITablePanelView;\r\n  }\r\n\r\n  @observable\r\n  toolTipData: IToolTipData | undefined = undefined;\r\n\r\n  @action.bound onMouseOver(event: any, boundingRectangle: DOMRect) {\r\n    this.toolTipData = undefined;\r\n    setTimeout(() => {\r\n      runInAction(() => {\r\n        //console.log(\"mouseOver\", boundingRectangle);\r\n        this.mouseInToolTipEnabledArea = true;\r\n        //this.toolTipData = this.tableRenderer.getToolTipContent(event, boundingRectangle);\r\n      });\r\n    });\r\n  }\r\n\r\n  @action.bound\r\n  handleScrollerMouseMove(event: any) {\r\n    this.tableRenderer.handleMouseMove(event);\r\n  }\r\n\r\n  @observable\r\n  mouseInToolTipEnabledArea = true;\r\n\r\n  @action.bound onMouseLeaveToolTipEnabledArea(event: any) {\r\n    this.tablePanelView.currentTooltipText = undefined;\r\n    this.mouseInToolTipEnabledArea = false;\r\n  }\r\n\r\n  @action.bound handleScrollerClick(event: any) {\r\n    const {handled} = this.tableRenderer.handleClick(event);\r\n    if (!handled) this.props.onOutsideTableClick?.(event);\r\n  }\r\n\r\n  @action.bound handleResize(contentRect: { bounds: BoundingRect }) {\r\n    this.contentBounds = contentRect.bounds;\r\n    this.props.onContentBoundsChanged(contentRect.bounds);\r\n    this.tableRenderer.setViewportSize(this.contentBounds.width, this.contentBounds.height);\r\n  }\r\n\r\n  @action.bound handleScroll(event: any, scrollLeft: number, scrollTop: number) {\r\n    this.context.tablePanelView.handleTableScroll(event, scrollTop, scrollLeft);\r\n    this.props.scrollState.setScrollOffset(event, scrollTop, scrollLeft);\r\n    this.tableRenderer.setScroll(scrollLeft, scrollTop);\r\n  }\r\n\r\n  onColumnDragEnd(result: any) {\r\n    if (!result.destination) {\r\n      return;\r\n    }\r\n    let destinationHeaderIndex = Math.floor(result.destination.index); // separators must also have indices (1.5, 2.5, 3.5...)\r\n    onColumnOrderChangeFinished(\r\n      this.context.tablePanelView,\r\n      this.context.tablePanelView.tablePropertyIds[result.source.index],\r\n      this.context.tablePanelView.tablePropertyIds[destinationHeaderIndex]\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const editorCellRectangle =\r\n      this.props.editingRowIndex !== undefined && this.props.editingColumnIndex !== undefined\r\n        ? this.tablePanelView.getCellRectangle(\r\n          this.props.editingRowIndex,\r\n          this.props.editingColumnIndex\r\n        )\r\n        : undefined;\r\n\r\n    return (\r\n      <div className={S.table}>\r\n        {this.props.isLoading && (\r\n          <div className={S.loadingOverlay}>\r\n            <div className={S.loadingIcon}>\r\n              <i className=\"far fa-clock fa-7x blink\"/>\r\n            </div>\r\n          </div>\r\n        )}\r\n        <Measure ref={this.refMeasure} bounds={true} onResize={this.handleResize}>\r\n          {({measureRef, contentRect}) => (\r\n            <Observer>\r\n              {() => (\r\n                <>\r\n                  {this.props.headerContainers &&\r\n                  (contentRect.bounds!.width ? (\r\n                    <div className={S.headers}>\r\n                      {this.hasFixedColumns ? (\r\n                        <Scrollee\r\n                          scrollOffsetSource={this.props.scrollState}\r\n                          fixedHoriz={true}\r\n                          fixedVert={true}\r\n                          width={this.fixedColumnsWidth}\r\n                          zIndex={101}\r\n                        >\r\n                          <HeaderRow headerElements={this.fixedHeaders} zIndex={100}/>\r\n                        </Scrollee>\r\n                      ) : null}\r\n                      <Scrollee\r\n                        scrollOffsetSource={this.props.scrollState}\r\n                        fixedVert={true}\r\n                        zIndex={100}\r\n                        width={contentRect.bounds!.width - 10 - this.fixedColumnsWidth}\r\n                      >\r\n                        <DragDropContext onDragEnd={(result) => this.onColumnDragEnd(result)}>\r\n                          <Droppable droppableId=\"headers\" direction=\"horizontal\" >\r\n                            {(provided) => (\r\n                              // width:\"10000%\" - when the table was horizontally scrolled to the right the drag\r\n                              // and drop did not work on the headers that were outside of the originally visible area.\r\n                              // This div has to be at least as wide as ALL its children, not just the visible ones.\r\n                              <div style={{width:\"10000%\"}}  {...provided.droppableProps} ref={provided.innerRef}>\r\n                                <HeaderRow headerElements={[...this.freeHeaders, <div key={\"placeholder\"}>{provided.placeholder}</div> as any]}/>\r\n                              </div>\r\n                            )}\r\n                          </Droppable>\r\n                        </DragDropContext>\r\n                      </Scrollee>\r\n                    </div>\r\n                  ) : null)}\r\n\r\n                  <div\r\n                    ref={measureRef}\r\n                    className={S.cellAreaContainer}\r\n                    title={this.tablePanelView.currentTooltipText}\r\n                  >\r\n                    <>\r\n                      {contentRect.bounds!.height ? (\r\n                        <div className={S.canvasRow}>\r\n                          <Canvas\r\n                            refCanvasElement={this.refCanvasElement}\r\n                            width={contentRect.bounds!.width}\r\n                            height={contentRect.bounds!.height}\r\n                          />\r\n                        </div>\r\n                      ) : null}\r\n                      {this.props.isEditorMounted && editorCellRectangle && (\r\n                        <PositionedField\r\n                          fixedColumnsCount={this.fixedColumnCount}\r\n                          rowIndex={this.props.editingRowIndex!}\r\n                          columnIndex={this.props.editingColumnIndex!}\r\n                          scrollOffsetSource={this.props.scrollState}\r\n                          worldBounds={contentRect.bounds!}\r\n                          cellRectangle={editorCellRectangle!}\r\n                          onMouseEnter={(event) => this.onMouseLeaveToolTipEnabledArea(event)}\r\n                        >\r\n                          {this.props.renderEditor && this.props.renderEditor()}\r\n                        </PositionedField>\r\n                      )}\r\n                      <Scroller\r\n                        ref={this.refScroller}\r\n                        width={contentRect.bounds!.width}\r\n                        height={contentRect.bounds!.height}\r\n                        isVisible={true}\r\n                        scrollingDisabled={false /*this.props.isEditorMounted*/}\r\n                        contentWidth={this.props.gridDimensions.contentWidth + 20}\r\n                        // +30px to make the last row visible on some dirty browsers\r\n                        contentHeight={this.props.gridDimensions.contentHeight + 30}\r\n                        onScroll={this.handleScroll}\r\n                        onClick={this.handleScrollerClick}\r\n                        onMouseMove={this.handleScrollerMouseMove}\r\n                        onMouseOver={this.onMouseOver}\r\n                        onMouseLeave={(event) => this.onMouseLeaveToolTipEnabledArea(event)}\r\n                        onKeyDown={this.props.onKeyDown}\r\n                        onFocus={this.props.onFocus}\r\n                      />\r\n                    </>\r\n                  </div>\r\n                </>\r\n              )}\r\n            </Observer>\r\n          )}\r\n        </Measure>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { TagInputEditor } from \"gui/Components/ScreenElements/Editors/TagInputEditor\";\r\nimport { TextEditor } from \"gui/Components/ScreenElements/Editors/TextEditor\";\r\nimport { inject, observer, Provider } from \"mobx-react\";\r\nimport { onFieldChange } from \"model/actions-ui/DataView/TableView/onFieldChange\";\r\nimport { onFieldKeyDown } from \"model/actions-ui/DataView/TableView/onFieldKeyDown\";\r\nimport { getRowStateForegroundColor } from \"model/selectors/RowState/getRowStateForegroundColor\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\nimport React from \"react\";\r\nimport { onFieldBlur } from \"model/actions-ui/DataView/TableView/onFieldBlur\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { getSelectedRow } from \"model/selectors/DataView/getSelectedRow\";\r\nimport { getCellValue } from \"model/selectors/TablePanelView/getCellValue\";\r\nimport { getSelectedProperty } from \"model/selectors/TablePanelView/getSelectedProperty\";\r\nimport { BoolEditor } from \"gui/Components/ScreenElements/Editors/BoolEditor\";\r\nimport { DateTimeEditor } from \"gui/Components/ScreenElements/Editors/DateTimeEditor/DateTimeEditor\";\r\nimport { NumberEditor } from \"gui/Components/ScreenElements/Editors/NumberEditor\";\r\nimport { BlobEditor } from \"gui/Components/ScreenElements/Editors/BlobEditor\";\r\nimport { XmlBuildDropdownEditor } from \"modules/Editors/DropdownEditor/DropdownEditor\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport uiActions from \"../../../../model/actions-ui-tree\";\r\nimport { isReadOnly } from \"model/selectors/RowState/isReadOnly\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { rowHeight } from \"gui/Components/ScreenElements/Table/TableRendering/cells/cellsCommon\";\r\nimport { shadeHexColor } from \"utils/colorUtils\";\r\nimport { getRowStateRowBgColor } from \"model/selectors/RowState/getRowStateRowBgColor\";\r\nimport ColorEditor from \"gui/Components/ScreenElements/Editors/ColorEditor\";\r\nimport { flashColor2htmlColor, htmlColor2FlashColor } from \"utils/flashColorFormat\";\r\nimport { getGridFocusManager } from \"model/entities/GridFocusManager\";\r\nimport { CellAlignment } from \"gui/Components/ScreenElements/Table/TableRendering/cells/cellAlignment\";\r\n\r\n@inject(({tablePanelView}) => {\r\n  const row = getSelectedRow(tablePanelView)!;\r\n  const property = getSelectedProperty(tablePanelView)!;\r\n  const actualProperty =\r\n    property.column === \"Polymorph\" ? property.getPolymophicProperty(row) : property;\r\n  return {\r\n    property: actualProperty,\r\n    getCellValue: () => getCellValue(tablePanelView, row, actualProperty),\r\n    onChange: async (event: any, value: any) =>\r\n      await onFieldChange(tablePanelView)({\r\n        event: event,\r\n        row: row,\r\n        property: actualProperty,\r\n        value: value,\r\n      }),\r\n    onEditorBlur: (event: any) => onFieldBlur(tablePanelView)(event),\r\n    onEditorKeyDown: (event: any) => {\r\n      event.persist();\r\n      onFieldKeyDown(tablePanelView)(event);\r\n    },\r\n  };\r\n})\r\n@observer\r\nexport class TableViewEditor extends React.Component<{\r\n  property?: IProperty;\r\n  getCellValue?: () => any;\r\n  onChange?: (event: any, value: any) => Promise<void>;\r\n  onEditorBlur?: (event: any) => void;\r\n  onEditorKeyDown?: (event: any) => void;\r\n}> {\r\n\r\n  componentDidMount() {\r\n    const focusManager = getGridFocusManager(this.props.property);\r\n    focusManager.focusEditor();\r\n  }\r\n\r\n  getEditor() {\r\n    const rowId = getSelectedRowId(this.props.property);\r\n    const foregroundColor = getRowStateForegroundColor(this.props.property, rowId || \"\");\r\n    const dataView = getDataView(this.props.property);\r\n    const readOnly =\r\n      isReadOnly(this.props.property!, rowId) ||\r\n      (dataView.orderProperty !== undefined &&\r\n        this.props.property?.name === dataView.orderProperty.name);\r\n\r\n    const customBackgroundColor = getRowStateRowBgColor(dataView, rowId);\r\n    const backgroundColor = readOnly\r\n      ? shadeHexColor(customBackgroundColor, -0.1)\r\n      : customBackgroundColor;\r\n\r\n    const isFirsColumn = getTablePanelView(dataView).firstColumn === this.props.property;\r\n    const focusManager = getGridFocusManager(this.props.property);\r\n    switch (this.props.property!.column) {\r\n      case \"Number\":\r\n        return (\r\n          <NumberEditor\r\n            value={this.props.getCellValue!()}\r\n            isReadOnly={readOnly}\r\n            isPassword={this.props.property!.isPassword}\r\n            maxLength={this.props.property?.maxLength}\r\n            backgroundColor={backgroundColor}\r\n            foregroundColor={foregroundColor}\r\n            customNumberFormat={this.props.property!.customNumericFormat}\r\n            onChange={this.props.onChange}\r\n            onKeyDown={this.props.onEditorKeyDown}\r\n            onClick={undefined}\r\n            onDoubleClick={(event) => this.onDoubleClick(event)}\r\n            onEditorBlur={this.props.onEditorBlur}\r\n            customStyle={resolveCellAlignment(this.props.property?.style, isFirsColumn, \"Number\")}\r\n            subscribeToFocusManager={(editor) =>\r\n              focusManager.activeEditor = editor\r\n            }\r\n          />\r\n        );\r\n      case \"Text\":\r\n        return (\r\n          <TextEditor\r\n            id={\"editor_\" + this.props.property?.modelInstanceId}\r\n            value={this.props.getCellValue!()}\r\n            isReadOnly={readOnly}\r\n            isPassword={this.props.property!.isPassword}\r\n            backgroundColor={backgroundColor}\r\n            foregroundColor={foregroundColor}\r\n            maxLength={this.props.property?.maxLength}\r\n            onChange={this.props.onChange}\r\n            onKeyDown={this.props.onEditorKeyDown}\r\n            onClick={undefined}\r\n            wrapText={false}\r\n            customStyle={resolveCellAlignment(this.props.property?.style, isFirsColumn, \"Text\")}\r\n            onDoubleClick={(event) => this.onDoubleClick(event)}\r\n            onEditorBlur={this.props.onEditorBlur}\r\n            isRichText={false}\r\n            isMultiline={this.props.property!.multiline}\r\n            subscribeToFocusManager={(editor) =>\r\n              focusManager.activeEditor = editor\r\n            }\r\n          />\r\n        );\r\n      case \"Date\":\r\n        return (\r\n          <DateTimeEditor\r\n            value={this.props.getCellValue!()}\r\n            outputFormat={this.props.property!.formatterPattern}\r\n            outputFormatToShow={this.props.property!.modelFormatterPattern}\r\n            isReadOnly={readOnly}\r\n            backgroundColor={backgroundColor}\r\n            foregroundColor={foregroundColor}\r\n            onChange={this.props.onChange}\r\n            onClick={undefined}\r\n            onDoubleClick={(event) => this.onDoubleClick(event)}\r\n            onEditorBlur={this.props.onEditorBlur}\r\n            onKeyDown={this.props.onEditorKeyDown}\r\n            subscribeToFocusManager={(editor) =>\r\n              focusManager.activeEditor = editor\r\n            }\r\n          />\r\n        );\r\n      case \"CheckBox\":\r\n        return (\r\n          <BoolEditor\r\n            value={this.props.getCellValue!()}\r\n            isReadOnly={readOnly}\r\n            readOnlyNoGrey={true}\r\n            onChange={this.props.onChange}\r\n            onClick={undefined}\r\n            onKeyDown={this.props.onEditorKeyDown}\r\n            subscribeToFocusManager={(editor) =>\r\n              focusManager.activeEditor = editor\r\n            }\r\n          />\r\n        );\r\n      case \"ComboBox\":\r\n        return (\r\n          <XmlBuildDropdownEditor\r\n            key={this.props.property!.xmlNode.$iid}\r\n            xmlNode={this.props.property!.xmlNode}\r\n            onDoubleClick={(event) => this.onDoubleClick(event)}\r\n            isReadOnly={readOnly}\r\n            foregroundColor={foregroundColor}\r\n            backgroundColor={backgroundColor}\r\n            autoSort={this.props.property!.autoSort}\r\n            onKeyDown={this.props.onEditorKeyDown}\r\n            subscribeToFocusManager={(editor) =>\r\n              focusManager.activeEditor = editor\r\n            }\r\n          />\r\n        );\r\n      case \"Checklist\":\r\n        return \"\";\r\n      case \"Color\":\r\n        return (\r\n          <ColorEditor\r\n            value={flashColor2htmlColor(this.props.getCellValue!()) || null}\r\n            onChange={(value) => this.props.onChange?.(undefined, htmlColor2FlashColor(value))}\r\n            onBlur={() => this.props.onEditorBlur?.(undefined)}\r\n            onKeyDown={this.props.onEditorKeyDown}\r\n            isReadOnly={readOnly}\r\n            subscribeToFocusManager={(editor) =>\r\n              focusManager.activeEditor = editor\r\n            }\r\n          />\r\n        );\r\n      case \"TagInput\":\r\n        return (\r\n          <div style={{height: rowHeight * 5 + \"px\", backgroundColor: \"white\"}}>\r\n            <XmlBuildDropdownEditor\r\n              key={this.props.property!.xmlNode.$iid}\r\n              xmlNode={this.props.property!.xmlNode}\r\n              isReadOnly={readOnly}\r\n              autoSort={this.props.property!.autoSort}\r\n              subscribeToFocusManager={(editor) =>\r\n                focusManager.activeEditor = editor\r\n              }\r\n              tagEditor={\r\n                <TagInputEditor\r\n                  value={this.props.getCellValue!()}\r\n                  isReadOnly={readOnly}\r\n                  backgroundColor={backgroundColor}\r\n                  foregroundColor={foregroundColor}\r\n                  onChange={this.props.onChange}\r\n                  onKeyDown={this.props.onEditorKeyDown}\r\n                  onDoubleClick={(event) => this.onDoubleClick(event)}\r\n                  onEditorBlur={this.props.onEditorBlur}\r\n                />\r\n              }\r\n            />\r\n          </div>\r\n        );\r\n      case \"Blob\":\r\n        return (\r\n          <BlobEditor\r\n            isReadOnly={readOnly}\r\n            value={this.props.getCellValue!()}\r\n            canUpload={true}\r\n            onChange={this.props.onChange}\r\n            onEditorBlur={this.props.onEditorBlur}\r\n            subscribeToFocusManager={(editor) =>\r\n              focusManager.activeEditor = editor\r\n            }\r\n          />\r\n        );\r\n      case \"Polymorph\":\r\n        console.warn(`Type of polymorphic column was not determined, no editor was rendered`); // eslint-disable-line no-console\r\n        return \"\";\r\n      default:\r\n        console.warn(`Unknown column type \"${this.props.property!.column}\", no editor was rendered`) // eslint-disable-line no-console\r\n        return \"\";\r\n    }\r\n  }\r\n\r\n  onDoubleClick(event: any) {\r\n    getTablePanelView(this.props.property).setEditing(false);\r\n    const dataView = getDataView(this.props.property);\r\n    if (!dataView.firstEnabledDefaultAction) {\r\n      return;\r\n    }\r\n    uiActions.actions.onActionClick(dataView.firstEnabledDefaultAction)(\r\n      event,\r\n      dataView.firstEnabledDefaultAction\r\n    );\r\n  }\r\n\r\n  render() {\r\n    return <Provider property={this.props.property}>{this.getEditor()}</Provider>;\r\n  }\r\n}\r\n\r\n// Makes sure the editor alignment will be the same as the table cell alignment.\r\n// Needed on columns where the alignment can be set in the model.\r\nfunction resolveCellAlignment(customStyle: { [p: string]: string } | undefined, isFirsColumn: boolean, type: string){\r\n  let cellAlignment = new CellAlignment(isFirsColumn, type, customStyle);\r\n  const style = customStyle ?Object.assign({},customStyle) :{};\r\n  style[\"paddingRight\"] = cellAlignment.paddingRight - 1 + \"px\";\r\n  style[\"paddingLeft\"] = cellAlignment.paddingLeft + \"px\";\r\n  style[\"textAlign\"] = cellAlignment.alignment;\r\n  return style;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getTablePanelView } from \"./getTablePanelView\";\r\n\r\nexport function getSelectedProperty(ctx: any) {\r\n  return getTablePanelView(ctx).selectedProperty;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { selectNextColumn } from \"model/actions/DataView/TableView/selectNextColumn\";\r\nimport { selectPrevColumn } from \"model/actions/DataView/TableView/selectPrevColumn\";\r\nimport { selectPrevRow } from \"model/actions/DataView/selectPrevRow\";\r\nimport { selectNextRow } from \"model/actions/DataView/selectNextRow\";\r\nimport { flushCurrentRowData } from \"model/actions/DataView/TableView/flushCurrentRowData\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { shouldProceedToChangeRow } from \"model/actions-ui/DataView/TableView/shouldProceedToChangeRow\";\r\nimport { getGridFocusManager } from \"model/entities/GridFocusManager\";\r\n\r\nexport function onFieldKeyDown(ctx: any) {\r\n\r\n  function isGoingToChangeRow(tabEvent: any) {\r\n    return (getTablePanelView(ctx).isFirstColumnSelected() && tabEvent.shiftKey) ||\r\n      (getTablePanelView(ctx).isLastColumnSelected() && !tabEvent.shiftKey)\r\n  }\r\n\r\n  return flow(function*onFieldKeyDown(event: any) {\r\n    try {\r\n      const dataView = getDataView(ctx);\r\n      const tablePanelView = getTablePanelView(ctx);\r\n      switch (event.key) {\r\n        case \"Tab\": {\r\n          if (isGoingToChangeRow(event)) {\r\n            tablePanelView.setEditing(false);\r\n            yield*flushCurrentRowData(ctx)();\r\n\r\n            if (!(yield shouldProceedToChangeRow(dataView))) {\r\n              return;\r\n            }\r\n\r\n            yield dataView.lifecycle.runRecordChangedReaction(function*() {\r\n              if (event.shiftKey) {\r\n                yield selectPrevColumn(ctx)(true);\r\n              } else {\r\n                yield selectNextColumn(ctx)(true);\r\n              }\r\n            });\r\n            event.preventDefault();\r\n            tablePanelView.dontHandleNextScroll();\r\n            tablePanelView.scrollToCurrentCell();\r\n            tablePanelView.setEditing(true);\r\n            tablePanelView.triggerOnFocusTable();\r\n          } else {\r\n            if (event.shiftKey) {\r\n              selectPrevColumn(ctx)(true);\r\n            } else {\r\n              selectNextColumn(ctx)(true);\r\n            }\r\n            event.preventDefault();\r\n\r\n            tablePanelView.dontHandleNextScroll();\r\n            tablePanelView.scrollToCurrentCell();\r\n            yield*flushCurrentRowData(ctx)();\r\n            getGridFocusManager(ctx).focusEditor();\r\n          }\r\n          break;\r\n        }\r\n        case \"Enter\": {\r\n          tablePanelView.setEditing(false);\r\n          event.persist?.();\r\n          event.preventDefault();\r\n\r\n          yield*flushCurrentRowData(ctx)();\r\n\r\n          if (!(yield shouldProceedToChangeRow(dataView))) {\r\n            return;\r\n          }\r\n\r\n          yield dataView.lifecycle.runRecordChangedReaction(function*() {\r\n            if (event.shiftKey) {\r\n              yield*selectPrevRow(ctx)();\r\n            } else {\r\n              yield*selectNextRow(ctx)();\r\n            }\r\n          });\r\n\r\n          tablePanelView.setEditing(true);\r\n          tablePanelView.triggerOnFocusTable();\r\n          tablePanelView.scrollToCurrentCell();\r\n          break;\r\n        }\r\n        case \"F2\": {\r\n          tablePanelView.setEditing(false);\r\n          tablePanelView.triggerOnFocusTable();\r\n          break;\r\n        }\r\n        case \"Escape\": {\r\n          tablePanelView.setEditing(false);\r\n          tablePanelView.clearCurrentCellEditData();\r\n          tablePanelView.triggerOnFocusTable();\r\n          break;\r\n        }\r\n      }\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { handleError } from \"model/actions/handleError\";\r\n\r\nexport function onNoCellClick(ctx: any) {\r\n  return flow(function*onNoCellClick(event: any) {\r\n    try {\r\n      yield*getTablePanelView(ctx).onNoCellClick();\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { handleError } from \"model/actions/handleError\";\r\n\r\nexport function onOutsideTableClick(ctx: any) {\r\n  return flow(function*onOutsideTableClick(event: any) {\r\n    try {\r\n      yield*getTablePanelView(ctx).onOutsideTableClick();\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { getSelectionMember } from \"model/selectors/DataView/getSelectionMember\";\r\nimport { getDataSourceFieldByName } from \"model/selectors/DataSources/getDataSourceFieldByName\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { setSelectedStateRowId } from \"model/actions-tree/selectionCheckboxes\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getRowStates } from \"model/selectors/RowState/getRowStates\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\n\r\nexport function setAllSelectionStates(ctx: any, selectionState: boolean) {\r\n  flow(function*() {\r\n    try {\r\n      yield updateRowStates(ctx);\r\n      const dataTable = getDataTable(ctx);\r\n      const selectionMember = getSelectionMember(ctx);\r\n      if (!!selectionMember) {\r\n        for (let row of dataTable.rows) {\r\n          const dsField = getDataSourceFieldByName(ctx, selectionMember);\r\n          if (dsField) {\r\n            dataTable.setDirtyValue(row, selectionMember, selectionState);\r\n          }\r\n        }\r\n        yield*getFormScreenLifecycle(ctx).onFlushData();\r\n        for (let row of dataTable.rows) {\r\n          const dataSourceField = getDataSourceFieldByName(ctx, selectionMember)!;\r\n          const newSelectionState = dataTable.getCellValueByDataSourceField(row, dataSourceField);\r\n          const rowId = dataTable.getRowId(row);\r\n          yield*setSelectedStateRowId(ctx)(rowId, newSelectionState);\r\n        }\r\n      } else {\r\n        for (let row of dataTable.rows) {\r\n          const rowId = dataTable.getRowId(row);\r\n          yield*setSelectedStateRowId(ctx)(rowId, selectionState);\r\n        }\r\n      }\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  })();\r\n}\r\n\r\nasync function updateRowStates(ctx: any) {\r\n  const dataView = getDataView(ctx);\r\n  const rowIds = dataView.dataTable.rows.map(row => dataView.dataTable.getRowId(row));\r\n  await getRowStates(ctx).loadValues(rowIds);\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { setAllSelectionStates } from \"model/actions-tree/setAllSelectionStates\";\r\nimport S from \"./SelectionCheckboxHeader.module.scss\";\r\nimport { action } from \"mobx\";\r\n\r\n@observer\r\nexport class SelectionCheckBoxHeader extends React.Component<{\r\n  width: number;\r\n  dataView: any;\r\n}> {\r\n  @action.bound\r\n  onClick(event: any) {\r\n    this.props.dataView.selectAllCheckboxChecked = !this.props.dataView.selectAllCheckboxChecked;\r\n    setAllSelectionStates(this.props.dataView, this.props.dataView.selectAllCheckboxChecked);\r\n  }\r\n\r\n  render() {\r\n    const isChecked = this.props.dataView.selectAllCheckboxChecked;\r\n    return (\r\n      <div style={{minWidth: this.props.width + \"px\"}} className={S.root} onClick={this.onClick}>\r\n        {isChecked ? <i className=\"far fa-check-square\"/> : <i className=\"far fa-square\"/>}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport bind from \"bind-decorator\";\r\nimport { action, computed, observable } from \"mobx\";\r\nimport { inject, observer, Provider } from \"mobx-react\";\r\nimport { onTableKeyDown } from \"model/actions-ui/DataView/TableView/onTableKeyDown\";\r\nimport React, { useContext } from \"react\";\r\nimport { onColumnHeaderClick } from \"model/actions-ui/DataView/TableView/onColumnHeaderClick\";\r\nimport { ITablePanelView } from \"model/entities/TablePanelView/types/ITablePanelView\";\r\nimport { IDataView } from \"model/entities/types/IDataView\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { getColumnHeaders } from \"model/selectors/TablePanelView/getColumnHeaders\";\r\nimport { getSelectedColumnIndex } from \"model/selectors/TablePanelView/getSelectedColumnIndex\";\r\nimport { getTableViewProperties } from \"model/selectors/TablePanelView/getTableViewProperties\";\r\nimport { IColumnHeader } from \"model/selectors/TablePanelView/types\";\r\nimport { FilterSettings } from \"gui/Components/ScreenElements/Table/FilterSettings/FilterSettings\";\r\nimport { Header } from \"gui/Components/ScreenElements/Table/Header\";\r\nimport { RawTable, Table } from \"gui/Components/ScreenElements/Table/Table\";\r\nimport { IGridDimensions } from \"gui/Components/ScreenElements/Table/types\";\r\nimport { TableViewEditor } from \"./TableViewEditor\";\r\nimport { getSelectedRowIndex } from \"model/selectors/DataView/getSelectedRowIndex\";\r\nimport { onNoCellClick } from \"model/actions-ui/DataView/TableView/onNoCellClick\";\r\nimport { onOutsideTableClick } from \"model/actions-ui/DataView/TableView/onOutsideTableClick\";\r\nimport { getFixedColumnsCount } from \"model/selectors/TablePanelView/getFixedColumnsCount\";\r\nimport { getIsSelectionCheckboxesShown } from \"model/selectors/DataView/getIsSelectionCheckboxesShown\";\r\nimport { onColumnWidthChanged } from \"model/actions-ui/DataView/TableView/onColumnWidthChanged\";\r\nimport { onColumnWidthChangeFinished } from \"model/actions-ui/DataView/TableView/onColumnWidthChangeFinished\";\r\nimport { onColumnOrderChangeFinished } from \"model/actions-ui/DataView/TableView/onColumnOrderChangeFinished\";\r\nimport { getGroupingConfiguration } from \"model/selectors/TablePanelView/getGroupingConfiguration\";\r\nimport { getLeadingColumnCount } from \"model/selectors/TablePanelView/getLeadingColumnCount\";\r\nimport { getDataTable } from \"model/selectors/DataView/getDataTable\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { SelectionCheckBoxHeader } from \"gui/Components/ScreenElements/Table/SelectionCheckBoxHeader\";\r\nimport { aggregationToString } from \"model/entities/Aggregatioins\";\r\nimport { getOpenedScreen } from \"model/selectors/getOpenedScreen\";\r\nimport { getIsEditing } from \"model/selectors/TablePanelView/getIsEditing\";\r\nimport { ITableConfiguration } from \"model/entities/TablePanelView/types/IConfigurationManager\";\r\nimport { CtxDataView, DataViewContext } from \"gui/Components/ScreenElements/DataView\";\r\nimport S from \"./TableView.module.scss\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\n\r\ninterface ITableViewProps {\r\n  dataView?: IDataView;\r\n  tablePanelView?: ITablePanelView;\r\n  onColumnDialogCancel?: (event: any) => void;\r\n  onColumnDialogOk?: (event: any, configuration: ITableConfiguration) => void;\r\n  onTableKeyDown?: (event: any) => void;\r\n}\r\n\r\n@inject(({dataView}) => {\r\n  return {\r\n    dataView,\r\n    tablePanelView: dataView.tablePanelView,\r\n    onColumnDialogCancel: dataView.tablePanelView.onColumnConfCancel,\r\n    onColumnDialogOk: dataView.tablePanelView.onColumnConfSubmit,\r\n\r\n    onTableKeyDown: onTableKeyDown(dataView),\r\n  };\r\n})\r\n@observer\r\nexport class TableViewInner extends React.Component<ITableViewProps & { dataViewContext?: DataViewContext }> {\r\n  constructor(props: any) {\r\n    super(props);\r\n\r\n    this.props.dataView?.initializeNewScrollLoader();\r\n    getGroupingConfiguration(this.props.dataView).registerGroupingOnOffHandler(() => {\r\n      this.props.dataView?.initializeNewScrollLoader();\r\n    });\r\n  }\r\n\r\n  componentDidMount() {\r\n    const openScreen = getOpenedScreen(this.props.dataView);\r\n    const dataViews = openScreen.content.formScreen?.dataViews;\r\n    const isMainDataView =\r\n      (dataViews && dataViews.length > 0 && this.props.dataView?.isBindingRoot) ||\r\n      dataViews?.length === 1;\r\n\r\n    if (openScreen.isActive && isMainDataView) {\r\n      if (!this.props.dataView?.isFormViewActive()) {\r\n        const tablePanelView = getTablePanelView(this.props.dataView);\r\n        tablePanelView.triggerOnFocusTable();\r\n      }\r\n    }\r\n  }\r\n\r\n  refTableDisposer: any;\r\n  refTable = (elmTable: RawTable | null) => {\r\n    this.elmTable = elmTable;\r\n    if (elmTable) {\r\n      const d1 = this.props.tablePanelView!.subOnFocusTable(elmTable.focusTable);\r\n      const d2 = this.props.tablePanelView!.subOnScrollToCellShortest(\r\n        elmTable.scrollToCellShortest\r\n      );\r\n      this.refTableDisposer = () => {\r\n        d1();\r\n        d2();\r\n      };\r\n    } else {\r\n      this.refTableDisposer && this.refTableDisposer();\r\n    }\r\n  };\r\n\r\n  elmTable: RawTable | null = null;\r\n\r\n  headerRenderer = new HeaderRenderer({\r\n    gridDimensions: this.props.dataView!.gridDimensions,\r\n    tablePanelView: this.props.tablePanelView!,\r\n    getFixedColumnCount: () => getFixedColumnsCount(this.props.tablePanelView),\r\n    getIsSelectionCheckboxes: () => getIsSelectionCheckboxesShown(this.props.tablePanelView),\r\n    dataView: this.props.dataView!,\r\n    getColumnHeaders: () => getColumnHeaders(this.props.dataView),\r\n    getTableViewProperties: () => getTableViewProperties(this.props.dataView),\r\n    onColumnWidthChange: (propertyId, width) =>\r\n      onColumnWidthChanged(this.props.tablePanelView, propertyId, width),\r\n    onColumnOrderChange: (id1, id2) =>\r\n      onColumnOrderChangeFinished(this.props.tablePanelView, id1, id2),\r\n    onColumnOrderAttendantsChange: (idSource, idTarget) =>\r\n      this.onColumnOrderAttendantsChange(idSource, idTarget),\r\n  });\r\n\r\n  onColumnOrderAttendantsChange(idSource: string | undefined, idTarget: string | undefined) {\r\n    this.props.tablePanelView!.setColumnOrderChangeAttendants(idSource, idTarget);\r\n    getDataTable(this.props.dataView).unlockAddedRowPosition();\r\n  }\r\n\r\n  @action.bound\r\n  handleTableKeyDown(event: any) {\r\n    this.props.onTableKeyDown?.(event);\r\n    this.props.dataViewContext?.handleTableKeyDown(event);\r\n  }\r\n\r\n  render() {\r\n    const self = this;\r\n    const isSelectionCheckboxes = getIsSelectionCheckboxesShown(this.props.tablePanelView);\r\n    const editingRowIndex = getSelectedRowIndex(this.props.tablePanelView);\r\n    let editingColumnIndex = getSelectedColumnIndex(this.props.tablePanelView);\r\n    if (editingColumnIndex !== undefined && isSelectionCheckboxes) {\r\n      editingColumnIndex++;\r\n    }\r\n    const fixedColumnCount = this.props.tablePanelView\r\n      ? this.props.tablePanelView.fixedColumnCount || 0\r\n      : 0;\r\n\r\n    return (\r\n      <Provider tablePanelView={this.props.tablePanelView}>\r\n        <>\r\n          <Table\r\n            tableRows={this.props.dataView!.tableRows}\r\n            gridDimensions={self.props.dataView!.gridDimensions}\r\n            scrollState={self.props.dataView!.scrollState}\r\n            editingRowIndex={editingRowIndex}\r\n            editingColumnIndex={editingColumnIndex}\r\n            isEditorMounted={getIsEditing(this.props.tablePanelView)}\r\n            isLoading={false}\r\n            fixedColumnCount={fixedColumnCount}\r\n            headerContainers={self.headerRenderer.headerContainers}\r\n            renderEditor={() => (\r\n              <TableViewEditor key={`${editingRowIndex}@${editingColumnIndex}`}/>\r\n            )}\r\n            onNoCellClick={onNoCellClick(this.props.tablePanelView)}\r\n            onOutsideTableClick={onOutsideTableClick(this.props.tablePanelView)}\r\n            onContentBoundsChanged={(bounds) => (this.props.dataView!.contentBounds = bounds)}\r\n            refCanvasMovingComponent={this.props.tablePanelView!.setTableCanvas}\r\n            onKeyDown={this.handleTableKeyDown}\r\n            refTable={this.refTable}\r\n            onFocus={() =>\r\n              (getFormScreenLifecycle(\r\n                this.props.dataView\r\n              ).focusedDataViewId = this.props.dataView?.id)\r\n            }\r\n          />\r\n        </>\r\n      </Provider>\r\n    );\r\n  }\r\n}\r\n\r\nexport function TableView(props: ITableViewProps) {\r\n  const dataViewContext = useContext(CtxDataView);\r\n  return <TableViewInner {...props} dataViewContext={dataViewContext}/>;\r\n}\r\n\r\ninterface IHeaderRendererData {\r\n  getTableViewProperties: () => IProperty[];\r\n\r\n  tablePanelView: ITablePanelView;\r\n  getColumnHeaders: () => IColumnHeader[];\r\n  getIsSelectionCheckboxes: () => boolean;\r\n  onColumnWidthChange: (id: string, newWidth: number) => void;\r\n  onColumnOrderChange: (id: string, targetId: string) => void;\r\n  onColumnOrderAttendantsChange: (\r\n    idSource: string | undefined,\r\n    idTarget: string | undefined\r\n  ) => void;\r\n  dataView: IDataView;\r\n  gridDimensions: IGridDimensions;\r\n  getFixedColumnCount: () => number;\r\n}\r\n\r\nclass HeaderRenderer implements IHeaderRendererData {\r\n  constructor(data: IHeaderRendererData) {\r\n    Object.assign(this, data);\r\n  }\r\n\r\n  gridDimensions: IGridDimensions = null as any;\r\n  getTableViewProperties: () => IProperty[] = null as any;\r\n  getIsSelectionCheckboxes: () => boolean = null as any;\r\n  dataView: IDataView = null as any;\r\n  getFixedColumnCount = null as any;\r\n\r\n  @computed get tableViewPropertiesOriginal() {\r\n    return this.getTableViewProperties();\r\n  }\r\n\r\n  @computed get tableViewProperties() {\r\n    return this.tableViewPropertiesOriginal;\r\n  }\r\n\r\n  getColumnHeaders: () => IColumnHeader[] = null as any;\r\n  onColumnWidthChange: (id: string, newWidth: number) => void = null as any;\r\n  onColumnOrderChange: (id: string, targetId: string) => void = null as any;\r\n  onColumnOrderAttendantsChange: (\r\n    idSource: string | undefined,\r\n    idTarget: string | undefined\r\n  ) => void = null as any;\r\n  tablePanelView: ITablePanelView = null as any;\r\n\r\n  columnOrderChangeSourceId: string | undefined;\r\n  columnOrderChangeTargetId: string | undefined;\r\n\r\n  @computed get columnHeaders() {\r\n    return this.getColumnHeaders();\r\n  }\r\n\r\n  @computed get isSelectionCheckboxes() {\r\n    return this.getIsSelectionCheckboxes();\r\n  }\r\n\r\n  @observable isColumnOrderChanging = false;\r\n\r\n  @action.bound handleStartColumnOrderChanging(id: string) {\r\n    this.isColumnOrderChanging = true;\r\n    this.columnOrderChangeSourceId = id;\r\n    this.onColumnOrderAttendantsChange(\r\n      this.columnOrderChangeSourceId,\r\n      this.columnOrderChangeTargetId\r\n    );\r\n  }\r\n\r\n  @action.bound handleStopColumnOrderChanging(id: string) {\r\n    this.isColumnOrderChanging = false;\r\n    this.columnOrderChangeSourceId = undefined;\r\n    this.columnOrderChangeTargetId = undefined;\r\n    this.onColumnOrderAttendantsChange(\r\n      this.columnOrderChangeSourceId,\r\n      this.columnOrderChangeTargetId\r\n    );\r\n  }\r\n\r\n  @action.bound handlePossibleColumnOrderChange(targetId: string | undefined) {\r\n    this.columnOrderChangeTargetId = targetId;\r\n    this.onColumnOrderAttendantsChange(\r\n      this.columnOrderChangeSourceId,\r\n      this.columnOrderChangeTargetId\r\n    );\r\n  }\r\n\r\n  @action.bound handleColumnOrderDrop(targetId: string) {\r\n    this.onColumnOrderChange(this.columnOrderChangeSourceId!, targetId);\r\n    this.onColumnOrderAttendantsChange(\r\n      this.columnOrderChangeSourceId,\r\n      this.columnOrderChangeTargetId\r\n    );\r\n  }\r\n\r\n  @computed get headerContainers() {\r\n    const columnDimensions = this.gridDimensions.displayedColumnDimensionsCom;\r\n    const leadingColumnCount = getLeadingColumnCount(this.dataView);\r\n    const selectionCheckBoxesShown = getIsSelectionCheckboxesShown(this.dataView);\r\n    const groupingColumnCount = leadingColumnCount - (selectionCheckBoxesShown ? 1 : 0);\r\n    const dataColumnCount = columnDimensions.length - leadingColumnCount;\r\n    const headerContainers = [];\r\n\r\n    if (selectionCheckBoxesShown) {\r\n      headerContainers.push(\r\n        new HeaderContainer({\r\n          header: this.renderSelectionCheckBoxHeader(columnDimensions[0].width),\r\n          isFixed: true,\r\n          width: columnDimensions[0].width,\r\n        })\r\n      );\r\n    }\r\n\r\n    let columnsToFix = this.getFixedColumnCount();\r\n    for (let i = 0; i < groupingColumnCount; i++) {\r\n      headerContainers.push(\r\n        new HeaderContainer({\r\n          header: this.renderDummyHeader(columnDimensions[i].width, i),\r\n          isFixed: columnsToFix > i,\r\n          width: columnDimensions[i].width,\r\n        })\r\n      );\r\n    }\r\n\r\n    columnsToFix -= groupingColumnCount;\r\n    for (let i = 0; i < dataColumnCount; i++) {\r\n      const columnWidth = columnDimensions[i + leadingColumnCount].width;\r\n      headerContainers.push(\r\n        new HeaderContainer({\r\n          header: this.renderDataHeader({\r\n            columnIndex: i,\r\n            columnWidth: columnWidth,\r\n            isFirst: headerContainers.length === 0,\r\n            isLast: i === dataColumnCount - 1,\r\n            isFixed: columnsToFix > i,\r\n          }),\r\n          isFixed: columnsToFix > i,\r\n          width: columnWidth,\r\n        })\r\n      );\r\n    }\r\n\r\n    return headerContainers;\r\n  }\r\n\r\n  renderDummyHeader(columnWidth: number, columnIndex: number) {\r\n    return (\r\n      <div key={`dummy-header-key-${columnIndex}`} style={{minWidth: columnWidth + \"px\"}}></div>\r\n    );\r\n  }\r\n\r\n  renderSelectionCheckBoxHeader(columnWidth: number) {\r\n    return (\r\n      <SelectionCheckBoxHeader key=\"checkboxHeader\" width={columnWidth} dataView={this.dataView}/>\r\n    );\r\n  }\r\n\r\n  @bind\r\n  renderDataHeader(args: { columnIndex: number; columnWidth: number, isFirst: boolean, isLast: boolean, isFixed: boolean }) {\r\n    const property = this.tableViewProperties[args.columnIndex];\r\n    const header = this.columnHeaders[args.columnIndex];\r\n    return (\r\n      <Provider key={property.id} property={property}>\r\n        <Header\r\n          key={header.id}\r\n          id={header.id}\r\n          isFixed={args.isFixed}\r\n          columnIndex={args.columnIndex}\r\n          isLast={args.isLast}\r\n          isFirst={args.isFirst}\r\n          width={args.columnWidth}\r\n          label={header.label}\r\n          orderingDirection={header.ordering}\r\n          orderingOrder={header.order + 1}\r\n          onColumnWidthChange={this.onColumnWidthChange}\r\n          onColumnWidthChangeFinished={onColumnWidthChangeFinished(this.tablePanelView)}\r\n          onClick={onColumnHeaderClick(this.tablePanelView)}\r\n          isDragDisabled={isMobileLayoutActive(this.tablePanelView)}\r\n          additionalHeaderContent={this.makeAdditionalHeaderContent(header.id, property, args.columnIndex === 0)}\r\n        />\r\n      </Provider>\r\n    );\r\n  }\r\n\r\n  makeAdditionalHeaderContent(columnId: string, property: IProperty, autoFocus: boolean) {\r\n    const filterControlsDisplayed = this.tablePanelView.filterConfiguration\r\n      .isFilterControlsDisplayed;\r\n    if (!filterControlsDisplayed && this.dataView.aggregationData.length === 0) {\r\n      return undefined;\r\n    }\r\n    const headerContent: JSX.Element[] = [];\r\n    if (filterControlsDisplayed) {\r\n      headerContent.push(<div className={\"filterRow\"}><FilterSettings key={`filter-settings-${columnId}`}\r\n                                                                      autoFocus={autoFocus} ctx={this.dataView}/>\r\n      </div>);\r\n    }\r\n    if (this.dataView.aggregationData.length !== 0) {\r\n      const aggregation = this.dataView.aggregationData.find((agg) => agg.columnId === columnId);\r\n      if (aggregation) {\r\n        headerContent.push(\r\n          <div className={S.aggregationRow} key={`aggregation-field-${columnId}`}>\r\n            {aggregationToString(aggregation, property)}\r\n          </div>\r\n        );\r\n      }\r\n    }\r\n    return () => <>{headerContent}</>;\r\n  }\r\n}\r\n\r\nexport interface IHeaderContainer {\r\n  header: JSX.Element;\r\n  isFixed: boolean;\r\n  width: number;\r\n}\r\n\r\nclass HeaderContainer implements IHeaderContainer {\r\n  constructor(data: IHeaderContainer) {\r\n    Object.assign(this, data);\r\n  }\r\n\r\n  header: JSX.Element = null as any;\r\n  isFixed: boolean = null as any;\r\n  width: number = null as any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { selectPrevRow } from \"model/actions/DataView/selectPrevRow\";\r\nimport { selectNextRow } from \"model/actions/DataView/selectNextRow\";\r\nimport { selectPrevColumn } from \"model/actions/DataView/TableView/selectPrevColumn\";\r\nimport { selectNextColumn } from \"model/actions/DataView/TableView/selectNextColumn\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { shouldProceedToChangeRow } from \"./shouldProceedToChangeRow\";\r\nimport uiActions from \"../../../actions-ui-tree\";\r\n\r\nexport function onTableKeyDown(ctx: any) {\r\n  return flow(function*onTableKeyDown(event: any) {\r\n    try {\r\n      const dataView = getDataView(ctx);\r\n      switch (event.key) {\r\n        case \"ArrowUp\":\r\n          event.preventDefault();\r\n          if (!(yield shouldProceedToChangeRow(dataView))) {\r\n            break;\r\n          }\r\n          yield*selectPrevRow(ctx)();\r\n          getTablePanelView(ctx).scrollToCurrentCell();\r\n          break;\r\n        case \"ArrowDown\":\r\n          event.preventDefault();\r\n          if (!(yield shouldProceedToChangeRow(dataView))) {\r\n            break;\r\n          }\r\n          yield*selectNextRow(ctx)();\r\n          getTablePanelView(ctx).scrollToCurrentCell();\r\n          break;\r\n        case \"ArrowLeft\":\r\n          selectPrevColumn(ctx)();\r\n          event.preventDefault();\r\n          getTablePanelView(ctx).scrollToCurrentCell();\r\n          break;\r\n        case \"ArrowRight\":\r\n          selectNextColumn(ctx)();\r\n          event.preventDefault();\r\n          getTablePanelView(ctx).scrollToCurrentCell();\r\n          break;\r\n        case \"F2\":\r\n          getTablePanelView(ctx).setEditing(true);\r\n          event.preventDefault();\r\n          getTablePanelView(ctx).scrollToCurrentCell();\r\n          break;\r\n        case \"Tab\":\r\n          if (event.shiftKey) {\r\n            selectPrevColumn(ctx)(true);\r\n          } else {\r\n            selectNextColumn(ctx)(true);\r\n          }\r\n          event.preventDefault();\r\n          getTablePanelView(ctx).scrollToCurrentCell();\r\n          break;\r\n        case \"Enter\":\r\n          if (dataView.firstEnabledDefaultAction) {\r\n            uiActions.actions.onActionClick(dataView.firstEnabledDefaultAction)(\r\n              event,\r\n              dataView.firstEnabledDefaultAction\r\n            );\r\n          }\r\n          break;\r\n        case \"Escape\": {\r\n          getTablePanelView(ctx).setEditing(false);\r\n          getTablePanelView(ctx).clearCurrentCellEditData();\r\n          getTablePanelView(ctx).triggerOnFocusTable();\r\n          break;\r\n        }\r\n      }\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getTablePanelView } from \"./getTablePanelView\";\r\n\r\nexport function getFixedColumnsCount(ctx: any) {\r\n  return getTablePanelView(ctx).fixedColumnCount;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getTableViewProperties } from \"./getTableViewProperties\";\r\nimport { IColumnHeader } from './types';\r\nimport { getPropertyOrdering } from \"../DataView/getPropertyOrdering\";\r\n\r\n\r\nexport function getColumnHeaders(ctx: any): IColumnHeader[] {\r\n  const tableViewProperties = getTableViewProperties(ctx);\r\n  return tableViewProperties.map(prop => {\r\n    const ordering = getPropertyOrdering(ctx, prop.id);\r\n    return {\r\n      label: prop.name,\r\n      id: prop.id,\r\n      ordering: ordering.ordering,\r\n      order: ordering.order\r\n    }\r\n  })\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataViewPropertyById } from \"model/selectors/DataView/getDataViewPropertyById\";\r\nimport { runGeneratorInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\n\r\nexport function onColumnWidthChanged(ctx: any, id: string, width: number) {\r\n  runGeneratorInFlowWithHandler({\r\n    ctx: ctx,\r\n    generator: function*() {\r\n      const prop = getDataViewPropertyById(ctx, id);\r\n      if (prop) {\r\n        prop.setColumnWidth(width);\r\n      }\r\n    }()\r\n  })\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getTablePanelView } from './getTablePanelView';\r\n\r\nexport function getIsEditing(ctx: any) {\r\n  return getTablePanelView(ctx).isEditing;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataViewPropertyById } from \"model/selectors/DataView/getDataViewPropertyById\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { runGeneratorInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\n\r\nexport function onColumnWidthChangeFinished(ctx: any) {\r\n  return async function onColumnWidthChangeFinished(id: string, width: number) {\r\n    await runGeneratorInFlowWithHandler({\r\n      ctx: ctx,\r\n      generator: function*(){\r\n        const prop = getDataViewPropertyById(ctx, id);\r\n        if (prop) {\r\n          yield*getTablePanelView(ctx).configurationManager.onColumnWidthChanged(id, width);\r\n        }\r\n      }()\r\n    });\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { action, flow } from \"mobx\";\r\nimport { IDataViewBodyUI, IDataViewToolbarUI } from \"modules/DataView/DataViewUI\";\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { SectionViewSwitchers } from \"modules/DataView/DataViewTypes\";\r\nimport { getIdent, IIId } from \"utils/common\";\r\nimport { DataViewHeaderAction } from \"gui/Components/DataViewHeader/DataViewHeaderAction\";\r\nimport { Icon } from \"@origam/components\";\r\nimport { Observer } from \"mobx-react\";\r\nimport { ITablePerspective } from \"./TablePerspective\";\r\nimport { IPerspective } from \"../Perspective\";\r\nimport { TableView } from \"gui/Workbench/ScreenArea/TableView/TableView\";\r\nimport { T } from \"../../../../utils/translation\";\r\nimport S from \"./TablePerspectiveDirector.module.scss\";\r\nimport cx from \"classnames\";\r\n\r\nexport class TablePerspectiveDirector implements IIId {\r\n  $iid = getIdent();\r\n\r\n  constructor(\r\n    public dataViewToolbarUI = IDataViewToolbarUI(),\r\n    public dataViewBodyUI = IDataViewBodyUI(),\r\n    public tablePerspective = ITablePerspective(),\r\n    public perspective = IPerspective()\r\n  ) {\r\n  }\r\n\r\n  @action.bound\r\n  setup() {\r\n    this.dataViewBodyUI.contrib.put({\r\n      $iid: this.$iid,\r\n      render: () => (\r\n        <Observer key={this.$iid}>\r\n          {() => (\r\n            <div className={cx(S.root, \"tablePerspectiveDirector\", {isActive: this.tablePerspective.isActive})}>\r\n              <TableView/>\r\n            </div>\r\n          )}\r\n        </Observer>\r\n      ),\r\n    });\r\n\r\n    this.dataViewToolbarUI.contrib.put({\r\n      $iid: this.$iid,\r\n      section: SectionViewSwitchers,\r\n      render: () => (\r\n        <Observer key={this.$iid}>\r\n          {() => (\r\n            <DataViewHeaderAction\r\n              className={\"tablePerspectiveButton\"}\r\n              onMouseDown={flow(this.tablePerspective.handleToolbarBtnClick)}\r\n              isActive={this.tablePerspective.isActive}\r\n            >\r\n              <Icon src=\"./icons/table-view.svg\" tooltip={T(\"Grid\", \"grid_tool_tip\")}/>\r\n            </DataViewHeaderAction>\r\n          )}\r\n        </Observer>\r\n      ),\r\n    });\r\n\r\n    this.perspective.contrib.put(this.tablePerspective);\r\n  }\r\n\r\n  @action.bound\r\n  teardown() {\r\n    this.dataViewBodyUI.contrib.del(this);\r\n    this.dataViewToolbarUI.contrib.del(this);\r\n    this.perspective.contrib.del(this.tablePerspective);\r\n  }\r\n\r\n  dispose() {\r\n    this.teardown();\r\n  }\r\n}\r\n\r\nexport const ITablePerspectiveDirector = TypeSymbol<TablePerspectiveDirector>(\r\n  \"ITablePerspectiveDirector\"\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Container } from \"dic/Container\";\r\nimport { ITablePerspectiveDirector, TablePerspectiveDirector } from \"./TablePerspectiveDirector\";\r\nimport { ITablePerspective, TablePerspective } from \"./TablePerspective\";\r\n\r\nexport const SCOPE_TablePerspective = \"TablePerspective\";\r\n\r\nexport function register($cont: Container) {\r\n  $cont\r\n    .registerClass(ITablePerspectiveDirector, TablePerspectiveDirector)\r\n    .scopedInstance(SCOPE_TablePerspective);\r\n\r\n  $cont.registerClass(ITablePerspective, TablePerspective).scopedInstance(SCOPE_TablePerspective);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Container } from \"dic/Container\";\r\nimport { DataViewBodyUI, DataViewToolbarUI, IDataViewBodyUI, IDataViewToolbarUI, } from \"./DataViewUI\";\r\nimport * as PerspectiveModule from \"./Perspective/PerspectiveModule\";\r\n\r\nexport const SCOPE_DataView = \"DataView\";\r\n\r\nexport function register($cont: Container) {\r\n  $cont.registerClass(IDataViewBodyUI, DataViewBodyUI).scopedInstance(SCOPE_DataView);\r\n  $cont.registerClass(IDataViewToolbarUI, DataViewToolbarUI).scopedInstance(SCOPE_DataView);\r\n  // $cont.registerClass(IViewConfiguration, ViewConfiguration);\r\n  PerspectiveModule.register($cont);\r\n}\r\n\r\nexport function beginScope($cont: Container) {\r\n  return $cont.beginLifetimeScope(SCOPE_DataView);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Container } from \"dic/Container\";\r\n\r\nimport * as MapPerspectiveModule from './MapPerspective/MapPerspectiveModule';\r\nimport * as FormPerspectiveModule from './FormPerspective/FormPerspectiveModule';\r\nimport * as TablePerspectiveModule from './TablePerspective/TablePerspectiveModule';\r\nimport { IPerspective, Perspective } from \"./Perspective\";\r\nimport { SCOPE_DataView } from \"../DataViewModule\";\r\n\r\nexport function register($cont: Container) {\r\n  $cont.registerClass(IPerspective, Perspective).scopedInstance(SCOPE_DataView);\r\n\r\n  FormPerspectiveModule.register($cont);\r\n  MapPerspectiveModule.register($cont);\r\n  TablePerspectiveModule.register($cont);\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport _ from \"lodash\";\r\nimport { TypeSymbol } from \"dic/Container\";\r\n\r\nexport class Clock {\r\n  debounce(fn: () => void, ms: number) {\r\n    return _.debounce(fn, ms);\r\n  }\r\n\r\n  getTimeMs() {\r\n    return new Date().getTime();\r\n  }\r\n\r\n  setInterval(fn: () => void, ms: number) {\r\n    const handle = setInterval(fn, ms);\r\n    return () => clearInterval(handle);\r\n  }\r\n}\r\n\r\nexport const IClock = TypeSymbol<Clock>(\"IClock\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { IApi } from \"model/entities/types/IApi\";\r\n\r\nexport class LookupApi {\r\n  constructor(private api: () => IApi) {\r\n  }\r\n\r\n  async getLookupLabels(request: Map<string, Map<any, any>>) {\r\n    const requestRaw: any[] = [];\r\n    for (let [lookupId, v1] of request) {\r\n      requestRaw.push({\r\n        LookupId: lookupId,\r\n        MenuId: undefined,\r\n        LabelIds: Array.from(v1.keys()),\r\n      });\r\n    }\r\n\r\n    const resultRaw: { [k: string]: any } = await this.api().getLookupLabelsEx(requestRaw);\r\n    const result = new Map<string, Map<any, any>>();\r\n    for (let [lookupId, lookupResolved] of Object.entries(resultRaw)) {\r\n      if (!result.has(lookupId)) {\r\n        result.set(lookupId, new Map());\r\n      }\r\n      const lookupMap = result.get(lookupId)!;\r\n      for (let [labelId, labelValue] of Object.entries(lookupResolved)) {\r\n        lookupMap.set(labelId, labelValue);\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n}\r\n\r\nexport const ILookupApi = TypeSymbol<LookupApi>(\"ILookupApi\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action } from \"mobx\";\r\n\r\nexport class LookupCacheDependencies {\r\n  // Mapping semantics: {LookupCacheKey: [LookupId]}\r\n  items = new Map<string, Set<string>>();\r\n\r\n  heldLookupIds = new Set<string>();\r\n\r\n  @action.bound putValues(values: { [key: string]: string[] }) {\r\n    for (let [lookupId, newDeps] of Object.entries(values)) {\r\n      for (let newDep of newDeps) {\r\n        if (!this.items.has(newDep)) {\r\n          this.items.set(newDep, new Set());\r\n        }\r\n        const lookupRecord = this.items.get(newDep)!;\r\n        lookupRecord.add(lookupId);\r\n      }\r\n      this.heldLookupIds.add(lookupId);\r\n    }\r\n  }\r\n\r\n  getUnhandledLookupIds(inputLookupIds: Set<string>) {\r\n    return new Set(Array.from(inputLookupIds).filter((id) => !this.heldLookupIds.has(id)));\r\n  }\r\n\r\n  getDependencyLookupIdsByCacheKeys(cacheKeys: string[]) {\r\n    const collectedIds = new Set<string>();\r\n    for (let key of cacheKeys) {\r\n      const ids = this.items.get(key) || [];\r\n      for (let id of ids) collectedIds.add(id);\r\n    }\r\n    return collectedIds;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action } from \"mobx\";\r\nimport { LookupCacheMulti } from \"./LookupCacheMulti\";\r\nimport { TypeSymbol } from \"dic/Container\";\r\n\r\nexport class LookupCacheIndividual {\r\n  constructor(private lookupId: string, private cache: LookupCacheMulti) {\r\n  }\r\n\r\n  getLookupLabels() {\r\n    return this.cache.getLookupLabels(this.lookupId) || new Map();\r\n  }\r\n\r\n  addLookupLabels(labels: Map<any, any>) {\r\n    this.cache.addLookupLabels(this.lookupId, labels);\r\n  }\r\n\r\n  @action.bound\r\n  clean() {\r\n    this.cache.clean(this.lookupId);\r\n  }\r\n}\r\n\r\nexport const ILookupCacheIndividual = TypeSymbol<LookupCacheIndividual>(\"ILookupCacheIndividual\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action } from \"mobx\";\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { Clock } from \"./Clock\";\r\nimport { LookupLabelsCleanerReloader, } from \"./LookupCleanerLoader\";\r\n\r\nexport class LookupCacheMulti {\r\n  constructor(\r\n    private clock: Clock,\r\n    private cleanerReloader: (lookupId: string) => LookupLabelsCleanerReloader\r\n  ) {\r\n  }\r\n\r\n  labels = new Map<string, Map<any, any>>();\r\n  recordBirthdate = new Map<string, number>();\r\n\r\n  disposers: any[] = [];\r\n\r\n  startup() {\r\n    this.disposers.push(this.clock.setInterval(this.handleOutdatingTimerTick, 60 * 1000));\r\n  }\r\n\r\n  teardown() {\r\n    for (let d of this.disposers) d();\r\n  }\r\n\r\n  @action.bound\r\n  handleOutdatingTimerTick() {\r\n    const now = this.clock.getTimeMs();\r\n    const idsToClean: string[] = [];\r\n    for (let lookupId of this.labels.keys()) {\r\n      if (now - this.recordBirthdate.get(lookupId)! >= 10 * 60 * 1000) {\r\n        idsToClean.push(lookupId);\r\n      }\r\n    }\r\n    for (let id of idsToClean) {\r\n      this.cleanerReloader(id).reloadLookupLabels();\r\n    }\r\n  }\r\n\r\n  getLookupLabels(lookupId: string) {\r\n    return this.labels.get(lookupId);\r\n  }\r\n\r\n  addLookupLabels(lookupId: string, labels: Map<any, any>) {\r\n    if (!this.labels.has(lookupId)) {\r\n      this.labels.set(lookupId, new Map());\r\n      this.recordBirthdate.set(lookupId, this.clock.getTimeMs());\r\n    }\r\n    const indivLabels = this.labels.get(lookupId)!;\r\n    for (let [k, v] of labels.entries()) {\r\n      indivLabels.set(k, v);\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  clean(lookupId: string) {\r\n    this.labels.delete(lookupId);\r\n    this.recordBirthdate.delete(lookupId);\r\n  }\r\n}\r\n\r\nexport const ILookupCacheMulti = TypeSymbol<LookupCacheMulti>(\"ILookupCacheMulti\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { LookupCacheIndividual } from \"./LookupCacheIndividual\";\r\nimport { LookupResolver } from \"./LookupResolver\";\r\nimport { TypeSymbol } from \"dic/Container\";\r\n\r\nexport class LookupLabelsCleanerReloader {\r\n  constructor(private cache: LookupCacheIndividual, private resolver: LookupResolver) {\r\n  }\r\n\r\n  reloadLookupLabels() {\r\n    this.cache.clean();\r\n    this.resolver.cleanAndReload();\r\n  }\r\n}\r\n\r\nexport const ILookupLabelsCleanerReloader = TypeSymbol<LookupLabelsCleanerReloader>(\"ILookupLabelsCleanerReloader\");\r\nexport const IGetLookupLabelsCleanerReloader = TypeSymbol<(lookupId: string) => LookupLabelsCleanerReloader>(\r\n  \"IGetLookupLabelsCleanerReloader\"\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport class PubSub<T> {\r\n  idGen = 1;\r\n  handlers = new Map<number, (args: T) => void>();\r\n\r\n  subscribe(fn: (args: T) => void) {\r\n    const myId = this.idGen++;\r\n    this.handlers.set(myId, fn);\r\n    return () => this.handlers.delete(myId);\r\n  }\r\n\r\n  trigger(args: T) {\r\n    for (let h of this.handlers.values()) h(args);\r\n  }\r\n}\r\n\r\nexport const delay = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));\r\n\r\nexport type InterfaceOf<C> = {\r\n  [K in keyof C]: C[K]\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action } from \"mobx\";\r\nimport { ILookupMultiResultListenerArgs, LookupLoaderMulti } from \"./LookupLoaderMulti\";\r\nimport { PubSub } from \"./common\";\r\nimport { TypeSymbol } from \"dic/Container\";\r\n\r\nexport interface ILookupIndividualResultListenerArgs {\r\n  labels: Map<any, any>;\r\n}\r\n\r\nexport class LookupLoaderIndividual {\r\n  constructor(public lookupId: string, private loader: LookupLoaderMulti) {\r\n  }\r\n\r\n  @action.bound\r\n  handleResultingLabels(args: ILookupMultiResultListenerArgs) {\r\n    for (let [k, v] of args.labels.entries()) {\r\n      if (k === this.lookupId) this.resultListeners.trigger({labels: v});\r\n    }\r\n  }\r\n\r\n  resultListeners = new PubSub<ILookupIndividualResultListenerArgs>();\r\n\r\n  setInterrest(key: any) {\r\n    this.loader.setInterrest(this.lookupId, key);\r\n  }\r\n\r\n  resetInterrest(key: any) {\r\n    this.loader.resetInterrest(this.lookupId, key);\r\n  }\r\n\r\n  async loadList(labelIds: Set<any>) {\r\n    return this.loader.loadList(this.lookupId, labelIds);\r\n  }\r\n\r\n  isWorking(key: any) {\r\n    return this.loader.isWorking(this.lookupId, key);\r\n  }\r\n}\r\n\r\nexport const ILookupLoaderIndividual = TypeSymbol<LookupLoaderIndividual>(\"ILookupLoaderIndividual\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action, createAtom, observable } from \"mobx\";\r\nimport { PubSub } from \"./common\";\r\nimport { LookupApi } from \"./LookupApi\";\r\nimport { Clock } from \"./Clock\";\r\nimport { TypeSymbol } from \"dic/Container\";\r\n\r\nexport interface ILookupMultiResultListenerArgs {\r\n  labels: Map<string, Map<any, any>>;\r\n}\r\n\r\nexport class LookupLoaderMulti {\r\n  constructor(private clock: Clock, private api: LookupApi) {\r\n    this.triggerLoadDeb = clock.debounce(this.triggerLoadImm, 667);\r\n  }\r\n\r\n  // lookupId -> lookupKey -> something \r\n  interrests = new Map<string, Map<any, any>>();\r\n  loading = new Map<string, Map<any, any>>();\r\n  loadingAtom = createAtom(\r\n    \"LookupLoading\",\r\n    () => {\r\n    },\r\n    () => {\r\n    }\r\n  );\r\n\r\n  resultListeners = new PubSub<ILookupMultiResultListenerArgs>();\r\n\r\n  @observable isLoading = false;\r\n\r\n  @action.bound\r\n  async triggerLoadImm() {\r\n    // TODO: Rewrite as a flow to preserve mobx transaction\r\n    if (this.isLoading) return;\r\n    try {\r\n      do {\r\n        this.isLoading = true;\r\n        /*console.log(\"Will load:\");\r\n        for (let [l1k, l1v] of this.interrests.entries()) {\r\n          console.log(`  ${l1k}:`);\r\n          for (let [l2k, l2v] of l1v.entries()) {\r\n            console.log(`    ${l2k}`);\r\n          }\r\n        }*/\r\n\r\n        for (let [k, v] of this.interrests.entries()) {\r\n          this.loading.set(k, v);\r\n        }\r\n        this.interrests.clear();\r\n        this.loadingAtom.reportChanged();\r\n\r\n        const result = await this.api.getLookupLabels(this.loading);\r\n\r\n        for (let [l1k, l1v] of result.entries()) {\r\n          l1k = String(l1k).toLowerCase();\r\n          if (!this.loading.has(l1k)) continue;\r\n          for (let l2k of l1v.keys()) {\r\n            l2k = String(l2k).toLowerCase();\r\n            this.loading.get(l1k)!.delete(l2k);\r\n          }\r\n          if (this.loading.get(l1k)!.size === 0) {\r\n            this.loading.delete(l1k);\r\n          }\r\n        }\r\n        this.loadingAtom.reportChanged();\r\n\r\n        this.resultListeners.trigger({labels: result});\r\n      } while (this.interrests.size > 0);\r\n    } finally {\r\n      this.isLoading = false;\r\n    }\r\n  }\r\n\r\n  triggerLoadDeb = () => {\r\n  };\r\n\r\n  setInterrest(lookupId: string, key: any) {\r\n    // Maybe it is loading right now.\r\n    if (this.loading.has(lookupId) && this.loading.get(lookupId)!.has(key)) return;\r\n\r\n    // Not yet loading, record that someon is interrested.\r\n    if (!this.interrests.has(lookupId)) {\r\n      this.interrests.set(lookupId, new Map());\r\n    }\r\n    const lookupInterrests = this.interrests.get(lookupId)!;\r\n    lookupInterrests.set(key, true);\r\n\r\n    // Schedule actual loading.\r\n    this.triggerLoadDeb();\r\n  }\r\n\r\n  resetInterrest(lookupId: string, key: any) {\r\n    if (!this.interrests.has(lookupId)) {\r\n      return;\r\n    }\r\n    const lookupInterrests = this.interrests.get(lookupId)!;\r\n    lookupInterrests.delete(key);\r\n    if (lookupInterrests.size === 0) {\r\n      this.interrests.delete(lookupId);\r\n    }\r\n  }\r\n\r\n  async loadList(lookupId: string, labelIds: Set<any>) {\r\n    return this.api.getLookupLabels(\r\n      new Map([[lookupId, new Map(Array.from(labelIds.keys()).map((labelId) => [labelId, true]))]])\r\n    );\r\n  }\r\n\r\n  isWorking(lookupId: string, key: any) {\r\n    this.loadingAtom.reportObserved();\r\n    return this.loading.get(lookupId)?.has(key) || false;\r\n  }\r\n}\r\n\r\nexport const ILookupLoaderMulti = TypeSymbol<LookupLoaderMulti>(\"ILookupLoaderMulti\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action, createAtom, IAtom } from \"mobx\";\r\nimport _ from \"lodash\";\r\nimport { LookupCacheIndividual } from \"./LookupCacheIndividual\";\r\nimport { ILookupIndividualResultListenerArgs, LookupLoaderIndividual, } from \"./LookupLoaderIndividual\";\r\nimport { TypeSymbol } from \"dic/Container\";\r\n\r\nexport class LookupResolver {\r\n  constructor(private cache: LookupCacheIndividual, private loader: LookupLoaderIndividual) {\r\n  }\r\n\r\n  resolved = new Map<any, any>();\r\n  atoms = new Map<any, IAtom>();\r\n\r\n  globalAtom = createAtom(\r\n    \"LookupGlobal\",\r\n    () => {\r\n    },\r\n    () => {\r\n    }\r\n  );\r\n\r\n  handleAtomObserved(key: any, atom: IAtom) {\r\n    this.atoms.set(key, atom);\r\n    if (!this.resolved.has(key)) {\r\n      this.loader.setInterrest(key);\r\n    }\r\n  }\r\n\r\n  handleAtomUnobserved(key: any, atom: IAtom) {\r\n    this.atoms.delete(key);\r\n    this.loader.resetInterrest(key);\r\n  }\r\n\r\n  @action.bound\r\n  cleanAndReload() {\r\n    const keysToDelete: any[] = [];\r\n    for (let k of this.resolved.keys()) {\r\n      if (!this.atoms.has(k)) {\r\n        keysToDelete.push(k);\r\n      } else {\r\n        this.loader.setInterrest(k);\r\n      }\r\n    }\r\n    for (let k of keysToDelete) {\r\n      this.resolved.delete(k);\r\n    }\r\n    // This one might not be needed?\r\n    this.globalAtom.reportChanged();\r\n  }\r\n\r\n  @action.bound\r\n  handleResultingLabels(args: ILookupIndividualResultListenerArgs) {\r\n    for (let [k, v] of args.labels) {\r\n      this.resolved.set(k, v);\r\n    }\r\n    this.cache.addLookupLabels(this.resolved);\r\n    this.globalAtom.reportChanged();\r\n  }\r\n\r\n  resolveValue(key: any) {\r\n    // This runs in COMPUTED scope\r\n    //debugger\r\n    if (_.isString(key)) key = String(key).toLowerCase();\r\n\r\n    let value: any = null;\r\n\r\n    this.globalAtom.reportObserved();\r\n\r\n    if (this.resolved.has(key)) value = this.resolved.get(key)!;\r\n\r\n    if (value === null) {\r\n      const cachedLabels = this.cache.getLookupLabels();\r\n      if (cachedLabels.has(key)) {\r\n        this.resolved.set(key, cachedLabels.get(key!));\r\n        value = this.resolved.get(key)!;\r\n      }\r\n    }\r\n\r\n    if (!this.atoms.has(key)) {\r\n      const atom = createAtom(\r\n        `ALookup@${key}`,\r\n        () => this.handleAtomObserved(key, atom),\r\n        () => this.handleAtomUnobserved(key, atom)\r\n      );\r\n      atom.reportObserved();\r\n    } else {\r\n      const atom = this.atoms.get(key)!;\r\n      atom.reportObserved();\r\n    }\r\n\r\n\r\n    return value;\r\n  }\r\n\r\n  async resolveList(keys: Set<any>): Promise<Map<any, any>> {\r\n    const missingKeys = new Set(keys);\r\n    const cachedLabels = this.cache.getLookupLabels();\r\n    const cachedResultMap = new Map<any, any>();\r\n    for (let labelId of Array.from(missingKeys.keys())) {\r\n      if (this.resolved.has(labelId)) {\r\n        missingKeys.delete(labelId);\r\n        cachedResultMap.set(labelId, this.resolved.get(labelId));\r\n      }\r\n      if (cachedLabels.has(labelId)) {\r\n        missingKeys.delete(labelId);\r\n        cachedResultMap.set(labelId, cachedLabels.get(labelId));\r\n      }\r\n    }\r\n\r\n    const loadedResultMap = await this.loader.loadList(missingKeys);\r\n    const entryArray = Array.from(loadedResultMap);\r\n    if (entryArray.length === 1) {\r\n      this.cache.addLookupLabels(loadedResultMap);\r\n      const innerLoadedMap = entryArray[0][1];\r\n      this.resolved = new Map([...innerLoadedMap, ...this.resolved]);\r\n      return new Map([...innerLoadedMap, ...cachedResultMap]);\r\n    }\r\n    if (entryArray.length === 0) {\r\n      return cachedResultMap;\r\n    }\r\n    throw new Error(\"More that one lookup result maps\");\r\n  }\r\n\r\n  isEmptyAndLoading(key: any) {\r\n    if (_.isString(key)) key = String(key).toLowerCase();\r\n\r\n    if (!this.resolved.has(key)) {\r\n      return this.loader.isWorking(key);\r\n    } else return false;\r\n  }\r\n}\r\n\r\nexport const ILookupResolver = TypeSymbol<LookupResolver>(\"ILookupResolver\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Container, TypeSymbol } from \"dic/Container\";\r\nimport { ILookupId } from \"./LookupModule\";\r\n\r\n\r\nexport class LookupScopeRegistry {\r\n  items = new Map<string, Container>();\r\n\r\n  addScope($cont: Container) {\r\n    this.items.set($cont.resolve(ILookupId), $cont);\r\n  }\r\n\r\n  removeScope($cont: Container) {\r\n    this.items.delete($cont.resolve(ILookupId));\r\n  }\r\n\r\n  getScope(lookupId: string) {\r\n    return this.items.get(lookupId)!;\r\n  }\r\n\r\n  hasScope(lookupId: string) {\r\n    return this.items.has(lookupId);\r\n  }\r\n}\r\n\r\nexport const ILookupScopeRegistry = TypeSymbol<LookupScopeRegistry>(\"ILookupScopeRegistry\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Container, TypeSymbol } from \"dic/Container\";\r\nimport { ILookupIndividualEngine } from \"model/entities/Property\";\r\nimport { IApi } from \"model/entities/types/IApi\";\r\nimport { Clock } from \"./Clock\";\r\nimport { LookupApi } from \"./LookupApi\";\r\nimport { LookupCacheDependencies } from \"./LookupCacheDependencies\";\r\nimport { LookupCacheIndividual } from \"./LookupCacheIndividual\";\r\nimport { LookupCacheMulti } from \"./LookupCacheMulti\";\r\nimport { LookupLabelsCleanerReloader } from \"./LookupCleanerLoader\";\r\nimport { LookupLoaderIndividual } from \"./LookupLoaderIndividual\";\r\nimport { LookupLoaderMulti } from \"./LookupLoaderMulti\";\r\nimport { LookupResolver } from \"./LookupResolver\";\r\nimport { ILookupScopeRegistry } from \"./LookupScopeRegistry\";\r\n\r\nexport const SCOPE_Lookup = \"Lookup\";\r\n\r\nexport const ILookupId = TypeSymbol<string>(\"ILookupId\");\r\n\r\nexport function register($cont: Container) {\r\n}\r\n\r\nexport function createMultiLookupEngine(origamApi: () => IApi): IMultiLookupEngine {\r\n  const lookupCleanerReloaderById = new Map<string, LookupLabelsCleanerReloader>();\r\n  const clock = new Clock();\r\n  const api = new LookupApi(origamApi);\r\n  const lookupCacheMulti = new LookupCacheMulti(\r\n    clock,\r\n    (lookupId) => lookupCleanerReloaderById.get(lookupId)!\r\n  );\r\n  const lookupLoaderMulti = new LookupLoaderMulti(clock, api);\r\n  const lookupEngineById = new Map<string, ILookupIndividualEngine>();\r\n\r\n  const cacheDependencies = new LookupCacheDependencies();\r\n\r\n  return {\r\n    lookupCacheMulti,\r\n    lookupLoaderMulti,\r\n    lookupCleanerReloaderById,\r\n    lookupEngineById,\r\n    cacheDependencies,\r\n    startup() {\r\n      lookupCacheMulti.startup();\r\n    },\r\n    teardown() {\r\n      lookupCacheMulti.teardown();\r\n    },\r\n  };\r\n}\r\n\r\nexport interface IMultiLookupEngine {\r\n  lookupCacheMulti: LookupCacheMulti;\r\n  lookupLoaderMulti: LookupLoaderMulti;\r\n  lookupCleanerReloaderById: Map<string, LookupLabelsCleanerReloader>;\r\n  lookupEngineById: Map<string, ILookupIndividualEngine>;\r\n  cacheDependencies: LookupCacheDependencies;\r\n\r\n  startup(): void;\r\n\r\n  teardown(): void;\r\n}\r\n\r\nexport function createIndividualLookupEngine(\r\n  lookupId: string,\r\n  multiLookupEngine: IMultiLookupEngine\r\n) {\r\n  const {lookupCacheMulti, lookupLoaderMulti, lookupCleanerReloaderById} = multiLookupEngine;\r\n  const lookupCacheIndividual = new LookupCacheIndividual(lookupId, lookupCacheMulti);\r\n  const lookupLoaderIndividual = new LookupLoaderIndividual(lookupId, lookupLoaderMulti);\r\n  const lookupResolver = new LookupResolver(lookupCacheIndividual, lookupLoaderIndividual);\r\n  const lookupCleanerReloader = new LookupLabelsCleanerReloader(\r\n    lookupCacheIndividual,\r\n    lookupResolver\r\n  );\r\n\r\n  lookupLoaderIndividual.resultListeners.subscribe(lookupResolver.handleResultingLabels);\r\n  const disposers: any[] = [];\r\n  return {\r\n    lookupResolver,\r\n    lookupCleanerReloader,\r\n    startup() {\r\n      lookupCleanerReloaderById.set(lookupId, lookupCleanerReloader);\r\n      disposers.push(\r\n        multiLookupEngine.lookupLoaderMulti.resultListeners.subscribe(\r\n          lookupLoaderIndividual.handleResultingLabels\r\n        )\r\n      );\r\n    },\r\n    teardown() {\r\n      lookupCleanerReloaderById.delete(lookupId);\r\n      for (let d of disposers) d();\r\n    },\r\n    cleanAndReload() {\r\n      lookupCleanerReloader.reloadLookupLabels();\r\n    },\r\n  };\r\n}\r\n\r\nexport function beginLookupScope($parent: Container, lookupId: string) {\r\n  const $cont = $parent.beginLifetimeScope(SCOPE_Lookup);\r\n  $cont.register(ILookupId, () => lookupId).scopedInstance(SCOPE_Lookup);\r\n  $cont.resolve(ILookupScopeRegistry).addScope($cont);\r\n  $cont.onThisScopeWillDispose(($cont) => $cont.resolve(ILookupScopeRegistry).removeScope($cont));\r\n  return $cont;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { PubSub } from \"utils/events\";\r\n\r\nexport class ScreenEvents {\r\n  focusField = new PubSub<{ propertyId: string }>();\r\n}\r\n\r\nexport const IScreenEvents = TypeSymbol<ScreenEvents>(\"IScreenEvents\");","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Container } from \"dic/Container\";\r\nimport { IScreenEvents, ScreenEvents } from \"./ScreenEvents\";\r\n\r\nexport const SCOPE_FormScreen = \"FormScreen\";\r\n\r\nexport function register($cont: Container) {\r\n  $cont.registerClass(IScreenEvents, ScreenEvents).scopedInstance(SCOPE_FormScreen);\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport * as FormScreenModule from './FormScreen/FormScreenModule';\r\nimport { Container } from 'dic/Container';\r\n\r\nexport const SCOPE_Screen = \"Screen\";\r\n\r\nexport function register($cont: Container) {\r\n  FormScreenModule.register($cont);\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Container, ILifetime } from \"dic/Container\";\r\nimport { registerModules } from \"registerModules\";\r\n\r\nconst $root = new Container({defaultLifetime: ILifetime.PerLifetimeScope});\r\nregisterModules($root);\r\n\r\nexport default $root;","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Container } from \"dic/Container\";\r\nimport * as PerspectiveModule from \"modules/DataView/Perspective/PerspectiveModule\";\r\nimport * as DataViewModule from \"modules/DataView/DataViewModule\";\r\nimport * as LookupModule from \"modules/Lookup/LookupModule\";\r\nimport * as ScreenModule from \"modules/Screen/ScreenModule\";\r\n\r\nexport function registerModules($cont: Container) {\r\n  DataViewModule.register($cont);\r\n  PerspectiveModule.register($cont);\r\n  LookupModule.register($cont);\r\n  ScreenModule.register($cont);\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport enum Layout {\r\n  Mobile, Desktop\r\n}\r\n\r\nexport function parseLayout(candidate?: string){\r\n  if(candidate === \"Mobile\"){\r\n    return Layout.Mobile;\r\n  }\r\n  return Layout.Desktop;\r\n}\r\n\r\nexport function layoutToString(layout?: Layout){\r\n  if(layout === Layout.Mobile) {\r\n    return \"Mobile\";\r\n  }\r\n  return \"Desktop\";\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport xmlJs from \"xml-js\";\r\nimport axios, { AxiosInstance } from \"axios\";\r\n\r\nimport _ from \"lodash\";\r\nimport {\r\n  IApi,\r\n  IEntityExportField,\r\n  ILazyLoadedEntityInput,\r\n  IUIGridFilterCoreConfiguration,\r\n  IUpdateData\r\n} from \"./types/IApi\";\r\nimport { IAggregationInfo } from \"./types/IAggregationInfo\";\r\nimport { IOrdering } from \"./types/IOrderingConfiguration\";\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { IAboutInfo } from \"./types/IAboutInfo\";\r\nimport { T } from \"utils/translation\";\r\nimport fileDownload from \"js-file-download\";\r\nimport { ITableConfiguration } from \"model/entities/TablePanelView/types/IConfigurationManager\";\r\nimport { PubSub } from \"utils/events\";\r\nimport { layoutToString } from \"model/entities/TablePanelView/layout\";\r\n\r\n\r\nexport enum IAuditLogColumnIndices {\r\n  Id = 0,\r\n  DateTime = 1,\r\n  UserName = 2,\r\n  FieldName = 3,\r\n  OldValue = 4,\r\n  NewValue = 5,\r\n  ActionType = 6,\r\n}\r\n\r\nexport class OrigamAPI implements IApi {\r\n  constructor(errorHandler: (error: any) => void) {\r\n    this.urlPrefix = \"/internalApi\";\r\n    this.chatroomsUrlPrefix = \"/chatrooms\";\r\n    this.axiosInstance = this.createAxiosInstance();\r\n    this.errorHandler = errorHandler;\r\n  }\r\n\r\n  private createAxiosInstance() {\r\n    const axiosInstance = axios.create({\r\n      baseURL: this.urlPrefix,\r\n      headers: this.httpAuthHeader,\r\n    });\r\n\r\n    axiosInstance.interceptors.response.use(\r\n      (response) => {\r\n        this.onApiResponse.trigger({});\r\n        return response;\r\n      },\r\n      async (error) => {\r\n        if (error.response?.data?.constructor?.name === 'Blob') {\r\n          error.response.data = await error.response.data.text();\r\n        }\r\n        if (!axios.isCancel(error)) {\r\n          this.errorHandler(error);\r\n        }\r\n        throw error;\r\n      }\r\n    );\r\n    return axiosInstance;\r\n  }\r\n\r\n  onApiResponse = new PubSub<{}>();\r\n\r\n  errorHandler: (error: any) => void;\r\n  axiosInstance: AxiosInstance;\r\n  urlPrefix: string;\r\n  chatroomsUrlPrefix: string;\r\n  accessToken = \"\";\r\n\r\n  setAccessToken(token: string) {\r\n    this.accessToken = token;\r\n    this.axiosInstance = this.createAxiosInstance();\r\n  }\r\n\r\n  resetAccessToken(): void {\r\n    this.accessToken = \"\";\r\n  }\r\n\r\n  get httpAuthHeader() {\r\n    return {\r\n      Authorization: `Bearer ${this.accessToken}`,\r\n    };\r\n  }\r\n\r\n  createCanceller(): () => void {\r\n    const tokenSource = axios.CancelToken.source();\r\n    const token = tokenSource.token;\r\n    const canceller = () => {\r\n      tokenSource.cancel();\r\n    };\r\n    canceller.token = token;\r\n    return canceller as any;\r\n  }\r\n\r\n  _getCancelToken(canceller: any) {\r\n    return canceller.any;\r\n  }\r\n\r\n  async login(credentials: { UserName: string; Password: string }) {\r\n    return (await this.axiosInstance.post(\"/User/Login\", credentials)).data;\r\n  }\r\n\r\n  async logout() {\r\n    return await this.axiosInstance.post(\"/User/Logout\", {});\r\n  }\r\n\r\n  async getScreen(id: string) {\r\n    return xmlJs.xml2js(\r\n      (\r\n        await this.axiosInstance.get(\"/UI/GetUI\", {\r\n          params: {id},\r\n          headers: this.httpAuthHeader,\r\n        })\r\n      ).data,\r\n      {addParent: true, alwaysChildren: true}\r\n    );\r\n  }\r\n\r\n  async initUI(data: {\r\n    Type: string;\r\n    FormSessionId: string | undefined;\r\n    IsNewSession: boolean;\r\n    RegisterSession: boolean;\r\n    DataRequested: boolean;\r\n    ObjectId: string;\r\n    Caption: string;\r\n    Parameters: { [key: string]: any };\r\n    IsSingleRecordEdit?: boolean;\r\n    RequestCurrentRecordId: boolean;\r\n  }) {\r\n    const result = (await this.axiosInstance.post(\"/UIService/InitUI\", data)).data;\r\n    return {\r\n      ...result,\r\n      formDefinition: xmlJs.xml2js(result.formDefinition, {\r\n        addParent: true,\r\n        alwaysChildren: true,\r\n      }),\r\n    };\r\n  }\r\n\r\n  async destroyUI(data: { FormSessionId: string }) {\r\n    return (await this.axiosInstance.get(`/UIService/DestroyUI/${data.FormSessionId}`)).data;\r\n  }\r\n\r\n  async getEntities(query: {\r\n    MenuId: string;\r\n    DataStructureEntityId: string;\r\n    Ordering: Array<[string, string]>;\r\n    ColumnNames: string[];\r\n    Filter: string;\r\n    RowLimit?: number;\r\n    MasterRowId?: string;\r\n  }) {\r\n    const response = (await this.axiosInstance.post(\"/Data/GetRows\", query)).data;\r\n\r\n    if (_.isString(response.data)) {\r\n      return [];\r\n    } else {\r\n      return response.data;\r\n    }\r\n  }\r\n\r\n  async getLookupLabels(query: {\r\n    LookupId: string;\r\n    MenuId: string | undefined;\r\n    LabelIds: string[];\r\n  }) {\r\n    return (await this.axiosInstance.post(\"/UIService/GetLookupLabels\", query)).data;\r\n  }\r\n\r\n  async getLookupLabelsEx(\r\n    query: {\r\n      LookupId: string;\r\n      MenuId: string | undefined;\r\n      LabelIds: string[];\r\n    }[]\r\n  ) {\r\n    if (query.length === 1 && query[0].LabelIds.length === 0) {\r\n      return {LookupId: {}}\r\n    }\r\n    return (await this.axiosInstance.post(\"/UIService/GetLookupLabelsEx\", query)).data;\r\n  }\r\n\r\n  async newEntity(data: { DataStructureEntityId: string; MenuId: string }) {\r\n    return (await this.axiosInstance.post(\"/Data/NewEmptyRow\", data)).data;\r\n  }\r\n\r\n  async putEntity(data: {\r\n    DataStructureEntityId: string;\r\n    RowId: string;\r\n    NewValues: { [key: string]: any };\r\n    MenuId: string;\r\n  }) {\r\n    return (await this.axiosInstance.put(\"/Data/Row\", data)).data;\r\n  }\r\n\r\n  async postEntity(data: {\r\n    DataStructureEntityId: string;\r\n    NewValues: { [key: string]: any };\r\n    MenuId: string;\r\n  }) {\r\n    return (await this.axiosInstance.post(\"/Data/Row\", data)).data;\r\n  }\r\n\r\n  async deleteEntity(data: {\r\n    DataStructureEntityId: string;\r\n    RowIdToDelete: string;\r\n    MenuId: string;\r\n  }) {\r\n    return (\r\n      await this.axiosInstance.request({\r\n        url: `${this.urlPrefix}/Data/Row`,\r\n        method: \"DELETE\",\r\n        data,\r\n        headers: this.httpAuthHeader,\r\n      })\r\n    ).data;\r\n  }\r\n\r\n  async createEntity() {\r\n    // TODO\r\n  }\r\n\r\n  async createSession(data: {\r\n    MenuId: string;\r\n    Parameters: { [key: string]: any };\r\n    InitializeStructure: boolean;\r\n  }) {\r\n    return (await this.axiosInstance.post(\"/Session/CreateSession\", data)).data;\r\n  }\r\n\r\n  async deleteSession() {\r\n  }\r\n\r\n  async saveSession(sessionFormIdentifier: string) {\r\n    return (await this.axiosInstance.get(`/UIService/SaveData/${sessionFormIdentifier}`)).data;\r\n  }\r\n\r\n  async saveSessionQuery(sessionFormIdentifier: string) {\r\n    return (await this.axiosInstance.get(`/UIService/SaveDataQuery/${sessionFormIdentifier}`)).data;\r\n  }\r\n\r\n  async refreshSession(sessionFormIdentifier: string) {\r\n    return (await this.axiosInstance.get(`/UIService/RefreshData/${sessionFormIdentifier}`)).data;\r\n  }\r\n\r\n  async revertChanges(data: { sessionFormIdentifier: string }) {\r\n    await this.axiosInstance.post(\"/UIService/RevertChanges\", data);\r\n  }\r\n\r\n  async sessionChangeMasterRecord(data: {\r\n    SessionFormIdentifier: string;\r\n    Entity: string;\r\n    RowId: string;\r\n  }) {\r\n    return (await this.axiosInstance.post(\"/Session/ChangeMasterRecord\", data)).data;\r\n  }\r\n\r\n  async sessionDeleteEntity(data: {\r\n    SessionFormIdentifier: string;\r\n    Entity: string;\r\n    RowId: string;\r\n  }) {\r\n    return (await this.axiosInstance.post(\"/Session/DeleteRow\", data)).data;\r\n  }\r\n\r\n  async sessionCreateEntity(data: {\r\n    SessionFormIdentifier: string;\r\n    Entity: string;\r\n    Values: { [key: string]: any };\r\n    Parameters: { [key: string]: any };\r\n    RequestingGridId: string;\r\n  }) {\r\n    return (await this.axiosInstance.post(`/Session/CreateRow`, data)).data;\r\n  }\r\n\r\n  async sessionGetEntity(data: {\r\n    sessionFormIdentifier: string;\r\n    childEntity: string;\r\n    parentRecordId: string;\r\n    rootRecordId: string;\r\n  }) {\r\n    return (\r\n      await this.axiosInstance.get(\"/Session/Rows\", {\r\n        params: data,\r\n        headers: this.httpAuthHeader,\r\n      })\r\n    ).data;\r\n  }\r\n\r\n  // TODO: Remove this method.\r\n  async sessionUpdateEntity(data: {\r\n    SessionFormIdentifier: string;\r\n    Entity: string;\r\n    Id: string;\r\n    Property: string;\r\n    NewValue: any;\r\n  }): Promise<any> {\r\n    return (await this.axiosInstance.post(\"/Session/UpdateRow\", data)).data;\r\n  }\r\n\r\n  async getLookupList(data: {\r\n    DataStructureEntityId?: string;\r\n    FormSessionIdentifier?: string;\r\n    Entity?: string;\r\n    ColumnNames: string[];\r\n    Property: string;\r\n    Id: string;\r\n    LookupId: string;\r\n    Parameters?: { [key: string]: any };\r\n    ShowUniqueValues: boolean;\r\n    SearchText: string;\r\n    PageSize: number;\r\n    PageNumber: number;\r\n    MenuId: string;\r\n  }): Promise<any> {\r\n    return (await this.axiosInstance.post(\"/UIService/GetLookupList\", data)).data;\r\n  }\r\n\r\n  async getLookupCacheDependencies(data: { LookupIds: string[] }): Promise<any> {\r\n    return (await this.axiosInstance.post(\"/UIService/GetLookupCacheDependencies\", data)).data;\r\n  }\r\n\r\n  async getNotificationBoxContent(): Promise<any> {\r\n    return (await this.axiosInstance.get(\"/UIService/GetNotificationBoxContent\")).data;\r\n  }\r\n\r\n  async defaultLocalizationCookie(): Promise<any> {\r\n    return (await this.axiosInstance.get(\"/UIService/DefaultLocalizationCookie\")).data;\r\n  }\r\n\r\n  async initPortal(): Promise<any> {\r\n    const data = (await this.axiosInstance.get(\"/UIService/InitPortal\")).data;\r\n\r\n    return {\r\n      ...data,\r\n      menu: xmlJs.xml2js(data.menu, {addParent: true, alwaysChildren: true}),\r\n    };\r\n  }\r\n\r\n  async setMasterRecord(\r\n    data: {\r\n      SessionFormIdentifier: string;\r\n      Entity: string;\r\n      RowId: string;\r\n    },\r\n    canceller?: any\r\n  ) {\r\n    return (\r\n      (\r\n        await this.axiosInstance.post(\"/UIService/MasterRecord\", data, {\r\n          headers: this.httpAuthHeader,\r\n          cancelToken: canceller && canceller.token,\r\n        })\r\n      )?.data ?? []\r\n    );\r\n  }\r\n\r\n  async restoreData(data: { SessionFormIdentifier: string; ObjectId: string }) {\r\n    return (await this.axiosInstance.post(\"/UIService/RestoreData\", data)).data;\r\n  }\r\n\r\n  async updateObject(data: {\r\n    SessionFormIdentifier: string;\r\n    Entity: string;\r\n    UpdateData: IUpdateData[];\r\n  }): Promise<any> {\r\n    return (await this.axiosInstance.post(\"/UIService/UpdateObject\", data)).data;\r\n  }\r\n\r\n  async createObject(data: {\r\n    SessionFormIdentifier: string;\r\n    Entity: string;\r\n    Values: { [key: string]: any };\r\n    Parameters: { [key: string]: any };\r\n    RequestingGridId: string;\r\n  }): Promise<any> {\r\n    return (await this.axiosInstance.post(\"/UIService/CreateObject\", data)).data;\r\n  }\r\n\r\n  async copyObject(data: {\r\n    Entity: string;\r\n    SessionFormIdentifier: string;\r\n    ForcedValues: {};\r\n    RequestingGridId: string;\r\n    OriginalId: string;\r\n    Entities: string[];\r\n  }): Promise<any> {\r\n    return (await this.axiosInstance.post(\"/UIService/CopyObject\", data)).data;\r\n  }\r\n\r\n  async deleteObject(data: {\r\n    SessionFormIdentifier: string;\r\n    Entity: string;\r\n    Id: string;\r\n  }): Promise<any> {\r\n    return (await this.axiosInstance.post(\"/UIService/DeleteObject\", data)).data;\r\n  }\r\n\r\n  async deleteObjectInOrderedList(data: {\r\n    SessionFormIdentifier: string;\r\n    Entity: string;\r\n    Id: string;\r\n    OrderProperty: string;\r\n    UpdatedOrderValues: {};\r\n  }): Promise<any> {\r\n    return (await this.axiosInstance.post(\"/UIService/DeleteObjectInOrderedList\", data)).data;\r\n  }\r\n\r\n  async executeActionQuery(data: {\r\n    SessionFormIdentifier: string;\r\n    Entity: string;\r\n    ActionType: string;\r\n    ActionId: string;\r\n    ParameterMappings: { [key: string]: any };\r\n    SelectedItems: string[];\r\n    InputParameters: { [key: string]: any };\r\n  }): Promise<any> {\r\n    return (await this.axiosInstance.post(\"/UIService/ExecuteActionQuery\", data)).data;\r\n  }\r\n\r\n  async executeAction(data: {\r\n    SessionFormIdentifier: string;\r\n    Entity: string;\r\n    ActionType: string;\r\n    ActionId: string;\r\n    ParameterMappings: { [key: string]: any };\r\n    SelectedItems: string[];\r\n    InputParameters: { [key: string]: any };\r\n    RequestingGrid: string;\r\n  }): Promise<any> {\r\n    return (await this.axiosInstance.post(`/UIService/ExecuteAction`, data)).data;\r\n  }\r\n\r\n  async getFilterListValues(data: {\r\n    MenuId: string;\r\n    DataStructureEntityId: string;\r\n    Property: string;\r\n    SessionFormIdentifier: string | undefined;\r\n    Filter: string;\r\n    FilterLookups?: { [key: string]: string };\r\n  }): Promise<any[]> {\r\n    return (await this.axiosInstance.post(`/UIService/GetFilterListValues`, data)).data;\r\n  }\r\n\r\n  async getGroups(data: {\r\n    MenuId: string;\r\n    DataStructureEntityId: string;\r\n    Filter: string | undefined;\r\n    FilterLookups?: { [key: string]: string };\r\n    Ordering: IOrdering[];\r\n    RowLimit: number;\r\n    GroupBy: string;\r\n    GroupingUnit: string | undefined;\r\n    MasterRowId: string | undefined;\r\n    GroupByLookupId: string | undefined;\r\n    SessionFormIdentifier: string | undefined;\r\n    AggregatedColumns: IAggregationInfo[] | undefined;\r\n  }): Promise<any[]> {\r\n    const resultData = (await this.axiosInstance.post(`/UIService/GetGroups`, data)).data;\r\n    if (resultData.length > 50_000) {\r\n      throw new Error(T(\"There are too many groups, choose different grouping options please.\", \"too_many_groups\"));\r\n    }\r\n    return resultData;\r\n  }\r\n\r\n  async getAggregations(data: {\r\n    MenuId: string;\r\n    DataStructureEntityId: string;\r\n    Filter: string | undefined;\r\n    FilterLookups?: { [key: string]: string };\r\n    AggregatedColumns: IAggregationInfo[];\r\n    SessionFormIdentifier: string | undefined;\r\n    MasterRowId: string | undefined;\r\n  }): Promise<any[]> {\r\n    return (await this.axiosInstance.post(`/UIService/GetAggregations`, data)).data;\r\n  }\r\n\r\n  async getRows(data: {\r\n    MenuId: string;\r\n    SessionFormIdentifier: string;\r\n    DataStructureEntityId: string;\r\n    Ordering: IOrdering[];\r\n    RowLimit: number;\r\n    RowOffset: number;\r\n    Parameters: { [key: string]: string };\r\n    ColumnNames: string[];\r\n    MasterRowId: string | undefined;\r\n    Filter: string;\r\n    FilterLookups?: { [key: string]: string };\r\n  }): Promise<any> {\r\n    return (await this.axiosInstance.post(`/UIService/GetRows`, data)).data;\r\n  }\r\n\r\n  async getRow(data: {\r\n    SessionFormIdentifier: string;\r\n    Entity: string;\r\n    RowId: string;\r\n  }): Promise<any> {\r\n    return (await this.axiosInstance.post(`/UIService/GetRow`, data)).data;\r\n  }\r\n\r\n  async getData(data: {\r\n    SessionFormIdentifier: string;\r\n    ChildEntity: string;\r\n    ParentRecordId: string;\r\n    RootRecordId: string;\r\n  }): Promise<any> {\r\n    return (await this.axiosInstance.post(`/UIService/GetData`, data)).data;\r\n  }\r\n\r\n  getReportFromMenu(data: { menuId: string }): Promise<any>;\r\n\r\n  async getReportFromMenu(data: { menuId: string }): Promise<string> {\r\n    return (await this.axiosInstance.get(`/UIService/ReportFromMenu/${data.menuId}`)).data;\r\n  }\r\n\r\n  async getRowStates(data: {\r\n    SessionFormIdentifier: string;\r\n    Entity: string;\r\n    Ids: string[];\r\n  }): Promise<any> {\r\n    let states = (await this.axiosInstance.post(`/UIService/RowStates`, data)).data;\r\n    for (const state of states) {\r\n      state.id = state.id.toString();\r\n    }\r\n    return states;\r\n  }\r\n\r\n  async saveFavorites(data: {\r\n    ConfigXml: string;\r\n  }): Promise<any> {\r\n    return (await this.axiosInstance.post(`/UIService/SaveFavorites`, data)).data;\r\n  }\r\n\r\n  async getWorkQueueList(): Promise<any> {\r\n    return (await this.axiosInstance.get(`/UIService/WorkQueueList`)).data;\r\n  }\r\n\r\n  async getChatroomList(): Promise<any> {\r\n    return (await axios.get(`${this.chatroomsUrlPrefix}/Chat`, {headers: this.httpAuthHeader}))\r\n      .data;\r\n  }\r\n\r\n  async saveObjectConfiguration(data: {\r\n    sessionFormIdentifier: string;\r\n    instanceId: string;\r\n    tableConfigurations: ITableConfiguration[];\r\n    customConfigurations?: {[nodeName: string] : string};\r\n    defaultView: string;\r\n  }): Promise<any> {\r\n    let customConfigurationXml = \"\";\r\n    if(data.customConfigurations){\r\n      const customConfigurations = Object.entries(data.customConfigurations)\r\n        .filter(entry => entry[0] && entry[1])\r\n        .map(entry => {\r\n          const encodedConfig = window.btoa(decodeURIComponent(encodeURIComponent(entry[1])))\r\n          return `<${entry[0]}Configuration>\\n${encodedConfig}\\n</${entry[0]}Configuration>`\r\n        });\r\n      if(customConfigurations.length > 0) {\r\n        customConfigurationXml = `<CustomConfigurations>\\n${customConfigurations.join(\"\\n\")}\\n</CustomConfigurations>`\r\n      }\r\n    }\r\n\r\n    const tableConfigurationsXml = data.tableConfigurations.map(tableConfig => {\r\n      return \"<TableConfiguration\" +\r\n        ` name=\"${tableConfig.name ?? \"\"}\"` +\r\n        ` fixedColumnCount=\"${tableConfig.fixedColumnCount}\"` +\r\n        ` isActive=\"${tableConfig.isActive}\"` +\r\n        ` id=\"${tableConfig.id}\"` +\r\n        ` layout=\"${layoutToString(tableConfig.layout)}\"` +\r\n        \">\" +\r\n        tableConfig.columnConfigurations\r\n          .map(columnConfig =>\r\n            \"<ColumnConfiguration\" +\r\n            ` propertyId=\"${columnConfig.propertyId}\"` +\r\n            ` width=\"${columnConfig.width}\"` +\r\n            (columnConfig.timeGroupingUnit !== undefined ? ` groupingUnit=\"${columnConfig.timeGroupingUnit}\"` : \"\") +\r\n            (columnConfig.groupingIndex > 0 ? ` groupingIndex=\"${columnConfig.groupingIndex}\"` : \"\") +\r\n            ` isVisible=\"${columnConfig.isVisible}\"` +\r\n            (columnConfig.aggregationType ? ` aggregationType=\"${columnConfig.aggregationType}\"` : \"\") +\r\n            \"/>\")\r\n          .join(\"\\n\")\r\n        + \"</TableConfiguration>\"\r\n    })\r\n    await this.axiosInstance.post(`/UIService/SaveObjectConfig`, {\r\n      ObjectInstanceId: data.instanceId,\r\n      SectionNameAndData: {\r\n        tableConfigurations: tableConfigurationsXml.join(\"\\n\"),\r\n        customConfigurations: customConfigurationXml,\r\n        defaultView: `<view id=\"${data.defaultView}\" />`,\r\n      }\r\n    });\r\n  }\r\n\r\n  async resetScreenColumnConfiguration(data: {\r\n    instanceId: string;\r\n  }): Promise<any> {\r\n    await this.axiosInstance.post(`/UIService/ResetScreenColumnConfiguration`, {\r\n      ObjectInstanceId: data.instanceId,\r\n    });\r\n  }\r\n\r\n  async saveSplitPanelConfiguration(data: { InstanceId: string; Position: number }): Promise<any> {\r\n    return (await this.axiosInstance.post(`/UIService/SaveSplitPanelConfig`, data)).data;\r\n  }\r\n\r\n  async workflowAbort(data: { sessionFormIdentifier: string }): Promise<any> {\r\n    const result = (\r\n      await this.axiosInstance.get(`/UIService/WorkflowAbort/${data.sessionFormIdentifier}`)\r\n    ).data;\r\n\r\n    return {\r\n      ...result,\r\n      formDefinition: xmlJs.xml2js(result.formDefinition, {\r\n        addParent: true,\r\n        alwaysChildren: true,\r\n      }),\r\n    };\r\n  }\r\n\r\n  async workflowRepeat(data: { sessionFormIdentifier: string }): Promise<any> {\r\n    const result = (\r\n      await this.axiosInstance.get(`/UIService/WorkflowRepeat/${data.sessionFormIdentifier}`)\r\n    ).data;\r\n\r\n    return {\r\n      ...result,\r\n      formDefinition: xmlJs.xml2js(result.formDefinition, {\r\n        addParent: true,\r\n        alwaysChildren: true,\r\n      }),\r\n    };\r\n  }\r\n\r\n  async workflowNext(data: {\r\n    sessionFormIdentifier: string;\r\n    CachedFormIds: string[];\r\n  }): Promise<any> {\r\n    const result = (\r\n      await this.axiosInstance.post(`/UIService/WorkflowNext`, {\r\n        SessionFormIdentifier: data.sessionFormIdentifier,\r\n        CachedFormIds: data.CachedFormIds,\r\n      })\r\n    ).data;\r\n\r\n    return {\r\n      ...result,\r\n      formDefinition: xmlJs.xml2js(result.formDefinition, {\r\n        addParent: true,\r\n        alwaysChildren: true,\r\n      }),\r\n    };\r\n  }\r\n\r\n  async workflowNextQuery(data: { sessionFormIdentifier: string }): Promise<any> {\r\n    return (\r\n      await this.axiosInstance.get(`/UIService/WorkflowNextQuery/${data.sessionFormIdentifier}`)\r\n    ).data;\r\n  }\r\n\r\n  async getRecordInfo(data: { MenuId: string; DataStructureEntityId: string; RowId: string }) {\r\n    return (await this.axiosInstance.post(`/UIService/GetRecordTooltip`, data)).data.tooltip;\r\n  }\r\n\r\n  async getRecordAudit(data: { MenuId: string; DataStructureEntityId: string; RowId: string }) {\r\n    return (await this.axiosInstance.post(`/UIService/GetAudit`, data)).data.data.map(\r\n      (row: any[]) => ({\r\n        id: row[IAuditLogColumnIndices.Id],\r\n        dateTime: row[IAuditLogColumnIndices.DateTime],\r\n        userName: row[IAuditLogColumnIndices.UserName],\r\n        fieldName: row[IAuditLogColumnIndices.FieldName],\r\n        oldValue: row[IAuditLogColumnIndices.OldValue],\r\n        newValue: row[IAuditLogColumnIndices.NewValue],\r\n        actionType: row[IAuditLogColumnIndices.ActionType],\r\n      })\r\n    );\r\n  }\r\n\r\n  async getReport(data: { reportUrl: string }): Promise<any> {\r\n    return (await this.axiosInstance.get(data.reportUrl)).data;\r\n  }\r\n\r\n  async getDownloadToken(data: {\r\n    SessionFormIdentifier: string;\r\n    MenuId: string;\r\n    DataStructureEntityId: string;\r\n    RowId: string;\r\n    Property: string;\r\n    FileName: string;\r\n    Entity: string;\r\n    parameters: any;\r\n    isPreview: boolean;\r\n  }): Promise<any> {\r\n    return (\r\n      await this.axiosInstance.post(`/Blob/DownloadToken`, {\r\n        SessionFormIdentifier: data.SessionFormIdentifier,\r\n        MenuId: data.MenuId,\r\n        DataStructureEntityId: data.DataStructureEntityId,\r\n        Entity: data.Entity,\r\n        RowId: data.RowId,\r\n        Property: data.Property,\r\n        IsPreview: data.isPreview,\r\n        Parameters: data.parameters,\r\n      })\r\n    ).data;\r\n  }\r\n\r\n  async getBlob(data: { downloadToken: string }) {\r\n    window.open(`${this.urlPrefix}/Blob/${data.downloadToken}`);\r\n    /*return (\r\nawait axios.get(`${this.urlPrefix}/Blob/${data.downloadToken}`, {\r\n headers: this.httpAuthHeader,\r\n})\r\n).data;*/\r\n  }\r\n\r\n  async getUploadToken(data: {\r\n    SessionFormIdentifier: string;\r\n    MenuId: string;\r\n    DataStructureEntityId: string;\r\n    Entity: string;\r\n    RowId: string;\r\n    Property: string;\r\n    FileName: string;\r\n    DateCreated: string;\r\n    DateLastModified: string;\r\n    parameters: any;\r\n  }): Promise<any> {\r\n    return (\r\n      await this.axiosInstance.post(`/Blob/UploadToken`, {\r\n        SessionFormIdentifier: data.SessionFormIdentifier,\r\n        MenuId: data.MenuId,\r\n        DataStructureEntityId: data.DataStructureEntityId,\r\n        Entity: data.Entity,\r\n        RowId: data.RowId,\r\n        Property: data.Property,\r\n        IsPreview: false,\r\n        Parameters: data.parameters,\r\n        SubmitImmediately: \"true\",\r\n      })\r\n    ).data;\r\n  }\r\n\r\n  async putBlob(\r\n    data: { uploadToken: string; fileName: string; file: any },\r\n    onUploadProgress?: (event: any) => void\r\n  ): Promise<any> {\r\n    return (\r\n      await this.axiosInstance.post(`/Blob/${data.uploadToken}/${data.fileName}`, data.file, {\r\n        headers: {...this.httpAuthHeader, \"content-type\": \"application/octet-stream\"},\r\n        onUploadProgress,\r\n      })\r\n    ).data;\r\n  }\r\n\r\n  async pendingChanges(data: { sessionFormIdentifier: string }): Promise<any[]> {\r\n    return (await this.axiosInstance.get(`/UIService/PendingChanges/${data.sessionFormIdentifier}`))\r\n      .data;\r\n  }\r\n\r\n  async changes(data: {\r\n    SessionFormIdentifier: string;\r\n    Entity: string;\r\n    RowId: string;\r\n  }): Promise<any[]> {\r\n    return (\r\n      await this.axiosInstance.post(`/UIService/Changes`, {\r\n        SessionFormIdentifier: data.SessionFormIdentifier,\r\n        Entity: data.Entity,\r\n        RowId: data.RowId,\r\n      })\r\n    ).data;\r\n  }\r\n\r\n  async saveFilter(data: {\r\n    DataStructureEntityId: string;\r\n    PanelId: string;\r\n    Filter: IUIGridFilterCoreConfiguration;\r\n    IsDefault: boolean;\r\n  }): Promise<string> {\r\n    return (await this.axiosInstance.post(`/UIService/SaveFilter`, data)).data;\r\n  }\r\n\r\n  async deleteFilter(data: { filterId: string }): Promise<any[]> {\r\n    return (await this.axiosInstance.post(`/UIService/DeleteFilter`, data)).data;\r\n  }\r\n\r\n  async resetDefaultFilter(data: {\r\n    SessionFormIdentifier: string;\r\n    PanelInstanceId: string;\r\n  }): Promise<any[]> {\r\n    return (await this.axiosInstance.post(`/UIService/ResetDefaultFilter`, data)).data;\r\n  }\r\n\r\n  async setDefaultFilter(data: {\r\n    SessionFormIdentifier: string;\r\n    PanelInstanceId: string;\r\n    DataStructureEntityId: string;\r\n    PanelId: string;\r\n    Filter: IUIGridFilterCoreConfiguration;\r\n    IsDefault: boolean;\r\n  }): Promise<any[]> {\r\n    return (await this.axiosInstance.post(`/UIService/SetDefaultFilter`, data)).data;\r\n  }\r\n\r\n  async search(searchTerm: string) {\r\n    return (await this.axiosInstance.get(`/Search/${encodeURIComponent(searchTerm)}`)).data;\r\n  }\r\n\r\n  async getAboutInfo() {\r\n    return (await this.axiosInstance.get(\"/About\")).data as IAboutInfo;\r\n  }\r\n\r\n  async getMenuId(data: { LookupId: string; ReferenceId: string }): Promise<string> {\r\n    return (await this.axiosInstance.post(`/UIService/GetMenuId`, data)).data;\r\n  }\r\n\r\n  async getExcelFile(data: {\r\n    Entity: string;\r\n    Fields: IEntityExportField[];\r\n    SessionFormIdentifier: string;\r\n    RowIds: any[];\r\n    LazyLoadedEntityInput: ILazyLoadedEntityInput | undefined;\r\n  }): Promise<any> {\r\n    const response = await this.axiosInstance({\r\n      url: `/ExcelExport/GetFile`,\r\n      method: 'POST',\r\n      data: data,\r\n      responseType: 'blob',\r\n    })\r\n\r\n    const fieNameRegex = /filename=([^\\s;]*)/g\r\n\r\n    let fileName = \"export.xls\";\r\n    if (response.headers[\"content-disposition\"]) {\r\n      const headerFileName = fieNameRegex.exec(response.headers[\"content-disposition\"])?.[1]\r\n      if (headerFileName) {\r\n        fileName = headerFileName;\r\n      }\r\n    }\r\n\r\n    fileDownload(response.data, fileName);\r\n  }\r\n\r\n  async getMenuIdByReference(data: { Category: string; ReferenceId: any }): Promise<string> {\r\n    return (await this.axiosInstance.post(`/DeepLink/GetMenuId`, data)).data;\r\n  }\r\n}\r\n\r\nexport const IOrigamAPI = TypeSymbol<OrigamAPI>(\"IOrigamAPI\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { ScreenAPI } from \"modules/Screen/ScreenAPI\";\r\n\r\nexport class DataViewAPI {\r\n  constructor(\r\n    public getDataStructureEntityId: () => string,\r\n    public getEntity: () => string,\r\n    public api: () => ScreenAPI\r\n  ) {\r\n  }\r\n\r\n  *getLookupList(args: {\r\n    ColumnNames: string[];\r\n    Property: string;\r\n    Id: string;\r\n    LookupId: string;\r\n    Parameters?: { [key: string]: any };\r\n    ShowUniqueValues: boolean;\r\n    SearchText: string;\r\n    PageSize: number;\r\n    PageNumber: number;\r\n  }): any {\r\n    return yield*this.api().getLookupList({\r\n      ...args,\r\n      DataStructureEntityId: this.getDataStructureEntityId(),\r\n      Entity: this.getEntity(),\r\n    });\r\n  }\r\n}\r\n\r\nexport const IDataViewAPI = TypeSymbol<DataViewAPI>(\"IDataViewAPI\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { computed } from \"mobx\";\r\nimport { TypeSymbol } from \"dic/Container\";\r\n\r\nexport const IRowCursor = TypeSymbol<RowCursor>(\"IRowCursor\");\r\n\r\nexport class RowCursor {\r\n  constructor(private getSelectedRowId: () => string | undefined) {\r\n  }\r\n\r\n  @computed get selectedId(): string | undefined {\r\n    return this.getSelectedRowId();\r\n  }\r\n}\r\n\r\nexport const IColumnCursor = TypeSymbol<ColumnCursor>(\"IColumnCursor\");\r\n\r\nexport class ColumnCursor {\r\n  constructor(private getSelectedColumnId: () => string | undefined) {\r\n  }\r\n\r\n  @computed get selectedId(): string | undefined {\r\n    return this.getSelectedColumnId();\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { IDataTable } from \"model/entities/types/IDataTable\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { onFieldChange } from \"model/actions-ui/DataView/TableView/onFieldChange\";\r\n\r\nexport class DataViewData {\r\n  constructor(\r\n    private dataTable: () => IDataTable,\r\n    private propertyById: (id: string) => IProperty | undefined\r\n  ) {\r\n  }\r\n\r\n  getCellValue(rowId: string, propertyId: string) {\r\n    const dataTable = this.dataTable();\r\n    const property = this.propertyById(propertyId);\r\n    const row = dataTable.getRowById(rowId);\r\n    //dataTable.resolveCellText(property, value)\r\n    if (property && row) {\r\n      return dataTable.getCellValue(row, property);\r\n    } else return null;\r\n  }\r\n\r\n  getCellText(propertyId: string, value: any) {\r\n    const property = this.propertyById(propertyId);\r\n    if (property && value) {\r\n      return this.dataTable().resolveCellText(property, value);\r\n    } else return null;\r\n  }\r\n\r\n  getIsCellTextLoading(propertyId: string, value: any): boolean {\r\n    const property = this.propertyById(propertyId);\r\n    if (property && value) {\r\n      return this.dataTable().isCellTextResolving(property, value);\r\n    } else return false;\r\n  }\r\n\r\n  setNewValue(rowId: string, propertyId: string, value: any) {\r\n    const dataTable = this.dataTable();\r\n    const row = dataTable.getRowById(rowId);\r\n    const property = this.propertyById(propertyId);\r\n    if (property && row) {\r\n      onFieldChange(property)({\r\n        event: undefined,\r\n        row: row,\r\n        property: property,\r\n        value: value,\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport const IDataViewData = TypeSymbol<DataViewData>(\"IDataViewData\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { IApi } from \"model/entities/types/IApi\";\r\n\r\nexport class ScreenAPI {\r\n  constructor(\r\n    private getSessionId: () => string | undefined,\r\n    private getMenuItemId: () => string,\r\n    private api: () => IApi\r\n  ) {\r\n  }\r\n\r\n  *getLookupList(args: {\r\n    DataStructureEntityId?: string;\r\n    Entity?: string;\r\n    ColumnNames: string[];\r\n    Property: string;\r\n    Id: string;\r\n    LookupId: string;\r\n    Parameters?: { [key: string]: any };\r\n    ShowUniqueValues: boolean;\r\n    SearchText: string;\r\n    PageSize: number;\r\n    PageNumber: number;\r\n  }): any {\r\n    return yield this.api().getLookupList({\r\n      ...args,\r\n      SessionFormIdentifier: this.getSessionId(),\r\n      MenuId: this.getMenuItemId(),\r\n    });\r\n  }\r\n}\r\n\r\nexport const IScreenAPI = TypeSymbol<ScreenAPI>(\"IScreenAPI\");\r\n\r\n/*\r\nDataStructureEntityId?: string;\r\nFormSessionIdentifier?: string;\r\nEntity?: string;\r\nColumnNames: string[];\r\nProperty: string;\r\nId: string;\r\nLookupId: string;\r\nParameters?: { [key: string]: any };\r\nShowUniqueValues: boolean;\r\nSearchText: string;\r\nPageSize: number;\r\nPageNumber: number;\r\nMenuId: string;\r\n*/\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IFilter } from \"model/entities/types/IFilter\";\r\nimport { FilterSetting } from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/FilterSetting\";\r\nimport { filterTypeFromNumber } from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/Operator\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { FilterGroupManager } from \"model/entities/FilterGroupManager\";\r\nimport { LookupFilterSetting } from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/FilterSettingsLookup\";\r\nimport { IFilterGroup } from \"model/entities/types/IFilterGroup\";\r\n\r\nfunction filterJsonToFilterGroup(filterJson: any, properties: IProperty[]) {\r\n  const filters: IFilter[] = filterJson.details.map((detail: any) => {\r\n    const property = properties.find((prop) => prop.id === detail.property);\r\n    if (!property) {\r\n      return undefined;\r\n    }\r\n    const setting = property.column === \"ComboBox\"\r\n      ? new LookupFilterSetting(\r\n        filterTypeFromNumber(detail.operator, property.column),\r\n        true,\r\n        detail.value1,\r\n        detail.value2)\r\n      : new FilterSetting(\r\n        filterTypeFromNumber(detail.operator, property.column),\r\n        true,\r\n        detail.value1,\r\n        detail.value2)\r\n\r\n    return {\r\n      propertyId: detail.property,\r\n      dataType: property.column,\r\n      setting: setting,\r\n    };\r\n  });\r\n  return {\r\n    filters: filters,\r\n    id: filterJson.id,\r\n    isGlobal: filterJson.isGlobal,\r\n    name: filterJson.name,\r\n  };\r\n}\r\n\r\nexport function cloneFilterGroup(group: IFilterGroup | undefined) {\r\n  if (!group) {\r\n    return undefined;\r\n  }\r\n  const filters = group.filters.map(filter => {\r\n      return {\r\n        propertyId: filter.propertyId,\r\n        dataType: filter.dataType,\r\n        setting: filter.dataType === \"ComboBox\"\r\n          ? new LookupFilterSetting(\r\n            filter.setting.type,\r\n            filter.setting.isComplete,\r\n            filter.setting.val1,\r\n            filter.setting.val2)\r\n          : new FilterSetting(\r\n            filter.setting.type,\r\n            filter.setting.isComplete,\r\n            filter.setting.val1,\r\n            filter.setting.val2)\r\n      }\r\n    }\r\n  );\r\n  return {\r\n    filters: filters,\r\n    id: group.id,\r\n    isGlobal: group.isGlobal,\r\n    name: group.name,\r\n  };\r\n}\r\n\r\nexport function addFilterGroups(\r\n  filterGroupManager: FilterGroupManager,\r\n  properties: IProperty[],\r\n  panelConfigurationJson: any\r\n) {\r\n\r\n  filterGroupManager.filterGroups = panelConfigurationJson.filters\r\n    .map((filterJson: any) => filterJsonToFilterGroup(filterJson, properties))\r\n    .filter((group: any) => group);\r\n\r\n  if (panelConfigurationJson.initialFilter) {\r\n    filterGroupManager.defaultFilter = filterJsonToFilterGroup(\r\n      panelConfigurationJson.initialFilter,\r\n      properties\r\n    );\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IFilterGroup } from \"model/entities/types/IFilterGroup\";\r\nimport { IFilterConfiguration } from \"model/entities/types/IFilterConfiguration\";\r\nimport { action, observable } from \"mobx\";\r\nimport { IFilter } from \"model/entities/types/IFilter\";\r\nimport { IUIGridFilterFieldConfiguration, } from \"model/entities/types/IApi\";\r\nimport { filterTypeToNumber } from \"gui/Components/ScreenElements/Table/FilterSettings/HeaderControls/Operator\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { getDataStructureEntityId } from \"model/selectors/DataView/getDataStructureEntityId\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { getSessionId } from \"model/selectors/getSessionId\";\r\nimport { cloneFilterGroup } from \"xmlInterpreters/filterXml\";\r\n\r\nexport class FilterGroupManager {\r\n  ctx: any;\r\n  filterGroups: IFilterGroup[] = [];\r\n  private _defaultFilter: IFilterGroup | undefined;\r\n  @observable\r\n  selectedFilterGroup: IFilterGroup | undefined;\r\n\r\n  get isSelectedFilterGroupDefault() {\r\n    if (!this.selectedFilterGroup) {\r\n      return false;\r\n    }\r\n    return this.defaultFilter?.id === this.selectedFilterGroup?.id;\r\n  }\r\n\r\n  constructor(private filterConfiguration: IFilterConfiguration) {\r\n    this.ctx = filterConfiguration;\r\n    filterConfiguration.registerFilteringOnOffHandler(filteringOn => {\r\n      if (!filteringOn) {\r\n        this.selectedFilterGroup = undefined;\r\n      }\r\n    });\r\n  }\r\n\r\n  get filtersHidden() {\r\n    return !this.filterConfiguration.isFilterControlsDisplayed;\r\n  }\r\n\r\n  get defaultFilter(): IFilterGroup | undefined {\r\n    return this._defaultFilter;\r\n  }\r\n\r\n  set defaultFilter(value: IFilterGroup | undefined) {\r\n    this._defaultFilter = value;\r\n    this.setFilterGroup(this._defaultFilter);\r\n  }\r\n\r\n  get activeFilters() {\r\n    return this.filterConfiguration.activeFilters;\r\n  }\r\n\r\n  get noFilterActive() {\r\n    return this.activeFilters.length === 0 ||\r\n      this.activeFilters.every(filter => !filter.setting.isComplete)\r\n  }\r\n\r\n  @action.bound\r\n  setFilterGroup(filterGroup: IFilterGroup | undefined) {\r\n    this.selectedFilterGroup = cloneFilterGroup(filterGroup);\r\n    this.filterConfiguration.clearFilters();\r\n    if (this.selectedFilterGroup?.filters) {\r\n      this.filterConfiguration.setFilters(this.selectedFilterGroup.filters);\r\n    }\r\n  }\r\n\r\n  filterToServerVersion(filter: IFilter): IUIGridFilterFieldConfiguration {\r\n    return {\r\n      operator: filterTypeToNumber(filter.setting.type),\r\n      property: filter.propertyId,\r\n      value1: filter.setting.val1ServerForm,\r\n      value2: filter.setting.val2ServerForm,\r\n    };\r\n  }\r\n\r\n  getFilterGroupServerVersion(name: string, isGlobal: boolean) {\r\n    return {\r\n      details: this.activeFilters\r\n        .filter(filter => filter.setting.isComplete)\r\n        .map((filter) => this.filterToServerVersion(filter)),\r\n      id: undefined,\r\n      isGlobal: isGlobal,\r\n      name: name,\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  clearFiltersAndClose(event: any) {\r\n    this.filterConfiguration.onFilterDisplayClick(event);\r\n  }\r\n\r\n  @action.bound\r\n  async saveActiveFiltersAsNewFilterGroup(name: string, isGlobal: boolean) {\r\n    const api = getApi(this.ctx);\r\n    const filterGroupId = await api.saveFilter({\r\n      DataStructureEntityId: getDataStructureEntityId(this.ctx),\r\n      PanelId: getDataView(this.ctx).modelId,\r\n      Filter: this.getFilterGroupServerVersion(name, isGlobal),\r\n      IsDefault: false,\r\n    });\r\n    const filterGroup = {\r\n      filters: this.activeFilters,\r\n      id: filterGroupId,\r\n      isGlobal: isGlobal,\r\n      name: name\r\n    }\r\n    this.filterGroups.push(filterGroup);\r\n  }\r\n\r\n  @action.bound\r\n  async deleteFilterGroup() {\r\n    if (!this.selectedFilterGroup) {\r\n      return;\r\n    }\r\n    const api = getApi(this.ctx);\r\n    await api.deleteFilter({filterId: this.selectedFilterGroup.id});\r\n\r\n    const index = this.filterGroups.findIndex((group) => group.id === this.selectedFilterGroup?.id);\r\n    if (index > -1) {\r\n      this.filterGroups.splice(index, 1);\r\n    }\r\n    this.filterConfiguration.clearFilters();\r\n    this.selectedFilterGroup = undefined;\r\n  }\r\n\r\n  @action.bound\r\n  async resetDefaultFilterGroup() {\r\n    if (!this._defaultFilter) {\r\n      return;\r\n    }\r\n    const api = getApi(this.ctx);\r\n    await api.resetDefaultFilter({\r\n      SessionFormIdentifier: getSessionId(this.ctx),\r\n      PanelInstanceId: getDataView(this.ctx).modelInstanceId,\r\n    });\r\n    this._defaultFilter = undefined;\r\n  }\r\n\r\n  @action.bound\r\n  cancelSelectedFilter() {\r\n    this.filterConfiguration.clearFilters();\r\n    this.selectedFilterGroup = undefined;\r\n  }\r\n\r\n  @action.bound\r\n  async setSelectedFilterGroupAsDefault() {\r\n    const api = getApi(this.ctx);\r\n    await api.setDefaultFilter({\r\n      SessionFormIdentifier: getSessionId(this.ctx),\r\n      PanelInstanceId: getDataView(this.ctx).modelInstanceId,\r\n      DataStructureEntityId: getDataStructureEntityId(this.ctx),\r\n      PanelId: getDataView(this.ctx).modelId,\r\n      Filter: this.getFilterGroupServerVersion(\"DEFAULT\", false),\r\n      IsDefault: true\r\n    });\r\n  }\r\n\r\n  parent?: any;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IColumnConfiguration } from \"model/entities/TablePanelView/types/IConfigurationManager\";\r\nimport { observable } from \"mobx\";\r\nimport { AggregationType } from \"model/entities/types/AggregationType\";\r\nimport { GroupingUnit } from \"model/entities/types/GroupingUnit\";\r\n\r\nexport class TableColumnConfiguration implements IColumnConfiguration {\r\n\r\n  @observable\r\n  aggregationType: AggregationType | undefined;\r\n  @observable\r\n  groupingIndex: number = 0;\r\n  @observable\r\n  isVisible: boolean = true;\r\n  @observable\r\n  timeGroupingUnit: GroupingUnit | undefined;\r\n  @observable\r\n  width;\r\n\r\n  constructor(\r\n    public propertyId: string,\r\n    defaultWidth: number\r\n  ) {\r\n    this.width = defaultWidth;\r\n  }\r\n\r\n  deepClone(): IColumnConfiguration {\r\n    return Object.assign(Object.create(Object.getPrototypeOf(this)), this)\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IColumnConfiguration, ITableConfiguration } from \"model/entities/TablePanelView/types/IConfigurationManager\";\r\nimport { ITablePanelView } from \"model/entities/TablePanelView/types/ITablePanelView\";\r\nimport { getProperties } from \"model/selectors/DataView/getProperties\";\r\nimport { TableColumnConfiguration } from \"model/entities/TablePanelView/tableColumnConfiguration\";\r\nimport { IProperty } from \"../types/IProperty\";\r\nimport { observable } from \"mobx\";\r\nimport { Layout, parseLayout } from \"model/entities/TablePanelView/layout\";\r\n\r\nexport interface ICustomConfiguration{\r\n  name: string;\r\n  value: string\r\n}\r\n\r\nexport class TableConfiguration implements ITableConfiguration {\r\n\r\n  public static DefaultConfigId = \"default\";\r\n  public name: string | undefined;\r\n  @observable\r\n  public fixedColumnCount: number = 0;\r\n  @observable\r\n  public columnConfigurations: IColumnConfiguration[] = [];\r\n  @observable\r\n  public isActive: boolean = false;\r\n  id: string = \"\";\r\n  layout = Layout.Desktop;\r\n\r\n  private constructor() {\r\n  }\r\n\r\n  static create(\r\n    args: {\r\n      name: string | undefined,\r\n      isActive: boolean,\r\n      id: string,\r\n      fixedColumnCount: number,\r\n      columnConfigurations: IColumnConfiguration[],\r\n      layout?: string\r\n    }\r\n  ) {\r\n    const newInstance = new TableConfiguration();\r\n    newInstance.name = args.name;\r\n    newInstance.id = args.id;\r\n    newInstance.isActive = args.isActive;\r\n    newInstance.fixedColumnCount = args.fixedColumnCount ?? 0;\r\n    newInstance.columnConfigurations = args.columnConfigurations;\r\n    newInstance.layout = parseLayout(args.layout);\r\n    return newInstance;\r\n  }\r\n\r\n\r\n  static createDefault(properties: IProperty[], layout: Layout) {\r\n    const newInstance = new TableConfiguration();\r\n    newInstance.id = this.DefaultConfigId\r\n    newInstance.columnConfigurations = properties\r\n      .map(property => new TableColumnConfiguration(property.id, property.width));\r\n    newInstance.layout = layout;\r\n    return newInstance;\r\n  }\r\n\r\n  public get isGrouping() {\r\n    return this.columnConfigurations.some(columnConfig => columnConfig.groupingIndex > 0);\r\n  }\r\n\r\n  deepClone() {\r\n    const newInstance = new TableConfiguration();\r\n    newInstance.name = this.name;\r\n    newInstance.id = this.id;\r\n    newInstance.fixedColumnCount = this.fixedColumnCount;\r\n    newInstance.columnConfigurations = this.columnConfigurations\r\n      .map(columnConfiguration => columnConfiguration.deepClone());\r\n    newInstance.layout = this.layout;\r\n    return newInstance;\r\n  }\r\n\r\n  apply(tablePanelView: ITablePanelView) {\r\n    const properties = getProperties(tablePanelView);\r\n\r\n    tablePanelView.fixedColumnCount = this.fixedColumnCount;\r\n    tablePanelView.hiddenPropertyIds.clear();\r\n    tablePanelView.groupingConfiguration.clearGrouping();\r\n\r\n    for (const columnConfiguration of this.columnConfigurations) {\r\n      if (!columnConfiguration.isVisible) {\r\n        tablePanelView.setPropertyHidden(columnConfiguration.propertyId, true);\r\n      }\r\n      tablePanelView.aggregations.setType(\r\n        columnConfiguration.propertyId,\r\n        columnConfiguration.aggregationType\r\n      );\r\n      if (columnConfiguration.groupingIndex > 0) {\r\n        tablePanelView.groupingConfiguration.setGrouping(\r\n          columnConfiguration.propertyId,\r\n          columnConfiguration.timeGroupingUnit,\r\n          columnConfiguration.groupingIndex\r\n        );\r\n      }\r\n      const property = properties.find(prop => prop.id === columnConfiguration.propertyId)\r\n      if (property && columnConfiguration.width > 0) {\r\n        property.setColumnWidth(columnConfiguration.width);\r\n      }\r\n      tablePanelView.tablePropertyIds = tablePanelView.tablePropertyIds\r\n        .slice()\r\n        .sort((columnIdA, columnIdB) => {\r\n          const columnIdxA = this.columnConfigurations.findIndex(config => config.propertyId === columnIdA);\r\n          if (columnIdxA === -1) return 0;\r\n          const columnIdxB = this.columnConfigurations.findIndex(config => config.propertyId === columnIdB);\r\n          if (columnIdxB === -1) return 0;\r\n          return columnIdxA - columnIdxB;\r\n        });\r\n    }\r\n  }\r\n\r\n  sortColumnConfigurations(propertyIds: string[]) {\r\n    this.columnConfigurations = this.columnConfigurations\r\n      .slice()\r\n      .sort((configA, configB) => {\r\n        const columnIdxA = propertyIds.findIndex(id => id === configA.propertyId);\r\n        if (columnIdxA === -1) return 0;\r\n        const columnIdxB = propertyIds.findIndex(id => id === configB.propertyId);\r\n        if (columnIdxB === -1) return 0;\r\n        return columnIdxA - columnIdxB;\r\n      });\r\n  }\r\n\r\n  updateColumnWidth(propertyId: string, width: number) {\r\n    const columnConfiguration = this.columnConfigurations\r\n      .find(configuration => configuration.propertyId === propertyId);\r\n    if (columnConfiguration) {\r\n      columnConfiguration.width = width;\r\n    }\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IConfigurationManager, ITableConfiguration } from \"model/entities/TablePanelView/types/IConfigurationManager\";\r\nimport { ICustomConfiguration, TableConfiguration } from \"model/entities/TablePanelView/tableConfiguration\";\r\nimport { observable } from \"mobx\";\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { Layout } from \"model/entities/TablePanelView/layout\";\r\n\r\nexport class ConfigurationManager implements IConfigurationManager {\r\n  parent: any;\r\n\r\n  @observable.shallow\r\n  customTableConfigurations: TableConfiguration[];\r\n\r\n  @observable.shallow\r\n  defaultTableConfiguration: TableConfiguration;\r\n\r\n  customConfigurationsMap: Map<string, string>;\r\n\r\n  constructor(\r\n    customTableConfigurations: TableConfiguration[],\r\n    defaultTableConfiguration: TableConfiguration,\r\n    customConfigurations: ICustomConfiguration[],\r\n    private layout: Layout // for debugging\r\n  ) {\r\n    this.defaultTableConfiguration = defaultTableConfiguration;\r\n    this.customTableConfigurations = customTableConfigurations;\r\n    this.customConfigurationsMap = new Map(customConfigurations.map(i => [i.name, i.value]));\r\n  }\r\n\r\n  get allTableConfigurations() {\r\n    return this.defaultTableConfiguration\r\n      ? [this.defaultTableConfiguration, ...this.customTableConfigurations]\r\n      : this.customTableConfigurations;\r\n  }\r\n\r\n  get activeTableConfiguration() {\r\n    const activeTableConfiguration = this.allTableConfigurations.find(config => config.isActive)\r\n    if (activeTableConfiguration) {\r\n      return activeTableConfiguration;\r\n    } else {\r\n      this.defaultTableConfiguration.isActive = true;\r\n      return this.defaultTableConfiguration;\r\n    }\r\n  }\r\n\r\n  set activeTableConfiguration(configToActivate: TableConfiguration) {\r\n    const groupingWasActive = this.activeTableConfiguration.isGrouping;\r\n    this.replace(configToActivate);\r\n\r\n    for (const tableConfiguration of this.allTableConfigurations) {\r\n      tableConfiguration.isActive = false;\r\n    }\r\n    configToActivate.isActive = true;\r\n    const tablePanelView = getTablePanelView(this);\r\n    configToActivate.apply(tablePanelView);\r\n    if (groupingWasActive !== configToActivate.isGrouping) {\r\n      getFormScreenLifecycle(this).loadInitialData();\r\n    }\r\n  }\r\n\r\n  private replace(newConfiguration: TableConfiguration) {\r\n    const index = this.customTableConfigurations\r\n      .findIndex(config => config.id === newConfiguration.id);\r\n    if (index > -1) {\r\n      this.customTableConfigurations[index] = newConfiguration;\r\n    } else {\r\n      if (newConfiguration.id === TableConfiguration.DefaultConfigId) {\r\n        this.defaultTableConfiguration = newConfiguration;\r\n      } else {\r\n        this.customTableConfigurations.push(newConfiguration);\r\n      }\r\n    }\r\n  }\r\n\r\n  cloneAndActivate(configuration: ITableConfiguration, newName: string): void {\r\n    const newConfig = configuration.deepClone();\r\n    newConfig.name = newName;\r\n    newConfig.id = uuidv4();\r\n    this.customTableConfigurations.push(newConfig);\r\n    this.activeTableConfiguration = newConfig;\r\n  }\r\n\r\n  getCustomConfiguration(configName: string) {\r\n    return this.customConfigurationsMap.get(configName);\r\n  }\r\n\r\n  setCustomConfiguration(configName: string, configuration: string){\r\n    this.customConfigurationsMap.set(configName, configuration);\r\n  }\r\n\r\n  async deleteActiveTableConfiguration(): Promise<any> {\r\n    if (this.defaultTableConfiguration.isActive) {\r\n      return;\r\n    }\r\n    this.customTableConfigurations.remove(this.activeTableConfiguration);\r\n    this.activeTableConfiguration = this.defaultTableConfiguration;\r\n  }\r\n\r\n  *onColumnWidthChanged(propertyId: string, width: number): Generator {\r\n    if (!this.defaultTableConfiguration.isActive) {\r\n      return;\r\n    }\r\n    this.activeTableConfiguration.updateColumnWidth(propertyId, width);\r\n  }\r\n\r\n  *onColumnOrderChanged(): Generator {\r\n    if (!this.defaultTableConfiguration.isActive) {\r\n      return;\r\n    }\r\n    const tablePanelView = getTablePanelView(this);\r\n    this.activeTableConfiguration.sortColumnConfigurations(tablePanelView.tablePropertyIds);\r\n  }\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IConfigurationManager, ITableConfiguration } from \"model/entities/TablePanelView/types/IConfigurationManager\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\nimport { TableConfiguration } from \"model/entities/TablePanelView/tableConfiguration\";\r\nimport {\r\n  saveColumnConfigurations,\r\n  saveColumnConfigurationsAsync\r\n} from \"model/actions/DataView/TableView/saveColumnConfigurations\";\r\n\r\nexport class MainConfigurationManager implements IConfigurationManager {\r\n\r\n  get defaultTableConfiguration(): ITableConfiguration {\r\n    return this.activeManager.defaultTableConfiguration;\r\n  }\r\n\r\n  set defaultTableConfiguration(value: ITableConfiguration) {\r\n    this.activeManager.defaultTableConfiguration = value;\r\n  }\r\n\r\n  get customTableConfigurations(): ITableConfiguration[] {\r\n    return this.activeManager.customTableConfigurations;\r\n  }\r\n\r\n  set customTableConfigurations(value: ITableConfiguration[]) {\r\n    this.activeManager.customTableConfigurations = value;\r\n  }\r\n\r\n  constructor(\r\n    private desktopConfigurationManager: IConfigurationManager,\r\n    private mobileConfigurationManager: IConfigurationManager,\r\n  ) {\r\n    desktopConfigurationManager.parent = this;\r\n    mobileConfigurationManager.parent = this;\r\n  }\r\n\r\n  get activeManager() {\r\n    return isMobileLayoutActive(this)\r\n      ? this.mobileConfigurationManager\r\n      : this.desktopConfigurationManager;\r\n  }\r\n\r\n  get allTableConfigurations() {\r\n    return [\r\n      ...this.desktopConfigurationManager.allTableConfigurations,\r\n      ...this.mobileConfigurationManager.allTableConfigurations\r\n    ];\r\n  }\r\n\r\n  get activeTableConfiguration() {\r\n    return this.activeManager.activeTableConfiguration;\r\n  }\r\n\r\n  set activeTableConfiguration(configToActivate: TableConfiguration) {\r\n    this.activeManager.activeTableConfiguration = configToActivate;\r\n  }\r\n\r\n  cloneAndActivate(configuration: ITableConfiguration, newName: string): void {\r\n    this.activeManager.cloneAndActivate(configuration, newName);\r\n  }\r\n\r\n  getCustomConfiguration(configName: string) {\r\n    return this.desktopConfigurationManager.getCustomConfiguration(configName);\r\n  }\r\n\r\n  setCustomConfiguration(configName: string, configuration: string) {\r\n    this.desktopConfigurationManager.setCustomConfiguration(configName, configuration);\r\n  }\r\n\r\n  async deleteActiveTableConfiguration(): Promise<any> {\r\n    await this.activeManager.deleteActiveTableConfiguration();\r\n    await saveColumnConfigurationsAsync(this);\r\n  }\r\n\r\n  *onColumnWidthChanged(propertyId: string, width: number): Generator {\r\n    yield*this.activeManager.onColumnWidthChanged(propertyId, width)\r\n    yield*saveColumnConfigurations(this)();\r\n  }\r\n\r\n  *onColumnOrderChanged(): Generator {\r\n    yield*this.activeManager.onColumnOrderChanged();\r\n    yield*saveColumnConfigurations(this)();\r\n  }\r\n\r\n  parent: any;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { ConfigurationManager} from \"model/entities/TablePanelView/configurationManager\";\r\nimport { findStopping } from \"xmlInterpreters/xmlUtils\";\r\nimport { tryParseAggregationType } from \"model/entities/types/AggregationType\";\r\nimport { fixColumnWidth } from \"xmlInterpreters/screenXml\";\r\nimport { ICustomConfiguration, TableConfiguration } from \"model/entities/TablePanelView/tableConfiguration\";\r\nimport { TableColumnConfiguration } from \"model/entities/TablePanelView/tableColumnConfiguration\";\r\nimport { Layout } from \"model/entities/TablePanelView/layout\";\r\nimport { MainConfigurationManager } from \"model/entities/TablePanelView/mainConfigurationManager\";\r\n\r\nfunction makeColumnConfigurations(properties: IProperty[], tableConfigNode: any, isLazyLoading: boolean) {\r\n  const columnConfigurations: TableColumnConfiguration[] = tableConfigNode.elements\r\n    .map((element: any) => {\r\n      if (!element.attributes?.propertyId) {\r\n        return undefined;\r\n      }\r\n      const property = properties.find(prop => prop.id === element.attributes?.propertyId);\r\n      if (!property) {\r\n        return undefined;\r\n      }\r\n      return parseColumnConfigurationNode(element, property, isLazyLoading)\r\n    })\r\n    .filter((columnConfig: any) => columnConfig);\r\n  const parsedColumnConfigurationIds = columnConfigurations.map(columnConfig => columnConfig.propertyId);\r\n\r\n  const newColumnConfigurations = properties\r\n    .filter(property => !parsedColumnConfigurationIds.includes(property.id))\r\n    .map(property => new TableColumnConfiguration(property.id, property.width));\r\n  return columnConfigurations.concat(newColumnConfigurations);\r\n}\r\n\r\nexport function createConfigurationManager(configurationNodes: any, properties: IProperty[], isLazyLoading: boolean) {\r\n\r\n  const desktopConfigurationManager = createConfigurationManagerForLayout(\r\n    configurationNodes, properties, isLazyLoading, Layout.Desktop\r\n  );\r\n  const mobileConfigurationManager = createConfigurationManagerForLayout(\r\n    configurationNodes, properties, isLazyLoading, Layout.Mobile\r\n  );\r\n  return new MainConfigurationManager(desktopConfigurationManager, mobileConfigurationManager);\r\n}\r\n\r\nexport function createConfigurationManagerForLayout(configurationNodes: any, properties: IProperty[], isLazyLoading: boolean, layout: Layout) {\r\n  const defaultConfiguration = TableConfiguration.createDefault(properties, layout);\r\n  if (configurationNodes.length === 0) {\r\n    return new ConfigurationManager(\r\n      [], defaultConfiguration, [], layout);\r\n  } else if (configurationNodes.length > 1) {\r\n    throw new Error(\"Can not process more than one configuration node\")\r\n  }\r\n\r\n  const tableConfigurationNodes = findStopping(configurationNodes[0], (n) => n.name === \"tableConfigurations\")?.[0]?.elements;\r\n  const customConfigurations = layout === Layout.Desktop\r\n    ? parseCustomConfigurations(configurationNodes[0])\r\n    : [];\r\n  if (!tableConfigurationNodes) {\r\n    return new ConfigurationManager(\r\n      [], defaultConfiguration, customConfigurations, layout);\r\n  }\r\n  const tableConfigurations: TableConfiguration[] = tableConfigurationNodes\r\n    .map((tableConfigNode: any) => {\r\n        return TableConfiguration.create(\r\n          {\r\n            name: tableConfigNode.attributes.name,\r\n            id: tableConfigNode.attributes.id,\r\n            isActive: tableConfigNode.attributes.isActive === \"true\",\r\n            fixedColumnCount: parseIntOrZero(tableConfigNode.attributes.fixedColumnCount),\r\n            columnConfigurations: makeColumnConfigurations(properties, tableConfigNode, isLazyLoading),\r\n            layout: tableConfigNode.attributes.layout\r\n          }\r\n        )\r\n      }\r\n    )\r\n    .filter((tabConfig: TableConfiguration) => tabConfig.layout === layout);\r\n\r\n  const defaultTableConfiguration = tableConfigurations.find(tableConfig => tableConfig.name === \"\")\r\n    ?? defaultConfiguration;\r\n\r\n  const noConfigIsActive = tableConfigurations.every(tableConfig => !tableConfig.isActive);\r\n  if (noConfigIsActive) {\r\n    defaultTableConfiguration.isActive = true;\r\n  }\r\n\r\n  return new ConfigurationManager(\r\n    tableConfigurations\r\n      .filter((tableConfig: TableConfiguration) => tableConfig !== defaultTableConfiguration),\r\n    defaultTableConfiguration,\r\n    customConfigurations,\r\n    layout\r\n  );\r\n}\r\n\r\nfunction parseColumnConfigurationNode(columnConfigNode: any, property: IProperty, isLazyLoading: boolean) {\r\n  const tableConfiguration = new TableColumnConfiguration(property.id, property.width);\r\n  tableConfiguration.width = fixColumnWidth(parseInt(columnConfigNode.attributes.width));\r\n\r\n  if (columnConfigNode.attributes.isVisible === \"false\" || tableConfiguration.width < 0) {\r\n    tableConfiguration.isVisible = false;\r\n  }\r\n  tableConfiguration.aggregationType = tryParseAggregationType(columnConfigNode.attributes.aggregationType);\r\n\r\n  // It is possible that the configuration will contain grouping by detached field if the same screen is referenced by two\r\n  // menu items. One opens it as lazy loaded the other as eager loaded.\r\n  if (!isLazyLoading || property.fieldType !== \"DetachedField\") {\r\n    tableConfiguration.groupingIndex = parseIntOrZero(columnConfigNode.attributes.groupingIndex);\r\n    tableConfiguration.timeGroupingUnit = isNaN(parseInt(columnConfigNode.attributes.groupingUnit))\r\n      ? undefined\r\n      : parseInt(columnConfigNode.attributes.groupingUnit)\r\n  }\r\n  return tableConfiguration;\r\n}\r\n\r\nfunction parseIntOrZero(value: string): number {\r\n  const intValue = parseInt(value, 10);\r\n  return isNaN(intValue) ? 0 : intValue;\r\n}\r\n\r\nfunction parseCustomConfigurations(configurationNode: any): ICustomConfiguration[] {\r\n  const customConfigurationNodes = findStopping(configurationNode, (n) => n.name === \"customConfigurations\")\r\n    ?.[0]?.elements\r\n    ?.[0]?.elements;\r\n  if (!customConfigurationNodes) {\r\n    return [];\r\n  }\r\n  return customConfigurationNodes\r\n    .map((customConfigNode: any) => {\r\n      const config = customConfigNode.elements[0]?.text ?? \"\";\r\n      const decodedConfig = decodeURIComponent(encodeURIComponent(window.atob(config)))\r\n      return{\r\n        name: customConfigNode.name.replace(\"Configuration\", \"\"),\r\n        value: decodedConfig\r\n      }\r\n    });\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { DataViewLifecycle } from \"model/entities/DataViewLifecycle/DataViewLifecycle\";\r\nimport { LookupLoader } from \"model/entities/LookupLoader\";\r\nimport { RowState } from \"model/entities/RowState\";\r\nimport { Action } from \"model/entities/Action\";\r\nimport { ActionParameter } from \"model/entities/ActionParameter\";\r\nimport { ComponentBinding, ComponentBindingPair } from \"model/entities/ComponentBinding\";\r\nimport { DataSource } from \"model/entities/DataSource\";\r\nimport { DataSourceField } from \"model/entities/DataSourceField\";\r\nimport { DataTable } from \"model/entities/DataTable\";\r\nimport { DataView } from \"model/entities/DataView\";\r\nimport { DropDownColumn } from \"model/entities/DropDownColumn\";\r\nimport { FilterConfiguration } from \"model/entities/FilterConfiguration\";\r\nimport { FormPanelView } from \"model/entities/FormPanelView/FormPanelView\";\r\nimport { FormScreen } from \"model/entities/FormScreen\";\r\nimport { Lookup } from \"model/entities/Lookup\";\r\nimport { OrderingConfiguration } from \"model/entities/OrderingConfiguration\";\r\nimport { Property } from \"model/entities/Property\";\r\nimport { ColumnConfigurationModel } from \"model/entities/TablePanelView/ColumnConfigurationModel\";\r\nimport { TablePanelView } from \"model/entities/TablePanelView/TablePanelView\";\r\nimport { IComponentBinding } from \"model/entities/types/IComponentBinding\";\r\nimport { IFormScreenLifecycle02 } from \"model/entities/types/IFormScreenLifecycle\";\r\nimport { IPanelViewType } from \"model/entities/types/IPanelViewType\";\r\nimport { findActions, findFormPropertyIds, findFormRoot, findParameters, findStopping, findUIRoot } from \"./xmlUtils\";\r\nimport { GroupingConfiguration } from \"model/entities/GroupingConfiguration\";\r\nimport { ServerSideGrouper } from \"model/entities/ServerSideGrouper\";\r\nimport { ClientSideGrouper } from \"model/entities/ClientSideGrouper\";\r\nimport $root from \"rootContainer\";\r\nimport { SCOPE_Screen } from \"modules/Screen/ScreenModule\";\r\nimport { SCOPE_DataView } from \"modules/DataView/DataViewModule\";\r\nimport { scopeFor, TypeSymbol } from \"dic/Container\";\r\nimport { SCOPE_FormPerspective } from \"modules/DataView/Perspective/FormPerspective/FormPerspectiveModule\";\r\nimport { IFormPerspectiveDirector } from \"modules/DataView/Perspective/FormPerspective/FormPerspectiveDirector\";\r\nimport { SCOPE_TablePerspective } from \"modules/DataView/Perspective/TablePerspective/TablePerspectiveModule\";\r\nimport { ITablePerspectiveDirector } from \"modules/DataView/Perspective/TablePerspective/TablePerspectiveDirector\";\r\nimport { IPerspective } from \"modules/DataView/Perspective/Perspective\";\r\nimport { flow } from \"mobx\";\r\nimport { IViewConfiguration, ViewConfiguration } from \"modules/DataView/ViewConfiguration\";\r\nimport { saveColumnConfigurations } from \"model/actions/DataView/TableView/saveColumnConfigurations\";\r\nimport { IPanelConfiguration } from \"model/entities/types/IPanelConfiguration\";\r\nimport { parseToOrdering } from \"model/entities/types/IOrderingConfiguration\";\r\nimport { isInfiniteScrollingActive } from \"model/selectors/isInfiniteScrollingActive\";\r\nimport { cssString2Object } from \"utils/objects\";\r\nimport { TreeDataTable } from \"model/entities/TreeDataTable\";\r\nimport { getDataStructureEntityId } from \"model/selectors/DataView/getDataStructureEntityId\";\r\nimport { getEntity } from \"model/selectors/DataView/getEntity\";\r\nimport { DataViewAPI } from \"modules/DataView/DataViewAPI\";\r\nimport { getSelectedRowId } from \"model/selectors/TablePanelView/getSelectedRowId\";\r\nimport { IRowCursor, RowCursor } from \"modules/DataView/TableCursor\";\r\nimport { getDataViewPropertyById } from \"model/selectors/DataView/getDataViewPropertyById\";\r\nimport { DataViewData } from \"modules/DataView/DataViewData\";\r\nimport { ScreenAPI } from \"modules/Screen/ScreenAPI\";\r\nimport { getMenuItemId } from \"model/selectors/getMenuItemId\";\r\nimport { getSessionId } from \"model/selectors/getSessionId\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { getWorkbench } from \"model/selectors/getWorkbench\";\r\nimport { SCOPE_FormScreen } from \"modules/Screen/FormScreen/FormScreenModule\";\r\nimport { IOrigamAPI, OrigamAPI } from \"model/entities/OrigamAPI\";\r\nimport { IDataView as IDataViewTS } from \"modules/DataView/DataViewTypes\";\r\nimport { createIndividualLookupEngine } from \"modules/Lookup/LookupModule\";\r\nimport { IProperty } from \"model/entities/types/IProperty\";\r\nimport { SCOPE_MapPerspective } from \"modules/DataView/Perspective/MapPerspective/MapPerspectiveModule\";\r\nimport { IMapPerspectiveDirector } from \"modules/DataView/Perspective/MapPerspective/MapPerspectiveDirector\";\r\nimport {\r\n  MapLayer as MapLayerSetup,\r\n  MapSetupStore,\r\n} from \"modules/DataView/Perspective/MapPerspective/stores/MapSetupStore\";\r\nimport { MapRootStore } from \"modules/DataView/Perspective/MapPerspective/stores/MapRootStore\";\r\nimport { IFormPerspective } from \"modules/DataView/Perspective/FormPerspective/FormPerspective\";\r\nimport { addFilterGroups } from \"./filterXml\";\r\nimport { FilterGroupManager } from \"model/entities/FilterGroupManager\";\r\nimport { getGroupingConfiguration } from \"model/selectors/TablePanelView/getGroupingConfiguration\";\r\nimport { ITablePerspective } from \"modules/DataView/Perspective/TablePerspective/TablePerspective\";\r\nimport { runGeneratorInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\nimport { createConfigurationManager } from \"xmlInterpreters/createConfigurationManager\";\r\nimport { getMomentFormat, replaceDefaultDateFormats } from \"./getMomentFormat\";\r\nimport { getTablePanelView } from \"../model/selectors/TablePanelView/getTablePanelView\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\n\r\n\r\nfunction getPropertyParameters(node: any) {\r\n  const parameters = findParameters(node);\r\n  const result: { [key: string]: any } = {};\r\n  for (let p of parameters) {\r\n    result[p.attributes.Name] = p.attributes.Value;\r\n  }\r\n  return result;\r\n}\r\n\r\nconst instance2XmlNode = new WeakMap<any, any>();\r\n\r\nexport function fixColumnWidth(width: number) {\r\n  // Sometimes they send us negative width, which destroys table rendering.\r\n  if (isNaN(width)) {\r\n    return 100;\r\n  } else {\r\n    return Math.abs(width);\r\n  }\r\n}\r\n\r\nfunction parseProperty(property: any, idx: number): IProperty {\r\n  const propertyObject = new Property({\r\n    xmlNode: property,\r\n    id: property.attributes.Id,\r\n    tabIndex: property.attributes.TabIndex,\r\n    controlPropertyId: property.attributes.ControlPropertyId,\r\n    controlPropertyValue: property.attributes.ControlPropertyValue,\r\n    modelInstanceId: property.attributes.ModelInstanceId || \"\",\r\n    name: property.attributes.Name,\r\n    readOnly: property.attributes.ReadOnly === \"true\",\r\n    x: parseInt(property.attributes.X, 10),\r\n    y: parseInt(property.attributes.Y, 10),\r\n    width: parseInt(property.attributes.Width, 10),\r\n    height: parseInt(property.attributes.Height, 10),\r\n    captionLength: parseInt(property.attributes.CaptionLength, 10),\r\n    captionPosition: property.attributes.CaptionPosition,\r\n    entity: property.attributes.Entity,\r\n    column: property.attributes.Column,\r\n    parameters: getPropertyParameters(property),\r\n    dock: property.attributes.Dock,\r\n    multiline: property.attributes.Multiline === \"true\",\r\n    isPassword: property.attributes.IsPassword === \"true\",\r\n    isRichText: property.attributes.IsRichText === \"true\",\r\n    autoSort: property.attributes.AutoSort === \"true\",\r\n    maxLength: parseInt(property.attributes.MaxLength, 10),\r\n    modelFormatterPattern: replaceDefaultDateFormats(property.attributes.FormatterPattern),\r\n    formatterPattern: property.attributes.FormatterPattern\r\n      ? getMomentFormat(property)\r\n      : \"\",\r\n    customNumericFormat: property.attributes.CustomNumericFormat,\r\n    identifier: property.attributes.Identifier,\r\n    gridColumnWidth: property.attributes.GridColumnWidth\r\n      ? parseInt(property.attributes.GridColumnWidth)\r\n      : 100,\r\n    columnWidth: fixColumnWidth(\r\n      property.attributes.GridColumnWidth ? parseInt(property.attributes.GridColumnWidth) : 100\r\n    ),\r\n    suppressEmptyColumns: property.attributes.SuppressEmptyColumns === \"true\",\r\n    lookupId: property.attributes.LookupId,\r\n    lookup: !property.attributes.LookupId\r\n      ? undefined\r\n      : new Lookup({\r\n        dropDownShowUniqueValues: property.attributes.DropDownShowUniqueValues === \"true\",\r\n        lookupId: property.attributes.LookupId,\r\n        identifier: property.attributes.Identifier,\r\n        identifierIndex: parseInt(property.attributes.IdentifierIndex, 10),\r\n        dropDownType: property.attributes.DropDownType,\r\n        cached: property.attributes.Cached === \"true\",\r\n        searchByFirstColumnOnly: property.attributes.SearchByFirstColumnOnly === \"true\",\r\n        dropDownColumns: findStopping(property, (n) => n.name === \"Property\").map(\r\n          (ddProperty) => {\r\n            return new DropDownColumn({\r\n              id: ddProperty.attributes.Id,\r\n              name: ddProperty.attributes.Name,\r\n              column: ddProperty.attributes.Column,\r\n              entity: ddProperty.attributes.Entity,\r\n              index: parseInt(ddProperty.attributes.Index, 10),\r\n            });\r\n          }\r\n        ),\r\n        dropDownParameters: findStopping(\r\n          property,\r\n          (n) => n.name === \"ComboBoxParameterMapping\"\r\n        ).map((ddParam) => {\r\n          return {\r\n            parameterName: ddParam.attributes.ParameterName,\r\n            fieldName: ddParam.attributes.FieldName,\r\n          };\r\n        }),\r\n      }),\r\n\r\n    allowReturnToForm: property.attributes.AllowReturnToForm === \"true\",\r\n    isTree: property.attributes.IsTree === \"true\",\r\n    isAggregatedColumn: property.attributes.Aggregated || false,\r\n    isLookupColumn: property.attributes.IsLookupColumn || false,\r\n    style: cssString2Object(property.attributes.Style),\r\n    toolTip: property.elements.find((child: any) => child.name === \"ToolTip\")?.elements?.[0]?.text,\r\n    supportsServerSideSorting: property.attributes.SupportsServerSideSorting === \"true\",\r\n    fieldType: property.attributes.FieldType\r\n  });\r\n  if (property.elements && property.elements.length > 0) {\r\n    property.elements\r\n      .filter((element: any) => element.name === \"Property\")\r\n      .map((childProperty: any, idx: number) => parseProperty(childProperty, idx))\r\n      .forEach((childProperty: IProperty) => {\r\n        childProperty.parent = propertyObject;\r\n        childProperty.x = childProperty.x + propertyObject.x;\r\n        childProperty.y = propertyObject.y;\r\n        propertyObject.childProperties.push(childProperty);\r\n      });\r\n  }\r\n  return propertyObject;\r\n}\r\n\r\nexport function*interpretScreenXml(\r\n  screenDoc: any,\r\n  formScreenLifecycle: IFormScreenLifecycle02,\r\n  panelConfigurationsRaw: any,\r\n  lookupMenuMappings: any,\r\n  sessionId: string,\r\n  workflowTaskId: string | null,\r\n  isLazyLoading: boolean\r\n) {\r\n  const workbench = getWorkbench(formScreenLifecycle);\r\n  const $workbench = scopeFor(workbench);\r\n  const panelConfigurations = new Map<string, IPanelConfiguration>(\r\n    panelConfigurationsRaw.map((pcr: any) => [\r\n      pcr.panel.instanceId,\r\n      {\r\n        position: pcr.position,\r\n        defaultOrdering: parseToOrdering(pcr.defaultSort),\r\n      },\r\n    ])\r\n  );\r\n\r\n  const dataSourcesXml = findStopping(screenDoc, (n) => n.name === \"DataSources\")[0];\r\n\r\n  const windowXml = findStopping(screenDoc, (n) => n.name === \"Window\")[0];\r\n\r\n  const dataViews = findStopping(\r\n    screenDoc,\r\n    (n) =>\r\n      (n.name === \"UIElement\" || n.name === \"UIRoot\") &&\r\n      (n.attributes.Type === \"Grid\" ||\r\n        n.attributes.Type === \"TreePanel\" ||\r\n        n.attributes.Type === \"SectionLevelPlugin\")\r\n  );\r\n\r\n  checkInfiniteScrollWillWork(dataViews, formScreenLifecycle, panelConfigurations);\r\n\r\n  function panelViewFromNumber(pvn: number) {\r\n    switch (pvn) {\r\n      case 1:\r\n      default:\r\n        return IPanelViewType.Table;\r\n      case 0:\r\n        return IPanelViewType.Form;\r\n      case 5:\r\n        return IPanelViewType.Map;\r\n    }\r\n  }\r\n\r\n  const xmlComponentBindings = findStopping(\r\n    screenDoc,\r\n    (n) => n.name === \"Binding\" && n.parent.name === \"ComponentBindings\"\r\n  );\r\n\r\n  const screenAPI = new ScreenAPI(\r\n    () => getSessionId(scr),\r\n    () => getMenuItemId(scr),\r\n    () => getApi(scr)\r\n  );\r\n\r\n  const componentBindings: IComponentBinding[] = [];\r\n\r\n  for (let xmlBinding of xmlComponentBindings) {\r\n    let existingBinding = componentBindings.find(\r\n      (item) =>\r\n        item.parentId === xmlBinding.attributes.ParentId &&\r\n        item.childId === xmlBinding.attributes.ChildId\r\n    );\r\n    const componentBindingPair = new ComponentBindingPair({\r\n      parentPropertyId: xmlBinding.attributes.ParentProperty,\r\n      childPropertyId: xmlBinding.attributes.ChildProperty,\r\n    });\r\n    if (existingBinding) {\r\n      existingBinding.bindingPairs.push(componentBindingPair);\r\n    } else {\r\n      componentBindings.push(\r\n        new ComponentBinding({\r\n          parentId: xmlBinding.attributes.ParentId,\r\n          childId: xmlBinding.attributes.ChildId,\r\n          parentEntity: xmlBinding.attributes.ParentEntity,\r\n          childEntity: xmlBinding.attributes.ChildEntity,\r\n          bindingPairs: [componentBindingPair],\r\n          childPropertyType: xmlBinding.attributes.ChildPropertyType,\r\n        })\r\n      );\r\n    }\r\n  }\r\n\r\n  const foundLookupIds = new Set<string>();\r\n  const uiRoot = findUIRoot(windowXml);\r\n\r\n  const scr = new FormScreen({\r\n    title: windowXml.attributes.Title,\r\n    uiRootType: uiRoot.attributes.Type,\r\n    menuId: windowXml.attributes.MenuId,\r\n    dynamicTitleSource: screenDoc.elements[0].attributes.DynamicFormLabelSource,\r\n    sessionId,\r\n    autoWorkflowNext: screenDoc.elements[0].attributes.AutoWorkflowNext === \"true\",\r\n    openingOrder: 0,\r\n    suppressSave: windowXml.attributes.SuppressSave === \"true\",\r\n    suppressRefresh: windowXml.attributes.SuppressRefresh === \"true\",\r\n    showInfoPanel: windowXml.attributes.ShowInfoPanel === \"true\",\r\n    showWorkflowNextButton: windowXml.attributes.ShowWorkflowNextButton === \"true\",\r\n    showWorkflowCancelButton: windowXml.attributes.ShowWorkflowCancelButton === \"true\",\r\n    autoRefreshInterval: parseInt(windowXml.attributes.AutoRefreshInterval, 10),\r\n    refreshOnFocus: windowXml.attributes.RefreshOnFocus === \"true\",\r\n    cacheOnClient: windowXml.attributes.CacheOnClient === \"true\",\r\n    autoSaveOnListRecordChange: windowXml.attributes.AutoSaveOnListRecordChange === \"true\",\r\n    requestSaveAfterUpdate: windowXml.attributes.RequestSaveAfterUpdate === \"true\",\r\n    screenUI: screenDoc,\r\n    workflowTaskId: workflowTaskId,\r\n    panelConfigurations,\r\n    formScreenLifecycle,\r\n    // isSessioned: windowXml.attributes.UseSession,\r\n    dataSources: dataSourcesXml.elements.map((dataSource: any) => {\r\n      return new DataSource({\r\n        rowState: new RowState({}),\r\n        entity: dataSource.attributes.Entity,\r\n        dataStructureEntityId: dataSource.attributes.DataStructureEntityId,\r\n        identifier: dataSource.attributes.Identifier,\r\n        lookupCacheKey: dataSource.attributes.LookupCacheKey,\r\n        fields: findStopping(dataSource, (n) => n.name === \"Field\").map((field) => {\r\n          return new DataSourceField({\r\n            index: parseInt(field.attributes.Index, 10),\r\n            name: field.attributes.Name,\r\n          });\r\n        }),\r\n      });\r\n    }),\r\n\r\n    dataViews: dataViews.map((dataView, i) => {\r\n      const configuration = findStopping(dataView, (n) => n.name === \"Configuration\");\r\n\r\n      const properties = findStopping(dataView, (n) => n.name === \"Property\").map(parseProperty);\r\n\r\n      const formPropertyIds = new Set(findFormPropertyIds(dataView));\r\n      for (let prop of properties) {\r\n        if (formPropertyIds.has(prop.id)) {\r\n          prop.isFormField = true;\r\n        }\r\n      }\r\n\r\n      const actions = findActions(dataView).map(\r\n        (action) =>\r\n          new Action({\r\n            id: action.attributes.Id,\r\n            caption: action.attributes.Caption,\r\n            groupId: action.attributes.GroupId,\r\n            type: action.attributes.Type,\r\n            iconUrl: action.attributes.IconUrl,\r\n            mode: action.attributes.Mode,\r\n            isDefault: action.attributes.IsDefault === \"true\",\r\n            placement: action.attributes.Placement,\r\n            confirmationMessage: action.attributes.ConfirmationMessage,\r\n            parameters: findParameters(action).map(\r\n              (parameter) =>\r\n                new ActionParameter({\r\n                  name: parameter.attributes.Name,\r\n                  fieldName: parameter.attributes.FieldName,\r\n                })\r\n            ),\r\n          })\r\n      );\r\n      const defaultOrderings = panelConfigurations.get(dataView.attributes.ModelInstanceId)\r\n        ?.defaultOrdering;\r\n      if (defaultOrderings) {\r\n        for (let ordering of defaultOrderings) {\r\n          ordering.lookupId = properties.find((prop) => prop.id === ordering.columnId)?.lookupId;\r\n        }\r\n      }\r\n\r\n      const orderingConfiguration = new OrderingConfiguration(defaultOrderings);\r\n      const implicitFilters = getImplicitFilters(dataView);\r\n\r\n      const filterConfiguration = new FilterConfiguration(implicitFilters);\r\n      const filterGroupManager = new FilterGroupManager(filterConfiguration);\r\n      panelConfigurationsRaw\r\n        .filter((conf: any) => conf.panel.instanceId === dataView.attributes.ModelInstanceId)\r\n        .forEach((conf: any) => addFilterGroups(filterGroupManager, properties, conf));\r\n\r\n      const dataViewInstance: DataView = new DataView({\r\n        isFirst: i === 0,\r\n        id: dataView.attributes.Id,\r\n        attributes: dataView.attributes,\r\n        type: dataView.attributes.Type,\r\n        modelInstanceId: dataView.attributes.ModelInstanceId,\r\n        name: dataView.attributes.Name,\r\n        modelId: dataView.attributes.ModelId,\r\n        newRecordView: dataView.attributes.NewRecordView,\r\n        defaultPanelView: panelViewFromNumber(parseInt(dataView.attributes.DefaultPanelView)),\r\n        activePanelView: panelViewFromNumber(parseInt(dataView.attributes.DefaultPanelView)),\r\n        isMapSupported: dataView.attributes.IsMapSupported === \"true\",\r\n        isHeadless: dataView.attributes.IsHeadless === \"true\",\r\n        disableActionButtons: dataView.attributes.DisableActionButtons === \"true\",\r\n        showAddButton: dataView.attributes.ShowAddButton === \"true\",\r\n        showDeleteButton: dataView.attributes.ShowDeleteButton === \"true\",\r\n        showSelectionCheckboxesSetting: dataView.attributes.ShowSelectionCheckboxes === \"true\",\r\n        isGridHeightDynamic: dataView.attributes.IsGridHeightDynamic === \"true\",\r\n        selectionMember: dataView.attributes.SelectionMember,\r\n        orderMember: dataView.attributes.OrderMember,\r\n        isDraggingEnabled: dataView.attributes.IsDraggingEnabled === \"true\",\r\n        entity: dataView.attributes.Entity,\r\n        dataMember: dataView.attributes.DataMember,\r\n        isRootGrid: dataView.attributes.IsRootGrid === \"true\",\r\n        isRootEntity: dataView.attributes.IsRootEntity === \"true\",\r\n        isPreloaded: dataView.attributes.IsPreloaded === \"true\",\r\n        requestDataAfterSelectionChange:\r\n          dataView.attributes.RequestDataAfterSelectionChange === \"true\",\r\n        confirmSelectionChange: dataView.attributes.ConfirmSelectionChange === \"true\",\r\n        formViewUI: findFormRoot(dataView),\r\n        dataTable:\r\n          dataView.attributes.Type === \"TreePanel\"\r\n            ? new TreeDataTable(\r\n              dataView.attributes.IdProperty,\r\n              dataView.attributes.ParentIdProperty\r\n            )\r\n            : new DataTable({\r\n              formScreenLifecycle: formScreenLifecycle,\r\n              dataViewAttributes: dataView.attributes,\r\n              orderingConfiguration: orderingConfiguration,\r\n              filterConfiguration: filterConfiguration,\r\n            }),\r\n        serverSideGrouper: new ServerSideGrouper(),\r\n        lifecycle: new DataViewLifecycle(),\r\n        tablePanelView: new TablePanelView({\r\n          tablePropertyIds: properties.slice(1).map((prop) => prop.id),\r\n          columnConfigurationModel: new ColumnConfigurationModel(),\r\n          filterConfiguration: filterConfiguration,\r\n          filterGroupManager: filterGroupManager,\r\n          orderingConfiguration: orderingConfiguration,\r\n          groupingConfiguration: new GroupingConfiguration(),\r\n          rowHeight: 25,\r\n        }),\r\n        formPanelView: new FormPanelView(),\r\n        lookupLoader: new LookupLoader(),\r\n        properties,\r\n        actions,\r\n        clientSideGrouper: new ClientSideGrouper(),\r\n        dataViewData: new DataViewData(\r\n          () => dataViewInstance.dataTable,\r\n          (propId) => getDataViewPropertyById(dataViewInstance, propId)\r\n        ),\r\n        dataViewRowCursor: new RowCursor(() => getSelectedRowId(dataViewInstance)),\r\n        dataViewApi: new DataViewAPI(\r\n          () => getDataStructureEntityId(dataViewInstance),\r\n          () => getEntity(dataViewInstance),\r\n          () => screenAPI\r\n        ),\r\n      });\r\n\r\n      instance2XmlNode.set(dataViewInstance, dataView);\r\n\r\n      const gridConfigurationNodes = configuration.filter(\r\n        (node) => node?.parent?.attributes?.Type === \"Grid\" || node?.parent?.attributes?.Type === \"SectionLevelPlugin\"\r\n      );\r\n      const configurationNode =\r\n        gridConfigurationNodes.length === 1 ? gridConfigurationNodes[0] : undefined;\r\n      if (configurationNode) {\r\n        const defaultView = findStopping(\r\n          configurationNode,\r\n          (n) => n.name === \"view\" && n.parent.name === \"defaultView\"\r\n        );\r\n        defaultView.forEach((element) => {\r\n          if (!dataViewInstance.isHeadless && element.attributes.id.length <= 2) {\r\n            dataViewInstance.activePanelView = element.attributes.id;\r\n          }\r\n        });\r\n      }\r\n      const configurationManager = createConfigurationManager(\r\n        gridConfigurationNodes,\r\n        dataViewInstance.tablePanelView.tableProperties,\r\n        isLazyLoading\r\n      );\r\n      dataViewInstance.tablePanelView.configurationManager = configurationManager;\r\n      configurationManager.parent = dataViewInstance.tablePanelView;\r\n      properties\r\n        .filter((prop) => prop.gridColumnWidth < 0)\r\n        .forEach((prop) => {\r\n          prop.gridColumnWidth = Math.abs(prop.gridColumnWidth);\r\n          prop.width = Math.abs(prop.width);\r\n          dataViewInstance.tablePanelView.setPropertyHidden(prop.id, true);\r\n          const conf = configurationManager.defaultTableConfiguration.columnConfigurations.find(\r\n            (item) => item.propertyId === prop.id\r\n          );\r\n          if (conf) {\r\n            conf.isVisible = false;\r\n          }\r\n        });\r\n\r\n\r\n      lookupMenuMappings.forEach((mapping: any) => {\r\n        if (mapping.lookupId && (mapping.menuId || mapping.dependsOnValue)) {\r\n          properties.forEach((property) => {\r\n            if (property.lookup && property.lookup.lookupId === mapping.lookupId) {\r\n              property.linkToMenuId = mapping.menuId;\r\n              property.linkDependsOnValue = mapping.dependsOnValue;\r\n            }\r\n          });\r\n        }\r\n      });\r\n\r\n      // COLUMN ORDER\r\n\r\n      return dataViewInstance;\r\n    }),\r\n    componentBindings: [],\r\n  });\r\n\r\n  for (let xmlBinding of xmlComponentBindings) {\r\n    let existingBinding = scr.componentBindings.find(\r\n      (item) =>\r\n        item.parentId === xmlBinding.attributes.ParentId &&\r\n        item.childId === xmlBinding.attributes.ChildId\r\n    );\r\n    const componentBindingPair = new ComponentBindingPair({\r\n      parentPropertyId: xmlBinding.attributes.ParentProperty,\r\n      childPropertyId: xmlBinding.attributes.ChildProperty,\r\n    });\r\n    if (existingBinding) {\r\n      existingBinding.bindingPairs.push(componentBindingPair);\r\n    } else {\r\n      const cb = new ComponentBinding({\r\n        parentId: xmlBinding.attributes.ParentId,\r\n        childId: xmlBinding.attributes.ChildId,\r\n        parentEntity: xmlBinding.attributes.ParentEntity,\r\n        childEntity: xmlBinding.attributes.ChildEntity,\r\n        bindingPairs: [componentBindingPair],\r\n        childPropertyType: xmlBinding.attributes.ChildPropertyType,\r\n      });\r\n      scr.componentBindings.push(cb);\r\n      cb.parent = scr;\r\n    }\r\n  }\r\n\r\n  const $screen = $workbench!.beginLifetimeScope(SCOPE_Screen);\r\n  const $formScreen = $screen.beginLifetimeScope(SCOPE_FormScreen);\r\n  $root.register(IOrigamAPI, () => getApi(scr) as OrigamAPI).scopedInstance(SCOPE_Screen);\r\n\r\n  const IFormScreen = TypeSymbol<FormScreen>(\"IFormScreen\");\r\n\r\n  $formScreen.register(IFormScreen, () => scr).scopedInstance(SCOPE_Screen);\r\n\r\n  for (let dataView of scr.dataViews) {\r\n    const $dataView = $formScreen.beginLifetimeScope(SCOPE_DataView);\r\n    $dataView.register(IDataViewTS, () => dataView as DataView).scopedInstance(SCOPE_DataView);\r\n\r\n    $dataView\r\n      .register(IRowCursor, () => new RowCursor(() => getSelectedRowId(dataView)))\r\n      .scopedInstance(SCOPE_DataView);\r\n    $dataView\r\n      .register(\r\n        IViewConfiguration,\r\n        () =>\r\n          new ViewConfiguration(\r\n            function*(perspectiveTag) {\r\n              dataView.activePanelView = perspectiveTag as any;\r\n              if(!isMobileLayoutActive(dataView)){\r\n                yield*saveColumnConfigurations(dataView)();\r\n              }\r\n            },\r\n            () => {\r\n              if (\r\n                dataView.activePanelView === IPanelViewType.Form &&\r\n                getGroupingConfiguration(dataView).isGrouping &&\r\n                isLazyLoading\r\n              ) {\r\n                return IPanelViewType.Table;\r\n              }\r\n              return dataView.activePanelView;\r\n            }\r\n          )\r\n      )\r\n      .scopedInstance(SCOPE_DataView);\r\n\r\n    $dataView.resolve(IDataViewTS);\r\n\r\n    const $tablePerspective = $dataView.beginLifetimeScope(SCOPE_TablePerspective);\r\n    $tablePerspective.resolve(ITablePerspectiveDirector).setup();\r\n    const tablePerspective = $tablePerspective.resolve(ITablePerspective);\r\n    tablePerspective.onTablePerspectiveShown = () => getTablePanelView(dataView)?.triggerOnFocusTable();\r\n\r\n    const $formPerspective = $dataView.beginLifetimeScope(SCOPE_FormPerspective);\r\n    $formPerspective.resolve(IFormPerspectiveDirector).setup();\r\n    const formPerspective = $formPerspective.resolve(IFormPerspective);\r\n    dataView.activateFormView = formPerspective.handleClick.bind(formPerspective);\r\n    dataView.activateTableView = () =>\r\n      runGeneratorInFlowWithHandler({\r\n        ctx: dataView,\r\n        generator: tablePerspective.handleToolbarBtnClick.bind(formPerspective)(),\r\n      });\r\n    dataView.isFormViewActive = () => formPerspective.isActive;\r\n    dataView.isTableViewActive = () => tablePerspective.isActive;\r\n    if (dataView.isMapSupported) {\r\n      const dataViewXmlNode = instance2XmlNode.get(dataView)!;\r\n      const rootStore = new MapRootStore(dataView);\r\n      populateMapViewSetup(rootStore.mapSetupStore, dataViewXmlNode);\r\n      //const isReadonly = dataView.properties.some((prop) => prop.readOnly);\r\n      const isReadonly = !!dataView.properties.find(\r\n        (prop) => prop.id === rootStore.mapSetupStore.mapLocationMember\r\n      )?.readOnly;\r\n      rootStore.mapSetupStore.isReadOnlyView = isReadonly;\r\n      const $mapPerspective = $dataView.beginLifetimeScope(SCOPE_MapPerspective);\r\n      const mapPerspectiveDirector = $mapPerspective.resolve(IMapPerspectiveDirector);\r\n\r\n      mapPerspectiveDirector.rootStore = rootStore;\r\n      mapPerspectiveDirector.setup();\r\n    }\r\n\r\n    //***************** */\r\n\r\n    const {lookupMultiEngine} = workbench;\r\n\r\n    dataView.properties\r\n      .flatMap((property) => [property, ...property.childProperties])\r\n      .filter((property) => property.isLookup && property.lookupId)\r\n      .forEach((property) => {\r\n        const {lookupId} = property;\r\n        foundLookupIds.add(lookupId!);\r\n        if (!lookupMultiEngine.lookupEngineById.has(lookupId!)) {\r\n          const lookupIndividualEngine = createIndividualLookupEngine(lookupId!, lookupMultiEngine);\r\n          lookupMultiEngine.lookupCleanerReloaderById.set(\r\n            lookupId!,\r\n            lookupIndividualEngine.lookupCleanerReloader\r\n          );\r\n          lookupIndividualEngine.startup();\r\n          lookupMultiEngine.lookupEngineById.set(lookupId!, lookupIndividualEngine);\r\n        }\r\n        const lookupIndividualEngine = lookupMultiEngine.lookupEngineById.get(lookupId!)!;\r\n        property.lookupEngine = lookupIndividualEngine;\r\n      });\r\n\r\n    flow($dataView.resolve(IPerspective).activateDefault)();\r\n  }\r\n\r\n  $formScreen.resolve(IFormScreen); // Hack to associate FormScreen with its scope to dispose it later.\r\n\r\n  return {formScreen: scr, foundLookupIds};\r\n}\r\n\r\nfunction getImplicitFilters(dataViewXml: any) {\r\n  const filterNodes = findStopping(dataViewXml, (node) => node.name === \"Filter\");\r\n  if (filterNodes.length === 0) {\r\n    return [];\r\n  }\r\n  return filterNodes.flatMap((node) =>\r\n    node.elements.map((element: any) => {\r\n      return {\r\n        propertyId: element.attributes.Property,\r\n        operatorCode: element.attributes.Operator,\r\n        value: element.attributes.RightSideValue,\r\n      };\r\n    })\r\n  );\r\n}\r\n\r\nfunction checkInfiniteScrollWillWork(\r\n  dataViews: any[],\r\n  formScreenLifecycle: IFormScreenLifecycle02,\r\n  panelConfigurations: Map<string, IPanelConfiguration>\r\n) {\r\n  for (let dataView of dataViews) {\r\n    const id = dataView.attributes.ModelInstanceId;\r\n    const panelConfig = panelConfigurations.get(id);\r\n    if (isInfiniteScrollingActive(formScreenLifecycle, dataView.attributes) && !panelConfig) {\r\n      throw new Error(\r\n        `Table in: ${id} has undefined default ordering while infinite scrolling is on. Make sure the underlying DataStructure has a SortSet defined.`\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nfunction populateMapViewSetup(mss: MapSetupStore, xmlNode: any) {\r\n  const attr = xmlNode.attributes;\r\n  mss.mapAzimuthMember = attr.MapAzimuthMember;\r\n  mss.mapCenterRaw = attr.MapCenter;\r\n  mss.mapColorMember = attr.MapColorMember;\r\n  mss.mapIconMember = attr.MapIconMember;\r\n  mss.mapLocationMember = attr.MapLocationMember;\r\n  mss.mapTextMember = attr.MapTextMember;\r\n  mss.textColorMember = attr.TextColorMember;\r\n  mss.textLocationMember = attr.TextLocationMember;\r\n  mss.textRotationMember = attr.TextRotationMember;\r\n  mss.mapResolutionRaw = attr.MapResolution;\r\n\r\n  const layerXmlNodes = findStopping(\r\n    xmlNode,\r\n    (node) => node.name === \"Layer\" && node.parent.name === \"MapViewLayers\"\r\n  );\r\n  for (let layerXmlNode of layerXmlNodes) {\r\n    const layerAttr = layerXmlNode.attributes;\r\n    const mls = new MapLayerSetup();\r\n    mss.layers.push(mls);\r\n    mls.defaultEnabled = layerAttr.defaultEnabled === \"true\";\r\n    mls.id = layerAttr.id;\r\n    mls.title = layerAttr.title;\r\n    mls.type = layerAttr.type;\r\n    const parameterXmlNodes = findStopping(layerXmlNode, (node) => node.name === \"Parameter\");\r\n    for (let parameterXmlnode of parameterXmlNodes) {\r\n      mls.mapLayerParameters.set(\r\n        parameterXmlnode.attributes.name,\r\n        parameterXmlnode.attributes.value\r\n      );\r\n    }\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { getTableViewProperties } from \"model/selectors/TablePanelView/getTableViewProperties\";\r\n\r\nexport function startEditingFirstCell(ctx: any) {\r\n  return function*startEditingFirstCell() {\r\n    const orderingPropertyId = getDataView(ctx)?.orderProperty?.id;\r\n    const firstProperty = getTableViewProperties(ctx)\r\n      .filter(prop => prop.id !== \"Id\" && prop.id !== orderingPropertyId)?.[0];\r\n    getTablePanelView(ctx).selectedColumnId = firstProperty?.id;\r\n    if (getTablePanelView(ctx).selectedColumnId) {\r\n      getTablePanelView(ctx).scrollToCurrentRow();\r\n      setTimeout(() => getTablePanelView(ctx).setEditing(true));\r\n    }\r\n  };\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { FormFocusManager } from \"model/entities/FormFocusManager\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\n\r\nexport function getFormFocusManager(ctx: any): FormFocusManager {\r\n  return getDataView(ctx).formFocusManager;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDataView } from \"model/entities/types/IDataView\";\r\nimport { getBindingChildren } from \"./getBindingChildren\";\r\n\r\nexport function getAllBindingChildren(ctx: any) {\r\n  const resultArray: IDataView[] = [];\r\n  getChildrenRecursive(ctx, resultArray);\r\n  return resultArray;\r\n}\r\n\r\nfunction getChildrenRecursive(ctx: any, resultArray: IDataView[]) {\r\n  const childDatViews = getBindingChildren(ctx);\r\n  for (const dataView of childDatViews) {\r\n    resultArray.push(dataView);\r\n    getChildrenRecursive(dataView, resultArray);\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { createMachine, interpret } from \"xstate\";\r\nimport { IUpdateData } from \"../types/IApi\";\r\n\r\n\r\ninterface IUpdateObjectData {\r\n  SessionFormIdentifier: string;\r\n  Entity: string;\r\n  UpdateData: IUpdateData[];\r\n}\r\n\r\ninterface IExtPromise<T> extends Promise<T> {\r\n  resolve(result?: T): void;\r\n\r\n  reject(error?: any): void;\r\n}\r\n\r\nfunction ExtPromise<T>() {\r\n  let resolveFn;\r\n  let rejectFn;\r\n  const promise = new Promise<T>((resolve, reject) => {\r\n    resolveFn = resolve;\r\n    rejectFn = reject;\r\n  });\r\n  (promise as any).resolve = resolveFn;\r\n  (promise as any).reject = rejectFn;\r\n  return promise as IExtPromise<T>;\r\n}\r\n\r\nexport class UpdateRequestAggregator {\r\n  constructor(\r\n    private api: { updateObject(data: IUpdateObjectData): Promise<any> }\r\n  ) {\r\n    this.interpreter.start();\r\n  }\r\n\r\n  registeredRequests: Array<IUpdateObjectData & { promise: IExtPromise<any>; isRunning: boolean }> = [];\r\n\r\n  itemJustEnqueued?: IUpdateObjectData & { promise: IExtPromise<any>; isRunning: boolean };\r\n\r\n  currentRequest?: IUpdateObjectData & { promise: IExtPromise<any> };\r\n\r\n  interpreter = interpret(\r\n    createMachine(\r\n      {\r\n        id: \"updateObject\",\r\n        initial: \"IDLE\",\r\n        states: {\r\n          IDLE: {\r\n            on: {\r\n              UPDATE_REQUESTED: {\r\n                actions: [\"enqueueRequest\"],\r\n                target: \"UPDATE_DEBOUNCING\",\r\n              },\r\n            },\r\n          },\r\n          UPDATE_DEBOUNCING: {\r\n            on: {\r\n              UPDATE_REQUESTED: {\r\n                actions: [\"enqueueRequest\"],\r\n                target: \"UPDATE_DEBOUNCING\",\r\n              },\r\n            },\r\n            after: {\r\n              170: \"DEQUEUE\",\r\n            },\r\n          },\r\n          DEQUEUE: {\r\n            entry: \"dequeueToCurrentRequest\",\r\n            always: \"UPDATING\",\r\n          },\r\n          UPDATING: {\r\n            initial: \"API_RUNNING\",\r\n            states: {\r\n              API_RUNNING: {\r\n                invoke: {\r\n                  src: \"apiUpdateObject\",\r\n                  onDone: \"API_RESOLVED\",\r\n                  onError: \"API_REJECTED\",\r\n                },\r\n              },\r\n              API_RESOLVED: {\r\n                entry: [\"resolveCurrentPromise\"],\r\n                type: \"final\",\r\n              },\r\n              API_REJECTED: {\r\n                entry: [\"rejectCurrentPromise\"],\r\n                type: \"final\",\r\n              },\r\n            },\r\n            on: {\r\n              UPDATE_REQUESTED: {\r\n                actions: [\"enqueueRequest\"],\r\n              },\r\n            },\r\n            onDone: [\r\n              {cond: \"hasMoreItems\", target: \"#updateObject.DEQUEUE\"},\r\n              {target: \"#updateObject.IDLE\"},\r\n            ],\r\n            exit: [\"resetCurrentRequest\"],\r\n          },\r\n        },\r\n      },\r\n      {\r\n        services: {\r\n          apiUpdateObject: (ctx, event) => {\r\n            return this.api.updateObject(this.currentRequest!);\r\n          },\r\n        },\r\n        actions: {\r\n          enqueueRequest: (ctx, event) => {\r\n            const updateObjectItem = this.mergeToQueue(event.payload);\r\n            this.itemJustEnqueued = updateObjectItem;\r\n          },\r\n          dequeueToCurrentRequest: (ctx, event) => {\r\n            const item = this.registeredRequests.shift();\r\n            this.currentRequest = item;\r\n          },\r\n          resolveCurrentPromise: (ctx, event) => {\r\n            this.currentRequest?.promise.resolve(event.data);\r\n          },\r\n          rejectCurrentPromise: (ctx, event) => {\r\n            this.currentRequest?.promise.reject(event.data);\r\n          },\r\n          resetCurrentRequest: (ctx, event) => {\r\n            this.currentRequest = undefined;\r\n          },\r\n        },\r\n        guards: {\r\n          hasMoreItems: (ctx, event) => {\r\n            return this.registeredRequests.length > 0;\r\n          },\r\n        },\r\n      }\r\n    ),\r\n    {devTools: true}\r\n  );\r\n\r\n  enqueue(data: IUpdateObjectData): Promise<any> {\r\n    this.interpreter.send({\r\n      type: \"UPDATE_REQUESTED\",\r\n      payload: data,\r\n    });\r\n    const {itemJustEnqueued} = this;\r\n    this.itemJustEnqueued = undefined;\r\n    return itemJustEnqueued!.promise;\r\n  }\r\n\r\n  mergeToQueue(data: IUpdateObjectData) {\r\n    let updateObjectItem = this.registeredRequests.find(\r\n      (item) => item.Entity === data.Entity && !item.isRunning\r\n    );\r\n    if (!updateObjectItem) {\r\n      updateObjectItem = {\r\n        SessionFormIdentifier: data.SessionFormIdentifier,\r\n        Entity: data.Entity,\r\n        UpdateData: data.UpdateData,\r\n        promise: ExtPromise(),\r\n        isRunning: false,\r\n      };\r\n      this.registeredRequests.push(updateObjectItem);\r\n    }\r\n\r\n    for (let inputRow of data.UpdateData) {\r\n      let existingRow = updateObjectItem.UpdateData.find(\r\n        (item) => item.RowId === inputRow.RowId\r\n      );\r\n      if (!existingRow) {\r\n        existingRow = {RowId: inputRow.RowId, Values: {}};\r\n        updateObjectItem.UpdateData.push(existingRow);\r\n      }\r\n      existingRow.Values = {...existingRow.Values, ...inputRow.Values};\r\n    }\r\n    return updateObjectItem;\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n\r\nimport { action } from \"mobx\";\r\nimport { showDialog } from \"model/selectors/getDialogStack\";\r\nimport { YesNoQuestion } from \"@origam/components\";\r\nimport { T } from \"utils/translation\";\r\n\r\nexport function askYesNoQuestion(ctx: any, title: string, question: string) {\r\n  return new Promise(\r\n    action((resolve: (value: boolean) => void) => {\r\n        const closeDialog = showDialog(ctx,\r\n          \"\",\r\n          <YesNoQuestion\r\n            screenTitle={title}\r\n            yesLabel={T(\"Yes\", \"button_yes\")}\r\n            noLabel={T(\"No\", \"button_no\")}\r\n            message={question}\r\n            onYesClick={() => {\r\n              closeDialog();\r\n              resolve(true);\r\n            }}\r\n            onNoClick={() => {\r\n              closeDialog();\r\n              resolve(false);\r\n            }}\r\n          />\r\n        );\r\n      }\r\n    )\r\n  );\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDataView } from \"model/entities/types/IDataView\";\r\nimport { getProperties } from \"model/selectors/DataView/getProperties\";\r\nimport { IGuiHelper, IPluginData, IPluginDataView, IPluginProperty, IPluginTableRow, } from \"@origam/plugin-interfaces\";\r\nimport { getConfigurationManager } from \"model/selectors/TablePanelView/getConfigurationManager\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { getSessionId } from \"model/selectors/getSessionId\";\r\nimport { getActivePanelView } from \"model/selectors/DataView/getActivePanelView\";\r\nimport { runGeneratorInFlowWithHandler, runInFlowWithHandler, wrapInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\nimport { askYesNoQuestion } from \"gui/Components/Dialog/DialogUtils\";\r\n\r\n\r\nexport function createPluginData(dataView: IDataView): IPluginData | undefined {\r\n  if (!dataView) {\r\n    return undefined;\r\n  }\r\n  return {\r\n    dataView: new PluginDataView(dataView),\r\n    guiHelper: new GuiHelper(dataView)\r\n  }\r\n}\r\n\r\nclass GuiHelper implements IGuiHelper {\r\n\r\n  constructor(private ctx: any) {\r\n  }\r\n\r\n  askYesNoQuestion(title: string, question: string){\r\n    return askYesNoQuestion(this.ctx, title, question);\r\n  }\r\n\r\n  runGeneratorInFlowWithHandler(generator: Generator): Promise<void> {\r\n    return runGeneratorInFlowWithHandler({ctx: this.ctx, generator: generator});\r\n  }\r\n\r\n  runInFlowWithHandler(action: (() => Promise<any>) | (() => void)) {\r\n    return runInFlowWithHandler({ctx: this.ctx, action: action});\r\n  }\r\n\r\n  wrapInFlowWithHandler(action: (() => Promise<any>) | (() => void)) {\r\n    return wrapInFlowWithHandler({ctx:this.ctx, action: action});\r\n  }\r\n}\r\n\r\nclass PluginDataView implements IPluginDataView {\r\n  properties: IPluginProperty[];\r\n\r\n  get tableRows(): IPluginTableRow[] {\r\n    return this.dataView.tableRows;\r\n  }\r\n\r\n  constructor(\r\n    private dataView: IDataView,\r\n  ) {\r\n    this.properties = getProperties(this.dataView)\r\n      .map(property => {\r\n        return{\r\n          id: property.id,\r\n          name: property.name,\r\n          type: property.column,\r\n          momentFormatterPattern: property.formatterPattern\r\n        }\r\n      });\r\n  }\r\n\r\n  async saveConfiguration(pluginName: string, configuration: string): Promise<void> {\r\n    const configurationManager = getConfigurationManager(this.dataView);\r\n    configurationManager.setCustomConfiguration(pluginName, configuration);\r\n    const customConfigurations: {[key:string]: string} = {};\r\n    customConfigurations[pluginName] = configuration;\r\n\r\n    await getApi(this.dataView).saveObjectConfiguration({\r\n      sessionFormIdentifier: getSessionId(this.dataView),\r\n      instanceId: this.dataView.modelInstanceId,\r\n      tableConfigurations: configurationManager.allTableConfigurations,\r\n      customConfigurations: customConfigurations,\r\n      defaultView: getActivePanelView(this.dataView),\r\n    });\r\n  }\r\n\r\n  getConfiguration(pluginName: string){\r\n    const configurationManager = getConfigurationManager(this.dataView);\r\n    return configurationManager.getCustomConfiguration(pluginName)\r\n  }\r\n\r\n  getCellText(row: any[], propertyId: string): any {\r\n    const property = getProperties(this.dataView).find(prop => prop.id === propertyId);\r\n    if (!property) {\r\n      throw new Error(\"Property named \\\"\" + propertyId + \"\\\" was not found\");\r\n    }\r\n    return this.dataView.dataTable.getCellText(row, property);\r\n  }\r\n\r\n  getCellValue(row: any[], propertyId: string): any {\r\n    const property = getProperties(this.dataView).find(prop => prop.id === propertyId);\r\n    if (!property) {\r\n      throw new Error(\"Property named \\\"\" + propertyId + \"\\\" was not found\");\r\n    }\r\n    return this.dataView.dataTable.getCellValue(row, property);\r\n  }\r\n\r\n  getRowId(row: IPluginTableRow) {\r\n    return Array.isArray(row)\r\n      ? this.dataView.dataTable.getRowId(row)\r\n      : row.columnLabel + row.columnValue + row.groupLevel + row.isExpanded;\r\n  }\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getLocaleFromCookie } from \"utils/cookies\";\r\nimport MessageFormat from '@messageformat/core';\r\nimport {\r\n  ILocalization,\r\n  ILocalizer,\r\n} from \"@origam/plugin-interfaces\";\r\n\r\nexport class Localizer implements ILocalizer {\r\n\r\n  private messageFormat: MessageFormat;\r\n  private defaultMessageFormat: MessageFormat;\r\n  private _activeLocalization: ILocalization | undefined;\r\n  private _defaultLocalization: ILocalization | undefined;\r\n  public locale;\r\n\r\n  get defaultLocalization(){\r\n    if(!this._defaultLocalization){\r\n     this._defaultLocalization = this.getLocalization(this.defaultLocale);\r\n    }\r\n    return this._defaultLocalization;\r\n  }\r\n  get activeLocalization(){\r\n    if(!this._activeLocalization){\r\n     this._activeLocalization = this.getLocalization(this.locale);\r\n    }\r\n    return this._activeLocalization;\r\n  }\r\n\r\n  constructor(private localizations: ILocalization[], private defaultLocale: string) {\r\n    this.locale = getLocaleFromCookie()\r\n    this.messageFormat = new MessageFormat(this.locale);\r\n    this.defaultMessageFormat = this.locale === defaultLocale\r\n      ? this.messageFormat\r\n      : new MessageFormat(this.locale);\r\n  }\r\n\r\n  private getLocalization(locale: string) {\r\n    const localeLower = locale.toLowerCase();\r\n    let localization = this.localizations.find(localization => localization.locale.toLowerCase() === localeLower);\r\n    if (!localization) {\r\n      localization = this.localizations.find(localization => localization.locale.toLowerCase() === localeLower.split(\"-\")[0]);\r\n    }\r\n    if (!localization) {\r\n      throw new Error(`Plugin localization for locale: \"${locale}\" was not found`)\r\n    }\r\n    return localization\r\n  }\r\n\r\n  public translate(key: string, parameters?: { [key: string]: any }) {\r\n    let translation = this.activeLocalization.translations[key]\r\n      ?? this.defaultLocalization.translations[key];\r\n    if (!translation) {\r\n      throw new Error(`No translation was found for: \"${key}\" `)\r\n    }\r\n\r\n    const message = this.messageFormat.compile(translation);\r\n    return parameters\r\n      ? message(parameters)\r\n      : message();\r\n  }\r\n}\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { createPluginData } from \"./PluginData\";\r\nimport React, { Fragment } from \"react\";\r\nimport { registerPlugins } from \"plugins/tools/PluginRegistration\";\r\nimport { Localizer } from \"plugins/tools/Localizer\";\r\nimport { ILocalization, IPlugin } from \"@origam/plugin-interfaces\";\r\nimport { Observer } from \"mobx-react\";\r\n\r\nconst pluginFactoryFunctions: Map<string, () => IPlugin> = new Map<string, () => IPlugin>();\r\n\r\nexport function registerPlugin(pluginName: string, factoryFunction: () => IPlugin) {\r\n  pluginFactoryFunctions.set(pluginName, factoryFunction)\r\n}\r\n\r\nregisterPlugins();\r\n\r\nexport class PluginLibrary {\r\n  pluginInstances: Map<string, IPlugin> = new Map<string, IPlugin>();\r\n\r\n  getComponent(args: { name: string, modelInstanceId: string, sessionId: string, ctx: any }): JSX.Element {\r\n    const plugin = this.get({\r\n      name: args.name,\r\n      modelInstanceId: args.modelInstanceId,\r\n      sessionId: args.sessionId\r\n    });\r\n    const dataView = getDataView(args.ctx);\r\n    const pluginData = createPluginData(dataView)\r\n    const createLocalizer = (localizations: ILocalization[]) => new Localizer(localizations, \"en-us\");\r\n    return (\r\n      <Observer>\r\n        {\r\n          () => <Fragment key={plugin.id}>{plugin.getComponent(pluginData!, createLocalizer)}</Fragment>\r\n        }\r\n      </Observer>);\r\n  }\r\n\r\n  get(args: { name: string, modelInstanceId: string, sessionId: string }): IPlugin {\r\n    if (!args.modelInstanceId) {\r\n      throw new Error(\"modelInstanceId must have a value\")\r\n    }\r\n    if (!args.sessionId) {\r\n      throw new Error(\"sessionId must have a value\")\r\n    }\r\n    if (!args.name) {\r\n      throw new Error(\"name must have a value\")\r\n    }\r\n    let pluginId = args.modelInstanceId + \"_\" + args.sessionId;\r\n    if (this.pluginInstances.has(pluginId)) {\r\n      return this.pluginInstances.get(pluginId)!;\r\n    }\r\n    const plugin = this.makePluginInstance(args.name);\r\n    plugin.id = pluginId;\r\n    this.pluginInstances.set(plugin.id, plugin);\r\n    return plugin;\r\n  }\r\n\r\n  makePluginInstance(name: string) {\r\n    if (!pluginFactoryFunctions.has(name)) {\r\n      throw new Error(`Cannot find plugin class named: ${name}`)\r\n    }\r\n    return pluginFactoryFunctions.get(name)!();\r\n  }\r\n}\r\n\r\nexport const pluginLibrary = new PluginLibrary();\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n\r\nimport { registerPlugin } from \"plugins/tools/PluginLibrary\";\r\nimport { AuditPlugin } from \"@origam/plugin-audit\";\r\nimport { FilterPlugin  } from \"@origam/plugin-filter\";\r\nimport { RadarChartPlugin  } from \"@origam/plugin-chart\";\r\nimport { FileUploadSectionPlugin } from \"origam-plugin-filepond-section\";\r\n\r\nexport function registerPlugins() {\r\n  registerPlugin(\"FilterPlugin\", () => new FilterPlugin());\r\n  registerPlugin(\"AuditPlugin\", () => new AuditPlugin());\r\n  registerPlugin(\"RadarChartPlugin\", () => new RadarChartPlugin());\r\n  registerPlugin(\"FileUploadSectionPlugin\", () => new FileUploadSectionPlugin());\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { QuestionSaveData } from \"gui/Components/Dialogs/QuestionSaveData\";\r\nimport { action, autorun, comparer, flow, observable, reaction, when } from \"mobx\";\r\nimport { new_ProcessActionResult } from \"model/actions/Actions/processActionResult\";\r\nimport { closeForm } from \"model/actions/closeForm\";\r\nimport { processCRUDResult } from \"model/actions/DataLoading/processCRUDResult\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { refreshWorkQueues } from \"model/actions/WorkQueues/refreshWorkQueues\";\r\nimport { IAction } from \"model/entities/types/IAction\";\r\nimport { getBindingParametersFromParent } from \"model/selectors/DataView/getBindingParametersFromParent\";\r\nimport { getColumnNamesToLoad } from \"model/selectors/DataView/getColumnNamesToLoad\";\r\nimport { getDataStructureEntityId } from \"model/selectors/DataView/getDataStructureEntityId\";\r\nimport { getDataViewByGridId } from \"model/selectors/DataView/getDataViewByGridId\";\r\nimport { getDataViewsByEntity } from \"model/selectors/DataView/getDataViewsByEntity\";\r\nimport { getAutorefreshPeriod as getAutoRefreshPeriod } from \"model/selectors/FormScreen/getAutorefreshPeriod\";\r\nimport { getDataViewList } from \"model/selectors/FormScreen/getDataViewList\";\r\nimport { getIsFormScreenDirty } from \"model/selectors/FormScreen/getisFormScreenDirty\";\r\nimport { getIsSuppressSave } from \"model/selectors/FormScreen/getIsSuppressSave\";\r\nimport { showDialog } from \"model/selectors/getDialogStack\";\r\nimport { getIsActiveScreen } from \"model/selectors/getIsActiveScreen\";\r\nimport { map2obj } from \"utils/objects\";\r\nimport { interpretScreenXml } from \"xmlInterpreters/screenXml\";\r\nimport { getFormScreen } from \"../../selectors/FormScreen/getFormScreen\";\r\nimport { getApi } from \"../../selectors/getApi\";\r\nimport { getMenuItemId } from \"../../selectors/getMenuItemId\";\r\nimport { getOpenedScreen } from \"../../selectors/getOpenedScreen\";\r\nimport { getSessionId } from \"../../selectors/getSessionId\";\r\nimport { IFormScreenLifecycle02 } from \"../types/IFormScreenLifecycle\";\r\nimport { IDataView } from \"../types/IDataView\";\r\nimport { IAggregationInfo } from \"../types/IAggregationInfo\";\r\nimport { SCROLL_ROW_CHUNK } from \"gui/Workbench/ScreenArea/TableView/InfiniteScrollLoader\";\r\nimport { IQueryInfo, processActionQueryInfo } from \"model/actions/Actions/processActionQueryInfo\";\r\nimport { assignIIds, find } from \"xmlInterpreters/xmlUtils\";\r\nimport { IOrderByDirection, IOrdering } from \"../types/IOrderingConfiguration\";\r\nimport { getOrderingConfiguration } from \"../../selectors/DataView/getOrderingConfiguration\";\r\nimport { getFilterConfiguration } from \"../../selectors/DataView/getFilterConfiguration\";\r\nimport { getUserFilters } from \"../../selectors/DataView/getUserFilters\";\r\nimport { getUserOrdering } from \"../../selectors/DataView/getUserOrdering\";\r\nimport { FlowBusyMonitor } from \"utils/flow\";\r\nimport { IScreenEvents } from \"modules/Screen/FormScreen/ScreenEvents\";\r\nimport { scopeFor } from \"dic/Container\";\r\nimport { getUserFilterLookups } from \"../../selectors/DataView/getUserFilterLookups\";\r\nimport _, { isArray } from \"lodash\";\r\nimport { YesNoQuestion } from \"@origam/components\";\r\nimport { getProperties } from \"model/selectors/DataView/getProperties\";\r\nimport { getWorkbench } from \"model/selectors/getWorkbench\";\r\nimport { shouldProceedToChangeRow } from \"model/actions-ui/DataView/TableView/shouldProceedToChangeRow\";\r\nimport { getGroupingConfiguration } from \"model/selectors/TablePanelView/getGroupingConfiguration\";\r\nimport { startEditingFirstCell } from \"model/actions/DataView/startEditingFirstCell\";\r\nimport { getFormFocusManager } from \"model/selectors/DataView/getFormFocusManager\";\r\nimport { getDataSourceFieldByName } from \"model/selectors/DataSources/getDataSourceFieldByName\";\r\nimport { isLazyLoading } from \"model/selectors/isLazyLoading\";\r\nimport { getAllBindingChildren } from \"model/selectors/DataView/getAllBindingChildren\";\r\nimport { getEntity } from \"model/selectors/DataView/getEntity\";\r\nimport { isInfiniteScrollingActive } from \"model/selectors/isInfiniteScrollingActive\";\r\nimport { AggregationType } from \"../types/AggregationType\";\r\nimport { calcAggregations, parseAggregations } from \"../Aggregatioins\";\r\nimport { UpdateRequestAggregator } from \"./UpdateRequestAggregator\";\r\nimport { IGroupingSettings } from \"../types/IGroupingConfiguration\";\r\nimport { groupingUnitToString } from \"../types/GroupingUnit\";\r\nimport { getTablePanelView } from \"../../selectors/TablePanelView/getTablePanelView\";\r\nimport { getFormScreenLifecycle } from \"../../selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { runGeneratorInFlowWithHandler, runInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\nimport { onFieldBlur } from \"../../actions-ui/DataView/TableView/onFieldBlur\";\r\nimport { getRowStates } from \"../../selectors/RowState/getRowStates\";\r\nimport { getIsAddButtonVisible } from \"../../selectors/DataView/getIsAddButtonVisible\";\r\nimport { pluginLibrary } from \"plugins/tools/PluginLibrary\";\r\nimport { isIScreenPlugin, isISectionPlugin } from \"@origam/plugin-interfaces\";\r\nimport { refreshRowStates } from \"model/actions/RowStates/refreshRowStates\";\r\nimport {T} from \"utils/translation\";\r\nimport { askYesNoQuestion } from \"gui/Components/Dialog/DialogUtils\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\nimport { getConfigurationManager } from \"model/selectors/TablePanelView/getConfigurationManager\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\n\r\nenum IQuestionSaveDataAnswer {\r\n  Cancel = 0,\r\n  NoSave = 1,\r\n  Save = 2,\r\n}\r\n\r\nenum IQuestionDeleteDataAnswer {\r\n  No = 0,\r\n  Yes = 1,\r\n}\r\n\r\nexport const closingScreens = new WeakSet<any>();\r\n\r\nexport class FormScreenLifecycle02 implements IFormScreenLifecycle02 {\r\n  $type_IFormScreenLifecycle: 1 = 1;\r\n\r\n  parameters: { [key: string]: string } = {};\r\n  focusedDataViewId: string | undefined;\r\n  _updateRequestAggregator: UpdateRequestAggregator | undefined;\r\n\r\n  get updateRequestAggregator() {\r\n    if (!this._updateRequestAggregator) {\r\n      this._updateRequestAggregator = new UpdateRequestAggregator(getApi(this));\r\n    }\r\n    return this._updateRequestAggregator;\r\n  }\r\n\r\n  @observable allDataViewsSteady = true;\r\n\r\n  monitor: FlowBusyMonitor = new FlowBusyMonitor();\r\n\r\n  get isWorkingDelayed() {\r\n    return this.monitor.isWorkingDelayed;\r\n  }\r\n\r\n  initialSelectedRowId: string | undefined;\r\n\r\n  get isWorking() {\r\n    return this.monitor.isWorking;\r\n  }\r\n\r\n  disposers: (() => void)[] = [];\r\n\r\n  registerDisposer(disposer: () => void) {\r\n    this.disposers.push(disposer);\r\n  }\r\n\r\n  *onFlushData(): Generator<unknown, any, unknown> {\r\n    yield*this.flushData();\r\n  }\r\n\r\n  *onCreateRow(entity: string, gridId: string): Generator<unknown, any, unknown> {\r\n    yield*this.createRow(entity, gridId);\r\n  }\r\n\r\n  *onCopyRow(entity: any, gridId: string, rowId: string): any {\r\n    yield*this.copyRow(entity, gridId, rowId);\r\n  }\r\n\r\n  *onDeleteRow(\r\n    entity: string,\r\n    rowId: string,\r\n    dataView: IDataView\r\n  ): Generator<unknown, any, unknown> {\r\n    yield*this.onRequestDeleteRow(entity, rowId, dataView);\r\n  }\r\n\r\n  *onSaveSession(): Generator<unknown, any, unknown> {\r\n    yield*this.flushData();\r\n    yield*this.saveSession();\r\n  }\r\n\r\n  *onExecuteAction(\r\n    gridId: string,\r\n    entity: string,\r\n    action: IAction,\r\n    selectedItems: string[]\r\n  ): Generator<any, any, any> {\r\n    if (action.confirmationMessage && !(yield askYesNoQuestion(this, getOpenedScreen(this).tabTitle, action.confirmationMessage))) {\r\n      return;\r\n    }\r\n    yield*this.executeAction(gridId, entity, action, selectedItems);\r\n  }\r\n\r\n  *onRequestDeleteRow(entity: string, rowId: string, dataView: IDataView): any {\r\n    if ((yield this.questionDeleteData()) === IQuestionDeleteDataAnswer.Yes) {\r\n      yield*this.deleteRow(entity, rowId, dataView);\r\n    }\r\n  }\r\n\r\n  *onRequestScreenClose(isDueToError?: boolean): Generator<unknown, any, unknown> {\r\n    const formScreen = getFormScreen(this);\r\n    for (let dataView of formScreen.dataViews) {\r\n      yield onFieldBlur(dataView)(null);\r\n    }\r\n\r\n    // Just wait if there is some data manipulation in progress.\r\n    yield formScreen.dataUpdateCRS.runAsync(() => Promise.resolve());\r\n    if (isDueToError || !getIsFormScreenDirty(this) || getIsSuppressSave(this)) {\r\n      yield*this.closeForm();\r\n      return;\r\n    }\r\n    switch (yield this.questionSaveData()) {\r\n      case IQuestionSaveDataAnswer.Cancel:\r\n        return;\r\n      case IQuestionSaveDataAnswer.Save:\r\n        const saveSuccessful = yield*this.saveSession();\r\n        if (saveSuccessful) {\r\n          yield*this.closeForm();\r\n        }\r\n        return;\r\n      case IQuestionSaveDataAnswer.NoSave:\r\n        yield*this.closeForm();\r\n        return;\r\n    }\r\n  }\r\n\r\n  *onRequestScreenReload(): Generator<unknown, any, unknown> {\r\n    if (!getIsFormScreenDirty(this) || getIsSuppressSave(this)) {\r\n      yield*this.refreshSession();\r\n      return;\r\n    }\r\n    getFormScreen(this).dataViews.forEach((dataView) => dataView.onReload());\r\n    switch (yield this.questionSaveData()) {\r\n      case IQuestionSaveDataAnswer.Cancel:\r\n        return;\r\n      case IQuestionSaveDataAnswer.Save:\r\n        yield*this.saveSession();\r\n        yield*this.refreshSession();\r\n        return;\r\n      case IQuestionSaveDataAnswer.NoSave:\r\n        if (!this.eagerLoading) {\r\n          yield*this.revertChanges();\r\n        }\r\n        yield*this.refreshSession();\r\n        return;\r\n    }\r\n  }\r\n\r\n  *revertChanges(): Generator<unknown, any, unknown> {\r\n    const api = getApi(this);\r\n    yield api.revertChanges({sessionFormIdentifier: getSessionId(this)});\r\n  }\r\n\r\n  *onWorkflowNextClick(event: any): Generator {\r\n    this.monitor.inFlow++;\r\n    try {\r\n      const api = getApi(this);\r\n      const sessionId = getSessionId(this);\r\n      const actionQueryInfo = (yield api.workflowNextQuery({\r\n        sessionFormIdentifier: sessionId,\r\n      })) as IQueryInfo[];\r\n      const formScreen = getFormScreen(this);\r\n      const processQueryInfoResult = yield*processActionQueryInfo(this)(\r\n        actionQueryInfo,\r\n        formScreen.title\r\n      );\r\n      if (!processQueryInfoResult.canContinue) return;\r\n      let uiResult;\r\n      try {\r\n        yield*formScreen.dataUpdateCRS.enterGenerator();\r\n        uiResult = yield api.workflowNext({\r\n          sessionFormIdentifier: sessionId,\r\n          CachedFormIds: [],\r\n        });\r\n      } finally {\r\n        formScreen.dataUpdateCRS.leave();\r\n      }\r\n      this.killForm();\r\n      yield*this.start(uiResult);\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  *onWorkflowAbortClick(event: any): Generator {\r\n    this.monitor.inFlow++;\r\n    try {\r\n      const api = getApi(this);\r\n      let uiResult;\r\n      const formScreen = getFormScreen(this);\r\n      try {\r\n        yield*formScreen.dataUpdateCRS.enterGenerator();\r\n        uiResult = yield api.workflowAbort({sessionFormIdentifier: getSessionId(this)});\r\n      } finally {\r\n        formScreen.dataUpdateCRS.leave();\r\n      }\r\n      this.killForm();\r\n      yield*this.start(uiResult);\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  *onWorkflowRepeatClick(event: any): Generator {\r\n    this.monitor.inFlow++;\r\n    try {\r\n      const api = getApi(this);\r\n      const sessionId = getSessionId(this);\r\n      let uiResult;\r\n      const formScreen = getFormScreen(this);\r\n      try {\r\n        yield*formScreen.dataUpdateCRS.enterGenerator();\r\n        uiResult = yield api.workflowRepeat({sessionFormIdentifier: sessionId});\r\n      } finally {\r\n        formScreen.dataUpdateCRS.leave();\r\n      }\r\n      this.killForm();\r\n      yield*this.start(uiResult);\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  *onWorkflowCloseClick(event: any): Generator {\r\n    this.monitor.inFlow++;\r\n    try {\r\n      const formScreen = getFormScreen(this);\r\n      try {\r\n        yield*formScreen.dataUpdateCRS.enterGenerator();\r\n      } finally {\r\n        formScreen.dataUpdateCRS.leave();\r\n      }\r\n      yield*this.onRequestScreenClose();\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  _autoRefreshTimerHandle: any;\r\n\r\n  *startAutoRefreshIfNeeded() {\r\n    const autoRefreshPeriod = getAutoRefreshPeriod(this);\r\n    if (autoRefreshPeriod) {\r\n      this.disposers.push(\r\n        autorun(() => {\r\n          if (\r\n            !getIsSuppressSave(this) &&\r\n            (getIsFormScreenDirty(this) || !getIsActiveScreen(this))\r\n          ) {\r\n            this.clearAutoRefreshInterval();\r\n          } else {\r\n            this._autoRefreshTimerHandle = setInterval(\r\n              () => this.performAutoReload(),\r\n              autoRefreshPeriod * 1000\r\n            );\r\n          }\r\n        })\r\n      );\r\n    }\r\n  }\r\n\r\n  clearAutoRefreshInterval() {\r\n    if (this._autoRefreshTimerHandle) {\r\n      clearInterval(this._autoRefreshTimerHandle);\r\n      this._autoRefreshTimerHandle = undefined;\r\n    }\r\n  }\r\n\r\n  performAutoReload() {\r\n    const self = this;\r\n    flow(function*() {\r\n      try {\r\n        const formScreen = getFormScreen(self);\r\n        formScreen.dataViews.forEach((dataView) => getRowStates(dataView).suppressWorkingStatus = true);\r\n        yield*self.refreshSession();\r\n      } catch (e) {\r\n        yield*handleError(self)(e);\r\n        throw e;\r\n      } finally {\r\n        const formScreen = getFormScreen(self);\r\n        formScreen.dataViews.forEach((dataView) => getRowStates(dataView).suppressWorkingStatus = false);\r\n      }\r\n    })();\r\n  }\r\n\r\n  *start(initUIResult: any): Generator {\r\n    let _steadyDebounceTimeout: any;\r\n    this.disposers.push(\r\n      reaction(\r\n        () => getFormScreen(this).dataViews.every((dv) => !dv.isWorking) && !this.isWorkingDelayed,\r\n        (allDataViewsSteady) => {\r\n          if (allDataViewsSteady) {\r\n            _steadyDebounceTimeout = setTimeout(() => {\r\n              _steadyDebounceTimeout = undefined;\r\n              this.allDataViewsSteady = true;\r\n            }, 100);\r\n          } else {\r\n            this.allDataViewsSteady = false;\r\n            if (_steadyDebounceTimeout) {\r\n              clearTimeout(_steadyDebounceTimeout);\r\n              _steadyDebounceTimeout = undefined;\r\n            }\r\n          }\r\n        }\r\n      ),\r\n      () => {\r\n        clearTimeout(_steadyDebounceTimeout);\r\n        _steadyDebounceTimeout = undefined;\r\n      }\r\n    );\r\n    try {\r\n      const openedScreen = getOpenedScreen(this);\r\n      if(!openedScreen){\r\n        return;\r\n      }\r\n      this.initialSelectedRowId = initUIResult.currentRecordId;\r\n      yield*this.applyInitUIResult({initUIResult});\r\n      this.initializePlugins(initUIResult);\r\n      if (!this.eagerLoading) {\r\n        yield*this.clearTotalCounts();\r\n        yield*this.loadData({keepCurrentData: false});\r\n        yield*this.updateTotalRowCounts();\r\n        const formScreen = getFormScreen(this);\r\n        for (let rootDataView of formScreen.rootDataViews) {\r\n          const orderingConfiguration = getOrderingConfiguration(rootDataView);\r\n          const filterConfiguration = getFilterConfiguration(rootDataView);\r\n          this.disposers.push(\r\n            reaction(\r\n              () => {\r\n                const filters = filterConfiguration.activeFilters\r\n                  .map((x) => [\r\n                    x.propertyId,\r\n                    x.setting.type,\r\n                    isArray(x.setting.val1) ? [...x.setting.val1] : x.setting.val1,\r\n                    x.setting.val2,\r\n                  ])\r\n                  .filter((item) => {\r\n                    if (\r\n                      item[1] === \"in\" ||\r\n                      item[1] === \"eq\" ||\r\n                      item[1] === \"neq\" ||\r\n                      item[1] === \"nin\" ||\r\n                      item[1] === \"neq\" ||\r\n                      item[1] === \"contains\" ||\r\n                      item[1] === \"ncontains\" ||\r\n                      item[1] === \"lt\" ||\r\n                      item[1] === \"lte\" ||\r\n                      item[1] === \"gt\" ||\r\n                      item[1] === \"gte\" ||\r\n                      item[1] === \"between\" ||\r\n                      item[1] === \"nbetween\" ||\r\n                      item[1] === \"starts\" ||\r\n                      item[1] === \"nstarts\" ||\r\n                      item[1] === \"ends\" ||\r\n                      item[1] === \"nends\"\r\n                    ) {\r\n                      return item[2] !== undefined || item[3] !== undefined;\r\n                    } else {\r\n                      return true;\r\n                    }\r\n                  });\r\n                return {\r\n                  filters,\r\n                } as any;\r\n              },\r\n              () =>\r\n                this.sortAndFilterReaction({dataView: rootDataView, updateTotalRowCount: true}),\r\n              {\r\n                equals: comparer.structural,\r\n                delay: 100,\r\n              }\r\n            )\r\n          );\r\n          this.disposers.push(\r\n            reaction(\r\n              () => orderingConfiguration.userOrderings.map((x) => [x.columnId, x.direction]),\r\n              () =>\r\n                this.sortAndFilterReaction({dataView: rootDataView, updateTotalRowCount: false}),\r\n              {\r\n                equals: comparer.structural,\r\n                delay: 100,\r\n              }\r\n            )\r\n          );\r\n        }\r\n      }\r\n    } finally {\r\n      this.initialSelectedRowId = undefined;\r\n    }\r\n    yield*this.startAutoRefreshIfNeeded();\r\n  }\r\n\r\n  private initializePlugins(initUIResult: any) {\r\n    let screenLevelPlugins = find(initUIResult.formDefinition, (node: any) => node.attributes?.Type === \"ScreenLevelPlugin\");\r\n    let sessionId = getSessionId(this);\r\n    screenLevelPlugins\r\n      .forEach(node => {\r\n        const plugin = pluginLibrary.get(\r\n          {\r\n            name: node.attributes.Name,\r\n            modelInstanceId: node.attributes.ModelInstanceId,\r\n            sessionId: sessionId\r\n          });\r\n        if (!isIScreenPlugin(plugin)) {\r\n          throw new Error(`Plugin ${node.attributes.Name} is not ScreenLevelPlugin`)\r\n        }\r\n        plugin.requestSessionRefresh = () => runGeneratorInFlowWithHandler(\r\n          {ctx: this, generator: this.refreshSession()}\r\n        );\r\n        plugin.setScreenParameters = (parameters: { [key: string]: string }) =>\r\n          Object.keys(parameters)\r\n            .forEach(key => this.parameters[key] = parameters[key]);\r\n        plugin.initialize(node.attributes);\r\n      })\r\n\r\n    find(initUIResult.formDefinition, (node: any) => node.attributes?.Type === \"SectionLevelPlugin\")\r\n      .forEach(node => {\r\n        const plugin = pluginLibrary.get(\r\n          {\r\n            name: node.attributes.Name,\r\n            modelInstanceId: node.attributes.ModelInstanceId,\r\n            sessionId: sessionId\r\n          })\r\n        if (!isISectionPlugin(plugin)) {\r\n          throw new Error(`Plugin ${node.attributes.Name} is not SectionLevelPlugin`)\r\n        }\r\n        plugin.getScreenParameters = () => _.cloneDeep(this.parameters);\r\n        plugin.initialize(node.attributes)\r\n      });\r\n  }\r\n\r\n  sortAndFilterReaction(args: { dataView: IDataView; updateTotalRowCount: boolean }) {\r\n    const self = this;\r\n    flow(function*() {\r\n      if (!(yield shouldProceedToChangeRow(args.dataView))) {\r\n        return;\r\n      }\r\n      yield args.dataView.lifecycle.runRecordChangedReaction(function*() {\r\n        const groupingConfig = getGroupingConfiguration(args.dataView);\r\n        if (groupingConfig.isGrouping) {\r\n          args.dataView.serverSideGrouper.refresh();\r\n        } else {\r\n          args.dataView.setRowCount(undefined);\r\n          yield self.readFirstChunkOfRowsWithGateDebounced(args.dataView);\r\n          yield self.updateTotalRowCount(args.dataView);\r\n        }\r\n      });\r\n    })();\r\n  }\r\n\r\n  *applyInitUIResult(args: { initUIResult: any }): any {\r\n    const openedScreen = getOpenedScreen(this);\r\n\r\n    assignIIds(args.initUIResult.formDefinition);\r\n\r\n    const {formScreen: screen, foundLookupIds} = yield*interpretScreenXml(\r\n      args.initUIResult.formDefinition,\r\n      this,\r\n      args.initUIResult.panelConfigurations,\r\n      args.initUIResult.lookupMenuMappings,\r\n      args.initUIResult.sessionId,\r\n      args.initUIResult.workflowTaskId,\r\n      openedScreen.lazyLoading\r\n    );\r\n    const api = getApi(openedScreen);\r\n    const cacheDependencies = getWorkbench(openedScreen).lookupMultiEngine.cacheDependencies;\r\n    const lookupIdsToQuery = cacheDependencies.getUnhandledLookupIds(foundLookupIds);\r\n\r\n    if (lookupIdsToQuery.size > 0) {\r\n      const dependencies = yield api.getLookupCacheDependencies({\r\n        LookupIds: Array.from(lookupIdsToQuery),\r\n      });\r\n      cacheDependencies.putValues(dependencies);\r\n    }\r\n\r\n    openedScreen.content.setFormScreen(screen);\r\n    // screen.printMasterDetailTree();\r\n    yield*this.applyData(args.initUIResult.data);\r\n\r\n    setTimeout(() => {\r\n      const fieldToSelect = getFormScreen(this).getFirstFormPropertyId();\r\n      if (fieldToSelect) {\r\n        const formScreen = getFormScreen(this);\r\n        const $formScreen = scopeFor(formScreen);\r\n        $formScreen?.resolve(IScreenEvents).focusField.trigger({propertyId: fieldToSelect});\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  async loadChildRows(dataView: IDataView, filter: string, ordering: IOrdering | undefined) {\r\n    try {\r\n      this.monitor.inFlow++;\r\n      const masterRowId =\r\n        !this.eagerLoading && !dataView.isRootGrid && dataView.bindingParent\r\n          ? dataView.bindingParent.selectedRowId\r\n          : undefined;\r\n      const api = getApi(this);\r\n      return await api.getRows({\r\n        MenuId: getMenuItemId(dataView),\r\n        SessionFormIdentifier: getSessionId(this),\r\n        DataStructureEntityId: getDataStructureEntityId(dataView),\r\n        Filter: filter,\r\n        FilterLookups: getUserFilterLookups(dataView),\r\n        Ordering: ordering ? [ordering] : [],\r\n        RowLimit: SCROLL_ROW_CHUNK,\r\n        Parameters: this.parameters,\r\n        MasterRowId: masterRowId,\r\n        RowOffset: 0,\r\n        ColumnNames: getColumnNamesToLoad(dataView),\r\n      });\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  async loadChildGroups(\r\n    rootDataView: IDataView,\r\n    filter: string,\r\n    groupingSettings: IGroupingSettings,\r\n    aggregations: IAggregationInfo[] | undefined,\r\n    lookupId: string | undefined\r\n  ) {\r\n    const ordering = {\r\n      columnId: groupingSettings.columnId,\r\n      direction: IOrderByDirection.ASC,\r\n      lookupId: lookupId,\r\n    };\r\n    try {\r\n      this.monitor.inFlow++;\r\n      const api = getApi(this);\r\n      return await api.getGroups({\r\n        MenuId: getMenuItemId(rootDataView),\r\n        SessionFormIdentifier: getSessionId(this),\r\n        DataStructureEntityId: getDataStructureEntityId(rootDataView),\r\n        Filter: filter,\r\n        FilterLookups: getUserFilterLookups(rootDataView),\r\n        Ordering: [ordering],\r\n        RowLimit: 999999,\r\n        GroupBy: groupingSettings.columnId,\r\n        GroupingUnit: groupingUnitToString(groupingSettings.groupingUnit),\r\n        GroupByLookupId: lookupId,\r\n        MasterRowId: undefined,\r\n        AggregatedColumns: aggregations,\r\n      });\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  async loadGroups(\r\n    dataView: IDataView,\r\n    columnSettings: IGroupingSettings,\r\n    groupByLookupId: string | undefined,\r\n    aggregations: IAggregationInfo[] | undefined\r\n  ) {\r\n    const orderingConfig = getOrderingConfiguration(dataView);\r\n    const orderingDirection =\r\n      orderingConfig.orderings.find((ordering) => ordering.columnId === columnSettings.columnId)\r\n        ?.direction ?? IOrderByDirection.ASC;\r\n\r\n    const api = getApi(this);\r\n    const ordering = {\r\n      columnId: columnSettings.columnId,\r\n      direction: orderingDirection,\r\n      lookupId: groupByLookupId,\r\n    };\r\n\r\n    const masterRowId =\r\n      !this.eagerLoading && !dataView.isRootGrid && dataView.bindingParent\r\n        ? dataView.bindingParent.selectedRowId\r\n        : undefined;\r\n\r\n    try {\r\n      this.monitor.inFlow++;\r\n      return await api.getGroups({\r\n        MenuId: getMenuItemId(dataView),\r\n        SessionFormIdentifier: getSessionId(this),\r\n        DataStructureEntityId: getDataStructureEntityId(dataView),\r\n        Filter: getUserFilters({ctx: dataView}),\r\n        FilterLookups: getUserFilterLookups(dataView),\r\n        Ordering: [ordering],\r\n        RowLimit: 999999,\r\n        GroupBy: columnSettings.columnId,\r\n        GroupingUnit: groupingUnitToString(columnSettings.groupingUnit),\r\n        GroupByLookupId: groupByLookupId,\r\n        MasterRowId: masterRowId,\r\n        AggregatedColumns: aggregations,\r\n      });\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  loadAggregations(rootDataView: IDataView, aggregations: IAggregationInfo[]) {\r\n    const api = getApi(this);\r\n    return api.getAggregations({\r\n      MenuId: getMenuItemId(rootDataView),\r\n      SessionFormIdentifier: getSessionId(this),\r\n      DataStructureEntityId: getDataStructureEntityId(rootDataView),\r\n      Filter: getUserFilters({ctx: rootDataView}),\r\n      FilterLookups: getUserFilterLookups(rootDataView),\r\n      MasterRowId: undefined,\r\n      AggregatedColumns: aggregations,\r\n    });\r\n  }\r\n\r\n  *loadData(args: { keepCurrentData: boolean }) {\r\n    const formScreen = getFormScreen(this);\r\n    try {\r\n      this.monitor.inFlow++;\r\n      for (let dataView of formScreen.nonRootDataViews) {\r\n        dataView.dataTable.clear();\r\n        dataView.lifecycle.stopSelectedRowReaction();\r\n      }\r\n      for (let rootDataView of formScreen.rootDataViews) {\r\n        rootDataView.saveViewState();\r\n        const groupingConfiguration = getGroupingConfiguration(rootDataView);\r\n        if (groupingConfiguration.isGrouping) {\r\n          rootDataView.serverSideGrouper.refresh();\r\n        } else {\r\n          yield this.updateTotalRowCount(rootDataView);\r\n          yield*this.readFirstChunkOfRows({\r\n            rootDataView: rootDataView,\r\n            keepCurrentData: args.keepCurrentData,\r\n          });\r\n        }\r\n      }\r\n    } finally {\r\n      for (let dataView of formScreen.nonRootDataViews) {\r\n        dataView.lifecycle.startSelectedRowReaction();\r\n      }\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  *throwChangesAway(dataView: IDataView): any {\r\n    try {\r\n      this.monitor.inFlow++;\r\n      const api = getApi(this);\r\n      const updateObjectResult = yield api.restoreData({\r\n        SessionFormIdentifier: getSessionId(this),\r\n        ObjectId: dataView.selectedRowId!,\r\n      });\r\n      yield*processCRUDResult(dataView, updateObjectResult, false, dataView);\r\n      const formScreen = getFormScreen(this);\r\n      if (formScreen.requestSaveAfterUpdate) {\r\n        yield*this.saveSession();\r\n      }\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  *flushData() {\r\n    try {\r\n      this.monitor.inFlow++;\r\n      let updateObjectDidRun = false;\r\n      const formScreen = getFormScreen(this);\r\n      const dataViews = formScreen.dataViews;\r\n      for (let dataView of dataViews) {\r\n        updateObjectDidRun = updateObjectDidRun || (yield*this.runUpdateObject(dataView));\r\n      }\r\n      if (formScreen.requestSaveAfterUpdate && updateObjectDidRun) {\r\n        yield*this.saveSession();\r\n      }\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  _processedUpdateObjectResults = new WeakSet<any>();\r\n\r\n  private*runUpdateObject(dataView: IDataView): any {\r\n    const updateData = dataView.dataTable.getDirtyValueRows().map((row) => {\r\n      return {\r\n        RowId: dataView.dataTable.getRowId(row),\r\n        Values: map2obj(dataView.dataTable.getDirtyValues(row)),\r\n      };\r\n    });\r\n    if (!updateData || updateData.length === 0) {\r\n      return false;\r\n    }\r\n    const updateObjectResult = yield this.updateRequestAggregator.enqueue({\r\n      SessionFormIdentifier: getSessionId(this),\r\n      Entity: dataView.entity,\r\n      UpdateData: updateData,\r\n    });\r\n\r\n    dataView.formFocusManager.stopAutoFocus();\r\n\r\n    // This might run more times in parallel, but we want to apply the result just once.\r\n    // Parallel promises will be resolved all by the same result of merged update request.\r\n    if (!this._processedUpdateObjectResults.has(updateObjectResult)) {\r\n      this._processedUpdateObjectResults.add(updateObjectResult);\r\n      yield*processCRUDResult(dataView, updateObjectResult, false, dataView);\r\n    }\r\n    dataView.formFocusManager.refocusLast();\r\n\r\n    return true;\r\n  }\r\n\r\n  *updateRadioButtonValue(dataView: IDataView, row: any, fieldName: string, newValue: string): any {\r\n    try {\r\n      this.monitor.inFlow++;\r\n      const changes: any = {};\r\n      changes[fieldName] = newValue;\r\n      const formScreen = getFormScreen(this);\r\n      const self = this;\r\n      const updateObjectResult = yield self.updateRequestAggregator.enqueue({\r\n        SessionFormIdentifier: getSessionId(self),\r\n        Entity: dataView.entity,\r\n        UpdateData: [\r\n          {\r\n            RowId: dataView.dataTable.getRowId(row),\r\n            Values: changes,\r\n          },\r\n        ],\r\n      });\r\n\r\n      yield*processCRUDResult(dataView, updateObjectResult, false, dataView);\r\n\r\n      if (formScreen.requestSaveAfterUpdate) {\r\n        yield*this.saveSession();\r\n      }\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  rowSelectedReactionsDisabled(dataView: IDataView) {\r\n    if (this.initialSelectedRowId && dataView.isBindingRoot && !this.eagerLoading) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  *readFirstChunkOfRows(args: { keepCurrentData: boolean; rootDataView: IDataView }): any {\r\n    const rootDataView = args.rootDataView;\r\n    const api = getApi(this);\r\n    rootDataView.setSelectedRowId(undefined);\r\n    rootDataView.lifecycle.stopSelectedRowReaction();\r\n    try {\r\n      this.monitor.inFlow++;\r\n      const loadedData = yield api.getRows({\r\n        MenuId: getMenuItemId(rootDataView),\r\n        SessionFormIdentifier: getSessionId(this),\r\n        DataStructureEntityId: getDataStructureEntityId(rootDataView),\r\n        Filter: getUserFilters({ctx: rootDataView}),\r\n        FilterLookups: getUserFilterLookups(rootDataView),\r\n        Ordering: getUserOrdering(rootDataView),\r\n        RowLimit: SCROLL_ROW_CHUNK,\r\n        MasterRowId: undefined,\r\n        Parameters: this.parameters,\r\n        RowOffset: 0,\r\n        ColumnNames: getColumnNamesToLoad(rootDataView),\r\n      });\r\n      if (args.keepCurrentData) {\r\n        rootDataView.appendRecords(loadedData);\r\n      } else {\r\n        yield rootDataView.setRecords(loadedData);\r\n      }\r\n      if (this.initialSelectedRowId) {\r\n        rootDataView.setSelectedRowId(this.initialSelectedRowId);\r\n      } else {\r\n        rootDataView.reselectOrSelectFirst();\r\n      }\r\n      rootDataView.restoreViewState();\r\n    } finally {\r\n      rootDataView.lifecycle.startSelectedRowReaction(true);\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  _readFirstChunkOfRowsRunning = false;\r\n  _readFirstChunkOfRowsScheduled = false;\r\n\r\n  *readFirstChunkOfRowsWithGate(rootDataView: IDataView) {\r\n    try {\r\n      if (this._readFirstChunkOfRowsRunning) {\r\n        this._readFirstChunkOfRowsScheduled = true;\r\n        return;\r\n      }\r\n      this._readFirstChunkOfRowsRunning = true;\r\n      do {\r\n        this._readFirstChunkOfRowsScheduled = false;\r\n        yield*this.readFirstChunkOfRows({\r\n          rootDataView: rootDataView,\r\n          keepCurrentData: false,\r\n        });\r\n      } while (this._readFirstChunkOfRowsScheduled);\r\n    } finally {\r\n      this._readFirstChunkOfRowsRunning = false;\r\n      this._readFirstChunkOfRowsScheduled = false;\r\n    }\r\n  }\r\n\r\n  readFirstChunkOfRowsWithGateDebounced = _.debounce(\r\n    flow(this.readFirstChunkOfRowsWithGate.bind(this)),\r\n    500\r\n  );\r\n\r\n  private getNewRowValues(targetDataView: IDataView) {\r\n    if (!targetDataView.orderMember) {\r\n      return;\r\n    }\r\n    const orderMember = targetDataView.orderMember;\r\n    const dataSourceField = getDataSourceFieldByName(targetDataView, orderMember);\r\n    const orderValues = targetDataView.tableRows\r\n      .map((row) => (row as any[])[dataSourceField!.index] as number);\r\n    const nextOrderValue = orderValues.length > 0 ? Math.max(...orderValues) + 1 : 1;\r\n    const values = {} as any;\r\n    values[orderMember] = nextOrderValue;\r\n    return values;\r\n  }\r\n\r\n  *createRow(entity: string, gridId: string): any {\r\n    try {\r\n      this.monitor.inFlow++;\r\n      const api = getApi(this);\r\n      const targetDataView = getDataViewByGridId(this, gridId)!;\r\n      const formScreen = getFormScreen(this);\r\n      let createObjectResult;\r\n      try {\r\n        yield*formScreen.dataUpdateCRS.enterGenerator();\r\n        createObjectResult = yield api.createObject({\r\n          SessionFormIdentifier: getSessionId(this),\r\n          Entity: entity,\r\n          RequestingGridId: gridId,\r\n          Values: this.getNewRowValues(targetDataView),\r\n          Parameters: {...getBindingParametersFromParent(targetDataView)},\r\n        });\r\n      } finally {\r\n        formScreen.dataUpdateCRS.leave();\r\n      }\r\n      yield*processCRUDResult(targetDataView, createObjectResult, false, targetDataView);\r\n      if (targetDataView.newRecordView === \"0\" && targetDataView.activateFormView) {\r\n        yield targetDataView.activateFormView({saveNewState: true});\r\n      } else {\r\n        if (targetDataView.isTableViewActive()) {\r\n          yield*startEditingFirstCell(targetDataView)();\r\n        } else if (targetDataView.isFormViewActive()) {\r\n          getFormFocusManager(targetDataView).forceAutoFocus();\r\n        }\r\n      }\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  *copyRow(entity: string, gridId: string, rowId: string): any {\r\n    try {\r\n      this.monitor.inFlow++;\r\n      const targetDataView = getDataViewByGridId(this, gridId)!;\r\n      const childEntities = getAllBindingChildren(targetDataView)\r\n        .filter(dataView => getIsAddButtonVisible(dataView))\r\n        .map((dataView) => getEntity(dataView)\r\n        );\r\n\r\n      const api = getApi(this);\r\n      const formScreen = getFormScreen(this);\r\n      let createObjectResult;\r\n      try {\r\n        yield*formScreen.dataUpdateCRS.enterGenerator();\r\n        createObjectResult = yield api.copyObject({\r\n          SessionFormIdentifier: getSessionId(this),\r\n          Entity: entity,\r\n          OriginalId: rowId,\r\n          RequestingGridId: gridId,\r\n          Entities: [entity, ...childEntities],\r\n          ForcedValues: this.getNewRowValues(targetDataView),\r\n        });\r\n      } finally {\r\n        formScreen.dataUpdateCRS.leave();\r\n      }\r\n      for (let dataView of getAllBindingChildren(targetDataView)) {\r\n        dataView.clear();\r\n      }\r\n      yield*processCRUDResult(targetDataView, createObjectResult, false, targetDataView);\r\n      getTablePanelView(targetDataView).scrollToCurrentRow();\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  *deleteRow(entity: string, rowId: string, targetDataView: IDataView): any {\r\n    try {\r\n      this.monitor.inFlow++;\r\n      const api = getApi(this);\r\n      const formScreen = getFormScreen(this);\r\n      let deleteObjectResult;\r\n      try {\r\n        yield*formScreen.dataUpdateCRS.enterGenerator();\r\n\r\n        if (targetDataView.orderMember) {\r\n          deleteObjectResult = yield*this.deleteObjectInOrderedList(rowId, entity, targetDataView);\r\n        } else {\r\n          deleteObjectResult = yield api.deleteObject({\r\n            SessionFormIdentifier: getSessionId(this),\r\n            Entity: entity,\r\n            Id: rowId,\r\n          });\r\n        }\r\n      } finally {\r\n        formScreen.dataUpdateCRS.leave();\r\n      }\r\n      yield*processCRUDResult(this, deleteObjectResult);\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  private*deleteObjectInOrderedList(rowId: string, entity: string, targetDataView: IDataView): any {\r\n    const api = getApi(this);\r\n    const rowToDelete = targetDataView.dataTable.getRowById(rowId)!;\r\n    const orderMember = targetDataView.orderMember;\r\n    const newRowOrderMap = {} as any;\r\n    if (orderMember) {\r\n      const dataSourceField = getDataSourceFieldByName(targetDataView, orderMember)!;\r\n      targetDataView.dataTable.allRows\r\n        .filter((row) => row[dataSourceField.index] > rowToDelete[dataSourceField.index])\r\n        .forEach((row) => {\r\n          const rowId = targetDataView.dataTable.getRowId(row);\r\n          const newOrder = row[dataSourceField.index] - 1;\r\n          newRowOrderMap[rowId] = newOrder;\r\n        });\r\n\r\n      return yield api.deleteObjectInOrderedList({\r\n        SessionFormIdentifier: getSessionId(this),\r\n        Entity: entity,\r\n        Id: rowId,\r\n        OrderProperty: orderMember,\r\n        UpdatedOrderValues: newRowOrderMap,\r\n      });\r\n    }\r\n  }\r\n\r\n  *saveSession(): any {\r\n    if (getIsSuppressSave(this)) {\r\n      return true;\r\n    }\r\n    try {\r\n      this.monitor.inFlow++;\r\n      const api = getApi(this);\r\n      let result;\r\n      const formScreen = getFormScreen(this);\r\n      try {\r\n        yield*formScreen.dataUpdateCRS.enterGenerator();\r\n        const queryResult = yield api.saveSessionQuery(getSessionId(this));\r\n\r\n        const processQueryInfoResult = yield*processActionQueryInfo(this)(\r\n          queryResult,\r\n          formScreen.title\r\n        );\r\n        if (!processQueryInfoResult.canContinue) {\r\n          return false;\r\n        }\r\n        result = yield api.saveSession(getSessionId(this));\r\n        getFormScreen(this).dataViews.forEach((dataView) =>\r\n          dataView.dataTable.unlockAddedRowPosition()\r\n        );\r\n      } finally {\r\n        formScreen.dataUpdateCRS.leave();\r\n      }\r\n      yield*refreshWorkQueues(this)();\r\n      yield*processCRUDResult(this, result);\r\n      getFormScreen(this).dataViews.forEach((dataView) =>\r\n        dataView.dataTable.updateSortAndFilter({retainPreviousSelection: true})\r\n      );\r\n      yield*this.updateTotalRowCounts();\r\n      // getFormScreen(this).dataViews.forEach((dataView) =>\r\n      //     yield dataView.reloadAggregations()\r\n      // );\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  *refreshLookups() {\r\n    const dataViews = getDataViewList(this);\r\n    const properties = dataViews.flatMap((dv) => getProperties(dv)).filter((prop) => prop.isLookup);\r\n    const cleaned = new Set<any>();\r\n    for (let prop of properties) {\r\n      if (prop.lookupEngine && !cleaned.has(prop.lookupId)) {\r\n        prop.lookupEngine.cleanAndReload();\r\n        getWorkbench(this).lookupListCache.deleteLookup(prop.lookupId!);\r\n        cleaned.add(prop.lookupId);\r\n      }\r\n    }\r\n  }\r\n\r\n  *refreshSession(): any {\r\n    // TODO: Refresh lookups and rowStates !!!\r\n    try {\r\n      this.monitor.inFlow++;\r\n      if (this.eagerLoading) {\r\n        const formScreen = getFormScreen(this);\r\n        formScreen.dataViews.forEach((dv) => dv.saveViewState());\r\n        const api = getApi(this);\r\n        let result;\r\n        try {\r\n          yield*formScreen.dataUpdateCRS.enterGenerator();\r\n          result = yield api.refreshSession(getSessionId(this));\r\n        } finally {\r\n          formScreen.dataUpdateCRS.leave();\r\n        }\r\n        yield*this.applyData(result);\r\n        getFormScreen(this).setDirty(false);\r\n        getFormScreen(this).dataViews.forEach((dv) => dv.restoreViewState());\r\n      } else {\r\n        yield*this.loadData({keepCurrentData: false});\r\n      }\r\n      getFormScreen(this).setDirty(false);\r\n      yield*this.refreshLookups();\r\n      getFormScreen(this).clearDataCache();\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n      setTimeout(async () => {\r\n        await when(() => this.allDataViewsSteady);\r\n      }, 10);\r\n    }\r\n    yield*refreshRowStates(this)();\r\n    yield*refreshWorkQueues(this)();\r\n  }\r\n\r\n  loadInitialData() {\r\n    if (!this.eagerLoading) {\r\n      const self = this;\r\n      flow(function*() {\r\n        yield*self.clearTotalCounts();\r\n        yield*self.loadData({keepCurrentData: false});\r\n        yield*self.updateTotalRowCounts();\r\n      })();\r\n    }\r\n  }\r\n\r\n  *clearTotalCounts() {\r\n    const formScreen = getFormScreen(this);\r\n    for (const dataView of formScreen.rootDataViews) {\r\n      if (isInfiniteScrollingActive(dataView) && !getGroupingConfiguration(dataView).isGrouping) {\r\n        dataView.setRowCount(undefined);\r\n      }\r\n    }\r\n  }\r\n\r\n  *updateTotalRowCounts() {\r\n    const formScreen = getFormScreen(this);\r\n    for (const dataView of formScreen.rootDataViews) {\r\n      if (isInfiniteScrollingActive(dataView) && !getGroupingConfiguration(dataView).isGrouping) {\r\n        yield this.updateTotalRowCount(dataView);\r\n        yield this.reloadAggregations(dataView);\r\n      }\r\n    }\r\n  }\r\n\r\n  async reloadAggregations(dataView: IDataView) {\r\n    const aggregations = getTablePanelView(dataView).aggregations.aggregationList;\r\n    if (aggregations.length === 0) {\r\n      dataView.aggregationData.length = 0;\r\n      return;\r\n    }\r\n    if (isInfiniteScrollingActive(dataView)) {\r\n      const data = await getFormScreenLifecycle(dataView).loadAggregations(dataView, aggregations);\r\n      dataView.aggregationData = parseAggregations(data) || [];\r\n    } else {\r\n      dataView.aggregationData = calcAggregations(dataView, aggregations);\r\n    }\r\n  }\r\n\r\n  async updateTotalRowCount(dataView: IDataView) {\r\n    const api = getApi(this);\r\n    const aggregationResult = await api.getAggregations({\r\n      MenuId: getMenuItemId(dataView),\r\n      SessionFormIdentifier: getSessionId(this),\r\n      DataStructureEntityId: getDataStructureEntityId(dataView),\r\n      Filter: getUserFilters({ctx: dataView}),\r\n      FilterLookups: getUserFilterLookups(dataView),\r\n      MasterRowId: undefined,\r\n      AggregatedColumns: [\r\n        {\r\n          ColumnName: \"Id\",\r\n          AggregationType: AggregationType.COUNT,\r\n        },\r\n      ],\r\n    });\r\n\r\n    const aggregationData = parseAggregations(aggregationResult);\r\n    if (aggregationData && aggregationData.length > 0) {\r\n      dataView.setRowCount(aggregationData[0].value);\r\n    }\r\n  }\r\n\r\n  private actionRunning = false;\r\n\r\n  *executeAction(gridId: string, entity: string, action: IAction, selectedItems: string[]): any {\r\n    if (this.actionRunning) {\r\n      return;\r\n    }\r\n    this.actionRunning = true;\r\n    try {\r\n      this.monitor.inFlow++;\r\n      const parameters: { [key: string]: any } = {};\r\n      for (let parameter of action.parameters) {\r\n        parameters[parameter.name] = parameter.fieldName;\r\n      }\r\n      const api = getApi(this);\r\n      const formScreen = getFormScreen(this);\r\n      let result;\r\n      try {\r\n        yield*formScreen.dataUpdateCRS.enterGenerator();\r\n        const queryResult = (yield api.executeActionQuery({\r\n          SessionFormIdentifier: getSessionId(this),\r\n          Entity: entity,\r\n          ActionType: action.type,\r\n          ActionId: action.id,\r\n          ParameterMappings: parameters,\r\n          SelectedItems: selectedItems,\r\n          InputParameters: {},\r\n        })) as IQueryInfo[];\r\n        const processQueryInfoResult = yield*processActionQueryInfo(this)(\r\n          queryResult,\r\n          formScreen.title\r\n        );\r\n        if (!processQueryInfoResult.canContinue) return;\r\n\r\n        const self = this;\r\n        result = yield api.executeAction({\r\n          SessionFormIdentifier: getSessionId(self),\r\n          Entity: entity,\r\n          ActionType: action.type,\r\n          ActionId: action.id,\r\n          ParameterMappings: parameters,\r\n          SelectedItems: selectedItems,\r\n          InputParameters: {},\r\n          RequestingGrid: gridId,\r\n        });\r\n      } finally {\r\n        formScreen.dataUpdateCRS.leave();\r\n      }\r\n\r\n      yield * new_ProcessActionResult(action)(result);\r\n      const dataView = getDataView(action);\r\n      dataView?.formFocusManager?.refocusLast();\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n      this.actionRunning = false;\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  killForm() {\r\n    this.clearAutoRefreshInterval();\r\n    this.disposers.forEach((disposer) => disposer());\r\n    getDataViewList(this).forEach((dv) => dv.stop());\r\n    const openedScreen = getOpenedScreen(this);\r\n    openedScreen.content.setFormScreen(undefined);\r\n  }\r\n\r\n  *closeForm() {\r\n    try {\r\n      this.monitor.inFlow++;\r\n      yield*closeForm(this)();\r\n      this.killForm();\r\n    } finally {\r\n      this.monitor.inFlow--;\r\n    }\r\n  }\r\n\r\n  questionSaveData() {\r\n    return new Promise(\r\n      action((resolve: (value: IQuestionSaveDataAnswer) => void) => {\r\n        const closeDialog = showDialog(this,\r\n          \"\",\r\n          <QuestionSaveData\r\n            screenTitle={getOpenedScreen(this).tabTitle}\r\n            onSaveClick={() => {\r\n              closeDialog();\r\n              resolve(IQuestionSaveDataAnswer.Save);\r\n            }}\r\n            onDontSaveClick={() => {\r\n              closeDialog();\r\n              resolve(IQuestionSaveDataAnswer.NoSave);\r\n            }}\r\n            onCancelClick={() => {\r\n              closeDialog();\r\n              resolve(IQuestionSaveDataAnswer.Cancel);\r\n            }}\r\n          />\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  questionDeleteData() {\r\n    return new Promise(\r\n      action((resolve: (value: IQuestionDeleteDataAnswer) => void) => {\r\n        const closeDialog = showDialog(this,\r\n          \"\",\r\n          <YesNoQuestion\r\n            screenTitle={getOpenedScreen(this).tabTitle}\r\n            yesLabel={T(\"Yes\", \"button_yes\")}\r\n            noLabel={T(\"No\", \"button_no\")}\r\n            message={T(\"Delete selected row?\", \"delete_confirmation\")}\r\n            onNoClick={() => {\r\n              closeDialog();\r\n              resolve(IQuestionDeleteDataAnswer.No);\r\n            }}\r\n            onYesClick={() => {\r\n              closeDialog();\r\n              resolve(IQuestionDeleteDataAnswer.Yes);\r\n            }}\r\n          />\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  *applyData(data: any): Generator {\r\n    for (let [entityKey, entityValue] of Object.entries(data || {})) {\r\n      const dataViews = getDataViewsByEntity(this, entityKey);\r\n      for (let dataView of dataViews) {\r\n        yield dataView.setRecords((entityValue as any).data);\r\n        dataView.setRowCount(dataView.dataTable.rows.length);\r\n        yield dataView.start();\r\n\r\n        const reloadAggregationsDebounced = _.debounce(() => {\r\n          const self = this;\r\n          runInFlowWithHandler({\r\n            ctx: dataView,\r\n            action: () => self.reloadAggregations(dataView),\r\n          });\r\n        }, 10);\r\n\r\n        this.registerDisposer(\r\n          reaction(\r\n            () => {\r\n              const tablePanelView = getTablePanelView(dataView);\r\n              if (!tablePanelView) return [];\r\n              return [\r\n                [...tablePanelView.aggregations.aggregationList],\r\n                getFilterConfiguration(dataView).activeFilters.map((x) => [\r\n                  x.propertyId,\r\n                  x.setting.type,\r\n                  x.setting.val1,\r\n                  x.setting.val2,\r\n                ]),\r\n                isInfiniteScrollingActive(dataView) ? true : dataView.dataTable.rows.length === 0,\r\n              ];\r\n            },\r\n            () => reloadAggregationsDebounced(),\r\n            {fireImmediately: true}\r\n          )\r\n        );\r\n        this.registerDisposer(\r\n          reaction(\r\n            () => isMobileLayoutActive(dataView),\r\n            () => {\r\n              const tablePanelView = getTablePanelView(dataView);\r\n              const configurationManager = getConfigurationManager(tablePanelView);\r\n              configurationManager.activeTableConfiguration.apply(tablePanelView);\r\n            },\r\n            {fireImmediately: true}\r\n          )\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  get eagerLoading() {\r\n    return !isLazyLoading(this);\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\nThis file is part of ORIGAM (http://www.origam.org).\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\nimport {getRowStates} from \"model/selectors/RowState/getRowStates\";\r\nimport {getDataSources} from \"model/selectors/DataSources/getDataSources\";\r\n\r\nexport function refreshRowStates(ctx: any) {\r\n  return function* refreshRowStates() {\r\n    for (let dataSource of getDataSources(ctx)) {\r\n      getRowStates(dataSource).reload();\r\n    }\r\n  };\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFormScreen } from \"./getFormScreen\";\r\n\r\nexport function getAutorefreshPeriod(ctx: any) {\r\n  return getFormScreen(ctx).autoRefreshInterval;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataView } from \"./getDataView\";\r\n\r\nexport function getBindingParametersFromParent(ctx: any) {\r\n  // debugger\r\n  return getDataView(ctx).bindingParametersFromParent;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { FormScreenLifecycle02 } from \"../entities/FormScreenLifecycle/FormScreenLifecycle\";\r\nimport { FormScreenEnvelope } from \"model/entities/FormScreen\";\r\nimport { IRefreshOnReturnType } from \"model/entities/WorkbenchLifecycle/WorkbenchLifecycle\";\r\n\r\nexport function createFormScreenEnvelope(\r\n  preloadedSessionId?: string,\r\n  refreshOnReturnType?: IRefreshOnReturnType\r\n) {\r\n  return new FormScreenEnvelope({\r\n    formScreenLifecycle: new FormScreenLifecycle02(),\r\n    preloadedSessionId,\r\n    refreshOnReturnType\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IDialogInfo } from \"../entities/types/IOpenedScreen\";\r\nimport { OpenedScreen } from \"../entities/OpenedScreen\";\r\nimport { IFormScreenEnvelope } from \"../entities/types/IFormScreen\";\r\nimport { IMainMenuItemType } from \"../entities/types/IMainMenu\";\r\n\r\nexport function*createOpenedScreen(\r\n  ctx: any,\r\n  menuItemId: string,\r\n  menuItemType: IMainMenuItemType,\r\n  order: number,\r\n  title: string,\r\n  content: IFormScreenEnvelope,\r\n  lazyLoading: boolean,\r\n  dialogInfo: IDialogInfo | undefined,\r\n  parameters: { [key: string]: any },\r\n  isSleeping?: boolean,\r\n  isSleepingDirty?: boolean\r\n): Generator {\r\n  return new OpenedScreen({\r\n    menuItemId,\r\n    menuItemType,\r\n    order,\r\n    tabTitle: title,\r\n    content,\r\n    dialogInfo,\r\n    lazyLoading,\r\n    parameters,\r\n    isSleeping,\r\n    isSleepingDirty\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { findStopping } from \"./xmlUtils\";\r\n\r\nexport const findMenu = (node: any) =>\r\n  findStopping(node, n => n.name === \"Menu\")[0];\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IMainMenu, IMainMenuContent, IMainMenuData, IMainMenuEnvelope } from \"./types/IMainMenu\";\r\nimport { action, observable } from \"mobx\";\r\nimport { proxyEnrich } from \"utils/esproxy\";\r\n\r\nexport class MainMenuContent implements IMainMenuContent {\r\n  $type_IMainMenuContent: 1 = 1;\r\n\r\n  constructor(data: IMainMenuData) {\r\n    Object.assign(this, data);\r\n  }\r\n\r\n  getItemById(id: string) {\r\n    function recursive(node: any) {\r\n      if (node.attributes.id === id) {\r\n        return node;\r\n      }\r\n      for (let ch of node.elements || []) {\r\n        const result: any = recursive(ch);\r\n        if (result) return result;\r\n      }\r\n    }\r\n\r\n    return recursive(this.menuUI);\r\n  }\r\n\r\n  menuUI: any;\r\n  parent?: any;\r\n}\r\n\r\nexport class MainMenuEnvelope implements IMainMenuEnvelope {\r\n  $type_IMainMenuEnvelope: 1 = 1;\r\n\r\n  @observable mainMenu?: IMainMenu | undefined;\r\n  @observable isLoading: boolean = false;\r\n\r\n  @action.bound\r\n  setMainMenu(mainMenu: IMainMenuContent | undefined): void {\r\n    if (mainMenu) {\r\n      mainMenu.parent = this;\r\n      this.mainMenu = proxyEnrich<IMainMenuEnvelope, IMainMenuContent>(\r\n        mainMenu\r\n      );\r\n    } else {\r\n      this.mainMenu = undefined;\r\n    }\r\n  }\r\n\r\n  @action.bound setLoading(state: boolean) {\r\n    this.isLoading = state;\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport bind from \"bind-decorator\";\r\nimport { reloadScreen } from \"model/actions/FormScreen/reloadScreen\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { createFormScreenEnvelope } from \"model/factories/createFormScreenEnvelope\";\r\nimport { createOpenedScreen } from \"model/factories/createOpenedScreen\";\r\nimport { getIsFormScreenDirty } from \"model/selectors/FormScreen/getisFormScreenDirty\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { getSearcher } from \"model/selectors/getSearcher\";\r\nimport { getOpenedScreens } from \"model/selectors/getOpenedScreens\";\r\nimport { getMainMenuEnvelope } from \"model/selectors/MainMenu/getMainMenuEnvelope\";\r\nimport { getMainMenuItemById } from \"model/selectors/MainMenu/getMainMenuItemById\";\r\nimport { getWorkQueues } from \"model/selectors/WorkQueues/getWorkQueues\";\r\nimport { findMenu } from \"xmlInterpreters/menuXml\";\r\nimport { MainMenuContent } from \"../MainMenu\";\r\nimport { DialogInfo } from \"../OpenedScreen\";\r\nimport { IMainMenuItemType } from \"../types/IMainMenu\";\r\nimport { IDialogInfo, IOpenedScreen } from \"../types/IOpenedScreen\";\r\nimport { IWorkbenchLifecycle } from \"../types/IWorkbenchLifecycle\";\r\nimport { WebScreen } from \"../WebScreen\";\r\nimport { getSessionId } from \"model/selectors/getSessionId\";\r\nimport { scopeFor } from \"dic/Container\";\r\nimport { assignIIds } from \"xmlInterpreters/xmlUtils\";\r\nimport { DEBUG_CLOSE_ALL_FORMS } from \"utils/debugHelpers\";\r\nimport { getOpenedScreen } from \"../../selectors/getOpenedScreen\";\r\nimport { onWorkflowNextClick } from \"model/actions-ui/ScreenHeader/onWorkflowNextClick\";\r\nimport { observable } from \"mobx\";\r\nimport { IUserInfo } from \"model/entities/types/IUserInfo\";\r\nimport { getChatrooms } from \"model/selectors/Chatrooms/getChatrooms\";\r\nimport { openNewUrl } from \"model/actions/Workbench/openNewUrl\";\r\nimport { IUrlUpenMethod } from \"../types/IUrlOpenMethod\";\r\nimport { IPortalSettings } from \"../types/IPortalSettings\";\r\nimport { getNotifications } from \"model/selectors/Chatrooms/getNotifications\";\r\nimport selectors from \"model/selectors-tree\";\r\nimport { onMainMenuItemClick } from \"model/actions-ui/MainMenu/onMainMenuItemClick\";\r\nimport { getFavorites } from \"model/selectors/MainMenu/getFavorites\";\r\nimport produce from \"immer\";\r\nimport { IDataView } from \"../types/IDataView\";\r\nimport { FormScreenEnvelope } from \"model/entities/FormScreen\";\r\nimport { EventHandler } from \"utils/EventHandler\";\r\n\r\nexport enum IRefreshOnReturnType {\r\n  None = \"None\",\r\n  ReloadActualRecord = \"ReloadActualRecord\",\r\n  RefreshCompleteForm = \"RefreshCompleteForm\",\r\n  MergeModalDialogChanges = \"MergeModalDialogChanges\",\r\n}\r\n\r\nexport class WorkbenchLifecycle implements IWorkbenchLifecycle {\r\n  $type_IWorkbenchLifecycle: 1 = 1;\r\n\r\n  @observable\r\n  portalSettings: IPortalSettings | undefined;\r\n  @observable\r\n  userInfo: IUserInfo | undefined;\r\n  @observable\r\n  logoUrl: string | undefined;\r\n  @observable\r\n  customAssetsRoute: string | undefined;\r\n\r\n  mainMenuItemClickHandler = new EventHandler();\r\n\r\n  *onMainMenuItemClick(args: {\r\n    event: any;\r\n    item: any;\r\n    idParameter: string | undefined;\r\n    isSingleRecordEdit?: boolean;\r\n    forceOpenNew?: boolean;\r\n  }): Generator {\r\n    const {\r\n      type,\r\n      id,\r\n      label,\r\n      dialogWidth,\r\n      dialogHeight,\r\n      lazyLoading,\r\n      urlOpenMethod,\r\n    } = args.item.attributes;\r\n    const {event} = args;\r\n    const alwaysOpenNew = args.item.attributes.alwaysOpenNew === \"true\" || args.forceOpenNew;\r\n    this.mainMenuItemClickHandler.call();\r\n\r\n    if (urlOpenMethod === \"LaunchBrowserWindow\") {\r\n      const url = (yield this.getReportTabUrl(id)) as string;\r\n      window.open(url);\r\n      return;\r\n    }\r\n\r\n    const openedScreens = getOpenedScreens(this);\r\n\r\n    let dialogInfo: IDialogInfo | undefined;\r\n    if (type === IMainMenuItemType.FormRefWithSelection || type === IMainMenuItemType.ReportRefWithSelection) {\r\n      dialogInfo = new DialogInfo(parseInt(dialogWidth, 10), parseInt(dialogHeight, 10));\r\n    }\r\n    if (event && !(event.ctrlKey || event.metaKey)) {\r\n      const existingItem = openedScreens.findLastExistingTabItem(id);\r\n      if (\r\n        existingItem &&\r\n        type !== IMainMenuItemType.FormRefWithSelection &&\r\n        type !== IMainMenuItemType.ReportReferenceMenuItem &&\r\n        type !== IMainMenuItemType.ReportRefWithSelection &&\r\n        !alwaysOpenNew\r\n      ) {\r\n        openedScreens.activateItem(id, existingItem.order);\r\n        const openedScreen = existingItem;\r\n        if (openedScreen.isSleeping) {\r\n          openedScreen.isSleeping = false;\r\n          const initUIResult = yield*this.initUIForScreen(\r\n            openedScreen,\r\n            false,\r\n            undefined,\r\n            args.isSingleRecordEdit\r\n          );\r\n          yield*openedScreen.content!.start(initUIResult, openedScreen.isSleepingDirty);\r\n        } else if (\r\n          openedScreen.content &&\r\n          openedScreen.content.formScreen &&\r\n          openedScreen.content.formScreen.refreshOnFocus &&\r\n          !openedScreen.content.isLoading\r\n        ) {\r\n          if (!getIsFormScreenDirty(openedScreen.content.formScreen)) {\r\n            yield*reloadScreen(openedScreen.content.formScreen)();\r\n          }\r\n        }\r\n      } else {\r\n        if (type === IMainMenuItemType.ReportReferenceMenuItem) {\r\n          const url = (yield this.getReportTabUrl(id)) as string;\r\n          yield*this.openNewUrl(url, args.item.attributes[\"label\"]);\r\n          return;\r\n        } else {\r\n          yield*this.openNewForm(\r\n            id,\r\n            type,\r\n            label,\r\n            lazyLoading === \"true\",\r\n            dialogInfo,\r\n            args.idParameter ? {id: args.idParameter} : {},\r\n            undefined,\r\n            undefined,\r\n            undefined,\r\n            undefined,\r\n            undefined,\r\n            undefined,\r\n            args.isSingleRecordEdit\r\n          );\r\n        }\r\n      }\r\n    } else {\r\n      yield*this.openNewForm(\r\n        id,\r\n        type,\r\n        label,\r\n        lazyLoading === \"true\",\r\n        dialogInfo,\r\n        args.idParameter ? {id: args.idParameter} : {},\r\n        undefined,\r\n        undefined,\r\n        undefined,\r\n        undefined,\r\n        undefined,\r\n        undefined,\r\n        args.isSingleRecordEdit\r\n      );\r\n    }\r\n  }\r\n\r\n  *onMainMenuItemIdClick(args: {\r\n    event: any;\r\n    itemId: any;\r\n    idParameter: string | undefined;\r\n    isSingleRecordEdit?: boolean;\r\n  }) {\r\n    let menuItem = args.itemId && selectors.mainMenu.getItemById(this, args.itemId);\r\n    if (args.isSingleRecordEdit) {\r\n      // Temporary hack o allow filtered screens to work unless single record edit is\r\n      // implemented for paginated screens on server side. There is no need to paginate\r\n      // when we have just one record, hence it is ok to execute the screen in without\r\n      // pagination\r\n      menuItem = {...menuItem};\r\n      delete menuItem.parent;\r\n      delete menuItem.elements;\r\n      menuItem = produce(menuItem, (draft: any) => {\r\n        draft.attributes.isLazyLoading = \"false\";\r\n      });\r\n    }\r\n    if (menuItem) {\r\n      yield onMainMenuItemClick(this)({\r\n        event: undefined,\r\n        item: menuItem,\r\n        idParameter: args.idParameter,\r\n        isSingleRecordEdit: args.isSingleRecordEdit,\r\n      });\r\n    }\r\n  }\r\n\r\n  async getReportTabUrl(menuId: string) {\r\n    const api = getApi(this);\r\n    const url = await api.getReportFromMenu({menuId: menuId});\r\n    return url;\r\n  }\r\n\r\n  *onWorkQueueListItemClick(event: any, item: any) {\r\n    const openedScreens = getOpenedScreens(this);\r\n\r\n    this.mainMenuItemClickHandler.call();\r\n    const id = item.id;\r\n    const type = IMainMenuItemType.WorkQueue;\r\n    const label = item.name;\r\n\r\n    let dialogInfo: IDialogInfo | undefined;\r\n    if (!event || !(event.ctrlKey || event.metaKey)) {\r\n      const existingItem = openedScreens.findLastExistingTabItem(id);\r\n      if (existingItem) {\r\n        openedScreens.activateItem(id, existingItem.order);\r\n        const openedScreen = existingItem;\r\n        if (openedScreen.isSleeping) {\r\n          openedScreen.isSleeping = false;\r\n          const initUIResult = yield*this.initUIForScreen(openedScreen, false, undefined);\r\n          yield*openedScreen.content!.start(initUIResult, openedScreen.isSleepingDirty);\r\n        } else if (\r\n          openedScreen.content &&\r\n          openedScreen.content.formScreen &&\r\n          openedScreen.content.formScreen.refreshOnFocus &&\r\n          !openedScreen.content.isLoading\r\n        ) {\r\n          if (!getIsFormScreenDirty(openedScreen.content.formScreen)) {\r\n            yield*reloadScreen(openedScreen.content.formScreen)();\r\n          }\r\n        }\r\n      } else {\r\n        yield*this.openNewForm(id, type, label, false, dialogInfo, {});\r\n      }\r\n    } else {\r\n      yield*this.openNewForm(id, type, label, false, dialogInfo, {});\r\n    }\r\n  }\r\n\r\n  *onChatroomsListItemClick(event: any, item: any) {\r\n\r\n    const openedScreens = getOpenedScreens(this);\r\n    const url = `/chatrooms/index.html#/chatroom?chatroomId=${item.id}`;\r\n    const id = url;\r\n\r\n    const existingItem = openedScreens.findLastExistingTabItem(id);\r\n    if (existingItem) {\r\n      openedScreens.activateItem(id, existingItem.order);\r\n      const openedScreen = existingItem;\r\n      if (openedScreen.isSleeping) {\r\n        openedScreen.isSleeping = false;\r\n        const initUIResult = yield*this.initUIForScreen(openedScreen, false);\r\n        yield*openedScreen.content!.start(initUIResult, openedScreen.isSleepingDirty);\r\n      } else if (\r\n        openedScreen.content &&\r\n        openedScreen.content.formScreen &&\r\n        openedScreen.content.formScreen.refreshOnFocus &&\r\n        !openedScreen.content.isLoading\r\n      ) {\r\n        if (!getIsFormScreenDirty(openedScreen.content.formScreen)) {\r\n          yield*reloadScreen(openedScreen.content.formScreen)();\r\n        }\r\n      }\r\n    } else {\r\n      yield*openNewUrl(this)(url, IUrlUpenMethod.OrigamTab, item.topic);\r\n    }\r\n  }\r\n\r\n  *onScreenTabHandleClick(event: any, openedScreen: IOpenedScreen): Generator {\r\n    const openedScreens = getOpenedScreens(this);\r\n    openedScreens.activateItem(openedScreen.menuItemId, openedScreen.order);\r\n\r\n    if (openedScreen.isSleeping) {\r\n      openedScreen.isSleeping = false;\r\n      const initUIResult = yield*this.initUIForScreen(openedScreen, false);\r\n      yield*openedScreen.content!.start(initUIResult, openedScreen.isSleepingDirty);\r\n    } else if (\r\n      openedScreen.content &&\r\n      openedScreen.content.formScreen &&\r\n      openedScreen.content.formScreen.refreshOnFocus &&\r\n      !openedScreen.content.isLoading\r\n    ) {\r\n      if (!getIsFormScreenDirty(openedScreen.content.formScreen)) {\r\n        yield*reloadScreen(openedScreen.content.formScreen)();\r\n      }\r\n    }\r\n  }\r\n\r\n  *closeForm(openedScreen: IOpenedScreen): Generator {\r\n    // TODO: Refactor to get rid of code duplication\r\n    const openedScreens = getOpenedScreens(openedScreen);\r\n\r\n    const parentScreen = openedScreen.parentContext\r\n      ? getOpenedScreen(openedScreen.parentContext)\r\n      : undefined;\r\n\r\n    const screenToActivate = parentScreen && !parentScreen.isClosed\r\n      ? parentScreen\r\n      : openedScreens.findTopmostItemExcept(openedScreen.menuItemId, openedScreen.order);\r\n\r\n    openedScreens.deleteItem(openedScreen.menuItemId, openedScreen.order);\r\n    if (openedScreen.dialogInfo) {\r\n      if (openedScreen.isActive) {\r\n        if (screenToActivate) {\r\n          openedScreens.activateItem(screenToActivate.menuItemId, screenToActivate.order);\r\n          if (screenToActivate.isSleeping) {\r\n            screenToActivate.isSleeping = false;\r\n            const initUIResult = yield*this.initUIForScreen(screenToActivate, false);\r\n            yield*screenToActivate.content!.start(initUIResult, screenToActivate.isSleepingDirty);\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      if (openedScreen.isActive) {\r\n        if (screenToActivate) {\r\n          openedScreens.activateItem(screenToActivate.menuItemId, screenToActivate.order);\r\n\r\n          if (screenToActivate.isSleeping) {\r\n            screenToActivate.isSleeping = false;\r\n            const initUIResult = yield*this.initUIForScreen(screenToActivate, false);\r\n            yield*screenToActivate.content!.start(initUIResult, screenToActivate.isSleepingDirty);\r\n          } else if (\r\n            screenToActivate.content &&\r\n            screenToActivate.content.formScreen &&\r\n            screenToActivate.content.formScreen.refreshOnFocus &&\r\n            !screenToActivate.content.isLoading\r\n          ) {\r\n            if (!getIsFormScreenDirty(screenToActivate.content.formScreen)) {\r\n              yield*reloadScreen(screenToActivate.content.formScreen)();\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    yield*this.destroyUI(openedScreen);\r\n\r\n    if (openedScreen.content && openedScreen.content.formScreen) {\r\n      const scope = scopeFor(openedScreen.content.formScreen);\r\n      if (scope) scope.disposeWithChildren();\r\n    }\r\n    openedScreen.isClosed = true;\r\n  }\r\n\r\n  *destroyUI(openedScreen: IOpenedScreen) {\r\n    const api = getApi(this);\r\n    if (openedScreen.content) {\r\n      if (openedScreen.content.formScreen) {\r\n        yield api.destroyUI({FormSessionId: getSessionId(openedScreen.content.formScreen)});\r\n      } else if (openedScreen.content.preloadedSessionId) {\r\n        yield api.destroyUI({FormSessionId: openedScreen.content.preloadedSessionId});\r\n      }\r\n    }\r\n  }\r\n\r\n  @bind\r\n  *openNewForm(\r\n    id: string,\r\n    type: IMainMenuItemType,\r\n    label: string,\r\n    isLazyLoading: boolean,\r\n    dialogInfo: IDialogInfo | undefined,\r\n    parameters: { [key: string]: any },\r\n    parentContext?: any,\r\n    requestParameters?: object | undefined,\r\n    formSessionId?: string,\r\n    isSessionRebirth?: boolean,\r\n    isSleepingDirty?: boolean,\r\n    refreshOnReturnType?: IRefreshOnReturnType,\r\n    isSingleRecordEdit?: boolean\r\n  ) {\r\n    const openedScreens = getOpenedScreens(this);\r\n    const existingItem = openedScreens.findLastExistingTabItem(id);\r\n    const newFormScreen = createFormScreenEnvelope(formSessionId, refreshOnReturnType);\r\n    const newScreen = yield*createOpenedScreen(\r\n      this,\r\n      id,\r\n      type,\r\n      existingItem ? existingItem.order + 1 : 0,\r\n      label,\r\n      newFormScreen,\r\n      isLazyLoading,\r\n      dialogInfo,\r\n      parameters,\r\n      isSessionRebirth,\r\n      isSleepingDirty\r\n    );\r\n    try {\r\n      openedScreens.pushItem(newScreen);\r\n      if (!isSessionRebirth) {\r\n        newScreen.parentContext = parentContext;\r\n        openedScreens.activateItem(newScreen.menuItemId, newScreen.order);\r\n      }\r\n\r\n      if (isSessionRebirth) {\r\n        return;\r\n      }\r\n\r\n      const initUIResult = yield*this.initUIForScreen(\r\n        newScreen,\r\n        !isSessionRebirth,\r\n        requestParameters,\r\n        isSingleRecordEdit\r\n      );\r\n      yield*newFormScreen.start(initUIResult);\r\n      const rowIdToSelect = parameters[\"id\"];\r\n      yield*this.selectAndOpenRowById(rowIdToSelect, newFormScreen);\r\n      const formScreen = newScreen.content.formScreen;\r\n      if (formScreen?.autoWorkflowNext) {\r\n        yield onWorkflowNextClick(formScreen!)(undefined);\r\n      }\r\n    } catch (e) {\r\n      yield*handleError(this)(e);\r\n      yield*this.closeForm(newScreen);\r\n      throw e;\r\n    }\r\n  }\r\n\r\n  private*selectAndOpenRowById(rowIdToSelect: string, newFormScreen: FormScreenEnvelope) {\r\n    if (rowIdToSelect && newFormScreen.formScreen) {\r\n      for (const dataView of newFormScreen.formScreen.dataViews) {\r\n        const hasTheRow = (dataView as IDataView).dataTable.rows\r\n          .find(row => dataView.dataTable.getRowId(row) === rowIdToSelect) !== undefined;\r\n        if (hasTheRow && dataView.activateFormView && !dataView.isHeadless) {\r\n          dataView.setSelectedRowId(rowIdToSelect);\r\n          yield dataView.activateFormView({saveNewState: false});\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  *initUIForScreen(\r\n    screen: IOpenedScreen,\r\n    isNewSession: boolean,\r\n    requestParameters?: object | undefined,\r\n    isSingleRecordEdit?: boolean\r\n  ): any {\r\n    const api = getApi(this);\r\n    if (requestParameters) {\r\n      return yield api.initUI(requestParameters as any);\r\n    }\r\n    return yield api.initUI({\r\n      Type: screen.menuItemType,\r\n      Caption: screen.tabTitle,\r\n      ObjectId: screen.menuItemId,\r\n      FormSessionId: screen.content!.preloadedSessionId,\r\n      IsNewSession: isNewSession,\r\n      RegisterSession: true,\r\n      DataRequested: !screen.lazyLoading,\r\n      Parameters: screen.parameters,\r\n      IsSingleRecordEdit: isSingleRecordEdit,\r\n      RequestCurrentRecordId: true\r\n    });\r\n  }\r\n\r\n  *openNewUrl(url: string, title: string) {\r\n    const openedScreens = getOpenedScreens(this);\r\n    const newScreen = new WebScreen(title, url, url, 0);\r\n    openedScreens.pushItem(newScreen);\r\n    openedScreens.activateItem(newScreen.menuItemId, newScreen.order);\r\n  }\r\n\r\n  *initPortal(): any {\r\n    const api = getApi(this);\r\n    const portalInfo = yield api.initPortal();\r\n\r\n    if (portalInfo.title) {\r\n      document.title = portalInfo.title;\r\n    }\r\n    this.userInfo = {\r\n      userName: portalInfo.userName,\r\n      avatarLink: portalInfo.avatarLink,\r\n    };\r\n    this.logoUrl = portalInfo.logoUrl;\r\n    this.customAssetsRoute = portalInfo.customAssetsRoute;\r\n    this.portalSettings = {\r\n      showChat: portalInfo.chatRefreshInterval > 0,\r\n      showWorkQueues: portalInfo.workQueueListRefreshInterval > 0,\r\n      helpUrl: portalInfo.helpUrl,\r\n      showToolTipsForMemoFieldsOnly: portalInfo.showToolTipsForMemoFieldsOnly,\r\n      filterConfig: {\r\n        caseSensitive: portalInfo.filteringConfig.caseSensitive,\r\n        accentSensitive: portalInfo.filteringConfig.accentSensitive\r\n      }\r\n    };\r\n    const menuUI = findMenu(portalInfo.menu);\r\n    assignIIds(menuUI);\r\n    getFavorites(this).setXml(portalInfo.favorites);\r\n    getMainMenuEnvelope(this).setMainMenu(new MainMenuContent({menuUI}));\r\n    getSearcher(this).indexMainMenu(menuUI);\r\n\r\n    if(portalInfo.initialScreenId && (portalInfo.sessions.length === 0 || !portalInfo.sessions.some((session: any) => session.objectId === portalInfo.initialScreenId))){\r\n      const menuItem = getMainMenuItemById(this, portalInfo.initialScreenId);\r\n      yield onMainMenuItemClick(this)({\r\n        event: null,\r\n        item: menuItem,\r\n        idParameter: undefined\r\n      });\r\n    }\r\n\r\n    if (!DEBUG_CLOSE_ALL_FORMS()) {\r\n      for (let session of portalInfo.sessions) {\r\n        const menuItem = getMainMenuItemById(this, session.objectId);\r\n        const lazyLoading = menuItem\r\n          ? menuItem?.attributes?.lazyLoading === \"true\"\r\n          : false;\r\n        yield*this.openNewForm(\r\n          session.objectId,\r\n          session.type,\r\n          session.caption, // TODO: Find in menu\r\n          lazyLoading,\r\n          undefined, // TODO: Find in... menu?\r\n          {},\r\n          undefined,\r\n          undefined,\r\n          session.formSessionId,\r\n          true,\r\n          session.isDirty\r\n        );\r\n      }\r\n    } else {\r\n      for (let session of portalInfo.sessions) {\r\n        yield api.destroyUI({FormSessionId: session.formSessionId});\r\n      }\r\n    }\r\n\r\n    const openedScreens = getOpenedScreens(this);\r\n    if (openedScreens.items.length > 0) {\r\n      const screenToOpen = portalInfo.initialScreenId\r\n        ? openedScreens.items.find(screen => screen.menuItemId === portalInfo.initialScreenId) ?? openedScreens.items[0]\r\n        : openedScreens.items[0];\r\n      openedScreens.activateItem(screenToOpen.menuItemId, screenToOpen.order);\r\n      screenToOpen.isSleeping = false;\r\n      const initUIResult = yield*this.initUIForScreen(screenToOpen, false);\r\n      if (screenToOpen.content) {\r\n        yield*screenToOpen.content.start(\r\n          initUIResult,\r\n          screenToOpen.isSleepingDirty\r\n        );\r\n      }\r\n    }\r\n\r\n    if (this.portalSettings?.showWorkQueues) {\r\n      yield*getWorkQueues(this).startTimer(portalInfo.workQueueListRefreshInterval);\r\n    }\r\n\r\n    if (this.portalSettings?.showChat) {\r\n      yield*getChatrooms(this).startTimer(portalInfo.chatRefreshInterval);\r\n    }\r\n\r\n    if (portalInfo.notificationBoxRefreshInterval > 0) {\r\n      yield*getNotifications(this).startTimer(portalInfo.notificationBoxRefreshInterval);\r\n    }\r\n  }\r\n\r\n  *run(): Generator {\r\n    yield*this.initPortal();\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport interface IParented<TParent> {\r\n  parent?: TParent;\r\n}\r\n\r\nexport function proxyEnrich<TAdd, TTarget extends object & IParented<TAdd>>(\r\n  target: TTarget\r\n) {\r\n  return new Proxy<TTarget>(target, {\r\n    get(obj, prop) {\r\n      return prop in obj ? (obj as any)[prop] : (obj.parent as any)[prop];\r\n    },\r\n    set(obj, prop, newVal) {\r\n      if (prop in obj) {\r\n        (obj as any)[prop] = newVal;\r\n      } else {\r\n        (obj.parent as any)[prop] = newVal;\r\n      }\r\n      return true;\r\n    }\r\n  }) as TTarget & TAdd;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IReloader, IWebScreen } from \"./types/IWebScreen\";\r\nimport { IOpenedScreen } from \"./types/IOpenedScreen\";\r\nimport { action, observable } from \"mobx\";\r\nimport { IFormScreenEnvelope } from \"./types/IFormScreen\";\r\nimport { IMainMenuItemType } from \"./types/IMainMenu\";\r\nimport { EventHandler } from \"utils/EventHandler\";\r\n\r\nexport class WebScreen implements IWebScreen, IOpenedScreen {\r\n  $type_IOpenedScreen: 1 = 1;\r\n  $type_IWebScreen: 1 = 1;\r\n  parentSessionId: string | undefined;\r\n\r\n  isBeingClosed = false;\r\n\r\n  constructor(\r\n    title: string,\r\n    public screenUrl: string,\r\n    public menuItemId: string,\r\n    public order: number\r\n  ) {\r\n    this.tabTitle = title;\r\n    this.formTitle = title;\r\n  }\r\n\r\n  reloader: IReloader | null = null;\r\n  @observable stackPosition: number = 0;\r\n  @observable tabTitle = \"\";\r\n  @observable formTitle = \"\";\r\n  @observable isActive = false;\r\n  isDialog = false;\r\n  isClosed = false;\r\n\r\n  @action.bound\r\n  setActive(state: boolean): void {\r\n    this.isActive = state;\r\n    if(this.isActive){\r\n      this.activationHandler.call();\r\n    }\r\n  }\r\n\r\n  setContent(screen: IFormScreenEnvelope): void {\r\n  }\r\n\r\n  setTitle(title: string): void {\r\n    this.tabTitle = title;\r\n  }\r\n\r\n  setReloader(reloader: IReloader | null): void {\r\n    this.reloader = reloader;\r\n  }\r\n\r\n  reload() {\r\n    this.reloader && this.reloader.reload();\r\n  }\r\n\r\n  parent?: any;\r\n\r\n  menuItemType: IMainMenuItemType = null as any;\r\n\r\n  lazyLoading = false;\r\n  dialogInfo = undefined;\r\n  content: IFormScreenEnvelope = null as any;\r\n  parameters: { [key: string]: any } = {};\r\n  hasDynamicTitle: boolean = false;\r\n  parentContext: IOpenedScreen | undefined;\r\n\r\n  activationHandler = new EventHandler();\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\n\r\nexport function onWorkflowNextClick(ctx: any) {\r\n  return flow(function*onWorkflowNextClick(event: any) {\r\n    try {\r\n      const lifecycle = getFormScreenLifecycle(ctx);\r\n      yield*lifecycle.onFlushData();\r\n      yield*lifecycle.onWorkflowNextClick(event);\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbench } from \"../getWorkbench\";\r\n\r\nexport function getChatrooms(ctx: any) {\r\n  return getWorkbench(ctx).chatrooms;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbench } from \"model/selectors/getWorkbench\";\r\n\r\nexport function getNotifications(ctx: any) {\r\n  return getWorkbench(ctx).notifications;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbench } from \"model/selectors/getWorkbench\";\r\n\r\nexport function getFavorites(ctx: any) {\r\n  return getWorkbench(ctx).favorites;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport function DEBUG_CLOSE_ALL_FORMS() {\r\n  return window.localStorage.getItem('debugCloseAllForms')\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\n\r\n// TODO: Move to ui actions\r\nexport function onRefreshSessionClick(ctx: any) {\r\n  return flow(function*onRefreshSessionClick() {\r\n    try {\r\n      yield*getFormScreenLifecycle(ctx).onRequestScreenReload();\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbenchLifecycle } from \"model/selectors/getWorkbenchLifecycle\";\r\nimport { getOpenedScreen } from \"model/selectors/getOpenedScreen\";\r\nimport { IRefreshOnReturnType } from \"../entities/WorkbenchLifecycle/WorkbenchLifecycle\";\r\nimport { getApi } from \"../selectors/getApi\";\r\nimport { ICRUDResult, processCRUDResult } from \"./DataLoading/processCRUDResult\";\r\nimport { isLazyLoading } from \"model/selectors/isLazyLoading\";\r\nimport { getDataViewLifecycle } from \"model/selectors/DataView/getDataViewLifecycle\";\r\nimport { getFormScreen } from \"model/selectors/FormScreen/getFormScreen\";\r\nimport { onRefreshSessionClick } from \"model/actions-ui/ScreenToolbar/onRefreshSessionClick\";\r\nimport { getMobileState } from \"model/selectors/getMobileState\";\r\n\r\nexport function closeForm(ctx: any) {\r\n  return function*closeForm(): Generator {\r\n    const lifecycle = getWorkbenchLifecycle(ctx);\r\n    const openedScreen = getOpenedScreen(ctx);\r\n    getMobileState(ctx).onFormClose(openedScreen.content.formScreen);\r\n    yield*lifecycle.closeForm(openedScreen);\r\n    if (openedScreen.content?.refreshOnReturnType) {\r\n      const refreshOnReturnType = openedScreen.content.refreshOnReturnType;\r\n      const parentScreen = getOpenedScreen(openedScreen.parentContext);\r\n      const parentFormScreen = getFormScreen(openedScreen.parentContext);\r\n      switch (refreshOnReturnType) {\r\n        case IRefreshOnReturnType.ReloadActualRecord:\r\n          if (isLazyLoading(ctx)) {\r\n            break;\r\n          }\r\n          for (let dataView of parentFormScreen.dataViews) {\r\n            const dataViewLifecycle = getDataViewLifecycle(dataView);\r\n            yield dataViewLifecycle.runRecordChangedReaction();\r\n          }\r\n          break;\r\n        case IRefreshOnReturnType.RefreshCompleteForm:\r\n          yield onRefreshSessionClick(parentFormScreen)();\r\n          break;\r\n        case IRefreshOnReturnType.MergeModalDialogChanges:\r\n          const api = getApi(ctx);\r\n          const parentScreenSessionId = parentScreen!.content!.formScreen!.sessionId;\r\n          const changes = (yield api.pendingChanges({sessionFormIdentifier: parentScreenSessionId})) as ICRUDResult[];\r\n          for (let change of changes) {\r\n            yield*processCRUDResult(openedScreen.parentContext, change);\r\n          }\r\n          const dataViews = parentScreen?.content?.formScreen?.dataViews ?? [];\r\n          for (const dataView of dataViews) {\r\n            dataView.dataTable.unlockAddedRowPosition();\r\n            yield dataView.dataTable.updateSortAndFilter();\r\n          }\r\n          break;\r\n      }\r\n    }\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { closeForm } from \"model/actions/closeForm\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { getOpenedScreen } from \"model/selectors/getOpenedScreen\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { closingScreens } from \"model/entities/FormScreenLifecycle/FormScreenLifecycle\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\n\r\nexport function onScreenTabCloseMouseDown(ctx: any) {\r\n  return function (event: any) {\r\n    // OMG, how ugly is this...\r\n    const openedScreen = getOpenedScreen(ctx);\r\n    if (openedScreen) {\r\n      openedScreen.isBeingClosed = true;\r\n    }\r\n  };\r\n}\r\n\r\n\r\nexport function onScreenTabCloseClick(ctx: any) {\r\n  return flow(function*onFormTabCloseClick(event: any, isDueToError?: boolean) {\r\n    const openedScreen = getOpenedScreen(ctx);\r\n    let dataViews = openedScreen.content?.formScreen?.dataViews ?? [];\r\n    for (const dataView of dataViews) {\r\n      getTablePanelView(dataView)?.setEditing(false);\r\n    }\r\n    try {\r\n      event?.stopPropagation?.();\r\n      // TODO: Wait for other async operation to finish?\r\n      if (closingScreens.has(openedScreen)) return;\r\n      closingScreens.add(openedScreen);\r\n      // TODO: Better lifecycle handling\r\n      if (openedScreen.content && !openedScreen.content.isLoading) {\r\n        const lifecycle = getFormScreenLifecycle(openedScreen.content.formScreen!);\r\n        yield*lifecycle.onRequestScreenClose(isDueToError);\r\n      } else {\r\n        yield*closeForm(ctx)();\r\n      }\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    } finally {\r\n      closingScreens.delete(openedScreen);\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { onScreenTabCloseClick } from \"model/actions-ui/ScreenTabHandleRow/onScreenTabCloseClick\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport React, { PropsWithChildren } from \"react\";\r\n\r\nexport class ErrorBoundary extends React.Component<{\r\n  onErrorCaught?: (error: any, errorInfo: any) => void;\r\n}> {\r\n  componentDidCatch(error: any, errorInfo: any) {\r\n    console.log(\"CAUGHT ERROR:\", error, errorInfo); // eslint-disable-line no-console\r\n    this.props.onErrorCaught?.(error, errorInfo);\r\n  }\r\n\r\n  render() {\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\nexport class ErrorBoundaryEncapsulated extends React.Component<PropsWithChildren<{ ctx: any }>> {\r\n  handleScreenError(error: any) {\r\n    const self = this;\r\n    flow(function*() {\r\n      try {\r\n        yield*handleError(self.props.ctx)(error);\r\n      } catch (e) {\r\n      } finally {\r\n        yield onScreenTabCloseClick(self.props.ctx)(undefined, true);\r\n      }\r\n    })();\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <ErrorBoundary onErrorCaught={(error) => this.handleScreenError(error)}>\r\n        {this.props.children}\r\n      </ErrorBoundary>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { getWorkbenchLifecycle } from \"model/selectors/getWorkbenchLifecycle\";\r\nimport { getOpenedScreen } from \"model/selectors/getOpenedScreen\";\r\nimport { handleError } from \"model/actions/handleError\";\r\n\r\nexport function onScreenTabHandleClick(ctx: any) {\r\n  return flow(function*onScreenTabHandleClick(event: any) {\r\n    try {\r\n      const screen = getOpenedScreen(ctx);\r\n      yield*getWorkbenchLifecycle(ctx).onScreenTabHandleClick(event, screen);\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { TabbedViewHandle } from \"gui/Components/TabbedView/TabbedViewHandle\";\r\nimport { TabbedViewHandleRow } from \"gui/Components/TabbedView/TabbedViewHandleRow\";\r\nimport { ErrorBoundaryEncapsulated } from \"gui/Components/Utilities/ErrorBoundary\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport {\r\n  onScreenTabCloseClick,\r\n  onScreenTabCloseMouseDown\r\n} from \"model/actions-ui/ScreenTabHandleRow/onScreenTabCloseClick\";\r\nimport { onScreenTabHandleClick } from \"model/actions-ui/ScreenTabHandleRow/onScreenTabHandleClick\";\r\nimport { IOpenedScreen } from \"model/entities/types/IOpenedScreen\";\r\nimport { IWorkbench } from \"model/entities/types/IWorkbench\";\r\nimport { getIsFormScreenDirty } from \"model/selectors/FormScreen/getisFormScreenDirty\";\r\nimport { getOpenedNonDialogScreenItems } from \"model/selectors/getOpenedNonDialogScreenItems\";\r\nimport React from \"react\";\r\n\r\n@observer\r\nexport class CScreenTabbedViewHandleRow extends React.Component {\r\n  static contextType = MobXProviderContext;\r\n\r\n  get workbench(): IWorkbench {\r\n    return this.context.workbench;\r\n  }\r\n\r\n  render() {\r\n    const openedScreenItems = getOpenedNonDialogScreenItems(this.workbench);\r\n\r\n    return (\r\n      <TabbedViewHandleRow>\r\n        {openedScreenItems.map((item) => (\r\n          <ErrorBoundaryEncapsulated ctx={item} key={`${item.menuItemId}@${item.order}`}>\r\n            <CScreenTabbedViewHandle item={item}/>\r\n          </ErrorBoundaryEncapsulated>\r\n        ))}\r\n      </TabbedViewHandleRow>\r\n    );\r\n  }\r\n}\r\n\r\n@observer\r\nclass CScreenTabbedViewHandle extends React.Component<{ item: IOpenedScreen }> {\r\n\r\n  render() {\r\n    const {item} = this.props;\r\n    const label = getLabel(item);\r\n    return (\r\n      <TabbedViewHandle\r\n        title={label}\r\n        key={`${item.menuItemId}@${item.order}`}\r\n        isActive={item.isActive}\r\n        hasCloseBtn={true}\r\n        isDirty={getIsFormScreenDirty(item)}\r\n        onClick={(event: any) => onScreenTabHandleClick(item)(event)}\r\n        onCloseClick={(event: any) => onScreenTabCloseClick(item)(event)}\r\n        onCloseMouseDown={(event: any) => onScreenTabCloseMouseDown(item)(event)}\r\n      >\r\n        {label}\r\n      </TabbedViewHandle>\r\n    );\r\n  }\r\n}\r\n\r\nexport function getLabel(item: IOpenedScreen | undefined) {\r\n  if(!item){\r\n    return \"\";\r\n  }\r\n  const text = item.tabTitle;\r\n  const order = item.order > 0 && !item.hasDynamicTitle ? `[${item.order}]` : \"\";\r\n  return [text, order].join(\" \");\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from 'gui/Components/ScreenToolbar/ScreenToolbar.module.scss';\r\n\r\n\r\nexport class ScreenToolbar extends React.Component {\r\n  render() {\r\n    return <div className={S.root}>{this.props.children}</div>;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport S from \"gui/Components/ScreenToolbar/ScreenToolbarAction.module.scss\";\r\nimport React from \"react\";\r\nimport cx from \"classnames\";\r\nimport { action } from \"mobx\";\r\n\r\nexport class ScreenToolbarAction extends React.Component<{\r\n  icon?: React.ReactNode;\r\n  label?: string;\r\n  isHidden?: boolean;\r\n  rootRef?: any;\r\n  className?: string;\r\n  onMouseDown?(event: any): void;\r\n  onClick?(event: any): void;\r\n  onShortcut?(event: any): void;\r\n  shortcutPredicate?(event: any): boolean;\r\n  id?: string;\r\n}> {\r\n  @action.bound\r\n  handleWindowKeyDown(event: any) {\r\n    if (this.props.shortcutPredicate?.(event)) {\r\n      event.preventDefault();\r\n      this.props.onShortcut?.(event);\r\n    }\r\n  }\r\n\r\n  kbdHandlerUp() {\r\n    window.addEventListener(\"keydown\", this.handleWindowKeyDown);\r\n  }\r\n\r\n  kbdHandlerDown() {\r\n    window.removeEventListener(\"keydown\", this.handleWindowKeyDown);\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (this.props.onShortcut && this.props.shortcutPredicate) {\r\n      this.kbdHandlerUp();\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(prevProps: any) {\r\n    if (\r\n      (!prevProps.onShortcut || !prevProps.shortcutPredicate) &&\r\n      this.props.onShortcut &&\r\n      this.props.shortcutPredicate\r\n    ) {\r\n      this.kbdHandlerUp();\r\n    } else if (\r\n      prevProps.onShortcut &&\r\n      prevProps.shortcutPredicate &&\r\n      (!this.props.onShortcut || !this.props.shortcutPredicate)\r\n    ) {\r\n      this.kbdHandlerDown();\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.kbdHandlerDown();\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div\r\n        ref={this.props.rootRef}\r\n        className={cx(\r\n          S.root,\r\n          {isLabelless: !this.props.label, isHidden: this.props.isHidden},\r\n          this.props.className\r\n        )}\r\n        onMouseDown={this.props.onMouseDown}\r\n        onClick={this.props.onClick}\r\n        id={this.props.id}\r\n        title={this.props.label}\r\n      >\r\n        {this.props.icon && <div className={S.icon}>{this.props.icon}</div>}\r\n        {this.props.label && <div className={S.label}>{this.props.label}</div>}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/ScreenToolbar/ScreenToolbarPusher.module.scss\";\r\n\r\nexport class ScreenToolbarPusher extends React.Component {\r\n  render() {\r\n    return <div className={S.root}/>;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { getApplicationLifecycle } from \"model/selectors/getApplicationLifecycle\";\r\nimport { handleError } from \"model/actions/handleError\";\r\n\r\nexport function onScreenToolbarLogoutClick(ctx: any) {\r\n  return flow(function*onScreenToolbarLogoutClick(event: any) {\r\n    try {\r\n      yield*getApplicationLifecycle(ctx).onSignOutClick({event});\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/ScreenToolbar/ScreenToolbarActionGroup.module.scss\";\r\nimport cx from \"classnames\";\r\n\r\nexport class ScreenToolbarActionGroup extends React.Component<{\r\n  domRef?: any;\r\n  grovable?: boolean;\r\n}> {\r\n  render() {\r\n    return (\r\n      <div ref={this.props.domRef} className={cx(S.root, {grovable: this.props.grovable})}>\r\n        {this.props.children}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\n\r\n// TODO: Move to ui actions\r\nexport function onSaveSessionClick(ctx: any) {\r\n  return flow(function*onSaveSessionClick() {\r\n    try {\r\n      yield*getFormScreenLifecycle(ctx).onSaveSession();\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getOpenedScreens } from \"./getOpenedScreens\";\r\n\r\nexport function getActiveScreenActions(ctx: any) {\r\n  return getOpenedScreens(ctx).activeScreenActions;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/UserMenuDropdown/UserMenuDropdown.module.scss\";\r\n\r\nexport const UserMenuBlock: React.FC<{\r\n  userName: string;\r\n  avatarLink: string | undefined;\r\n  actionItems: React.ReactNode;\r\n}> = props => (\r\n  <div className={S.root}>\r\n    <div className={S.avatarSection}>\r\n      <div className={S.pictureSection}>\r\n        <div className={S.avatarContainer}>\r\n          <img className={S.avatar} src={props.avatarLink} alt=\"\"/>\r\n        </div>\r\n      </div>\r\n      <div className={S.infoSection}>{props.userName}</div>\r\n    </div>\r\n    <div className={S.actionSection}>\r\n      <div className={S.menuItemDivider}/>\r\n      {props.actionItems}\r\n    </div>\r\n  </div>\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { Dropdown } from \"gui/Components/Dropdown/Dropdown\";\r\nimport { Dropdowner } from \"gui/Components/Dropdowner/Dropdowner\";\r\nimport { UserMenuBlock } from \"gui/Components/UserMenuDropdown/UserMenuBlock\";\r\nimport { DropdownItem } from \"gui/Components/Dropdown/DropdownItem\";\r\nimport { T } from \"utils/translation\";\r\nimport S from \"gui/Components/UserMenuDropdown/UserMenuDropdown.module.scss\";\r\nimport cx from \"classnames\";\r\n\r\nexport const UserMenuDropdown: React.FC<{\r\n  handleLogoutClick: (event: any) => void,\r\n  avatarLink: string | undefined,\r\n  userName?: string,\r\n  hideLabel?: boolean,\r\n  ctx: any,\r\n  onAboutClick: ()=> void;\r\n  helpUrl: string | undefined\r\n}> = (props) => {\r\n\r\n  function onHelpClick() {\r\n    window.open(props.helpUrl);\r\n  }\r\n\r\n  return (\r\n    <Dropdowner\r\n      style={{width: \"auto\"}} // TODO: Move to stylesheet\r\n      trigger={({refTrigger, setDropped}) => (\r\n        <div\r\n          ref={refTrigger}\r\n          onMouseDown={() => setDropped(true)}>\r\n          <div className={S.avatarSection}>\r\n            <div className={S.pictureSection}>\r\n              <div className={S.avatarContainer}>\r\n                <img className={cx(S.avatar, S.clickableAvatar)} src={props.avatarLink} alt=\"\"/>\r\n              </div>\r\n            </div>\r\n            {!props.hideLabel && <div className={S.userNameLabel}>{props.userName}</div>}\r\n          </div>\r\n        </div>\r\n      )}\r\n      content={({setDropped}) => (\r\n        <Dropdown>\r\n          <UserMenuBlock\r\n            userName={props.userName || \"Logged user\"}\r\n            avatarLink={props.avatarLink}\r\n            actionItems={\r\n              <>\r\n                {props.helpUrl && props.helpUrl.trim() !== \"\" &&\r\n                <DropdownItem\r\n                  onClick={() => {\r\n                    setDropped(false);\r\n                    onHelpClick();\r\n                  }}>\r\n                  {T(\"Help\", \"help_button\")}\r\n                </DropdownItem>}\r\n                <DropdownItem\r\n                  onClick={() => {\r\n                    setDropped(false);\r\n                    props.onAboutClick();\r\n                  }}>\r\n                  {T(\"About\", \"about_application\")}\r\n                </DropdownItem>\r\n                <DropdownItem onClick={props.handleLogoutClick} className=\"redItem\">\r\n                  {T(\"Log out\", \"sign_out_tool_tip\")}\r\n                </DropdownItem>\r\n              </>\r\n            }\r\n          />\r\n        </Dropdown>\r\n      )}\r\n    />);\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbenchLifecycle } from \"model/selectors/getWorkbenchLifecycle\";\r\n\r\nexport function getLoggedUserName(ctx: any): string | undefined {\r\n  return getWorkbenchLifecycle(ctx).userInfo?.userName;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport interface IWebScreen {\r\n  $type_IWebScreen: 1;\r\n\r\n  reload(): void;\r\n\r\n  setReloader(reloader: IReloader | null): void;\r\n\r\n  setTitle(title: string): void;\r\n}\r\n\r\nexport interface IReloader {\r\n  reload(): void;\r\n}\r\n\r\nexport const isIWebScreen = (o: any): o is IWebScreen => o.$type_IWebScreen;\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { isIWebScreen } from \"model/entities/types/IWebScreen\";\r\n\r\nexport function getWebScreen(ctx: any) {\r\n  let cn = ctx;\r\n  while (true) {\r\n    if (isIWebScreen(cn)) {\r\n      return cn;\r\n    }\r\n    cn = cn.parent;\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbenchLifecycle } from \"model/selectors/getWorkbenchLifecycle\";\r\n\r\nexport function getUserAvatarLink(ctx: any): string | undefined {\r\n  return getWorkbenchLifecycle(ctx).userInfo?.avatarLink;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbenchLifecycle } from \"model/selectors/getWorkbenchLifecycle\";\r\n\r\nexport function getCustomAssetsRoute(ctx: any): string | undefined {\r\n  return getWorkbenchLifecycle(ctx).customAssetsRoute;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbenchLifecycle } from \"model/selectors/getWorkbenchLifecycle\";\r\n\r\nexport function getHelpUrl(ctx: any): string | undefined {\r\n  return getWorkbenchLifecycle(ctx).portalSettings?.helpUrl;\r\n}","import { About } from \"model/entities/AboutInfo\";\r\nimport { getWorkbench } from \"model/selectors/getWorkbench\";\r\n\r\nexport function getAbout(ctx: any): About {\r\n  return getWorkbench(ctx).about;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/Dialogs/AboutView.module.scss\";\r\nimport { IAboutInfo } from \"model/entities/types/IAboutInfo\";\r\n\r\nexport class AboutView extends React.Component<{aboutInfo: IAboutInfo}> {\r\n  render() {\r\n    const commitId = (window as any).ORIGAM_CLIENT_REVISION_HASH;\r\n    const commitDate = (window as any).ORIGAM_CLIENT_REVISION_DATE;\r\n    return (\r\n      <div className={S.root}>\r\n        <div>Server version:</div>\r\n        <div className={S.version}>{this.props.aboutInfo.serverVersion}</div>\r\n        <br/>\r\n        <div>Client version:</div>\r\n        <div className={S.version}>\r\n          <div>{\"Commit ID: \"}\r\n            <a href={\"https://github.com/origam/origam-html/commit/\" + commitId}>{commitId}</a>\r\n          </div>\r\n          <div>Commit Date: {commitDate}</div>\r\n        </div>\r\n        <br/>\r\n        <div>\r\n          <a href={\"/Attributions.txt\"} target=\"_blank\" rel=\"noreferrer\">Copyright attributions</a>\r\n        </div>\r\n        <br/>\r\n        <div>Copyright 2020 Advantage Solutions, s. r. o.</div>\r\n        <br/>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { T } from \"utils/translation\";\r\nimport CS from \"gui/Components/Dialogs/DialogsCommon.module.css\";\r\nimport S from \"gui/Components/Dialogs/AboutDialog.module.scss\";\r\nimport { IAboutInfo } from \"model/entities/types/IAboutInfo\";\r\nimport { AboutView } from \"gui/Components/Dialogs/AboutView\";\r\nimport { ModalDialog } from \"gui/Components/Dialog/ModalDialog\";\r\n\r\n@observer\r\nexport class AboutDialog extends React.Component<{\r\n  aboutInfo: IAboutInfo;\r\n  onOkClick: () => void;\r\n}> {\r\n  render() {\r\n    return (\r\n      <ModalDialog\r\n        title={T(\"About\", \"about_application\")}\r\n        titleButtons={null}\r\n        buttonsCenter={\r\n          <>\r\n            <button tabIndex={0} onClick={() => this.props.onOkClick()}>\r\n              {T(\"Ok\", \"button_ok\")}\r\n            </button>\r\n          </>\r\n        }\r\n        buttonsLeft={null}\r\n        buttonsRight={null}\r\n      >\r\n        <div className={CS.dialogContent + \" \" + S.contentArea}>\r\n         <AboutView aboutInfo={this.props.aboutInfo}/>\r\n        </div>\r\n      </ModalDialog>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFormScreen } from \"./getFormScreen\";\r\n\r\nexport function getIsSuppressRefresh(ctx: any) {\r\n  return getFormScreen(ctx).suppressRefresh;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getActiveScreen } from \"model/selectors/getActiveScreen\";\r\nimport { IFormScreen } from \"model/entities/types/IFormScreen\";\r\nimport { getIsSuppressSave } from \"model/selectors/FormScreen/getIsSuppressSave\";\r\nimport { getIsSuppressRefresh } from \"model/selectors/FormScreen/getIsSuppressRefresh\";\r\n\r\nexport function geScreenActionButtonsState(ctx: any): IScreenActionButtonsState | undefined{\r\n  const activeScreen = getActiveScreen(ctx);\r\n  if (activeScreen && !activeScreen.content) return undefined;\r\n  const formScreen =\r\n    activeScreen && !activeScreen.content.isLoading ? activeScreen.content.formScreen : undefined;\r\n  const isDirty = formScreen && formScreen.isDirty;\r\n  let actionButtonsVisible = !!formScreen;\r\n\r\n  return {\r\n    actionButtonsVisible: actionButtonsVisible,\r\n    formScreen: formScreen,\r\n    isSaveButtonVisible: actionButtonsVisible && !getIsSuppressSave(formScreen),\r\n    isRefreshButtonVisible: actionButtonsVisible && !getIsSuppressRefresh(formScreen),\r\n    isDirty: !!isDirty,\r\n  };\r\n}\r\n\r\nexport interface IScreenActionButtonsState {\r\n  actionButtonsVisible: boolean;\r\n  formScreen: IFormScreen | undefined;\r\n  isSaveButtonVisible: boolean;\r\n  isRefreshButtonVisible: boolean;\r\n  isDirty: boolean;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Icon } from \"@origam/components\";\r\nimport { ScreenToolbar } from \"gui/Components/ScreenToolbar/ScreenToolbar\";\r\nimport { ScreenToolbarAction } from \"gui/Components/ScreenToolbar/ScreenToolbarAction\";\r\nimport { ScreenToolbarPusher } from \"gui/Components/ScreenToolbar/ScreenToolbarPusher\";\r\nimport { MobXProviderContext, Observer, observer } from \"mobx-react\";\r\nimport { IApplication } from \"model/entities/types/IApplication\";\r\nimport React, { Fragment } from \"react\";\r\nimport { action } from \"mobx\";\r\nimport { onScreenToolbarLogoutClick } from \"model/actions-ui/ScreenToolbar/onScreenToolbarLogoutClick\";\r\nimport { openSearchWindow } from \"model/actions-ui/ScreenToolbar/openSearchWindow\";\r\nimport { ScreenToolbarActionGroup } from \"gui/Components/ScreenToolbar/ScreenToolbarActionGroup\";\r\nimport { getActiveScreen } from \"model/selectors/getActiveScreen\";\r\nimport { onSaveSessionClick } from \"model/actions-ui/ScreenToolbar/onSaveSessionClick\";\r\nimport { onRefreshSessionClick } from \"model/actions-ui/ScreenToolbar/onRefreshSessionClick\";\r\nimport { getActiveScreenActions } from \"model/selectors/getActiveScreenActions\";\r\nimport { getIsEnabledAction } from \"model/selectors/Actions/getIsEnabledAction\";\r\nimport uiActions from \"model/actions-ui-tree\";\r\nimport { Dropdowner } from \"gui/Components/Dropdowner/Dropdowner\";\r\nimport { UserMenuDropdown } from \"gui/Components/UserMenuDropdown/UserMenuDropdown\";\r\nimport { getLoggedUserName } from \"model/selectors/User/getLoggedUserName\";\r\nimport { onReloadWebScreenClick } from \"model/actions-ui/ScreenToolbar/onReloadWebScreen\";\r\nimport { isIFormScreenEnvelope } from \"model/entities/types/IFormScreen\";\r\nimport { isIWebScreen } from \"model/entities/types/IWebScreen\";\r\nimport { Dropdown } from \"gui/Components/Dropdown/Dropdown\";\r\nimport { IAction, IActionType } from \"model/entities/types/IAction\";\r\nimport { T } from \"utils/translation\";\r\nimport { getUserAvatarLink } from \"model/selectors/User/getUserAvatarLink\";\r\nimport { getCustomAssetsRoute } from \"model/selectors/User/getCustomAssetsRoute\";\r\nimport { DropdownItem } from \"gui/Components/Dropdown/DropdownItem\";\r\nimport { getHelpUrl } from \"model/selectors/User/getHelpUrl\";\r\nimport { getAbout } from \"model/selectors/getAbout\";\r\nimport { About } from \"model/entities/AboutInfo\";\r\nimport { showDialog } from \"model/selectors/getDialogStack\";\r\nimport { AboutDialog } from \"gui/Components/Dialogs/AboutDialog\";\r\nimport { geScreenActionButtonsState } from \"model/actions-ui/ScreenToolbar/saveBottonVisible\";\r\n\r\nfunction isSaveShortcut(event: any) {\r\n  return event.key === \"s\" && (event.ctrlKey || event.metaKey);\r\n}\r\n\r\nfunction isRefreshShortcut(event: any) {\r\n  return event.key === \"r\" && (event.ctrlKey || event.metaKey);\r\n}\r\n\r\n@observer\r\nexport class CScreenToolbar extends React.Component<{}> {\r\n  static contextType = MobXProviderContext;\r\n\r\n  state = {\r\n    hiddenActionIds: new Set<string>(),\r\n  };\r\n\r\n  get application(): IApplication {\r\n    return this.context.application;\r\n  }\r\n\r\n  get about(): About {\r\n    return getAbout(this.application);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.about.update();\r\n  }\r\n\r\n  onAboutClick() {\r\n    const closeDialog = showDialog(this.application,\r\n      \"\",\r\n      <AboutDialog\r\n        aboutInfo={this.about.info}\r\n        onOkClick={() => {\r\n          closeDialog();\r\n        }}\r\n      />\r\n    );\r\n  }\r\n\r\n  @action.bound\r\n  handleLogoutClick(event: any) {\r\n    onScreenToolbarLogoutClick(this.application)(event);\r\n  }\r\n\r\n  getOverfullActionsDropdownContent(\r\n    toolbarActions: Array<{\r\n      section: string;\r\n      actions: IAction[];\r\n    }>,\r\n    actionFilter: ((action: IAction) => boolean) | undefined,\r\n    setDropped: (state: boolean) => void\r\n  ) {\r\n    const customAssetsRoute = getCustomAssetsRoute(this.application);\r\n\r\n    const iconsWillBeShown = toolbarActions\r\n      .flatMap((toolbar) => toolbar.actions)\r\n      .some((action) => action.iconUrl);\r\n\r\n    function getIcon(action: IAction) {\r\n      if (action.iconUrl) {\r\n        return <Icon src={customAssetsRoute + \"/\" + action.iconUrl}/>;\r\n      }\r\n      return iconsWillBeShown ? <div/> : null;\r\n    }\r\n\r\n    return toolbarActions\r\n      .filter((actionGroup) => actionGroup.actions.length > 0)\r\n      .map((actionGroup) => (\r\n        <Fragment key={actionGroup.section}>\r\n          {/*{this.renderActions(actionGroup.actions)}*/}\r\n          {actionGroup.actions\r\n            .filter(\r\n              (action) => (actionFilter ? actionFilter(action) : true) && getIsEnabledAction(action)\r\n            )\r\n            .map((action, idx) => (\r\n              <DropdownItem>\r\n                <ScreenToolbarAction\r\n                  icon={getIcon(action)}\r\n                  label={action.caption}\r\n                  onClick={(event) =>\r\n                  {\r\n                    uiActions.actions.onActionClick(action)(event, action);\r\n                    setDropped(false)\r\n                  }\r\n                }\r\n                />\r\n              </DropdownItem>\r\n            ))}\r\n        </Fragment>\r\n      ));\r\n  }\r\n\r\n  renderActions(actions: IAction[]) {\r\n    const actionsToRender = actions.filter((action) => getIsEnabledAction(action));\r\n    return actionsToRender\r\n      .filter((action) => !action.groupId)\r\n      .map((action, idx) => this.renderAction(action, actionsToRender, idx));\r\n  }\r\n\r\n  renderAction(action: IAction, actionsToRender: IAction[], order: number) {\r\n    const customAssetsRoute = getCustomAssetsRoute(this.application);\r\n    if (action.type === IActionType.Dropdown) {\r\n      const childActions = actionsToRender.filter(\r\n        (otherAction) => otherAction.groupId === action.id\r\n      );\r\n      return (\r\n        <Dropdowner\r\n          style={{width: \"auto\"}}\r\n          trigger={({refTrigger, setDropped, isDropped}) => (\r\n            <Observer key={action.id}>\r\n              {() => (\r\n                <ScreenToolbarAction\r\n                  rootRef={refTrigger}\r\n                  onMouseDown={() => setDropped(true)}\r\n                  className={isDropped ? \"isActiveDropDownAction\" : \"\"}\r\n                  icon={\r\n                    action.iconUrl ? (\r\n                      <Icon src={customAssetsRoute + \"/\" + action.iconUrl}/>\r\n                    ) : undefined\r\n                  }\r\n                  label={action.caption}\r\n                />\r\n              )}\r\n            </Observer>\r\n          )}\r\n          content={args => (\r\n            <Dropdown>\r\n              {this.getOverfullActionsDropdownContent(\r\n                [{section: \"\", actions: childActions}],\r\n                undefined,\r\n                args.setDropped\r\n              )}\r\n            </Dropdown>\r\n          )}\r\n        />\r\n      );\r\n    }\r\n    return (\r\n      <Observer key={action.id}>\r\n        {() => (\r\n          <ScreenToolbarAction\r\n            icon={\r\n              action.iconUrl ? <Icon src={customAssetsRoute + \"/\" + action.iconUrl}/> : undefined\r\n            }\r\n            label={action.caption}\r\n            onClick={(event) => {\r\n              uiActions.actions.onActionClick(action)(event, action);\r\n            }\r\n          }\r\n          />\r\n        )}\r\n      </Observer>\r\n    );\r\n  }\r\n\r\n  renderForFormScreen() {\r\n    const actionButtonsState = geScreenActionButtonsState(this.application);\r\n    if(!actionButtonsState){\r\n      return null;\r\n    }\r\n    const toolbarActions = getActiveScreenActions(this.application);\r\n    const userName = getLoggedUserName(this.application);\r\n    const avatarLink = getUserAvatarLink(this.application);\r\n    return (\r\n      <ScreenToolbar>\r\n        {actionButtonsState.actionButtonsVisible ? (\r\n          <>\r\n            <ScreenToolbarActionGroup>\r\n              {actionButtonsState.isSaveButtonVisible && (\r\n                <ScreenToolbarAction\r\n                  className={actionButtonsState.isDirty ? \"isRed isHoverGreen\" : \"\"}\r\n                  onClick={onSaveSessionClick(actionButtonsState.formScreen)}\r\n                  onShortcut={onSaveSessionClick(actionButtonsState.formScreen)}\r\n                  id={\"saveButton\"}\r\n                  shortcutPredicate={isSaveShortcut}\r\n                  icon={\r\n                    <Icon\r\n                      src=\"./icons/save.svg\"\r\n                      className={actionButtonsState.isDirty ? \"isRed isHoverGreen\" : \"\"}\r\n                      tooltip={T(\"Save\", \"save_tool_tip\")}\r\n                    />\r\n                  }\r\n                  label={T(\"Save\", \"save_tool_tip\")}\r\n                />\r\n              )}\r\n              {actionButtonsState.isRefreshButtonVisible && (\r\n                <ScreenToolbarAction\r\n                  onClick={onRefreshSessionClick(actionButtonsState.formScreen)}\r\n                  onShortcut={onRefreshSessionClick(actionButtonsState.formScreen)}\r\n                  id={\"refreshButton\"}\r\n                  shortcutPredicate={isRefreshShortcut}\r\n                  icon={\r\n                    <Icon src=\"./icons/refresh.svg\" tooltip={T(\"Refresh\", \"refresh_tool_tip\")}/>\r\n                  }\r\n                  label={T(\"Refresh\", \"refresh_tool_tip\")}\r\n                />\r\n              )}\r\n            </ScreenToolbarActionGroup>\r\n            <Observer>\r\n              {() => (\r\n                <ScreenToolbarActionGroup grovable={true}>\r\n                  {toolbarActions\r\n                    .filter((actionGroup) => actionGroup.actions.length > 0)\r\n                    .map((actionGroup) => (\r\n                      <ScreenToolbarActionGroup key={actionGroup.section}>\r\n                        {this.renderActions(actionGroup.actions)}\r\n                      </ScreenToolbarActionGroup>\r\n                    ))}\r\n                </ScreenToolbarActionGroup>\r\n              )}\r\n            </Observer>\r\n          </>\r\n        ) : null}\r\n        {this.state.hiddenActionIds.size > 0 && (\r\n          <Dropdowner\r\n            style={{width: \"auto\"}}\r\n            trigger={({refTrigger, setDropped}) => (\r\n              <ScreenToolbarAction\r\n                rootRef={refTrigger}\r\n                onMouseDown={() => setDropped(true)}\r\n                icon={<Icon src=\"./icons/dot-menu.svg\" tooltip={\"\"}/>}\r\n              />\r\n            )}\r\n            content={(args) => (\r\n              <Dropdown>\r\n                {this.getOverfullActionsDropdownContent(\r\n                  toolbarActions,\r\n                  action => this.state.hiddenActionIds.has(action.id),\r\n                  args.setDropped\r\n                )}\r\n              </Dropdown>\r\n            )}\r\n          />\r\n        )}\r\n        <ScreenToolbarAction\r\n          onClick={() => openSearchWindow(this.application)}\r\n          icon={<Icon src=\"./icons/search.svg\"/>}\r\n        />\r\n        <UserMenuDropdown\r\n          avatarLink={avatarLink}\r\n          userName={userName}\r\n          handleLogoutClick={(event) => this.handleLogoutClick(event)}\r\n          ctx={this.application}\r\n          onAboutClick={() => this.onAboutClick()}\r\n          helpUrl={getHelpUrl(this.application)}\r\n        />\r\n      </ScreenToolbar>\r\n    );\r\n  }\r\n\r\n  renderForWebScreen() {\r\n    const activeScreen = getActiveScreen(this.application);\r\n    const userName = getLoggedUserName(this.application);\r\n    const avatarLink = getUserAvatarLink(this.application);\r\n    return (\r\n      <ScreenToolbar>\r\n        <>\r\n          <ScreenToolbarActionGroup>\r\n            <ScreenToolbarAction\r\n              onMouseDown={onReloadWebScreenClick(activeScreen)}\r\n              icon={<Icon src=\"./icons/refresh.svg\" tooltip={T(\"Refresh\", \"refresh_tool_tip\")}/>}\r\n              label={T(\"Refresh\", \"refresh_tool_tip\")}\r\n            />\r\n          </ScreenToolbarActionGroup>\r\n        </>\r\n        <ScreenToolbarPusher/>\r\n        <ScreenToolbarAction\r\n          onClick={() => openSearchWindow(this.application)}\r\n          icon={<Icon src=\"./icons/search.svg\"/>}\r\n        />\r\n        <UserMenuDropdown\r\n          avatarLink={avatarLink}\r\n          userName={userName}\r\n          handleLogoutClick={(event) => this.handleLogoutClick(event)}\r\n          ctx={this.application}\r\n          onAboutClick={() => this.onAboutClick()}\r\n          helpUrl={getHelpUrl(this.application)}\r\n        />\r\n      </ScreenToolbar>\r\n    );\r\n  }\r\n\r\n  renderDefault() {\r\n    const userName = getLoggedUserName(this.application);\r\n    const avatarLink = getUserAvatarLink(this.application);\r\n    return (\r\n      <ScreenToolbar>\r\n        <ScreenToolbarPusher/>\r\n        {/*<ScreenToolbarAction\r\n          icon={<Icon src=\"./icons/search.svg\" />}\r\n          label=\"Search\"\r\n        />*/}\r\n        <ScreenToolbarAction\r\n          onClick={() => openSearchWindow(this.application)}\r\n          icon={<Icon src=\"./icons/search.svg\"/>}\r\n        />\r\n        <UserMenuDropdown\r\n          avatarLink={avatarLink}\r\n          userName={userName}\r\n          handleLogoutClick={(event) => this.handleLogoutClick(event)}\r\n          ctx={this.application}\r\n          onAboutClick={() => this.onAboutClick()}\r\n          helpUrl={getHelpUrl(this.application)}\r\n        />\r\n      </ScreenToolbar>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const activeScreen = getActiveScreen(this.application);\r\n    if (!activeScreen) {\r\n      return this.renderDefault();\r\n    }\r\n    if (activeScreen.content && isIFormScreenEnvelope(activeScreen.content)) {\r\n      return this.renderForFormScreen();\r\n    }\r\n    if (isIWebScreen(activeScreen)) {\r\n      return this.renderForWebScreen();\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getWebScreen } from \"model/selectors/WebScreen/getWebScreen\";\r\n\r\n// TODO: Move to ui actions\r\nexport function onReloadWebScreenClick(ctx: any) {\r\n  return flow(function*onReloadWebScreenClick() {\r\n    try {\r\n      getWebScreen(ctx).reload();\r\n      //yield* getFormScreenLifecycle(ctx).onRequestScreenReload();\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/Sidebar/AlertCounter.module.scss\";\r\n\r\nexport class SidebarAlertCounter extends React.Component {\r\n  render() {\r\n    return <div className={S.root}>{this.props.children}</div>;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/Sidebar/LogoSection.module.scss\";\r\n\r\nexport class LogoSection extends React.Component {\r\n  render() {\r\n    return <div className={S.root}>{this.props.children}</div>;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport \"gui/Components/Sidebar/Sidebar.module.scss\";\r\nimport React from \"react\";\r\n\r\nexport const Sidebar: React.FC = props => (\r\n  <div className={\"sidebar\"}>{props.children}</div>\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport cx from \"classnames\";\r\nimport S from \"gui/Components/Sidebar/SidebarSection.module.scss\";\r\n\r\nexport class SidebarSection extends React.Component<{ isActive: boolean }> {\r\n  render() {\r\n    return (\r\n      <div\r\n        className={cx(S.root, {\r\n          isActive: this.props.isActive\r\n        })}\r\n      >\r\n        {this.props.children}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from 'gui/Components/Sidebar/SidebarSectionDivider.module.scss';\r\n\r\nexport class SidebarSectionDivider extends React.Component {\r\n  render() {\r\n    return (\r\n      <div\r\n        className={S.root}\r\n      />\r\n    );\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport cx from \"classnames\";\r\nimport S from \"gui/Components/Sidebar/SidebarSectionHeader.module.scss\";\r\n\r\nexport class SidebarSectionHeader extends React.Component<{\r\n  icon: React.ReactNode;\r\n  label: React.ReactNode;\r\n  isActive: boolean;\r\n  onClick?(event: any): void;\r\n  refDom?: any;\r\n  onContextMenu?: (event: any) => void;\r\n  id?: string;\r\n}> {\r\n  render() {\r\n    return (\r\n      <a\r\n        id={this.props.id}\r\n        ref={this.props.refDom}\r\n        className={cx(S.root, {\r\n          isActive: this.props.isActive\r\n        })}\r\n        onClick={this.props.onClick}\r\n        onContextMenu={this.props.onContextMenu}\r\n      >\r\n        <div className={S.icon}>{this.props.icon}</div>\r\n        <div className={S.label}>{this.props.label}</div>\r\n      </a>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/MainMenu/MainMenuUL.module.scss\";\r\n\r\nexport class MainMenuUL extends React.Component {\r\n  render() {\r\n    return <ul className={S.root}>{this.props.children}</ul>;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/MainMenu/MainMenuLI.module.scss\";\r\n\r\nexport class MainMenuLI extends React.Component {\r\n  render() {\r\n    return <li className={S.root}>{this.props.children}</li>;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\n\r\nimport cx from \"classnames\";\r\n\r\nimport S from \"gui/Components/MainMenu/MainMenuItem.module.scss\";\r\n\r\nexport class MainMenuItem extends React.Component<{\r\n  /** Content to render as an icon. */\r\n  icon: React.ReactNode;\r\n  /** Content to render as a label. */\r\n  label: string;\r\n  /** Level of nestedness for making tree structured menus. */\r\n  level: number;\r\n  /** Indicates that the item is currently active. */\r\n  isActive: boolean;\r\n  isHidden: boolean;\r\n  isHighLighted?: boolean;\r\n  id?: string;\r\n  isOpenedScreen?: boolean;\r\n  isActiveScreen?: boolean;\r\n\r\n  onClick?(event: any): void;\r\n  onContextMenu?(event: any): void;\r\n  refDom?: any;\r\n}> {\r\n  render() {\r\n    return (\r\n      <div className={S.linkContainer} onContextMenu={this.props.onContextMenu}>\r\n        <a\r\n          ref={this.props.refDom}\r\n          className={cx(S.anchor, {\r\n            isActive: this.props.isActive,\r\n            isHidden: this.props.isHidden,\r\n            isOpenedScreen: this.props.isOpenedScreen,\r\n            isActiveScreen: this.props.isActiveScreen,\r\n            isHighLighted: this.props.isHighLighted,\r\n          })}\r\n          style={{paddingLeft: `${this.props.level * 1.6667}em`}}\r\n          onClick={this.props.onClick}\r\n          title={this.props.label}\r\n        >\r\n          <div className={S.icon}>{this.props.icon}</div>\r\n          <div className={S.label} id={this.props.id}>{this.props.label}</div>\r\n        </a>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getMainMenuEnvelope } from \"./getMainMenuEnvelope\";\r\n\r\nexport function getIsMainMenuLoading(ctx: any) {\r\n  return getMainMenuEnvelope(ctx).isLoading;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { observable } from \"mobx\";\r\nimport { T } from \"utils/translation\";\r\nimport CS from \"gui/Components/Dialogs/DialogsCommon.module.css\";\r\nimport S from \"gui/Components/Dialogs/SaveFilterDialog.module.css\";\r\nimport { FavoriteFolder } from \"model/entities/Favorites\";\r\nimport { IOption, SimpleDropdown } from \"@origam/components\";\r\nimport { ModalDialog } from \"gui/Components/Dialog/ModalDialog\";\r\n\r\n@observer\r\nexport class ChooseFavoriteFolderDialog extends React.Component<{\r\n  onCancelClick: (event: any) => void;\r\n  onOkClick: (selectdFolderId: string) => void;\r\n  favorites: FavoriteFolder[];\r\n}> {\r\n  options: IOption<FavoriteFolder>[];\r\n\r\n  @observable\r\n  selectedOption: IOption<FavoriteFolder>;\r\n\r\n  constructor(props: any) {\r\n    super(props);\r\n    this.options = this.props.favorites.map((favorite) => {\r\n      return {value: favorite, label: favorite.name};\r\n    });\r\n    this.selectedOption = this.options[0];\r\n  }\r\n\r\n  onKeydown(event: React.KeyboardEvent<HTMLSelectElement>) {\r\n    if (event.key === \"Enter\") {\r\n      this.props.onOkClick(this.selectedOption.value.id);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <ModalDialog\r\n        title={T(\"Select Favourites Folder\", \"select_group_title\")}\r\n        titleButtons={null}\r\n        buttonsCenter={\r\n          <>\r\n            <button\r\n              tabIndex={0}\r\n              autoFocus={true}\r\n              onClick={() => this.props.onOkClick(this.selectedOption.value.id)}\r\n            >\r\n              {T(\"Ok\", \"button_ok\")}\r\n            </button>\r\n            <button tabIndex={0} onClick={this.props.onCancelClick}>\r\n              {T(\"Cancel\", \"button_cancel\")}\r\n            </button>\r\n          </>\r\n        }\r\n        buttonsLeft={null}\r\n        buttonsRight={null}\r\n      >\r\n        <div className={CS.dialogContent}>\r\n          <div className={S.inpuContainer}>\r\n            <div className={S.row}>\r\n              <div className={S.label}>{T(\"Name:\", \"group_name\")}</div>\r\n              <SimpleDropdown\r\n                width={\"150px\"}\r\n                options={this.options}\r\n                selectedOption={this.selectedOption}\r\n                onOptionClick={(option) => (this.selectedOption = option)}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </ModalDialog>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport enum IMenuItemIcon {\r\n  Form = \"menu_form.png\",\r\n  Folder = \"menu_folder.png\",\r\n  Workflow = \"menu_workflow.png\",\r\n  Parameter = \"menu_parameter.png\",\r\n  WorkQueue = \"./icons/work-queue.svg\",\r\n  Chat = \"./icons/chat.svg\"\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IMenuItemIcon } from \"gui/Workbench/MainMenu/IMenuItemIcon\";\r\n\r\nexport function getIconUrl(iconName: string | IMenuItemIcon, iconPath?: string) {\r\n  switch (iconName) {\r\n    case IMenuItemIcon.Form:\r\n      return \"./icons/document.svg\";\r\n    case IMenuItemIcon.Workflow:\r\n      return \"./icons/settings.svg\";\r\n    case IMenuItemIcon.WorkQueue:\r\n      return \"./icons/work-queue.svg\";\r\n    case IMenuItemIcon.Chat:\r\n      return \"./icons/chat.svg\";\r\n    case IMenuItemIcon.Folder:\r\n      return \"./icons/folder-closed.svg\";\r\n    default:\r\n      if (iconPath) {\r\n        return iconPath;\r\n      } else {\r\n        return \"./icons/document.svg\";\r\n      }\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"../../actions/handleError\";\r\nimport { getApi } from \"../../selectors/getApi\";\r\n\r\nexport function onResetColumnConfigClick(ctx: any) {\r\n  return flow(function*onMainMenuItemClick(args: {\r\n    item: any;\r\n  }) {\r\n    try {\r\n      if (!args?.item?.attributes?.id) {\r\n        return;\r\n      }\r\n      const api = getApi(ctx);\r\n      yield api.resetScreenColumnConfiguration({instanceId: args.item.attributes.id});\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/Sidebar/SidebarSectionBody.module.scss\";\r\nimport cx from \"classnames\";\r\n\r\nexport const SidebarSectionBody: React.FC<{ isActive?: boolean }> = props => (\r\n  <div className={cx(S.root, {isActive: props.isActive})}>\r\n    {props.children}\r\n  </div>\r\n);\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport S from \"gui/connections/MenuComponents/EditButton.module.scss\";\r\nimport CS from \"gui/connections/MenuComponents/HeaderButton.module.scss\";\r\n\r\n@observer\r\nexport class EditButton extends React.Component<{\r\n  isEnabled: boolean;\r\n  isVisible: boolean;\r\n  onClick: () => void;\r\n  tooltip: string;\r\n}> {\r\n\r\n  getClass() {\r\n    let className = `fas  fa-edit ${CS.headerIcon} ${S.editIcon}`;\r\n    if (!this.props.isVisible && !this.props.isEnabled) {\r\n      className += \" \" + CS.headerIconHidden;\r\n    }\r\n    if (this.props.isEnabled) {\r\n      className += \" \" + CS.headerIconActive\r\n    }\r\n    return className;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <i\r\n        title={this.props.tooltip}\r\n        className={this.getClass()}\r\n        onClick={() => this.props.onClick()}\r\n      />\r\n    )\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { RefObject } from \"react\";\r\nimport { MainMenuUL } from \"gui/Components/MainMenu/MainMenuUL\";\r\nimport { MainMenuLI } from \"gui/Components/MainMenu/MainMenuLI\";\r\nimport { MainMenuItem } from \"gui/Components/MainMenu/MainMenuItem\";\r\nimport { Icon } from \"@origam/components\";\r\nimport { inject, MobXProviderContext, Observer, observer } from \"mobx-react\";\r\nimport { IApplication } from \"model/entities/types/IApplication\";\r\nimport { getIsMainMenuLoading } from \"model/selectors/MainMenu/getIsMainMenuLoading\";\r\nimport { getMainMenu } from \"model/selectors/MainMenu/getMainMenu\";\r\nimport { action, observable } from \"mobx\";\r\nimport { IWorkbench } from \"model/entities/types/IWorkbench\";\r\nimport { onMainMenuItemClick } from \"model/actions-ui/MainMenu/onMainMenuItemClick\";\r\nimport { getActiveScreen } from \"model/selectors/getActiveScreen\";\r\nimport { Dropdowner } from \"gui/Components/Dropdowner/Dropdowner\";\r\nimport { Dropdown } from \"gui/Components/Dropdown/Dropdown\";\r\nimport { DropdownItem } from \"gui/Components/Dropdown/DropdownItem\";\r\nimport { T } from \"utils/translation\";\r\nimport { getFavorites } from \"model/selectors/MainMenu/getFavorites\";\r\nimport { runInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\nimport { showDialog } from \"model/selectors/getDialogStack\";\r\nimport { ChooseFavoriteFolderDialog } from \"gui/Components/Dialogs/ChooseFavoriteFolderDialog\";\r\nimport { getIconUrl } from \"gui/getIconUrl\";\r\nimport { getMainMenuState } from \"model/selectors/MainMenu/getMainMenuState\";\r\nimport { getCustomAssetsRoute } from \"model/selectors/User/getCustomAssetsRoute\";\r\nimport { IMenuItemIcon } from \"gui/Workbench/MainMenu/IMenuItemIcon\";\r\nimport { onResetColumnConfigClick } from \"model/actions-ui/MainMenu/onResetColumnConfigClick\";\r\nimport S from \"gui/connections/CMainMenu.module.scss\";\r\nimport { SidebarSectionDivider } from \"gui/Components/Sidebar/SidebarSectionDivider\";\r\nimport { SidebarSectionHeader } from \"gui/Components/Sidebar/SidebarSectionHeader\";\r\nimport { SidebarSectionBody } from \"gui/Components/Sidebar/SidebarSectionBody\";\r\nimport { EditButton } from \"gui/connections/MenuComponents/EditButton\";\r\nimport { IMainMenuState } from \"model/entities/types/IMainMenu\";\r\nimport cx from \"classnames\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\n\r\n@inject(mainMenuState => mainMenuState)\r\n@observer\r\nexport class CMainMenu extends React.Component<{\r\n  isActive: boolean;\r\n  onClick: () => void;\r\n  mainMenuState?: IMainMenuState;\r\n}> {\r\n  static contextType = MobXProviderContext;\r\n\r\n  @observable\r\n  mouseInHeader = false;\r\n\r\n  get application(): IApplication {\r\n    return this.context.application;\r\n  }\r\n\r\n  onMouseEnter() {\r\n    this.mouseInHeader = true;\r\n    if (isMobileLayoutActive(this.application)) {\r\n      this.props.onClick();\r\n    }\r\n  }\r\n\r\n  @action\r\n  onEditClick() {\r\n    this.props.mainMenuState!.editing = !this.props.mainMenuState!.editing;\r\n    const mainMenu = getMainMenu(this.application)!;\r\n    if (this.props.mainMenuState!.editing) {\r\n      this.props.onClick();\r\n      if (!this.isAnyCommandVisible(mainMenu.menuUI)) {\r\n        this.ensureAtLeastOneCommandVisible(mainMenu.menuUI);\r\n      }\r\n    }\r\n  }\r\n\r\n  isAnyCommandVisible(element: any) {\r\n    const commandVisible = element.elements.some((child: any) => child.name === \"Command\")\r\n    if (commandVisible) {\r\n      return true;\r\n    }\r\n    for (const childElement of element.elements) {\r\n      if (childElement.name === \"Submenu\" &&\r\n        childElement.attributes.isHidden !== \"true\" &&\r\n        this.props.mainMenuState!.isOpen(childElement.attributes.id)) {\r\n        const commandsVisible = this.isAnyCommandVisible(childElement);\r\n        if (commandsVisible) {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  ensureAtLeastOneCommandVisible(element: any) {\r\n    const commandVisible = element.elements.some((child: any) => child.name === \"Command\")\r\n    if (commandVisible) {\r\n      return true;\r\n    }\r\n    for (const childElement of element.elements) {\r\n      if (childElement.name === \"Submenu\" && childElement.attributes.isHidden !== \"true\") {\r\n        if (!this.props.mainMenuState!.isOpen(childElement.attributes.id)) {\r\n          this.props.mainMenuState!.setIsOpen(childElement.attributes.id, true);\r\n        }\r\n        const commandsVisible = this.ensureAtLeastOneCommandVisible(childElement);\r\n        if (commandsVisible) {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  render() {\r\n    const {application} = this;\r\n    const isLoading = getIsMainMenuLoading(application);\r\n    const mainMenu = getMainMenu(application);\r\n\r\n    if (isLoading || !mainMenu) {\r\n      return null; // TODO: More intelligent menu loading indicator...\r\n    }\r\n    return (\r\n      <>\r\n        <SidebarSectionDivider/>\r\n        <div\r\n          className={S.topMenuHeader}\r\n          onMouseEnter={() => this.onMouseEnter()}\r\n          onMouseLeave={() => this.mouseInHeader = false}\r\n        >\r\n          <SidebarSectionHeader\r\n            id={\"menuHeader\"}\r\n            isActive={this.props.isActive}\r\n            icon={<Icon src=\"./icons/menu.svg\" tooltip={T(\"Menu\", \"menu\")}/>}\r\n            label={T(\"Menu\", \"menu\")}\r\n            onClick={() => this.props.onClick()}\r\n          />\r\n          <Observer>\r\n            {() =>\r\n              <EditButton\r\n                isVisible={this.mouseInHeader}\r\n                isEnabled={this.props.mainMenuState!.editing}\r\n                onClick={() => this.onEditClick()}\r\n                tooltip={T(\"Manage Favourites\", \"manage_favorites\")}\r\n              />\r\n            }\r\n          </Observer>\r\n        </div>\r\n        <SidebarSectionBody isActive={this.props.isActive}>\r\n          {listFromNode(mainMenu.menuUI, 1, true)}\r\n        </SidebarSectionBody>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport function itemForNode(node: any, level: number, isOpen: boolean) {\r\n  switch (node.name) {\r\n    case \"Submenu\":\r\n      return (\r\n        <MainMenuLI key={node.$iid}>\r\n          <CMainMenuFolderItem node={node} level={level} isOpen={isOpen}/>\r\n        </MainMenuLI>\r\n      );\r\n    case \"Command\":\r\n      return (\r\n        <MainMenuLI key={node.$iid}>\r\n          <CMainMenuCommandItem node={node} level={level} isOpen={isOpen}/>\r\n        </MainMenuLI>\r\n      );\r\n    default:\r\n      return <></>;\r\n  }\r\n}\r\n\r\nfunction listFromNode(node: any, level: number, isOpen: boolean) {\r\n  return (\r\n    <MainMenuUL>\r\n      {node.elements\r\n        .filter((childNode: any) => childNode.attributes.isHidden !== \"true\")\r\n        .map((node: any) => itemForNode(node, level, isOpen))}\r\n    </MainMenuUL>\r\n  );\r\n}\r\n\r\n@inject(mainMenuState => mainMenuState)\r\n@observer\r\nclass CMainMenuCommandItem extends React.Component<{\r\n  node: any;\r\n  level: number;\r\n  isOpen: boolean;\r\n  mainMenuState?: IMainMenuState;\r\n}> {\r\n  static contextType = MobXProviderContext;\r\n\r\n  get workbench(): IWorkbench {\r\n    return this.context.workbench;\r\n  }\r\n\r\n  get menuId() {\r\n    return this.props.node.attributes[\"id\"];\r\n  }\r\n\r\n  get favorites() {\r\n    return getFavorites(this.workbench);\r\n  }\r\n\r\n  render() {\r\n    const {props} = this;\r\n    const customAssetsRoute = getCustomAssetsRoute(this.workbench);\r\n    const activeScreen = getActiveScreen(this.workbench);\r\n    const activeMenuItemId = activeScreen ? activeScreen.menuItemId : undefined;\r\n    const isOpenScreen = this.workbench.openedScreenIdSet.has(props.node.attributes.id);\r\n    return (\r\n      <Dropdowner\r\n        trigger={({refTrigger, setDropped}) => (\r\n          <div\r\n            className={S.favoritesMenuItem + (isOpenScreen ? \" \" + S.isOpenedScreen : \"\")}\r\n          >\r\n            <MainMenuItem\r\n              refDom={refTrigger}\r\n              level={props.level}\r\n              id={\"menu_\" + props.node.attributes.id}\r\n              isActive={false}\r\n              icon={\r\n                <Icon\r\n                  src={getIconUrl(\r\n                    props.node.attributes.icon,\r\n                    customAssetsRoute + \"/\" + props.node.attributes.icon\r\n                  )}\r\n                  tooltip={props.node.attributes.label}\r\n                />\r\n              }\r\n              label={props.node.attributes.label}\r\n              isHidden={!props.isOpen}\r\n              // TODO: Implements selector for this idset\r\n              isOpenedScreen={isOpenScreen}\r\n              isActiveScreen={activeMenuItemId === props.node.attributes.id}\r\n              onClick={(event) =>\r\n                onMainMenuItemClick(this.workbench)({\r\n                  event,\r\n                  item: props.node,\r\n                  idParameter: undefined,\r\n                })\r\n              }\r\n              onContextMenu={(event) => {\r\n                setDropped(true, event);\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n              }}\r\n            />\r\n            {this.props.mainMenuState!.editing &&\r\n              <FavoritesAddRemoveButton\r\n                isVisible={props.isOpen}\r\n                menuId={this.menuId}\r\n                ctx={this.workbench}/>\r\n            }\r\n          </div>\r\n        )}\r\n        content={({setDropped}) => (\r\n          <Dropdown>\r\n            <DropdownItem\r\n              onClick={(event: any) => {\r\n                setDropped(false);\r\n                onMainMenuItemClick(this.workbench)({\r\n                  event,\r\n                  item: props.node,\r\n                  idParameter: undefined,\r\n                })\r\n              }}\r\n            >\r\n              {T(\"Open\", \"open_form\")}\r\n            </DropdownItem>\r\n            <DropdownItem\r\n              onClick={(event: any) => {\r\n                setDropped(false);\r\n                onMainMenuItemClick(this.workbench)({\r\n                  event,\r\n                  item: props.node,\r\n                  idParameter: undefined,\r\n                  forceOpenNew: true\r\n                })\r\n              }}\r\n            >\r\n              {T(\"Open in New Tab\", \"open_in_new_tab\")}\r\n            </DropdownItem>\r\n            {(props.node.attributes.type === \"FormReferenceMenuItem\" ||\r\n                props.node.attributes.type === \"FormReferenceMenuItem_WithSelection\") &&\r\n              <DropdownItem\r\n                onClick={(event: any) => {\r\n                  setDropped(false);\r\n                  onResetColumnConfigClick(this.workbench)({\r\n                    item: props.node\r\n                  })\r\n                }}\r\n              >\r\n                {T(\"Reset Column Configuration\", \"reset_column_configuration\")}\r\n              </DropdownItem>\r\n            }\r\n            {!this.favorites.isInAnyFavoriteFolder(this.menuId) && (\r\n              <DropdownItem\r\n                onClick={(event: any) => {\r\n                  setDropped(false);\r\n                  onAddToFavoritesClicked(this.workbench, this.menuId);\r\n                }}\r\n              >\r\n                {T(\"Put to favourites\", \"put_to_favourites\")}\r\n              </DropdownItem>\r\n            )}\r\n          </Dropdown>\r\n        )}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\n@observer\r\nexport class CFavoritesMenuItem extends React.Component<{\r\n  node: any;\r\n  level: number;\r\n  isOpen: boolean;\r\n  editingEnabled: boolean;\r\n}> {\r\n  static contextType = MobXProviderContext;\r\n\r\n  get workbench(): IWorkbench {\r\n    return this.context.workbench;\r\n  }\r\n\r\n  get menuId() {\r\n    return this.props.node.attributes[\"id\"];\r\n  }\r\n\r\n  get favorites() {\r\n    return getFavorites(this.workbench);\r\n  }\r\n\r\n  getIconSrc() {\r\n    if (this.props.editingEnabled) {\r\n      return \"./icons/minus.svg\";\r\n    }\r\n    const customAssetsRoute = getCustomAssetsRoute(this.workbench);\r\n    return getIconUrl(\r\n      this.props.node.attributes.icon,\r\n      customAssetsRoute + \"/\" + this.props.node.attributes.icon\r\n    )\r\n  }\r\n\r\n  onIconClick(event: any) {\r\n    if (this.props.editingEnabled) {\r\n      onRemoveFromFavoritesClicked(this.workbench, this.menuId);\r\n    } else {\r\n      onMainMenuItemClick(this.workbench)({\r\n        event,\r\n        item: this.props.node,\r\n        idParameter: undefined,\r\n      })\r\n    }\r\n  }\r\n\r\n  onClick(event: any) {\r\n    if (this.props.editingEnabled) {\r\n      return;\r\n    }\r\n    onMainMenuItemClick(this.workbench)({\r\n      event,\r\n      item: this.props.node,\r\n      idParameter: undefined,\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const {props} = this;\r\n    const activeScreen = getActiveScreen(this.workbench);\r\n    const activeMenuItemId = activeScreen ? activeScreen.menuItemId : undefined;\r\n    const isOpenedScreen = this.workbench.openedScreenIdSet.has(props.node.attributes.id);\r\n    return (\r\n      <Dropdowner\r\n        trigger={({refTrigger, setDropped}) => (\r\n          <div className={cx(S.favoritesMenuItem, {openItem: isOpenedScreen})}>\r\n            <MainMenuItem\r\n              refDom={refTrigger}\r\n              level={props.level}\r\n              isActive={false}\r\n              icon={\r\n                <div onClick={event => this.onIconClick(event)}>\r\n                  <Icon\r\n                    src={this.getIconSrc()}\r\n                    tooltip={props.node.attributes.label}\r\n                    className={this.props.editingEnabled ? S.deleteIcon : \"\"}\r\n                  />\r\n                </div>\r\n              }\r\n              label={props.node.attributes.label}\r\n              isHidden={!props.isOpen}\r\n              isOpenedScreen={isOpenedScreen}\r\n              isActiveScreen={activeMenuItemId === props.node.attributes.id}\r\n              onClick={(event) => {\r\n                if (this.props.editingEnabled) return;\r\n                onMainMenuItemClick(this.workbench)({\r\n                  event,\r\n                  item: props.node,\r\n                  idParameter: undefined,\r\n                })\r\n              }\r\n              }\r\n              onContextMenu={(event) => {\r\n                setDropped(true, event);\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n              }}\r\n            />\r\n            {this.props.editingEnabled ? <i className={\"fas fa-bars \" + S.itemGrip}/> : null}\r\n          </div>\r\n        )}\r\n        content={({setDropped}) => (\r\n          <Dropdown>\r\n            <DropdownItem onClick={(event: any) => this.onClick(event)}>\r\n              {T(\"Open\", \"open_form\")}\r\n            </DropdownItem>\r\n            <DropdownItem\r\n              onClick={(event: any) => {\r\n                setDropped(false);\r\n                onMainMenuItemClick(this.workbench)({\r\n                  event,\r\n                  item: props.node,\r\n                  idParameter: undefined,\r\n                  forceOpenNew: true\r\n                })\r\n              }}\r\n            >\r\n              {T(\"Open in New Tab\", \"open_in_new_tab\")}\r\n            </DropdownItem>\r\n            {(props.node.attributes.type === \"FormReferenceMenuItem\" ||\r\n                props.node.attributes.type === \"FormReferenceMenuItem_WithSelection\") &&\r\n              <DropdownItem\r\n                onClick={(event: any) => {\r\n                  setDropped(false);\r\n                  onResetColumnConfigClick(this.workbench)({\r\n                    item: props.node\r\n                  })\r\n                }}\r\n              >\r\n                {T(\"Reset Column Configuration\", \"reset_column_configuration\")}\r\n              </DropdownItem>\r\n            }\r\n            {this.favorites.isInAnyFavoriteFolder(this.menuId) && (\r\n              <DropdownItem\r\n                onClick={(event: any) => {\r\n                  setDropped(false);\r\n                  onRemoveFromFavoritesClicked(this.workbench, this.menuId);\r\n                }}\r\n              >\r\n                {T(\"Remove from Favourites\", \"remove_from_favourites\")}\r\n              </DropdownItem>\r\n            )}\r\n          </Dropdown>\r\n        )}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nfunction onRemoveFromFavoritesClicked(ctx: any, menuId: string) {\r\n  const favorites = getFavorites(ctx);\r\n  runInFlowWithHandler({\r\n    ctx: ctx,\r\n    action: () => favorites.remove(menuId),\r\n  });\r\n}\r\n\r\nexport function onAddToFavoritesClicked(ctx: any, menuId: string) {\r\n  const favorites = getFavorites(ctx);\r\n  const closeDialog = showDialog(ctx,\r\n    \"\",\r\n    <ChooseFavoriteFolderDialog\r\n      onOkClick={(folderId: string) => {\r\n        runInFlowWithHandler({\r\n          ctx: ctx,\r\n          action: () => favorites.add(folderId, menuId),\r\n        });\r\n        closeDialog();\r\n      }}\r\n      onCancelClick={() => closeDialog()}\r\n      favorites={favorites.favoriteFolders}\r\n    />\r\n  );\r\n}\r\n\r\n@observer\r\nclass FavoritesAddRemoveButton extends React.Component<{\r\n  ctx: any;\r\n  isVisible: boolean;\r\n  menuId: string;\r\n}> {\r\n  render() {\r\n    const favorites = getFavorites(this.props.ctx);\r\n    return (\r\n      <div\r\n        className={cx(\r\n          S.addToFavoritesIconContainer,\r\n          {isHidden: !this.props.isVisible}\r\n        )}\r\n        onClick={() => {\r\n          if (favorites.isInAnyFavoriteFolder(this.props.menuId)) {\r\n            onRemoveFromFavoritesClicked(this.props.ctx, this.props.menuId);\r\n          } else {\r\n            onAddToFavoritesClicked(this.props.ctx, this.props.menuId)\r\n          }\r\n        }}\r\n      >\r\n        <Icon\r\n          tooltip={T(\"Add To / Remove From Favourites\", \"put_remove_to_favourites\")}\r\n          className={cx(S.addToFavoritesIcon, {activeAddToFavoritesIcon: !favorites.isInAnyFavoriteFolder(this.props.menuId)})}\r\n          src=\"./icons/favorites.svg\"/>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n@observer\r\nclass CMainMenuFolderItem extends React.Component<{\r\n  node: any;\r\n  level: number;\r\n  isOpen: boolean;\r\n}> {\r\n  static contextType = MobXProviderContext;\r\n  itemRef: RefObject<HTMLDivElement> = React.createRef();\r\n\r\n  componentDidMount() {\r\n    this.mainMenuState.setReference(this.id, this.itemRef);\r\n  }\r\n\r\n  get id() {\r\n    return this.props.node.attributes.id;\r\n  }\r\n\r\n  get mainMenuState() {\r\n    return getMainMenuState(this.context.application);\r\n  }\r\n\r\n  @action.bound handleClick(event: any) {\r\n    this.mainMenuState.flipIsOpen(this.id);\r\n  }\r\n\r\n  get icon() {\r\n    if (this.props.node.attributes.icon !== IMenuItemIcon.Folder) {\r\n      const customAssetsRoute = getCustomAssetsRoute(this.context.application);\r\n      return <Icon src={customAssetsRoute + \"/\" + this.props.node.attributes.icon}\r\n                   tooltip={this.props.node.attributes.label}/>;\r\n    }\r\n    if (this.mainMenuState.isOpen(this.id)) {\r\n      return <Icon src=\"./icons/folder-open.svg\" tooltip={this.props.node.attributes.label}/>;\r\n    } else {\r\n      return <Icon src=\"./icons/folder-closed.svg\" tooltip={this.props.node.attributes.label}/>;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const {props} = this;\r\n    return (\r\n      <div\r\n        id={this.id}\r\n        ref={this.itemRef}>\r\n        <MainMenuItem\r\n          level={props.level}\r\n          isActive={false}\r\n          icon={this.icon}\r\n          id={\"menu_\" + props.node.attributes.id}\r\n          label={props.node.attributes.label}\r\n          isHidden={!props.isOpen}\r\n          onClick={this.handleClick}\r\n          isHighLighted={this.id === this.mainMenuState.highLightedItemId}\r\n        />\r\n        {listFromNode(\r\n          props.node,\r\n          props.level + 1,\r\n          this.props.isOpen && this.mainMenuState.isOpen(this.id)\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkQueues } from \"./getWorkQueues\";\r\n\r\nexport function getWorkQueuesTotalItemsCount(ctx: any) {\r\n  return getWorkQueues(ctx).totalItemCount;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { RefObject } from \"react\";\r\nimport S from \"gui/Components/WorkQueues/WorkQueuesItem.module.scss\";\r\nimport cx from \"classnames\";\r\nimport { MobXProviderContext } from \"mobx-react\";\r\nimport { getMainMenuState } from \"model/selectors/MainMenu/getMainMenuState\";\r\n\r\nexport class WorkQueuesItem extends React.Component<{\r\n  isActiveScreen?: boolean;\r\n  isOpenedScreen?: boolean;\r\n  isHidden?: boolean;\r\n  isEmphasized?: boolean;\r\n  level?: number;\r\n  icon?: React.ReactNode;\r\n  label?: React.ReactNode;\r\n  tooltip?: string;\r\n  id?: string;\r\n  onClick?(event: any): void;\r\n}> {\r\n  static contextType = MobXProviderContext;\r\n  itemRef: RefObject<HTMLAnchorElement> = React.createRef();\r\n\r\n  componentDidMount() {\r\n    if (this.props.id) {\r\n      this.mainMenuState.setReference(this.props.id, this.itemRef);\r\n    }\r\n  }\r\n\r\n  get mainMenuState() {\r\n    return getMainMenuState(this.context.application);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <a\r\n        ref={this.itemRef}\r\n        className={cx(\r\n          S.root,\r\n          {\r\n            isActiveScreen: this.props.isActiveScreen,\r\n            isOpenedScreen: this.props.isOpenedScreen,\r\n          },\r\n          {isHidden: this.props.isHidden},\r\n          {isEmphasized: this.props.isEmphasized}\r\n        )}\r\n        style={{paddingLeft: `${(this.props.level || 1) * 1.6667}em`}}\r\n        onClick={this.props.onClick}\r\n        title={this.props.tooltip}\r\n      >\r\n        <div className={S.icon}>{this.props.icon}</div>\r\n        <div className={S.label}>{this.props.label}</div>\r\n      </a>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getWorkbenchLifecycle } from \"model/selectors/getWorkbenchLifecycle\";\r\n\r\nexport function onWorkQueuesListItemClick(ctx: any) {\r\n  return flow(function*onWorkQueuesListItemClick(event: any, item: any) {\r\n    try {\r\n      yield*getWorkbenchLifecycle(ctx).onWorkQueueListItemClick(event, item);\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { IWorkbench } from \"model/entities/types/IWorkbench\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { getWorkQueuesItems } from \"model/selectors/WorkQueues/getWorkQueuesItems\";\r\nimport { WorkQueuesItem } from \"gui/Components/WorkQueues/WorkQueuesItem\";\r\nimport { computed } from \"mobx\";\r\nimport { Icon } from \"@origam/components\";\r\nimport { onWorkQueuesListItemClick } from \"model/actions-ui/WorkQueues/onWorkQueuesListItemClick\";\r\nimport { getActiveScreen } from \"model/selectors/getActiveScreen\";\r\n\r\n@observer\r\nexport class CWorkQueues extends React.Component {\r\n  static contextType = MobXProviderContext;\r\n\r\n  get workbench(): IWorkbench {\r\n    return this.context.workbench;\r\n  }\r\n\r\n  @computed get sortedItems() {\r\n    const workQueueItems = [...getWorkQueuesItems(this.workbench)];\r\n    workQueueItems.sort((a, b) => (a.name || \"\").localeCompare(b.name || \"\"));\r\n    return workQueueItems;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        {this.sortedItems.map(item => {\r\n          const activeScreen = getActiveScreen(this.workbench);\r\n          const activeMenuItemId = activeScreen ? activeScreen.menuItemId : undefined;\r\n          return (\r\n            <WorkQueuesItem\r\n              key={item.id}\r\n              isEmphasized={item.countTotal > 0}\r\n              isOpenedScreen={this.workbench.openedScreenIdSet.has(item.id)}\r\n              isActiveScreen={activeMenuItemId === item.id}\r\n              icon={<Icon src=\"./icons/work-queue.svg\" tooltip={item.name}/>}\r\n              tooltip={item.name}\r\n              label={\r\n                <>\r\n                  {item.name}\r\n                  {item.countTotal > 0 && <> ({item.countTotal})</>}\r\n                </>\r\n              }\r\n              id={item.id}\r\n              onClick={event => onWorkQueuesListItemClick(this.workbench)(event, item)}\r\n            />\r\n          );\r\n        })}\r\n      </>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport enum IInfoSubsection {\r\n  Info,\r\n  Audit\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkQueues } from \"./getWorkQueues\";\r\n\r\nexport function getWorkQueuesItems(ctx: any) {\r\n  return getWorkQueues(ctx).items;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/SidebarInfoSection/SidebarRecordAudit.module.scss\";\r\n\r\nexport const SidebarRecordAudit: React.FC = props => (\r\n  <div className={S.root}>{props.children}</div>\r\n);","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useContext } from \"react\";\r\nimport { IInfoSubsection } from \"gui/connections/types\";\r\nimport { SidebarRecordInfo } from \"gui/Components/SidebarInfoSection/SidebarRecordInfo\";\r\nimport { SidebarRecordAudit } from \"gui/Components/SidebarInfoSection/SidebarRecordAudit\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { getRecordInfo } from \"model/selectors/RecordInfo/getRecordInfo\";\r\n\r\nexport const CSidebarInfoSection: React.FC<{\r\n  activeSubsection: IInfoSubsection;\r\n}> = observer(props => {\r\n  const workbench = useContext(MobXProviderContext).workbench;\r\n  const recordInfo = getRecordInfo(workbench);\r\n\r\n  return (\r\n    <>\r\n      {props.activeSubsection === IInfoSubsection.Info &&\r\n      recordInfo.info.length > 0 && (\r\n        <SidebarRecordInfo lines={recordInfo.info}/>\r\n      )}\r\n      {props.activeSubsection === IInfoSubsection.Audit && recordInfo.audit && (\r\n        <SidebarRecordAudit/>\r\n      )}\r\n    </>\r\n  );\r\n});\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getWorkbenchLifecycle } from \"model/selectors/getWorkbenchLifecycle\";\r\n\r\nexport function onChatroomsListItemClick(ctx: any) {\r\n  return flow(function*onChatroomsListItemClick(event: any, item: any) {\r\n    try {\r\n      yield*getWorkbenchLifecycle(ctx).onChatroomsListItemClick(event, item);\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { IWorkbench } from \"model/entities/types/IWorkbench\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { WorkQueuesItem } from \"gui/Components/WorkQueues/WorkQueuesItem\";\r\nimport { flow } from \"mobx\";\r\nimport { Icon } from \"@origam/components\";\r\nimport { getActiveScreen } from \"model/selectors/getActiveScreen\";\r\nimport { getChatrooms } from \"model/selectors/Chatrooms/getChatrooms\";\r\nimport { onChatroomsListItemClick } from \"model/actions/Chatrooms/onChatroomsListItemClick\";\r\nimport { openNewUrl } from \"model/actions/Workbench/openNewUrl\";\r\nimport { IUrlUpenMethod } from \"model/entities/types/IUrlOpenMethod\";\r\nimport { T } from \"utils/translation\";\r\n\r\n@observer\r\nexport class CChatSection extends React.Component {\r\n  static contextType = MobXProviderContext;\r\n\r\n  get workbench(): IWorkbench {\r\n    return this.context.workbench;\r\n  }\r\n\r\n  get sortedItems() {\r\n    return getChatrooms(this.workbench).items;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        <WorkQueuesItem\r\n          isEmphasized={false}\r\n          isOpenedScreen={false}\r\n          isActiveScreen={false}\r\n          icon={<Icon src=\"./icons/add.svg\" tooltip={T(\"New Chat\", \"new_chat\")}/>}\r\n          label={<>{T(\"New Chat\", \"new_chat\")}</>}\r\n          onClick={(event) => {\r\n            const self = this;\r\n            flow(function*() {\r\n              yield*openNewUrl(self.workbench)(\r\n                `chatrooms/index.html#/chatroom`,\r\n                IUrlUpenMethod.OrigamTab,\r\n                \"New Chat\"\r\n              );\r\n            })();\r\n          }}\r\n        />\r\n        {this.sortedItems.map((item) => {\r\n          const activeScreen = getActiveScreen(this.workbench);\r\n          const activeMenuItemId = activeScreen ? activeScreen.menuItemId : undefined;\r\n          return (\r\n            <WorkQueuesItem\r\n              isEmphasized={item.unreadMessageCount > 0}\r\n              isOpenedScreen={this.workbench.openedScreenIdSet.has(item.id)}\r\n              isActiveScreen={activeMenuItemId === item.id}\r\n              icon={<Icon src=\"./icons/chat.svg\" tooltip={item.topic}/>}\r\n              label={\r\n                <>\r\n                  {item.topic}\r\n                  {item.unreadMessageCount > 0 && <> ({item.unreadMessageCount})</>}\r\n                </>\r\n              }\r\n              onClick={(event) => onChatroomsListItemClick(this.workbench)(event, item)}\r\n              id={item.id}\r\n            />\r\n          );\r\n        })}\r\n      </>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/Search/SearchResults.module.scss\";\r\nimport { ISearchResult, isIMenuSearchResult } from \"model/entities/types/ISearchResult\";\r\nimport { observer } from \"mobx-react\";\r\nimport { ISearchResultGroup } from \"model/entities/types/ISearchResultGroup\";\r\nimport { observable } from \"mobx\";\r\nimport { Icon } from \"@origam/components\";\r\nimport { Dropdown } from \"../Dropdown/Dropdown\";\r\nimport { DropdownItem } from \"../Dropdown/DropdownItem\";\r\nimport { T } from \"../../../utils/translation\";\r\nimport { Dropdowner } from \"../Dropdowner/Dropdowner\";\r\nimport { getFavorites } from \"../../../model/selectors/MainMenu/getFavorites\";\r\nimport { onAddToFavoritesClicked } from \"../../connections/CMainMenu\";\r\n\r\nexport class SearchResults extends React.Component<{\r\n  groups: ISearchResultGroup[];\r\n  ctx: any;\r\n}> {\r\n\r\n  render() {\r\n    return (\r\n      <div className={S.root}>\r\n        {this.props.groups.map(group =>\r\n          <ResultGroup\r\n            ctx={this.props.ctx}\r\n            key={group.name}\r\n            name={group.name}\r\n            results={group.results}/>)}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n@observer\r\nexport class ResultGroup extends React.Component<{\r\n  name: string;\r\n  ctx: any;\r\n  results: ISearchResult[];\r\n}> {\r\n  @observable\r\n  isExpanded = true;\r\n\r\n  onGroupClick() {\r\n    this.isExpanded = !this.isExpanded;\r\n  }\r\n\r\n  get favorites() {\r\n    return getFavorites(this.props.ctx);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div>\r\n        <div className={S.resultGroupRow} onClick={() => this.onGroupClick()}>\r\n          {this.isExpanded ? (\r\n            <i className={\"fas fa-angle-up \" + S.arrow}/>\r\n          ) : (\r\n            <i className={\"fas fa-angle-down \" + S.arrow}/>\r\n          )}\r\n          <div className={S.groupName}>\r\n            {this.props.name}\r\n          </div>\r\n        </div>\r\n        <div>\r\n          {this.isExpanded && this.props.results.map(result =>\r\n            <Dropdowner\r\n              trigger={({refTrigger, setDropped}) => (\r\n                <SearchResultItem\r\n                  refDom={refTrigger}\r\n                  result={result}\r\n                  onContextMenu={(event) => {\r\n                    setDropped(true, event);\r\n                    event.preventDefault();\r\n                    event.stopPropagation();\r\n                  }}\r\n                />\r\n              )}\r\n              content={({setDropped}) => (\r\n                <Dropdown>\r\n                  {isIMenuSearchResult(result) && !this.favorites.isInAnyFavoriteFolder(result.id) && (\r\n                    <DropdownItem\r\n                      onClick={(event: any) => {\r\n                        setDropped(false);\r\n                        onAddToFavoritesClicked(this.props.ctx, result.id);\r\n                      }}\r\n                    >\r\n                      {T(\"Put to favourites\", \"put_to_favourites\")}\r\n                    </DropdownItem>\r\n                  )}\r\n                </Dropdown>\r\n\r\n              )}\r\n            />\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nfunction SearchResultItem(props: {\r\n  result: ISearchResult;\r\n  onContextMenu?(event: any): void;\r\n  refDom?: any;\r\n}) {\r\n  return (\r\n    <div className={S.resultItem}\r\n         onContextMenu={props.onContextMenu}\r\n         ref={props.refDom}\r\n         onClick={() => props.result.onClick()}>\r\n      <Icon className={S.icon} src={props.result.iconUrl}/>\r\n      <div className={S.textContainer}>\r\n        <div className={S.resultItemName}>{props.result.label}</div>\r\n        {props.result.description &&\r\n        <div className={S.resultItemDescription}>{props.result.description}</div>\r\n        }\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n\r\nexport interface ISearchResult {\r\n  id: string;\r\n  label: string,\r\n  description: string,\r\n  iconUrl: string;\r\n  onClick: () => void;\r\n}\r\n\r\nexport interface IServerSearchResult extends ISearchResult {\r\n  group: string,\r\n  dataSourceId: string,\r\n  dataSourceLookupId: string,\r\n  referenceId: string\r\n}\r\n\r\nexport interface IMenuSearchResult extends ISearchResult {\r\n  type: string;\r\n}\r\n\r\nexport const isIMenuSearchResult = (o: any): o is IMenuSearchResult => \"type\" in o;\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { observable } from \"mobx\";\r\nimport { T } from \"utils/translation\";\r\nimport CS from \"gui/Components/Dialogs/DialogsCommon.module.css\";\r\nimport S from \"gui/Components/Dialogs/FavoriteFolderPropertiesDialog.module.scss\";\r\nimport { ModalDialog } from \"gui/Components/Dialog/ModalDialog\";\r\n\r\n@observer\r\nexport class FavoriteFolderPropertiesDialog extends React.Component<{\r\n  title: string;\r\n  name?: string;\r\n  isPinned?: boolean;\r\n  onCancelClick: (event: any) => void;\r\n  onOkClick: (name: string, isPinned: boolean) => void;\r\n}> {\r\n  @observable\r\n  groupName: string = this.props.name ?? \"\";\r\n\r\n  @observable\r\n  isPinned: boolean = this.props.isPinned ?? false;\r\n\r\n  get isInvalid() {\r\n    return this.groupName === \"\";\r\n  }\r\n\r\n  refInput = React.createRef<HTMLInputElement>();\r\n\r\n  onNameChanged(event: any) {\r\n    this.groupName = event.target.value;\r\n  }\r\n\r\n  onIsPinnedClicked(event: any) {\r\n    this.isPinned = event.target.checked;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.refInput.current?.focus();\r\n  }\r\n\r\n  onKeydown(event: React.KeyboardEvent<HTMLInputElement>) {\r\n    if (event.key === \"Enter\") {\r\n      this.onOkClick();\r\n    }\r\n  }\r\n\r\n  onOkClick() {\r\n    if (this.isInvalid) {\r\n      return;\r\n    }\r\n    this.props.onOkClick(this.groupName, this.isPinned);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <ModalDialog\r\n        title={this.props.title}\r\n        titleButtons={null}\r\n        buttonsCenter={\r\n          <>\r\n            <button tabIndex={0} onClick={() => this.onOkClick()}>\r\n              {T(\"Ok\", \"button_ok\")}\r\n            </button>\r\n            <button tabIndex={0} onClick={this.props.onCancelClick}>\r\n              {T(\"Cancel\", \"button_cancel\")}\r\n            </button>\r\n          </>\r\n        }\r\n        buttonsLeft={null}\r\n        buttonsRight={null}\r\n      >\r\n        <div className={CS.dialogContent}>\r\n          <div className={S.inpuContainer}>\r\n            <div className={S.row}>\r\n              <div className={S.label}>{T(\"Name:\", \"group_name\")}</div>\r\n              <input\r\n                ref={this.refInput}\r\n                className={S.textInput}\r\n                value={this.groupName}\r\n                onChange={(event) => this.onNameChanged(event)}\r\n                onKeyDown={(event: React.KeyboardEvent<HTMLInputElement>) => this.onKeydown(event)}\r\n              />\r\n              {this.isInvalid && (\r\n                <div>\r\n                  <div\r\n                    className={S.notification}\r\n                    title={T(\"Name cannot be empty\", \"group_name_empty\")}\r\n                  >\r\n                    <i className=\"fas fa-exclamation-circle red\"/>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n            <div id={S.lastRow} className={S.row}>\r\n              <div className={S.label}>{T(\"Pin to the Top:\", \"group_pinned\")}</div>\r\n              <input\r\n                className={S.chcekBoxinput}\r\n                type=\"checkbox\"\r\n                checked={this.isPinned}\r\n                onChange={(event) => this.onIsPinnedClicked(event)}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </ModalDialog>\r\n    );\r\n  }\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport CS from \"gui/connections/MenuComponents/HeaderButton.module.scss\";\r\nimport { T } from \"utils/translation\";\r\n\r\n@observer\r\nexport class PinButton extends React.Component<{\r\n  isPinned: boolean\r\n  isVisible: boolean;\r\n  onClick: () => void;\r\n}> {\r\n\r\n  getClass() {\r\n    let className = \"fas fa-thumbtack \" + CS.headerIcon;\r\n    if (!this.props.isVisible) {\r\n      className += \" \" + CS.headerIconHidden;\r\n    }\r\n    if (this.props.isPinned) {\r\n      className += \" \" + CS.headerIconActive\r\n    }\r\n    return className;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <i\r\n        title={T(\"Pin Favourites to the Top\", \"pin_favorites\")}\r\n        className={this.getClass()}\r\n        onClick={() => this.props.onClick()}\r\n      />\r\n    )\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Observer, observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { getIsMainMenuLoading } from \"model/selectors/MainMenu/getIsMainMenuLoading\";\r\nimport { getMainMenu } from \"model/selectors/MainMenu/getMainMenu\";\r\nimport { CFavoritesMenuItem } from \"gui/connections/CMainMenu\";\r\nimport { getFavorites } from \"model/selectors/MainMenu/getFavorites\";\r\nimport { Dropdown } from \"gui/Components/Dropdown/Dropdown\";\r\nimport { DropdownItem } from \"gui/Components/Dropdown/DropdownItem\";\r\nimport { T } from \"utils/translation\";\r\nimport { Dropdowner } from \"gui/Components/Dropdowner/Dropdowner\";\r\nimport S from \"gui/connections/CFavorites.module.scss\";\r\nimport { showDialog } from \"model/selectors/getDialogStack\";\r\nimport { FavoriteFolderPropertiesDialog } from \"gui/Components/Dialogs/FavoriteFolderPropertiesDialog\";\r\nimport { runInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\nimport { SidebarSectionHeader } from \"gui/Components/Sidebar/SidebarSectionHeader\";\r\nimport { Icon } from \"@origam/components\";\r\nimport { SidebarSection } from \"gui/Components/Sidebar/SidebarSection\";\r\nimport { SidebarSectionDivider } from \"gui/Components/Sidebar/SidebarSectionDivider\";\r\nimport { SidebarSectionBody } from \"gui/Components/Sidebar/SidebarSectionBody\";\r\nimport { FavoriteFolder, Favorites } from \"model/entities/Favorites\";\r\nimport { Draggable, Droppable } from \"react-beautiful-dnd\";\r\nimport { action, observable } from \"mobx\";\r\nimport { EditButton } from \"gui/connections/MenuComponents/EditButton\";\r\nimport { PinButton } from \"gui/connections/MenuComponents/PinButton\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\n\r\n@observer\r\nexport class CFavorites extends React.Component<{\r\n  folder: FavoriteFolder;\r\n  isActive: boolean;\r\n  forceOpen?: boolean;\r\n  onHeaderClick?: () => void;\r\n  ctx: any;\r\n}> {\r\n  favorites: Favorites;\r\n\r\n  dragStateContainer = new DragStateContainer();\r\n\r\n  @observable\r\n  mouseInHeader = false;\r\n\r\n  constructor(props: any) {\r\n    super(props);\r\n    this.favorites = getFavorites(this.props.ctx);\r\n  }\r\n\r\n  get canBeDeleted() {\r\n    return this.props.folder.id !== this.favorites.defaultFavoritesFolderId;\r\n  }\r\n\r\n  onCreateNewFolderClick() {\r\n    const closeDialog = showDialog(this.props.ctx,\r\n      \"\",\r\n      <FavoriteFolderPropertiesDialog\r\n        title={T(\"New Favourites Folder\", \"new_group_title\")}\r\n        onOkClick={(name, isPinned) => {\r\n          runInFlowWithHandler({\r\n            ctx: this.props.ctx,\r\n            action: () => this.favorites.createFolder(name, isPinned),\r\n          });\r\n          closeDialog();\r\n        }}\r\n        onCancelClick={() => closeDialog()}\r\n      />\r\n    );\r\n  }\r\n\r\n  onFolderPropertiesClick() {\r\n    const closeDialog = showDialog(this.props.ctx,\r\n      \"\",\r\n      <FavoriteFolderPropertiesDialog\r\n        title={T(\"Favourites Folder Properties\", \"group_properties_title\")}\r\n        name={this.props.folder.name}\r\n        isPinned={this.props.folder.isPinned}\r\n        onOkClick={(name, isPinned) => {\r\n          runInFlowWithHandler({\r\n            ctx: this.props.ctx,\r\n            action: () => this.favorites.updateFolder(this.props.folder.id, name, isPinned),\r\n          });\r\n          closeDialog();\r\n        }}\r\n        onCancelClick={() => closeDialog()}\r\n      />\r\n    );\r\n  }\r\n\r\n  onMouseEnter() {\r\n    this.mouseInHeader = true;\r\n    if (isMobileLayoutActive(this.props.ctx)) {\r\n      this.props.onHeaderClick?.();\r\n    }\r\n  }\r\n\r\n  @action\r\n  onEditClick() {\r\n    this.dragStateContainer.flipEditEnabled();\r\n    this.props.onHeaderClick?.();\r\n  }\r\n\r\n  listFromNode(node: any, level: number, isOpen: boolean) {\r\n    const menuNodes = getAllElements(node)\r\n      .filter(\r\n        (childNode: any) =>\r\n          childNode.attributes.isHidden !== \"true\" &&\r\n          childNode.name !== \"Submenu\")\r\n    return (\r\n      <Dropdowner\r\n        trigger={({refTrigger, setDropped}) => (\r\n          <div\r\n            ref={refTrigger}\r\n            className={S.favoritesList}\r\n            onContextMenu={(event) => {\r\n              setDropped(true, event);\r\n              event.preventDefault();\r\n              event.stopPropagation();\r\n            }}\r\n          >\r\n            <Droppable droppableId={\"favorite_folder_\" + this.props.folder.id}>\r\n              {(provided) => (\r\n                <Observer>\r\n                  {() => (\r\n                    <div  {...provided.droppableProps} ref={provided.innerRef}>\r\n                      {this.props.folder.itemIds\r\n                        .map(itemId => menuNodes.find((childNode: any) => childNode.attributes[\"id\"] === itemId))\r\n                        .map((node: any, index: number) =>\r\n                          <Draggable\r\n                            key={node.$iid}\r\n                            draggableId={\"favorite_item_\" + node.attributes.id}\r\n                            index={index}\r\n                            isDragDisabled={!this.dragStateContainer.editingEnabled}\r\n                          >\r\n                            {(provided) => (\r\n                              <Observer>\r\n                                {() =>\r\n                                  <div\r\n                                    ref={provided.innerRef} {...provided.draggableProps} {...provided.dragHandleProps}>\r\n                                    <CFavoritesMenuItem\r\n                                      node={node}\r\n                                      level={level}\r\n                                      isOpen={isOpen}\r\n                                      editingEnabled={this.dragStateContainer.editingEnabled}\r\n                                    />\r\n                                  </div>\r\n                                }\r\n                              </Observer>\r\n                            )}\r\n                          </Draggable>\r\n                        )\r\n                      }\r\n                      {provided.placeholder}\r\n                    </div>\r\n                  )}\r\n                </Observer>\r\n              )}\r\n            </Droppable>\r\n          </div>\r\n        )}\r\n        content={({setDropped}) => (\r\n          <Dropdown>\r\n            <DropdownItem\r\n              onClick={(event: any) => {\r\n                setDropped(false);\r\n                this.onCreateNewFolderClick();\r\n              }}\r\n            >\r\n              {T(\"Add Folder\", \"add_group\")}\r\n            </DropdownItem>\r\n          </Dropdown>\r\n        )}\r\n      />\r\n    );\r\n  }\r\n\r\n  renderHeader() {\r\n    return (\r\n      <Dropdowner\r\n        trigger={({refTrigger, setDropped}) => (\r\n          <Droppable droppableId={\"favorite_folder_header_\" + this.props.folder.id}>\r\n            {(provided) =>\r\n              <div\r\n                className={S.favoritesFolderHeader}\r\n                {...provided.droppableProps}\r\n                ref={provided.innerRef}\r\n                onMouseEnter={() => this.onMouseEnter()}\r\n                onMouseLeave={() => this.mouseInHeader = false}\r\n              >\r\n                <SidebarSectionHeader\r\n                  isActive={!this.props.forceOpen && this.props.isActive}\r\n                  icon={<Icon src=\"./icons/favorites.svg\" tooltip={this.props.folder.name}/>}\r\n                  label={this.props.folder.name}\r\n                  onClick={() => this.props.onHeaderClick?.()}\r\n                  refDom={refTrigger}\r\n                  onContextMenu={(event) => {\r\n                    setDropped(true, event);\r\n                    event.preventDefault();\r\n                    event.stopPropagation();\r\n                  }}\r\n                />\r\n                <Observer>\r\n                  {() =>\r\n                    <div>\r\n                      <PinButton\r\n                        isVisible={this.mouseInHeader || this.dragStateContainer.editingEnabled}\r\n                        isPinned={this.props.folder.isPinned}\r\n                        onClick={() => this.favorites.setPinned(this.props.folder.id, !this.props.folder.isPinned)}\r\n                      />\r\n                      <EditButton\r\n                        isVisible={this.mouseInHeader}\r\n                        isEnabled={this.dragStateContainer.editingEnabled}\r\n                        onClick={() => this.onEditClick()}\r\n                        tooltip={T(\"Edit Favourites\", \"edit_favorites\")}\r\n                      />\r\n                    </div>\r\n                  }\r\n                </Observer>\r\n              </div>}\r\n          </Droppable>\r\n        )}\r\n        content={({setDropped}) => (\r\n          <Dropdown>\r\n            {this.canBeDeleted && (\r\n              <DropdownItem\r\n                onClick={(event: any) => {\r\n                  setDropped(false);\r\n                  runInFlowWithHandler({\r\n                    ctx: this.props.ctx,\r\n                    action: () => this.favorites.removeFolder(this.props.folder.id),\r\n                  });\r\n                }}\r\n              >\r\n                {T(\"Remove Folder\", \"remove_group\")}\r\n              </DropdownItem>\r\n            )}\r\n            {!this.props.folder.isPinned && (\r\n              <DropdownItem\r\n                onClick={(event: any) => {\r\n                  setDropped(false);\r\n                  runInFlowWithHandler({\r\n                    ctx: this.props.ctx,\r\n                    action: () => this.favorites.setPinned(this.props.folder.id, true),\r\n                  });\r\n                }}\r\n              >\r\n                {T(\"Pin to the top\", \"group_pin\")}\r\n              </DropdownItem>\r\n            )}\r\n            {this.props.folder.isPinned && (\r\n              <DropdownItem\r\n                onClick={(event: any) => {\r\n                  setDropped(false);\r\n                  runInFlowWithHandler({\r\n                    ctx: this.props.ctx,\r\n                    action: () => this.favorites.setPinned(this.props.folder.id, false),\r\n                  });\r\n                }}\r\n              >\r\n                {T(\"Unpin\", \"group_unpin\")}\r\n              </DropdownItem>\r\n            )}\r\n            <DropdownItem\r\n              onClick={(event: any) => {\r\n                setDropped(false);\r\n                this.onCreateNewFolderClick();\r\n              }}\r\n            >\r\n              {T(\"Put to favourites\", \"add_group\")}\r\n            </DropdownItem>\r\n            <DropdownItem\r\n              onClick={(event: any) => {\r\n                setDropped(false);\r\n                this.onFolderPropertiesClick();\r\n              }}\r\n            >\r\n              {T(\"Properties\", \"group_properties\")}\r\n            </DropdownItem>\r\n          </Dropdown>\r\n        )}\r\n        style={{height: \"auto\"}}\r\n      />\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const isLoading = getIsMainMenuLoading(this.props.ctx);\r\n    const mainMenu = getMainMenu(this.props.ctx);\r\n\r\n    if (isLoading || !mainMenu) {\r\n      return null; // TODO: More intelligent menu loading indicator...\r\n    }\r\n\r\n    return this.props.forceOpen ? (\r\n      <div className={S.forceOpenSection}>\r\n        <SidebarSectionDivider/>\r\n        {this.renderHeader()}\r\n        <SidebarSectionBody isActive={true}>\r\n          {this.props.folder && <>{this.listFromNode(mainMenu.menuUI, 1, true)}</>}\r\n        </SidebarSectionBody>\r\n      </div>\r\n    ) : (\r\n      <SidebarSection isActive={this.props.isActive}>\r\n        <SidebarSectionDivider/>\r\n        {this.renderHeader()}\r\n        <SidebarSectionBody isActive={this.props.isActive}>\r\n          {this.props.folder && this.props.isActive && <>{this.listFromNode(mainMenu.menuUI, 1, true)}</>}\r\n        </SidebarSectionBody>\r\n      </SidebarSection>\r\n    );\r\n  }\r\n}\r\n\r\nclass DragStateContainer {\r\n\r\n  private static instances: DragStateContainer[] = [];\r\n\r\n  @observable\r\n  editingEnabled = false;\r\n\r\n  constructor() {\r\n    DragStateContainer.instances.push(this);\r\n  }\r\n\r\n  flipEditEnabled() {\r\n    if (!this.editingEnabled) {\r\n      for (let instance of DragStateContainer.instances) {\r\n        instance.editingEnabled = false;\r\n      }\r\n    }\r\n    this.editingEnabled = !this.editingEnabled;\r\n  }\r\n}\r\n\r\nfunction getAllElements(node: any): any {\r\n  return Array.from(getAllElementsRecursive(node.elements));\r\n}\r\n\r\nfunction*getAllElementsRecursive(elements: any[]): any {\r\n  for (let childNode of elements) {\r\n    if (childNode.name === \"Submenu\") {\r\n      yield*getAllElementsRecursive(childNode.elements);\r\n    } else {\r\n      yield childNode;\r\n    }\r\n  }\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Icon } from \"@origam/components\";\r\nimport { SidebarAlertCounter } from \"gui/Components/Sidebar/AlertCounter\";\r\nimport { LogoSection } from \"gui/Components/Sidebar/LogoSection\";\r\nimport { Sidebar } from \"gui/Components/Sidebar/Sidebar\";\r\nimport { SidebarSection } from \"gui/Components/Sidebar/SidebarSection\";\r\nimport { SidebarSectionDivider } from \"gui/Components/Sidebar/SidebarSectionDivider\";\r\nimport { SidebarSectionHeader } from \"gui/Components/Sidebar/SidebarSectionHeader\";\r\nimport React from \"react\";\r\nimport { CMainMenu } from \"gui/connections/CMainMenu\";\r\nimport { action, reaction } from \"mobx\";\r\nimport { SidebarSectionBody } from \"gui/Components/Sidebar/SidebarSectionBody\";\r\nimport { MobXProviderContext, observer, Provider } from \"mobx-react\";\r\nimport { getWorkQueuesTotalItemsCount } from \"model/selectors/WorkQueues/getWorkQueuesTotalItemCount\";\r\nimport { IWorkbench } from \"model/entities/types/IWorkbench\";\r\nimport { CWorkQueues } from \"gui/connections/CWorkQueues\";\r\nimport { IInfoSubsection } from \"gui/connections/types\";\r\nimport { CSidebarInfoSection } from \"gui/connections/CSidebarInfoSection\";\r\nimport { addRecordInfoExpandRequestHandler } from \"model/actions-ui/RecordInfo/addRecordInfoExpandRequestHandler\";\r\nimport { addRecordAuditExpandRequestHandler } from \"model/actions-ui/RecordInfo/addRecordAuditExpandRequestHandler\";\r\nimport { T } from \"utils/translation\";\r\nimport S from \"gui/connections/CSidebar.module.scss\";\r\nimport { getLogoUrl } from \"model/selectors/getLogoUrl\";\r\nimport { CChatSection } from \"gui/connections/CChatSection\";\r\nimport { getChatrooms } from \"model/selectors/Chatrooms/getChatrooms\";\r\nimport { getShowChat } from \"model/selectors/PortalSettings/getShowChat\";\r\nimport { getShowWorkQues } from \"model/selectors/PortalSettings/getShowWorkQues\";\r\nimport { getNotifications } from \"model/selectors/Chatrooms/getNotifications\";\r\nimport { SearchResults } from \"gui/Components/Search/SearchResults\";\r\nimport { CFavorites } from \"gui/connections/CFavorites\";\r\nimport { getFavorites } from \"model/selectors/MainMenu/getFavorites\";\r\nimport { DragDropContext } from 'react-beautiful-dnd';\r\nimport { Breakpoint } from \"react-socks\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\n\r\n@observer\r\nexport class CSidebar extends React.Component {\r\n  static contextType = MobXProviderContext;\r\n\r\n  get workbench(): IWorkbench {\r\n    return this.context.workbench;\r\n  }\r\n\r\n  get sidebarState() {\r\n    return this.workbench.sidebarState;\r\n  }\r\n\r\n  @action.bound handleExpandRecordAuditLog() {\r\n    this.sidebarState.activeInfoSubsection = IInfoSubsection.Audit;\r\n    this.sidebarState.activeSection = \"Info\";\r\n  }\r\n\r\n  @action.bound handleExpandRecordInfo() {\r\n    this.sidebarState.activeInfoSubsection = IInfoSubsection.Info;\r\n    this.sidebarState.activeSection = \"Info\";\r\n  }\r\n\r\n  disposers: any[] = [];\r\n\r\n  componentDidMount() {\r\n    this.disposers.push(\r\n      addRecordInfoExpandRequestHandler(this.workbench)(this.handleExpandRecordInfo),\r\n      addRecordAuditExpandRequestHandler(this.workbench)(this.handleExpandRecordAuditLog)\r\n    );\r\n    this.disposers.push(\r\n      reaction(\r\n        () => getFavorites(this.workbench).favoriteFolders,\r\n        (favoriteFolders) => {\r\n          const firstNonEmpty = favoriteFolders.find(\r\n            (folder) => folder.itemIds.length > 0 && !folder.isPinned\r\n          );\r\n          if (firstNonEmpty) {\r\n            this.sidebarState.activeSection = firstNonEmpty.id;\r\n          }\r\n        },\r\n        {fireImmediately: true}\r\n      )\r\n    );\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.disposers.forEach((disposer) => disposer());\r\n  }\r\n\r\n  renderWorkQuesSection() {\r\n    const workQueuesItemsCount = getWorkQueuesTotalItemsCount(this.workbench);\r\n    return (\r\n      <SidebarSection isActive={this.sidebarState.activeSection === \"WorkQueues\"}>\r\n        <SidebarSectionDivider/>\r\n        <SidebarSectionHeader\r\n          isActive={this.sidebarState.activeSection === \"WorkQueues\"}\r\n          icon={\r\n            <>\r\n              <Icon src=\"./icons/work-queue.svg\" tooltip={T(\"Work Queues\", \"work_queue_measure\")}/>\r\n              {workQueuesItemsCount > 0 && (\r\n                <SidebarAlertCounter>{workQueuesItemsCount}</SidebarAlertCounter>\r\n              )}\r\n            </>\r\n          }\r\n          label={<>{T(\"Work Queues\", \"work_queue_measure\")}</>}\r\n          onClick={() => (this.sidebarState.activeSection = \"WorkQueues\")}\r\n        />\r\n        <SidebarSectionBody isActive={this.sidebarState.activeSection === \"WorkQueues\"}>\r\n          <CWorkQueues/>\r\n        </SidebarSectionBody>\r\n      </SidebarSection>\r\n    );\r\n  }\r\n\r\n  renderChatSection(): React.ReactNode {\r\n    const totalUnreadMessages = getChatrooms(this.workbench).totalItemCount;\r\n    return (\r\n      <SidebarSection isActive={this.sidebarState.activeSection === \"Chat\"}>\r\n        <SidebarSectionDivider/>\r\n        <SidebarSectionHeader\r\n          isActive={this.sidebarState.activeSection === \"Chat\"}\r\n          icon={\r\n            <>\r\n              <Icon src=\"./icons/chat.svg\" tooltip={T(\"Chat\", \"chat\")}/>\r\n              {totalUnreadMessages > 0 && (\r\n                <SidebarAlertCounter>{totalUnreadMessages}</SidebarAlertCounter>\r\n              )}\r\n            </>\r\n          }\r\n          label={<>{T(\"Chat\", \"chat\")}</>}\r\n          onClick={() => (this.sidebarState.activeSection = \"Chat\")}\r\n        />\r\n        <SidebarSectionBody isActive={this.sidebarState.activeSection === \"Chat\"}>\r\n          <CChatSection/>\r\n        </SidebarSectionBody>\r\n      </SidebarSection>\r\n    );\r\n  }\r\n\r\n  @action\r\n  async onDragEnd(result: any) {\r\n    if (!result.destination) return;\r\n\r\n    let sourceFolderId = this.getIdFromDropIdentifier(result.source.droppableId);\r\n    let destinationFolderId = this.getIdFromDropIdentifier(result.destination.droppableId);\r\n    let itemId = this.getIdFromDropIdentifier(result.draggableId);\r\n\r\n    const favorites = getFavorites(this.workbench);\r\n    const destinationFolder = favorites.favoriteFolders\r\n      .find(folder => folder.id === destinationFolderId)!;\r\n    const sourceFolder = favorites.favoriteFolders\r\n      .find(folder => folder.id === sourceFolderId)!;\r\n    if (sourceFolderId === destinationFolderId) {\r\n      if (result.source.index === result.destination.index) {\r\n        return;\r\n      }\r\n      await favorites.moveItemInFolder(sourceFolder.itemIds, result.source.index, result.destination.index)\r\n      return;\r\n    }\r\n    await favorites.moveItemBetweenFolders(itemId, sourceFolder, destinationFolder);\r\n  }\r\n\r\n  getIdFromDropIdentifier(droppableId: string) {\r\n    let split = droppableId.split(\"_\");\r\n    return split[split.length - 1]\r\n  }\r\n\r\n  render() {\r\n    const showChat = getShowChat(this.workbench);\r\n    const showWorkQues = getShowWorkQues(this.workbench);\r\n    const notificationBox = getNotifications(this.workbench)?.notificationBox;\r\n    const logoUrl = getLogoUrl(this.workbench);\r\n    const favorites = getFavorites(this.workbench);\r\n\r\n    return (\r\n      <Sidebar>\r\n        <LogoSection>\r\n          <div className={S.logoLeft}>\r\n            {notificationBox ? (\r\n              <div dangerouslySetInnerHTML={{__html: notificationBox}}/>\r\n            ) : (\r\n              <img src={logoUrl} alt=\"\"/>\r\n            )}\r\n          </div>\r\n        </LogoSection>\r\n        <DragDropContext onDragEnd={(result) => this.onDragEnd(result)}>\r\n          {favorites.favoriteFolders\r\n            .filter((folder) => folder.isPinned)\r\n            .map((folder) => (\r\n              <CFavorites ctx={this.workbench} folder={folder} isActive={true} forceOpen={true}/>\r\n            ))}\r\n\r\n          {showWorkQues ? this.renderWorkQuesSection() : null}\r\n\r\n          {showChat ? this.renderChatSection() : null}\r\n\r\n          {favorites.favoriteFolders\r\n            .filter((folder) => !folder.isPinned)\r\n            .map((folder) => (\r\n              <CFavorites\r\n                key={folder.id}\r\n                ctx={this.workbench}\r\n                folder={folder}\r\n                isActive={this.sidebarState.activeSection === folder.id}\r\n                onHeaderClick={() => (this.sidebarState.activeSection = folder.id)}\r\n              />\r\n            ))}\r\n          <SidebarSection isActive={this.sidebarState.activeSection === \"Menu\"}>\r\n            <Provider mainMenuState={this.sidebarState.mainMenuState}>\r\n              <CMainMenu\r\n                isActive={this.sidebarState.activeSection === \"Menu\"}\r\n                onClick={() => this.sidebarState.activeSection = \"Menu\"}\r\n              />\r\n            </Provider>\r\n          </SidebarSection>\r\n          {!isMobileLayoutActive(this.workbench) &&\r\n            <SidebarSection isActive={this.sidebarState.activeSection === \"Info\"}>\r\n              <SidebarSectionDivider/>\r\n              <SidebarSectionHeader\r\n                isActive={this.sidebarState.activeSection === \"Info\"}\r\n                icon={<Icon src=\"./icons/info.svg\" tooltip={T(\"Info\", \"infopanel_title\")}/>}\r\n                label={T(\"Info\", \"infopanel_title\")}\r\n                onClick={() => (this.sidebarState.activeSection = \"Info\")}\r\n              />\r\n              <SidebarSectionBody isActive={this.sidebarState.activeSection === \"Info\"}>\r\n                <CSidebarInfoSection activeSubsection={this.sidebarState.activeInfoSubsection}/>\r\n              </SidebarSectionBody>\r\n            </SidebarSection>\r\n          }\r\n          <Breakpoint medium up>\r\n            <SidebarSection isActive={this.sidebarState.activeSection === \"Search\"}>\r\n              <SidebarSectionDivider/>\r\n              <SidebarSectionHeader\r\n                isActive={this.sidebarState.activeSection === \"Search\"}\r\n                icon={\r\n                  <Icon\r\n                    src=\"./icons/search.svg\"\r\n                    tooltip={T(\"Search\", \"search_result\", this.sidebarState.resultCount)}\r\n                  />\r\n                }\r\n                label={T(\"Search\", \"search_result\", this.sidebarState.resultCount)}\r\n                onClick={() => (this.sidebarState.activeSection = \"Search\")}\r\n              />\r\n              <SidebarSectionBody isActive={this.sidebarState.activeSection === \"Search\"}>\r\n                <SearchResults groups={this.sidebarState.searchResultGroups} ctx={this.workbench}/>\r\n              </SidebarSectionBody>\r\n              <SidebarSectionDivider/>\r\n            </SidebarSection>\r\n          </Breakpoint>\r\n        </DragDropContext>\r\n      </Sidebar>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getRecordInfo } from \"model/selectors/RecordInfo/getRecordInfo\"\r\n\r\nexport function addRecordInfoExpandRequestHandler(ctx: any) {\r\n  return function addRecordInfoExpandRequestHandler(handler: () => void) {\r\n    return getRecordInfo(ctx).addInfoSectionExpandHandler(handler);\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getRecordInfo } from \"model/selectors/RecordInfo/getRecordInfo\";\r\n\r\nexport function addRecordAuditExpandRequestHandler(ctx: any) {\r\n  return function addRecordAuditExpandRequestHandler(handler: () => void) {\r\n    return getRecordInfo(ctx).addAuditSectionExpandHandler(handler);\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbenchLifecycle } from \"model/selectors/getWorkbenchLifecycle\";\r\n\r\nexport function getShowChat(ctx: any): boolean {\r\n  return getWorkbenchLifecycle(ctx).portalSettings?.showChat ?? false;\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbenchLifecycle } from \"model/selectors/getWorkbenchLifecycle\";\r\n\r\nexport function getShowWorkQues(ctx: any): boolean {\r\n  return getWorkbenchLifecycle(ctx).portalSettings?.showWorkQueues ?? false;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbenchLifecycle } from \"model/selectors/getWorkbenchLifecycle\";\r\n\r\nexport function getLogoUrl(ctx: any): string | undefined {\r\n  return getWorkbenchLifecycle(ctx).logoUrl;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/ScreenHeader/ScreenHeader.module.scss\";\r\n\r\nexport class ScreenHeader extends React.Component<{\r\n  isLoading?: boolean;\r\n}> {\r\n  render() {\r\n    return (\r\n      <div className={S.root}>\r\n        {this.props.children}\r\n        {(this.props.isLoading || window.localStorage.getItem(\"debugKeepProgressIndicatorsOn\")) && (\r\n          <div className={S.progressIndicator}>\r\n            <div className={S.indefinite}/>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/ScreenHeader/ScreenHeaderAction.module.scss\";\r\nimport cx from \"classnames\";\r\n\r\nexport class ScreenHeaderAction extends React.Component<{\r\n  isActive?: boolean;\r\n  className?: string;\r\n  onClick?(event: any): void;\r\n}> {\r\n  render() {\r\n    return (\r\n      <a\r\n        className={cx(S.root, this.props.className, {\r\n          isActive: this.props.isActive\r\n        })}\r\n        onClick={this.props.onClick}\r\n      >\r\n        {this.props.children}\r\n      </a>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/ScreenHeader/ScreenHeaderPusher.module.scss\";\r\n\r\nexport class ScreenHeaderPusher extends React.Component {\r\n  render() {\r\n    return <div className={S.root}/>;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbench } from \"../getWorkbench\";\r\n\r\nexport function getIsCurrentScreenFull(ctx: any) {\r\n  return getWorkbench(ctx).isFullScreen;\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getDataViewList } from \"./getDataViewList\";\r\nimport { getIsDataViewWorking } from \"../DataView/getIsDataViewWorking\";\r\nimport { getIsFormScreenWorkingDelayed } from \"./getIsFormScreenWorking\";\r\n\r\nexport function getIsScreenOrAnyDataViewWorking(ctx: any) {\r\n  return (\r\n    getIsFormScreenWorkingDelayed(ctx) ||\r\n    Array.from(getDataViewList(ctx)).some(dataView =>\r\n      getIsDataViewWorking(dataView)\r\n    )\r\n  );\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/ScreenHeader/ScreenHeaderDivider.module.scss\";\r\n\r\nexport class ScreenheaderDivider extends React.Component {\r\n  render() {\r\n    return <div className={S.root}/>;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\n\r\nexport function onWorkflowAbortClick(ctx: any) {\r\n  return flow(function*onWorkflowAbortClick(event: any) {\r\n    try {\r\n      const lifecycle = getFormScreenLifecycle(ctx);\r\n      yield*lifecycle.onWorkflowAbortClick(event);\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Icon } from \"@origam/components\";\r\nimport { ScreenHeader } from \"gui/Components/ScreenHeader/ScreenHeader\";\r\nimport { ScreenHeaderAction } from \"gui/Components/ScreenHeader/ScreenHeaderAction\";\r\nimport { ScreenHeaderPusher } from \"gui/Components/ScreenHeader/ScreenHeaderPusher\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { onFullscreenClick } from \"model/actions-ui/ScreenHeader/onFullscreenClick\";\r\nimport { IWorkbench } from \"model/entities/types/IWorkbench\";\r\nimport { getIsScreenOrAnyDataViewWorking } from \"model/selectors/FormScreen/getIsScreenOrAnyDataViewWorking\";\r\nimport { getIsCurrentScreenFull } from \"model/selectors/Workbench/getIsCurrentScreenFull\";\r\nimport React from \"react\";\r\nimport { ScreenheaderDivider } from \"gui/Components/ScreenHeader/ScreenHeaderDivider\";\r\nimport { onWorkflowAbortClick } from \"model/actions-ui/ScreenHeader/onWorkflowAbortClick\";\r\nimport { onWorkflowNextClick } from \"model/actions-ui/ScreenHeader/onWorkflowNextClick\";\r\n\r\nimport S from \"gui/Components/ScreenHeader/ScreenHeader.module.scss\";\r\nimport { T } from \"utils/translation\";\r\nimport { ErrorBoundaryEncapsulated } from \"gui/Components/Utilities/ErrorBoundary\";\r\nimport { IOpenedScreen } from \"model/entities/types/IOpenedScreen\";\r\nimport { getActiveScreen } from \"model/selectors/getActiveScreen\";\r\n\r\n@observer\r\nexport class CScreenHeader extends React.Component {\r\n  static contextType = MobXProviderContext;\r\n\r\n  get workbench(): IWorkbench {\r\n    return this.context.workbench;\r\n  }\r\n\r\n  render() {\r\n    const activeScreen = getActiveScreen(this.workbench);\r\n    if (!activeScreen) {\r\n      return null;\r\n    }\r\n    return (\r\n      <ErrorBoundaryEncapsulated ctx={activeScreen}>\r\n        <CScreenHeaderInner activeScreen={activeScreen}/>\r\n      </ErrorBoundaryEncapsulated>\r\n    );\r\n  }\r\n}\r\n\r\n@observer\r\nclass CScreenHeaderInner extends React.Component<{ activeScreen: IOpenedScreen }> {\r\n  render() {\r\n    const {activeScreen} = this.props;\r\n    const {content} = activeScreen;\r\n    const isFullscreen = getIsCurrentScreenFull(activeScreen);\r\n    if (!content) return null;\r\n    const isNextButton = content.formScreen && content.formScreen.showWorkflowNextButton;\r\n    const isCancelButton = content.formScreen && content.formScreen.showWorkflowCancelButton;\r\n    return (\r\n      <ScreenHeader\r\n        isLoading={content.isLoading || getIsScreenOrAnyDataViewWorking(content.formScreen!)}\r\n      >\r\n        <h1>{activeScreen.formTitle}</h1>\r\n        {(isCancelButton || isNextButton) && <ScreenheaderDivider/>}\r\n        {isCancelButton && (\r\n          <button\r\n            className={S.workflowActionBtn}\r\n            onClick={onWorkflowAbortClick(content.formScreen!)}\r\n          >\r\n            {T(\"Cancel\", \"button_cancel\")}\r\n          </button>\r\n        )}\r\n        {isNextButton && (\r\n          <button\r\n            className={S.workflowActionBtn}\r\n            onClick={onWorkflowNextClick(content.formScreen!)}\r\n          >\r\n            {T(\"Next\", \"button_next\")}\r\n          </button>\r\n        )}\r\n        <ScreenHeaderPusher/>\r\n        <ScreenHeaderAction onClick={onFullscreenClick(activeScreen)} isActive={isFullscreen}>\r\n          <Icon\r\n            src=\"./icons/fullscreen.svg\"\r\n            tooltip={T(\"Fullscreen\", \"fullscreen_button_tool_tip\")}\r\n          />\r\n        </ScreenHeaderAction>\r\n      </ScreenHeader>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbench } from \"model/selectors/getWorkbench\";\r\nimport { getIsCurrentScreenFull } from \"model/selectors/Workbench/getIsCurrentScreenFull\";\r\n\r\nexport function onFullscreenClick(ctx: any) {\r\n  return function onFullscreenClick(event: any) {\r\n    getWorkbench(ctx).setFullscreen(!getIsCurrentScreenFull(ctx));\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/Screen/ScreenContainer.module.scss\";\r\n\r\nexport const ScreenContainer: React.FC = props => (\r\n  <div className={S.root}>{props.children}</div>\r\n);","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/WorkflowFinishedPanel/WorkflowFinishedPanel.module.scss\";\r\nimport { T } from \"utils/translation\";\r\n\r\nexport const WorkflowFinishedPanel: React.FC<{\r\n  isCloseButton: boolean;\r\n  isRepeatButton: boolean;\r\n  onCloseClick?(event: any): void;\r\n  onRepeatClick?(event: any): void;\r\n  message: string;\r\n}> = (props) => (\r\n  <div className={S.root}>\r\n    {props.isRepeatButton && <button onClick={props.onRepeatClick}>{T(\"Repeat\", \"button_repeat\")}</button>}\r\n    {props.isCloseButton && <button onClick={props.onCloseClick}>{T(\"Close\", \"button_close\")}</button>}\r\n    {/*<iframe className={S.message} srcDoc={} />*/}\r\n    <div className={S.message} dangerouslySetInnerHTML={{__html: `${props.message}`}}/>\r\n  </div>\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n\r\nexport function panelSizeRatioToServerValue(sizeRatio: number) {\r\n  return Math.round(sizeRatio * 1000_000);\r\n}\r\n\r\nexport function serverValueToPanelSizeRatio(serverStoredSizeRatio: number | undefined) {\r\n\r\n  const panelPositionRatio = serverStoredSizeRatio\r\n    ? serverStoredSizeRatio / 1000_000\r\n    : 0.5;\r\n\r\n  if (panelPositionRatio < 0.1 || panelPositionRatio > 0.9) return 0.5; // this was either on old value representing the position in pixels or some error\r\n  return panelPositionRatio;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getApi } from \"model/selectors/getApi\";\r\n\r\nexport function saveSplitPanelConfiguration(ctx: any) {\r\n  return function*saveSplitPanelConfiguration(\r\n    modelInstanceId: string,\r\n    position: number\r\n  ) {\r\n    yield getApi(ctx).saveSplitPanelConfiguration({\r\n      InstanceId: modelInstanceId,\r\n      Position: position\r\n    });\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { saveSplitPanelConfiguration } from \"model/actions/FormScreen/saveSplitPanelConfiguration\";\r\nimport { getFormScreen } from \"model/selectors/FormScreen/getFormScreen\";\r\nimport { panelSizeRatioToServerValue } from \"./splitterPositionToServerValue\";\r\n\r\nexport function onSplitterPositionChangeFinished(ctx: any) {\r\n  return flow(function*onSplitterPositionChangeFinished(\r\n    modelInstanceId: string,\r\n    sizeRatio: number\r\n  ) {\r\n    let panelSizeRatioServerValue = panelSizeRatioToServerValue(sizeRatio);\r\n    getFormScreen(ctx).setPanelSize(modelInstanceId, panelSizeRatioServerValue);\r\n    yield*saveSplitPanelConfiguration(ctx)(modelInstanceId, panelSizeRatioServerValue);\r\n  });\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"./Label.module.css\";\r\n\r\nexport class Label extends React.Component<{ height?: number; text: string }> {\r\n  render() {\r\n    return (\r\n      <div className={S.label} style={{height: this.props.height}}>\r\n        {this.props.text}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from './VBox.module.scss';\r\n\r\nexport class VBox extends React.Component<{\r\n  height?: number\r\n}> {\r\n  getVBoxStyle() {\r\n    if (this.props.height !== undefined) {\r\n      return {\r\n        flexShrink: 0,\r\n        height: this.props.height\r\n      };\r\n    } else {\r\n      return {\r\n        flexGrow: 1\r\n      };\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className={S.vBox} style={this.getVBoxStyle()}>\r\n        {this.props.children}\r\n      </div>\r\n    );\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from './HBox.module.scss';\r\n\r\nexport class HBox extends React.Component<{\r\n  width?: number\r\n}> {\r\n  getHBoxStyle() {\r\n    // TODO: Change to width?\r\n    if (this.props.width !== undefined) {\r\n      return {\r\n        flexShrink: 0,\r\n        width: this.props.width\r\n      };\r\n    } else {\r\n      return {\r\n        flexGrow: 1\r\n      };\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className={S.hBox} style={this.getHBoxStyle()}>\r\n        {this.props.children}\r\n      </div>\r\n    );\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useContext } from \"react\";\r\nimport S from \"gui/Components/TabbedView/TabbedViewPanel.module.scss\";\r\nimport cx from \"classnames\";\r\nimport { CtxPanelVisibility } from \"gui/contexts/GUIContexts\";\r\n\r\nexport const TabbedViewPanel: React.FC<{ isActive: boolean }> = props => {\r\n  const ctxPanelVisibility = useContext(CtxPanelVisibility);\r\n  return (\r\n    <CtxPanelVisibility.Provider\r\n      value={{isVisible: props.isActive && ctxPanelVisibility.isVisible}}\r\n    >\r\n      <div className={cx(S.root, {isActive: props.isActive})}>\r\n        {props.children}\r\n      </div>\r\n    </CtxPanelVisibility.Provider>\r\n  );\r\n};\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/TabbedView/TabbedView.module.scss\";\r\n\r\nexport const TabbedView: React.FC = props => (\r\n  <div className={S.root}>{props.children}</div>\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/TabbedView/TabbedViewPanelsContainer.module.scss\";\r\n\r\nexport const TabbedViewPanelsContainer: React.FC = props => (\r\n  <div className={S.root}>{props.children}</div>\r\n);","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { observer, Observer } from \"mobx-react\";\r\nimport { TabbedViewPanel } from \"gui/Components/TabbedView/TabbedViewPanel\";\r\nimport { TabbedViewHandleRow } from \"gui/Components/TabbedView/TabbedViewHandleRow\";\r\nimport { TabbedViewHandle } from \"gui/Components/TabbedView/TabbedViewHandle\";\r\nimport { action, observable } from \"mobx\";\r\nimport { TabbedView } from \"gui/Components/TabbedView/TabbedView\";\r\nimport { TabbedViewPanelsContainer } from \"gui/Components/TabbedView/TabbedViewPanelsContainer\";\r\nimport { IDataView } from \"model/entities/types/IDataView\";\r\nimport { getTablePanelView } from \"model/selectors/TablePanelView/getTablePanelView\";\r\nimport { findStopping, findUIChildren } from \"xmlInterpreters/xmlUtils\";\r\n\r\n@observer\r\nexport class CScreenSectionTabbedView extends React.Component<{\r\n  boxes: any[];\r\n  nextNode: (node: any) => React.ReactNode;\r\n  dataViewMap: Map<string, IDataView>\r\n}> {\r\n  @observable activePanelId: string =\r\n    this.props.boxes.length > 0 ? this.props.boxes[0].attributes.Id : \"\";\r\n\r\n  @action.bound activateTab(tabId: string) {\r\n    this.activePanelId = tabId;\r\n    const activeBox = this.props.boxes.find(box => box.attributes[\"Id\"] === tabId);\r\n    const firstGridId = this.getFirstGridId(activeBox)\r\n    if (firstGridId) {\r\n      const dataView = this.props.dataViewMap.get(firstGridId);\r\n      const tablePanelView = getTablePanelView(dataView);\r\n      tablePanelView.triggerOnFocusTable();\r\n    }\r\n  }\r\n\r\n  getFirstGridId(box: any) {\r\n    return findStopping(box, (node) => node?.attributes?.Type === \"Grid\")\r\n      .map(element => element.attributes[\"Id\"])\r\n      .find(element => element)\r\n  }\r\n\r\n  render() {\r\n    const {boxes} = this.props;\r\n    return (\r\n      <TabbedView>\r\n        <TabbedViewHandleRow>\r\n          {boxes.map((box) => (\r\n            <Observer key={box.$iid}>\r\n              {() => (\r\n                <TabbedViewHandle\r\n                  title={box.attributes.Name}\r\n                  id={\"tabHandle_\"+box.attributes.ModelInstanceId}\r\n                  key={box.attributes.Id}\r\n                  isActive={this.activePanelId === box.attributes.Id}\r\n                  onClick={() => this.activateTab(box.attributes.Id)}\r\n                >\r\n                  {box.attributes.Name}\r\n                </TabbedViewHandle>\r\n              )}\r\n            </Observer>\r\n          ))}\r\n        </TabbedViewHandleRow>\r\n        <TabbedViewPanelsContainer>\r\n          {boxes.map((box) => (\r\n            <Observer key={box.$iid}>\r\n              {() => (\r\n                <TabbedViewPanel\r\n                  key={box.attributes.Id}\r\n                  isActive={this.activePanelId === box.attributes.Id}\r\n                >\r\n                  {findUIChildren(box).map((child) => this.props.nextNode(child))}\r\n                </TabbedViewPanel>\r\n              )}\r\n            </Observer>\r\n          ))}\r\n        </TabbedViewPanelsContainer>\r\n      </TabbedView>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"./Box.module.css\";\r\n\r\nexport class Box extends React.Component {\r\n  render() {\r\n    return <div className={S.box}>{this.props.children}</div>;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IFormScreen } from \"model/entities/types/IFormScreen\";\r\nimport { IDataView } from \"model/entities/types/IDataView\";\r\nimport { getSessionId } from \"model/selectors/getSessionId\";\r\nimport { pluginLibrary } from \"plugins/tools/PluginLibrary\";\r\nimport { WorkflowFinishedPanel } from \"gui/Components/WorkflowFinishedPanel/WorkflowFinishedPanel\";\r\nimport actions from \"model/actions-ui-tree\";\r\nimport { serverValueToPanelSizeRatio } from \"model/actions-ui/Splitter/splitterPositionToServerValue\";\r\nimport { IPanelData } from \"gui/Components/Splitter/IPanelData\";\r\nimport { Splitter } from \"gui/Components/Splitter/Splitter\";\r\nimport SSplitter from \"gui/Workbench/ScreenArea/CustomSplitter.module.scss\";\r\nimport { onSplitterPositionChangeFinished } from \"model/actions-ui/Splitter/onSplitterPositionChangeFinished\";\r\nimport { Label } from \"gui/Components/ScreenElements/Label\";\r\nimport { VBox } from \"gui/Components/ScreenElements/VBox\";\r\nimport { HBox } from \"gui/Components/ScreenElements/HBox\";\r\nimport { getDataViewById } from \"model/selectors/DataView/getDataViewById\";\r\nimport { DataView } from \"gui/Components/ScreenElements/DataView\";\r\nimport { CScreenSectionTabbedView } from \"gui/connections/CScreenSectionTabbedView\";\r\nimport { Box } from \"gui/Components/ScreenElements/Box\";\r\nimport React from \"react\";\r\nimport { findBoxes, findUIChildren } from \"xmlInterpreters/xmlUtils\";\r\n\r\nexport function desktopRecursiveBuilder(formScreen: IFormScreen, xso: any) {\r\n\r\n  const dataViewMap = new Map<string, IDataView>();\r\n\r\n  function run(xso: any) {\r\n    switch (xso.attributes.Type) {\r\n      case \"ScreenLevelPlugin\":\r\n      case \"SectionLevelPlugin\": {\r\n        let dataView = getDataView(xso);\r\n        let sessionId = getSessionId(formScreen);\r\n        return pluginLibrary.getComponent(\r\n          {\r\n            name: xso.attributes.Name,\r\n            modelInstanceId: xso.attributes.ModelInstanceId,\r\n            sessionId: sessionId,\r\n            ctx: dataView\r\n          });\r\n      }\r\n      case \"WorkflowFinishedPanel\": {\r\n        return (\r\n          <WorkflowFinishedPanel\r\n            key={xso.$iid}\r\n            isCloseButton={xso.attributes.showWorkflowCloseButton}\r\n            isRepeatButton={xso.attributes.showWorkflowRepeatButton}\r\n            message={xso.attributes.Message}\r\n            onCloseClick={actions.workflow.onCloseClick(formScreen)}\r\n            onRepeatClick={actions.workflow.onRepeatClick(formScreen)}\r\n          />\r\n        );\r\n      }\r\n      case \"VSplit\":\r\n      case \"HSplit\": {\r\n        const serverStoredValue = formScreen.getPanelPosition(xso.attributes.ModelInstanceId);\r\n        const panelPositionRatio = serverValueToPanelSizeRatio(serverStoredValue);\r\n\r\n        const panels: IPanelData[] = findUIChildren(xso).map((child, idx) => {\r\n          return {\r\n            id: idx,\r\n            positionRatio: idx === 0 ? panelPositionRatio : 1 - panelPositionRatio,\r\n            element: run(child),\r\n          }\r\n        });\r\n        return (\r\n          <Splitter\r\n            key={xso.$iid}\r\n            STYLE={SSplitter}\r\n            type={xso.attributes.Type === \"HSplit\" ? \"isHoriz\" : \"isVert\"}\r\n            id={xso.attributes.ModelInstanceId}\r\n            onSizeChangeFinished={(\r\n              panelId1: any,\r\n              panelId2: any,\r\n              panel1SizeRatio: number,\r\n              panel2SizeRatio: number\r\n            ) => {\r\n              if (panelId1 === panels[0].id) {\r\n                onSplitterPositionChangeFinished(formScreen)(\r\n                  xso.attributes.ModelInstanceId,\r\n                  panel1SizeRatio\r\n                );\r\n              }\r\n              if (panelId2 === panels[0].id) {\r\n                onSplitterPositionChangeFinished(formScreen)(\r\n                  xso.attributes.ModelInstanceId,\r\n                  panel2SizeRatio\r\n                );\r\n              }\r\n            }}\r\n            panels={panels}\r\n          />\r\n        );\r\n      }\r\n      case \"Label\":\r\n        return (\r\n          <Label\r\n            key={xso.$iid}\r\n            height={parseInt(xso.attributes.Height, 10)}\r\n            text={xso.attributes.Name}\r\n          />\r\n        );\r\n      case \"VBox\":\r\n        return (\r\n          <VBox\r\n            key={xso.$iid}\r\n            height={xso.attributes.Height ? parseInt(xso.attributes.Height, 10) : undefined}\r\n          >\r\n            {findUIChildren(xso).map((child) => run(child))}\r\n          </VBox>\r\n        );\r\n      case \"HBox\":\r\n        return (\r\n          <HBox\r\n            key={xso.$iid}\r\n            width={xso.attributes.Width ? parseInt(xso.attributes.Width, 10) : undefined}\r\n          >\r\n            {findUIChildren(xso).map((child) => run(child))}\r\n          </HBox>\r\n        );\r\n      case \"TreePanel\":\r\n      case \"Grid\":\r\n        const dataView = getDataViewById(formScreen, xso.attributes.Id);\r\n        if (dataView) {\r\n          dataViewMap.set(xso.attributes.Id, dataView);\r\n        }\r\n        return (\r\n          <DataView\r\n            key={xso.$iid}\r\n            id={xso.attributes.Id}\r\n            modelInstanceId={xso.attributes.ModelInstanceId}\r\n            height={xso.attributes.Height ? parseInt(xso.attributes.Height, 10) : undefined}\r\n            width={xso.attributes.Width ? parseInt(xso.attributes.Width, 10) : undefined}\r\n            isHeadless={xso.attributes.IsHeadless === \"true\"}\r\n          />\r\n        );\r\n      case \"Tab\":\r\n        return (\r\n          <CScreenSectionTabbedView\r\n            key={xso.$iid}\r\n            boxes={findBoxes(xso)}\r\n            nextNode={run}\r\n            dataViewMap={dataViewMap}\r\n          />\r\n        );\r\n      case \"Box\":\r\n        return <Box key={xso.$iid}>{findUIChildren(xso).map((child) => run(child))}</Box>;\r\n      default:\r\n        console.error(\"Unknown node:\", xso);  // eslint-disable-line no-console\r\n        return null;\r\n    }\r\n  }\r\n\r\n  function getDataView(xso: any) {\r\n    const dataView = getDataViewById(formScreen, xso.attributes.Id);\r\n    if (dataView) {\r\n      dataViewMap.set(xso.attributes.Id, dataView);\r\n    }\r\n    return dataView;\r\n  }\r\n\r\n  return run(xso);\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useContext } from \"react\";\r\nimport S from \"./BreadCrumbs.module.scss\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { BreadCrumbsState } from \"model/entities/MobileState/BreadCrumbsState\";\r\n\r\nexport const BreadCrumbs: React.FC<{}> = observer((props) => {\r\n  const breadCrumbsState = useContext(MobXProviderContext).application.mobileState.breadCrumbsState as BreadCrumbsState;\r\n  const breadCrumbList = breadCrumbsState.activeBreadCrumbList?.filter(node => node.isVisible()) ?? [];\r\n\r\n  function makeBreadcrumb(node: IBreadCrumbNode, index: number) {\r\n    return (\r\n      <div\r\n        className={index === breadCrumbList.length - 1 ? \"\" : S.breadcrumb}\r\n        key={node.id}\r\n        onClick={node.onClick}\r\n      >\r\n        {node.caption}\r\n      </div>);\r\n  }\r\n\r\n  return (\r\n    <div className={S.navigationBar}>\r\n      {breadCrumbList.length > 0 &&\r\n        breadCrumbList\r\n          .flatMap((node, i) => i === 0\r\n            ? [makeBreadcrumb(node, i)]\r\n            : [<div key={node.id + \"Sep\"} className={S.pathSeparator}>/</div>,\r\n              makeBreadcrumb(node, i)\r\n            ]\r\n          )\r\n      }\r\n    </div>\r\n  );\r\n});\r\n\r\nexport interface IBreadCrumbNode {\r\n  caption: string;\r\n  id: string;\r\n  isVisible: () => boolean;\r\n  onClick: () => void;\r\n}\r\n\r\nexport class BreadCrumbNode implements IBreadCrumbNode {\r\n  isVisible = () => true;\r\n\r\n  constructor(\r\n    public caption: string,\r\n    public id: string,\r\n    public onClick: () => void\r\n  ) {\r\n  }\r\n}\r\n\r\nexport class RootBreadCrumbNode implements IBreadCrumbNode {\r\n  constructor(\r\n    public getCaption: () => string,\r\n  ) {\r\n  }\r\n\r\n  id = \"root\";\r\n\r\n  onClick = () => {\r\n  };\r\n\r\n  isVisible = () => true;\r\n\r\n  get caption(){\r\n    return this.getCaption();\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { ReactNode } from \"react\";\r\nimport { IDataView } from \"model/entities/types/IDataView\";\r\nimport { action, computed, observable } from \"mobx\";\r\nimport { MobileState } from \"model/entities/MobileState/MobileState\";\r\nimport { BreadCrumbNode } from \"gui/connections/MobileComponents/Navigation/BreadCrumbs\";\r\nimport { IFormScreen } from \"model/entities/types/IFormScreen\";\r\nimport { getActiveScreen } from \"model/selectors/getActiveScreen\";\r\nimport { getFieldErrorMessage } from \"model/selectors/DataView/getFieldErrorMessage\";\r\n\r\nexport interface INavigationNode {\r\n  readonly name: string;\r\n  readonly children: INavigationNode[];\r\n  readonly allChildren: INavigationNode[];\r\n  parent: INavigationNode | undefined;\r\n  readonly parentChain: INavigationNode[];\r\n  readonly element: ReactNode;\r\n  readonly id: string;\r\n  dataView: IDataView | undefined;\r\n  formScreen: IFormScreen | undefined;\r\n\r\n  equals(other: INavigationNode): boolean;\r\n  addChild(node: INavigationNode): void;\r\n  removeChild(node: INavigationNode): void;\r\n  merge(other: INavigationNode): void;\r\n  readonly navigationDisabled: boolean;\r\n}\r\n\r\nexport class NavigationNode implements INavigationNode {\r\n  private _children: NavigationNode[] = [];\r\n  private _name: string = \"\";\r\n  private _dataView: IDataView | undefined;\r\n  formScreen: IFormScreen | undefined;\r\n  parent: NavigationNode | undefined;\r\n\r\n  get dataView(): IDataView | undefined {\r\n    if(this._dataView){\r\n      return this._dataView;\r\n    }\r\n    if(!this.parent && (this.formScreen?.rootDataViews?.length ?? 0) > 0){\r\n      return this.formScreen!.rootDataViews[0]!\r\n    }\r\n      return undefined;\r\n  }\r\n\r\n  set dataView(value: IDataView | undefined) {\r\n    this._dataView = value;\r\n  }\r\n\r\n  public id: string = \"\";\r\n  public element: ReactNode = null as any;\r\n\r\n  get name(): string {\r\n    let finalName = !this._name ? this.id : this._name;\r\n    if(!this.parent && this.formScreen){\r\n      finalName = getActiveScreen(this.formScreen)\r\n        ?.tabTitle\r\n        ?? finalName;\r\n    }\r\n    return finalName\r\n  }\r\n\r\n  set name(value: string) {\r\n    this._name = value;\r\n  }\r\n\r\n  get children() {\r\n    return this._children;\r\n  }\r\n\r\n  get allChildren() {\r\n    return this._children.flatMap(child => child.children);\r\n  }\r\n\r\n  get parentChain() {\r\n    let parent = this.parent;\r\n    const chain: INavigationNode[] = [this];\r\n    while (parent) {\r\n      chain.push(parent);\r\n      parent = parent.parent;\r\n    }\r\n    return chain.reverse();\r\n  }\r\n\r\n  @computed\r\n  get navigationDisabled(){\r\n    if(!this.dataView?.selectedRow){\r\n      return false;\r\n    }\r\n    return this.dataView.properties\r\n      .some(prop => getFieldErrorMessage(prop!)(this.dataView!.selectedRow!, prop!))\r\n  }\r\n\r\n  addChild(node: NavigationNode) {\r\n    this._children.push(node);\r\n    node.parent = this;\r\n  }\r\n\r\n  removeChild(node: NavigationNode) {\r\n    this._children.remove(node);\r\n    node.parent = undefined;\r\n  }\r\n\r\n  merge(other: NavigationNode) {\r\n    this.element = other.element;\r\n    for (const child of [...other.children]) {\r\n      other.removeChild(child);\r\n      this.addChild(child);\r\n    }\r\n    this.id = other.id;\r\n    this._name = other._name;\r\n    this._dataView = other._dataView;\r\n  }\r\n\r\n  equals(other: INavigationNode): boolean {\r\n    return this.id === other.id;\r\n  }\r\n}\r\n\r\nexport class NavigatorState{\r\n\r\n  @observable\r\n  currentNode: INavigationNode;\r\n\r\n  constructor(private mobileState: MobileState, node: INavigationNode) {\r\n    this.currentNode = node;\r\n  }\r\n\r\n  @computed\r\n  get navigationDisabled(){\r\n    return this.currentNode.parentChain\r\n      .concat(this.currentNode.allChildren)\r\n      .some(node => node.navigationDisabled);\r\n  }\r\n\r\n  @action\r\n  onLinkClick(node: INavigationNode) {\r\n    if(this.navigationDisabled){\r\n      return;\r\n    }\r\n    this.onNodeClick(node);\r\n    this.currentNode.dataView?.activateTableView?.();\r\n  }\r\n\r\n  @action\r\n  private onNodeClick(node: INavigationNode){\r\n    this.currentNode = node;\r\n    this.mobileState.activeDataViewId = node.dataView?.id;\r\n    const nodes = this.currentNode.parentChain\r\n      .map(navNode => new BreadCrumbNode(navNode.name, navNode.id, () => this.onBreadCrumbClick(navNode)));\r\n    this.mobileState.breadCrumbsState.setActiveBreadCrumbList(nodes);\r\n    this.mobileState.breadCrumbsState.addDetailBreadCrumbNode(this.currentNode.dataView!);\r\n  }\r\n\r\n  @action\r\n  onBreadCrumbClick(node: INavigationNode){\r\n    if(this.navigationDisabled){\r\n      return;\r\n    }\r\n    if(this.currentNode === node){\r\n      if(this.currentNode.dataView?.isFormViewActive()){\r\n        this.currentNode.dataView?.activateTableView?.();\r\n      }\r\n      return;\r\n    }\r\n    this.onNodeClick(node);\r\n    this.currentNode.dataView?.activateFormView?.();\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IFormScreen } from \"model/entities/types/IFormScreen\";\r\nimport { INavigationNode, NavigationNode } from \"gui/connections/MobileComponents/Navigation/NavigationNode\";\r\nimport { getDataViewById } from \"model/selectors/DataView/getDataViewById\";\r\nimport { getDataViewLabel } from \"model/selectors/DataView/getDataViewLabel\";\r\nimport { IComponentFactory } from \"gui/Workbench/ScreenArea/FormScreenBuilder/IComponentFactory\";\r\nimport { findBoxes, findUIChildren } from \"xmlInterpreters/xmlUtils\";\r\n\r\n\r\nexport function mobileRecursiveBuilder(args:{\r\n  formScreen: IFormScreen;\r\n  title: string;\r\n  uiRoot: any;\r\n  desktopRecursiveBuilder: (formScreen: IFormScreen, xso: any) => any;\r\n  componentFactory: IComponentFactory;\r\n}) {\r\n\r\n  function run(xso: any, currentNavigationNode: INavigationNode | undefined): any {\r\n    const isRootLevelNavigationNode = !currentNavigationNode;\r\n    if (xso.attributes.Type === \"VSplit\" ||\r\n      xso.attributes.Type === \"HSplit\" ||\r\n      xso.attributes.Type === \"VBox\" ||\r\n      xso.attributes.Type === \"HBox\") {\r\n\r\n      let masterNavigationNode = new NavigationNode();\r\n      let detailNavigationNode = new NavigationNode();\r\n\r\n      const [masterXmlNode, detailXmlNode] = findUIChildren(xso);\r\n      const masterReactElement = run(masterXmlNode, masterNavigationNode);\r\n      if (!detailXmlNode) {\r\n        if (masterReactElement) {\r\n          return masterReactElement;\r\n        } else {\r\n          return args.componentFactory.getDetailNavigator(masterNavigationNode);\r\n        }\r\n      }\r\n      masterNavigationNode.addChild(detailNavigationNode);\r\n      const detailReactElement = run(detailXmlNode, detailNavigationNode);\r\n\r\n      if (!masterReactElement) {\r\n        throw new Error(\"Master element cannot be null\");\r\n      }\r\n      assignMasterNavigationNodeProperties(masterNavigationNode, masterReactElement, masterXmlNode, xso);\r\n      if (detailReactElement) {\r\n        assignDetailNavigationNodeProperties(detailNavigationNode, detailReactElement, detailXmlNode);\r\n      }\r\n\r\n      if (isRootLevelNavigationNode) {\r\n        return args.componentFactory.getDetailNavigator(masterNavigationNode);\r\n      } else {\r\n        currentNavigationNode!.merge(masterNavigationNode);\r\n        return masterReactElement;\r\n      }\r\n    }\r\n\r\n    if (xso.attributes.Type === \"Tab\") {\r\n      const tabNodes = findBoxes(xso).map(box => {\r\n        const childXmlNode = findUIChildren(box)[0];\r\n        const tabNode = new NavigationNode();\r\n        const element = run(childXmlNode, tabNode);\r\n        if (element) {\r\n          tabNode.element = element;\r\n          tabNode.id = childXmlNode.attributes.Id;\r\n          tabNode.name = box.attributes.Name\r\n            ? box.attributes.Name\r\n            : childXmlNode.attributes.Name;\r\n          tabNode.dataView = getDataViewById(args.formScreen, element.props.id);\r\n        }\r\n        return tabNode;\r\n      });\r\n\r\n      const masterNode = new NavigationNode();\r\n      masterNode.id = xso.attributes.Id;\r\n      masterNode.name = getMasterNavigationNodeName(xso);\r\n      masterNode.formScreen = args.formScreen;\r\n      tabNodes.forEach(tabNode => masterNode.addChild(tabNode));\r\n      if (isRootLevelNavigationNode) {\r\n        return args.componentFactory.getTabNavigator(masterNode);\r\n      } else {\r\n        mergeNodesToParentView(currentNavigationNode, masterNode, tabNodes);\r\n        return undefined;\r\n      }\r\n    }\r\n    if (xso.attributes.Type === \"TreePanel\" || xso.attributes.Type === \"Grid\") {\r\n      return args.componentFactory.getDataView(\r\n        {\r\n          key: xso.$iid,\r\n          id:xso.attributes.Id,\r\n          modelInstanceId: xso.attributes.ModelInstanceId,\r\n          isHeadless: xso.attributes.IsHeadless === \"true\"\r\n        });\r\n    }\r\n    return args.desktopRecursiveBuilder(args.formScreen, xso);\r\n  }\r\n\r\n  function getMasterNavigationNodeName(xmlNode: any, xmlParentNode?: any) {\r\n    return !xmlNode.attributes.Name && (xmlNode === args.uiRoot || xmlParentNode === args.uiRoot)\r\n      ? args.title\r\n      : xmlNode.attributes.Name;\r\n  }\r\n\r\n  function assignMasterNavigationNodeProperties(navigationNode: NavigationNode, element: any, xmlNode: any, parentXmlElement: any) {\r\n    navigationNode.element = element;\r\n    navigationNode.id = xmlNode.attributes.Id;\r\n    navigationNode.formScreen = args.formScreen;\r\n    navigationNode.dataView = args.formScreen.getDataViewByModelInstanceId(element.props?.modelInstanceId);\r\n    navigationNode.name = getMasterNavigationNodeName(xmlNode, parentXmlElement);\r\n  }\r\n\r\n  function assignDetailNavigationNodeProperties(navigationNode: NavigationNode, reactElement: any, xmlNode: any) {\r\n    navigationNode.element = reactElement;\r\n    navigationNode.id = xmlNode.attributes.Id;\r\n    navigationNode.formScreen = args.formScreen;\r\n    navigationNode.dataView = args.formScreen.getDataViewByModelInstanceId(reactElement.props?.modelInstanceId);\r\n    navigationNode.name = navigationNode.dataView ? getDataViewLabel(navigationNode.dataView) : xmlNode.attributes.Name;\r\n  }\r\n\r\n  function mergeNodesToParentView(currentNavigationNode: INavigationNode, masterNode: INavigationNode, tabNodes: INavigationNode[]) {\r\n    const parent = currentNavigationNode.parent;\r\n    if (parent) {\r\n      parent.removeChild(currentNavigationNode);\r\n      tabNodes.forEach(tabNode => parent.addChild(tabNode));\r\n    } else {\r\n      currentNavigationNode.merge(masterNode);\r\n    }\r\n  }\r\n\r\n  return run(args.uiRoot, undefined);\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useState } from \"react\";\r\nimport S from \"gui/connections/MobileComponents/Navigation/DetailNavigator.module.scss\";\r\nimport SN from \"gui/connections/MobileComponents/Navigation/NavigationButton.module.scss\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { INavigationNode, NavigatorState } from \"gui/connections/MobileComponents/Navigation/NavigationNode\";\r\nimport cx from \"classnames\";\r\nimport { NavigationButton } from \"gui/connections/MobileComponents/Navigation/NavigationButton\";\r\nimport { MobileState } from \"model/entities/MobileState/MobileState\";\r\nimport { getOpenedScreen } from \"model/selectors/getOpenedScreen\";\r\nimport { T } from \"utils/translation\";\r\nimport { BreadCrumbsState } from \"model/entities/MobileState/BreadCrumbsState\";\r\n\r\n@observer\r\nexport class StandaloneDetailNavigator extends React.Component<{\r\n  node: INavigationNode;\r\n}> {\r\n\r\n  static contextType = MobXProviderContext;\r\n\r\n  get mobileState(): MobileState {\r\n    return this.context.application.mobileState;\r\n  }\r\n\r\n  navigatorState = new NavigatorState(this.mobileState, this.props.node);\r\n\r\n  onScreenActivation(){\r\n    this.mobileState.activeDataViewId = this.props.node.dataView?.id;\r\n  }\r\n\r\n  componentDidMount() {\r\n    if(this.props.node.dataView){\r\n      getOpenedScreen(this.props.node.dataView)\r\n        .activationHandler\r\n        .add(() => this.onScreenActivation());\r\n      this.onScreenActivation();\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if(this.props.node.dataView){\r\n      getOpenedScreen(this.props.node.dataView)\r\n        .activationHandler\r\n        .remove(() => this.onScreenActivation());\r\n    }\r\n  }\r\n\r\n  render(){\r\n    return <DetailNavigator node={this.navigatorState.currentNode} onNodeClick={node => this.navigatorState.onLinkClick(node)}/>\r\n  }\r\n}\r\n\r\n@observer\r\nexport class DetailNavigator extends React.Component<{\r\n  node: INavigationNode;\r\n  onNodeClick: (node: INavigationNode) => void;\r\n}> {\r\n\r\n  static contextType = MobXProviderContext;\r\n\r\n  get breadCrumbsState(): BreadCrumbsState {\r\n    return this.context.application.mobileState.breadCrumbsState;\r\n  }\r\n\r\n  componentDidMount() {\r\n    if(this.props.node.dataView?.isTableViewActive && !this.props.node.parent){\r\n      this.breadCrumbsState.addDetailBreadCrumbNodeToRoot(this.props.node.dataView);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if(!this.props.node){\r\n      return <div/>;\r\n    }\r\n    return (\r\n      <div className={S.root}>\r\n        {this.props.node.element\r\n          ? this.props.node.element\r\n          : <div className={S.contentPlaceholder}/>\r\n        }\r\n        <NavigationButtonList\r\n          onClick={(node) => this.props.onNodeClick(node)}\r\n          nodes={this.props.node.children}\r\n         />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport const NavigationButtonList: React.FC<{\r\n  nodes: INavigationNode[];\r\n  onClick: (node: INavigationNode) => void;\r\n}> = observer((props) => {\r\n\r\n  const [open, setOpen] = useState(false);\r\n\r\n  if (props.nodes.length <= 3) {\r\n    return (\r\n      <div className={SN.navigationButtonContainer}>\r\n        {props.nodes?.map(node =>\r\n          <NavigationButton\r\n            key={node.name}\r\n            label={node.name}\r\n            onClick={() => props.onClick(node)}\r\n          />\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n  return (\r\n    <div\r\n      className={cx(open ? S.navigatorButtonListRoot : \"\", S.navigationButtonContainer)}\r\n      onClick={() => setOpen(!open)}\r\n    >\r\n      <NavigationButton\r\n        label= {T(\"Details\", \"mobile_details_dropdown\")}\r\n        onClick={() => setOpen(!open)}\r\n        isOpen={open}\r\n      >\r\n        <div className={S.navigationButtonList}>\r\n          <div className={SN.navigationButtonContainer}>\r\n            {open &&\r\n              props.nodes.map(node =>\r\n                <NavigationButton\r\n                  key={node.name}\r\n                  label={node.name}\r\n                  onClick={() => props.onClick(node)}\r\n                />)\r\n            }\r\n          </div>\r\n        </div>\r\n      </NavigationButton>\r\n    </div>\r\n  );\r\n});\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport SN from \"gui/connections/MobileComponents/Navigation/NavigationButton.module.scss\";\r\nimport { INavigationNode, NavigatorState } from \"gui/connections/MobileComponents/Navigation/NavigationNode\";\r\nimport { NavigationButton } from \"gui/connections/MobileComponents/Navigation/NavigationButton\";\r\nimport { DetailNavigator } from \"gui/connections/MobileComponents/Navigation/DetailNavigator\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { MobileState } from \"model/entities/MobileState/MobileState\";\r\nimport { getOpenedScreen } from \"model/selectors/getOpenedScreen\";\r\n\r\n@observer\r\nexport class TabNavigator extends React.Component<{\r\n  rootNode: INavigationNode;\r\n}> {\r\n\r\n  static contextType = MobXProviderContext;\r\n\r\n  get mobileState(): MobileState {\r\n    return this.context.application.mobileState;\r\n  }\r\n\r\n  navigatorState = new NavigatorState(this.mobileState, this.props.rootNode);\r\n\r\n  onScreenActivation(){\r\n    this.mobileState.activeDataViewId = this.props.rootNode.dataView?.id\r\n  }\r\n\r\n  componentDidMount() {\r\n    if(this.props.rootNode.dataView){\r\n      getOpenedScreen(this.props.rootNode.dataView)\r\n        .activationHandler\r\n        .add(() => this.onScreenActivation());\r\n      this.onScreenActivation();\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if(this.props.rootNode.dataView){\r\n      getOpenedScreen(this.props.rootNode.dataView)\r\n        .activationHandler\r\n        .remove(() => this.onScreenActivation());\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if(!this.navigatorState.currentNode){\r\n      return null;\r\n    }\r\n    if (!this.navigatorState.currentNode.parent) {\r\n      return (\r\n        <div className={SN.navigationButtonContainer}>\r\n          {this.navigatorState.currentNode.children.map(node =>\r\n            <NavigationButton\r\n              key={node.id}\r\n              label={node.name}\r\n              onClick={() => this.navigatorState.onLinkClick(node)}\r\n            />)\r\n          }\r\n        </div>\r\n      );\r\n    } else {\r\n      return <DetailNavigator node={this.navigatorState.currentNode} onNodeClick={node => this.navigatorState.onLinkClick(node)}/>\r\n    }\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { StandaloneDetailNavigator } from \"gui/connections/MobileComponents/Navigation/DetailNavigator\";\r\nimport { INavigationNode } from \"gui/connections/MobileComponents/Navigation/NavigationNode\";\r\nimport { TabNavigator } from \"gui/connections/MobileComponents/Navigation/TabNavigator\";\r\nimport { DataView } from \"gui/Components/ScreenElements/DataView\";\r\nimport { IComponentFactory } from \"gui/Workbench/ScreenArea/FormScreenBuilder/IComponentFactory\";\r\n\r\n\r\nexport class ComponentFactory implements IComponentFactory {\r\n\r\n  getDetailNavigator(masterNavigationNode: INavigationNode){\r\n    return <StandaloneDetailNavigator node={masterNavigationNode}/>\r\n  }\r\n\r\n  getTabNavigator(masterNode: INavigationNode){\r\n    return <TabNavigator rootNode={masterNode}/>\r\n  }\r\n\r\n  getDataView(args: {key: string, id: string, modelInstanceId: string, isHeadless: boolean} ){\r\n    return (\r\n      <DataView\r\n        key={args.key}\r\n        id={args.id}\r\n        modelInstanceId={args.modelInstanceId}\r\n        isHeadless={args.isHeadless}\r\n      />\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { IFormScreen } from \"model/entities/types/IFormScreen\";\r\nimport React from \"react\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\nimport { desktopRecursiveBuilder } from \"gui/Workbench/ScreenArea/FormScreenBuilder/desktopRecursiveBuilder\";\r\nimport { mobileRecursiveBuilder } from \"gui/Workbench/ScreenArea/FormScreenBuilder/mobileRecursiveBuilder\";\r\nimport { ComponentFactory } from \"gui/Workbench/ScreenArea/FormScreenBuilder/ComponentFactory\";\r\nimport { findUIRoot } from \"xmlInterpreters/xmlUtils\";\r\n\r\n@observer\r\nexport class FormScreenBuilder extends React.Component<{\r\n  title: string;\r\n  xmlWindowObject: any;\r\n}> {\r\n  static contextType = MobXProviderContext;\r\n\r\n  get formScreen(): IFormScreen {\r\n    return this.context.formScreen.formScreen;\r\n  }\r\n\r\n  render() {\r\n    const uiRoot = findUIRoot(this.props.xmlWindowObject);\r\n\r\n    if(isMobileLayoutActive(this.formScreen)){\r\n      return mobileRecursiveBuilder({\r\n        uiRoot: uiRoot,\r\n        formScreen: this.formScreen,\r\n        title: this.props.title,\r\n        desktopRecursiveBuilder: desktopRecursiveBuilder,\r\n        componentFactory: new ComponentFactory(),\r\n      });\r\n    }\r\n    else\r\n    {\r\n      return desktopRecursiveBuilder(this.formScreen, uiRoot);\r\n    }\r\n  }\r\n}\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/Screen/Screen.module.scss\";\r\nimport cx from \"classnames\";\r\n\r\nexport const Screen: React.FC<{ isHidden?: boolean }> = props => (\r\n  <div className={cx(S.root, {isHidden: props.isHidden})}>\r\n    {props.children}\r\n  </div>\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useCallback, useEffect, useState } from \"react\";\r\nimport S from \"gui/Components/WebScreen/WebScreen.module.scss\";\r\nimport cx from \"classnames\";\r\n\r\nexport const WebScreen: React.FC<{\r\n  url: string;\r\n  isLoading?: boolean;\r\n  refIFrame?: any;\r\n  onLoad?: any;\r\n  onLoadStart?: any;\r\n}> = props => {\r\n  const [mouseDowned, setMouseDowned] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const handleMouseDown = () => {\r\n      setMouseDowned(true);\r\n      window.addEventListener(\"mouseup\", handleMouseup);\r\n    };\r\n    const handleMouseup = () => {\r\n      setMouseDowned(false);\r\n      window.removeEventListener(\"mouseup\", handleMouseup);\r\n    };\r\n\r\n    window.addEventListener(\"mousedown\", handleMouseDown);\r\n    return () => window.removeEventListener(\"mousedown\", handleMouseDown);\r\n  }, []);\r\n\r\n  const refIFrame = useCallback((elm: any) => {\r\n    props.refIFrame && props.refIFrame(elm);\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  return (\r\n    <div className={S.root}>\r\n      {props.isLoading && (\r\n        <div className={S.progressIndicator}>\r\n          <div className={S.indefinite}/>\r\n        </div>\r\n      )}\r\n      <iframe\r\n        onLoad={props.onLoad}\r\n        onLoadStart={props.onLoadStart}\r\n        ref={refIFrame}\r\n        className={S.webContent}\r\n        src={props.url}\r\n      />\r\n      <div className={cx(S.transparentOverlay, {isVisible: mouseDowned})}/>\r\n    </div>\r\n  );\r\n};\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getOpenedScreen } from \"./getOpenedScreen\";\r\nimport { getTopmostOpenedNonDialogScreenItem } from \"./getTopmostNonDialogScreenItem\";\r\n\r\nexport function getIsTopmostNonDialogScreen(ctx: any) {\r\n  const screen = getOpenedScreen(ctx);\r\n  const topmostNonDialogScreen = getTopmostOpenedNonDialogScreenItem(ctx);\r\n  if (screen && topmostNonDialogScreen) {\r\n    return (\r\n      screen.menuItemId === topmostNonDialogScreen.menuItemId &&\r\n      screen.order === topmostNonDialogScreen.order\r\n    );\r\n  }\r\n  return false;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getOpenedNonDialogScreenItems } from \"./getOpenedNonDialogScreenItems\";\r\nimport { IOpenedScreen } from \"model/entities/types/IOpenedScreen\";\r\n\r\nexport function getTopmostOpenedNonDialogScreenItem(ctx: any): IOpenedScreen | undefined {\r\n  const screens = [...getOpenedNonDialogScreenItems(ctx)];\r\n  screens.sort((a, b) => b.stackPosition - a.stackPosition);\r\n  return screens[0];\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { getWorkbenchLifecycle } from \"model/selectors/getWorkbenchLifecycle\";\r\n\r\nexport function openScreenByReference(ctx: any) {\r\n  return function*openScreenByReference(categoryId: string, referenceId: string): Generator {\r\n    const api = getApi(ctx);\r\n    const menuId = yield api.getMenuIdByReference({\r\n      Category: categoryId,\r\n      ReferenceId: referenceId,\r\n    });\r\n    yield*getWorkbenchLifecycle(ctx).onMainMenuItemIdClick({\r\n      event: undefined,\r\n      itemId: menuId,\r\n      idParameter: referenceId,\r\n      isSingleRecordEdit: true\r\n    });\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getWorkbenchLifecycle } from \"model/selectors/getWorkbenchLifecycle\";\r\nimport { openScreenByReference } from \"../Workbench/openScreenByReference\";\r\n\r\nexport function executeWeblink(ctx: any) {\r\n  return function*executeWeblink(urlPath: string, urlQuery?: { [key: string]: any }): Generator {\r\n    switch (urlPath) {\r\n      case \"openScreenByMenuItemId\": {\r\n        const menuId = urlQuery?.menuItemId;\r\n        if (menuId) {\r\n          yield*getWorkbenchLifecycle(ctx).onMainMenuItemIdClick({\r\n            event: undefined,\r\n            itemId: menuId,\r\n            idParameter: undefined,\r\n          });\r\n        }\r\n      }\r\n        break;\r\n      case \"objectTag\": {\r\n        const referenceId = urlQuery?.objectId;\r\n        const categoryId = urlQuery?.categoryId;\r\n        if (referenceId && categoryId) {\r\n          yield*openScreenByReference(ctx)(categoryId, referenceId);\r\n        }\r\n      }\r\n        break;\r\n    }\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport qs from \"querystring\";\r\nimport { handleError } from \"../handleError\";\r\nimport { executeWeblink } from \"./executeWeblink\";\r\n\r\nexport function onRootElementClick(ctx: any) {\r\n  return flow(function*onRootElementClick(event: any): Generator {\r\n    try {\r\n      const {target} = event;\r\n      const {nodeName} = target;\r\n\r\n      if (`${nodeName}`.toLowerCase() === \"a\") {\r\n        const href = target.getAttribute(\"href\");\r\n        if (href && `${href}`.startsWith(\"web+origam-link://\")) {\r\n          const actionUrl = href.replace(\"web+origam-link://\", \"\");\r\n          event.preventDefault();\r\n          const urlParts = actionUrl.split(\"?\");\r\n          const urlPath = urlParts[0];\r\n          const urlQuery = qs.parse(urlParts[1] || \"\");\r\n          yield*executeWeblink(ctx)(urlPath, urlQuery);\r\n        }\r\n      }\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { FormScreenBuilder } from \"gui/Workbench/ScreenArea/FormScreenBuilder/FormScreenBuilder\";\r\nimport { observer, Provider } from \"mobx-react\";\r\nimport { IOpenedScreen } from \"model/entities/types/IOpenedScreen\";\r\nimport React, { useEffect, useMemo, useRef, useState } from \"react\";\r\nimport { Screen } from \"gui/Components/Screen/Screen\";\r\nimport { CtxPanelVisibility } from \"gui/contexts/GUIContexts\";\r\nimport { WebScreen } from \"gui/Components/WebScreen/WebScreen\";\r\nimport { IWebScreen } from \"model/entities/types/IWebScreen\";\r\nimport { getIsTopmostNonDialogScreen } from \"model/selectors/getIsTopmostNonDialogScreen\";\r\nimport { ErrorBoundaryEncapsulated } from \"gui/Components/Utilities/ErrorBoundary\";\r\nimport { IFormScreenEnvelope } from \"model/entities/types/IFormScreen\";\r\nimport { onIFrameClick } from \"model/actions/WebScreen/onIFrameClick\";\r\nimport { onScreenTabCloseClick } from \"model/actions-ui/ScreenTabHandleRow/onScreenTabCloseClick\";\r\n\r\nconst WebScreenComposite: React.FC<{ openedScreen: IOpenedScreen }> = observer((props) => {\r\n  const {openedScreen} = props;\r\n  const [isLoading, setLoading] = useState(false);\r\n  const refIFrame = useRef<any>(null);\r\n\r\n  const setTabTitleFromIFrame = useMemo(\r\n    () => () => {\r\n      const frameWindow = refIFrame.current;\r\n      const contentDocument = frameWindow?.contentDocument;\r\n      if (contentDocument?.title) {\r\n        ((openedScreen as unknown) as IWebScreen).setTitle(contentDocument.title);\r\n      }\r\n    },\r\n    [openedScreen]\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (openedScreen.screenUrl) {\r\n      setLoading(true);\r\n    }\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n  useEffect(() => {\r\n    const handle = setInterval(() => {\r\n      setTabTitleFromIFrame();\r\n    }, 10000);\r\n    return () => clearTimeout(handle);\r\n  }, [setTabTitleFromIFrame]);\r\n\r\n  useEffect(() => {\r\n    const frameWindow = refIFrame.current;\r\n    const contentDocument = frameWindow?.contentDocument;\r\n    const headNode = contentDocument?.querySelector(\"head\");\r\n\r\n    if (contentDocument && headNode) {\r\n      const mo = new MutationObserver(() => {\r\n        setTabTitleFromIFrame();\r\n      });\r\n      mo.observe(headNode, {\r\n        subtree: true,\r\n        characterData: true,\r\n        childList: true,\r\n      });\r\n      return () => mo.disconnect();\r\n    }\r\n  });\r\n\r\n  const initIFrame = useMemo(\r\n    () => () => {\r\n      const frameWindow = refIFrame.current;\r\n      const contentDocument = frameWindow?.contentDocument;\r\n\r\n      if (contentDocument) {\r\n        contentDocument.closeOrigamTab = (() => {\r\n          onScreenTabCloseClick(openedScreen)(undefined);\r\n        });\r\n        contentDocument.addEventListener(\r\n          \"click\",\r\n          (event: any) => {\r\n            onIFrameClick(openedScreen)(event);\r\n          },\r\n          true\r\n        );\r\n      }\r\n    },\r\n    [openedScreen]\r\n  );\r\n  return (\r\n    <Screen isHidden={!getIsTopmostNonDialogScreen(openedScreen)}>\r\n      <WebScreen\r\n        url={openedScreen.screenUrl || \"\"}\r\n        isLoading={isLoading}\r\n        onLoad={(event: any) => {\r\n          event.persist();\r\n          setTabTitleFromIFrame();\r\n          initIFrame();\r\n          setLoading(false);\r\n        }}\r\n        refIFrame={(elm: any) => {\r\n          refIFrame.current = elm;\r\n          ((openedScreen as unknown) as IWebScreen).setReloader(\r\n            elm\r\n              ? {\r\n                reload: () => {\r\n                  setLoading(true);\r\n                  elm.contentWindow.location.reload();\r\n                },\r\n              }\r\n              : null\r\n          );\r\n        }}\r\n      />\r\n    </Screen>\r\n  );\r\n});\r\n\r\n@observer\r\nexport class CScreen extends React.Component<{\r\n  openedScreen: IOpenedScreen;\r\n}> {\r\n  render() {\r\n    const {openedScreen} = this.props;\r\n    if (openedScreen.screenUrl) {\r\n      return (\r\n        <ErrorBoundaryEncapsulated ctx={openedScreen}>\r\n          <WebScreenComposite openedScreen={openedScreen}/>\r\n        </ErrorBoundaryEncapsulated>\r\n      );\r\n    }\r\n    if (!openedScreen.content) return null;\r\n    const formScreen = openedScreen.content;\r\n    return !formScreen.isLoading ? (\r\n      <Provider key={formScreen.formScreen!.screenUI.$iid} formScreen={formScreen}>\r\n        <ErrorBoundaryEncapsulated ctx={openedScreen}>\r\n          <CScreenInner openedScreen={openedScreen} formScreen={formScreen}/>\r\n        </ErrorBoundaryEncapsulated>\r\n      </Provider>\r\n    ) : null;\r\n  }\r\n}\r\n\r\n@observer\r\nclass CScreenInner extends React.Component<{\r\n  openedScreen: IOpenedScreen;\r\n  formScreen: IFormScreenEnvelope;\r\n}> {\r\n  render() {\r\n    const {openedScreen, formScreen} = this.props;\r\n    return (\r\n      <Screen isHidden={!getIsTopmostNonDialogScreen(openedScreen)}>\r\n        <CtxPanelVisibility.Provider\r\n          value={{isVisible: getIsTopmostNonDialogScreen(openedScreen)}}\r\n        >\r\n          <FormScreenBuilder\r\n            title={formScreen.formScreen!.title}\r\n            xmlWindowObject={formScreen.formScreen!.screenUI}\r\n          />\r\n        </CtxPanelVisibility.Provider>\r\n      </Screen>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { onRootElementClick } from \"../Global/onRootElementClick\";\r\nimport { handleError } from \"../handleError\";\r\n\r\nexport function onIFrameClick(ctx: any) {\r\n  return flow(function*onIFrameClick(event: any): Generator {\r\n    try {\r\n      yield onRootElementClick(ctx)(event);\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { ScreenContainer } from \"gui/Components/Screen/ScreenContainer\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { IWorkbench } from \"model/entities/types/IWorkbench\";\r\nimport { getOpenedNonDialogScreenItems } from \"model/selectors/getOpenedNonDialogScreenItems\";\r\nimport React from \"react\";\r\nimport { CScreen } from \"gui/connections/CScreen\";\r\n\r\n@observer\r\nexport class CScreenContent extends React.Component {\r\n  static contextType = MobXProviderContext;\r\n\r\n  get workbench(): IWorkbench {\r\n    return this.context.workbench;\r\n  }\r\n\r\n  render() {\r\n    const openedScreenItems = getOpenedNonDialogScreenItems(this.workbench);\r\n    return (\r\n      <ScreenContainer>\r\n        {openedScreenItems.map(item => (\r\n          <CScreen key={`${item.menuItemId}@${item.order}`} openedScreen={item}/>\r\n        ))}\r\n      </ScreenContainer>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { IAction, IActionMode } from \"model/entities/types/IAction\";\r\nimport { getEntity } from \"model/selectors/DataView/getEntity\";\r\nimport { getGridId } from \"model/selectors/DataView/getGridId\";\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\";\r\nimport { getSelectedRowId } from \"../../selectors/TablePanelView/getSelectedRowId\";\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getDataView } from \"model/selectors/DataView/getDataView\";\r\n\r\nlet isRunning = false;\r\n\r\nexport function onSelectionDialogActionButtonClick(ctx: any) {\r\n  return flow(function*(event: any, action: IAction) {\r\n    try {\r\n      // TODO: Block \"re-submission\" for all ui actions\r\n      if (isRunning) return;\r\n      try {\r\n        isRunning = true;\r\n\r\n        // TODO: Wait for other async operations to finish successfully\r\n\r\n        const lifecycle = getFormScreenLifecycle(ctx);\r\n        const gridId = getGridId(ctx);\r\n        const entity = getEntity(ctx);\r\n        const rowId = getSelectedRowId(ctx);\r\n        const dataView = getDataView(ctx);\r\n        if (rowId) {\r\n          yield*lifecycle.onFlushData();\r\n          const selectedItems: string[] = action.mode === IActionMode.MultipleCheckboxes\r\n            ? Array.from(dataView.selectedRowIds)\r\n            : [rowId];\r\n          yield*lifecycle.onExecuteAction(\r\n            gridId,\r\n            entity,\r\n            action,\r\n            selectedItems\r\n          );\r\n        }\r\n      } finally {\r\n        isRunning = false;\r\n      }\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { observer, Provider } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { IOpenedScreen } from \"../../../model/entities/types/IOpenedScreen\";\r\nimport { FormScreenBuilder } from \"gui/Workbench/ScreenArea/FormScreenBuilder/FormScreenBuilder\";\r\n\r\n\r\n@observer\r\nexport class DialogScreenBuilder extends React.Component<{\r\n  openedScreen: IOpenedScreen;\r\n}> {\r\n  render() {\r\n    const {openedScreen} = this.props;\r\n    const {content} = openedScreen;\r\n    if (!content.isLoading) {\r\n      return (\r\n        <Provider formScreen={content}>\r\n          {!content.isLoading && (\r\n            <>\r\n              <FormScreenBuilder\r\n                title={content.formScreen!.title}\r\n                xmlWindowObject={content.formScreen!.screenUI}\r\n              />\r\n            </>\r\n          )}\r\n        </Provider>\r\n      );\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { CloseButton } from \"@origam/components\";\r\nimport { observer, Observer } from \"mobx-react\";\r\nimport { onScreenTabCloseClick } from \"model/actions-ui/ScreenTabHandleRow/onScreenTabCloseClick\";\r\nimport { onSelectionDialogActionButtonClick } from \"model/actions-ui/SelectionDialog/onSelectionDialogActionButtonClick\";\r\nimport { getIsScreenOrAnyDataViewWorking } from \"model/selectors/FormScreen/getIsScreenOrAnyDataViewWorking\";\r\nimport { showDialog } from \"model/selectors/getDialogStack\";\r\nimport React, { useEffect } from \"react\";\r\nimport { IOpenedScreen } from \"../../../model/entities/types/IOpenedScreen\";\r\nimport { getWorkbenchLifecycle } from \"../../../model/selectors/getWorkbenchLifecycle\";\r\nimport S from \"./ScreenArea.module.scss\";\r\nimport { DialogScreenBuilder } from \"./ScreenBuilder\";\r\nimport { CtxPanelVisibility } from \"gui/contexts/GUIContexts\";\r\nimport { onWorkflowAbortClick } from \"../../../model/actions-ui/ScreenHeader/onWorkflowAbortClick\";\r\nimport { onWorkflowNextClick } from \"../../../model/actions-ui/ScreenHeader/onWorkflowNextClick\";\r\nimport { T } from \"../../../utils/translation\";\r\nimport { IActionPlacement } from \"model/entities/types/IAction\";\r\nimport cx from \"classnames\";\r\nimport { ModalDialog } from \"gui/Components/Dialog/ModalDialog\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\n\r\nexport const DialogScreen: React.FC<{\r\n  openedScreen: IOpenedScreen;\r\n}> = observer((props) => {\r\n  const key = `ScreenDialog@${props.openedScreen.menuItemId}@${props.openedScreen.order}`;\r\n  const workbenchLifecycle = getWorkbenchLifecycle(props.openedScreen);\r\n\r\n  function renderActionButtons() {\r\n    const content = props.openedScreen.content;\r\n    const isNextButton = content.formScreen && content.formScreen.showWorkflowNextButton;\r\n    const isCancelButton = content.formScreen && content.formScreen.showWorkflowCancelButton;\r\n    return (\r\n      <div className={S.actionButtonHeader}>\r\n        {isCancelButton && (\r\n          <button\r\n            className={S.workflowActionBtn}\r\n            onClick={onWorkflowAbortClick(content.formScreen!)}\r\n          >\r\n            {T(\"Cancel\", \"button_cancel\")}\r\n          </button>\r\n        )}\r\n        {isNextButton && (\r\n          <button\r\n            className={S.workflowActionBtn}\r\n            onClick={onWorkflowNextClick(content.formScreen!)}\r\n          >\r\n            {T(\"Next\", \"button_next\")}\r\n          </button>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  useEffect(() => {\r\n    const closeFunction = showDialog(workbenchLifecycle,\r\n      key,\r\n      <Observer>\r\n        {() => (\r\n          <ModalDialog\r\n            title={props.openedScreen.tabTitle}\r\n            titleIsWorking={\r\n              props.openedScreen.content.isLoading ||\r\n              getIsScreenOrAnyDataViewWorking(props.openedScreen.content.formScreen!) ||\r\n              !!window.localStorage.getItem(\"debugKeepProgressIndicatorsOn\")\r\n            }\r\n            titleButtons={\r\n              <CloseButton onClick={(event) => onScreenTabCloseClick(props.openedScreen)(event)}/>\r\n            }\r\n            buttonsCenter={null}\r\n            buttonsLeft={null}\r\n            buttonsRight={\r\n              <Observer>\r\n                {() =>\r\n                  !props.openedScreen.content.isLoading ? (\r\n                    <>\r\n                      {props.openedScreen.content\r\n                        .formScreen!.dialogActions.filter(\r\n                        (action) =>\r\n                          action.placement !== IActionPlacement.PanelHeader &&\r\n                          action.placement !== IActionPlacement.PanelMenu &&\r\n                          action.isEnabled\r\n                      )\r\n                        .map((action, idx) => (\r\n                          <button\r\n                            className={cx({isPrimary: action.isDefault})}\r\n                            tabIndex={0}\r\n                            key={action.id}\r\n                            onClick={(event: any) => {\r\n                              onSelectionDialogActionButtonClick(action)(event, action);\r\n                            }}\r\n                          >\r\n                            {action.caption}\r\n                          </button>\r\n                        ))}\r\n                    </>\r\n                  ) : (\r\n                    <></>\r\n                  )\r\n                }\r\n              </Observer>\r\n            }\r\n          >\r\n            <Observer>\r\n              {() => (\r\n                <div\r\n                  style={{\r\n                    width:  isMobileLayoutActive(props.openedScreen) ? \"unset\" : props.openedScreen.dialogInfo!.width,\r\n                    height: isMobileLayoutActive(props.openedScreen) ? \"60vh\" : props.openedScreen.dialogInfo!.height ,\r\n                    display: \"flex\",\r\n                    flexDirection: \"column\",\r\n                  }}\r\n                >\r\n                  {\r\n                    !props.openedScreen.content.isLoading ? (\r\n                      <CtxPanelVisibility.Provider value={{isVisible: true}}>\r\n                        {renderActionButtons()}\r\n                        <DialogScreenBuilder openedScreen={props.openedScreen}/>\r\n                      </CtxPanelVisibility.Provider>\r\n                    ) : null /*<DialogLoadingContent />*/\r\n                  }\r\n                </div>\r\n              )}\r\n            </Observer>\r\n          </ModalDialog>\r\n        )}\r\n      </Observer>\r\n    );\r\n    return closeFunction;\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n  return null;\r\n});\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { DialogScreen } from \"gui/Workbench/ScreenArea/ScreenArea\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { getOpenedDialogScreenItems } from \"model/selectors/getOpenedDialogScreenItems\";\r\nimport React from \"react\";\r\n\r\n@observer\r\nexport class CDialogContent extends React.Component {\r\n  static contextType = MobXProviderContext;\r\n\r\n  get workbench() {\r\n    return this.context.workbench;\r\n  }\r\n\r\n  render() {\r\n    const openedDialogItems = getOpenedDialogScreenItems(this.workbench);\r\n    return (\r\n      <>\r\n        {openedDialogItems.map(item => (\r\n          <DialogScreen openedScreen={item} key={`${item.menuItemId}@${item.order}`}/>\r\n        ))}\r\n      </>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getOpenedScreens } from \"./getOpenedScreens\";\r\n\r\nexport function getOpenedDialogScreenItems(ctx: any) {\r\n  return getOpenedScreens(ctx).items.filter(item => item.isDialog);\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/Components/Fullscreen/Fullscreen.module.scss\";\r\nimport cx from \"classnames\";\r\n\r\nexport const Fullscreen: React.FC<{ isFullscreen?: boolean }> = props => (\r\n  <div className={cx(S.root, {isFullscreen: props.isFullscreen})}>\r\n    {props.children}\r\n  </div>\r\n);\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { IWorkbench } from \"model/entities/types/IWorkbench\";\r\nimport { getOpenedNonDialogScreenItems } from \"model/selectors/getOpenedNonDialogScreenItems\";\r\nimport { Dropdowner } from \"gui/Components/Dropdowner/Dropdowner\";\r\nimport { MobileState } from \"model/entities/MobileState/MobileState\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { DataViewHeaderAction } from \"gui/Components/DataViewHeader/DataViewHeaderAction\";\r\nimport { Dropdown } from \"gui/Components/Dropdown/Dropdown\";\r\nimport { DropdownItem } from \"gui/Components/Dropdown/DropdownItem\";\r\nimport { onScreenTabHandleClick } from \"model/actions-ui/ScreenTabHandleRow/onScreenTabHandleClick\";\r\nimport S from \"gui/connections/MobileComponents/TopToolBar/TabSelector.module.scss\"\r\nimport { Icon } from \"@origam/components\";\r\nimport { getLabel } from \"gui/connections/CScreenTabbedViewHandleRow\";\r\n\r\n@observer\r\nexport class TabSelector extends React.Component<{\r\n  mobileState: MobileState\r\n}> {\r\n  static contextType = MobXProviderContext;\r\n\r\n  get workbench(): IWorkbench {\r\n    return this.context.workbench;\r\n  }\r\n\r\n  render() {\r\n    if (!this.props.mobileState.layoutState.showOpenTabCombo) {\r\n      return (\r\n        <div className={S.heading}>\r\n          {this.props.mobileState.layoutState.heading}\r\n        </div>\r\n      );\r\n    }\r\n\r\n    const openedScreens = getOpenedNonDialogScreenItems(this.workbench);\r\n    const someScreenIsDirty = openedScreens.some(screen => screen.content.formScreen?.isDirty)\r\n    const activeItem = openedScreens.find(item => item.isActive);\r\n    return (\r\n      <Dropdowner\r\n        trigger={({refTrigger, setDropped}) => (\r\n          <DataViewHeaderAction\r\n            refDom={refTrigger}\r\n            onMouseDown={() => setDropped(true)}\r\n            isActive={false}\r\n          >\r\n            <div className={S.titleContainer}>\r\n              <div className={S.screenName + \" \" + (activeItem?.content?.formScreen?.isDirty ? S.dirtyScreenName : \"\")}>\r\n                {getLabel(activeItem)}\r\n              </div>\r\n              {openedScreens.length > 1 &&\r\n                <Icon\r\n                  className={S.icon + \" \" + (someScreenIsDirty ? S.dirtyIcon : \"\")}\r\n                  src={\"./icons/noun-arrow-89829.svg\"}\r\n                />\r\n              }\r\n            </div>\r\n          </DataViewHeaderAction>\r\n        )}\r\n        content={({setDropped}) =>\r\n          <Dropdown>\r\n            {openedScreens.map(openScreen => {\r\n                const label = getLabel(openScreen);\r\n                return <DropdownItem\r\n                  className={openScreen.content.formScreen?.isDirty ? S.dirtyDropDownItem : \"\"}\r\n                  key={label}\r\n                  onClick={(event: any) => {\r\n                    setDropped(false);\r\n                    onScreenTabHandleClick(openScreen)(event)\r\n                  }}\r\n                >\r\n                  {label}\r\n                </DropdownItem>;\r\n              }\r\n            )}\r\n          </Dropdown>\r\n        }\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/connections/MobileComponents/TopToolBar/SearchButton.module.scss\";\r\nimport { Icon } from \"@origam/components\";\r\nimport { MobileState } from \"model/entities/MobileState/MobileState\";\r\nimport { SearchLayoutState } from \"model/entities/MobileState/MobileLayoutState\";\r\n\r\nexport const SearchButton: React.FC<{\r\n  mobileState: MobileState\r\n}> = (props) => {\r\n  return (\r\n    <div\r\n      className={S.root}\r\n      onClick={() =>  props.mobileState.layoutState = new SearchLayoutState()}\r\n    >\r\n      <Icon src=\"./icons/search.svg\"/>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useContext } from \"react\";\r\nimport S from \"gui/connections/MobileComponents/MenuButton.module.scss\";\r\nimport { Icon } from \"@origam/components\";\r\nimport { SidebarAlertCounter } from \"gui/Components/Sidebar/AlertCounter\";\r\nimport { getWorkQueuesTotalItemsCount } from \"model/selectors/WorkQueues/getWorkQueuesTotalItemCount\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\n\r\nexport const MenuButton: React.FC<{}> = observer((props) => {\r\n\r\n  const context = useContext(MobXProviderContext)\r\n\r\n  const workQueuesItemsCount = getWorkQueuesTotalItemsCount(context.application);\r\n  return (\r\n    <div\r\n      className={S.root}\r\n      onClick={() => context.application.mobileState.hamburgerClick()}\r\n    >\r\n      <Icon\r\n        src={\"./icons/noun-hamburger-4238597.svg\"}\r\n        className={S.menuIcon}\r\n      />\r\n      {workQueuesItemsCount > 0 && (\r\n        <SidebarAlertCounter>{workQueuesItemsCount}</SidebarAlertCounter>\r\n      )}\r\n    </div>\r\n  );\r\n});\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/connections/MobileComponents/TopToolBar/TopToolBar.module.scss\";\r\nimport { getHelpUrl } from \"model/selectors/User/getHelpUrl\";\r\nimport { UserMenuDropdown } from \"gui/Components/UserMenuDropdown/UserMenuDropdown\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { IApplication } from \"model/entities/types/IApplication\";\r\nimport { getUserAvatarLink } from \"model/selectors/User/getUserAvatarLink\";\r\nimport { action } from \"mobx\";\r\nimport { onScreenToolbarLogoutClick } from \"model/actions-ui/ScreenToolbar/onScreenToolbarLogoutClick\";\r\nimport { getLoggedUserName } from \"model/selectors/User/getLoggedUserName\";\r\nimport { TabSelector } from \"gui/connections/MobileComponents/TopToolBar/TabSelector\";\r\nimport { SearchButton } from \"gui/connections/MobileComponents/TopToolBar/SearchButton\";\r\nimport { MenuButton } from \"gui/connections/MobileComponents/MenuButton\";\r\nimport { MobileState } from \"model/entities/MobileState/MobileState\";\r\nimport { AboutLayoutState } from \"model/entities/MobileState/MobileLayoutState\";\r\n\r\n@observer\r\nexport class TopToolBar extends React.Component<{\r\n  mobileState: MobileState\r\n}> {\r\n  static contextType = MobXProviderContext;\r\n\r\n  get application(): IApplication {\r\n    return this.context.application;\r\n  }\r\n\r\n  get layoutState(){\r\n    return this.props.mobileState.layoutState;\r\n  }\r\n\r\n  @action.bound\r\n  handleLogoutClick(event: any) {\r\n    onScreenToolbarLogoutClick(this.application)(event);\r\n  }\r\n\r\n  getLeftElement(){\r\n    if(this.layoutState.showHamburgerMenuButton){\r\n      return <MenuButton/>\r\n    }\r\n    if(this.layoutState.showSearchButton){\r\n      return <div style={{minWidth: \"90px\"}}/>\r\n    }\r\n    return <div style={{minWidth: \"67px\"}}/>\r\n  }\r\n\r\n  render() {\r\n    const avatarLink = getUserAvatarLink(this.application);\r\n    const userName = getLoggedUserName(this.application);\r\n    return (\r\n      <div className={S.root}>\r\n        {this.getLeftElement()}\r\n        <TabSelector mobileState={this.props.mobileState}/>\r\n        {this.layoutState.showSearchButton && <SearchButton mobileState={this.props.mobileState}/>}\r\n        <UserMenuDropdown\r\n          avatarLink={avatarLink}\r\n          handleLogoutClick={(event) => this.handleLogoutClick(event)}\r\n          userName={userName}\r\n          hideLabel={true}\r\n          ctx={this.application}\r\n          onAboutClick={() => this.props.mobileState.layoutState = new AboutLayoutState()}\r\n          helpUrl={getHelpUrl(this.application)}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { SearchView, SearchViewState } from \"gui/Components/Search/SearchView\";\r\nimport { MobXProviderContext } from \"mobx-react\";\r\nimport { IWorkbench } from \"model/entities/types/IWorkbench\";\r\nimport S from \"./Search.module.scss\";\r\n\r\nexport class Search extends React.Component<{\r\n}> {\r\n\r\n  static contextType = MobXProviderContext;\r\n\r\n  get workbench(): IWorkbench {\r\n    return this.context.workbench;\r\n  }\r\n\r\n  searchViewState = new SearchViewState(this.workbench, ()=>{});\r\n\r\n  render() {\r\n    return (\r\n      <div className={S.root}>\r\n        <SearchView state={this.searchViewState}/>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/connections/MobileComponents/BottomToolBar/ActionDropUp.module.scss\";\r\nimport \"gui/connections/MobileComponents/BottomToolBar/ActionDropUp.module.scss\";\r\nimport { Dropdowner } from \"gui/Components/Dropdowner/Dropdowner\";\r\nimport { Icon } from \"@origam/components\";\r\nimport { Dropdown } from \"gui/Components/Dropdown/Dropdown\";\r\nimport { DropdownItem } from \"gui/Components/Dropdown/DropdownItem\";\r\nimport uiActions from \"model/actions-ui-tree\";\r\nimport { IAction } from \"model/entities/types/IAction\";\r\n\r\nexport class ActionDropUp extends React.Component<{\r\n  hidden?: boolean;\r\n  actions: IAction[]\r\n}> {\r\n\r\n  render() {\r\n    return (\r\n      <div className={S.root}>\r\n        {!this.props.hidden && this.props.actions.length > 0\r\n          ?<Dropdowner\r\n            trigger={({refTrigger, setDropped}) => (\r\n              <div\r\n                className={S.clickArea}\r\n                onMouseDown={() => setDropped(true)}\r\n              >\r\n                <div\r\n                  ref={refTrigger}\r\n                  className={S.iconContainer}>\r\n                  <Icon src={\"./icons/noun-right-1784045.svg\"}/>\r\n                </div>\r\n              </div>\r\n            )}\r\n            content={({setDropped}) => (\r\n              <Dropdown>\r\n                {this.props.actions.map(action =>\r\n                  <DropdownItem\r\n                    key={action.id}\r\n                    onClick={(event: any) => {\r\n                      setDropped(false);\r\n                      uiActions.actions.onActionClick(action)(event, action)}\r\n                    }\r\n                  >\r\n                    {action.caption}\r\n                  </DropdownItem>\r\n                )}\r\n              </Dropdown>\r\n            )}\r\n          />\r\n          :<div className={S.placeholder}/>\r\n        }\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"gui/connections/MobileComponents/BottomToolBar/BottomToolBar.module.scss\";\r\nimport \"gui/connections/MobileComponents/BottomToolBar/BottomToolBar.module.scss\";\r\nimport { BottomIcon } from \"gui/connections/MobileComponents/BottomToolBar/BottomIcon\";\r\nimport { MobileState } from \"model/entities/MobileState/MobileState\";\r\nimport { ActionDropUp } from \"gui/connections/MobileComponents/BottomToolBar/ActionDropUp\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { geScreenActionButtonsState } from \"model/actions-ui/ScreenToolbar/saveBottonVisible\";\r\nimport { onSaveSessionClick } from \"model/actions-ui/ScreenToolbar/onSaveSessionClick\";\r\nimport { onRefreshSessionClick } from \"model/actions-ui/ScreenToolbar/onRefreshSessionClick\";\r\nimport { getActiveScreenActions } from \"model/selectors/getActiveScreenActions\";\r\nimport { getIsEnabledAction } from \"model/selectors/Actions/getIsEnabledAction\";\r\nimport { getPanelViewActions } from \"model/selectors/DataView/getPanelViewActions\";\r\nimport { IActionMode } from \"model/entities/types/IAction\";\r\nimport { computed } from \"mobx\";\r\nimport { onWorkflowNextClick } from \"model/actions-ui/ScreenHeader/onWorkflowNextClick\";\r\nimport { getActiveScreen } from \"model/selectors/getActiveScreen\";\r\nimport { Button } from \"@origam/components\";\r\nimport { T } from \"utils/translation\";\r\n\r\n@observer\r\nexport class BottomToolBar extends React.Component<{\r\n  mobileState: MobileState,\r\n  ctx: any\r\n}> {\r\n\r\n  static contextType = MobXProviderContext;\r\n\r\n  get mobileState(): MobileState {\r\n    return this.context.application.mobileState;\r\n  }\r\n\r\n  @computed\r\n  get activeScreen() {\r\n    return getActiveScreen(this.props.ctx)?.content?.formScreen;\r\n  }\r\n\r\n  getActions() {\r\n    const screenActions = getActiveScreenActions(this.props.ctx)\r\n      .flatMap(actionGroup => actionGroup.actions)\r\n      .filter(action => getIsEnabledAction(action));\r\n\r\n\r\n    const dataViews = this.activeScreen?.dataViews;\r\n    if (!dataViews || dataViews.length === 0) {\r\n      return screenActions;\r\n    }\r\n\r\n    let dataView;\r\n    if (dataViews.length === 1) {\r\n      dataView = dataViews[0];\r\n    }\r\n    if (!this.mobileState.activeDataViewId) {\r\n      return screenActions;\r\n    }\r\n    dataView = dataViews.find(dataView => dataView.id === this.mobileState.activeDataViewId);\r\n    if (!dataView) {\r\n      return screenActions;\r\n    }\r\n    const sectionActions = getPanelViewActions(dataView)\r\n      .filter((action) => !action.groupId)\r\n      .filter((action) => getIsEnabledAction(action) || action.mode !== IActionMode.ActiveRecord);\r\n\r\n    return screenActions.concat(sectionActions);\r\n  }\r\n\r\n  showNextButton() {\r\n    return this.activeScreen && this.activeScreen.showWorkflowNextButton;\r\n  }\r\n\r\n  render() {\r\n    const actionButtonsState = geScreenActionButtonsState(this.props.ctx);\r\n\r\n    const actions = this.getActions();\r\n\r\n    const buttons = [];\r\n    if (this.props.mobileState.layoutState.showCloseButton(!!this.activeScreen)) {\r\n      buttons.push(\r\n        <BottomIcon\r\n          key={\"close\"}\r\n          iconPath={\"./icons/noun-close-25798.svg\"}\r\n          onClick={async () => {\r\n            await this.props.mobileState.close()\r\n          }}\r\n        />\r\n      );\r\n    }\r\n    if (this.props.mobileState.layoutState.showOkButton) {\r\n      buttons.push(\r\n        <Button\r\n          key={\"ok\"}\r\n          label={T(\"Ok\", \"button_ok\")}\r\n          onClick={async () => {\r\n            await this.props.mobileState.close()\r\n          }}\r\n        />\r\n      );\r\n    }\r\n    if (actions.length > 0 && !this.props.mobileState.layoutState.actionDropUpHidden) {\r\n      buttons.push(\r\n        <ActionDropUp\r\n          key={\"actions\"}\r\n          actions={actions}\r\n        />\r\n      );\r\n    }\r\n    if (!this.props.mobileState.layoutState.refreshButtonHidden && actionButtonsState?.isRefreshButtonVisible) {\r\n      buttons.push(\r\n        <BottomIcon\r\n          key={\"refresh\"}\r\n          iconPath={\"./icons/noun-loading-1780489.svg\"}\r\n          onClick={onRefreshSessionClick(actionButtonsState?.formScreen)}\r\n        />\r\n      );\r\n    }\r\n    if (!this.props.mobileState.layoutState.saveButtonHidden && actionButtonsState?.isSaveButtonVisible) {\r\n      buttons.push(\r\n        <BottomIcon\r\n          key={\"save\"}\r\n          className={actionButtonsState?.isDirty ? S.isRed : \"\"}\r\n          iconPath={\"./icons/noun-save-1014816.svg\"}\r\n          onClick={onSaveSessionClick(actionButtonsState?.formScreen)}\r\n        />\r\n      );\r\n    }\r\n    if (this.showNextButton()) {\r\n      buttons.push(\r\n        <BottomIcon\r\n          key={\"next\"}\r\n          iconPath={\"./icons/list-arrow-next.svg\"}\r\n          onClick={() => onWorkflowNextClick(this.activeScreen!)(null)}\r\n        />\r\n      );\r\n    }\r\n    return buttons.length !== 0\r\n      ? <div className={S.root}>{buttons}</div>\r\n      : null;\r\n  }\r\n}\r\n\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\n\r\nimport { IAboutInfo } from \"model/entities/types/IAboutInfo\";\r\nimport { MobileState } from \"model/entities/MobileState/MobileState\";\r\nimport S from \"./MobileAboutView.module.scss\";\r\nimport { AboutView } from \"gui/Components/Dialogs/AboutView\";\r\n\r\nexport class MobileAboutView extends React.Component<{\r\n  aboutInfo: IAboutInfo;\r\n  mobileState: MobileState;\r\n}> {\r\n\r\n  render() {\r\n    return (\r\n      <div className={S.root}>\r\n        <AboutView aboutInfo={this.props.aboutInfo}/>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useContext } from \"react\";\r\nimport S from \"./ScreenHeader.module.scss\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { getActiveScreen } from \"model/selectors/getActiveScreen\";\r\n\r\nexport const ScreenHeader: React.FC<{}> = observer((props) => {\r\n\r\n  const application = useContext(MobXProviderContext).application;\r\n  const activeScreen = getActiveScreen(application);\r\n\r\n  if(!activeScreen || !activeScreen.content.formScreen?.workflowTaskId){\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className={S.root}>\r\n      {activeScreen.formTitle}\r\n    </div>\r\n  );\r\n});\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"./MobileMain.module.scss\";\r\nimport { TopToolBar } from \"gui/connections/MobileComponents/TopToolBar/TopToolBar\";\r\nimport { CSidebar } from \"gui/connections/CSidebar\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { MobileState, } from \"model/entities/MobileState/MobileState\";\r\nimport { About } from \"model/entities/AboutInfo\";\r\nimport { getAbout } from \"model/selectors/getAbout\";\r\nimport { Search } from \"gui/connections/MobileComponents/Search\";\r\nimport { BottomToolBar } from \"gui/connections/MobileComponents/BottomToolBar/BottomToolBar\";\r\nimport { MobileAboutView } from \"gui/connections/MobileComponents/MobileAboutView\";\r\nimport { IWorkbench } from \"model/entities/types/IWorkbench\";\r\nimport { CDialogContent } from \"gui/connections/CDialogContent\";\r\nimport { BreadCrumbs } from \"gui/connections/MobileComponents/Navigation/BreadCrumbs\";\r\nimport { CScreenContent } from \"gui/connections/CScreenContent\";\r\nimport { ScreenHeader } from \"gui/connections/MobileComponents/ScreenHeader\";\r\nimport {\r\n  AboutLayoutState,\r\n  DialogLayoutState,\r\n  EditLayoutState,\r\n  MenuLayoutState,\r\n  ScreenLayoutState,\r\n  SearchLayoutState\r\n} from \"model/entities/MobileState/MobileLayoutState\";\r\nimport { getActiveScreen } from \"model/selectors/getActiveScreen\";\r\n\r\n\r\n@observer\r\nexport class MobileMain extends React.Component<{}> {\r\n\r\n  static contextType = MobXProviderContext;\r\n\r\n  get mobileState(): MobileState {\r\n    return this.context.application.mobileState;\r\n  }\r\n\r\n  get workbench(): IWorkbench {\r\n    return this.context.workbench;\r\n  }\r\n\r\n  get about(): About {\r\n    return getAbout(this.context.application);\r\n  }\r\n\r\n  componentDidMount() {\r\n    if(!getActiveScreen(this.workbench)){\r\n      this.mobileState.layoutState = new MenuLayoutState();\r\n    }\r\n    this.about.update();\r\n  }\r\n\r\n  renderMainPageContents() {\r\n    if (this.mobileState.layoutState instanceof MenuLayoutState) {\r\n      return <CSidebar/>;\r\n    }\r\n    if (this.mobileState.layoutState instanceof ScreenLayoutState) {\r\n      return (\r\n        <>\r\n          <BreadCrumbs/>\r\n          <ScreenHeader/>\r\n          <CScreenContent/>\r\n        </>\r\n      );\r\n    }\r\n    if (this.mobileState.layoutState instanceof SearchLayoutState) {\r\n      return <Search/>\r\n    }\r\n    if (this.mobileState.layoutState instanceof EditLayoutState) {\r\n      return (this.mobileState.layoutState as EditLayoutState).component\r\n    }\r\n    if(this.mobileState.layoutState instanceof DialogLayoutState){\r\n      return (this.mobileState.layoutState as DialogLayoutState).component\r\n    }\r\n    if (this.mobileState.layoutState instanceof AboutLayoutState) {\r\n      return <MobileAboutView\r\n        aboutInfo={this.about.info}\r\n        mobileState={this.mobileState}\r\n      />\r\n    }\r\n    throw new Error(this.mobileState.layoutState + \" not implemented\");\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className={S.root}>\r\n        <TopToolBar mobileState={this.mobileState}/>\r\n        {this.renderMainPageContents()}\r\n        <CDialogContent/>\r\n        <BottomToolBar\r\n          mobileState={this.mobileState}\r\n          ctx={this.context.application}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { MobXProviderContext } from \"mobx-react\";\r\nimport { MobileState } from \"model/entities/MobileState/MobileState\";\r\nimport { isMobileLayoutActive } from \"model/selectors/isMobileLayoutActive\";\r\nimport { reaction } from \"mobx\";\r\nimport styleObject from \"gui/connections/MobileComponents/mobile.module.scss\"\r\n\r\nexport class MobileStyleSheetLoader extends React.Component<{}> {\r\n\r\n  static contextType = MobXProviderContext;\r\n\r\n  get application(): MobileState {\r\n    return this.context.application;\r\n  }\r\n\r\n  disposer: (()=>void) | undefined;\r\n\r\n  componentDidMount() {\r\n\r\n    this.disposer = reaction(\r\n      ()=> isMobileLayoutActive(this.application),\r\n      (mobileLayoutActive)=> {\r\n        const identifierClass = \"mobileStyleSheetIdentifier\";\r\n        const sheet = Array.from(document.styleSheets)\r\n          .find((sheet: any) => sheet.rules[0] && sheet.rules[0].selectorText === \".\"+styleObject[identifierClass] )\r\n        sheet!.disabled = !mobileLayoutActive;\r\n      },\r\n      {fireImmediately: true}\r\n    );\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.disposer?.();\r\n  }\r\n\r\n  render() {\r\n    return (\r\n        <></>\r\n    );\r\n  }\r\n}\r\n\r\n\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { MainBar } from \"gui/Components/MainBar/MainBar\";\r\nimport { ScreenTabsArea } from \"gui/Components/ScreenTabsArea/ScreenTabsArea\";\r\nimport { WorkbenchPage } from \"gui/Components/WorkbenchPage/WorkbenchPage\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { IWorkbench } from \"model/entities/types/IWorkbench\";\r\nimport { getWorkbench } from \"model/selectors/getWorkbench\";\r\nimport React, { useContext } from \"react\";\r\nimport { CScreenTabbedViewHandleRow } from \"gui/connections/CScreenTabbedViewHandleRow\";\r\nimport { CScreenToolbar } from \"gui/connections/CScreenToolbar\";\r\nimport { CSidebar } from \"gui/connections/CSidebar\";\r\nimport { CScreenHeader } from \"gui/connections/CScreenHeader\";\r\nimport { CScreenContent } from \"gui/connections/CScreenContent\";\r\nimport { CDialogContent } from \"gui/connections/CDialogContent\";\r\nimport { getIsCurrentScreenFull } from \"model/selectors/Workbench/getIsCurrentScreenFull\";\r\nimport { Fullscreen } from \"gui/Components/Fullscreen/Fullscreen\";\r\nimport { onRootElementClick } from \"model/actions/Global/onRootElementClick\";\r\nimport { action } from \"mobx\";\r\nimport { Breakpoint, useCurrentBreakpointName } from \"react-socks\";\r\nimport S from \"gui/Components/WorkbenchPage/WorkbenchPage.module.scss\";\r\nimport { MobileMain } from \"gui/connections/MobileComponents/MobileMain\";\r\nimport { MobileStyleSheetLoader } from \"gui/connections/MobileComponents/MobileStyleSheetLoader\";\r\n\r\n@observer\r\nexport class CWorkbenchPage extends React.Component {\r\n  static contextType = MobXProviderContext;\r\n\r\n  get workbench(): IWorkbench {\r\n    return getWorkbench(this.context.application);\r\n  }\r\n\r\n  @action.bound\r\n  handleRootElementClick(event: any) {\r\n    return onRootElementClick(this.workbench)(event);\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.document.addEventListener(\"click\", this.handleRootElementClick, true);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.document.removeEventListener(\"click\", this.handleRootElementClick, true);\r\n  }\r\n\r\n  render() {\r\n    const isFullscreen = getIsCurrentScreenFull(this.workbench);\r\n    return (\r\n        <>\r\n          <Breakpoint small down className={S.mobileContainer}>\r\n            <MobileMain/>\r\n          </Breakpoint>\r\n          <Breakpoint medium up className={S.root}>\r\n            <WorkbenchPage\r\n              sidebar={<CSidebar/>}\r\n              mainbar={\r\n                <MainBar>\r\n                  <CScreenToolbar/>\r\n                  <ScreenTabsArea>\r\n                    <CScreenTabbedViewHandleRow/>\r\n                    <Fullscreen isFullscreen={isFullscreen}>\r\n                      <CScreenHeader/>\r\n                      <CScreenContent/>\r\n                    </Fullscreen>\r\n                    <CDialogContent/>\r\n                  </ScreenTabsArea>\r\n                </MainBar>\r\n              }\r\n            />\r\n          </Breakpoint>\r\n          <BreakpointProvider/>\r\n          <MobileStyleSheetLoader/>\r\n        </>\r\n    );\r\n  }\r\n}\r\n\r\nconst BreakpointProvider: React.FC<{}> = (props) => {\r\n  const breakpoint = useCurrentBreakpointName();\r\n  const application = useContext(MobXProviderContext).application\r\n  application.breakpoint = breakpoint;\r\n\r\n  return (\r\n    <>\r\n    </>\r\n  );\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React, { useContext } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport S from \"./DialogStack.module.scss\";\r\nimport { MobXProviderContext, observer } from \"mobx-react\";\r\nimport { getDialogStack } from \"../../../model/selectors/DialogStack/getDialogStack\";\r\nimport { IDialogInfo } from \"model/entities/types/IDialogInfo\";\r\n\r\nexport const ApplicationDialogStack: React.FC = observer(() => {\r\n  const dialogStack = getDialogStack(\r\n    useContext(MobXProviderContext).application\r\n  );\r\n  return <DialogStack stackedDialogs={dialogStack.stackedDialogs} close={dialogStack.closeDialog}/>;\r\n});\r\n\r\n@observer\r\nexport class DialogStack extends React.Component<{\r\n  stackedDialogs: Array<IDialogInfo>;\r\n  close: (componentKey: string) => void;\r\n}> {\r\n\r\n  onOverlayClick(dialogInfo: IDialogInfo) {\r\n    if (dialogInfo.closeOnClickOutside) {\r\n      this.props.close(dialogInfo.key);\r\n    }\r\n  }\r\n\r\n  getStackedDialogs() {\r\n    const result = [];\r\n    for (let i = 0; i < this.props.stackedDialogs.length; i++) {\r\n      if (i < this.props.stackedDialogs.length - 1) {\r\n        result.push(\r\n          React.cloneElement(this.props.stackedDialogs[i].component, {\r\n            key: this.props.stackedDialogs[i].key\r\n          })\r\n        );\r\n      } else {\r\n        result.push(\r\n          <div className={S.modalWindowOverlay} key={i}\r\n               onClick={(event: any) => this.onOverlayClick(this.props.stackedDialogs[i])}/>,\r\n          React.cloneElement(this.props.stackedDialogs[i].component, {\r\n            key: this.props.stackedDialogs[i].key\r\n          })\r\n        );\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  render() {\r\n    return ReactDOM.createPortal(\r\n      <>{this.getStackedDialogs()}</>,\r\n      document.getElementById(\"modal-window-portal\")!\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { MobXProviderContext, observer, Provider } from \"mobx-react\";\r\nimport { IApplication } from \"model/entities/types/IApplication\";\r\nimport React from \"react\";\r\nimport { CWorkbenchPage } from \"gui/connections/pages/CWorkbenchPage\";\r\nimport { ApplicationDialogStack } from \"gui/Components/Dialog/DialogStack\";\r\nimport { IWorkbench } from \"model/entities/types/IWorkbench\";\r\nimport { BreakpointProvider } from \"react-socks\";\r\n\r\n@observer\r\nexport class CMain extends React.Component {\r\n  static contextType = MobXProviderContext;\r\n\r\n  get application(): IApplication {\r\n    return this.context.application;\r\n  }\r\n\r\n  get workbench(): IWorkbench {\r\n    return this.application.workbench!;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className={\"toplevelContainer\"}>\r\n        <Provider workbench={this.workbench}>\r\n          <ApplicationDialogStack/>\r\n          <BreakpointProvider>\r\n            <CWorkbenchPage/>\r\n          </BreakpointProvider>\r\n        </Provider>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from 'react';\r\nimport { Provider } from 'mobx-react';\r\nimport { CMain } from 'gui/connections/CMain';\r\nimport { IApplication } from 'model/entities/types/IApplication';\r\n\r\n\r\nexport const Root: React.FC<{ application: IApplication }> = (props) => (\r\n  <Provider application={props.application}>\r\n    <CMain />\r\n  </Provider>\r\n);","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport bind from \"bind-decorator\";\r\nimport _ from \"lodash\";\r\nimport { action, computed, observable } from \"mobx\";\r\nimport { observer, Observer } from \"mobx-react\";\r\nimport { showDialog } from \"model/selectors/getDialogStack\";\r\nimport React from \"react\";\r\nimport CS from \"./ErrorDialog.module.scss\";\r\nimport moment, { Moment } from \"moment\";\r\nimport { T } from \"utils/translation\";\r\nimport { IErrorDialogController } from \"./types/IErrorDialog\";\r\nimport { Icon } from \"@origam/components\";\r\nimport { ModalDialog } from \"gui/Components/Dialog/ModalDialog\";\r\n\r\nfunction NewExternalPromise<T>() {\r\n  let resolveFn: any;\r\n  let rejectFn: any;\r\n  const p = new Promise((resolve, reject) => {\r\n    resolveFn = resolve;\r\n    rejectFn = reject;\r\n  });\r\n  (p as any).resolve = resolveFn;\r\n  (p as any).reject = rejectFn;\r\n  return p as Promise<T> & {\r\n    resolve(value: T): void;\r\n    reject(error: any): void;\r\n  };\r\n}\r\n\r\nexport class ErrorDialogController implements IErrorDialogController {\r\n  @observable errorStack: Array<{\r\n    id: number;\r\n    error: any;\r\n    promise: any;\r\n    timestamp: Moment;\r\n  }> = [];\r\n\r\n  @observable isDialogDisplayed = false;\r\n\r\n  @computed get errorMessages() {\r\n    return this.errorStack.map((errItem) => {\r\n      console.error(errItem.error); // eslint-disable-line no-console\r\n\r\n      const handlePlainText = () =>\r\n        _.get(errItem.error, \"response.headers.content-type\", \"\").startsWith(\"text/plain\") &&\r\n        errItem.error.response.data;\r\n\r\n      const handleMessageField = () => {\r\n        if (!errItem.error.response?.data) {\r\n          return \"\";\r\n        }\r\n        let exception = errItem.error.response.data;\r\n        let message = \"\";\r\n        do {\r\n          const exMessage = _.get(exception, \"message\") || _.get(exception, \"Message\");\r\n            if (errItem.error?.request?.status === 420) {\r\n              return exMessage;\r\n            }\r\n          if (exMessage) {\r\n            message += exMessage;\r\n            message += \"\\n\";\r\n          }\r\n          exception = exception.innerException || exception.InnerException;\r\n        } while (exception);\r\n        return message;\r\n      };\r\n\r\n      const handleRuntimeException = () => \"\" + errItem.error;\r\n\r\n      const handleLoginValidation = () =>\r\n        [\r\n          ..._.get(errItem.error, \"response.data.UserName\", []),\r\n          ..._.get(errItem.error, \"response.data.Password\", []),\r\n        ].join(\" \");\r\n\r\n      let errorMessage =\r\n        handlePlainText() ||\r\n        handleMessageField() ||\r\n        handleLoginValidation() ||\r\n        handleRuntimeException();\r\n\r\n      if (errItem.error?.request?.status === 500 || errItem.error?.request?.status === 409) {\r\n        errorMessage =\r\n          \"Server error occurred. Please check server log for more details:\\n\" + errorMessage;\r\n      }\r\n\r\n      return {\r\n        message: errorMessage,\r\n        id: errItem.id,\r\n        timestamp: errItem.timestamp.format(\"YYYY-MM-DD HH:mm:ss\"),\r\n      };\r\n    });\r\n  }\r\n\r\n  idGen = 0;\r\n\r\n  @bind\r\n  *pushError(error: any) {\r\n    const myId = this.idGen++;\r\n    const promise = NewExternalPromise();\r\n    this.errorStack.push({id: myId, error, promise, timestamp: moment()});\r\n    this.displayDialog();\r\n    yield promise;\r\n  }\r\n\r\n  @action.bound displayDialog() {\r\n    if (!this.isDialogDisplayed) {\r\n      this.isDialogDisplayed = true;\r\n      const previouslyFocusedElement = document.activeElement as HTMLElement;\r\n      const closeDialog = showDialog(this,\r\n        \"\",\r\n        <Observer>\r\n          {() => (\r\n            <ErrorDialogComponent\r\n              errorMessages={this.errorMessages}\r\n              onOkClick={action(() => {\r\n                closeDialog();\r\n                this.isDialogDisplayed = false;\r\n                this.dismissErrors();\r\n                setTimeout(() => previouslyFocusedElement?.focus(), 100);\r\n              })}\r\n            />\r\n          )}\r\n        </Observer>\r\n      );\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  dismissError(id: number) {\r\n    const errItemIndex = this.errorStack.findIndex((item) => item.id === id);\r\n    if (errItemIndex > -1) {\r\n      const errItem = this.errorStack[errItemIndex];\r\n      errItem.promise.resolve(null);\r\n      this.errorStack.splice(errItemIndex, 1);\r\n    }\r\n  }\r\n\r\n  @action.bound dismissErrors() {\r\n    for (let errItem of [...this.errorStack]) {\r\n      this.dismissError(errItem.id);\r\n    }\r\n  }\r\n}\r\n\r\n@observer\r\nexport class ErrorDialogComponent extends React.Component<{\r\n  errorMessages: Array<{ id: number; message: string; timestamp: string }>;\r\n  onOkClick?: (event: any) => void;\r\n}> {\r\n  render() {\r\n    return (\r\n      <ModalDialog\r\n        title={T(\"Error\", \"error_window_title\")}\r\n        titleButtons={null}\r\n        buttonsCenter={\r\n          <>\r\n            <button tabIndex={0} autoFocus={true} onClick={this.props.onOkClick}>\r\n              {T(\"Ok\", \"button_ok\")}\r\n            </button>\r\n          </>\r\n        }\r\n        buttonsLeft={null}\r\n        buttonsRight={null}\r\n      >\r\n        <div className={CS.dialogContent}>\r\n          <div className={CS.dialogBigIconColumn}>\r\n            {/* SVG as data url here because we might not be able to determine customAssets path. \r\n            This has fill color embedded :-( */}\r\n            <Icon\r\n              src={`data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkViZW5lXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeD0iMHB4IiB5PSIwcHgiCiAgICAgdmlld0JveD0iMCAwIDIwIDIwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAyMCAyMDsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8dGl0bGU+WmVpY2hlbmZsw6RjaGUgMTwvdGl0bGU+CjxnPgoJPHBhdGggZmlsbD0iI2ZmNDM1NCIgZD0iTTkuMywwLjlsLTkuMiwxN2MtMC4zLDAuNSwwLjEsMS4yLDAuNywxLjJoMTguNGMwLjYsMCwxLTAuNywwLjctMS4ybC05LjItMTdDMTAuNCwwLjQsOS42LDAuNCw5LjMsMC45eiBNMTAsMTUuOUwxMCwxNS45CgkJYy0wLjQsMC0wLjgtMC40LTAuOC0wLjh2MGMwLTAuNCwwLjQtMC44LDAuOC0wLjhoMGMwLjQsMCwwLjgsMC40LDAuOCwwLjh2MEMxMC44LDE1LjUsMTAuNCwxNS45LDEwLDE1Ljl6IE05LjIsMTEuOFY2LjkKCQljMC0wLjQsMC40LTAuOCwwLjgtMC44aDBjMC40LDAsMC44LDAuNCwwLjgsMC44djQuOWMwLDAuNC0wLjQsMC44LTAuOCwwLjhoMEM5LjYsMTIuNiw5LjIsMTIuMiw5LjIsMTEuOHoiLz4KPC9nPgo8L3N2Zz4K`}\r\n            />\r\n          </div>\r\n          <div className={CS.dialogMessageColumn}>\r\n            {this.props.errorMessages.length === 1 ? (\r\n              this.props.errorMessages[0].message\r\n            ) : (\r\n              <div className={CS.errorMessageList}>\r\n                {this.props.errorMessages.map((errMessage) => (\r\n                  <div key={errMessage.id} className={CS.errorMessageListItem}>\r\n                    <span className={CS.errorMessageDatetime}>{errMessage.timestamp}</span>\r\n                    {errMessage.message}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </ModalDialog>\r\n    );\r\n  }\r\n}\r\n","import { IWorkbench } from \"model/entities/types/IWorkbench\";\r\nimport { action, computed, observable } from \"mobx\";\r\nimport { IFormScreen } from \"model/entities/types/IFormScreen\";\r\nimport { IBreadCrumbNode, RootBreadCrumbNode } from \"gui/connections/MobileComponents/Navigation/BreadCrumbs\";\r\nimport { IDataView } from \"model/entities/types/IDataView\";\r\nimport { T } from \"utils/translation\";\r\nimport { getActiveScreen } from \"model/selectors/getActiveScreen\";\r\n\r\nexport class BreadCrumbsState {\r\n\r\n  workbench: IWorkbench | undefined;\r\n\r\n  @computed\r\n  get activeFormScreen() {\r\n    return getActiveScreen(this.workbench)?.content?.formScreen;\r\n  }\r\n\r\n  @observable\r\n  openScreenBreadCrumbs = new Map<IFormScreen, IBreadCrumbNode[]>();\r\n\r\n  @action\r\n  setActiveBreadCrumbList(nodes: IBreadCrumbNode[]) {\r\n    if (this.openScreenBreadCrumbs.has(this.activeFormScreen!)){\r\n      const openNodes = this.openScreenBreadCrumbs.get(this.activeFormScreen!)!;\r\n      openNodes.length = 0;\r\n      nodes.forEach(node => openNodes.push(node));\r\n    } else {\r\n      this.openScreenBreadCrumbs.set(this.activeFormScreen!, nodes);\r\n    }\r\n  }\r\n\r\n  get activeBreadCrumbList() {\r\n    if (!this.activeFormScreen) {\r\n      return undefined;\r\n    }\r\n    if (!this.openScreenBreadCrumbs.has(this.activeFormScreen)) {\r\n      this.updateBreadCrumbs();\r\n    }\r\n    return this.openScreenBreadCrumbs.get(this.activeFormScreen)\r\n  }\r\n\r\n  @action\r\n  updateBreadCrumbs() {\r\n    if (!this.activeFormScreen || this.openScreenBreadCrumbs.has(this.activeFormScreen)) {\r\n      return;\r\n    }\r\n    this.resetBreadCrumbs(this.activeFormScreen);\r\n  }\r\n\r\n  private resetBreadCrumbs(activeFormScreen: IFormScreen) {\r\n    const breadCrumbCaption = () => this.workbench\r\n      ? getActiveScreen(this.workbench)?.tabTitle ?? \"\"\r\n      : \"\";\r\n    this.openScreenBreadCrumbs.set(activeFormScreen, [new RootBreadCrumbNode(breadCrumbCaption)]);\r\n\r\n    if ((activeFormScreen?.rootDataViews?.length ?? 0) > 0 && activeFormScreen?.uiRootType !== \"Tab\") {\r\n      const dataView = activeFormScreen?.rootDataViews[0]!;\r\n      this.addDetailBreadCrumbNodeToRoot(dataView);\r\n    }\r\n  }\r\n\r\n  @action\r\n  addDetailBreadCrumbNodeToRoot(dataView: IDataView) {\r\n    if (this.activeBreadCrumbList?.length === 1) {\r\n      this.activeBreadCrumbList[0].onClick = () => dataView.activateTableView?.();\r\n      this.addDetailBreadCrumbNode(dataView);\r\n    }\r\n  }\r\n\r\n  @action\r\n  addDetailBreadCrumbNode(dataView: IDataView) {\r\n    this.activeBreadCrumbList?.push({\r\n      caption: T(\"Detail\", \"mobile_detail_navigation\"),\r\n      id: \"Detail\",\r\n      isVisible: () => dataView?.isFormViewActive()!,\r\n      onClick: () => {\r\n      }\r\n    });\r\n  }\r\n\r\n  onFormClose(formScreen: IFormScreen) {\r\n    this.openScreenBreadCrumbs.delete(formScreen);\r\n  }\r\n}","import { observable, reaction } from \"mobx\";\r\nimport { IWorkbench } from \"model/entities/types/IWorkbench\";\r\nimport { getWorkbenchLifecycle } from \"model/selectors/getWorkbenchLifecycle\";\r\nimport { IFormScreen } from \"model/entities/types/IFormScreen\";\r\nimport { BreadCrumbsState } from \"model/entities/MobileState/BreadCrumbsState\";\r\nimport { IMobileLayoutState, MenuLayoutState, ScreenLayoutState } from \"model/entities/MobileState/MobileLayoutState\";\r\nimport { getActiveScreen } from \"model/selectors/getActiveScreen\";\r\n\r\nexport class MobileState {\r\n  _workbench: IWorkbench | undefined;\r\n\r\n  @observable\r\n  layoutState: IMobileLayoutState = new ScreenLayoutState()\r\n\r\n  @observable\r\n  activeDataViewId: string | undefined;\r\n\r\n  breadCrumbsState = new BreadCrumbsState()\r\n\r\n  initialize(workbench: IWorkbench) {\r\n    let workbenchLifecycle = getWorkbenchLifecycle(workbench);\r\n    workbenchLifecycle.mainMenuItemClickHandler.add(\r\n      () => this.layoutState = new ScreenLayoutState()\r\n    );\r\n    this._workbench = workbench;\r\n    this.breadCrumbsState.workbench = workbench;\r\n    this.breadCrumbsState.updateBreadCrumbs();\r\n    this.start();\r\n  }\r\n\r\n  lastArgs: any;\r\n\r\n  // It is ok for these reactions to run indefinitely because the MobileState is never disposed. Hence, no disposers here.\r\n  start() {\r\n    reaction(\r\n      () => {\r\n        return {\r\n          activeScreen: !!getActiveScreen(this._workbench),\r\n          layoutState: this.layoutState\r\n        };\r\n      },\r\n      (args) => {\r\n        if (!args.activeScreen && args.layoutState instanceof ScreenLayoutState) {\r\n          this.layoutState = new MenuLayoutState();\r\n        }\r\n        else if (\r\n          this.lastArgs && !this.lastArgs.activeScreen && args.activeScreen &&\r\n          args.layoutState instanceof MenuLayoutState\r\n        ) {\r\n          this.layoutState = new ScreenLayoutState();\r\n        }\r\n        this.lastArgs = args;\r\n      },\r\n    );\r\n  }\r\n\r\n  async close() {\r\n    this.layoutState = await this.layoutState.close(this._workbench);\r\n  }\r\n\r\n  hamburgerClick() {\r\n    this.layoutState = this.layoutState.hamburgerClick();\r\n  }\r\n\r\n  onFormClose(formScreen: IFormScreen | undefined) {\r\n    if(!formScreen){\r\n      return;\r\n    }\r\n    this.breadCrumbsState.onFormClose(formScreen);\r\n  }\r\n}\r\n\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { IApi } from \"./types/IApi\";\r\nimport { IApplication, IApplicationData } from \"./types/IApplication\";\r\nimport { IApplicationLifecycle } from \"./types/IApplicationLifecycle\";\r\nimport { IDialogStack } from \"./types/IDialogStack\";\r\nimport { IErrorDialogController } from \"./types/IErrorDialog\";\r\nimport { IWorkbench } from \"./types/IWorkbench\";\r\nimport { MobileState } from \"model/entities/MobileState/MobileState\";\r\nimport { observable } from \"mobx\";\r\n\r\nexport class Application implements IApplication {\r\n\r\n  $type_IApplication: 1 = 1;\r\n\r\n  constructor(data: IApplicationData) {\r\n    Object.assign(this, data);\r\n    this.applicationLifecycle.parent = this;\r\n    this.dialogStack.parent = this;\r\n    this.errorDialogController.parent = this;\r\n  }\r\n\r\n  errorDialogController: IErrorDialogController = null as any;\r\n  applicationLifecycle: IApplicationLifecycle = null as any;\r\n  api: IApi = null as any;\r\n  dialogStack: IDialogStack = null as any;\r\n\r\n  workbench?: IWorkbench;\r\n  mobileState = new MobileState();\r\n\r\n  resetWorkbench(): void {\r\n    this.workbench = undefined;\r\n  }\r\n\r\n  setWorkbench(workbench: IWorkbench): void {\r\n    this.workbench = workbench;\r\n    workbench.parent = this;\r\n    this.mobileState.initialize(workbench);\r\n  }\r\n\r\n  *run() {\r\n    try {\r\n      yield*this.applicationLifecycle.run();\r\n    } catch (e) {\r\n      yield*handleError(this)(e);\r\n      throw e;\r\n    }\r\n  }\r\n\r\n  parent?: any;\r\n\r\n  @observable\r\n  breakpoint = \"\";\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IWorkbench, IWorkbenchData } from \"./types/IWorkbench\";\r\nimport { IMainMenuEnvelope } from \"./types/IMainMenu\";\r\nimport { IWorkbenchLifecycle } from \"./types/IWorkbenchLifecycle\";\r\nimport { action, computed, observable } from \"mobx\";\r\nimport { ISearcher } from \"./types/ISearcher\";\r\nimport { IOpenedScreens } from \"./types/IOpenedScreens\";\r\nimport { IWorkQueues } from \"./types/IWorkQueues\";\r\nimport { IRecordInfo } from \"./types/IRecordInfo\";\r\nimport { LookupListCacheMulti } from \"../../modules/Lookup/LookupListCacheMulti\";\r\nimport { IMultiLookupEngine } from \"modules/Lookup/LookupModule\";\r\nimport { Chatrooms } from \"./Chatrooms\";\r\nimport { Notifications } from \"./Notifications\";\r\nimport { Favorites } from \"model/entities/Favorites\";\r\nimport { SidebarState } from \"./SidebarState\";\r\nimport { About } from \"model/entities/AboutInfo\";\r\n\r\nexport class Workbench implements IWorkbench {\r\n  $type_IWorkbench: 1 = 1;\r\n\r\n  constructor(data: IWorkbenchData) {\r\n    Object.assign(this, data);\r\n    this.workbenchLifecycle.parent = this;\r\n    this.searcher.parent = this;\r\n    this.openedScreens.parent = this;\r\n    this.openedDialogScreens.parent = this;\r\n    this.workQueues.parent = this;\r\n    this.chatrooms.parent = this;\r\n    this.notifications.parent = this;\r\n    this.recordInfo.parent = this;\r\n    this.favorites.parent = this;\r\n    this.sidebarState.parent = this;\r\n    this.about.parent = this;\r\n  }\r\n\r\n  workbenchLifecycle: IWorkbenchLifecycle = null as any;\r\n  searcher: ISearcher = null as any;\r\n  mainMenuEnvelope: IMainMenuEnvelope = null as any;\r\n  openedScreens: IOpenedScreens = null as any;\r\n  openedDialogScreens: IOpenedScreens = null as any;\r\n  workQueues: IWorkQueues = null as any;\r\n  chatrooms!: Chatrooms;\r\n  notifications: Notifications = null as any;\r\n  recordInfo: IRecordInfo = null as any;\r\n  lookupListCache: LookupListCacheMulti = null as any;\r\n  lookupMultiEngine: IMultiLookupEngine = null as any;\r\n  favorites: Favorites = null as any;\r\n  sidebarState: SidebarState = null as any;\r\n  about: About = null as any;\r\n\r\n  @observable isFullScreen: boolean = false;\r\n\r\n  @action.bound setFullscreen(state: boolean) {\r\n    this.isFullScreen = state;\r\n  }\r\n\r\n  @computed get openedScreenIdSet() {\r\n    return new Set(this.openedScreens.items.map((item) => item.menuItemId));\r\n  }\r\n\r\n  *run(): Generator {\r\n    yield*this.workbenchLifecycle.run();\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { getWorkbenchLifecycle } from \"model/selectors/getWorkbenchLifecycle\";\r\n\r\n\r\nexport function openScreenByReferenceAndLookup(ctx: any) {\r\n  return function*openScreenByReferenceAndLookup(dataSourceLookupId: string, referenceId: string): Generator {\r\n    const api = getApi(ctx);\r\n    const menuId = yield api.getMenuId({\r\n      LookupId: dataSourceLookupId,\r\n      ReferenceId: referenceId,\r\n    });\r\n    yield*getWorkbenchLifecycle(ctx).onMainMenuItemIdClick({\r\n      event: undefined,\r\n      itemId: menuId,\r\n      idParameter: referenceId,\r\n      isSingleRecordEdit: true\r\n    });\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { T } from \"utils/translation\";\r\n\r\nexport function getAllParents(node: any) {\r\n  const parents: any[] = [];\r\n  let cn = node;\r\n  while (cn !== undefined) {\r\n    parents.push(cn);\r\n    cn = cn.parent;\r\n  }\r\n  parents.reverse();\r\n  return parents.slice(2); // Strip out root and Menu node\r\n}\r\n\r\nexport function getPath(node: any) {\r\n  const nodeLabels = getAllParents(node).map(node => node.attributes.label);\r\n  nodeLabels.unshift(T(\"Menu\", \"menu\"));\r\n  return nodeLabels.join(\"/\")\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getMainMenu } from \"./getMainMenu\";\r\nimport { IMainMenuContent } from \"../../entities/types/IMainMenu\";\r\nimport { getMainMenuState } from \"./getMainMenuState\";\r\nimport { runInAction } from \"mobx\";\r\nimport { getAllParents } from \"model/selectors/MainMenu/menuNode\";\r\n\r\nexport function getMainMenuUI(ctx: any) {\r\n  return (getMainMenu(ctx) as IMainMenuContent)!.menuUI;\r\n}\r\n\r\nexport function openSingleMenuFolder(folderNode: any, ctx: any) {\r\n  if (folderNode.name !== \"Submenu\") {\r\n    return;\r\n  }\r\n  const mainMenuState = getMainMenuState(ctx);\r\n\r\n  runInAction(() => {\r\n    mainMenuState.closeAll();\r\n    const nodesToOpen = getAllParents(folderNode);\r\n    for (const node of nodesToOpen) {\r\n      mainMenuState.setIsOpen(node.attributes.id, true);\r\n    }\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action, computed, observable } from \"mobx\";\r\nimport _ from \"lodash\";\r\nimport { IResultIndices, ISearcher } from \"./types/ISearcher\";\r\nimport { ISearchResult, IServerSearchResult } from \"./types/ISearchResult\";\r\nimport { onMainMenuItemClick } from \"model/actions-ui/MainMenu/onMainMenuItemClick\";\r\nimport { ISearchResultGroup } from \"./types/ISearchResultGroup\";\r\nimport { runInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { onSearchResultClick } from \"model/actions/Workbench/onSearchResultClick\";\r\nimport { T } from \"utils/translation\";\r\nimport { openSingleMenuFolder } from \"model/selectors/MainMenu/getMainMenuUI\";\r\nimport { getWorkbench } from \"model/selectors/getWorkbench\";\r\nimport { getMainMenuState } from \"model/selectors/MainMenu/getMainMenuState\";\r\nimport { getPath } from \"model/selectors/MainMenu/menuNode\";\r\nimport { onWorkQueuesListItemClick } from \"model/actions-ui/WorkQueues/onWorkQueuesListItemClick\";\r\nimport { onChatroomsListItemClick } from \"model/actions/Chatrooms/onChatroomsListItemClick\";\r\nimport { getCustomAssetsRoute } from \"model/selectors/User/getCustomAssetsRoute\";\r\nimport { getIconUrl } from \"gui/getIconUrl\";\r\nimport { IMenuItemIcon } from \"gui/Workbench/MainMenu/IMenuItemIcon\";\r\nimport { prepareForFilter } from \"model/selectors/PortalSettings/getStringFilterConfig\";\r\n\r\n\r\nexport class Searcher implements ISearcher {\r\n  parent?: any;\r\n  nodeIndex: NodeContainer[] = [];\r\n  workQueueIndex: NodeContainer[] = [];\r\n  chatsIndex: NodeContainer[] = [];\r\n\r\n  searchTerm = \"\";\r\n\r\n  @observable\r\n  selectedResult: ISearchResult | undefined;\r\n\r\n  @observable\r\n  serverResultGroups: ISearchResultGroup[] = [];\r\n\r\n  @observable\r\n  menuResultGroup: ISearchResultGroup | undefined = undefined;\r\n\r\n  @observable\r\n  workQueueResultGroup: ISearchResultGroup | undefined = undefined;\r\n\r\n  @observable\r\n  chatResultGroup: ISearchResultGroup | undefined = undefined;\r\n\r\n  @computed\r\n  get resultGroups() {\r\n    const groups = this.serverResultGroups.length > 0\r\n      ? [...this.serverResultGroups]\r\n      : [];\r\n    if (this.workQueueResultGroup && this.workQueueResultGroup.results.length > 0) {\r\n      groups.unshift(this.workQueueResultGroup);\r\n    }\r\n    if (this.menuResultGroup && this.menuResultGroup.results.length > 0) {\r\n      groups.unshift(this.menuResultGroup);\r\n    }\r\n    if (this.chatResultGroup && this.chatResultGroup.results.length > 0) {\r\n      groups.unshift(this.chatResultGroup);\r\n    }\r\n    return groups;\r\n  }\r\n\r\n  selectFirst() {\r\n    if (this.resultGroups.length === 0 ||\r\n      this.resultGroups[0].results.length === 0) {\r\n      return\r\n    }\r\n    this.selectedResult = this.resultGroups[0].results[0];\r\n  }\r\n\r\n  selectNextResult() {\r\n    if (!this.selectedResult) {\r\n      this.selectFirst();\r\n      return;\r\n    }\r\n    const resultIndices = this.getSelectedResultIndices();\r\n    if (resultIndices.groupIndex === -1) {\r\n      this.selectFirst();\r\n      return;\r\n    }\r\n    const currentGroup = this.resultGroups[resultIndices.groupIndex];\r\n    if (resultIndices.indexInGroup < currentGroup.results.length - 1) {\r\n      this.selectedResult = currentGroup.results[resultIndices.indexInGroup + 1];\r\n    } else {\r\n      const currentGroupIndex = this.resultGroups.indexOf(currentGroup);\r\n      if (currentGroupIndex < this.resultGroups.length - 1) {\r\n        const newGroup = this.resultGroups[currentGroupIndex + 1];\r\n        newGroup.isExpanded = true;\r\n        this.selectedResult = newGroup.results[0];\r\n      }\r\n    }\r\n  }\r\n\r\n  selectPreviousResult(): void {\r\n    if (!this.selectedResult) {\r\n      this.selectFirst();\r\n      return;\r\n    }\r\n    const resultIndices = this.getSelectedResultIndices();\r\n    if (resultIndices.groupIndex === -1) {\r\n      this.selectFirst();\r\n      return;\r\n    }\r\n    const currentGroup = this.resultGroups[resultIndices.groupIndex];\r\n    if (resultIndices.indexInGroup > 0) {\r\n      this.selectedResult = currentGroup.results[resultIndices.indexInGroup - 1];\r\n    } else {\r\n      const currentGroupIndex = this.resultGroups.indexOf(currentGroup);\r\n      if (currentGroupIndex > 0) {\r\n        const newGroup = this.resultGroups[currentGroupIndex - 1];\r\n        newGroup.isExpanded = true;\r\n        this.selectedResult = newGroup.results[newGroup.results.length - 1];\r\n      }\r\n    }\r\n  }\r\n\r\n  getSelectedResultIndices(): IResultIndices {\r\n    const currentGroupIndex = this.resultGroups\r\n      .findIndex(group => group.results.some(result => result.id === this.selectedResult!.id))!;\r\n    if (currentGroupIndex === -1) {\r\n      return {\r\n        groupIndex: -1,\r\n        indexInGroup: -1\r\n      }\r\n    }\r\n    const currentResultIndex = this.resultGroups[currentGroupIndex].results\r\n      .findIndex(result => result.id === this.selectedResult!.id);\r\n    return {\r\n      groupIndex: currentGroupIndex,\r\n      indexInGroup: currentResultIndex\r\n    }\r\n  }\r\n\r\n  searchOnServer() {\r\n    if (!this.searchTerm.trim()) {\r\n      this.serverResultGroups = [];\r\n      this.menuResultGroup = undefined;\r\n      this.workQueueResultGroup = undefined;\r\n      this.chatResultGroup = undefined;\r\n      return;\r\n    }\r\n    runInFlowWithHandler({\r\n      ctx: this,\r\n      action: async () => {\r\n        const api = getApi(this);\r\n        const searchResults = await api.search(this.searchTerm);\r\n        for (const searchResult of searchResults) {\r\n          searchResult.iconUrl = this.getIconUrl(IMenuItemIcon.Form);\r\n          searchResult.id = searchResult.referenceId;\r\n          searchResult.onClick = () => this.onItemServerClick(searchResult);\r\n        }\r\n        const groupMap = searchResults.groupBy((item: IServerSearchResult) => item.group);\r\n        this.serverResultGroups = Array.from(groupMap.keys())\r\n          .sort()\r\n          .map(name => new SearchResultGroup(name, groupMap.get(name)!));\r\n      }\r\n    });\r\n  }\r\n\r\n  onItemServerClick(searchResult: IServerSearchResult) {\r\n    onSearchResultClick(this)(searchResult.dataSourceLookupId, searchResult.referenceId)\r\n    const sidebarState = getWorkbench(this).sidebarState;\r\n    sidebarState.onSearchResultsChange(this.resultGroups);\r\n  }\r\n\r\n  @action.bound onSearchFieldChange(searchTerm: string) {\r\n    this.searchTerm = searchTerm;\r\n    if (searchTerm.trim() === \"\") {\r\n      this.menuResultGroup = undefined;\r\n      return;\r\n    }\r\n    this.doSearchTerm(searchTerm);\r\n  }\r\n\r\n  doSearchTerm = _.throttle(this.doSearchTermImm, 100);\r\n\r\n  @action.bound doSearchTermImm(term: string) {\r\n    const searchTerm = prepareForFilter(this, term.trim())!;\r\n    this.searchInMenu(searchTerm);\r\n    this.searchInWorkQueues(searchTerm);\r\n    this.searchInChat(searchTerm);\r\n  }\r\n\r\n  getIconUrl(icon: string | IMenuItemIcon) {\r\n    const customAssetsRoute = getCustomAssetsRoute(this);\r\n    return getIconUrl(icon, customAssetsRoute + \"/\" + icon)\r\n  }\r\n\r\n  private searchInChat(term: string) {\r\n    const chatSearchResults = this.chatsIndex\r\n      .filter(container => {\r\n        return container.latinizedLowerLabel.includes(term);\r\n      })\r\n      .map((container: any) => {\r\n        const item = container.node;\r\n        return {\r\n          id: item.id,\r\n          type: \"\",\r\n          iconUrl: this.getIconUrl(IMenuItemIcon.Chat),\r\n          label: item.topic,\r\n          description: \"\",\r\n          onClick: () => this.onChatItemClicked(item)\r\n        };\r\n      }) as ISearchResult[];\r\n\r\n    this.chatResultGroup = new SearchResultGroup(T(\"Chat\", \"chat\"), chatSearchResults);\r\n  }\r\n\r\n  onChatItemClicked(item: any) {\r\n    openSingleMenuFolder(item, this);\r\n    const sidebarState = getWorkbench(this).sidebarState;\r\n    onChatroomsListItemClick(this)(null, item);\r\n    sidebarState.activeSection = \"Chat\";\r\n    getMainMenuState(this).scrollToItem(item.id);\r\n    sidebarState.onSearchResultsChange(this.resultGroups);\r\n  }\r\n\r\n  private searchInWorkQueues(latinizedTerm: string) {\r\n    const workQueueSearchResults = this.workQueueIndex\r\n      .filter(container => {\r\n        return container.latinizedLowerLabel.includes(latinizedTerm);\r\n      })\r\n      .map((container: any) => {\r\n        const item = container.node;\r\n        return {\r\n          id: item.id,\r\n          type: \"\",\r\n          iconUrl: this.getIconUrl(IMenuItemIcon.WorkQueue),\r\n          label: item.name,\r\n          description: \"\",\r\n          onClick: () => this.onWorkQueueItemClicked(item)\r\n        };\r\n      }) as ISearchResult[];\r\n\r\n    this.workQueueResultGroup = new SearchResultGroup(T(\"Work Queue\", \"queue_results\"), workQueueSearchResults);\r\n  }\r\n\r\n  onWorkQueueItemClicked(item: any) {\r\n    openSingleMenuFolder(item, this);\r\n    const sidebarState = getWorkbench(this).sidebarState;\r\n    onWorkQueuesListItemClick(this)(null, item);\r\n    sidebarState.activeSection = \"WorkQueues\";\r\n    getMainMenuState(this).scrollToItem(item.id);\r\n    sidebarState.onSearchResultsChange(this.resultGroups);\r\n  }\r\n\r\n  private searchInMenu(latinizedTerm: string) {\r\n    const searchResults = this.nodeIndex\r\n      .filter(container => {\r\n        return container.latinizedLowerLabel.includes(latinizedTerm);\r\n      })\r\n      .map((container: any) => {\r\n        const node = container.node;\r\n        switch (node.name) {\r\n          case \"Submenu\":\r\n            return {\r\n              id: node.attributes.id,\r\n              type: \"Submenu\",\r\n              iconUrl: this.getIconUrl(node.attributes.icon),\r\n              label: node.attributes.label,\r\n              description: getPath(node),\r\n              onClick: () => this.onSubMenuClicked(node)\r\n            };\r\n          case \"Command\":\r\n            return {\r\n              id: node.attributes.id,\r\n              type: \"Command\",\r\n              iconUrl: this.getIconUrl(node.attributes.icon),\r\n              label: node.attributes.label,\r\n              description: getPath(node),\r\n              onClick: () => this.onCommandClicked(node)\r\n            };\r\n        }\r\n        return undefined;\r\n      })\r\n      .filter(result => result) as ISearchResult[];\r\n    this.menuResultGroup = new SearchResultGroup(T(\"Menu\", \"menu\"), searchResults);\r\n  }\r\n\r\n  onCommandClicked(node: any) {\r\n    onMainMenuItemClick(this)({\r\n      event: null,\r\n      item: node,\r\n      idParameter: undefined,\r\n    });\r\n    const sidebarState = getWorkbench(this).sidebarState;\r\n    sidebarState.onSearchResultsChange(this.resultGroups);\r\n  }\r\n\r\n  onSubMenuClicked(node: any) {\r\n    openSingleMenuFolder(node, this);\r\n    const sidebarState = getWorkbench(this).sidebarState;\r\n    sidebarState.activeSection = \"Menu\";\r\n    getMainMenuState(this).scrollToItem(node.attributes.id);\r\n  }\r\n\r\n\r\n  @action.bound\r\n  indexWorkQueues(items: any[]) {\r\n    this.workQueueIndex = items\r\n      .map(item => new NodeContainer(prepareForFilter(this, item.name)!, item));\r\n  }\r\n\r\n  @action.bound\r\n  indexChats(items: any[]) {\r\n    this.chatsIndex = items\r\n      .map(item => new NodeContainer(prepareForFilter(this, item.topic)!, item));\r\n  }\r\n\r\n  @action.bound\r\n  indexMainMenu(mainMenu: any) {\r\n    const recursive = (node: any) => {\r\n      if (node.attributes.isHidden === \"true\") {\r\n        return;\r\n      }\r\n      switch (node.name) {\r\n        case \"Submenu\":\r\n        case \"Command\":\r\n          this.nodeIndex.push(new NodeContainer(prepareForFilter(this, node.attributes.label)!, node));\r\n      }\r\n      node.elements.forEach((element: any) => recursive(element));\r\n    };\r\n    mainMenu.elements.forEach((element: any) => {\r\n      recursive(element);\r\n    });\r\n  }\r\n\r\n  @action.bound\r\n  clear() {\r\n    this.serverResultGroups = [];\r\n    this.menuResultGroup = undefined;\r\n    this.workQueueResultGroup = undefined;\r\n    this.chatResultGroup = undefined;\r\n    this.searchTerm = \"\";\r\n  }\r\n}\r\n\r\nclass SearchResultGroup implements ISearchResultGroup {\r\n  @observable\r\n  isExpanded: boolean = true;\r\n\r\n  constructor(\r\n    public name: string,\r\n    public results: ISearchResult[],\r\n  ) {\r\n  }\r\n}\r\n\r\nclass NodeContainer {\r\n  constructor(\r\n    public latinizedLowerLabel: string,\r\n    public node: any\r\n  ) {\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { handleError } from \"../handleError\";\r\nimport { openScreenByReferenceAndLookup } from \"./openScreenByReferenceAndLookup\";\r\n\r\n\r\nexport function onSearchResultClick(ctx: any) {\r\n  return async function onSearchResultClick(dataSourceLookupId: string, referenceId: string) {\r\n    flow(function*() {\r\n      try {\r\n        yield*openScreenByReferenceAndLookup(ctx)(\r\n          dataSourceLookupId,\r\n          referenceId\r\n        );\r\n      } catch (e) {\r\n        yield*handleError(ctx)(e);\r\n        throw e;\r\n      }\r\n    })();\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IOpenedScreens } from \"./types/IOpenedScreens\";\r\nimport { IOpenedScreen } from \"./types/IOpenedScreen\";\r\nimport { action, computed, observable } from \"mobx\";\r\nimport { IAction } from \"./types/IAction\";\r\n\r\nexport class OpenedScreens implements IOpenedScreens {\r\n  $type_IOpenedScreens: 1 = 1;\r\n\r\n  parent?: any;\r\n  @observable items: Array<IOpenedScreen> = [];\r\n\r\n  isShown(openedScreen: IOpenedScreen): boolean {\r\n    return this.items.indexOf(openedScreen) > -1;\r\n  }\r\n\r\n  @action.bound\r\n  pushItem(item: IOpenedScreen): void {\r\n    item.stackPosition = this.maxStackPosition + 1;\r\n    this.items.push(item);\r\n    item.parent = this;\r\n  }\r\n\r\n  @action.bound\r\n  deleteItem(menuItemId: string, order: number): void {\r\n    const idx = this.items.findIndex(\r\n      item => item.menuItemId === menuItemId && item.order === order\r\n    );\r\n    idx > -1 && this.items.splice(idx, 1);\r\n  }\r\n\r\n  @action.bound activateItem(menuItemId: string, order: number) {\r\n    this.items.forEach(item => item.setActive(false));\r\n    const item = this.items.find(item => item.menuItemId === menuItemId && item.order === order);\r\n    if (item) {\r\n      item.setActive(true);\r\n      item.stackPosition = this.maxStackPosition + 1;\r\n    }\r\n  }\r\n\r\n  @computed get activeItem(): IOpenedScreen | undefined {\r\n    return this.items.find(item => item.isActive);\r\n  }\r\n\r\n  @computed get activeScreenActions(): Array<{\r\n    section: string;\r\n    actions: IAction[];\r\n  }> {\r\n    const activeScreen = this.activeItem;\r\n    const result =\r\n      activeScreen && !activeScreen.content.isLoading\r\n        ? activeScreen.content.formScreen!.toolbarActions\r\n        : [];\r\n    return result;\r\n  }\r\n\r\n  @computed get maxStackPosition() {\r\n    return Math.max(...this.items.map(item => item.stackPosition), 0);\r\n  }\r\n\r\n  findLastExistingTabItem(menuItemId: string): IOpenedScreen | undefined {\r\n    const items = this.items.filter(item => item.menuItemId === menuItemId && !item.isDialog);\r\n    items.sort((a, b) => a.order - b.order);\r\n    return items.slice(-1)[0];\r\n  }\r\n\r\n  findTopmostItemExcept(menuItemId: string, order: number): IOpenedScreen | undefined {\r\n    const itemsSortedByStackPosition = [...this.items].sort((a, b) => b.stackPosition - a.stackPosition);\r\n    let idx = itemsSortedByStackPosition.findIndex(item => item.menuItemId === menuItemId && item.order === order);\r\n    if (idx > -1) {\r\n      itemsSortedByStackPosition.splice(idx, 1);\r\n    }\r\n    return itemsSortedByStackPosition[0];\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { createMachine, interpret } from \"xstate\";\r\nimport { PubSub } from \"./events\";\r\n\r\nexport class PeriodicLoader {\r\n  private timeoutHandle: any;\r\n\r\n  constructor(private loadFunction: () => Generator, private getChSuccessfulApi: () => PubSub<{}>) {\r\n    this.interpreter.start();\r\n  }\r\n\r\n  interpreter = interpret(\r\n    createMachine(\r\n      {\r\n        id: \"periodicLoader\",\r\n        initial: \"INITIALIZED\",\r\n        states: {\r\n          INITIALIZED: {\r\n            on: {\r\n              START: {\r\n                target: \"PERFORMING_LOAD\",\r\n              },\r\n            },\r\n          },\r\n          PERFORMING_LOAD: {\r\n            invoke: {\r\n              src: \"svcLoadFunction\",\r\n              onDone: \"WAIT_PERIOD_REST\",\r\n              onError: \"FAILED\",\r\n            },\r\n          },\r\n          FAILED: {\r\n            invoke: {\r\n              src: \"svcSuccessfulApiSubs\",\r\n            },\r\n            on: {\r\n              SOME_API_SUCCESS: \"PERFORMING_LOAD\",\r\n            },\r\n            after: {\r\n              60000: \"PERFORMING_LOAD\",\r\n            },\r\n          },\r\n          WAIT_PERIOD_REST: {\r\n            after: {\r\n              REST_DELAY: \"PERFORMING_LOAD\",\r\n            },\r\n          },\r\n        },\r\n      },\r\n      {\r\n        actions: {},\r\n        services: {\r\n          svcLoadFunction: (ctx, event) => async () => {\r\n            this.t0 = new Date().valueOf();\r\n            await flow(this.loadFunction)();\r\n            this.t1 = new Date().valueOf();\r\n          },\r\n          svcSuccessfulApiSubs: (ctx, event) => (callback, onReceive) => {\r\n            return this.getChSuccessfulApi().subscribe(() => {\r\n              this.interpreter.send(\"SOME_API_SUCCESS\");\r\n            });\r\n          },\r\n        },\r\n        delays: {\r\n          REST_DELAY: (ctx, event) => {\r\n            return Math.max(0, this.refreshIntervalMs - (this.t1 - this.t0));\r\n          },\r\n        },\r\n      }\r\n    ),\r\n    {devTools: true}\r\n  );\r\n\r\n  t0 = 0;\r\n  t1 = 0;\r\n  refreshIntervalMs = 0;\r\n\r\n  *start(refreshIntervalMs: number) {\r\n    if (refreshIntervalMs <= 0) return;\r\n    this.refreshIntervalMs = refreshIntervalMs;\r\n    this.t0 = 0;\r\n    this.t1 = 0;\r\n    if (!this.interpreter.state?.matches?.(\"INITIALIZED\")) {\r\n      this.interpreter.stop();\r\n      this.interpreter.start();\r\n    }\r\n    this.interpreter.send(\"START\");\r\n  }\r\n\r\n  *stop() {\r\n    this.interpreter.stop();\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IWorkQueues } from \"./types/IWorkQueues\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { onRefreshWorkQueues } from \"model/actions-ui/WorkQueues/onRefreshWorkQueues\";\r\nimport { computed, observable } from \"mobx\";\r\nimport { PeriodicLoader } from \"utils/PeriodicLoader\";\r\n\r\nexport class WorkQueues implements IWorkQueues {\r\n  $type_IWorkQueues: 1 = 1;\r\n\r\n  *getWorkQueueList(): any {\r\n    const api = getApi(this);\r\n    const workQueues = yield api.getWorkQueueList();\r\n    this.items = workQueues;\r\n  }\r\n\r\n  @observable items: any[] = [];\r\n\r\n  @computed get totalItemCount() {\r\n    return this.items.map((item) => item.countTotal).reduce((a, b) => a + b, 0);\r\n  }\r\n\r\n  loader = new PeriodicLoader(onRefreshWorkQueues(this), () => getApi(this).onApiResponse);\r\n\r\n  *startTimer(refreshIntervalMs: number) {\r\n    if (localStorage.getItem(\"debugNoPolling\")) return;\r\n    yield*this.loader.start(refreshIntervalMs);\r\n  }\r\n\r\n  *stopTimer() {\r\n    yield*this.loader.stop();\r\n  }\r\n\r\n  hRefreshTimer: any;\r\n  refreshInterval = 0;\r\n\r\n  get isTimerRunning() {\r\n    return !!this.hRefreshTimer;\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { refreshWorkQueues } from \"model/actions/WorkQueues/refreshWorkQueues\";\r\nimport { handleError } from \"model/actions/handleError\";\r\n\r\nexport function onRefreshWorkQueues(ctx: any) {\r\n  return function*onRefreshWorkQueues() {\r\n    try {\r\n      yield*refreshWorkQueues(ctx)();\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      throw e;\r\n    }\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IRecordInfo } from \"./types/IRecordInfo\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { action, observable } from \"mobx\";\r\n\r\nexport class RecordInfo implements IRecordInfo {\r\n  $type_IRecordInfo: 1 = 1;\r\n\r\n  @observable.ref info: any[] = [];\r\n  @observable.ref audit: any = undefined;\r\n\r\n  @observable recordInfoExpanded = false;\r\n  @observable recordAuditExpanded = false;\r\n\r\n  displayedFor: {\r\n    menuId?: string;\r\n    dataStructureEntityId?: string;\r\n    rowId?: string;\r\n  } = {};\r\n\r\n  idgen = 0;\r\n\r\n  infoSectionExpandHandlers = new Map<number, () => void>();\r\n\r\n  addInfoSectionExpandHandler(fn: () => void) {\r\n    const myid = this.idgen++;\r\n    this.infoSectionExpandHandlers.set(myid, fn);\r\n    return () => this.infoSectionExpandHandlers.delete(myid);\r\n  }\r\n\r\n  @action.bound\r\n  triggerInfoSectionExpand() {\r\n    Array.from(this.infoSectionExpandHandlers.values()).forEach(fn => fn());\r\n  }\r\n\r\n  auditSectionExpandHandlers = new Map<number, () => void>();\r\n\r\n  addAuditSectionExpandHandler(fn: () => void) {\r\n    const myid = this.idgen++;\r\n    this.auditSectionExpandHandlers.set(myid, fn);\r\n    return () => this.auditSectionExpandHandlers.delete(myid);\r\n  }\r\n\r\n  @action.bound\r\n  triggerAuditSectionExpand() {\r\n    Array.from(this.auditSectionExpandHandlers.values()).forEach(fn => fn());\r\n  }\r\n\r\n  willLoadNewInfo(\r\n    menuId: string | undefined,\r\n    dataStructureEntityId: string | undefined,\r\n    rowId: string | undefined\r\n  ) {\r\n    return (\r\n      menuId !== this.displayedFor.menuId ||\r\n      dataStructureEntityId !== this.displayedFor.dataStructureEntityId ||\r\n      rowId !== this.displayedFor.rowId\r\n    );\r\n  }\r\n\r\n  hasValidLoadedFor() {\r\n    return (\r\n      this.displayedFor.menuId &&\r\n      this.displayedFor.dataStructureEntityId &&\r\n      this.displayedFor.rowId\r\n    );\r\n  }\r\n\r\n  *onSidebarInfoSectionCollapsed() {\r\n    this.recordInfoExpanded = false;\r\n    this.recordAuditExpanded = false;\r\n    this.info = [];\r\n    this.audit = undefined;\r\n  }\r\n\r\n  *onOpenRecordInfoClick(\r\n    event: any,\r\n    menuId: string,\r\n    dataStructureEntityId: string,\r\n    rowId: string\r\n  ) {\r\n    this.recordInfoExpanded = true;\r\n    this.recordAuditExpanded = false;\r\n    this.triggerInfoSectionExpand();\r\n    yield*this.loadRecordInfo(menuId, dataStructureEntityId, rowId);\r\n  }\r\n\r\n  *onSelectedRowMaybeChanged(\r\n    menuId: string,\r\n    dataStructureEntityId: string,\r\n    rowId: string\r\n  ) {\r\n    if (this.willLoadNewInfo(menuId, dataStructureEntityId, rowId)) {\r\n      if (this.recordInfoExpanded) {\r\n        yield*this.loadRecordInfo(menuId, dataStructureEntityId, rowId);\r\n      }\r\n    }\r\n    this.displayedFor = {\r\n      menuId,\r\n      dataStructureEntityId,\r\n      rowId\r\n    };\r\n  }\r\n\r\n  *onOpenRecordAuditClick(\r\n    event: any,\r\n    menuId: string,\r\n    dataStructureEntityId: string,\r\n    rowId: string\r\n  ) {\r\n    this.recordAuditExpanded = true;\r\n    this.recordInfoExpanded = false;\r\n    this.triggerAuditSectionExpand();\r\n  }\r\n\r\n  *onSidebarInfoSectionExpanded() {\r\n    this.recordInfoExpanded = true;\r\n    this.recordAuditExpanded = false;\r\n    if (this.hasValidLoadedFor()) {\r\n      yield*this.loadRecordInfo(\r\n        this.displayedFor.menuId!,\r\n        this.displayedFor.dataStructureEntityId!,\r\n        this.displayedFor.rowId!\r\n      );\r\n    }\r\n  }\r\n\r\n  *onSidebarAuditSectionExpanded() {\r\n    this.recordInfoExpanded = false;\r\n    this.recordAuditExpanded = true;\r\n    if (this.hasValidLoadedFor()) {\r\n    }\r\n  }\r\n\r\n  *loadRecordInfo(\r\n    menuId: string,\r\n    dataStructureEntityId: string,\r\n    rowId: string\r\n  ): any {\r\n    const api = getApi(this);\r\n    this.info = [];\r\n    const rawInfo = yield api.getRecordInfo({\r\n      MenuId: menuId,\r\n      DataStructureEntityId: dataStructureEntityId,\r\n      RowId: rowId\r\n    });\r\n\r\n    const info = rawInfo.cell.map(\r\n      (infoCellStruct: any) => infoCellStruct[\"#text\"]\r\n    );\r\n    this.info = info;\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { TypeSymbol } from \"dic/Container\";\r\nimport { action } from \"mobx\";\r\nimport { IClock } from \"./Clock\";\r\n\r\nexport class LookupListCacheMulti {\r\n  constructor(private clock = IClock()) {\r\n  }\r\n\r\n  lists = new Map<string, any[][]>();\r\n  recordBirthdate = new Map<string, number>();\r\n\r\n  disposers: any[] = [];\r\n\r\n  startup() {\r\n    this.disposers.push(this.clock.setInterval(this.handleOutdatingTimerTick, 60 * 1000));\r\n  }\r\n\r\n  teardown() {\r\n    for (let d of this.disposers) d();\r\n  }\r\n\r\n  @action.bound\r\n  handleOutdatingTimerTick() {\r\n    const now = this.clock.getTimeMs();\r\n    const idsToClean: string[] = [];\r\n    for (let lookupId of this.lists.keys()) {\r\n      if (now - this.recordBirthdate.get(lookupId)! >= 10 * 60 * 1000) {\r\n        idsToClean.push(lookupId);\r\n      }\r\n    }\r\n    for (let id of idsToClean) {\r\n      this.deleteLookup(id);\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  deleteLookup(id: string) {\r\n    this.lists.delete(id);\r\n    this.recordBirthdate.delete(id);\r\n  }\r\n\r\n  getLookupList(lookupId: string) {\r\n    return this.lists.get(lookupId);\r\n  }\r\n\r\n  hasLookupList(lookupId: string) {\r\n    return this.lists.has(lookupId);\r\n  }\r\n\r\n  setLookupList(lookupId: string, rows: any[][]) {\r\n    this.lists.set(lookupId, rows);\r\n    this.recordBirthdate.set(lookupId, this.clock.getTimeMs());\r\n  }\r\n}\r\n\r\nexport const ILookupListCacheMulti = TypeSymbol<LookupListCacheMulti>(\"ILookupListCacheMulti\");\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { computed, observable } from \"mobx\";\r\nimport { onRefreshChatrooms } from \"model/actions/Chatrooms/onRefreshChatrooms\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { PeriodicLoader } from \"utils/PeriodicLoader\";\r\n\r\nexport class Chatrooms {\r\n  *getChatroomsList(): any {\r\n    const api = getApi(this);\r\n    const chatrooms = yield api.getChatroomList();\r\n    this.items = chatrooms;\r\n  }\r\n\r\n  loader = new PeriodicLoader(onRefreshChatrooms(this), () => getApi(this).onApiResponse);\r\n\r\n  @observable items: any[] = [];\r\n\r\n  @computed get totalItemCount() {\r\n    return this.items.map((item) => item.unreadMessageCount).reduce((a, b) => a + b, 0);\r\n  }\r\n\r\n  get sortedItems() {\r\n    return this.items;\r\n  }\r\n\r\n  *startTimer(refreshIntervalMs: number) {\r\n    if (localStorage.getItem(\"debugNoPolling_chatrooms\")) return;\r\n    if (localStorage.getItem(\"debugPollingMs_chatrooms\")) {\r\n      refreshIntervalMs = parseInt(localStorage.getItem(\"debugPollingMs_chatrooms\") || \"30000\");\r\n    }\r\n    yield*this.loader.start(refreshIntervalMs);\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { handleError } from \"model/actions/handleError\";\r\nimport { getChatrooms } from \"model/selectors/Chatrooms/getChatrooms\";\r\nimport { getSearcher } from \"model/selectors/getSearcher\";\r\n\r\nexport function onRefreshChatrooms(ctx: any) {\r\n  return function*onRefreshChatrooms() {\r\n    try {\r\n      const chatRooms = getChatrooms(ctx);\r\n      yield*chatRooms.getChatroomsList();\r\n      getSearcher(ctx).indexChats(chatRooms.items);\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      //console.log(\"Error during getChatroomsList call ignored.\");\r\n      throw e;\r\n    }\r\n    ;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { PeriodicLoader } from \"utils/PeriodicLoader\";\r\nimport { observable } from \"mobx\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { getNotificationBoxContent } from \"model/actions/Notifications/GetNotificationBoxContent\";\r\n\r\nexport class Notifications {\r\n  @observable\r\n  notificationBox: any;\r\n\r\n  *getNotificationBoxContent(): any {\r\n    this.notificationBox = yield getApi(this).getNotificationBoxContent();\r\n  }\r\n\r\n  loader = new PeriodicLoader(getNotificationBoxContent(this), () => getApi(this).onApiResponse);\r\n\r\n  *startTimer(refreshIntervalMs: number) {\r\n    if (localStorage.getItem(\"debugNoPolling_notificationBox\")) return;\r\n    yield*this.loader.start(refreshIntervalMs);\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getNotifications } from \"model/selectors/Chatrooms/getNotifications\";\r\nimport { handleError } from \"model/actions/handleError\";\r\n\r\nexport function getNotificationBoxContent(ctx: any) {\r\n  return function*getNotificationBoxContent() {\r\n    try {\r\n      yield*getNotifications(ctx).getNotificationBoxContent();\r\n    } catch (e) {\r\n      yield*handleError(ctx)(e);\r\n      // console.log(\"Error during getNotificationBoxContent call ignored.\");\r\n      throw e;\r\n    }\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport xmlJs from \"xml-js\";\r\nimport { observable } from \"mobx\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { T } from \"utils/translation\";\r\n\r\nexport class Favorites {\r\n  @observable\r\n  public favoriteFolders: FavoriteFolder[] = [];\r\n\r\n  private xmlConverter = new XmlToFavoritesConverter();\r\n\r\n  public isFavorite(folderId: string, menuId: string) {\r\n    return this.getFolder(folderId)?.has(menuId) === true;\r\n  }\r\n\r\n  public isInAnyFavoriteFolder(menuId: string) {\r\n    return this.favoriteFolders.some((folder) => folder.has(menuId));\r\n  }\r\n\r\n  public get defaultFavoritesFolderId() {\r\n    return this.favoriteFolders.length > 0 ? this.favoriteFolders[0].id : \"Favorites\";\r\n  }\r\n\r\n  public setXml(xml: string) {\r\n    const foldersFromXml = this.xmlConverter.xmlToFolders(xml);\r\n    if (foldersFromXml.length === 0) {\r\n      foldersFromXml.push(\r\n        new FavoriteFolder(uuidv4(), T(\"Favorites\", \"default_group\"), true, [], false)\r\n      );\r\n    }\r\n    this.favoriteFolders = foldersFromXml;\r\n  }\r\n\r\n  public async add(folderId: string, menuId: string) {\r\n    this.getFolder(folderId)?.add(menuId);\r\n    await this.saveFavorites();\r\n  }\r\n\r\n  public async remove(menuId: any) {\r\n    this.favoriteFolders.find((folder) => folder.has(menuId))?.remove(menuId);\r\n    await this.saveFavorites();\r\n  }\r\n\r\n  private async saveFavorites() {\r\n    const api = getApi(this);\r\n    const xmlFavorites = this.xmlConverter.favoriteIdsToXml(this.favoriteFolders);\r\n    await api.saveFavorites({ConfigXml: xmlFavorites});\r\n  }\r\n\r\n  public async createFolder(name: string, isPinned: boolean) {\r\n    this.favoriteFolders.push(new FavoriteFolder(uuidv4(), name, false, [], isPinned));\r\n    await this.saveFavorites();\r\n  }\r\n\r\n  public async removeFolder(folderId: string) {\r\n    const folderToRemove = this.getFolder(folderId);\r\n    if (folderToRemove) {\r\n      this.favoriteFolders.remove(folderToRemove);\r\n    }\r\n    await this.saveFavorites();\r\n  }\r\n\r\n  public getFolderName(folderId: string): string {\r\n    return this.getFolder(folderId)?.name ?? \"\";\r\n  }\r\n\r\n  public async updateFolder(folderId: string, newName: string, isPinned: boolean): Promise<any> {\r\n    const folder = this.getFolder(folderId)!;\r\n    folder.name = newName;\r\n    folder.isPinned = isPinned;\r\n    await this.saveFavorites();\r\n  }\r\n\r\n  public getFolder(folderId: string) {\r\n    return this.favoriteFolders.find((folder) => folder.id === folderId);\r\n  }\r\n\r\n  public async setPinned(folderId: string, isPinned: boolean): Promise<any> {\r\n    this.getFolder(folderId)!.isPinned = isPinned;\r\n    await this.saveFavorites();\r\n  }\r\n\r\n  public async moveItemInFolder(itemIds: string[], fromIndex: number, toIndex: number) {\r\n    const itemId = itemIds[fromIndex];\r\n    itemIds.splice(fromIndex, 1);\r\n    itemIds.splice(toIndex, 0, itemId);\r\n    await this.saveFavorites();\r\n  }\r\n\r\n  async moveItemBetweenFolders(itemId: string, sourceFolder: FavoriteFolder, destinationFolder: FavoriteFolder) {\r\n    sourceFolder.itemIds.remove(itemId);\r\n    destinationFolder.itemIds.push(itemId);\r\n    await this.saveFavorites();\r\n  }\r\n\r\n  parent: any;\r\n}\r\n\r\nclass XmlToFavoritesConverter {\r\n  public xmlToFolders(xml: string): FavoriteFolder[] {\r\n    if (!xml) return [];\r\n    const parsedXml = xmlJs.xml2js(xml);\r\n    if (!parsedXml?.elements?.[0]?.elements) return [];\r\n    return parsedXml.elements[0].elements.map((folderXml: any, i: number) =>\r\n      this.parseToFavoriteFolder(folderXml, i === 0)\r\n    );\r\n  }\r\n\r\n  private parseToFavoriteFolder(folderXml: any, isDefault: boolean) {\r\n    const label = folderXml.attributes[\"label\"];\r\n    const id = folderXml.attributes[\"id\"] ?? label;\r\n    const isPinned = folderXml.attributes[\"isPinned\"] === \"true\";\r\n    const itemIds =\r\n      folderXml.elements\r\n        ?.map((item: xmlJs.Element) => item.attributes?.[\"menuId\"])\r\n        ?.filter((menuId: string) => menuId) ?? [];\r\n\r\n    return new FavoriteFolder(id, label, isDefault, itemIds, isPinned);\r\n  }\r\n\r\n  public favoriteIdsToXml(favoriteFolders: FavoriteFolder[]) {\r\n    return (\r\n      \"<favourites>\\n\" +\r\n      favoriteFolders.map((folder) => this.folderToXml(folder)).join(\"\\n\") +\r\n      \"\\n\" +\r\n      \"</favourites>\"\r\n    );\r\n  }\r\n\r\n  private folderToXml(folder: FavoriteFolder) {\r\n    return (\r\n      `  <folder label=\"${folder.name}\" id=\"${folder.id}\" isPinned=\"${folder.isPinned}\">\\n` +\r\n      folder.itemIds.map((menuId) => `    <item menuId=\"${menuId}\"/>`).join(\"\\n\") +\r\n      \"  </folder>\"\r\n    );\r\n  }\r\n}\r\n\r\nexport class FavoriteFolder {\r\n  constructor(\r\n    public id: string,\r\n    name: string,\r\n    public isDefault: boolean,\r\n    items: string[],\r\n    isPinned: boolean\r\n  ) {\r\n    this.name = name;\r\n    this.isPinned = isPinned;\r\n    this.itemIds = items;\r\n  }\r\n\r\n  @observable\r\n  itemIds: string[];\r\n\r\n  @observable\r\n  isPinned: boolean;\r\n\r\n  @observable\r\n  name: string;\r\n\r\n  public has(menuId: string) {\r\n    return this.itemIds.includes(menuId);\r\n  }\r\n\r\n  public add(menuId: string) {\r\n    return this.itemIds.push(menuId);\r\n  }\r\n\r\n  public remove(menuId: string) {\r\n    return this.itemIds.remove(menuId);\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IInfoSubsection } from \"gui/connections/types\";\r\nimport { action, observable } from \"mobx\";\r\nimport { onSidebarAuditSectionExpanded } from \"model/actions-ui/RecordInfo/onSidebarAuditSectionExpanded\";\r\nimport { onSidebarInfoSectionCollapsed } from \"model/actions-ui/RecordInfo/onSidebarInfoSectionCollapsed\";\r\nimport { onSidebarInfoSectionExpanded } from \"model/actions-ui/RecordInfo/onSidebarInfoSectionExpanded\";\r\nimport { getWorkbench } from \"model/selectors/getWorkbench\";\r\nimport { RefObject } from \"react\";\r\nimport { IMainMenuState } from \"./types/IMainMenu\";\r\nimport { ISearchResultGroup } from \"./types/ISearchResultGroup\";\r\n\r\nexport class SidebarState {\r\n\r\n  @observable\r\n  searchResultGroups: ISearchResultGroup[] = [];\r\n\r\n  @observable\r\n  _activeSection = \"Menu\";\r\n\r\n  @observable\r\n  activeInfoSubsection = IInfoSubsection.Info;\r\n\r\n  mainMenuState: IMainMenuState = new MainMenuState();\r\n\r\n  parent: any;\r\n\r\n  get resultCount() {\r\n    return this.searchResultGroups.length === 0\r\n      ? 0\r\n      : this.searchResultGroups.map(group => group.results.length).reduce((x, y) => x + y);\r\n  }\r\n\r\n  get activeSection() {\r\n    return this._activeSection;\r\n  }\r\n\r\n  set activeSection(value) {\r\n    const workbench = getWorkbench(this);\r\n    if (this._activeSection === \"Info\" && value !== this._activeSection) {\r\n      onSidebarInfoSectionCollapsed(workbench)();\r\n    }\r\n    if (this._activeSection !== \"Info\" && value === \"Info\") {\r\n      if (this.activeInfoSubsection === IInfoSubsection.Info) {\r\n        onSidebarInfoSectionExpanded(workbench)();\r\n      }\r\n      if (this.activeInfoSubsection === IInfoSubsection.Audit) {\r\n        onSidebarAuditSectionExpanded(workbench)();\r\n      }\r\n    }\r\n    this._activeSection = value;\r\n  }\r\n\r\n  @action\r\n  onSearchResultsChange(results: ISearchResultGroup[]) {\r\n    this.searchResultGroups = results;\r\n    this.activeSection = \"Search\";\r\n  }\r\n}\r\n\r\n\r\nexport class MainMenuState implements IMainMenuState {\r\n\r\n  @observable\r\n  editing = false;\r\n\r\n  @observable\r\n  folderStateMap: Map<string, boolean> = new Map();\r\n\r\n  refMap: Map<string, RefObject<HTMLElement>> = new Map();\r\n\r\n  @observable\r\n  private _highLightedItemId: string | undefined;\r\n\r\n  closeAll() {\r\n    this.folderStateMap.clear();\r\n  }\r\n\r\n  isOpen(menuId: string): boolean {\r\n    return this.folderStateMap.get(menuId) ?? false;\r\n  }\r\n\r\n  setIsOpen(menuId: string, state: boolean) {\r\n    this.folderStateMap.set(menuId, state);\r\n  }\r\n\r\n  flipIsOpen(menuId: string) {\r\n    const newState = !this.isOpen(menuId);\r\n    this.setIsOpen(menuId, newState);\r\n  }\r\n\r\n  setReference(id: string, ref: RefObject<HTMLElement>): void {\r\n    this.refMap.set(id, ref);\r\n  }\r\n\r\n  scrollToItem(id: string) {\r\n    this.refMap.get(id)?.current?.scrollIntoView();\r\n  }\r\n\r\n  public get highLightedItemId() {\r\n    return this._highLightedItemId;\r\n  }\r\n\r\n  highlightItem(itemId: string) {\r\n    this._highLightedItemId = itemId;\r\n    setTimeout(() => this._highLightedItemId = undefined, 3000)\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { getRecordInfo } from \"model/selectors/RecordInfo/getRecordInfo\";\r\n\r\nexport function onSidebarInfoSectionCollapsed(ctx: any) {\r\n  return flow(function*onSidebarInfoSectionCollapsed() {\r\n    yield*getRecordInfo(ctx).onSidebarInfoSectionCollapsed();\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { getRecordInfo } from \"model/selectors/RecordInfo/getRecordInfo\";\r\n\r\nexport function onSidebarInfoSectionExpanded(ctx: any) {\r\n  return flow(function*onSidebarInfoSectionExpanded() {\r\n    yield*getRecordInfo(ctx).onSidebarInfoSectionExpanded();\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { flow } from \"mobx\";\r\nimport { getRecordInfo } from \"model/selectors/RecordInfo/getRecordInfo\";\r\n\r\nexport function onSidebarAuditSectionExpanded(ctx: any) {\r\n  return flow(function*onSidebarAuditSectionExpanded() {\r\n    yield*getRecordInfo(ctx).onSidebarAuditSectionExpanded();\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { IAboutInfo } from \"model/entities/types/IAboutInfo\";\r\nimport { observable } from \"mobx\";\r\nimport { runInFlowWithHandler } from \"utils/runInFlowWithHandler\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\n\r\nexport class About {\r\n  @observable\r\n  info: IAboutInfo = {serverVersion: \"\"};\r\n\r\n  update(): Promise<void> {\r\n    return runInFlowWithHandler({\r\n      ctx: this.parent,\r\n      action: async () => {\r\n        const api = getApi(this.parent);\r\n        this.info = await api.getAboutInfo();\r\n      },\r\n    });\r\n  }\r\n\r\n  parent: any;\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Workbench } from \"../entities/Workbench\";\r\n\r\nimport { Searcher } from \"../entities/Searcher\";\r\nimport { WorkbenchLifecycle } from \"model/entities/WorkbenchLifecycle/WorkbenchLifecycle\";\r\nimport { MainMenuEnvelope } from \"../entities/MainMenu\";\r\nimport { OpenedScreens } from \"model/entities/OpenedScreens\";\r\nimport { WorkQueues } from \"model/entities/WorkQueues\";\r\nimport { RecordInfo } from \"model/entities/RecordInfo\";\r\nimport { LookupListCacheMulti } from \"../../modules/Lookup/LookupListCacheMulti\";\r\nimport { Clock } from \"../../modules/Lookup/Clock\";\r\nimport $root from \"../../rootContainer\";\r\nimport { SCOPE_Workbench } from \"../../modules/Workbench/WorkbenchModule\";\r\nimport { registerScope } from \"../../dic/Container\";\r\nimport { createMultiLookupEngine } from \"modules/Lookup/LookupModule\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { Chatrooms } from \"model/entities/Chatrooms\";\r\nimport { Notifications } from \"model/entities/Notifications\";\r\nimport { Favorites } from \"model/entities/Favorites\";\r\nimport { SidebarState } from \"model/entities/SidebarState\";\r\nimport { About } from \"model/entities/AboutInfo\";\r\n\r\nexport function createWorkbench() {\r\n  const clock = new Clock();\r\n  const workbenchLookupListCache = new LookupListCacheMulti(clock);\r\n  const lookupMultiEngine = createMultiLookupEngine(() => getApi(instance));\r\n\r\n  const instance = new Workbench({\r\n    mainMenuEnvelope: new MainMenuEnvelope(),\r\n    favorites: new Favorites(),\r\n    workbenchLifecycle: new WorkbenchLifecycle(),\r\n    searcher: new Searcher(),\r\n    openedScreens: new OpenedScreens(),\r\n    openedDialogScreens: new OpenedScreens(),\r\n    workQueues: new WorkQueues(),\r\n    chatrooms: new Chatrooms(),\r\n    recordInfo: new RecordInfo(),\r\n    notifications: new Notifications(),\r\n    sidebarState: new SidebarState(),\r\n    lookupListCache: workbenchLookupListCache,\r\n    lookupMultiEngine,\r\n    about: new About()\r\n  });\r\n  workbenchLookupListCache.startup();\r\n  lookupMultiEngine.startup();\r\n  const $workbench = $root.beginLifetimeScope(SCOPE_Workbench);\r\n  registerScope(instance, $workbench);\r\n  return instance;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nexport const SCOPE_Workbench = \"Workbench\";\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getFormScreenLifecycle } from \"model/selectors/FormScreen/getFormScreenLifecycle\"\r\n\r\nexport function stopAutoreload(ctx: any) {\r\n  return function*() {\r\n    getFormScreenLifecycle(ctx).clearAutoRefreshInterval();\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { getOpenedScreens } from \"model/selectors/getOpenedScreens\";\r\nimport { stopAutoreload } from \"../FormScreen/stopAutoreload\";\r\n\r\nexport function stopAllFormsAutorefresh(ctx: any) {\r\n  return function*() {\r\n    for (let openedScreen of getOpenedScreens(ctx).items) {\r\n      if (\r\n        openedScreen.content &&\r\n        !openedScreen.content.isLoading &&\r\n        openedScreen.content.formScreen\r\n      ) {\r\n        yield*stopAutoreload(openedScreen.content.formScreen)();\r\n      }\r\n    }\r\n  };\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport { observer } from \"mobx-react\";\r\nimport CS from \"./DialogsCommon.module.css\";\r\nimport { T } from \"../../../utils/translation\";\r\nimport { ModalDialog } from \"gui/Components/Dialog/ModalDialog\";\r\n\r\n@observer\r\nexport class QuestionLogoutWithDirtyData extends React.Component<{\r\n  onNoClick?: (event: any) => void;\r\n  onYesClick?: (event: any) => void;\r\n}> {\r\n  refPrimaryBtn = (elm: any) => (this.elmPrimaryBtn = elm);\r\n  elmPrimaryBtn: any;\r\n\r\n  componentDidMount() {\r\n    setTimeout(() => {\r\n      if (this.elmPrimaryBtn) {\r\n        this.elmPrimaryBtn.focus?.();\r\n      }\r\n    }, 150);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <ModalDialog\r\n        title={T(\"Question\", \"question_title\")}\r\n        titleButtons={null}\r\n        buttonsCenter={\r\n          <>\r\n            <button\r\n              ref={this.refPrimaryBtn}\r\n              tabIndex={0}\r\n              autoFocus={true}\r\n              onClick={this.props.onYesClick}\r\n            >\r\n              {T(\"Yes\", \"button_yes\")}\r\n            </button>\r\n            <button tabIndex={0} onClick={this.props.onNoClick}>\r\n              {T(\"No\", \"button_no\")}\r\n            </button>\r\n          </>\r\n        }\r\n        buttonsLeft={null}\r\n        buttonsRight={null}\r\n      >\r\n        <div className={CS.dialogContent}>\r\n          {T(\r\n            \"Some changes has not been saved yet. Do you still want to sign out?\",\r\n            \"sign_out_data_lost_question\"\r\n          )}\r\n        </div>\r\n      </ModalDialog>\r\n    );\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action, computed, observable } from \"mobx\";\r\nimport { createWorkbench } from \"../factories/createWorkbench\";\r\nimport { getApi } from \"../selectors/getApi\";\r\nimport { getApplication } from \"../selectors/getApplication\";\r\nimport { IApplicationLifecycle } from \"./types/IApplicationLifecycle\";\r\nimport { stopWorkQueues } from \"model/actions/WorkQueues/stopWorkQueues\";\r\nimport { stopAllFormsAutorefresh } from \"model/actions/Workbench/stopAllFormsAutorefresh\";\r\nimport { userManager } from \"oauth\";\r\nimport { getWorkbench } from \"model/selectors/getWorkbench\";\r\nimport { getOpenedScreens } from \"model/selectors/getOpenedScreens\";\r\nimport { QuestionLogoutWithDirtyData } from \"gui/Components/Dialogs/QuestionLogoutWithDirtyData\";\r\nimport React from \"react\";\r\nimport { getDialogStack } from \"model/selectors/DialogStack/getDialogStack\";\r\n\r\nexport class ApplicationLifecycle implements IApplicationLifecycle {\r\n  $type_IApplicationLifecycle: 1 = 1;\r\n\r\n  @observable loginPageMessage?: string | undefined;\r\n\r\n  @observable inFlow = 0;\r\n\r\n  @computed get isWorking() {\r\n    return this.inFlow > 0;\r\n  }\r\n\r\n  *onLoginFormSubmit(args: { event: any; userName: string; password: string }) {\r\n    try {\r\n      this.inFlow++;\r\n      args.event.preventDefault();\r\n      yield*this.performLogin(args);\r\n    } finally {\r\n      this.inFlow--;\r\n    }\r\n  }\r\n\r\n  *onSignOutClick(args: { event: any }) {\r\n    yield*this.requestSignout();\r\n  }\r\n\r\n  *requestSignout(): any {\r\n    const workbench = getWorkbench(this);\r\n    const openedScreens = workbench && getOpenedScreens(workbench);\r\n    let isSomeDirtyScreen = false;\r\n    for (let openedScreen of openedScreens.items) {\r\n      isSomeDirtyScreen = !!(isSomeDirtyScreen || openedScreen.content?.formScreen?.isDirty);\r\n    }\r\n    if (isSomeDirtyScreen) {\r\n      const isReallySignOut = yield new Promise((resolve: (answer: boolean) => void) => {\r\n        const closeDialog = getDialogStack(this).pushDialog(\r\n          \"\",\r\n          <QuestionLogoutWithDirtyData\r\n            onYesClick={() => {\r\n              closeDialog();\r\n              resolve(true);\r\n            }}\r\n            onNoClick={() => {\r\n              closeDialog();\r\n              resolve(false);\r\n            }}\r\n          />\r\n        );\r\n      });\r\n\r\n      if (!isReallySignOut) return;\r\n    }\r\n\r\n    yield*this.performLogout();\r\n  }\r\n\r\n  *run() {\r\n    yield*this.reuseAuthToken();\r\n  }\r\n\r\n  *performLogin(args: { userName: string; password: string }): any {\r\n    try {\r\n      const api = getApi(this);\r\n      const token = yield api.login({\r\n        UserName: args.userName,\r\n        Password: args.password,\r\n      });\r\n      yield*this.anounceAuthToken(token);\r\n    } catch (error) {\r\n      // TODO: Distinguish between connection error and bad credentials etc.\r\n      this.setLoginPageMessage(\"Login failed.\");\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  *performLogout() {\r\n    const api = getApi(this);\r\n    const application = getApplication(this);\r\n    window.sessionStorage.removeItem(\"origamAuthToken\");\r\n    for (let sessionStorageKey of Object.keys(window.sessionStorage)) {\r\n      if (sessionStorageKey.startsWith(\"oidc.user\")) {\r\n        // That is an oauth session...\r\n        api.resetAccessToken();\r\n        userManager.signoutRedirect();\r\n        return;\r\n      }\r\n    }\r\n    yield*stopAllFormsAutorefresh(application.workbench!)();\r\n    yield*stopWorkQueues(application.workbench!)();\r\n    application.resetWorkbench();\r\n    try {\r\n      yield api.logout();\r\n    } finally {\r\n      api.resetAccessToken();\r\n    }\r\n    return null;\r\n  }\r\n\r\n  *reuseAuthToken() {\r\n    const token = window.sessionStorage.getItem(\"origamAuthToken\");\r\n    if (token) {\r\n      yield*this.anounceAuthToken(token);\r\n    }\r\n  }\r\n\r\n  *anounceAuthToken(token: string) {\r\n    const api = getApi(this);\r\n    const application = getApplication(this);\r\n    window.sessionStorage.setItem(\"origamAuthToken\", token);\r\n    api.setAccessToken(token);\r\n    const workbench = createWorkbench();\r\n    application.setWorkbench(workbench);\r\n    yield*workbench.run();\r\n  }\r\n\r\n  @action.bound\r\n  setLoginPageMessage(msg: string): void {\r\n    this.loginPageMessage = msg;\r\n  }\r\n\r\n  @action.bound\r\n  resetLoginPageMessage(): void {\r\n    this.loginPageMessage = undefined;\r\n  }\r\n\r\n  parent?: any;\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { action, observable } from \"mobx\";\r\nimport { IDialogStack } from \"./types/IDialogStack\";\r\nimport { IDialogInfo } from \"./types/IDialogInfo\";\r\nimport { IDialogDimensions } from \"../../gui/Components/Dialog/types\";\r\n\r\nlet nextId = 0;\r\n\r\nexport class DialogStack implements IDialogStack {\r\n  parent?: any;\r\n  @observable.shallow stackedDialogs: Array<IDialogInfo> = [];\r\n\r\n  @action.bound pushDialog(\r\n    key: string,\r\n    component: React.ReactElement,\r\n    dialogDimensions?: IDialogDimensions,\r\n    closeOnClickOutside?: boolean) {\r\n    const useKey = key ? key : `DEFAULT_DIALOG_KEY_${nextId++}`;\r\n    this.stackedDialogs.push({\r\n      key: useKey,\r\n      closeOnClickOutside: closeOnClickOutside,\r\n      component: component,\r\n      dimensions: dialogDimensions\r\n    });\r\n    return () => {\r\n      this.closeDialog(useKey);\r\n    };\r\n  }\r\n\r\n  @action.bound closeDialog(key: string) {\r\n    const index = this.stackedDialogs.findIndex(dlg => dlg.key === key);\r\n    if (index > -1) {\r\n      this.stackedDialogs.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  isOpen(key: string) {\r\n    return this.stackedDialogs.findIndex(info => info.key === key) !== -1;\r\n  }\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { ErrorDialogController } from \"model/entities/ErrorDialog\";\r\nimport { Application } from \"../entities/Application\";\r\nimport { ApplicationLifecycle } from \"../entities/ApplicationLifecycle\";\r\nimport { DialogStack } from \"../entities/DialogStack\";\r\nimport { OrigamAPI } from \"../entities/OrigamAPI\";\r\nimport { IApplication } from \"../entities/types/IApplication\";\r\nimport { handleError } from \"../actions/handleError\";\r\nimport { flow } from \"mobx\";\r\n\r\n\r\nexport function createApplication(): IApplication {\r\n  const applicationLifecycle = new ApplicationLifecycle();\r\n\r\n  const apiErrorHandler = (error: any) => {\r\n    flow(function*apiErrorHandler() {\r\n      yield*handleError(applicationLifecycle)(error);\r\n    })();\r\n  };\r\n\r\n  return new Application({\r\n    api: new OrigamAPI(apiErrorHandler),\r\n    applicationLifecycle: applicationLifecycle,\r\n    dialogStack: new DialogStack(),\r\n    errorDialogController: new ErrorDialogController()\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\n/* eslint-disable no-console */\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n  // [::1] is the IPv6 localhost address.\r\n  window.location.hostname === '[::1]' ||\r\n  // 127.0.0.1/8 is considered localhost for IPv4.\r\n  window.location.hostname.match(\r\n    /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n  )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\r\n      window.location.href\r\n    );\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n            'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n\r\n/* eslint-enable no-console */","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { createMachine, interpret } from \"xstate\";\r\n\r\nexport function preventDoubleclickSelect() {\r\n  const interpreter = interpret(\r\n    createMachine(\r\n      {\r\n        id: \"selectionPreventer\",\r\n        initial: \"IDLE\",\r\n        states: {\r\n          IDLE: {\r\n            on: {\r\n              MOUSE_DOWN: {\r\n                target: \"DEAD_PERIOD\",\r\n                cond: \"isNotEditable\",\r\n              },\r\n            },\r\n          },\r\n          DEAD_PERIOD: {\r\n            on: {\r\n              MOUSE_DOWN: {\r\n                actions: \"preventDefault\",\r\n                target: \"DEAD_PERIOD\",\r\n              },\r\n            },\r\n            after: {\r\n              500: \"IDLE\",\r\n            },\r\n          },\r\n        },\r\n      },\r\n      {\r\n        actions: {\r\n          preventDefault: (ctx, {payload: {domEvent}}) => {\r\n            domEvent.preventDefault();\r\n          },\r\n        },\r\n        guards: {\r\n          isNotEditable: (ctx, {payload: {domEvent}}) => {\r\n            const targetTag = domEvent.target.tagName.toLowerCase();\r\n            return targetTag !== \"textarea\" && targetTag !== \"input\";\r\n          },\r\n        },\r\n      }\r\n    )\r\n  ).start();\r\n\r\n  window.addEventListener(\"mousedown\", (e) => {\r\n    interpreter.send({type: \"MOUSE_DOWN\", payload: {domEvent: e}});\r\n  });\r\n}\r\n","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport React from \"react\";\r\nimport S from \"RootError.module.scss\";\r\nimport cx from \"classnames\";\r\nimport { T } from \"utils/translation\";\r\nimport { logoff } from \"oauth\";\r\n\r\nexport class RootError extends React.Component<{\r\n  error: any\r\n}> {\r\n\r\n  getHelpUrl() {\r\n    if (window.navigator?.platform?.toLowerCase()?.includes(\"win\")) { // platform is deprecated but there seems to be no alternative\r\n      return \"https://support.microsoft.com/en-us/windows/how-to-set-your-time-and-time-zone-dfaa7122-479f-5b98-2a7b-fa0b6e01b261\"\r\n    }\r\n    if (window.navigator?.platform?.toLowerCase()?.includes(\"mac\")) {\r\n      return \"https://support.apple.com/en-gb/guide/mac-help/mchlp2996/mac\"\r\n    }\r\n    return \"\"\r\n  }\r\n\r\n  renderMessage() {\r\n    if (this.props.error.message.includes(\"iat is in the future\") ||\r\n      this.props.error.message.includes(\"exp is in the past\")) {\r\n      const errorMessage = T(\"Login is not possible due to discrepancy between time on the server and on your machine. Please make sure that time on your machine is correct.\", \"login_error_due_to_time\");\r\n      const helpUrl = this.getHelpUrl();\r\n\r\n      return (\r\n        <div className={cx(S.alert, S.alertDanger)}>\r\n          <p>{errorMessage}</p>\r\n          {helpUrl && <a href={helpUrl} target=\"_blank\" rel=\"noopener noreferrer\">{T(\"Help\", \"switch_time_help\")}</a>}\r\n        </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <div className={cx(S.alert, S.alertDanger)}>{this.props.error.message}</div>\r\n      );\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className={S.root}>\r\n        {this.renderMessage()}\r\n        <div className={S.returnLink}>\r\n          {T(\"Click \", \"sign_out_click_1\")}\r\n          <a className={S.inPageLink} onClick={async ()=> await logoff()}>\r\n            {T(\"here\", \"sign_out_click_2\")}\r\n          </a>\r\n          {T(\" to sign out.\", \"sign_out_click_3\")}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}","/*\r\nCopyright 2005 - 2021 Advantage Solutions, s. r. o.\r\n\r\nThis file is part of ORIGAM (http://www.origam.org).\r\n\r\nORIGAM is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nORIGAM is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with ORIGAM. If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n\r\nimport axios from \"axios\";\r\nimport { flow } from \"mobx\";\r\nimport { getApi } from \"model/selectors/getApi\";\r\nimport { ensureLogin, userManager } from \"oauth\";\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { Root } from \"Root\";\r\nimport \"./index.scss\";\r\nimport { createApplication } from \"./model/factories/createApplication\";\r\nimport \"./rootContainer\";\r\nimport * as serviceWorker from \"./serviceWorker\";\r\nimport Cookie from \"js-cookie\";\r\nimport { translationsInit } from \"./utils/translation\";\r\nimport { getLocaleFromCookie, initLocaleCookie } from \"utils/cookies\";\r\nimport moment from \"moment\";\r\nimport \"moment/min/locales\";\r\nimport { preventDoubleclickSelect } from \"utils/mouse\";\r\nimport { RootError } from \"RootError\";\r\n\r\nif (process.env.REACT_APP_SELENIUM_KICK) {\r\n  axios.post(\"http://127.0.0.1:3500/app-reload\");\r\n}\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  axios.defaults.timeout = 3600000;\r\n  (window as any).ORIGAM_CLIENT_AXIOS_LIB = axios;\r\n}\r\n\r\n(window as any).ORIGAM_CLIENT_REVISION_HASH = process.env.REACT_APP_GIT_REVISION_HASH || \"UNKNOWN\";\r\n(window as any).ORIGAM_CLIENT_REVISION_DATE = process.env.REACT_APP_GIT_REVISION_DATE || \"UNKNOWN\";\r\n\r\nfunction disableAutoZoomingOnIPhone(){\r\n  const safariDerivedBrowser = navigator.vendor && navigator.vendor.indexOf('Apple') > -1;\r\n  if(safariDerivedBrowser){\r\n    document\r\n      .querySelector('meta[name=\"viewport\"]')\r\n      ?.setAttribute(\"content\", \"width=device-width, initial-scale=1, maximum-scale=1\");\r\n  }\r\n}\r\n\r\nasync function main() {\r\n  disableAutoZoomingOnIPhone();\r\n  preventDoubleclickSelect();\r\n  const locationHash = window.location.hash;\r\n  const TOKEN_OVR_HASH = \"#origamAuthTokenOverride=\";\r\n  if (locationHash.startsWith(TOKEN_OVR_HASH)) {\r\n    sessionStorage.setItem(\"origamAuthTokenOverride\", locationHash.replace(TOKEN_OVR_HASH, \"\"));\r\n    window.location.hash = \"\";\r\n  }\r\n  const BACKEND_OVR_HASH = \"#origamBackendOverride=\";\r\n  if (locationHash.startsWith(BACKEND_OVR_HASH)) {\r\n    const backendUrl = locationHash.replace(BACKEND_OVR_HASH, \"\");\r\n    const newUrl = backendUrl + `#origamBackendOverrideReturn=${window.location.origin}`;\r\n    Cookie.set(\"backendUrl\", backendUrl);\r\n    window.location.assign(newUrl);\r\n    return;\r\n  }\r\n\r\n  const BACKEND_OVR_RETURN_HASH = \"#origamBackendOverrideReturn=\";\r\n  if (locationHash.startsWith(BACKEND_OVR_RETURN_HASH)) {\r\n    window.sessionStorage.setItem(\r\n      \"teleportAfterLogin\",\r\n      locationHash.replace(BACKEND_OVR_RETURN_HASH, \"\")\r\n    );\r\n    window.location.hash = \"\";\r\n    for (let k of Object.keys(window.sessionStorage)) {\r\n      if (k.startsWith(\"oidc.user\")) {\r\n        window.sessionStorage.removeItem(k);\r\n      }\r\n    }\r\n  }\r\n  let user;\r\n  try {\r\n    user = await ensureLogin();\r\n  } catch (e) {\r\n    const application = createApplication();\r\n    await initLocaleCookie(application);\r\n    await translationsInit(application);\r\n    ReactDOM.render(<RootError error={e}/>, document.getElementById(\"root\"));\r\n    return;\r\n  }\r\n  if (user) {\r\n    if (window.sessionStorage.getItem(\"teleportAfterLogin\")) {\r\n      window.sessionStorage.removeItem(\"teleportAfterLogin\");\r\n      return;\r\n    }\r\n    const application = createApplication();\r\n    getApi(application).setAccessToken(user.access_token);\r\n    sessionStorage.setItem(\"origamAuthToken\", user.access_token);\r\n    userManager.events.addUserLoaded((user) => {\r\n      getApi(application).setAccessToken(user.access_token);\r\n      sessionStorage.setItem(\"origamAuthToken\", user.access_token);\r\n    });\r\n    flow(application.run.bind(application))();\r\n\r\n    await initLocaleCookie(application);\r\n    const locale = await getLocaleFromCookie();\r\n    document.documentElement.lang = locale;\r\n    moment.locale(locale);\r\n\r\n    await translationsInit(application);\r\n\r\n    ReactDOM.render(<Root application={application}/>, document.getElementById(\"root\"));\r\n  }\r\n}\r\n\r\nmain();\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n\r\n\r\n\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"columnTable\":\"ColumnsDialog_columnTable__3IW6R\",\"lockedColumns\":\"ColumnsDialog_lockedColumns__16RRQ\",\"lockedColumnsInput\":\"ColumnsDialog_lockedColumnsInput__IAIXd\",\"checkBoxCell\":\"ColumnsDialog_checkBoxCell__1-H_s\",\"columnTableCell\":\"ColumnsDialog_columnTableCell__3gj86\",\"columnWidthHandle\":\"ColumnsDialog_columnWidthHandle__2XIGL\",\"checkBox\":\"ColumnsDialog_checkBox__34opU\",\"dropdown\":\"ColumnsDialog_dropdown__3hicf\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"resultItem\":\"SearchResults_resultItem__3gqOX\",\"icon\":\"SearchResults_icon__38jUm\",\"textContainer\":\"SearchResults_textContainer__UIGSx\",\"resultItemName\":\"SearchResults_resultItemName__2gC9d\",\"resultItemDescription\":\"SearchResults_resultItemDescription__1Wrta\",\"resultGroupRow\":\"SearchResults_resultGroupRow__1-yR8\",\"groupName\":\"SearchResults_groupName__2cMdf\",\"arrow\":\"SearchResults_arrow__1SDZP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"navigationButtonContainer\":\"NavigationButton_navigationButtonContainer__eZVhQ\",\"navigationButton\":\"NavigationButton_navigationButton__22YAH\",\"navigationIcon\":\"NavigationButton_navigationIcon__2lsBW\",\"label\":\"NavigationButton_label__h8S2Z\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"droppedPanelContainer\":\"DateTimeEditor_droppedPanelContainer__3DTBf\",\"dropdownSymbol\":\"DateTimeEditor_dropdownSymbol__16Coi\",\"input\":\"DateTimeEditor_input__C4qX7\",\"notification\":\"DateTimeEditor_notification__3YTPz\",\"editorContainer\":\"DateTimeEditor_editorContainer__3Wri-\",\"formatHintTooltip\":\"DateTimeEditor_formatHintTooltip__CgPt2\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"headers\":\"Table_headers__2IR3N\",\"scrolleeShifted\":\"Table_scrolleeShifted__3O-ZH\",\"table\":\"Table_table__2QcwG\",\"loadingOverlay\":\"Table_loadingOverlay__2BHxP\",\"loadingIcon\":\"Table_loadingIcon__zzhK5\",\"header\":\"Table_header__Mo8rm\",\"cellAreaContainer\":\"Table_cellAreaContainer__2bI8E\",\"canvasRow\":\"Table_canvasRow__1r8W1\",\"toolTip\":\"Table_toolTip__3nq1g\",\"toolTipContainer\":\"Table_toolTipContainer__nTV4R\",\"tooltipContent\":\"Table_tooltipContent__HvJxF\",\"toolTipLine\":\"Table_toolTipLine__23IBX\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"blobEditor\":\"BlobEditor_blobEditor__1BpIC\",\"imageEditor\":\"BlobEditor_imageEditor__JPYbH\",\"dialogContent\":\"BlobEditor_dialogContent__3OChg\",\"editorContainer\":\"BlobEditor_editorContainer__NmAFO\",\"notification\":\"BlobEditor_notification__1lBZF\",\"standardBorder\":\"BlobEditor_standardBorder__3VW0i\",\"focusedBorder\":\"BlobEditor_focusedBorder__1-NT2\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"Header_header__1lpyZ\",\"Header_order\":\"Header_Header_order__25O0i\",\"columnWidthHandle\":\"Header_columnWidthHandle__2cLzS\",\"root\":\"Header_root__33Etx\",\"noSelect\":\"Header_noSelect__35hay\",\"changing-order\":\"Header_changing-order__3X1bu\",\"label\":\"Header_label__3C5sA\",\"order\":\"Header_order__3JFC9\",\"middleSeparator\":\"Header_middleSeparator__1_7gh\",\"rightSeparator\":\"Header_rightSeparator__1DILU\",\"inHeaderRow\":\"Header_inHeaderRow__2doQ5\",\"additionalContentsRow\":\"Header_additionalContentsRow__2sSxI\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"deleteIcon\":\"CMainMenu_deleteIcon__1QWMG\",\"favoritesMenuItem\":\"CMainMenu_favoritesMenuItem__24jmI\",\"addToFavoritesIconContainer\":\"CMainMenu_addToFavoritesIconContainer__13Hdz\",\"addToFavoritesIcon\":\"CMainMenu_addToFavoritesIcon__VDuSc\",\"isOpenedScreen\":\"CMainMenu_isOpenedScreen__2bpLx\",\"itemGrip\":\"CMainMenu_itemGrip__cubux\",\"topMenuHeader\":\"CMainMenu_topMenuHeader__3JHFc\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"mapDiv\":\"MapPerspectiveUI_mapDiv__21RjH\",\"mapSearch\":\"MapPerspectiveUI_mapSearch__1RLrw\",\"mapSearchDropdown\":\"MapPerspectiveUI_mapSearchDropdown__3qi4t\",\"mapToolbarButton\":\"MapPerspectiveUI_mapToolbarButton__2OUVR\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"FormField_root__3skoc\",\"caption\":\"FormField_caption__2_h3h\",\"editor\":\"FormField_editor__1r_is\",\"notification\":\"FormField_notification__37GUS\"};"],"sourceRoot":""}